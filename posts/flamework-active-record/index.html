<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="PHPæ¡†æ¶å®æˆ˜ï¼ˆäº”ï¼‰ï¼šORMä¸ActiveRecord"><meta property="og:description" content="ç®€è¿° Modelæ˜¯MVCæ¡†æ¶ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œå®ƒè¦æä¾›ä¸ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„æ•°æ®åŠæ•°æ®å¤„ç†æ–¹æ³•çš„å°è£…ï¼Œä¸€èˆ¬è¦æä¾›æ•°æ®å¯¹è±¡ã€æ•°æ®åº“è¿æ¥ã€äº‹åŠ¡ç®¡ç†ã€SQLè¯­å¥æ„é€ ã€æ•°æ®CRUDã€é«˜çº§é€šç”¨ä¸šåŠ¡é€»è¾‘ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚ç”±äºModelä¸Controllerå’ŒViewæ˜¯è§£è€¦çš„ï¼Œå¹¶ä¸”æœ¬èº«å…·å¤‡å¾ˆé«˜çš„é€šç”¨æ€§å’Œå¤æ‚æ€§ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šç‹¬ç«‹çš„å®ç°ã€‚æœ¬æ–‡å¸Œæœ›èƒ½é€šè¿‡å¼€å‘ä¸€ä¸ªç®€å•çš„ActiveRecordï¼ŒéªŒè¯è¿™ç§Modelå®ç°æ–¹æ¡ˆçš„åŸç†å’Œè¿‡ç¨‹ã€‚
ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„ ORMçš„å…¨ç§°æ˜¯Object Relational Mappingï¼Œå³å¯¹è±¡å…³ç³»æ˜ å°„ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³å…³ç³»æ•°æ®åº“çš„æ•°å­¦æ¨¡å‹å’Œç¼–ç¨‹è¯­è¨€çš„å¯¹è±¡æ¨¡å‹ä¹‹é—´çš„é˜»æŠ—ä¸åŒ¹é…é—®é¢˜è€Œæå‡ºçš„è§£å†³æ–¹æ¡ˆã€‚
é˜»æŠ—ä¸åŒ¹é…æ˜¯ä¸ªé€¼æ ¼å¾ˆé«˜çš„è¯ã€‚
é˜»æŠ—æ˜¯æŒ‡ç”µè·¯ä¸­çš„ç”µå®¹ã€ç”µæ„Ÿã€ç”µé˜»å¯¹äº¤æµç”µçš„éšœç¢ä½œç”¨ï¼Œå°±åƒç”µé˜»å¯¹ç›´æµç”µçš„éšœç¢ä½œç”¨ã€‚ä¸¤ä¸ªç³»ç»Ÿä¼ é€’ä¿¡å·å¯ä»¥å½¢è±¡åœ°çœ‹æˆç”µå‹çš„ä¼ é€’ï¼Œå…¬å¼ä¸ºï¼š
U(out) * Z(in)
U(in) = &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
Z(in) + Z(out)
å³è¾“å…¥ç”µå‹ç­‰äºè¾“å‡ºç”µå‹ä¸è¾“å…¥é˜»æŠ—çš„ç§¯é™¤ä»¥è¾“å…¥é˜»æŠ—ä¸è¾“å‡ºé˜»æŠ—çš„å’Œã€‚
ç†æƒ³æƒ…å†µè‚¯å®šæ˜¯è¾“å…¥ç”µå‹ç­‰äºè¾“å‡ºç”µå‹ï¼Œè¿™æ—¶ä¿¡å·æ˜¯æ²¡æœ‰å¤±çœŸçš„ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚Z(in)ä¸Z(in)+Z(out)ä¹‹å•†æ— é™é€¼è¿‘1ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«é˜»æŠ—åŒ¹é…ã€‚å…³ç³»å‹æ•°æ®åº“æ˜¯å»ºç«‹åœ¨æ•°å­¦æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œè€Œç¼–ç¨‹è¯­è¨€ä¸­çš„å¯¹è±¡æ˜¯å»ºç«‹åœ¨äººå¯¹å®¢è§‚ä¸–ç•Œè®¤çŸ¥çš„å…·è±¡æ¨¡å‹ä¸Šã€‚è¯´ç™½äº†ï¼Œé˜»æŠ—ä¸åŒ¹é…é—®é¢˜å°±æ˜¯è¯´å› è¿™ä¸¤ç§æ¨¡å‹ä¸ä¸€è‡´è€Œå¯¼è‡´çš„é—®é¢˜ã€‚
ORMé€šè¿‡å»ºç«‹è¡¨ä¸å¯¹è±¡ã€åˆ—ä¸å±æ€§ï¼ˆè¿™åªæ˜¯ä¸€èˆ¬æƒ…å†µï¼‰ä¹‹é—´çš„æ˜ å°„å…³ç³»è€Œè§£å†³é—®é¢˜ï¼Œè¿™å¯ä»¥å®ç°åƒæ“ä½œå¯¹è±¡ä¸€æ ·å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ã€‚ä¸è¿‡ORMçš„ç¼ºç‚¹æ˜¯ä¸èƒ½å¾ˆå¥½åœ°å¤„ç†å¤æ‚æ•°æ®å…³ç³»ï¼Œä¼šå‡ºç°æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ï¼Œå› æ­¤å¿…è¦æ—¶ä»ç„¶éœ€è¦ç›´æ¥ä½¿ç”¨SQLã€‚
ActiveRecord ActiveRecordæ˜¯Ruby on Railsæå‡ºçš„ä¸€ä¸ªæ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ORMçš„ä¸€ç§å®ç°ï¼Œå®ƒæ˜¯å¯¹è±¡ç±»å‹ã€æ•°æ®ã€CRUDæ–¹æ³•çš„åˆä½“ï¼Œä½¿å¯¹æ•°æ®çš„æ“ä½œä»¥æ›´å…·è±¡åŒ–çš„æ–¹å¼å®ç°ã€‚ä¸‹é¢ä»‹ç»åœ¨Flameworkä¸­å®ç°ä¸€ä¸ªç®€å•çš„ActiveRecordçš„è¿‡ç¨‹ã€‚
é¦–å…ˆå®ç°æ•°æ®åº“çš„æ¥å£ï¼Œæä¾›æ•°æ®åº“è¿æ¥ã€æŸ¥è¯¢ã€æ‰§è¡ŒSQLè¯­å¥ã€äº‹åŠ¡ç®¡ç†ç­‰åŸºæœ¬åŠŸèƒ½ã€‚è¿™é‡Œä½¿ç”¨PDOå®ç°ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 <?"><meta property="og:type" content="article"><meta property="og:url" content="http://0x3f.org/posts/flamework-active-record/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-01-01T20:45:00+00:00"><meta property="article:modified_time" content="2014-01-01T20:45:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="PHPæ¡†æ¶å®æˆ˜ï¼ˆäº”ï¼‰ï¼šORMä¸ActiveRecord"><meta name=twitter:description content="ç®€è¿° Modelæ˜¯MVCæ¡†æ¶ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œå®ƒè¦æä¾›ä¸ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„æ•°æ®åŠæ•°æ®å¤„ç†æ–¹æ³•çš„å°è£…ï¼Œä¸€èˆ¬è¦æä¾›æ•°æ®å¯¹è±¡ã€æ•°æ®åº“è¿æ¥ã€äº‹åŠ¡ç®¡ç†ã€SQLè¯­å¥æ„é€ ã€æ•°æ®CRUDã€é«˜çº§é€šç”¨ä¸šåŠ¡é€»è¾‘ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚ç”±äºModelä¸Controllerå’ŒViewæ˜¯è§£è€¦çš„ï¼Œå¹¶ä¸”æœ¬èº«å…·å¤‡å¾ˆé«˜çš„é€šç”¨æ€§å’Œå¤æ‚æ€§ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šç‹¬ç«‹çš„å®ç°ã€‚æœ¬æ–‡å¸Œæœ›èƒ½é€šè¿‡å¼€å‘ä¸€ä¸ªç®€å•çš„ActiveRecordï¼ŒéªŒè¯è¿™ç§Modelå®ç°æ–¹æ¡ˆçš„åŸç†å’Œè¿‡ç¨‹ã€‚
ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„ ORMçš„å…¨ç§°æ˜¯Object Relational Mappingï¼Œå³å¯¹è±¡å…³ç³»æ˜ å°„ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³å…³ç³»æ•°æ®åº“çš„æ•°å­¦æ¨¡å‹å’Œç¼–ç¨‹è¯­è¨€çš„å¯¹è±¡æ¨¡å‹ä¹‹é—´çš„é˜»æŠ—ä¸åŒ¹é…é—®é¢˜è€Œæå‡ºçš„è§£å†³æ–¹æ¡ˆã€‚
é˜»æŠ—ä¸åŒ¹é…æ˜¯ä¸ªé€¼æ ¼å¾ˆé«˜çš„è¯ã€‚
é˜»æŠ—æ˜¯æŒ‡ç”µè·¯ä¸­çš„ç”µå®¹ã€ç”µæ„Ÿã€ç”µé˜»å¯¹äº¤æµç”µçš„éšœç¢ä½œç”¨ï¼Œå°±åƒç”µé˜»å¯¹ç›´æµç”µçš„éšœç¢ä½œç”¨ã€‚ä¸¤ä¸ªç³»ç»Ÿä¼ é€’ä¿¡å·å¯ä»¥å½¢è±¡åœ°çœ‹æˆç”µå‹çš„ä¼ é€’ï¼Œå…¬å¼ä¸ºï¼š
U(out) * Z(in)
U(in) = &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
Z(in) + Z(out)
å³è¾“å…¥ç”µå‹ç­‰äºè¾“å‡ºç”µå‹ä¸è¾“å…¥é˜»æŠ—çš„ç§¯é™¤ä»¥è¾“å…¥é˜»æŠ—ä¸è¾“å‡ºé˜»æŠ—çš„å’Œã€‚
ç†æƒ³æƒ…å†µè‚¯å®šæ˜¯è¾“å…¥ç”µå‹ç­‰äºè¾“å‡ºç”µå‹ï¼Œè¿™æ—¶ä¿¡å·æ˜¯æ²¡æœ‰å¤±çœŸçš„ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚Z(in)ä¸Z(in)+Z(out)ä¹‹å•†æ— é™é€¼è¿‘1ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«é˜»æŠ—åŒ¹é…ã€‚å…³ç³»å‹æ•°æ®åº“æ˜¯å»ºç«‹åœ¨æ•°å­¦æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œè€Œç¼–ç¨‹è¯­è¨€ä¸­çš„å¯¹è±¡æ˜¯å»ºç«‹åœ¨äººå¯¹å®¢è§‚ä¸–ç•Œè®¤çŸ¥çš„å…·è±¡æ¨¡å‹ä¸Šã€‚è¯´ç™½äº†ï¼Œé˜»æŠ—ä¸åŒ¹é…é—®é¢˜å°±æ˜¯è¯´å› è¿™ä¸¤ç§æ¨¡å‹ä¸ä¸€è‡´è€Œå¯¼è‡´çš„é—®é¢˜ã€‚
ORMé€šè¿‡å»ºç«‹è¡¨ä¸å¯¹è±¡ã€åˆ—ä¸å±æ€§ï¼ˆè¿™åªæ˜¯ä¸€èˆ¬æƒ…å†µï¼‰ä¹‹é—´çš„æ˜ å°„å…³ç³»è€Œè§£å†³é—®é¢˜ï¼Œè¿™å¯ä»¥å®ç°åƒæ“ä½œå¯¹è±¡ä¸€æ ·å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ã€‚ä¸è¿‡ORMçš„ç¼ºç‚¹æ˜¯ä¸èƒ½å¾ˆå¥½åœ°å¤„ç†å¤æ‚æ•°æ®å…³ç³»ï¼Œä¼šå‡ºç°æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ï¼Œå› æ­¤å¿…è¦æ—¶ä»ç„¶éœ€è¦ç›´æ¥ä½¿ç”¨SQLã€‚
ActiveRecord ActiveRecordæ˜¯Ruby on Railsæå‡ºçš„ä¸€ä¸ªæ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ORMçš„ä¸€ç§å®ç°ï¼Œå®ƒæ˜¯å¯¹è±¡ç±»å‹ã€æ•°æ®ã€CRUDæ–¹æ³•çš„åˆä½“ï¼Œä½¿å¯¹æ•°æ®çš„æ“ä½œä»¥æ›´å…·è±¡åŒ–çš„æ–¹å¼å®ç°ã€‚ä¸‹é¢ä»‹ç»åœ¨Flameworkä¸­å®ç°ä¸€ä¸ªç®€å•çš„ActiveRecordçš„è¿‡ç¨‹ã€‚
é¦–å…ˆå®ç°æ•°æ®åº“çš„æ¥å£ï¼Œæä¾›æ•°æ®åº“è¿æ¥ã€æŸ¥è¯¢ã€æ‰§è¡ŒSQLè¯­å¥ã€äº‹åŠ¡ç®¡ç†ç­‰åŸºæœ¬åŠŸèƒ½ã€‚è¿™é‡Œä½¿ç”¨PDOå®ç°ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 <?"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-93233020-1","auto"),ga("send","pageview"))</script><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#262d33"><title>æ™´è€•é›¨è®€ - PHPæ¡†æ¶å®æˆ˜ï¼ˆäº”ï¼‰ï¼šORMä¸ActiveRecord
</title><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=/minima.1700062286.css><script defer type=text/javascript src=/minima.1700062286.js></script></head><script>let theme_2b_used=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";try{if(!("theme"in localStorage)){const e="";(e==="dark"||e==="light")&&(theme_2b_used=e),localStorage.theme=theme_2b_used}document.querySelector("html").classList.add(localStorage.theme)}catch(e){console.error(e)}</script><body class="sm:mx-5 sm:my-0"><header class="flex justify-between items-center mb-6 sm:my-3"><div class="flex items-center"><div id=theme-switcher class="text-4xl cursor-pointer">ğŸŒš</div></div><nav class="flex items-center
whitespace-nowrap overflow-x-auto overflow-y-hidden"><a class=ml-5 href=/>ä¸»é </a>
<a class=ml-5 href=/posts>æ–‡ç« </a>
<a class=ml-5 href=/tags>æ¨™ç±¤</a>
<a class=ml-5 href=/categories>åˆ†é¡</a>
<a class=ml-5 href=/about>é—œæ–¼</a></nav></header><h1 class="mt-6 mb-6">PHPæ¡†æ¶å®æˆ˜ï¼ˆäº”ï¼‰ï¼šORMä¸ActiveRecord</h1><div class="mb-3 text-xs flex justify-between sm:flex-col"><div>Posted at &mdash; Jan 01, 2014</div><div class=sm:mt-4><a class=not-first:ml-3 href=/tags/PHP>#PHP</a>
<a class=not-first:ml-3 href=/tags/Flamework>#Flamework</a>
<a class=not-first:ml-3 href=/tags/%e6%a1%86%e6%9e%b6>#æ¡†æ¶</a>
<a class=not-first:ml-3 href=/tags/%e7%bc%96%e7%a8%8b>#ç¼–ç¨‹</a></div></div><main><p></p><article class=md><h2 id=ç®€è¿°>ç®€è¿°</h2><p>Modelæ˜¯MVCæ¡†æ¶ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œå®ƒè¦æä¾›ä¸ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„æ•°æ®åŠæ•°æ®å¤„ç†æ–¹æ³•çš„å°è£…ï¼Œä¸€èˆ¬è¦æä¾›æ•°æ®å¯¹è±¡ã€æ•°æ®åº“è¿æ¥ã€äº‹åŠ¡ç®¡ç†ã€SQLè¯­å¥æ„é€ ã€æ•°æ®CRUDã€é«˜çº§é€šç”¨ä¸šåŠ¡é€»è¾‘ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚ç”±äºModelä¸Controllerå’ŒViewæ˜¯è§£è€¦çš„ï¼Œå¹¶ä¸”æœ¬èº«å…·å¤‡å¾ˆé«˜çš„é€šç”¨æ€§å’Œå¤æ‚æ€§ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šç‹¬ç«‹çš„å®ç°ã€‚æœ¬æ–‡å¸Œæœ›èƒ½é€šè¿‡å¼€å‘ä¸€ä¸ªç®€å•çš„ActiveRecordï¼ŒéªŒè¯è¿™ç§Modelå®ç°æ–¹æ¡ˆçš„åŸç†å’Œè¿‡ç¨‹ã€‚</p><h2 id=ormå¯¹è±¡å…³ç³»æ˜ å°„>ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„</h2><p>ORMçš„å…¨ç§°æ˜¯Object Relational Mappingï¼Œå³å¯¹è±¡å…³ç³»æ˜ å°„ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³å…³ç³»æ•°æ®åº“çš„æ•°å­¦æ¨¡å‹å’Œç¼–ç¨‹è¯­è¨€çš„å¯¹è±¡æ¨¡å‹ä¹‹é—´çš„é˜»æŠ—ä¸åŒ¹é…é—®é¢˜è€Œæå‡ºçš„è§£å†³æ–¹æ¡ˆã€‚</p><p>é˜»æŠ—ä¸åŒ¹é…æ˜¯ä¸ªé€¼æ ¼å¾ˆé«˜çš„è¯ã€‚</p><p>é˜»æŠ—æ˜¯æŒ‡ç”µè·¯ä¸­çš„ç”µå®¹ã€ç”µæ„Ÿã€ç”µé˜»å¯¹äº¤æµç”µçš„éšœç¢ä½œç”¨ï¼Œå°±åƒç”µé˜»å¯¹ç›´æµç”µçš„éšœç¢ä½œç”¨ã€‚ä¸¤ä¸ªç³»ç»Ÿä¼ é€’ä¿¡å·å¯ä»¥å½¢è±¡åœ°çœ‹æˆç”µå‹çš„ä¼ é€’ï¼Œå…¬å¼ä¸ºï¼š</p><blockquote><p>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <strong>U</strong>(out) * <strong>Z</strong>(in)<br><strong>U</strong>(in) = &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <strong>Z</strong>(in) + <strong>Z</strong>(out)</p></blockquote><p>å³è¾“å…¥ç”µå‹ç­‰äºè¾“å‡ºç”µå‹ä¸è¾“å…¥é˜»æŠ—çš„ç§¯é™¤ä»¥è¾“å…¥é˜»æŠ—ä¸è¾“å‡ºé˜»æŠ—çš„å’Œã€‚</p><p>ç†æƒ³æƒ…å†µè‚¯å®šæ˜¯è¾“å…¥ç”µå‹ç­‰äºè¾“å‡ºç”µå‹ï¼Œè¿™æ—¶ä¿¡å·æ˜¯æ²¡æœ‰å¤±çœŸçš„ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚Z(in)ä¸Z(in)+Z(out)ä¹‹å•†æ— é™é€¼è¿‘1ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«é˜»æŠ—åŒ¹é…ã€‚å…³ç³»å‹æ•°æ®åº“æ˜¯å»ºç«‹åœ¨æ•°å­¦æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œè€Œç¼–ç¨‹è¯­è¨€ä¸­çš„å¯¹è±¡æ˜¯å»ºç«‹åœ¨äººå¯¹å®¢è§‚ä¸–ç•Œè®¤çŸ¥çš„å…·è±¡æ¨¡å‹ä¸Šã€‚è¯´ç™½äº†ï¼Œé˜»æŠ—ä¸åŒ¹é…é—®é¢˜å°±æ˜¯è¯´å› è¿™ä¸¤ç§æ¨¡å‹ä¸ä¸€è‡´è€Œå¯¼è‡´çš„é—®é¢˜ã€‚</p><p>ORMé€šè¿‡å»ºç«‹è¡¨ä¸å¯¹è±¡ã€åˆ—ä¸å±æ€§ï¼ˆ<em>è¿™åªæ˜¯ä¸€èˆ¬æƒ…å†µ</em>ï¼‰ä¹‹é—´çš„æ˜ å°„å…³ç³»è€Œè§£å†³é—®é¢˜ï¼Œè¿™å¯ä»¥å®ç°åƒæ“ä½œå¯¹è±¡ä¸€æ ·å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ã€‚ä¸è¿‡ORMçš„ç¼ºç‚¹æ˜¯ä¸èƒ½å¾ˆå¥½åœ°å¤„ç†å¤æ‚æ•°æ®å…³ç³»ï¼Œä¼šå‡ºç°æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ï¼Œå› æ­¤å¿…è¦æ—¶ä»ç„¶éœ€è¦ç›´æ¥ä½¿ç”¨SQLã€‚</p><h2 id=activerecord>ActiveRecord</h2><p>ActiveRecordæ˜¯Ruby on Railsæå‡ºçš„ä¸€ä¸ªæ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ORMçš„ä¸€ç§å®ç°ï¼Œå®ƒæ˜¯å¯¹è±¡ç±»å‹ã€æ•°æ®ã€CRUDæ–¹æ³•çš„åˆä½“ï¼Œä½¿å¯¹æ•°æ®çš„æ“ä½œä»¥æ›´å…·è±¡åŒ–çš„æ–¹å¼å®ç°ã€‚ä¸‹é¢ä»‹ç»åœ¨Flameworkä¸­å®ç°ä¸€ä¸ªç®€å•çš„ActiveRecordçš„è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆå®ç°æ•°æ®åº“çš„æ¥å£ï¼Œæä¾›æ•°æ®åº“è¿æ¥ã€æŸ¥è¯¢ã€æ‰§è¡ŒSQLè¯­å¥ã€äº‹åŠ¡ç®¡ç†ç­‰åŸºæœ¬åŠŸèƒ½ã€‚è¿™é‡Œä½¿ç”¨PDOå®ç°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>org\x3f\flamework\base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * Database connection above PDO
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @author Donie Leigh &lt;donie.leigh@gmail.com&gt;
</span></span></span><span class=line><span class=cl><span class=sd> * @link http://0x3f.org
</span></span></span><span class=line><span class=cl><span class=sd> * @copyright Copyright &amp;copy; 2013-2014 Donie Leigh
</span></span></span><span class=line><span class=cl><span class=sd> * @license BSD (3-terms)
</span></span></span><span class=line><span class=cl><span class=sd> * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DBConnection</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var PDO Database connection 
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$_c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array PDO options 
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$_options</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;connection_string&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;sqlite::memory:&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;username&#39;</span> <span class=o>=&gt;</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;password&#39;</span> <span class=o>=&gt;</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;pdo_options&#39;</span> <span class=o>=&gt;</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var PDOStatement Last PDO statement 
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$_lastStmt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$options</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_options</span> <span class=o>=</span> <span class=nx>array_merge</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_options</span><span class=p>,</span> <span class=nv>$options</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Init DB connection
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $dsn DB connection string
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $user DB user name
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $password DB password
</span></span></span><span class=line><span class=cl><span class=sd>     * @param array $options PDO options
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>_connectDB</span><span class=p>(</span><span class=nv>$dsn</span><span class=p>,</span> <span class=nv>$user</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$options</span><span class=o>=</span><span class=k>array</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_c</span> <span class=o>==</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_c</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>\PDO</span><span class=p>(</span><span class=nv>$dsn</span><span class=p>,</span> <span class=nv>$user</span><span class=p>,</span> <span class=nv>$password</span><span class=p>,</span> <span class=nv>$options</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Execute sql statement
</span></span></span><span class=line><span class=cl><span class=sd>     * @param mixed $sql SQL statement or template
</span></span></span><span class=line><span class=cl><span class=sd>     * @param array $params Parameters for SQL template
</span></span></span><span class=line><span class=cl><span class=sd>     * @return bool
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>execute</span><span class=p>(</span><span class=nv>$sql</span><span class=p>,</span> <span class=nv>$params</span><span class=o>=</span><span class=k>array</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_connectDB</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_options</span><span class=p>[</span><span class=s1>&#39;connection_string&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_options</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_options</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_options</span><span class=p>[</span><span class=s1>&#39;driver_options&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$stmt</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_c</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span><span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_lastStmt</span> <span class=o>=</span> <span class=nv>$stmt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>(</span><span class=nv>$params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Fetch rows
</span></span></span><span class=line><span class=cl><span class=sd>     * @return array Associative array holding data rows
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>rows</span><span class=p>(</span><span class=nv>$sql</span><span class=p>,</span> <span class=nv>$params</span><span class=o>=</span><span class=k>array</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>(</span><span class=nv>$sql</span><span class=p>,</span> <span class=nv>$params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$stmt</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getLastStmt</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$rows</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nv>$row</span> <span class=o>=</span> <span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>(</span><span class=nx>\PDO</span><span class=o>::</span><span class=na>FETCH_ASSOC</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$rows</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$rows</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Return the last PDO statement
</span></span></span><span class=line><span class=cl><span class=sd>     * @return PDOStatement
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getLastStmt</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_lastStmt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Begin transaction
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>beginTransaction</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_c</span><span class=o>-&gt;</span><span class=na>beginTransaction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Commit the current transaction
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_c</span><span class=o>-&gt;</span><span class=na>commit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Rollback the current transaction
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_c</span><span class=o>-&gt;</span><span class=na>rollBack</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>ç„¶åå®ç°ActiveRecordç±»ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>org\x3f\flamework\base</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>org\x3f\flamework\Flame</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * Ancestor class for active records
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @abstract
</span></span></span><span class=line><span class=cl><span class=sd> * @author Donie Leigh &lt;donie.leigh@gmail.com&gt;
</span></span></span><span class=line><span class=cl><span class=sd> * @link http://0x3f.org
</span></span></span><span class=line><span class=cl><span class=sd> * @copyright Copyright &amp;copy; 2013-2014 Donie Leigh
</span></span></span><span class=line><span class=cl><span class=sd> * @license BSD (3-terms)
</span></span></span><span class=line><span class=cl><span class=sd> * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>abstract</span> <span class=k>class</span> <span class=nc>ActiveRecord</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array Models 
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=nv>$_models</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array Attributes and values
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$_data</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array Attributes and values which are changed
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$_dirtyData</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var bool Whether this record is a new one 
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$_isNew</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Get model instance
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $className
</span></span></span><span class=line><span class=cl><span class=sd>     * @return ActiveRecord
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>getModel</span><span class=p>(</span><span class=nv>$className</span> <span class=o>=</span> <span class=no>__CLASS__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nx>self</span><span class=o>::</span><span class=nv>$_models</span><span class=p>[</span><span class=nv>$className</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>self</span><span class=o>::</span><span class=nv>$_models</span><span class=p>[</span><span class=nv>$className</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$model</span> <span class=o>=</span> <span class=nx>self</span><span class=o>::</span><span class=nv>$_models</span><span class=p>[</span><span class=nv>$className</span><span class=p>]</span> <span class=o>=</span> <span class=k>new</span> <span class=nv>$className</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nv>$model</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Get table name of this ActiveRecord
</span></span></span><span class=line><span class=cl><span class=sd>     * @return string Table name
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>abstract</span> <span class=k>public</span> <span class=k>function</span> <span class=nf>getTableName</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Get the name of the primary key column
</span></span></span><span class=line><span class=cl><span class=sd>     * @return string Column name
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>abstract</span> <span class=k>public</span> <span class=k>function</span> <span class=nf>getPrimaryKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Magic method for accessing model attributes
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $attr Attribute name
</span></span></span><span class=line><span class=cl><span class=sd>     * @return mixed Attribute value
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__get</span><span class=p>(</span><span class=nv>$attr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>[</span><span class=nv>$attr</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>[</span><span class=nv>$attr</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Magic method for setting attribute value
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $attr Attribute name
</span></span></span><span class=line><span class=cl><span class=sd>     * @param mixed $val Attribute value
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__set</span><span class=p>(</span><span class=nv>$attr</span><span class=p>,</span> <span class=nv>$val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>[</span><span class=nv>$attr</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getIsNew</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_dirtyData</span><span class=p>[</span><span class=nv>$attr</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Magic method for checking if an attribute is set
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $attr Attribute name
</span></span></span><span class=line><span class=cl><span class=sd>     * @return bool
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__isset</span><span class=p>(</span><span class=nv>$attr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>[</span><span class=nv>$attr</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Magic method for unsetting an attribute
</span></span></span><span class=line><span class=cl><span class=sd>     * @param string $attr Attribute name
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__unset</span><span class=p>(</span><span class=nv>$attr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>unset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>[</span><span class=nv>$attr</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Set this record to be $isNew
</span></span></span><span class=line><span class=cl><span class=sd>     * @param bool $isNew
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setIsNew</span><span class=p>(</span><span class=nv>$isNew</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_isNew</span> <span class=o>=</span> <span class=nv>$isNew</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Whether this record is new
</span></span></span><span class=line><span class=cl><span class=sd>     * @return bool
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getIsNew</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_isNew</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Find a record by primary key
</span></span></span><span class=line><span class=cl><span class=sd>     * @param mixed $val Primary key value
</span></span></span><span class=line><span class=cl><span class=sd>     * @return ActiveRecord
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>findByPk</span><span class=p>(</span><span class=nv>$val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;select * from &#34;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getTableName</span><span class=p>()</span><span class=o>.</span><span class=s2>&#34; where &#34;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getPrimaryKey</span><span class=p>()</span><span class=o>.</span><span class=s2>&#34;=?&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$rows</span> <span class=o>=</span> <span class=nx>Flame</span><span class=o>::</span><span class=na>app</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getDBConnection</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>rows</span><span class=p>(</span><span class=nv>$sql</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span><span class=nv>$val</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>count</span><span class=p>(</span><span class=nv>$rows</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>createInstance</span><span class=p>(</span><span class=nv>$rows</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Create an instance with given data
</span></span></span><span class=line><span class=cl><span class=sd>     * @param array $row Associative array
</span></span></span><span class=line><span class=cl><span class=sd>     * @return ActiveRecord
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>createInstance</span><span class=p>(</span><span class=nv>$row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$className</span> <span class=o>=</span> <span class=nx>get_class</span><span class=p>(</span><span class=nv>$this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$instance</span> <span class=o>=</span> <span class=k>new</span> <span class=nv>$className</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$row</span> <span class=k>as</span> <span class=nv>$col</span><span class=o>=&gt;</span><span class=nv>$val</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$instance</span><span class=o>-&gt;</span><span class=nv>$col</span> <span class=o>=</span> <span class=nv>$val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$instance</span><span class=o>-&gt;</span><span class=na>setIsNew</span><span class=p>(</span><span class=k>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Save this record
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>save</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getIsNew</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_insert</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_update</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Save this record into the database as a new row
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>_insert</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>count</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$cols</span> <span class=o>=</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;, &#39;</span><span class=p>,</span> <span class=nx>array_keys</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=nv>$placeHolders</span> <span class=o>=</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;, &#39;</span><span class=p>,</span> <span class=nx>array_fill</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>count</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>),</span> <span class=s1>&#39;?&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;insert into &#34;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getTableName</span><span class=p>()</span><span class=o>.</span> <span class=s2>&#34; (</span><span class=si>$cols</span><span class=s2>) values (</span><span class=si>$placeHolders</span><span class=s2>)&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>Flame</span><span class=o>::</span><span class=na>app</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getDBConnection</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>(</span><span class=nv>$sql</span><span class=p>,</span> <span class=nx>array_values</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_data</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Save this record
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>_update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>count</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_dirtyData</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$pairs</span> <span class=o>=</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;=?, &#39;</span><span class=p>,</span> <span class=nx>array_keys</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_dirtyData</span><span class=p>))</span><span class=o>.</span><span class=s1>&#39;=?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$sql</span> <span class=o>=</span> <span class=s1>&#39;update &#39;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getTableName</span><span class=p>()</span><span class=o>.</span><span class=s2>&#34; set </span><span class=si>$pairs</span><span class=s2> where &#34;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getPrimaryKey</span><span class=p>()</span><span class=o>.</span><span class=s1>&#39;=?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$pk</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getPrimaryKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>Flame</span><span class=o>::</span><span class=na>app</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getDBConnection</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>(</span><span class=nv>$sql</span><span class=p>,</span> <span class=nx>array_merge</span><span class=p>(</span><span class=nx>array_values</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>_dirtyData</span><span class=p>),</span> <span class=k>array</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=nv>$pk</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Delete this record
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     * @since 1.0
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>delete</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getIsNew</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$pk</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getPrimaryKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nv>$sql</span> <span class=o>=</span> <span class=s1>&#39;delete from &#39;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getTableName</span><span class=p>()</span><span class=o>.</span><span class=s2>&#34; where </span><span class=si>$pk</span><span class=s2>=?&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>Flame</span><span class=o>::</span><span class=na>app</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getDBConnection</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>(</span><span class=nv>$sql</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=nv>$pk</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>çº¦å®šï¼Œæ‰€æœ‰å­ç±»éƒ½å¿…é¡»è¦†ç›–å’Œå®ç°getModel()ã€getTableName()ã€getPrimaryKey()è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚getModel()è¿”å›ä¸åŒ…å«å…·ä½“æ•°æ®çš„ActiveRecordå®ä¾‹ï¼Œç”¨äºæ‰§è¡Œå¯¹è±¡ç±»å‹èŒƒç•´çš„æ“ä½œï¼Œä¾‹å¦‚æŸ¥è¯¢ç¬¦åˆç‰¹å®šæ¡ä»¶çš„å¯¹è±¡ã€‚åœ¨åŒ…å«å…·ä½“æ•°æ®çš„ActiveRecordå®ä¾‹ä¸­æ‰§è¡Œé’ˆå¯¹è¯¥å…·ä½“å¯¹è±¡çš„æ“ä½œï¼Œä¾‹å¦‚ä¿å­˜å’Œåˆ é™¤ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°åŒºåˆ†ActiveRecordçš„å±æ€§å’Œå¯¹è±¡æ•°æ®ï¼Œè¿™é‡Œå°†å¯¹è±¡æ•°æ®å­˜æ”¾åœ¨å…³è”æ•°ç»„ActiveRecord::$_dataé‡Œï¼Œç„¶åä½¿ç”¨__get()ã€__set()ç­‰é­”æœ¯æ–¹æ³•å®ç°åƒä½¿ç”¨ActiveRecordè‡ªèº«å±æ€§ä¸€æ ·ä½¿ç”¨å¯¹è±¡æ•°æ®ã€‚</p><p>åœ¨æ›´æ–°å¯¹è±¡æ—¶ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œåº”è¯¥åªæ›´æ–°è¢«ä¿®æ”¹è¿‡çš„åˆ—ã€‚è¿™é‡Œå€ŸåŠ©é­”æœ¯æ–¹æ³•__set()ï¼Œå®ç°å‘å¯¹è±¡å±æ€§èµ‹å€¼æ—¶å°†è¢«ä¿®æ”¹çš„å±æ€§å’Œå€¼æ·»åŠ åˆ°å…³è”æ•°ç»„ActiveRecord::$_dirtyDataä¸­ã€‚æœ€åæ„é€ updateè¯­å¥æ—¶ï¼Œä»è¯¥æ•°ç»„ä¸­å–å€¼å³å¯ã€‚</p><h2 id=activerecordçš„ä½¿ç”¨>ActiveRecordçš„ä½¿ç”¨</h2><p>åœ¨Demoé¡¹ç›®ä¸­å®ç°ä¸€ä¸ªå¯¹è±¡ï¼Œç»§æ‰¿ActiveRecordï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>org\x3f\flamedemo\model</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>org\x3f\flamework\base\ActiveRecord</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Post</span> <span class=k>extends</span> <span class=nx>ActiveRecord</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>getModel</span><span class=p>(</span><span class=nv>$className</span><span class=o>=</span><span class=no>__CLASS__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>parent</span><span class=o>::</span><span class=na>getModel</span><span class=p>(</span><span class=nv>$className</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getTableName</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;post&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getPrimaryKey</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;id&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>ç”¨æ³•å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=c1>// æ ¹æ®IDæŸ¥è¯¢å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$p</span> <span class=o>=</span> <span class=nx>Post</span><span class=o>::</span><span class=na>getModel</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>findByPk</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ›´æ–°å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$p</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Post</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>setIsNew</span><span class=p>(</span><span class=k>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>id</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>title</span> <span class=o>=</span> <span class=s1>&#39;bad name 2&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ é™¤å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$p</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Post</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>setIsNew</span><span class=p>(</span><span class=k>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>id</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>delete</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“</h2><p>ORMçš„æ ¹æœ¬ä»»åŠ¡æ˜¯è§£å†³å…³ç³»æ¨¡å‹ä¸å¯¹è±¡æ¨¡å‹çš„é˜»æŠ—ä¸åŒ¹é…é—®é¢˜ã€‚è€ŒActiveRecordæ˜¯æ—¶ä¸‹å¾ˆæµè¡Œçš„ä¸€ç§ORMçš„å®ç°æ–¹å¼ã€‚åœ¨å¯¹ActiveRecordçš„å®ç°ä¸­ä½¿ç”¨äº†PDOï¼Œè¿™æ˜¯PHP 5.1å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªè½»é‡çš„æ•°æ®è®¿é—®æŠ½è±¡å±‚ï¼Œç›¸æ¯”ä»¥å‰é’ˆå¯¹æ¯ç§æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„å‡½æ•°é›†çš„æ–¹å¼ï¼Œå®ƒä½¿PHPçš„æ•°æ®åº“æ“ä½œå˜å¾—æ›´ç®€å•ã€‚æ­¤å¤–ï¼Œé­”æœ¯æ–¹æ³•çš„ä½¿ç”¨ç®€åŒ–äº†ä»£ç ï¼Œä½¿æ•°æ®æ“ä½œå˜å¾—æ›´çµæ´»ã€‚</p><p>æœ¬æ–‡åªå®ç°äº†ä¸€ä¸ªæœ€åŸºæœ¬çš„ActiveRecordï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œè¿˜è¦åŒ…å«SQLè¯­å¥æ„é€ ç­‰å¤æ‚çš„é€»è¾‘ï¼Œä¸è¿‡åªè¦å¼„æ¸…æ¥šäº†æ ¸å¿ƒåŸç†å’Œå®ç°æ–¹å¼ï¼Œå…¶å®ƒä¹Ÿå°±æ°´åˆ°æ¸ æˆäº†ã€‚</p></article></main><script>const repo="xbot/blog-comments",issueTerm="pathname",theme=localStorage.theme?`github-${localStorage.theme}`:"preferred-color-scheme",script=document.createElement("script");script.src="https://utteranc.es/client.js",script.async=!0,script.crossOrigin="anonymous",script.setAttribute("repo",repo),script.setAttribute("issue-term",issueTerm),script.setAttribute("theme",theme),script.setAttribute("label","comment"),document.querySelector("main").appendChild(script)</script><footer class="mt-8 flex sm:flex-col-reverse justify-between items-center"><p class="mt-0 text-sm">Â© æ·˜æ°” 2022 |
<a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> on
<a href=https://github.com/mivinci/hugo-theme-minima target=_blank rel="noopener noreferrer">Minima</a></p><p class="flex items-center mt-0"><a class="icon mx-2" href=https://github.com/xbot title=github><svg fill="#63636f" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="icon mx-2" href=/index.xml title=rss><svg fill="#63636f" t="1626591563876" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1984" width="18" height="16"><path d="M128 768a128 128 0 100 256 128 128 0 000-256zM0 368v176c265.104.0 480 214.912 480 480h176c0-362.32-293.696-656-656-656zM0 0v176c468.336.0 848 379.664 848 848h176C1024 458.464 565.536.0.0.0z" p-id="1985"/></svg></a></p></footer></body></html>