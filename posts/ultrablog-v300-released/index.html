<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="http://0x3f.org/posts/ultrablog-v300-released/"><meta property="og:site_name" content="æ™´è€•é›¨è®€"><meta property="og:title" content="UltraBlog.vim v3.0é‡Šå‡ºï¼šå…¨æ–‡æ£€ç´¢ä¸äº‹ä»¶é©±åŠ¨"><meta property="og:description" content="ç”¨äº†ä¸€å‘¨çš„ä¸šä½™æ—¶é—´ï¼Œæ˜¨å¤©æˆ‘é‡Šå‡ºäº†UltraBlog.vimçš„3.0ç‰ˆã€‚æ–°ç‰ˆæœ¬ä¸»è¦åŠ å…¥äº†å…¨æ–‡æ£€ç´¢çš„åŠŸèƒ½ï¼Œå¹¶å¼•å…¥äº‹ä»¶é©±åŠ¨çš„æ¨¡å¼ã€‚
å…¨æ–‡æ£€ç´¢æ˜¯æˆ‘è“„è°‹å·²ä¹…çš„åŠŸèƒ½ï¼Œä¸€ä¸ªä¸èƒ½æœç´¢çš„åšå®¢å®¢æˆ·ç«¯çš„ç®¡ç†åŠŸèƒ½æ˜¯å¤§æ‰“æŠ˜æ‰£çš„ã€‚å¾—ç›ŠäºSQLiteæ•°æ®åº“å’ŒSQLAlchemyæ¡†æ¶ï¼Œå…¨æ–‡æ£€ç´¢çš„å®ç°æ˜¯å¾ˆç®€å•çš„ï¼Œæ–°å¢åŠ çš„:UBFindå‘½ä»¤å°†åœ¨æ‰€æœ‰æ–‡ç« å’Œé¡µé¢çš„æ ‡é¢˜ä¸å†…å®¹ä¸­æŸ¥è¯¢ï¼Œå¹¶å°†æœç´¢ç»“æœæ˜¾ç¤ºåœ¨ä¸€ä¸ªå¯åˆ†é¡µçš„åˆ—è¡¨ä¸­ã€‚è¿™ä¸ªå‘½ä»¤æ”¯æŒä»»æ„å¤šä¸ªå…³é”®è¯ï¼Œå„å…³é”®è¯ä¹‹é—´éµå¾ªä¸çš„å…³ç³»ã€‚æ­¤å¤–ï¼Œæ£€ç´¢ç»“æœä¸­ï¼Œæ‰€æœ‰çš„å…³é”®è¯å°†è¢«è‡ªåŠ¨æ ‡è®°ä¸ºé«˜äº®ã€‚
äº‹ä»¶é©±åŠ¨æ¨¡å¼çš„å¼•å…¥æ˜¯æˆ‘æ‚ç„¶å°†ç‰ˆæœ¬å·è·³è·ƒåˆ°3.xçš„ä¸»è¦åŸå› ã€‚
åœ¨å‰å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘å®ç°äº†å¯¹å¤šçª—å£çš„æ”¯æŒï¼Œå®ƒä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨æ–°çª—å£ä¸­æ‰“å¼€åˆ—è¡¨ä¸­çš„æ–‡ç« ã€‚ä½†UltraBlog.vimæœ€åˆå¼€å‘çš„æ—¶å€™å¹¶æ²¡æœ‰è€ƒè™‘åˆ°å¤šçª—å£çš„é—®é¢˜ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½åªé’ˆå¯¹å½“å‰çª—å£è¿›è¡Œæ“ä½œã€‚è¿™å°±æœ‰äº†ç¼“å†²åŒºå†…å®¹åŒæ­¥çš„é—®é¢˜ï¼Œå‡å¦‚åœ¨ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºä¸­æ‰“å¼€äº†å’Œå¦ä¸€ä¸ªç¼“å†²åŒºç›¸åŒçš„æ–‡ç« ï¼Œåˆ™ä¸€ä¸ªç¼“å†²åŒºå†…å®¹çš„æ”¹å˜ä¸ä¼šåŒæ­¥åˆ°å¦å¤–ä¸€ä¸ªä¸­ï¼Œè¿™å¤šå°‘æ˜¯æœ‰äº›éšæ‚£çš„ã€‚
æœ€ç›´æ¥çš„åšæ³•æ˜¯åœ¨æ‰€æœ‰å¯èƒ½æ”¹å˜ç¼“å†²åŒºå†…å®¹çš„åŠŸèƒ½ä¸­åŠ å…¥å¯¹å…¶å®ƒç¼“å†²åŒºçš„å¤„ç†ï¼Œä½†è¿™æ ·åšæœ‰ä¸å°‘é—®é¢˜ï¼š
ä»£ç è€¦åˆåº¦å¤ªé«˜ï¼Œè¿åK.I.S.SåŸåˆ™ï¼Œä¸åˆ©äºä»Šåçš„å¼€å‘å’Œç»´æŠ¤ å‡½æ•°ä½“è¿‡é•¿ï¼Œæˆ‘è®¨åŒéš¾çœ‹çš„ä»£ç  ä»£ç å†—ä½™ï¼Œé‡å¤åŠ³åŠ¨ äº‹ä»¶é©±åŠ¨æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œä¸€ä¸ªå‡½æ•°åªå¹²ä¸€ä»¶äº‹ï¼Œåšå®Œåä¸€ä¸ªäº‹ä»¶æŠ›å‡ºå»ï¼Œè‡³äºè¿å¸¦è‘—è¦åšä»€ä¹ˆï¼Œè°ç›‘å¬è¿™ä¸ªäº‹ä»¶è°å»å¤„ç†ï¼Œä»£ç çš„è€¦åˆåº¦å¾ˆä½ï¼Œå¤ç”¨åº¦å¾ˆé«˜ï¼Œæ˜“äºç»´æŠ¤å’Œé˜…è¯»ã€‚
UltraBlog.vimå¼•å…¥äº‹ä»¶é©±åŠ¨æ¨¡å¼å¤„ç†ç¼“å†²åŒºåŒæ­¥çš„é—®é¢˜ã€‚ä¸åŒçš„æ“ä½œæŠ›å‡ºä¸åŒçš„äº‹ä»¶ï¼Œæ‰€æœ‰çš„äº‹ä»¶ç»§æ‰¿è‡ªçˆ¶ç±»UBEventï¼š
```python class UBEvent: def __init__(self, srcObj): self.srcObj = srcObj class UBDebugEvent(UBEvent): pass class UBTmplDelEvent(UBEvent): pass class UBTmplSaveEvent(UBEvent): pass class UBLocalPostDelEvent(UBEvent): pass class UBRemotePostDelEvent(UBEvent): pass class UBPostSendEvent(UBEvent): pass class UBPostSaveEvent(UBEvent): pass ``` ä¸€ä¸ªå¯èƒ½æ”¹å˜ç¼“å†²åŒºå†…å®¹çš„æ“ä½œæ‰§è¡Œå®Œåï¼Œåˆ›å»ºä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶å¹¶å°†å…¶åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚äº‹ä»¶é˜Ÿåˆ—ç±»ä¸­å­˜æ”¾ä¸¤ä¸ªåˆ—è¡¨ï¼Œä¸€æ˜¯äº‹ä»¶é˜Ÿåˆ—ï¼ŒäºŒæ˜¯äº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨ï¼›æä¾›ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨æ¥æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ã€å¯¹äº‹ä»¶æ‰§è¡Œå…¥é˜Ÿåˆ—æ“ä½œå’Œå¤„ç†é˜Ÿåˆ—ä¸­æ‰€æœ‰äº‹ä»¶ï¼š
```python class UBEventQueue: queue = [] listeners = [] @classmethod def fireEvent(cls, evt): cls.queue.append(evt) @classmethod def processEvents(cls): for evt in cls.queue: for listener in cls.listeners: if listener.isTarget(evt): cls.queue.remove(evt) listener.processEvent(evt) @classmethod def registerListener(cls, lsnr): cls.listeners.append(lsnr) ``` äº‹ä»¶é˜Ÿåˆ—å¯¹äº‹ä»¶çš„å¤„ç†æ˜¯é€šè¿‡äº‹ä»¶ç›‘å¬å™¨è¿›è¡Œçš„ï¼Œæ¯ä¸ªäº‹ä»¶ç›‘å¬å™¨è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼šè¯†åˆ«ç›‘å¬å¯¹è±¡å’Œå¤„ç†ç›‘å¬å¯¹è±¡ã€‚æ‰€æœ‰å…·ä½“äº‹ä»¶çš„ç›‘å¬ç±»éƒ½æ˜¯UBListenerçš„å­ç±»ï¼š"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2011-07-25T00:00:00+00:00"><meta property="article:modified_time" content="2011-07-25T00:00:00+00:00"><meta property="article:tag" content="Plugin"><meta property="article:tag" content="Python"><meta property="article:tag" content="UltraBlog.vim"><meta property="article:tag" content="Vim"><meta property="article:tag" content="åšå®¢"><meta property="article:tag" content="ç¼–ç¨‹"><meta name=twitter:card content="summary"><meta name=twitter:title content="UltraBlog.vim v3.0é‡Šå‡ºï¼šå…¨æ–‡æ£€ç´¢ä¸äº‹ä»¶é©±åŠ¨"><meta name=twitter:description content="ç”¨äº†ä¸€å‘¨çš„ä¸šä½™æ—¶é—´ï¼Œæ˜¨å¤©æˆ‘é‡Šå‡ºäº†UltraBlog.vimçš„3.0ç‰ˆã€‚æ–°ç‰ˆæœ¬ä¸»è¦åŠ å…¥äº†å…¨æ–‡æ£€ç´¢çš„åŠŸèƒ½ï¼Œå¹¶å¼•å…¥äº‹ä»¶é©±åŠ¨çš„æ¨¡å¼ã€‚
å…¨æ–‡æ£€ç´¢æ˜¯æˆ‘è“„è°‹å·²ä¹…çš„åŠŸèƒ½ï¼Œä¸€ä¸ªä¸èƒ½æœç´¢çš„åšå®¢å®¢æˆ·ç«¯çš„ç®¡ç†åŠŸèƒ½æ˜¯å¤§æ‰“æŠ˜æ‰£çš„ã€‚å¾—ç›ŠäºSQLiteæ•°æ®åº“å’ŒSQLAlchemyæ¡†æ¶ï¼Œå…¨æ–‡æ£€ç´¢çš„å®ç°æ˜¯å¾ˆç®€å•çš„ï¼Œæ–°å¢åŠ çš„:UBFindå‘½ä»¤å°†åœ¨æ‰€æœ‰æ–‡ç« å’Œé¡µé¢çš„æ ‡é¢˜ä¸å†…å®¹ä¸­æŸ¥è¯¢ï¼Œå¹¶å°†æœç´¢ç»“æœæ˜¾ç¤ºåœ¨ä¸€ä¸ªå¯åˆ†é¡µçš„åˆ—è¡¨ä¸­ã€‚è¿™ä¸ªå‘½ä»¤æ”¯æŒä»»æ„å¤šä¸ªå…³é”®è¯ï¼Œå„å…³é”®è¯ä¹‹é—´éµå¾ªä¸çš„å…³ç³»ã€‚æ­¤å¤–ï¼Œæ£€ç´¢ç»“æœä¸­ï¼Œæ‰€æœ‰çš„å…³é”®è¯å°†è¢«è‡ªåŠ¨æ ‡è®°ä¸ºé«˜äº®ã€‚
äº‹ä»¶é©±åŠ¨æ¨¡å¼çš„å¼•å…¥æ˜¯æˆ‘æ‚ç„¶å°†ç‰ˆæœ¬å·è·³è·ƒåˆ°3.xçš„ä¸»è¦åŸå› ã€‚
åœ¨å‰å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘å®ç°äº†å¯¹å¤šçª—å£çš„æ”¯æŒï¼Œå®ƒä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨æ–°çª—å£ä¸­æ‰“å¼€åˆ—è¡¨ä¸­çš„æ–‡ç« ã€‚ä½†UltraBlog.vimæœ€åˆå¼€å‘çš„æ—¶å€™å¹¶æ²¡æœ‰è€ƒè™‘åˆ°å¤šçª—å£çš„é—®é¢˜ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½åªé’ˆå¯¹å½“å‰çª—å£è¿›è¡Œæ“ä½œã€‚è¿™å°±æœ‰äº†ç¼“å†²åŒºå†…å®¹åŒæ­¥çš„é—®é¢˜ï¼Œå‡å¦‚åœ¨ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºä¸­æ‰“å¼€äº†å’Œå¦ä¸€ä¸ªç¼“å†²åŒºç›¸åŒçš„æ–‡ç« ï¼Œåˆ™ä¸€ä¸ªç¼“å†²åŒºå†…å®¹çš„æ”¹å˜ä¸ä¼šåŒæ­¥åˆ°å¦å¤–ä¸€ä¸ªä¸­ï¼Œè¿™å¤šå°‘æ˜¯æœ‰äº›éšæ‚£çš„ã€‚
æœ€ç›´æ¥çš„åšæ³•æ˜¯åœ¨æ‰€æœ‰å¯èƒ½æ”¹å˜ç¼“å†²åŒºå†…å®¹çš„åŠŸèƒ½ä¸­åŠ å…¥å¯¹å…¶å®ƒç¼“å†²åŒºçš„å¤„ç†ï¼Œä½†è¿™æ ·åšæœ‰ä¸å°‘é—®é¢˜ï¼š
ä»£ç è€¦åˆåº¦å¤ªé«˜ï¼Œè¿åK.I.S.SåŸåˆ™ï¼Œä¸åˆ©äºä»Šåçš„å¼€å‘å’Œç»´æŠ¤ å‡½æ•°ä½“è¿‡é•¿ï¼Œæˆ‘è®¨åŒéš¾çœ‹çš„ä»£ç  ä»£ç å†—ä½™ï¼Œé‡å¤åŠ³åŠ¨ äº‹ä»¶é©±åŠ¨æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œä¸€ä¸ªå‡½æ•°åªå¹²ä¸€ä»¶äº‹ï¼Œåšå®Œåä¸€ä¸ªäº‹ä»¶æŠ›å‡ºå»ï¼Œè‡³äºè¿å¸¦è‘—è¦åšä»€ä¹ˆï¼Œè°ç›‘å¬è¿™ä¸ªäº‹ä»¶è°å»å¤„ç†ï¼Œä»£ç çš„è€¦åˆåº¦å¾ˆä½ï¼Œå¤ç”¨åº¦å¾ˆé«˜ï¼Œæ˜“äºç»´æŠ¤å’Œé˜…è¯»ã€‚
UltraBlog.vimå¼•å…¥äº‹ä»¶é©±åŠ¨æ¨¡å¼å¤„ç†ç¼“å†²åŒºåŒæ­¥çš„é—®é¢˜ã€‚ä¸åŒçš„æ“ä½œæŠ›å‡ºä¸åŒçš„äº‹ä»¶ï¼Œæ‰€æœ‰çš„äº‹ä»¶ç»§æ‰¿è‡ªçˆ¶ç±»UBEventï¼š
```python class UBEvent: def __init__(self, srcObj): self.srcObj = srcObj class UBDebugEvent(UBEvent): pass class UBTmplDelEvent(UBEvent): pass class UBTmplSaveEvent(UBEvent): pass class UBLocalPostDelEvent(UBEvent): pass class UBRemotePostDelEvent(UBEvent): pass class UBPostSendEvent(UBEvent): pass class UBPostSaveEvent(UBEvent): pass ``` ä¸€ä¸ªå¯èƒ½æ”¹å˜ç¼“å†²åŒºå†…å®¹çš„æ“ä½œæ‰§è¡Œå®Œåï¼Œåˆ›å»ºä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶å¹¶å°†å…¶åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚äº‹ä»¶é˜Ÿåˆ—ç±»ä¸­å­˜æ”¾ä¸¤ä¸ªåˆ—è¡¨ï¼Œä¸€æ˜¯äº‹ä»¶é˜Ÿåˆ—ï¼ŒäºŒæ˜¯äº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨ï¼›æä¾›ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨æ¥æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ã€å¯¹äº‹ä»¶æ‰§è¡Œå…¥é˜Ÿåˆ—æ“ä½œå’Œå¤„ç†é˜Ÿåˆ—ä¸­æ‰€æœ‰äº‹ä»¶ï¼š
```python class UBEventQueue: queue = [] listeners = [] @classmethod def fireEvent(cls, evt): cls.queue.append(evt) @classmethod def processEvents(cls): for evt in cls.queue: for listener in cls.listeners: if listener.isTarget(evt): cls.queue.remove(evt) listener.processEvent(evt) @classmethod def registerListener(cls, lsnr): cls.listeners.append(lsnr) ``` äº‹ä»¶é˜Ÿåˆ—å¯¹äº‹ä»¶çš„å¤„ç†æ˜¯é€šè¿‡äº‹ä»¶ç›‘å¬å™¨è¿›è¡Œçš„ï¼Œæ¯ä¸ªäº‹ä»¶ç›‘å¬å™¨è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼šè¯†åˆ«ç›‘å¬å¯¹è±¡å’Œå¤„ç†ç›‘å¬å¯¹è±¡ã€‚æ‰€æœ‰å…·ä½“äº‹ä»¶çš„ç›‘å¬ç±»éƒ½æ˜¯UBListenerçš„å­ç±»ï¼š"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#181818"><title>æ™´è€•é›¨è®€ - UltraBlog.vim v3.0é‡Šå‡ºï¼šå…¨æ–‡æ£€ç´¢ä¸äº‹ä»¶é©±åŠ¨
</title><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/minima.91848781a7679600f0ad1ad577e7da4fbb28b9f3fdc9a82126197659405bb483.css integrity="sha256-kYSHgadnlgDwrRrVd+faT7soufP9yaghJhl2WUBbtIM="><script defer type=text/javascript src=/minima.6d7cfeceee442a7e274c8b2407accf5def5708ff479e73813905d798838f75d9.js integrity="sha256-bXz+zu5EKn4nTIskB6zPXe9XCP9HnnOBOQXXmIOPddk="></script></head><script>const theme_config="system",theme_light=theme_config==="system"?"light":theme_config;let theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":theme_light;console.debug(theme);try{localStorage.setItem("theme",theme),window.minima_theme=theme,document.querySelector("html").classList.add(theme)}catch(e){console.error(e)}</script><body><header class="mt-3 mb-8"><div class="container mx-auto"><nav class="flex justify-between items-center"><div class="flex items-center"><div id=theme-switch class="text-2xl cursor-pointer">ğŸŒ</div></div><ul class="flex items-center text-base font-semibold
whitespace-nowrap overflow-x-auto overflow-y-hidden"><li class="ml-2 mr-2"><a href=/>é¦–é¡µ</a></li><li class="ml-2 mr-2"><a href=/posts>æ–‡ç« </a></li><li class="ml-2 mr-2"><a href=/tags>æ ‡ç­¾</a></li><li class="ml-2 mr-2"><a href=/categories>åˆ†ç±»</a></li><li class="ml-2 mr-2"><a href=/about>å…³äº</a></li><li class="ml-2 mr-2"><a href=/search>ğŸ”</a></li></ul></nav></div></header><div class="container mx-auto"><h1 class="text-4xl font-extrabold mt-6 mb-6">UltraBlog.vim v3.0é‡Šå‡ºï¼šå…¨æ–‡æ£€ç´¢ä¸äº‹ä»¶é©±åŠ¨</h1><div class="mb-3 text-sm flex justify-between"><div>å‘å¸ƒäº &mdash; 2011 å¹´ 07 æœˆ 25 æ—¥</div><div><a class=ml-1 href=/tags/Plugin>#Plugin</a>
<a class=ml-1 href=/tags/Python>#Python</a>
<a class=ml-1 href=/tags/UltraBlog.vim>#UltraBlog.vim</a>
<a class=ml-1 href=/tags/Vim>#Vim</a>
<a class=ml-1 href=/tags/%e5%8d%9a%e5%ae%a2>#åšå®¢</a>
<a class=ml-1 href=/tags/%e7%bc%96%e7%a8%8b>#ç¼–ç¨‹</a></div></div><main class=mb-8><p></p><article class=md><p>ç”¨äº†ä¸€å‘¨çš„ä¸šä½™æ—¶é—´ï¼Œæ˜¨å¤©æˆ‘é‡Šå‡ºäº†<a href=http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/>UltraBlog.vim</a>çš„3.0ç‰ˆã€‚æ–°ç‰ˆæœ¬ä¸»è¦åŠ å…¥äº†å…¨æ–‡æ£€ç´¢çš„åŠŸèƒ½ï¼Œå¹¶å¼•å…¥äº‹ä»¶é©±åŠ¨çš„æ¨¡å¼ã€‚</p><p>å…¨æ–‡æ£€ç´¢æ˜¯æˆ‘è“„è°‹å·²ä¹…çš„åŠŸèƒ½ï¼Œä¸€ä¸ªä¸èƒ½æœç´¢çš„åšå®¢å®¢æˆ·ç«¯çš„ç®¡ç†åŠŸèƒ½æ˜¯å¤§æ‰“æŠ˜æ‰£çš„ã€‚å¾—ç›ŠäºSQLiteæ•°æ®åº“å’ŒSQLAlchemyæ¡†æ¶ï¼Œå…¨æ–‡æ£€ç´¢çš„å®ç°æ˜¯å¾ˆç®€å•çš„ï¼Œæ–°å¢åŠ çš„<code>:UBFind</code>å‘½ä»¤å°†åœ¨æ‰€æœ‰æ–‡ç« å’Œé¡µé¢çš„æ ‡é¢˜ä¸å†…å®¹ä¸­æŸ¥è¯¢ï¼Œå¹¶å°†æœç´¢ç»“æœæ˜¾ç¤ºåœ¨ä¸€ä¸ªå¯åˆ†é¡µçš„åˆ—è¡¨ä¸­ã€‚è¿™ä¸ªå‘½ä»¤æ”¯æŒä»»æ„å¤šä¸ªå…³é”®è¯ï¼Œå„å…³é”®è¯ä¹‹é—´éµå¾ªä¸çš„å…³ç³»ã€‚æ­¤å¤–ï¼Œæ£€ç´¢ç»“æœä¸­ï¼Œæ‰€æœ‰çš„å…³é”®è¯å°†è¢«è‡ªåŠ¨æ ‡è®°ä¸ºé«˜äº®ã€‚</p><p>äº‹ä»¶é©±åŠ¨æ¨¡å¼çš„å¼•å…¥æ˜¯æˆ‘æ‚ç„¶å°†ç‰ˆæœ¬å·è·³è·ƒåˆ°3.xçš„ä¸»è¦åŸå› ã€‚</p><p>åœ¨å‰å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘å®ç°äº†å¯¹å¤šçª—å£çš„æ”¯æŒï¼Œå®ƒä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨æ–°çª—å£ä¸­æ‰“å¼€åˆ—è¡¨ä¸­çš„æ–‡ç« ã€‚ä½†UltraBlog.vimæœ€åˆå¼€å‘çš„æ—¶å€™å¹¶æ²¡æœ‰è€ƒè™‘åˆ°å¤šçª—å£çš„é—®é¢˜ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½åªé’ˆå¯¹å½“å‰çª—å£è¿›è¡Œæ“ä½œã€‚è¿™å°±æœ‰äº†ç¼“å†²åŒºå†…å®¹åŒæ­¥çš„é—®é¢˜ï¼Œå‡å¦‚åœ¨ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºä¸­æ‰“å¼€äº†å’Œå¦ä¸€ä¸ªç¼“å†²åŒºç›¸åŒçš„æ–‡ç« ï¼Œåˆ™ä¸€ä¸ªç¼“å†²åŒºå†…å®¹çš„æ”¹å˜ä¸ä¼šåŒæ­¥åˆ°å¦å¤–ä¸€ä¸ªä¸­ï¼Œè¿™å¤šå°‘æ˜¯æœ‰äº›éšæ‚£çš„ã€‚</p><p>æœ€ç›´æ¥çš„åšæ³•æ˜¯åœ¨æ‰€æœ‰å¯èƒ½æ”¹å˜ç¼“å†²åŒºå†…å®¹çš„åŠŸèƒ½ä¸­åŠ å…¥å¯¹å…¶å®ƒç¼“å†²åŒºçš„å¤„ç†ï¼Œä½†è¿™æ ·åšæœ‰ä¸å°‘é—®é¢˜ï¼š</p><ul><li>ä»£ç è€¦åˆåº¦å¤ªé«˜ï¼Œè¿åK.I.S.SåŸåˆ™ï¼Œä¸åˆ©äºä»Šåçš„å¼€å‘å’Œç»´æŠ¤</li><li>å‡½æ•°ä½“è¿‡é•¿ï¼Œæˆ‘è®¨åŒéš¾çœ‹çš„ä»£ç </li><li>ä»£ç å†—ä½™ï¼Œé‡å¤åŠ³åŠ¨</li></ul><p>äº‹ä»¶é©±åŠ¨æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œä¸€ä¸ªå‡½æ•°åªå¹²ä¸€ä»¶äº‹ï¼Œåšå®Œåä¸€ä¸ªäº‹ä»¶æŠ›å‡ºå»ï¼Œè‡³äºè¿å¸¦è‘—è¦åšä»€ä¹ˆï¼Œè°ç›‘å¬è¿™ä¸ªäº‹ä»¶è°å»å¤„ç†ï¼Œä»£ç çš„è€¦åˆåº¦å¾ˆä½ï¼Œå¤ç”¨åº¦å¾ˆé«˜ï¼Œæ˜“äºç»´æŠ¤å’Œé˜…è¯»ã€‚</p><p>UltraBlog.vimå¼•å…¥äº‹ä»¶é©±åŠ¨æ¨¡å¼å¤„ç†ç¼“å†²åŒºåŒæ­¥çš„é—®é¢˜ã€‚ä¸åŒçš„æ“ä½œæŠ›å‡ºä¸åŒçš„äº‹ä»¶ï¼Œæ‰€æœ‰çš„äº‹ä»¶ç»§æ‰¿è‡ªçˆ¶ç±»<strong>UBEvent</strong>ï¼š</p>```python
class UBEvent:
def __init__(self, srcObj):
self.srcObj = srcObj
class UBDebugEvent(UBEvent): pass
class UBTmplDelEvent(UBEvent): pass
class UBTmplSaveEvent(UBEvent): pass
class UBLocalPostDelEvent(UBEvent): pass
class UBRemotePostDelEvent(UBEvent): pass
class UBPostSendEvent(UBEvent): pass
class UBPostSaveEvent(UBEvent): pass
```<p>ä¸€ä¸ªå¯èƒ½æ”¹å˜ç¼“å†²åŒºå†…å®¹çš„æ“ä½œæ‰§è¡Œå®Œåï¼Œåˆ›å»ºä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶å¹¶å°†å…¶åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚äº‹ä»¶é˜Ÿåˆ—ç±»ä¸­å­˜æ”¾ä¸¤ä¸ªåˆ—è¡¨ï¼Œä¸€æ˜¯äº‹ä»¶é˜Ÿåˆ—ï¼ŒäºŒæ˜¯äº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨ï¼›æä¾›ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨æ¥æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ã€å¯¹äº‹ä»¶æ‰§è¡Œå…¥é˜Ÿåˆ—æ“ä½œå’Œå¤„ç†é˜Ÿåˆ—ä¸­æ‰€æœ‰äº‹ä»¶ï¼š</p>```python
class UBEventQueue:
queue = []
listeners = []
@classmethod
def fireEvent(cls, evt):
cls.queue.append(evt)
@classmethod
def processEvents(cls):
for evt in cls.queue:
for listener in cls.listeners:
if listener.isTarget(evt):
cls.queue.remove(evt)
listener.processEvent(evt)
@classmethod
def registerListener(cls, lsnr):
cls.listeners.append(lsnr)
```<p>äº‹ä»¶é˜Ÿåˆ—å¯¹äº‹ä»¶çš„å¤„ç†æ˜¯é€šè¿‡äº‹ä»¶ç›‘å¬å™¨è¿›è¡Œçš„ï¼Œæ¯ä¸ªäº‹ä»¶ç›‘å¬å™¨è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼šè¯†åˆ«ç›‘å¬å¯¹è±¡å’Œå¤„ç†ç›‘å¬å¯¹è±¡ã€‚æ‰€æœ‰å…·ä½“äº‹ä»¶çš„ç›‘å¬ç±»éƒ½æ˜¯<strong>UBListener</strong>çš„å­ç±»ï¼š</p>```python
class UBListener():
''' Parent class of all listeners
'''
eventType = None
@classmethod
def isTarget(cls, evt):
return isinstance(evt, cls.eventType)
@staticmethod
def processEvent(evt): pass
class UBPostSaveListener(UBListener):
''' Listener for saving posts/pages
1. Refresh the current view if it is an edit/list view of this post
2. Mark all edit/list views of posts/pages outdated
'''
eventType = UBPostSaveEvent
@staticmethod
def processEvent(evt):
for nr in ub_get_buffers(['post_edit','page_edit']):
if evt.srcObj==ub_get_meta('id', nr):
if nr==ub_get_bufnr('%'):
ub_refresh_current_view()
else:
ub_set_view_outdated(nr)
for nr in ub_get_buffers(['post_list','page_list','search_result_list']):
if nr == ub_get_bufnr('%'):
ub_refresh_current_view()
else:
ub_set_view_outdated(nr)
```<p>äº‹ä»¶ç›‘å¬å™¨éå†æ‰€æœ‰æ»¡è¶³å¤„ç†æ¡ä»¶çš„ç¼“å†²åŒºï¼Œå¯¹å½“å‰ç¼“å†²åŒºï¼Œç«‹å³åˆ·æ–°ï¼Œå…¶ä½™çš„æ ‡è®°ä¸ºå·²è¿‡æœŸã€‚åŒæ—¶åˆ©ç”¨Vimè‡ªèº«çš„äº‹ä»¶é©±åŠ¨ç‰¹æ€§ï¼Œåœ¨è¿›å…¥å·²è¿‡æœŸçš„ç¼“å†²åŒºæ—¶ï¼Œå†æ›´æ–°ä¹‹ï¼Œä¹Ÿå°±æ˜¯ä¼ è¯´ä¸­çš„æ‡’åŠ è½½æ¨¡å¼ï¼š</p>```vim
au BufEnter * py __ub_on_buffer_enter()
```
```python
@__ub_exception_handler
def __ub_on_buffer_enter():
''' Triggered by BufEnter event, check if the buffer is outdated
'''
if ub_is_view_outdated('%'):
ub_refresh_current_view()
ub_set_view_outdated('%', False)
```<p>æ­¤å¤–ï¼Œéšè‘—ä»£ç é‡çš„å¢åŠ ï¼ŒåŸæ¥æŠŠå…¨éƒ¨ä»£ç éƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­çš„åšæ³•ä¸å†é€‚ç”¨ï¼Œå°¤å…¶æ˜¯ä»¥<a href=http://en.wikipedia.org/wiki/Here_document>Here Document</a>å½¢å¼å­˜æ”¾åœ¨vimè„šæœ¬æ–‡ä»¶ä¸­çš„Pythonä»£ç ä¸èƒ½è¢«ctagsè¯†åˆ«ï¼Œæ‰€ä»¥æŒ‰ç±»åˆ«åˆ†åˆ«å­˜æ”¾åˆ°<strong>$VIMRUNTIME/plugin/ultrablog/</strong>ä¸‹çš„å‡ ä¸ªPythonæºæ–‡ä»¶ä¸­ã€‚</p><p>Posted via <a href=http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/>UltraBlog.vim</a>.</p></article></main><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css integrity=sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js integrity=sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js crossorigin=anonymous></script><script>mermaid.init(void 0,"code.language-mermaid")</script><div id=comment></div><script>const s=document.createElement("script");s.src="https://utteranc.es/client.js",s.crossOrigin="anonymous",s.async=!0,s.setAttribute("repo","xbot/blog-comments"),s.setAttribute("issue-term","pathname"),s.setAttribute("label","comment"),s.setAttribute("theme","github-"+window.minima_theme),document.getElementById("comment").appendChild(s)</script></div><footer class="mt-8 mb-8"><div class="container mx-auto"><div class="mt-8 flex flex-col-reverse sm:flex-row sm:justify-between items-center"><div class="text-center sm:text-left"><p class="mt-0 text-sm">Â© 2007-2024 é¬¼é©¬å¦–åˆ€</p><p class="mt-0 text-xs">Built with <a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> v0.140.1
and <a href=https://github.com/mivinci/hugo-theme-minima target=_blank rel="noopener noreferrer">Minima</a></p></div><p class="flex items-center mt-0"><a class="icon ml-1 mr-1" href=mailto:donie.leigh@gmail.com title=email><svg width="18" height="18" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="M22 6l-10 7L2 6"/></svg>
</a><a class="icon ml-1 mr-1" href=https://github.com/xbot title=github><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a class="icon ml-1 mr-1" href=/index.xml title=rss><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></div></div></footer></body></html>