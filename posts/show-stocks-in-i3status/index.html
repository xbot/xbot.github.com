<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="http://0x3f.org/posts/show-stocks-in-i3status/"><meta property="og:site_name" content="晴耕雨讀"><meta property="og:title" content="在i3wm状态栏显示股票信息"><meta property="og:description" content='效果如图：
创建脚本，并赋可执行权限：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/sh # shell script to prepend i3status with more stuff STOCK_SCRIPT=`realpath "$0"|xargs dirname`/stock.php i3status | while : do stock_info="" if [[ -x "$STOCK_SCRIPT" ]]; then stock_info=`$STOCK_SCRIPT` fi read line # if output_format = i3bar in i3status.conf stock_info="[{ \"full_text\": \"${stock_info}\" }," echo "${line/[/$stock_info}" || exit 1 # # if not output_format = i3bar in i3status.conf # echo "$stock_info | $line" || exit 1 done 如果i3status.conf中启用了JSON格式输出（支持颜色），应启用上面脚本中第一块的代码，否则使用后面的。启动JSON格式输出的内容具体如下：'><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-06-12T17:39:00+00:00"><meta property="article:modified_time" content="2015-06-12T17:39:00+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="I3wm"><meta property="article:tag" content="股票"><meta property="article:tag" content="编程"><meta property="article:tag" content="计算机"><meta name=twitter:card content="summary"><meta name=twitter:title content="在i3wm状态栏显示股票信息"><meta name=twitter:description content='效果如图：
创建脚本，并赋可执行权限：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/sh # shell script to prepend i3status with more stuff STOCK_SCRIPT=`realpath "$0"|xargs dirname`/stock.php i3status | while : do stock_info="" if [[ -x "$STOCK_SCRIPT" ]]; then stock_info=`$STOCK_SCRIPT` fi read line # if output_format = i3bar in i3status.conf stock_info="[{ \"full_text\": \"${stock_info}\" }," echo "${line/[/$stock_info}" || exit 1 # # if not output_format = i3bar in i3status.conf # echo "$stock_info | $line" || exit 1 done 如果i3status.conf中启用了JSON格式输出（支持颜色），应启用上面脚本中第一块的代码，否则使用后面的。启动JSON格式输出的内容具体如下：'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#181818"><title>晴耕雨讀 - 在i3wm状态栏显示股票信息
</title><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/minima.91848781a7679600f0ad1ad577e7da4fbb28b9f3fdc9a82126197659405bb483.css integrity="sha256-kYSHgadnlgDwrRrVd+faT7soufP9yaghJhl2WUBbtIM="><script defer type=text/javascript src=/minima.5f772103e807a34ef8ab63c3c53905fbf70689fa70d121085c7d0e84087effea.js integrity="sha256-X3chA+gHo074q2PDxTkF+/cGifpw0SEIXH0OhAh+/+o="></script></head><script>const theme_config="system",theme_light=theme_config==="system"?"light":theme_config;let theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":theme_light;console.debug(theme);try{localStorage.setItem("theme",theme),window.minima_theme=theme,document.querySelector("html").classList.add(theme)}catch(e){console.error(e)}</script><body><header class="mt-3 mb-8"><div class="container mx-auto"><nav class="flex justify-between items-center"><div class="flex items-center"><div id=theme-switch class="text-2xl cursor-pointer">🌝</div></div><ul class="flex items-center text-base font-semibold
whitespace-nowrap overflow-x-auto overflow-y-hidden"><li class="ml-2 mr-2"><a href=/>首页</a></li><li class="ml-2 mr-2"><a href=/posts>文章</a></li><li class="ml-2 mr-2"><a href=/tags>标签</a></li><li class="ml-2 mr-2"><a href=/about>关于</a></li><li class="ml-2 mr-2"><a href=/search>🔍</a></li></ul></nav></div></header><div class="container mx-auto"><h1 class="text-4xl font-extrabold mt-6 mb-6">在i3wm状态栏显示股票信息</h1><div class="mb-3 text-sm flex justify-between"><div>发布于 &mdash; 2015 年 06 月 12 日</div><div><a class=ml-1 href=/tags/Linux>#Linux</a>
<a class=ml-1 href=/tags/i3wm>#i3wm</a>
<a class=ml-1 href=/tags/%e8%82%a1%e7%a5%a8>#股票</a>
<a class=ml-1 href=/tags/%e7%bc%96%e7%a8%8b>#编程</a>
<a class=ml-1 href=/tags/%e8%ae%a1%e7%ae%97%e6%9c%ba>#计算机</a></div></div><main class=mb-8><p></p><article class=md><p>效果如图：</p><p><img src=http://pic.yupoo.com/leninlee/EIOXvoh8/medish.jpg alt></p><p>创建脚本，并赋可执行权限：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># shell script to prepend i3status with more stuff</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>STOCK_SCRIPT</span><span class=o>=</span><span class=sb>`</span>realpath <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span><span class=p>|</span>xargs dirname<span class=sb>`</span>/stock.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>i3status <span class=p>|</span> <span class=k>while</span> :
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nv>stock_info</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -x <span class=s2>&#34;</span><span class=nv>$STOCK_SCRIPT</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>stock_info</span><span class=o>=</span><span class=sb>`</span><span class=nv>$STOCK_SCRIPT</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>read</span> line
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># if output_format = i3bar in i3status.conf</span>
</span></span><span class=line><span class=cl>    <span class=nv>stock_info</span><span class=o>=</span><span class=s2>&#34;[{ \&#34;full_text\&#34;: \&#34;</span><span class=si>${</span><span class=nv>stock_info</span><span class=si>}</span><span class=s2>\&#34; },&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>line</span><span class=p>/[/</span><span class=nv>$stock_info</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>||</span> <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># # if not output_format = i3bar in i3status.conf</span>
</span></span><span class=line><span class=cl>    <span class=c1># echo &#34;$stock_info | $line&#34; || exit 1</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><p>如果i3status.conf中启用了JSON格式输出（支持颜色），应启用上面脚本中第一块的代码，否则使用后面的。启动JSON格式输出的内容具体如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>general</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>colors</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=nx>output_format</span> <span class=o>=</span> <span class=nx>i3bar</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在i3wm的配置文件中用以上脚本替换i3status：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>bar</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>#</span> <span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>#</span> <span class=nx>status_command</span> <span class=nx>i3status</span>
</span></span><span class=line><span class=cl>    <span class=nx>status_command</span> <span class=o>~</span><span class=err>/.i3/myi3status.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>#</span> <span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在和上面脚本同路径下创建脚本：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>#!/bin/env php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PinYin</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>utf8To</span><span class=p>(</span><span class=nv>$ss</span><span class=p>,</span> <span class=nv>$isfirst</span> <span class=o>=</span> <span class=k>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>self</span><span class=o>::</span><span class=na>convert</span><span class=p>(</span><span class=nx>self</span><span class=o>::</span><span class=na>utf8ToGB2312</span><span class=p>(</span><span class=nv>$ss</span><span class=p>),</span> <span class=nv>$isfirst</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>utf8ToGB2312</span><span class=p>(</span><span class=nv>$ss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>iconv</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>,</span> <span class=s1>&#39;GB2312//IGNORE&#39;</span><span class=p>,</span> <span class=nv>$ss</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 字符串必须为GB2312编码
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>convert</span><span class=p>(</span><span class=nv>$ss</span><span class=p>,</span> <span class=nv>$isfirst</span> <span class=o>=</span> <span class=k>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$res</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$len</span> <span class=o>=</span> <span class=nx>strlen</span><span class=p>(</span><span class=nv>$ss</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$pinyinArr</span> <span class=o>=</span> <span class=nx>self</span><span class=o>::</span><span class=na>get_pinyin_array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span><span class=o>&lt;</span><span class=nv>$len</span><span class=p>;</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$ascii</span> <span class=o>=</span> <span class=nx>ord</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=nv>$i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&gt;</span> <span class=mh>0x80</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$asciiB</span> <span class=o>=</span> <span class=nx>ord</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=o>++</span><span class=nv>$i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ascii</span> <span class=o>=</span> <span class=nv>$ascii</span> <span class=o>*</span> <span class=mi>256</span> <span class=o>+</span> <span class=nv>$asciiB</span> <span class=o>-</span> <span class=mi>65536</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&lt;</span> <span class=mi>255</span> <span class=o>&amp;&amp;</span> <span class=nv>$ascii</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>((</span><span class=nv>$ascii</span> <span class=o>&gt;=</span> <span class=mi>48</span> <span class=o>&amp;&amp;</span> <span class=nv>$ascii</span> <span class=o>&lt;=</span> <span class=mi>57</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&gt;=</span> <span class=mi>97</span> <span class=o>&amp;&amp;</span> <span class=nv>$ascii</span> <span class=o>&lt;=</span> <span class=mi>122</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$res</span> <span class=o>.=</span> <span class=nv>$ss</span><span class=p>[</span><span class=nv>$i</span><span class=p>];</span> <span class=c1>// 0-9 a-z
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span> <span class=k>elseif</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&gt;=</span> <span class=mi>65</span> <span class=o>&amp;&amp;</span> <span class=nv>$ascii</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$res</span> <span class=o>.=</span> <span class=nx>strtolower</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=nv>$i</span><span class=p>]);</span> <span class=c1>// A-Z
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$res</span> <span class=o>.=</span> <span class=s1>&#39;_&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>elseif</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mi>20319</span> <span class=o>||</span> <span class=nv>$ascii</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>10247</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$res</span> <span class=o>.=</span> <span class=s1>&#39;_&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>foreach</span> <span class=p>(</span><span class=nv>$pinyinArr</span> <span class=k>as</span> <span class=nv>$py</span><span class=o>=&gt;</span><span class=nv>$asc</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nv>$asc</span> <span class=o>&lt;=</span> <span class=nv>$ascii</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nv>$res</span> <span class=o>.=</span> <span class=nv>$isfirst</span> <span class=o>?</span> <span class=nv>$py</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>:</span> <span class=nv>$py</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>toFirst</span><span class=p>(</span><span class=nv>$ss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ascii</span> <span class=o>=</span> <span class=nx>ord</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&gt;</span> <span class=mh>0xE0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$ss</span> <span class=o>=</span> <span class=nx>self</span><span class=o>::</span><span class=na>utf8ToGB2312</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=nv>$ss</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=nv>$ss</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>elseif</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&lt;</span> <span class=mh>0x80</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&gt;=</span> <span class=mi>65</span> <span class=o>&amp;&amp;</span> <span class=nv>$ascii</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>strtolower</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>elseif</span> <span class=p>(</span><span class=nv>$ascii</span> <span class=o>&gt;=</span> <span class=mi>97</span> <span class=o>&amp;&amp;</span> <span class=nv>$ascii</span> <span class=o>&lt;=</span> <span class=mi>122</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nv>$ss</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$ss</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$asc</span> <span class=o>=</span> <span class=nx>ord</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>*</span> <span class=mi>256</span> <span class=o>+</span> <span class=nx>ord</span><span class=p>(</span><span class=nv>$ss</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>-</span> <span class=mi>65536</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>20319</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>20284</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;a&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>20283</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>19776</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;b&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>19775</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>19219</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;c&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>19218</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>18711</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;d&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>18710</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>18527</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;e&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>18526</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>18240</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;f&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>18239</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>17923</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;g&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>17922</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>17418</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;h&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>17417</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>16475</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;j&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>16474</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>16213</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;k&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>16212</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>15641</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>15640</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>15166</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;m&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>15165</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>14923</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;n&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>14922</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>14915</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;o&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>14914</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>14631</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;p&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>14630</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>14150</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;q&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>14149</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>14091</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>14090</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>13319</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;s&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>13318</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>12839</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;t&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>12838</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>12557</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;w&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>12556</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>11848</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;x&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>11847</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>11056</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;y&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$asc</span><span class=o>&gt;=-</span><span class=mi>11055</span> <span class=o>&amp;&amp;</span> <span class=nv>$asc</span><span class=o>&lt;=-</span><span class=mi>10247</span><span class=p>)</span> <span class=k>return</span> <span class=s1>&#39;z&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>get_pinyin_array</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>static</span> <span class=nv>$pyArr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$pyArr</span><span class=p>))</span> <span class=k>return</span> <span class=nv>$pyArr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$kk</span> <span class=o>=</span> <span class=s1>&#39;a|ai|an|ang|ao|ba|bai|ban|bang|bao|bei|ben|beng|bi|bian|biao|bie|bin|bing|bo|bu|ca|cai|can|cang|cao|ce|ceng|cha|chai|chan|chang|chao|che|chen|cheng|chi|chong|chou|chu|chuai|chuan|chuang|chui|chun|chuo|ci|cong|cou|cu|cuan|cui|cun|cuo|da|dai|dan|dang|dao|de|deng|di|dian|diao|die|ding|diu|dong|dou|du|duan|dui|dun|duo|e|en|er|fa|fan|fang|fei|fen|feng|fo|fou|fu|ga|gai|gan|gang|gao|ge|gei|gen|geng|gong|gou|gu|gua|guai|guan|guang|gui|gun|guo|ha|hai|han|hang|hao|he|hei|hen|heng|hong|hou|hu|hua|huai|huan|huang|hui|hun|huo|ji|jia|jian|jiang|jiao|jie|jin|jing|jiong|jiu|ju|juan|jue|jun|ka|kai|kan|kang|kao|ke|ken|keng|kong|kou|ku|kua|kuai|kuan|kuang|kui|kun|kuo|la|lai|lan|lang|lao|le|lei|leng|li|lia|lian|liang|liao|lie|lin|ling|liu|long|lou|lu|lv|luan|lue|lun|luo|ma|mai|man|mang|mao|me|mei|men|meng|mi|mian|miao|mie|min|ming|miu|mo|mou|mu|na|nai|nan|nang|nao|ne|nei|nen|neng|ni|nian|niang|niao|nie|nin|ning|niu|nong|nu|nv|nuan|nue|nuo|o|ou|pa|pai|pan|pang|pao|pei|pen|peng|pi|pian|piao|pie|pin|ping|po|pu|qi|qia|qian|qiang|qiao|qie|qin|qing|qiong|qiu|qu|quan|que|qun|ran|rang|rao|re|ren|reng|ri|rong|rou|ru|ruan|rui|run|ruo|sa|sai|san|sang|sao|se|sen|seng|sha|shai|shan|shang|shao|she|shen|sheng|shi|shou|shu|shua|shuai|shuan|shuang|shui|shun|shuo|si|song|sou|su|suan|sui|sun|suo|ta|tai|tan|tang|tao|te|teng|ti|tian|tiao|tie|ting|tong|tou|tu|tuan|tui|tun|tuo|wa|wai|wan|wang|wei|wen|weng|wo|wu|xi|xia|xian|xiang|xiao|xie|xin|xing|xiong|xiu|xu|xuan|xue|xun|ya|yan|yang|yao|ye|yi|yin|ying|yo|yong|you|yu|yuan|yue|yun|za|zai|zan|zang|zao|ze|zei|zen|zeng|zha|zhai|zhan|zhang|zhao|zhe|zhen|zheng|zhi|zhong|zhou|zhu|zhua|zhuai|zhuan|zhuang|zhui|zhun|zhuo|zi|zong|zou|zu|zuan|zui|zun|zuo&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$vv</span> <span class=o>=</span> <span class=s1>&#39;-20319|-20317|-20304|-20295|-20292|-20283|-20265|-20257|-20242|-20230|-20051|-20036|-20032|-20026|-20002|-19990|-19986|-19982|-19976|-19805|-19784|-19775|-19774|-19763|-19756|-19751|-19746|-19741|-19739|-19728|-19725|-19715|-19540|-19531|-19525|-19515|-19500|-19484|-19479|-19467|-19289|-19288|-19281|-19275|-19270|-19263|-19261|-19249|-19243|-19242|-19238|-19235|-19227|-19224|-19218|-19212|-19038|-19023|-19018|-19006|-19003|-18996|-18977|-18961|-18952|-18783|-18774|-18773|-18763|-18756|-18741|-18735|-18731|-18722|-18710|-18697|-18696|-18526|-18518|-18501|-18490|-18478|-18463|-18448|-18447|-18446|-18239|-18237|-18231|-18220|-18211|-18201|-18184|-18183|-18181|-18012|-17997|-17988|-17970|-17964|-17961|-17950|-17947|-17931|-17928|-17922|-17759|-17752|-17733|-17730|-17721|-17703|-17701|-17697|-17692|-17683|-17676|-17496|-17487|-17482|-17468|-17454|-17433|-17427|-17417|-17202|-17185|-16983|-16970|-16942|-16915|-16733|-16708|-16706|-16689|-16664|-16657|-16647|-16474|-16470|-16465|-16459|-16452|-16448|-16433|-16429|-16427|-16423|-16419|-16412|-16407|-16403|-16401|-16393|-16220|-16216|-16212|-16205|-16202|-16187|-16180|-16171|-16169|-16158|-16155|-15959|-15958|-15944|-15933|-15920|-15915|-15903|-15889|-15878|-15707|-15701|-15681|-15667|-15661|-15659|-15652|-15640|-15631|-15625|-15454|-15448|-15436|-15435|-15419|-15416|-15408|-15394|-15385|-15377|-15375|-15369|-15363|-15362|-15183|-15180|-15165|-15158|-15153|-15150|-15149|-15144|-15143|-15141|-15140|-15139|-15128|-15121|-15119|-15117|-15110|-15109|-14941|-14937|-14933|-14930|-14929|-14928|-14926|-14922|-14921|-14914|-14908|-14902|-14894|-14889|-14882|-14873|-14871|-14857|-14678|-14674|-14670|-14668|-14663|-14654|-14645|-14630|-14594|-14429|-14407|-14399|-14384|-14379|-14368|-14355|-14353|-14345|-14170|-14159|-14151|-14149|-14145|-14140|-14137|-14135|-14125|-14123|-14122|-14112|-14109|-14099|-14097|-14094|-14092|-14090|-14087|-14083|-13917|-13914|-13910|-13907|-13906|-13905|-13896|-13894|-13878|-13870|-13859|-13847|-13831|-13658|-13611|-13601|-13406|-13404|-13400|-13398|-13395|-13391|-13387|-13383|-13367|-13359|-13356|-13343|-13340|-13329|-13326|-13318|-13147|-13138|-13120|-13107|-13096|-13095|-13091|-13076|-13068|-13063|-13060|-12888|-12875|-12871|-12860|-12858|-12852|-12849|-12838|-12831|-12829|-12812|-12802|-12607|-12597|-12594|-12585|-12556|-12359|-12346|-12320|-12300|-12120|-12099|-12089|-12074|-12067|-12058|-12039|-11867|-11861|-11847|-11831|-11798|-11781|-11604|-11589|-11536|-11358|-11340|-11339|-11324|-11303|-11097|-11077|-11067|-11055|-11052|-11045|-11041|-11038|-11024|-11020|-11019|-11018|-11014|-10838|-10832|-10815|-10800|-10790|-10780|-10764|-10587|-10544|-10533|-10519|-10331|-10329|-10328|-10322|-10315|-10309|-10307|-10296|-10281|-10274|-10270|-10262|-10260|-10256|-10254&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$key</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$kk</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$val</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$vv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$pyArr</span> <span class=o>=</span> <span class=nx>array_combine</span><span class=p>(</span><span class=nv>$key</span><span class=p>,</span> <span class=nv>$val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>arsort</span><span class=p>(</span><span class=nv>$pyArr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$pyArr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>define</span><span class=p>(</span><span class=s1>&#39;STOCKS_FILE&#39;</span><span class=p>,</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HOME&#39;</span><span class=p>]</span><span class=o>.</span><span class=s1>&#39;/.stocks&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>file_exists</span><span class=p>(</span><span class=nx>STOCKS_FILE</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=s1>&#39;File not found: &#39;</span><span class=o>.</span><span class=nx>STOCKS_FILE</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$stockCodeArr</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nx>trim</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nx>STOCKS_FILE</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$stockCodeArr</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=s1>&#39;No stock code found.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$context</span> <span class=o>=</span> <span class=nx>stream_context_create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;http&#39;</span><span class=o>=&gt;</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;method&#39;</span><span class=o>=&gt;</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timeout&#39;</span> <span class=o>=&gt;</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$response</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s2>&#34;http://hq.sinajs.cn/list=&#34;</span><span class=o>.</span><span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nv>$stockCodeArr</span><span class=p>),</span> <span class=k>false</span><span class=p>,</span> <span class=nv>$context</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$response</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=s1>&#39;Failed fetching stock info with API.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$result</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=nv>$lines</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nx>trim</span><span class=p>(</span><span class=nx>iconv</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>,</span> <span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=nv>$response</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$lines</span> <span class=k>as</span> <span class=nv>$line</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$matches</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#34;.*&#34;/&#39;</span><span class=p>,</span> <span class=nv>$line</span><span class=p>,</span> <span class=nv>$matches</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$matches</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$stock</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nx>trim</span><span class=p>(</span><span class=nv>$matches</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s1>&#39;&#34;&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$stock</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$result</span><span class=p>[]</span> <span class=o>=</span> <span class=nx>strtoupper</span><span class=p>(</span><span class=nx>PinYin</span><span class=o>::</span><span class=na>utf8To</span><span class=p>(</span><span class=nv>$stock</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=k>true</span><span class=p>))</span><span class=o>.</span><span class=s2>&#34;: </span><span class=si>{</span><span class=nv>$stock</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=nv>$stock</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=nv>$stock</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;; &#39;</span><span class=p>,</span> <span class=nv>$result</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>脚本从~/.stocks中读取股票代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>sh601985</span>
</span></span><span class=line><span class=cl><span class=nx>sz002024</span>
</span></span></code></pre></td></tr></table></div></div></article></main><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css integrity=sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js integrity=sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js crossorigin=anonymous></script><script>mermaid.init(void 0,"code.language-mermaid")</script><div id=comment></div><script>const s=document.createElement("script");s.src="https://utteranc.es/client.js",s.crossOrigin="anonymous",s.async=!0,s.setAttribute("repo","xbot/blog-comments"),s.setAttribute("issue-term","pathname"),s.setAttribute("label","comment"),s.setAttribute("theme","github-"+window.minima_theme),document.getElementById("comment").appendChild(s)</script></div><footer class="mt-8 mb-8"><div class="container mx-auto"><div class="mt-8 flex flex-col-reverse sm:flex-row sm:justify-between items-center"><div class="text-center sm:text-left"><p class="mt-0 text-sm">© 2007-2024 鬼马妖刀</p><p class="mt-0 text-xs">Built with <a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> v0.145.0
and <a href=https://github.com/mivinci/hugo-theme-minima target=_blank rel="noopener noreferrer">Minima</a></p></div><p class="flex items-center mt-0"><a class="icon ml-1 mr-1" href=mailto:donie.leigh@gmail.com title=email><svg width="18" height="18" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="M22 6l-10 7L2 6"/></svg>
</a><a class="icon ml-1 mr-1" href=https://github.com/xbot title=github><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a class="icon ml-1 mr-1" href=/index.xml title=rss><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></div></div></footer></body></html>