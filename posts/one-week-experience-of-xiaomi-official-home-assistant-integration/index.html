<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="http://0x3f.org/posts/one-week-experience-of-xiaomi-official-home-assistant-integration/"><meta property="og:site_name" content="晴耕雨讀"><meta property="og:title" content="小米官方的 Home Assistant 集成一周体验"><meta property="og:description" content="小米官方的 Home Assistant 集成的优势和有待改进的地方。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-25T14:58:27+08:00"><meta property="article:modified_time" content="2024-12-25T14:58:27+08:00"><meta property="article:tag" content="Home-Automation"><meta property="article:tag" content="Home-Assistant"><meta property="article:tag" content="Homekit"><meta name=twitter:card content="summary"><meta name=twitter:title content="小米官方的 Home Assistant 集成一周体验"><meta name=twitter:description content="小米官方的 Home Assistant 集成的优势和有待改进的地方。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#181818"><title>晴耕雨讀 - 小米官方的 Home Assistant 集成一周体验
</title><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/minima.91848781a7679600f0ad1ad577e7da4fbb28b9f3fdc9a82126197659405bb483.css integrity="sha256-kYSHgadnlgDwrRrVd+faT7soufP9yaghJhl2WUBbtIM="><script defer type=text/javascript src=/minima.6d7cfeceee442a7e274c8b2407accf5def5708ff479e73813905d798838f75d9.js integrity="sha256-bXz+zu5EKn4nTIskB6zPXe9XCP9HnnOBOQXXmIOPddk="></script></head><script>const theme_config="system",theme_light=theme_config==="system"?"light":theme_config;let theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":theme_light;console.debug(theme);try{localStorage.setItem("theme",theme),window.minima_theme=theme,document.querySelector("html").classList.add(theme)}catch(e){console.error(e)}</script><body><header class="mt-3 mb-8"><div class="container mx-auto"><nav class="flex justify-between items-center"><div class="flex items-center"><div id=theme-switch class="text-2xl cursor-pointer">🌝</div></div><ul class="flex items-center text-base font-semibold
whitespace-nowrap overflow-x-auto overflow-y-hidden"><li class="ml-2 mr-2"><a href=/>首页</a></li><li class="ml-2 mr-2"><a href=/posts>文章</a></li><li class="ml-2 mr-2"><a href=/tags>标签</a></li><li class="ml-2 mr-2"><a href=/categories>分类</a></li><li class="ml-2 mr-2"><a href=/about>关于</a></li><li class="ml-2 mr-2"><a href=/search>🔍</a></li></ul></nav></div></header><div class="container mx-auto"><h1 class="text-4xl font-extrabold mt-6 mb-6">小米官方的 Home Assistant 集成一周体验</h1><div class="mb-3 text-sm flex justify-between"><div>发布于 &mdash; 2024 年 12 月 25 日</div><div><a class=ml-1 href=/tags/home-automation>#home-automation</a>
<a class=ml-1 href=/tags/home-assistant>#home-assistant</a>
<a class=ml-1 href=/tags/homekit>#homekit</a></div></div><main class=mb-8><p>小米官方的 Home Assistant 集成的优势和有待改进的地方。</p><article class=md><h2 id=消息订阅机制--最大亮点>消息订阅机制 —— 最大亮点</h2><p>小米官方 Home Assistant 集成最大的优势，就是其基于消息订阅机制的通信方式。这相较于第三方集成常用的轮询方式，有着质的飞跃。在以往的第三方集成中，设备状态的获取往往依赖于轮询，每隔一段时间才去检查设备状态是否有变化，这就导致了信息的延迟，用户操作后不能及时得到设备的反馈，体验大打折扣。</p><p>而小米官方集成的消息订阅机制则像是给设备安装了一个实时传声筒。当设备属性发生改变或者有事件产生时，设备会迅速向小米云或小米中枢网关发送上行消息，米家集成就能在第一时间接收到这些消息并更新设备状态，无需频繁地刷新查询。这就使得小米的智能家居配件在 Home Assistant 和 HomeKit 生态中的响应变得极其及时，真正实现了设备状态的实时掌控。比如灯的开关、窗帘的开合、空调的温度调节等操作，都能瞬间得到执行和反馈，让用户感受到智能家居的便捷与高效，极大地提升了用户的智能家居体验。</p><h2 id=oauth2-登录方式--可能每周都要重新登录>OAuth2 登录方式 —— 可能每周都要重新登录</h2><p>小米官方 Home Assistant 集成采用的 OAuth2 登录方式，其实有着诸多安全性方面的优势。它允许客户端不接触用户密码，服务器端能够更集中地保护用户信息，所有认证和授权信息都汇聚在服务器端，而非分散于各个客户端，大大减少了用户凭据泄露的风险。而且 OAuth2 还是一个应用广泛的认证标准，很多公司和组织都采用了它，这也让小米的智能家居配件在集成应用时更容易与其他平台或服务进行交互、整合。</p><p>然而，在实际使用一周的体验中，也发现了不太方便的地方，那就是登录有效期的问题。使用一周之后，系统就会提示登录过期，需要重新登录。这在日常使用中，尤其是频繁操作智能家居设备时，还是挺影响体验的。每隔一段时间都要重新登录，操作步骤变得繁琐，打断了原本便捷的智能家居操控流程。</p><h2 id=额外配置>额外配置</h2><h3 id=安防控制面板显示>安防控制面板显示</h3><p><img src=https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-25-15-52-54-Image%20Dec%2025%202024.jpeg alt=2024-12-25-15-52-54-ImageDec252024></p><p>对于我在用的小米智能多模网关，小米官方 Home Assistant 集成并没有提供 HA 的安防控制面板实体，而是提供了一个基本的 select 实体。如果要在 HA 的仪表板和家庭 App 中显示安防控制面板，就需要把安防系统的 select 实体转换成 alarm_control_panel 实体。</p><h3 id=传感器实体转换>传感器实体转换</h3><p><img src=https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-25-15-49-31-mac_20241225154742.jpeg alt=2024-12-25-15-49-31-mac_20241225154742></p><p>对于移动检测传感器和烟雾传感器这样的配件，小米官方 Home Assistant 集成没有提供对应的 binary_sensor 实体，而是 event 实体，这当然很符合小米配件的行为模式，但如果需要把它们输出到 Apple 的家庭 App ，就需要将其转换成 binary_sensor 实体。这是因为家庭 App 无法处理 HA 中的 event 实体，而转换成binary_sensor 实体才能被识别为对应的传感器，也更便于与其他智能设备进行联动。</p><h3 id=扫地机打扫指定的房间>扫地机打扫指定的房间</h3><p><img src=https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-25-16-05-55-mac_20241225160403.jpeg alt=2024-12-25-16-05-55-mac_20241225160403></p><p>在设置扫地机打扫指定房间的自动化时，需要自己获取房间 ID，这也是小米官方 Home Assistant 集成中一个不太便捷的地方。与第三方集成相比，这里的房间 ID 获取方式不同，且操作相对复杂一些。</p><h2 id=总结与展望>总结与展望</h2><p>通过这一周对小米官方 Home Assistant 集成的体验，总体来说，它有着基于消息订阅机制的通信这一突出优势，让智能家居设备的响应及时性得到了质的提升，为用户带来了更流畅、高效的操控体验，也让小米智能家居在 Home Assistant 和 HomeKit 生态中的融合更加紧密和实用。</p><p>不知道大家在使用小米官方 Home Assistant 集成时有没有遇到其他问题或者有什么独特的使用心得呢？欢迎在评论区留言分享，让我们一起探索智能家居的无限可能！</p></article></main><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css integrity=sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js integrity=sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js crossorigin=anonymous></script><script>mermaid.init(void 0,"code.language-mermaid")</script><div id=comment></div><script>const s=document.createElement("script");s.src="https://utteranc.es/client.js",s.crossOrigin="anonymous",s.async=!0,s.setAttribute("repo","xbot/blog-comments"),s.setAttribute("issue-term","pathname"),s.setAttribute("label","comment"),s.setAttribute("theme","github-"+window.minima_theme),document.getElementById("comment").appendChild(s)</script></div><footer class="mt-8 mb-8"><div class="container mx-auto"><div class="mt-8 flex flex-col-reverse sm:flex-row sm:justify-between items-center"><div class="text-center sm:text-left"><p class="mt-0 text-sm">© 2007-2024 鬼马妖刀</p><p class="mt-0 text-xs">Built with <a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> v0.140.1
and <a href=https://github.com/mivinci/hugo-theme-minima target=_blank rel="noopener noreferrer">Minima</a></p></div><p class="flex items-center mt-0"><a class="icon ml-1 mr-1" href=mailto:donie.leigh@gmail.com title=email><svg width="18" height="18" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="M22 6l-10 7L2 6"/></svg>
</a><a class="icon ml-1 mr-1" href=https://github.com/xbot title=github><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a class="icon ml-1 mr-1" href=/index.xml title=rss><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></div></div></footer></body></html>