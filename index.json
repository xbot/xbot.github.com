[{"content":"一、邂逅 elmo.chat 在信息爆炸的时代，每天面对海量的网页、PDF 文档、YouTube 视频，是不是感觉时间完全不够用，根本看不过来？作为一个每天在互联网信息海洋里 “冲浪” 的博主，我也经常被这个问题困扰。直到有一天，我偶然发现了一款堪称 “神器” 的 Chrome 扩展 —— elmo.chat ，它就像我的私人智能助手，能快速帮我提炼关键信息，大大提高了我的阅读和学习效率。今天就来给大家分享一下这款工具。\n二、主要功能 （一）网页内容速览 elmo.chat 最主要的功能，就是能把那些冗长又复杂的网页内容，快速转化成简短精炼的摘要。以前浏览资讯类网页，一大堆文字看得眼花缭乱，关键信息还不好找。现在有了 elmo.chat，点击一下扩展图标，几秒钟就能生成一份清晰的内容摘要，帮我迅速了解这篇文章到底在讲啥，大大节省了时间和精力。\n（二）覆盖多类型总结对象 同时支持网页、YouTube 视频、PDF 文档、Google Docs 等多种格式的内容。\n（三）深度交互 这个功能让我觉得 elmo.chat 就像是一个智能小助手。它不仅能给出内容总结，还能针对总结的内容跟我进行深度交流。比如，我在阅读一篇关于人工智能发展趋势的文章后，对其中提到的某种新技术不太理解，就可以直接在 elmo.chat 的交互框里提问，它会根据文章内容给我做出详细的解释。这种交互体验，就像是身边有一位专业的顾问，随时为我答疑解惑，帮助我更深入地理解所阅读的内容。\n（四）多语言支持 elmo.chat 还具备灵活的多语言支持，它会基于浏览器的语言设置，生成相应语言的总结内容。也可以自己指定语言。\n三、免费使用 不得不说，elmo.chat 的免费使用政策真的太贴心了！只要你安装了这款扩展，就能马上使用它的所有功能。不管是学生党想快速总结学习资料，还是打工人需要处理大量工作文档，都能毫无负担地使用 elmo.chat，不用担心会产生额外的费用，实实在在地降低了使用门槛，让每个人都能轻松享受到 AI 带来的便利。\n四、使用过程中的问题 （一）浏览器适配局限 美中不足的是，elmo.chat 在浏览器兼容性方面存在一定的局限性。官方明确表示，这款扩展仅支持 Chrome 浏览器，并且不支持基于 Chrome 的衍生浏览器。这对于习惯使用特定浏览器的用户来说，可能会有些不便。不过，经过我的实际测试，发现 Microsoft Edge 浏览器也能使用 elmo.chat，这算是一个小小的惊喜。但我目前的主力浏览器 Arc 却无法使用 elmo.chat，这让我在使用时不得不频繁切换浏览器，多少有些影响使用体验 。希望开发者后续能够扩大浏览器的支持范围，让更多用户能够方便地使用这款强大的工具。\n（二）侧边栏设计待优化 elmo.chat 的侧边栏设计初衷或许是为了实现对 PDF 的总结等功能，但在实际使用中却存在一些问题。它的侧边栏并非内嵌于网页之中，而是独立于网页之外。这就导致当我切换网页页签后，侧边栏会随之消失。要是我想再次查看总结内容，就必须回到原页签，重新执行总结操作，这一过程略显繁琐。若将侧边栏设置为始终显示，虽然能解决切换页签后消失的问题，但新的问题又出现了。在浏览那些不需要总结的网页时，侧边栏会一直占据屏幕空间，挤压网页的显示区域，让网页内容看起来很局促，影响正常的浏览体验。\n（三）主题设定存困惑 elmo.chat 提供了浅色和深色两种主题供用户选择，然而，这个主题设置却让人有些困惑。无论是选择浅色主题还是深色主题，侧边栏的背景颜色竟然都是黑色，两者的区别仅仅在于字体颜色，浅色主题下字体为白色，深色主题下字体为灰色。这种设定与我们通常对浅色和深色主题的认知不太一样，正常情况下，浅色主题的背景应该是明亮的色调。这一不太合理的主题设置，在一定程度上影响了使用的视觉感受和操作体验 。\n五、结语 总的来说，elmo.chat 作为一款功能强大的 Chrome 扩展，在信息总结和交互体验方面表现出色，为我们的学习、工作和研究带来了极大的便利。其免费使用的政策更是让广大用户能够轻松上手，享受 AI 技术带来的高效服务。但不可忽视的是，它在浏览器适配、侧边栏设计以及主题设置等方面还存在一些不足之处 。希望开发者能够重视这些问题，在后续的更新迭代中加以优化和改进。相信在未来，随着技术的不断进步和完善，elmo.chat 将为我们带来更加流畅、便捷的使用体验。如果你也被海量的信息所困扰，不妨尝试一下 elmo.chat，说不定它会成为你在信息海洋中航行的得力助手！\n","permalink":"http://0x3f.org/posts/elmo-chat-intro/","summary":"\u003ch2 id=\"一邂逅-elmochat\"\u003e一、邂逅 elmo.chat\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-18-21-01-06-Elmo%20Chat%20-%20Your%20AI%20companion%20to%20create%20summaries%20and%20insights.jpeg\" alt=\"2025-01-18-21-01-06-ElmoChat-YourAIcompaniontocreatesummariesandinsights\"\u003e\u003c/p\u003e\n\u003cp\u003e在信息爆炸的时代，每天面对海量的网页、PDF 文档、YouTube 视频，是不是感觉时间完全不够用，根本看不过来？作为一个每天在互联网信息海洋里 “冲浪” 的博主，我也经常被这个问题困扰。直到有一天，我偶然发现了一款堪称 “神器” 的 Chrome 扩展 —— \u003ca href=\"https://www.elmo.chat/\"\u003eelmo.chat\u003c/a\u003e ，它就像我的私人智能助手，能快速帮我提炼关键信息，大大提高了我的阅读和学习效率。今天就来给大家分享一下这款工具。\u003c/p\u003e\n\u003ch2 id=\"二主要功能\"\u003e二、主要功能\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-18-21-03-02-mac_20250118202041.jpeg\" alt=\"2025-01-18-21-03-02-mac_20250118202041\"\u003e\u003c/p\u003e\n\u003ch3 id=\"一网页内容速览\"\u003e（一）网页内容速览\u003c/h3\u003e\n\u003cp\u003eelmo.chat 最主要的功能，就是能把那些冗长又复杂的网页内容，快速转化成简短精炼的摘要。以前浏览资讯类网页，一大堆文字看得眼花缭乱，关键信息还不好找。现在有了 elmo.chat，点击一下扩展图标，几秒钟就能生成一份清晰的内容摘要，帮我迅速了解这篇文章到底在讲啥，大大节省了时间和精力。\u003c/p\u003e\n\u003ch3 id=\"二覆盖多类型总结对象\"\u003e（二）覆盖多类型总结对象\u003c/h3\u003e\n\u003cp\u003e同时支持网页、YouTube 视频、PDF 文档、Google Docs 等多种格式的内容。\u003c/p\u003e\n\u003ch3 id=\"三深度交互\"\u003e（三）深度交互\u003c/h3\u003e\n\u003cp\u003e这个功能让我觉得 elmo.chat 就像是一个智能小助手。它不仅能给出内容总结，还能针对总结的内容跟我进行深度交流。比如，我在阅读一篇关于人工智能发展趋势的文章后，对其中提到的某种新技术不太理解，就可以直接在 elmo.chat 的交互框里提问，它会根据文章内容给我做出详细的解释。这种交互体验，就像是身边有一位专业的顾问，随时为我答疑解惑，帮助我更深入地理解所阅读的内容。\u003c/p\u003e\n\u003ch3 id=\"四多语言支持\"\u003e（四）多语言支持\u003c/h3\u003e\n\u003cp\u003eelmo.chat 还具备灵活的多语言支持，它会基于浏览器的语言设置，生成相应语言的总结内容。也可以自己指定语言。\u003c/p\u003e\n\u003ch2 id=\"三免费使用\"\u003e三、免费使用\u003c/h2\u003e\n\u003cp\u003e不得不说，elmo.chat 的免费使用政策真的太贴心了！只要你安装了这款扩展，就能马上使用它的所有功能。不管是学生党想快速总结学习资料，还是打工人需要处理大量工作文档，都能毫无负担地使用 elmo.chat，不用担心会产生额外的费用，实实在在地降低了使用门槛，让每个人都能轻松享受到 AI 带来的便利。\u003c/p\u003e\n\u003ch2 id=\"四使用过程中的问题\"\u003e四、使用过程中的问题\u003c/h2\u003e\n\u003ch3 id=\"一浏览器适配局限\"\u003e（一）浏览器适配局限\u003c/h3\u003e\n\u003cp\u003e美中不足的是，elmo.chat 在浏览器兼容性方面存在一定的局限性。官方明确表示，这款扩展仅支持 Chrome 浏览器，并且不支持基于 Chrome 的衍生浏览器。这对于习惯使用特定浏览器的用户来说，可能会有些不便。不过，经过我的实际测试，发现 Microsoft Edge 浏览器也能使用 elmo.chat，这算是一个小小的惊喜。但我目前的主力浏览器 Arc 却无法使用 elmo.chat，这让我在使用时不得不频繁切换浏览器，多少有些影响使用体验 。希望开发者后续能够扩大浏览器的支持范围，让更多用户能够方便地使用这款强大的工具。\u003c/p\u003e\n\u003ch3 id=\"二侧边栏设计待优化\"\u003e（二）侧边栏设计待优化\u003c/h3\u003e\n\u003cp\u003eelmo.chat 的侧边栏设计初衷或许是为了实现对 PDF 的总结等功能，但在实际使用中却存在一些问题。它的侧边栏并非内嵌于网页之中，而是独立于网页之外。这就导致当我切换网页页签后，侧边栏会随之消失。要是我想再次查看总结内容，就必须回到原页签，重新执行总结操作，这一过程略显繁琐。若将侧边栏设置为始终显示，虽然能解决切换页签后消失的问题，但新的问题又出现了。在浏览那些不需要总结的网页时，侧边栏会一直占据屏幕空间，挤压网页的显示区域，让网页内容看起来很局促，影响正常的浏览体验。\u003c/p\u003e\n\u003ch3 id=\"三主题设定存困惑\"\u003e（三）主题设定存困惑\u003c/h3\u003e\n\u003cp\u003eelmo.chat 提供了浅色和深色两种主题供用户选择，然而，这个主题设置却让人有些困惑。无论是选择浅色主题还是深色主题，侧边栏的背景颜色竟然都是黑色，两者的区别仅仅在于字体颜色，浅色主题下字体为白色，深色主题下字体为灰色。这种设定与我们通常对浅色和深色主题的认知不太一样，正常情况下，浅色主题的背景应该是明亮的色调。这一不太合理的主题设置，在一定程度上影响了使用的视觉感受和操作体验 。\u003c/p\u003e\n\u003ch2 id=\"五结语\"\u003e五、结语\u003c/h2\u003e\n\u003cp\u003e总的来说，elmo.chat 作为一款功能强大的 Chrome 扩展，在信息总结和交互体验方面表现出色，为我们的学习、工作和研究带来了极大的便利。其免费使用的政策更是让广大用户能够轻松上手，享受 AI 技术带来的高效服务。但不可忽视的是，它在浏览器适配、侧边栏设计以及主题设置等方面还存在一些不足之处 。希望开发者能够重视这些问题，在后续的更新迭代中加以优化和改进。相信在未来，随着技术的不断进步和完善，elmo.chat 将为我们带来更加流畅、便捷的使用体验。如果你也被海量的信息所困扰，不妨尝试一下 elmo.chat，说不定它会成为你在信息海洋中航行的得力助手！\u003c/p\u003e","title":"探索 elmo.chat：AI 驱动的网页内容总结神器"},{"content":"\n一直以来都在拿 ChatGPT 当语音输入法用，识别效果非常好，但毕竟还是不够方便。\n现在终于有好用的基于 Whisper 的语音输入法了，完成度很高，体验很好。目前阶段还是免费的。\nhttps://whisperkeyboard.app/\n罗老师的梦快要实现了。\n","permalink":"http://0x3f.org/posts/whisper-keyboard/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-16-23-34-56-Whisper%20Keyboard.jpeg\" alt=\"2025-01-16-23-34-56-WhisperKeyboard\"\u003e\u003c/p\u003e\n\u003cp\u003e一直以来都在拿 ChatGPT 当语音输入法用，识别效果非常好，但毕竟还是不够方便。\u003c/p\u003e\n\u003cp\u003e现在终于有好用的基于 Whisper 的语音输入法了，完成度很高，体验很好。目前阶段还是免费的。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://whisperkeyboard.app/\"\u003ehttps://whisperkeyboard.app/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e罗老师的梦快要实现了。\u003c/p\u003e","title":"Whisper Keyboard: 非常好用的语音输入法"},{"content":"\n红票的由来与意义 1716 年康熙发出的红票，是寻找派往欧洲使团的公开信，体现了康熙朝的国际视野和开放态度。这也说明后来的禁教原因并不单纯是中西文化差异。\n教士与康熙朝的关系 那时候教士为了传教，用西方文化、艺术和科技来获取清朝上层好感。但康熙只看重西方技术的实用性，对底层科学和思想兴趣不大。康熙朝通过内务府管理教士，教士地位类似包衣，与皇帝更像主仆关系，所以他们能以私人关系接近权贵。正因如此，康熙以内务府接待教廷和沙皇使团，导致西方重要访华活动在清史中无记载。\n礼仪之争 康熙朝后期，罗马教廷认为中国教徒祭祖祭孔违背教义，要求禁止，与清廷起了争议。这让清廷加强了对教士管理，但还不是禁教主因。\n禁教及其影响 雍正继位后禁教，一是他本人信佛且对西方文化技术不感兴趣，二是教士卷入政治斗争。雍正禁教，加上乾隆时耶稣会在欧洲受打压无法再派教士入华，中国就这样错过了 18 世纪西方科技革命的窗口期。\n总之，《康熙的红票》这本书让我们看到了康熙朝中西交流的复杂与多元，也让我们对那段历史有了更深刻的认识。\n","permalink":"http://0x3f.org/posts/a-brief-summary-of-kangxis-red-tickets/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-14-19-54-20-IMG_0224.jpeg\" alt=\"2025-01-14-19-54-20-IMG_0224\"\u003e\u003c/p\u003e\n\u003ch1 id=\"红票的由来与意义\"\u003e红票的由来与意义\u003c/h1\u003e\n\u003cp\u003e1716 年康熙发出的红票，是寻找派往欧洲使团的公开信，体现了康熙朝的国际视野和开放态度。这也说明后来的禁教原因并不单纯是中西文化差异。\u003c/p\u003e\n\u003ch1 id=\"教士与康熙朝的关系\"\u003e教士与康熙朝的关系\u003c/h1\u003e\n\u003cp\u003e那时候教士为了传教，用西方文化、艺术和科技来获取清朝上层好感。但康熙只看重西方技术的实用性，对底层科学和思想兴趣不大。康熙朝通过内务府管理教士，教士地位类似包衣，与皇帝更像主仆关系，所以他们能以私人关系接近权贵。正因如此，康熙以内务府接待教廷和沙皇使团，导致西方重要访华活动在清史中无记载。\u003c/p\u003e\n\u003ch1 id=\"礼仪之争\"\u003e礼仪之争\u003c/h1\u003e\n\u003cp\u003e康熙朝后期，罗马教廷认为中国教徒祭祖祭孔违背教义，要求禁止，与清廷起了争议。这让清廷加强了对教士管理，但还不是禁教主因。\u003c/p\u003e\n\u003ch1 id=\"禁教及其影响\"\u003e禁教及其影响\u003c/h1\u003e\n\u003cp\u003e雍正继位后禁教，一是他本人信佛且对西方文化技术不感兴趣，二是教士卷入政治斗争。雍正禁教，加上乾隆时耶稣会在欧洲受打压无法再派教士入华，中国就这样错过了 18 世纪西方科技革命的窗口期。\u003c/p\u003e\n\u003cp\u003e总之，《康熙的红票》这本书让我们看到了康熙朝中西交流的复杂与多元，也让我们对那段历史有了更深刻的认识。\u003c/p\u003e","title":"《康熙的红票》讲了什么"},{"content":"前几天给 KO2 越狱十分顺滑，没想到昨天给抹茶做的时候竟然每一步都不顺利。\n首先越狱一次没成功，安装 Update Hotfix 并重启后没有出现 Run Hotfix 项。然后重新执行越狱步骤后才成功。\n随后安装 KUAL 时提示“应用程序错误 所选应用程序无法启动”，不过安装后 KUAL 可用，就没有管它，算是有惊无险。\n最后，KOReader 安装后无法启动，没有任何提示，在他的目录中的 crash.log 里找到错误信息说是 reader.lua 文件找不到，但是对应的文件其实是存在的。KOReader 的 GitHub 仓库中有人反馈类似的问题，虽然跟我的情况不完全相同，但是试了一下，是行得通的，安装最新的 nightly build 版本就行了。\n大概是因为新版的 Kindle 发布较晚，越狱程序和 KOReader 没有经过充分的测试，毕竟最初用的 KOReader 稳定版是几个月前发布的。\n","permalink":"http://0x3f.org/posts/kindle-11th-gen-jailbreak-issues/","summary":"\u003cp\u003e前几天给 KO2 越狱十分顺滑，没想到昨天给抹茶做的时候竟然每一步都不顺利。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-12-21-37-19-IMG_3809.jpeg\" alt=\"2025-01-12-21-37-19-IMG_3809\"\u003e\u003c/p\u003e\n\u003cp\u003e首先越狱一次没成功，安装 Update Hotfix 并重启后没有出现 Run Hotfix 项。然后重新执行越狱步骤后才成功。\u003c/p\u003e\n\u003cp\u003e随后安装 KUAL 时提示“应用程序错误 所选应用程序无法启动”，不过安装后 KUAL 可用，就没有管它，算是有惊无险。\u003c/p\u003e\n\u003cp\u003e最后，KOReader 安装后无法启动，没有任何提示，在他的目录中的 crash.log 里找到错误信息说是 reader.lua 文件找不到，但是对应的文件其实是存在的。KOReader 的 GitHub 仓库中有人反馈类似的问题，虽然跟我的情况不完全相同，但是试了一下，是行得通的，安装最新的 \u003ca href=\"https://fw.notmarek.com/khf/koreader/\"\u003enightly build\u003c/a\u003e 版本就行了。\u003c/p\u003e\n\u003cp\u003e大概是因为新版的 Kindle 发布较晚，越狱程序和 KOReader 没有经过充分的测试，毕竟最初用的 KOReader 稳定版是几个月前发布的。\u003c/p\u003e","title":"Kindle 11 代越狱过程中的一些问题"},{"content":"为什么这么做？ 小米官方 Home Assistant 集成的事件订阅机制可是一大亮点，它极大地解放了小米智能组件在 Apple 的 HomeKit 生态中的应用。以往三方集成采用轮询机制，这就导致小米多数的组件响应延迟很大，体验感极差。比如之前安防系统模式变化后几秒钟仪表盘上的组件才改变状态，实在是逼死强迫症。但现在不同了，有了事件订阅机制，组件响应十分及时，我们终于可以在家庭 App 中流畅地调用这些组件实现自动化操作了。\n不过，对于安防系统，小米官方 Home Assistant 集成目前只提供了一个下拉框组件。这在日常使用中可就有些不便了，当你想要快速查看安防状态或者切换模式时，还得费劲地去点开下拉框，既不美观，操作也麻烦。要是能在 Home Assistant 的仪表盘和 Apple 的家庭 App 中，显示专为安防系统设计的组件，那使用起来就顺手多了。所以，就需要把这个下拉框组件对应的 select 实体转换成 alarm_control_panel 实体，接下来就看看具体怎么做吧。\n实操 首先，我们要创建一个 alarm_control_panel 实体，位置在：Settings → Devices \u0026amp; services → Helpers → Create helper → Template helper → Template an alarm control panel。\n在这里，我们需要用模板来进行配置，以下是关键的代码部分：\n1 2 3 4 5 6 7 {% set state_map = { \u0026#39;basic_arming\u0026#39;: \u0026#39;disarmed\u0026#39;, \u0026#39;home_arming\u0026#39;: \u0026#39;armed_home\u0026#39;, \u0026#39;away_arming\u0026#39;: \u0026#39;armed_away\u0026#39;, \u0026#39;sleep_arming\u0026#39;: \u0026#39;armed_night\u0026#39; } %} {{ state_map.get(states(\u0026#39;select.lumi_cn_463684587_mgl03_arming_mode_p_3_1\u0026#39;), \u0026#39;unknown\u0026#39;) }} 这段代码的含义是，我们先定义了一个名为 state_map 的字典，它将小米安防下拉框组件中的不同状态值（如 basic_arming 等）对应翻译成苹果 HomeKit 能识别的 alarm_control_panel 实体状态值（如 disarmed 等）。最后的 {{ state_map.get(states('select.lumi_cn_463684587_mgl03_arming_mode_p_3_1'), 'unknown') }} 这部分，则是获取当前小米安防组件的状态，并通过前面的 state_map 进行转换，如果获取状态失败，就返回 unknown。\n在实际操作时，大家找到对应的创建模板助手位置后，把这段代码准确无误地填写进去。注意，代码中的 select.lumi_cn_463684587_mgl03_arming_mode_p_3_1 要根据你自己设备的实际 entity_id 来填写，如果填错了，就无法正确获取状态信息了。\n创建好这个实体后，我们还需要在 Home Assistant 的仪表盘中添加这个组件，这样就能在 Home Assistant 界面直观地看到安防状态了。添加组件的操作一般是在仪表盘编辑模式下，找到添加安防控件的选项，然后选择我们刚刚创建的 alarm_control_panel 实体即可。\n最后，要想让这个安防状态在苹果的家庭 App 中显示，还需要通过 HomeBridge 把这个实体输出给 HomeKit。如果你之前没有配置过 HomeBridge，需要先进行安装和配置。简单来说，就是在 Home Assistant 中安装 HomeBridge 插件，然后在 HomeBridge 的配置文件中，设置好与 Home Assistant 的连接，确保能获取到我们创建的 alarm_control_panel 实体信息，再将其桥接到 HomeKit 中。这一步可能稍微复杂些，涉及到一些插件的安装和参数配置，但只要按照官方文档或者网上的详细教程操作，也能顺利完成。\n在整个操作过程中，大家要注意几个小细节。一是确保你的小米智能设备与 Home Assistant 连接正常，网络稳定，不然可能会出现状态获取不准确或者延迟的问题。二是在填写代码和配置参数时，一定要仔细核对，一个小标点的错误都可能导致功能无法实现。还有就是软件版本，Home Assistant、HomeBridge 等软件都要确保是兼容的版本，要是版本不匹配，也容易出现各种奇怪的问题。\n结语 通过以上步骤，就成功将小米官方 Home Assistant 集成的安防映射到苹果的家庭 App 中了！以后，就可以在苹果设备上轻松控制小米安防设备，无论是出门在外开启离家模式，还是晚上睡觉前设置睡眠安防模式，都变得便捷又高效。\n如果你在操作过程中遇到任何问题，欢迎随时在评论区留言，大家一起交流探讨。也期待大家分享自己的智能家居使用心得。\n","permalink":"http://0x3f.org/posts/control-xiaomi-alarm-system-using-homekit/","summary":"\u003ch2 id=\"为什么这么做\"\u003e为什么这么做？\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-25-15-52-54-Image%20Dec%2025%202024.jpeg\" alt=\"2024-12-25-15-52-54-ImageDec252024\"\u003e\u003c/p\u003e\n\u003cp\u003e小米官方 Home Assistant 集成的事件订阅机制可是一大亮点，它极大地解放了小米智能组件在 Apple 的 HomeKit 生态中的应用。以往三方集成采用轮询机制，这就导致小米多数的组件响应延迟很大，体验感极差。比如之前安防系统模式变化后几秒钟仪表盘上的组件才改变状态，实在是逼死强迫症。但现在不同了，有了事件订阅机制，组件响应十分及时，我们终于可以在家庭 App 中流畅地调用这些组件实现自动化操作了。\u003c/p\u003e\n\u003cp\u003e不过，对于安防系统，小米官方 Home Assistant 集成目前只提供了一个下拉框组件。这在日常使用中可就有些不便了，当你想要快速查看安防状态或者切换模式时，还得费劲地去点开下拉框，既不美观，操作也麻烦。要是能在 Home Assistant 的仪表盘和 Apple 的家庭 App 中，显示专为安防系统设计的组件，那使用起来就顺手多了。所以，就需要把这个下拉框组件对应的 select 实体转换成 alarm_control_panel 实体，接下来就看看具体怎么做吧。\u003c/p\u003e\n\u003ch2 id=\"实操\"\u003e实操\u003c/h2\u003e\n\u003cp\u003e首先，我们要创建一个 alarm_control_panel 实体，位置在：Settings → Devices \u0026amp; services → Helpers → Create helper → Template helper → Template an alarm control panel。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-08-18-04-03-alarm_01.png\" alt=\"2025-01-08-18-04-03-alarm_01\"\u003e\u003c/p\u003e\n\u003cp\u003e在这里，我们需要用模板来进行配置，以下是关键的代码部分：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{\u003cspan class=\"l\"\u003e% set state_map = {\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#39;basic_arming\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;disarmed\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#39;home_arming\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;armed_home\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#39;away_arming\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;armed_away\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#39;sleep_arming\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;armed_night\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e}\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e%}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e{{\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estate_map.get(states(\u0026#39;select.lumi_cn_463684587_mgl03_arming_mode_p_3_1\u0026#39;), \u0026#39;unknown\u0026#39;) }}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这段代码的含义是，我们先定义了一个名为 \u003ccode\u003estate_map\u003c/code\u003e 的字典，它将小米安防下拉框组件中的不同状态值（如 \u003ccode\u003ebasic_arming\u003c/code\u003e 等）对应翻译成苹果 HomeKit 能识别的 alarm_control_panel 实体状态值（如 \u003ccode\u003edisarmed\u003c/code\u003e 等）。最后的 \u003ccode\u003e{{ state_map.get(states('select.lumi_cn_463684587_mgl03_arming_mode_p_3_1'), 'unknown') }}\u003c/code\u003e 这部分，则是获取当前小米安防组件的状态，并通过前面的 \u003ccode\u003estate_map\u003c/code\u003e 进行转换，如果获取状态失败，就返回 \u003ccode\u003eunknown\u003c/code\u003e。\u003c/p\u003e","title":"小米安防轻松入苹果“家门”，教你一招搞定！"},{"content":"\n我的气泵的美嘴比法嘴好用，所以想把轮胎的法嘴转换成美嘴。\n事先了解过，这种转换头即便打完气不摘下来，气密性也没有问题，实际用下来也确实如此。不过过段时间再打气的时候气泵的美嘴就卡不牢了，很容易弹出来，可能是里面法嘴气门的那个螺栓往回缩了。如果是很老式的那种夹式的气嘴夹头估计也能用，不过新式的就不行了。\n这样可能每次打气都需要把转换头拧出来再拧回去，而且转换头拧起来比气嘴帽困难多了，总体来说不但不方便，还更麻烦了。所以这个东西只能在没有法嘴气筒时临时应个急，不能一直装在上面。\n","permalink":"http://0x3f.org/posts/french-valve-to-american-valve-adapter-not-as-convenient-as-expected/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-02-17-17-46-IMG_3644.jpeg\" alt=\"2025-01-02-17-17-46-IMG_3644\"\u003e\u003c/p\u003e\n\u003cp\u003e我的气泵的美嘴比法嘴好用，所以想把轮胎的法嘴转换成美嘴。\u003c/p\u003e\n\u003cp\u003e事先了解过，这种转换头即便打完气不摘下来，气密性也没有问题，实际用下来也确实如此。不过过段时间再打气的时候气泵的美嘴就卡不牢了，很容易弹出来，可能是里面法嘴气门的那个螺栓往回缩了。如果是很老式的那种夹式的气嘴夹头估计也能用，不过新式的就不行了。\u003c/p\u003e\n\u003cp\u003e这样可能每次打气都需要把转换头拧出来再拧回去，而且转换头拧起来比气嘴帽困难多了，总体来说不但不方便，还更麻烦了。所以这个东西只能在没有法嘴气筒时临时应个急，不能一直装在上面。\u003c/p\u003e","title":"法嘴转美嘴的转换头不像想像中好用"},{"content":"\n平时总有一些食之无肉弃之有味的音视频，我只想了解它的核心观点，而略过大部分的铺垫，这时候用语音转文字的工具把他转换成文本，再由 AI 总结就可以了。\n通义千问有音视频速读和链接速读的功能，用它速通了很多个视频、音频、播客、讲座，转换速读很快，会自动对文字转换稿做总结并生成脑图和要点，而且这个功能还是免费的。\n我一向不太喜欢通过音视频获取信息，因为效率太低了，现在 AI 帮我节省了大量时间，可以用来骑🚴车🚴‍♀️了🚴‍♂️\n","permalink":"http://0x3f.org/posts/qianwen-stt-is-convenient/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2025-01-02-11-33-41-qianwen_stt_01.png\" alt=\"2025-01-02-11-33-41-qianwen_stt_01\"\u003e\u003c/p\u003e\n\u003cp\u003e平时总有一些食之无肉弃之有味的音视频，我只想了解它的核心观点，而略过大部分的铺垫，这时候用语音转文字的工具把他转换成文本，再由 AI 总结就可以了。\u003c/p\u003e\n\u003cp\u003e通义千问有音视频速读和链接速读的功能，用它速通了很多个视频、音频、播客、讲座，转换速读很快，会自动对文字转换稿做总结并生成脑图和要点，而且这个功能还是免费的。\u003c/p\u003e\n\u003cp\u003e我一向不太喜欢通过音视频获取信息，因为效率太低了，现在 AI 帮我节省了大量时间，可以用来骑🚴车🚴‍♀️了🚴‍♂️\u003c/p\u003e","title":"通义千问的音视频速读功能很方便"},{"content":"Miniflux 是个可以自己部署的 RSS 阅读器，我用它省了每年几百块的 Inoreader 订阅费。\n为了提高阅读效率，经常需要给订阅源添加一些过滤规则，过滤掉不关心的内容。\n但是每次都修改订阅源的配置太麻烦了，所以我写了个 Chrome 浏览器的扩展，在每条阅读条目下面添加一个“更新规则”的按钮，这下方便多了。\nhttps://github.com/xbot/chrome-extension-miniflux-enhancer\n","permalink":"http://0x3f.org/posts/miniflux-enhancer-make-adding-miniflux-filter-rules-easier/","summary":"\u003cp\u003eMiniflux 是个可以自己部署的 RSS 阅读器，我用它省了每年几百块的 Inoreader 订阅费。\u003c/p\u003e\n\u003cp\u003e为了提高阅读效率，经常需要给订阅源添加一些过滤规则，过滤掉不关心的内容。\u003c/p\u003e\n\u003cp\u003e但是每次都修改订阅源的配置太麻烦了，所以我写了个 Chrome 浏览器的扩展，在每条阅读条目下面添加一个“更新规则”的按钮，这下方便多了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-31-23-04-53-introduction-01-update-rules.png\" alt=\"2024-12-31-23-04-53-introduction-01-update-rules\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/chrome-extension-miniflux-enhancer\"\u003ehttps://github.com/xbot/chrome-extension-miniflux-enhancer\u003c/a\u003e\u003c/p\u003e","title":"写了个方便添加 Miniflux 过滤规则的 Chrome 扩展"},{"content":"一、为什么要进行映射？ 小米官方 Home Assistant 集成的事件订阅机制，极大的解放了小米智能组件在 Apple 的 HomeKit 生态中的应用！以往三方集成用的是轮询机制，这就导致小米多数组件响应特别慢，体验感超差。例如起夜时，我希望进入洗手间的同时夜灯就点亮，结果等了几秒它才有反应，是不是很让人抓狂？但现在不一样了，有了事件订阅机制，在家庭 App 里调用小米组件实现自动化变得轻松多了，大大提升了使用的流畅度。\n再说说小米的传感器，可能凡是电池供电的都是无状态的。就是只有被触发的时候，才会产生一个事件，而不是像有些传感器那样一直有个持续性的实时状态。所以在小米官方集成里，大多就只提供了一个 event 实体。\n反观家庭 App，里面的传感器是以 sensor 和 binary sensor 的形式存在的。它们都是有状态的实体，不同之处在于，sensor 的状态可以多种多样，能反映不同的数值或情况；而 binary sensor 呢，简单直接，只有两种状态，非此即彼。\n这么一看，问题就来了，要想在家庭 App 里用好小米传感器，就必须把 Home Assistant 里的那个 event 实体，转换成 sensor 或者 binary sensor，这样两边才能对上号，实现更智能的联动。\n二、详细操作步骤 （一）创建存放触发时间的实体 接下来，以小米夜灯的人体传感器为例，介绍实现这一转换的方法。\n首先，要创建一个 input_datetime 类型的实体，用来存放最近一次人体移动事件触发时间。在 Home Assistant 里，路径如下：Settings → Devices \u0026amp; services → Helpers → Create helper → Date and/or time。\n（二）创建更新实体的自动化 紧接着，创建一个 Automation，用于在传感器的 event 触发时保存当前时间到前面那个实体。同样在 Home Assistant 里，找到 Settings → Automations \u0026amp; scenes → Create automation 这个路径。\n图中 Action 的模板内容如下：\n1 2 3 4 5 target: entity_id: input_datetime.ye_deng_last_motion_detected data: timestamp: \u0026#34;{{ as_timestamp(now()) }}\u0026#34; action: input_datetime.set_datetime 这段代码的意思是：当传感器的 event 被触发时，把当前时间（也就是{{ as_timestamp(now()) }} 存到之前创建的input_datetime.ye_deng_last_motion_detected 这个实体里。\n（三）创建判断状态的 binary_sensor 实体 最后一步，创建一个 binary_sensor 类型的实体，根据当前时间和最近一次事件触发时间间隔来判断传感器的状态，它是决定传感器在家庭 App 里显示啥状态的主体。注意把“Device class”设置成正确的传感器类型，例如这里人体传感器对应的是“Motion”。\n图中计算状态的模板内容如下：\n1 {{ (as_timestamp(now()) - as_timestamp(states(\u0026#39;input_datetime.ye_deng_last_motion_detected\u0026#39;) or 0)) \u0026lt; 120 }} 这里设定两分钟之内（也就是 120 秒，这里的时间你可以根据自己的需求调整哦）如果没有新的事件被触发，就认为状态为有人体移动；超出两分钟，就认为是没有人体移动。\n三、这种实现方式的优缺点 （一）优点 首先，它无需手动维护状态，binary_sensor 的状态完全由模板计算。\n其次，实时更新，状态由 Home Assistant 自动刷新，不需要额外写个延迟脚本。\n还有就是持久性。input_datetime 这个实体可以保存触发时间，不会受到 Home Assistant 重启这种问题的影响。\n（二）缺点 binary sensor 的模板是每分钟更新一次，这就导致两分钟的时间间隔不太严格。实际间隔时间可能在两分钟到三分钟之间，稍微有点偏差。当然，如果需要严格按照一个超时时间执行，也可以通过倒计时实现，不过意义不大，这里就不讨论了。\n四、结语 通过以上这些步骤，就可以通过 HomeBridge把小米传感器映射到家庭 App 里了。\n智能家居为我们的生活带来了诸多便利与惊喜，每个人都有着独特的使用心得。也许你通过智能音箱打造了专属的晨起唤醒模式，或是利用智能灯光营造出浪漫晚餐氛围，又或是借助智能窗帘实现了懒人式的阳光管理。不管是怎样的巧妙玩法，都欢迎大家在评论区畅所欲言，分享自己的智能家居小妙招，让我们一同探索智能生活的更多可能，互相启发，把日子过得更加舒适、有趣。\n","permalink":"http://0x3f.org/posts/mapping-xiaomi-sensors-from-home-assistant-to-apple-home-app/","summary":"\u003ch2 id=\"一为什么要进行映射\"\u003e一、为什么要进行映射？\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-25-15-49-31-mac_20241225154742.jpeg\" alt=\"2024-12-25-15-49-31-mac_20241225154742\"\u003e\u003c/p\u003e\n\u003cp\u003e小米官方 Home Assistant 集成的事件订阅机制，极大的解放了小米智能组件在 Apple 的 HomeKit 生态中的应用！以往三方集成用的是轮询机制，这就导致小米多数组件响应特别慢，体验感超差。例如起夜时，我希望进入洗手间的同时夜灯就点亮，结果等了几秒它才有反应，是不是很让人抓狂？但现在不一样了，有了事件订阅机制，在家庭 App 里调用小米组件实现自动化变得轻松多了，大大提升了使用的流畅度。\u003c/p\u003e\n\u003cp\u003e再说说小米的传感器，可能凡是电池供电的都是无状态的。就是只有被触发的时候，才会产生一个事件，而不是像有些传感器那样一直有个持续性的实时状态。所以在小米官方集成里，大多就只提供了一个 event 实体。\u003c/p\u003e\n\u003cp\u003e反观家庭 App，里面的传感器是以 sensor 和 binary sensor 的形式存在的。它们都是有状态的实体，不同之处在于，sensor 的状态可以多种多样，能反映不同的数值或情况；而 binary sensor 呢，简单直接，只有两种状态，非此即彼。\u003c/p\u003e\n\u003cp\u003e这么一看，问题就来了，要想在家庭 App 里用好小米传感器，就必须把 Home Assistant 里的那个 event 实体，转换成 sensor 或者 binary sensor，这样两边才能对上号，实现更智能的联动。\u003c/p\u003e\n\u003ch2 id=\"二详细操作步骤\"\u003e二、详细操作步骤\u003c/h2\u003e\n\u003ch3 id=\"一创建存放触发时间的实体\"\u003e（一）创建存放触发时间的实体\u003c/h3\u003e\n\u003cp\u003e接下来，以小米夜灯的人体传感器为例，介绍实现这一转换的方法。\u003c/p\u003e\n\u003cp\u003e首先，要创建一个 input_datetime 类型的实体，用来存放最近一次人体移动事件触发时间。在 Home Assistant 里，路径如下：Settings → Devices \u0026amp; services → Helpers → Create helper → Date and/or time。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-27-22-54-11-sensor_02.png\" alt=\"2024-12-27-22-54-11-sensor_02\"\u003e\u003c/p\u003e\n\u003ch3 id=\"二创建更新实体的自动化\"\u003e（二）创建更新实体的自动化\u003c/h3\u003e\n\u003cp\u003e紧接着，创建一个 Automation，用于在传感器的 event 触发时保存当前时间到前面那个实体。同样在 Home Assistant 里，找到 Settings → Automations \u0026amp; scenes → Create automation 这个路径。\u003c/p\u003e","title":"小米传感器“入驻”苹果家庭App，智能生活轻松拿捏"},{"content":"消息订阅机制 —— 最大亮点 小米官方 Home Assistant 集成最大的优势，就是其基于消息订阅机制的通信方式。这相较于第三方集成常用的轮询方式，有着质的飞跃。在以往的第三方集成中，设备状态的获取往往依赖于轮询，每隔一段时间才去检查设备状态是否有变化，这就导致了信息的延迟，用户操作后不能及时得到设备的反馈，体验大打折扣。\n而小米官方集成的消息订阅机制则像是给设备安装了一个实时传声筒。当设备属性发生改变或者有事件产生时，设备会迅速向小米云或小米中枢网关发送上行消息，米家集成就能在第一时间接收到这些消息并更新设备状态，无需频繁地刷新查询。这就使得小米的智能家居配件在 Home Assistant 和 HomeKit 生态中的响应变得极其及时，真正实现了设备状态的实时掌控。比如灯的开关、窗帘的开合、空调的温度调节等操作，都能瞬间得到执行和反馈，让用户感受到智能家居的便捷与高效，极大地提升了用户的智能家居体验。\nOAuth2 登录方式 —— 可能每周都要重新登录 小米官方 Home Assistant 集成采用的 OAuth2 登录方式，其实有着诸多安全性方面的优势。它允许客户端不接触用户密码，服务器端能够更集中地保护用户信息，所有认证和授权信息都汇聚在服务器端，而非分散于各个客户端，大大减少了用户凭据泄露的风险。而且 OAuth2 还是一个应用广泛的认证标准，很多公司和组织都采用了它，这也让小米的智能家居配件在集成应用时更容易与其他平台或服务进行交互、整合。\n然而，在实际使用一周的体验中，也发现了不太方便的地方，那就是登录有效期的问题。使用一周之后，系统就会提示登录过期，需要重新登录。这在日常使用中，尤其是频繁操作智能家居设备时，还是挺影响体验的。每隔一段时间都要重新登录，操作步骤变得繁琐，打断了原本便捷的智能家居操控流程。\n据说这个 bug 会在未来的版本中解决。\n额外配置 安防控制面板显示 对于我在用的小米智能多模网关，小米官方 Home Assistant 集成并没有提供 HA 的安防控制面板实体，而是提供了一个基本的 select 实体。如果要在 HA 的仪表板和家庭 App 中显示安防控制面板，就需要把安防系统的 select 实体转换成 alarm_control_panel 实体。\n传感器实体转换 对于移动检测传感器和烟雾传感器这样的配件，小米官方 Home Assistant 集成没有提供对应的 binary_sensor 实体，而是 event 实体，这当然很符合小米配件的行为模式，但如果需要把它们输出到 Apple 的家庭 App ，就需要将其转换成 binary_sensor 实体。这是因为家庭 App 无法处理 HA 中的 event 实体，而转换成binary_sensor 实体才能被识别为对应的传感器，也更便于与其他智能设备进行联动。\n扫地机打扫指定的房间 在设置扫地机打扫指定房间的自动化时，需要自己获取房间 ID，这也是小米官方 Home Assistant 集成中一个不太便捷的地方。与第三方集成相比，这里的房间 ID 获取方式不同，且操作相对复杂一些。\n总结与展望 通过这一周对小米官方 Home Assistant 集成的体验，总体来说，它有着基于消息订阅机制的通信这一突出优势，让智能家居设备的响应及时性得到了质的提升，为用户带来了更流畅、高效的操控体验，也让小米智能家居在 Home Assistant 和 HomeKit 生态中的融合更加紧密和实用。\n不知道大家在使用小米官方 Home Assistant 集成时有没有遇到其他问题或者有什么独特的使用心得呢？欢迎在评论区留言分享，让我们一起探索智能家居的无限可能！\n","permalink":"http://0x3f.org/posts/one-week-experience-of-xiaomi-official-home-assistant-integration/","summary":"\u003ch2 id=\"消息订阅机制--最大亮点\"\u003e消息订阅机制 —— 最大亮点\u003c/h2\u003e\n\u003cp\u003e小米官方 Home Assistant 集成最大的优势，就是其基于消息订阅机制的通信方式。这相较于第三方集成常用的轮询方式，有着质的飞跃。在以往的第三方集成中，设备状态的获取往往依赖于轮询，每隔一段时间才去检查设备状态是否有变化，这就导致了信息的延迟，用户操作后不能及时得到设备的反馈，体验大打折扣。\u003c/p\u003e\n\u003cp\u003e而小米官方集成的消息订阅机制则像是给设备安装了一个实时传声筒。当设备属性发生改变或者有事件产生时，设备会迅速向小米云或小米中枢网关发送上行消息，米家集成就能在第一时间接收到这些消息并更新设备状态，无需频繁地刷新查询。这就使得小米的智能家居配件在 Home Assistant 和 HomeKit 生态中的响应变得极其及时，真正实现了设备状态的实时掌控。比如灯的开关、窗帘的开合、空调的温度调节等操作，都能瞬间得到执行和反馈，让用户感受到智能家居的便捷与高效，极大地提升了用户的智能家居体验。\u003c/p\u003e\n\u003ch2 id=\"oauth2-登录方式--可能每周都要重新登录\"\u003eOAuth2 登录方式 —— 可能每周都要重新登录\u003c/h2\u003e\n\u003cp\u003e小米官方 Home Assistant 集成采用的 OAuth2 登录方式，其实有着诸多安全性方面的优势。它允许客户端不接触用户密码，服务器端能够更集中地保护用户信息，所有认证和授权信息都汇聚在服务器端，而非分散于各个客户端，大大减少了用户凭据泄露的风险。而且 OAuth2 还是一个应用广泛的认证标准，很多公司和组织都采用了它，这也让小米的智能家居配件在集成应用时更容易与其他平台或服务进行交互、整合。\u003c/p\u003e\n\u003cp\u003e然而，在实际使用一周的体验中，也发现了不太方便的地方，那就是登录有效期的问题。使用一周之后，系统就会提示登录过期，需要重新登录。这在日常使用中，尤其是频繁操作智能家居设备时，还是挺影响体验的。每隔一段时间都要重新登录，操作步骤变得繁琐，打断了原本便捷的智能家居操控流程。\u003c/p\u003e\n\u003cp\u003e据说这个 bug 会在未来的版本中解决。\u003c/p\u003e\n\u003ch2 id=\"额外配置\"\u003e额外配置\u003c/h2\u003e\n\u003ch3 id=\"安防控制面板显示\"\u003e安防控制面板显示\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-25-15-52-54-Image%20Dec%2025%202024.jpeg\" alt=\"2024-12-25-15-52-54-ImageDec252024\"\u003e\u003c/p\u003e\n\u003cp\u003e对于我在用的小米智能多模网关，小米官方 Home Assistant 集成并没有提供 HA 的安防控制面板实体，而是提供了一个基本的 select 实体。如果要在 HA 的仪表板和家庭 App 中显示安防控制面板，就需要把安防系统的 select 实体转换成 alarm_control_panel 实体。\u003c/p\u003e\n\u003ch3 id=\"传感器实体转换\"\u003e传感器实体转换\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-25-15-49-31-mac_20241225154742.jpeg\" alt=\"2024-12-25-15-49-31-mac_20241225154742\"\u003e\u003c/p\u003e\n\u003cp\u003e对于移动检测传感器和烟雾传感器这样的配件，小米官方 Home Assistant 集成没有提供对应的 binary_sensor 实体，而是 event 实体，这当然很符合小米配件的行为模式，但如果需要把它们输出到 Apple 的家庭 App ，就需要将其转换成 binary_sensor 实体。这是因为家庭 App 无法处理 HA 中的 event 实体，而转换成binary_sensor 实体才能被识别为对应的传感器，也更便于与其他智能设备进行联动。\u003c/p\u003e","title":"小米官方的 Home Assistant 集成一周体验"},{"content":"一、为什么需要独立书签管理服务 1. 降低迁移浏览器成本 在我们日常使用浏览器的过程中，经常会遇到需要更换主力浏览器的情况。而每次迁移浏览器时，重新导入书签是一件非常繁琐的事情。有了独立的书签管理服务，就可以大大降低这种迁移成本。我们无需再为了导入书签而耗费大量时间和精力，轻松实现浏览器的切换。\n2. 降低同步数据成本 在使用多个浏览器或者在不同设备（如在家和公司电脑）之间切换时，书签的同步问题常常让人头疼。如果没有独立的书签管理服务，我们可能需要依赖浏览器自带或者某些插件提供的同步功能，但这往往会带来数据错乱和丢失的风险。而有了独立的书签管理服务，我们就可以避免这些问题，确保书签数据的安全和稳定。\n3. 方便管理 Raycast 插件是一个非常强大的工具，结合相关插件，可以让我们方便地搜索书签，并且能够对书签进行修改或删除操作。相比之下，以前使用的 Raycast 浏览器书签插件虽然搜索功能好用，但是缺乏管理功能。有了独立的书签管理服务，我们就可以充分发挥 Raycast 的优势，更加高效地管理我们的书签。\n二、为什么自建书签管理服务 数据掌握在自己手中，配合 3 - 2 - 1 备份策略，既省钱又放心。\n在当今数字化的时代，我们的生活越来越依赖于各种电子设备和在线服务。然而，这也带来了一个问题，那就是我们的数据安全和隐私问题。如果我们仅仅依赖于浏览器自带的书签同步功能，那么我们的数据就可能会面临被泄露、丢失或者被篡改的风险。\n而自建书签管理服务，就可以很好地解决这个问题。通过自建书签管理服务，我们可以将自己的数据掌握在自己的手中，不用担心数据被第三方机构窃取或者滥用。同时，我们还可以配合 3 - 2 - 1 备份策略，确保我们的数据安全可靠。\n3 - 2 - 1 备份策略是一种非常有效的数据备份方法，它的基本原理是：至少保留 3 份数据备份，存储在 2 种不同的介质上，并确保 1 份备份异地存储，以提高数据安全性和恢复能力。这样，即使我们的硬盘损坏、电脑被盗或者遭遇自然灾害，我们的数据也不会丢失。\n自建书签管理服务可以让我们更加方便地实施 3 - 2 - 1 备份策略。我们可以将书签数据备份到本地硬盘、外部硬盘或者云存储服务上，确保我们的数据安全可靠。同时，我们还可以定期对备份数据进行检查和更新，确保备份数据的完整性和可用性。\n总之，自建书签管理服务可以让我们的数据更加安全可靠，同时也可以让我们更加方便地管理和使用自己的数据。如果你还在为数据安全和隐私问题而担忧，那么不妨考虑自建书签管理服务，让你的数据掌握在自己的手中。\n三、linkding 的特点 简洁高效 linkding 的用户界面设计简洁直观，没有复杂的布局和过多的干扰元素。无论是网页界面还是移动端应用，都以清晰的布局和简洁的设计呈现，让用户能够快速聚焦于书签内容本身。优化后的可读性使得用户可以轻松浏览和管理自己的书签，无需在繁琐的界面中费力寻找所需信息。\nlinkding 强调快速和无干扰的操作体验。用户可以高效地进行各种书签管理操作，如添加、编辑、删除等。其操作流程简单明了，无需复杂的步骤即可完成对书签的管理。无论是在忙碌的工作中还是日常的浏览中，linkding 都能让用户节省时间，提高效率。\n功能丰富 标签分类：linkding 支持基于标签的书签组织方式，用户可以根据自己的需求和喜好为书签添加各种标签。这种多标签的方式使得书签的分类更加灵活多样，用户可以通过点击相应的标签快速找到所需的书签。例如，用户可以为一个关于编程的网页添加 “编程”、“Python”、“开发工具” 等多个标签，当需要查找 Python 相关的书签时，只需搜索或点击 “Python” 标签即可。\n批量编辑：linkding 提供批量编辑功能，用户可以一次性对多个书签进行相同的操作。比如，当用户需要为一批书签添加相同的标签或修改注释时，可以使用批量编辑功能，大大提高了书签管理的效率。无需逐个编辑书签，节省了大量的时间和精力。\n添加注释：linkding 支持使用 Markdown 语法添加注释，用户可以为书签添加详细的说明、备注或个人见解等。Markdown 语法的使用使得注释更加清晰易读，同时也方便用户进行格式化和排版。例如，用户可以为一个重要的研究资料网页添加注释，记录自己的思考和分析，以便日后查阅。\n稍后阅读：linkding 具有基本的 “稍后读” 功能，用户可以将暂时没有时间阅读的网页标记为未读。这个功能方便用户在有时间时再进行查看，提高了信息获取的灵活性。\n分享书签：linkding 允许用户与其他用户或访客分享书签，促进信息共享和协作。无论是团队合作项目还是与朋友、家人分享有趣的网页，这个功能都非常实用。用户可以通过分享书签，与他人共同探讨和学习，拓展自己的知识视野。\n网页归档：linkding 能够自动为书签的网页创建快照并上传至 Internet Archive。这样，即使网页内容发生变化或无法访问时，用户也可以查看原始内容。对于一些重要的网页资料，这个功能可以确保用户不会因为网页的变动而丢失关键信息。\n多用户支持：linkding 支持多个用户使用，每个用户都可以拥有自己的书签集合，并且可以根据需要共享书签。适用于团队、家庭或多人共享的场景，不同用户可以根据自己的需求管理和使用书签，同时也可以方便地与他人共享有价值的书签资源。\n易于部署和维护 linkding 设计为通过 Docker 进行部署，具有轻量级和易于安装的特点。即使是不熟悉服务器管理的用户也能轻松上手，降低了部署的难度和门槛。用户只需按照简单的步骤进行操作，即可在自己的服务器上部署 linkding，享受个性化的书签管理服务。\n数据库选择灵活：linkding 默认使用 SQLite 数据库，同时也支持 PostgreSQL。用户可以根据自己的需求和环境选择合适的数据库，提供了更多的灵活性和可扩展性。如果用户的书签数据量较小，可以选择使用 SQLite 数据库，而对于需要高并发或更大规模数据存储的用户，则可以选择 PostgreSQL 数据库。\n低维护成本：linkding 采用单一的 Docker 容器，并且具有自动迁移和零破坏性更改的特点。这减少了维护和更新的工作量和风险。用户无需担心因软件升级而导致的数据丢失或兼容性问题，linkding 能够自动处理这些情况，让用户的书签管理更加稳定可靠。\n可扩展性强 linkding 为 Firefox 和 Chrome 浏览器提供了官方扩展，用户可以通过浏览器的地址栏快速添加书签、搜索书签等。无需打开 linkding 的界面，方便在浏览网页时随时进行书签管理。\nlinkding 提供了 REST API，开发人员可以利用该 API 开发脚本或第三方应用程序，与其他工具或服务进行集成。实现更多个性化的功能和扩展应用，满足不同用户的特殊需求。例如，开发人员可以利用 REST API 将 linkding 与其他知识管理工具进行集成，打造更加高效的工作流程。\n四、linkding 的不足 产品设计较为传统 管理后台和前台分开，操作麻烦，如标签删除或改名需去管理后台。这一设计在实际使用中确实给用户带来了一些不便。当我们需要对标签进行管理时，不得不切换到管理后台进行操作，打断了原本的工作流程。相比一些将管理功能集成在前台界面的工具，linkding 在这方面显得较为传统。 没有移动端的支持\n目前，linkding 在移动端的支持相对有限。虽然通过快捷指令调用 API 可以在一定程度上满足保存书签的需求，但与拥有原生 App 的工具相比，使用起来还是不够便捷。此外，如果原生 App 实现对操作系统全局搜索的支持，那就太好用了！\n不支持模糊搜索和拼音检索 这两项功能是我最怀念 Raycast 的浏览器书签插件的原因，在面对大量书签时，模糊搜索可以帮助用户快速找到相关的书签，即使输入的关键词不太准确。而拼音检索则可以让用户在不必输入具体汉字的情况下，通过拼音快速找到目标书签。缺乏这两项功能，使得用户在搜索书签时可能需要花费更多的时间和精力。\n五、与 Hoarder 和 Readeck 的对比 1. Hoarder 特点： Hoarder 的网页界面设计精美，给用户带来良好的视觉感受和操作体验。 用户不仅可以收集网页链接，还能轻松收集文本和图片内容，并且有官方手机 App，方便在移动设备上进行管理。 借助 AI 技术，Hoarder 能够自动为收集的内容打标签并进行总结，同时支持全文检索，方便用户快速找到所需信息。 不足： 在使用 Raycast 扩展时，Hoarder 会优先搜索本地缓存数据，这可能导致搜索结果不完整，需要进一步触发远程搜索，较为麻烦。 Hoarder 在抓取网页时效果不尽如人意，尤其是对于需要登录的页面，抓取的信息往往不准确。 与一些其他工具相比，Hoarder 不支持导出 Netscape 格式的数据，在数据兼容性方面存在一定局限性。 如果 Hoarder 的 WebUI 在后台待机时间过长，当用户激活浏览器标签页时，可能会出现卡死的情况，影响使用体验。 虽然 Hoarder 具备对 AI 的支持，但本地部署的情况下，受限于家庭计算机的性能，其速度和准确度都不够理想，这在一定程度上影响了用户的使用感受。 Hoarder 依赖较重，总共包含 4 个 Docker 容器，然而其中的 AI 和网页抓取功能体验一般，使得这些依赖关系更显鸡肋。 2. Readeck 特点： Readeck 直接从当前页面抓取网页数据，对于需要登录的网页，能够较为准确地抓取信息。 它对抓取的网页进行了优化处理，提高了网页的可读性，让用户阅读起来更加舒适。 用户可以创建集合，当网页符合特定搜索条件时，会自动出现在集合中，方便用户进行分类管理。 Readeck 支持将网页内容导出为 epub 电子书格式，方便用户在电子设备上进行阅读。 不足： 与一些其他工具相比，Readeck 不支持对网页进行备注，在功能上存在一定的缺失。 Readeck 的 Raycast 扩展在管理功能方面较为薄弱，无法满足用户对书签进行高效管理的需求。 在进行网页收集操作时，Readeck 需要等待几秒钟，这使得整个收集过程不够流畅，影响了用户的使用体验。 六、结论 Hoarder 更像是个大号的 linkding，或者说是个功能更多的资源收集器，提供了最多的收集方式，可以抓取资源的内容并通过 AI 打标签和做总结，能做全文检索。但是作为特色的 AI 功能在我这里暂时不能得到足够好的体验，作为入口的 Raycast 扩展也有待进一步完善。\nReadeck 实质上是个稍后读工具，从当前网页同步收集数据的方式提高了对网页内容可读性的处理质量和对需要登录验证的内容的收集成功率，但也导致收集体验不流畅。\nlinkding 很纯粹，在核心需求上做到恰好可用是我决定用它的原因，所以克制有时候也是优势。虽然管理后台和前台分开操作麻烦，但它专注于书签管理的核心需求，没有过多复杂的功能和繁琐的设置。相比 Hoarder，linkding 虽然功能相对较少，但不会有 AI 性能和准确度差、Raycast 搜索结果不全等问题。与 Readeck 相比，linkding 虽然没有对网页内容可读性的处理，也没有创建集合和导出 epub 电子书等功能，但它在操作上更加简洁直接，不会有收集操作等待几秒不流畅、缺乏备注和 Raycast 扩展管理功能弱等不足。总的来说，linkding 在众多书签管理工具中以其简洁纯粹的特点脱颖而出，满足了我对书签管理的核心需求。\n","permalink":"http://0x3f.org/posts/why-do-i-use-linkding-as-my-bookmark-manager/","summary":"\u003ch1 id=\"一为什么需要独立书签管理服务\"\u003e一、为什么需要独立书签管理服务\u003c/h1\u003e\n\u003ch2 id=\"1-降低迁移浏览器成本\"\u003e1. 降低迁移浏览器成本\u003c/h2\u003e\n\u003cp\u003e在我们日常使用浏览器的过程中，经常会遇到需要更换主力浏览器的情况。而每次迁移浏览器时，重新导入书签是一件非常繁琐的事情。有了独立的书签管理服务，就可以大大降低这种迁移成本。我们无需再为了导入书签而耗费大量时间和精力，轻松实现浏览器的切换。\u003c/p\u003e\n\u003ch2 id=\"2-降低同步数据成本\"\u003e2. 降低同步数据成本\u003c/h2\u003e\n\u003cp\u003e在使用多个浏览器或者在不同设备（如在家和公司电脑）之间切换时，书签的同步问题常常让人头疼。如果没有独立的书签管理服务，我们可能需要依赖浏览器自带或者某些插件提供的同步功能，但这往往会带来数据错乱和丢失的风险。而有了独立的书签管理服务，我们就可以避免这些问题，确保书签数据的安全和稳定。\u003c/p\u003e\n\u003ch2 id=\"3-方便管理\"\u003e3. 方便管理\u003c/h2\u003e\n\u003cp\u003eRaycast 插件是一个非常强大的工具，结合相关插件，可以让我们方便地搜索书签，并且能够对书签进行修改或删除操作。相比之下，以前使用的 Raycast 浏览器书签插件虽然搜索功能好用，但是缺乏管理功能。有了独立的书签管理服务，我们就可以充分发挥 Raycast 的优势，更加高效地管理我们的书签。\u003c/p\u003e\n\u003ch1 id=\"二为什么自建书签管理服务\"\u003e二、为什么自建书签管理服务\u003c/h1\u003e\n\u003cp\u003e数据掌握在自己手中，配合 3 - 2 - 1 备份策略，既省钱又放心。\u003c/p\u003e\n\u003cp\u003e在当今数字化的时代，我们的生活越来越依赖于各种电子设备和在线服务。然而，这也带来了一个问题，那就是我们的数据安全和隐私问题。如果我们仅仅依赖于浏览器自带的书签同步功能，那么我们的数据就可能会面临被泄露、丢失或者被篡改的风险。\u003c/p\u003e\n\u003cp\u003e而自建书签管理服务，就可以很好地解决这个问题。通过自建书签管理服务，我们可以将自己的数据掌握在自己的手中，不用担心数据被第三方机构窃取或者滥用。同时，我们还可以配合 3 - 2 - 1 备份策略，确保我们的数据安全可靠。\u003c/p\u003e\n\u003cp\u003e3 - 2 - 1 备份策略是一种非常有效的数据备份方法，它的基本原理是：至少保留 3 份数据备份，存储在 2 种不同的介质上，并确保 1 份备份异地存储，以提高数据安全性和恢复能力。这样，即使我们的硬盘损坏、电脑被盗或者遭遇自然灾害，我们的数据也不会丢失。\u003c/p\u003e\n\u003cp\u003e自建书签管理服务可以让我们更加方便地实施 3 - 2 - 1 备份策略。我们可以将书签数据备份到本地硬盘、外部硬盘或者云存储服务上，确保我们的数据安全可靠。同时，我们还可以定期对备份数据进行检查和更新，确保备份数据的完整性和可用性。\u003c/p\u003e\n\u003cp\u003e总之，自建书签管理服务可以让我们的数据更加安全可靠，同时也可以让我们更加方便地管理和使用自己的数据。如果你还在为数据安全和隐私问题而担忧，那么不妨考虑自建书签管理服务，让你的数据掌握在自己的手中。\u003c/p\u003e\n\u003ch1 id=\"三linkding-的特点\"\u003e三、linkding 的特点\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-13-23-45-05-linkding.jpeg\" alt=\"2024-12-13-23-45-05-linkding\"\u003e\u003c/p\u003e\n\u003ch2 id=\"简洁高效\"\u003e简洁高效\u003c/h2\u003e\n\u003cp\u003elinkding 的用户界面设计简洁直观，没有复杂的布局和过多的干扰元素。无论是网页界面还是移动端应用，都以清晰的布局和简洁的设计呈现，让用户能够快速聚焦于书签内容本身。优化后的可读性使得用户可以轻松浏览和管理自己的书签，无需在繁琐的界面中费力寻找所需信息。\u003c/p\u003e\n\u003cp\u003elinkding 强调快速和无干扰的操作体验。用户可以高效地进行各种书签管理操作，如添加、编辑、删除等。其操作流程简单明了，无需复杂的步骤即可完成对书签的管理。无论是在忙碌的工作中还是日常的浏览中，linkding 都能让用户节省时间，提高效率。\u003c/p\u003e\n\u003ch2 id=\"功能丰富\"\u003e功能丰富\u003c/h2\u003e\n\u003cp\u003e标签分类：linkding 支持基于标签的书签组织方式，用户可以根据自己的需求和喜好为书签添加各种标签。这种多标签的方式使得书签的分类更加灵活多样，用户可以通过点击相应的标签快速找到所需的书签。例如，用户可以为一个关于编程的网页添加 “编程”、“Python”、“开发工具” 等多个标签，当需要查找 Python 相关的书签时，只需搜索或点击 “Python” 标签即可。\u003c/p\u003e\n\u003cp\u003e批量编辑：linkding 提供批量编辑功能，用户可以一次性对多个书签进行相同的操作。比如，当用户需要为一批书签添加相同的标签或修改注释时，可以使用批量编辑功能，大大提高了书签管理的效率。无需逐个编辑书签，节省了大量的时间和精力。\u003c/p\u003e","title":"我为什么用 linkding 自建书签管理服务"},{"content":"\n上周六风很大，被迫放弃去大运河骑车，窝在家里改 Raycast 的 linkding 扩展。\nRaycast 是一个 macOS 上的应用启动器和效率工具，类似 Spotlight 和 Alfred ，可以快速访问各类应用、文件等。linkding 是一个可以自己部署的书签管理工具，可以替代浏览器的书签管理功能，同时提供更强大、更灵活的特性。Raycast 的 linkding 扩展可以对存储在 linkding 中的书签做快速检索和管理的操作。\n这个扩展原本的界面和功能比较简陋，我给它加了以下内容：\n可选择是否在列表中显示网站的图标。 可选择是否在列表中显示副标题。 可选择副标题区域显示网址的描述或者备注。 增加编辑书签的功能。 创建和编辑书签时可以给书签打 tag 。 删除书签和 linkding 账户时弹出确认对话框，防止误删。 增加在浏览器中打开 linkding 书签查看和编辑页面的功能。 在原作者合并 PR 之前，可以下载这个 repo 的源码，并执行：\n1 npm install \u0026amp;\u0026amp; npm run dev ","permalink":"http://0x3f.org/posts/added-some-features-to-the-linkding-extension-of-raycast/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-09-22-28-45-Image%201080x1439.jpeg\" alt=\"2024-12-09-22-28-45-Image1080x1439\"\u003e\u003c/p\u003e\n\u003cp\u003e上周六风很大，被迫放弃去大运河骑车，窝在家里改 Raycast 的 linkding 扩展。\u003c/p\u003e\n\u003cp\u003eRaycast 是一个 macOS 上的应用启动器和效率工具，类似 Spotlight 和 Alfred ，可以快速访问各类应用、文件等。linkding 是一个可以自己部署的书签管理工具，可以替代浏览器的书签管理功能，同时提供更强大、更灵活的特性。Raycast 的 linkding 扩展可以对存储在 linkding 中的书签做快速检索和管理的操作。\u003c/p\u003e\n\u003cp\u003e这个扩展原本的界面和功能比较简陋，我给它加了以下内容：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e可选择是否在列表中显示网站的图标。\u003c/li\u003e\n\u003cli\u003e可选择是否在列表中显示副标题。\u003c/li\u003e\n\u003cli\u003e可选择副标题区域显示网址的描述或者备注。\u003c/li\u003e\n\u003cli\u003e增加编辑书签的功能。\u003c/li\u003e\n\u003cli\u003e创建和编辑书签时可以给书签打 tag 。\u003c/li\u003e\n\u003cli\u003e删除书签和 linkding 账户时弹出确认对话框，防止误删。\u003c/li\u003e\n\u003cli\u003e增加在浏览器中打开 linkding 书签查看和编辑页面的功能。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-09-22-36-05-Image%201500x948%20(1).jpeg\" alt=\"2024-12-09-22-36-05-Image1500x948(1)\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-09-22-36-54-Image%201500x948.jpeg\" alt=\"2024-12-09-22-36-54-Image1500x948\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-09-22-37-24-Image%201662x1080.jpeg\" alt=\"2024-12-09-22-37-24-Image1662x1080\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-12-09-22-37-55-Image%201500x948%20(2).jpeg\" alt=\"2024-12-09-22-37-55-Image1500x948(2)\"\u003e\u003c/p\u003e\n\u003cp\u003e在原作者合并 PR 之前，可以下载这个 \u003ca href=\"https://github.com/xbot/raycast-linkding\"\u003erepo\u003c/a\u003e 的源码，并执行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm install \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e npm run dev\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"给 Raycast 的 linkding 扩展加了点功能"},{"content":"上月中旬，发现两只猫分别出现软便、频繁呕吐的现象，以为是寄生虫的问题，用大宠爱和海乐妙做了内外驱。\n观察了几天，喂了乳酸菌素片之后软便现象好转，但没有根除，而呕吐的现象时轻时重，后来发展成呕吐物中带血丝或者粉水的程度。感觉问题严重了，准备去医院检查一下。\n但是两只猫都是从小收养，除了刚开始的一两年打疫苗，之后几乎没出过门，现在大了反而没有小时候胆大，一出门就应激，喊得全小区的灯都亮了。不得已放弃。\n根据它俩最近的情况，判断应该是换季+换粮导致的肠胃炎，买了阿莫西林克拉维酸钾颗粒和奥美拉唑肠溶胶囊，按前者 12.5-25mg/kg 、后者 1mg/kg 的剂量结合每只猫的体重喂服，一天两次。\n喂药是个艰苦卓绝的活儿，阿莫西林还算简单，混到罐头里就行，胶囊因为是肠溶的，需要直接吞服，可费老劲了，不过虽然直接喂死活不吃，但是有次喂完老大，身心俱疲地去洗了个手，回来发现它把老二的胶囊偷吃了！贱不贱，你就说贱不贱！\n就这样喂了三天，期间喂用温水泡发的干粮，少食多餐，之前的症状没了，就停了药。但是一吃干粮就容易吐，吃湿粮和罐头不吐，判断是肠胃还比较虚弱，所以又继续喂了一两周的湿粮。\n现在一个月过去了，已经完全康复了。\n","permalink":"http://0x3f.org/posts/how-i-cured-my-cats-gastroenteritis/","summary":"\u003cp\u003e上月中旬，发现两只猫分别出现软便、频繁呕吐的现象，以为是寄生虫的问题，用大宠爱和海乐妙做了内外驱。\u003c/p\u003e\n\u003cp\u003e观察了几天，喂了乳酸菌素片之后软便现象好转，但没有根除，而呕吐的现象时轻时重，后来发展成呕吐物中带血丝或者粉水的程度。感觉问题严重了，准备去医院检查一下。\u003c/p\u003e\n\u003cp\u003e但是两只猫都是从小收养，除了刚开始的一两年打疫苗，之后几乎没出过门，现在大了反而没有小时候胆大，一出门就应激，喊得全小区的灯都亮了。不得已放弃。\u003c/p\u003e\n\u003cp\u003e根据它俩最近的情况，判断应该是换季+换粮导致的肠胃炎，买了阿莫西林克拉维酸钾颗粒和奥美拉唑肠溶胶囊，按前者 12.5-25mg/kg 、后者 1mg/kg 的剂量结合每只猫的体重喂服，一天两次。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-30-22-47-22-IMG_3253.jpeg\" alt=\"2024-10-30-22-47-22-IMG_3253\"\u003e\u003c/p\u003e\n\u003cp\u003e喂药是个艰苦卓绝的活儿，阿莫西林还算简单，混到罐头里就行，胶囊因为是肠溶的，需要直接吞服，可费老劲了，不过虽然直接喂死活不吃，但是有次喂完老大，身心俱疲地去洗了个手，回来发现它把老二的胶囊偷吃了！贱不贱，你就说贱不贱！\u003c/p\u003e\n\u003cp\u003e就这样喂了三天，期间喂用温水泡发的干粮，少食多餐，之前的症状没了，就停了药。但是一吃干粮就容易吐，吃湿粮和罐头不吐，判断是肠胃还比较虚弱，所以又继续喂了一两周的湿粮。\u003c/p\u003e\n\u003cp\u003e现在一个月过去了，已经完全康复了。\u003c/p\u003e","title":"两只猫的肠胃炎历险记"},{"content":"\n车把 M 把的问题：\n蓝图 A7 这个指拨太长，微调旋钮离 M 把很近，所以变速线改为从头管后侧走线，这导致在头管上安装水壶架变得很困难。 抛光银的反光左右不一致，导致看起来车把左右不对称。虽然实际骑起来感受不到明显的差异，但是强迫症还是比较难受。 时速 22 公里以上不好发力。 改成直把可以解决以上问题。\n座垫 原装座垫非常不舒服，我穿骑行裤骑了不到 30 公里就屁股疼，换了 taozik 仿闪电的座垫骑 100 多公里也没事。\n脚踏 原装铝合金折叠脚踏容易异响，而且鞋底沾点水就非常滑。有拎车需求的话换快拆脚踏，没有就用普通脚踏，英布原装的单边折叠脚踏也是个不错的选项。\n货架 原装货架除了好看全是缺点。CNC 铝合金零件拼装的，强度很差，折叠后不能为车身提供足够的支撑力，表现为在地铁、公交上能看到折叠后的车身相对于货架出现明显的晃动，以及推行的时候出现相对严重的偏向问题。这个问题同时削弱了折叠后的稳定性，为了解决这个问题，原装货架上内置了易行轮伸缩杆的结构。伸缩杆的问题有两个，一是增加了一步操作，非常麻烦，二是强度差，在地铁站这种遍布盲道的地面拉开伸缩杆推行容易坏，不拉开容易倒，只能在折叠后静置停放时使用，有点鸡肋。\n曾经换装过青春版的货架，焊接一体的结构决定了在支撑力和一体性方面远超城市版，但它的问题一是比较粗大，外观和城市版不太协调，二是品控一般，有一个易行轮不着地。\n最后我换装了这个一百块出头的货架，重量更轻，外观比同为焊接、喷砂银的青春版货架更好看，四轮着地，推行和静置时比之前两个稳了很多。\n挡泥板 一副挡泥板最大的耻辱就是挡不了泥，而它做到了。佰客的挡泥板一是没有挡泥皮，二是后挡太短，会有少量的泥水甩到身上。据说可以安装如图所示的挡泥皮，但是因为佰客的挡泥板只能搭配同厂货架使用，而我想换掉货架，所以选择直接换装英布的后挡泥板。此外，我用一块人造革给前挡剪了一片挡泥皮。\n总结 国布一般都会宣传自己解决了英布这样那样的问题，但英布的很多问题是为了保证核心价值而妥协的结果，不是不能改，但不能以牺牲核心价值为代价。在佰客的车身上，我看到一些为了美观而牺牲实用性的所谓“改进”，对于这些我都不能苟同，好在车身几何比较接近英布，没有做加大开档、拉长大梁、跟风上碟刹这种不可逆的负优化，尚可挽救一下。\n解决完以上问题，佰客城市版就是辆很好的国布了，整车好骑、轻快，轮组很润，变速顺滑，亮面漆搭配亮面银的风格也符合我的审美。\n","permalink":"http://0x3f.org/posts/bikes-urban-editon-final-build/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-18-00-19-21-3ed0731e2f0f20835a0580d09d305986.jpeg\" alt=\"2024-10-18-00-19-21-3ed0731e2f0f20835a0580d09d305986\"\u003e\u003c/p\u003e\n\u003ch1 id=\"车把\"\u003e车把\u003c/h1\u003e\n\u003cp\u003eM 把的问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e蓝图 A7 这个指拨太长，微调旋钮离 M 把很近，所以变速线改为从头管后侧走线，这导致在头管上安装水壶架变得很困难。\u003c/li\u003e\n\u003cli\u003e抛光银的反光左右不一致，导致看起来车把左右不对称。虽然实际骑起来感受不到明显的差异，但是强迫症还是比较难受。\u003c/li\u003e\n\u003cli\u003e时速 22 公里以上不好发力。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e改成直把可以解决以上问题。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-18-00-20-01-IMG_3189.jpeg\" alt=\"2024-10-18-00-20-01-IMG_3189\"\u003e\u003c/p\u003e\n\u003ch1 id=\"座垫\"\u003e座垫\u003c/h1\u003e\n\u003cp\u003e原装座垫非常不舒服，我穿骑行裤骑了不到 30 公里就屁股疼，换了 taozik 仿闪电的座垫骑 100 多公里也没事。\u003c/p\u003e\n\u003ch1 id=\"脚踏\"\u003e脚踏\u003c/h1\u003e\n\u003cp\u003e原装铝合金折叠脚踏容易异响，而且鞋底沾点水就非常滑。有拎车需求的话换快拆脚踏，没有就用普通脚踏，英布原装的单边折叠脚踏也是个不错的选项。\u003c/p\u003e\n\u003ch1 id=\"货架\"\u003e货架\u003c/h1\u003e\n\u003cp\u003e原装货架除了好看全是缺点。CNC 铝合金零件拼装的，强度很差，折叠后不能为车身提供足够的支撑力，表现为在地铁、公交上能看到折叠后的车身相对于货架出现明显的晃动，以及推行的时候出现相对严重的偏向问题。这个问题同时削弱了折叠后的稳定性，为了解决这个问题，原装货架上内置了易行轮伸缩杆的结构。伸缩杆的问题有两个，一是增加了一步操作，非常麻烦，二是强度差，在地铁站这种遍布盲道的地面拉开伸缩杆推行容易坏，不拉开容易倒，只能在折叠后静置停放时使用，有点鸡肋。\u003c/p\u003e\n\u003cp\u003e曾经换装过青春版的货架，焊接一体的结构决定了在支撑力和一体性方面远超城市版，但它的问题一是比较粗大，外观和城市版不太协调，二是品控一般，有一个易行轮不着地。\u003c/p\u003e\n\u003cp\u003e最后我换装了这个一百块出头的货架，重量更轻，外观比同为焊接、喷砂银的青春版货架更好看，四轮着地，推行和静置时比之前两个稳了很多。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-18-00-20-35-IMG_3190.jpeg\" alt=\"2024-10-18-00-20-35-IMG_3190\"\u003e\u003c/p\u003e\n\u003ch1 id=\"挡泥板\"\u003e挡泥板\u003c/h1\u003e\n\u003cp\u003e一副挡泥板最大的耻辱就是挡不了泥，而它做到了。佰客的挡泥板一是没有挡泥皮，二是后挡太短，会有少量的泥水甩到身上。据说可以安装如图所示的挡泥皮，但是因为佰客的挡泥板只能搭配同厂货架使用，而我想换掉货架，所以选择直接换装英布的后挡泥板。此外，我用一块人造革给前挡剪了一片挡泥皮。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-18-00-22-27-IMG_3193.jpeg\" alt=\"2024-10-18-00-22-27-IMG_3193\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-18-00-20-54-IMG_3191.jpeg\" alt=\"2024-10-18-00-20-54-IMG_3191\"\u003e\u003c/p\u003e\n\u003ch1 id=\"总结\"\u003e总结\u003c/h1\u003e\n\u003cp\u003e国布一般都会宣传自己解决了英布这样那样的问题，但英布的很多问题是为了保证核心价值而妥协的结果，不是不能改，但不能以牺牲核心价值为代价。在佰客的车身上，我看到一些为了美观而牺牲实用性的所谓“改进”，对于这些我都不能苟同，好在车身几何比较接近英布，没有做加大开档、拉长大梁、跟风上碟刹这种不可逆的负优化，尚可挽救一下。\u003c/p\u003e\n\u003cp\u003e解决完以上问题，佰客城市版就是辆很好的国布了，整车好骑、轻快，轮组很润，变速顺滑，亮面漆搭配亮面银的风格也符合我的审美。\u003c/p\u003e","title":"做完这些事，佰客城市版国布就可以毕业了"},{"content":"要说还是正新的胎不好，其它几辆车都是世文，最少的骑了一千多公里，最多的三千公里，一次都没扎过，这辆 Dash Altena 到手一个月，才三百多公里，就扎了。\n以前只是理论上会补胎，看过教学视频，正好想实践一下，这不机会就来了么。\n买了补胎套装，补的还不错，骑了一圈长安街，降温后人少多了，均速第一次上了 26 。\n实践出真知，再扎就换胎！\n","permalink":"http://0x3f.org/posts/my-first-tire-repair/","summary":"\u003cp\u003e要说还是正新的胎不好，其它几辆车都是世文，最少的骑了一千多公里，最多的三千公里，一次都没扎过，这辆 Dash Altena 到手一个月，才三百多公里，就扎了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-14-23-13-39-IMG_3147.jpeg\" alt=\"2024-10-14-23-13-39-IMG_3147\"\u003e\u003c/p\u003e\n\u003cp\u003e以前只是理论上会补胎，看过教学视频，正好想实践一下，这不机会就来了么。\u003c/p\u003e\n\u003cp\u003e买了补胎套装，补的还不错，骑了一圈长安街，降温后人少多了，均速第一次上了 26 。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-14-23-14-10-IMG_3159.jpeg\" alt=\"2024-10-14-23-14-10-IMG_3159\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-14-23-14-33-IMG_3158.jpeg\" alt=\"2024-10-14-23-14-33-IMG_3158\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-14-23-14-59-IMG_3160.jpeg\" alt=\"2024-10-14-23-14-59-IMG_3160\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-10-14-23-15-16-IMG_3163.jpeg\" alt=\"2024-10-14-23-15-16-IMG_3163\"\u003e\u003c/p\u003e\n\u003cp\u003e实践出真知，再扎就换胎！\u003c/p\u003e","title":"记第一次补胎"},{"content":"最近，我对 Homelab 的通知系统进行了一次升级，将繁琐的邮件通知转变为简洁的 Telegram 消息。这个过程不仅提高了效率，还大大改善了我的使用体验。\n背景 我的 Homelab 基础设施主要由 Proxmox Virtual Environment (PVE) 和 Proxmox Backup Server (PBS) 构成。这些系统每天都会发送各种通知，包括系统更新、虚拟机和容器备份、备份数据仓库垃圾回收等任务的执行结果。\n长期以来，我一直通过邮件接收这些通知。然而，邮件作为一种信息接收方式，显得既重量级又低效。每天删除这些通知邮件成了一件烦人的琐事，我急需一种更轻量、更即时高效的通知方式。\n为什么选择 Telegram？ 我已经在使用 Telegram 接收 Unraid 的通知消息，体验一直很不错。考虑到这点，我决定将基础平台的通知也集中到 Telegram 上来。\n初步尝试：Gotify 和 gotify2telegram PVE 和 PBS 除了支持邮件通知，还支持 Gotify 这个消息收集服务。理论上，我可以使用 gotify2telegram 插件将 Gotify 的消息转发到 Telegram。\n但是，这个方案存在两个问题：\n不支持通过 Gotify 的 Application 过滤消息，导致所有发送到 Gotify 的消息都会被无差别转发。 不支持对消息内容进行处理，降低了通知的可读性。比如，PVE 在备份客户机后会发送冗长的备份过程信息，这些信息在 Telegram 中会被截断成多条消息展示，非常不便于阅读。 最终方案：n8n + gotify-webhook 为了解决上述问题，我找到了 gotify-webhook 插件。我的想法是通过这个插件将消息转发给 n8n 处理，然后再发送到 Telegram。\n在提交了一个 PR 并被合并后，我终于实现了这个流程。现在，我的 Homelab 通知体验有了质的飞跃：\n消息经过 n8n 处理后更加简洁明了。例如，对于备份任务，如果成功了只会发送一条简短的成功通知，只有在失败时才会显示详细信息。 通过 n8n 的规则，我可以轻松过滤和分类不同类型的通知。 Telegram 的即时性让我能够更快地响应任何潜在的问题。 总结 通过这次升级，我不仅简化了 Homelab 的日常维护工作，还提高了对系统状态的感知能力。如果你也在为繁琐的 Homelab 通知所困扰，不妨试试这个方案。\n","permalink":"http://0x3f.org/posts/optimize-homelab-notifications-with-n8n-from-email-to-telegram/","summary":"\u003cp\u003e最近，我对 Homelab 的通知系统进行了一次升级，将繁琐的邮件通知转变为简洁的 Telegram 消息。这个过程不仅提高了效率，还大大改善了我的使用体验。\u003c/p\u003e\n\u003ch2 id=\"背景\"\u003e背景\u003c/h2\u003e\n\u003cp\u003e我的 Homelab 基础设施主要由 Proxmox Virtual Environment (PVE) 和 Proxmox Backup Server (PBS) 构成。这些系统每天都会发送各种通知，包括系统更新、虚拟机和容器备份、备份数据仓库垃圾回收等任务的执行结果。\u003c/p\u003e\n\u003cp\u003e长期以来，我一直通过邮件接收这些通知。然而，邮件作为一种信息接收方式，显得既重量级又低效。每天删除这些通知邮件成了一件烦人的琐事，我急需一种更轻量、更即时高效的通知方式。\u003c/p\u003e\n\u003ch2 id=\"为什么选择-telegram\"\u003e为什么选择 Telegram？\u003c/h2\u003e\n\u003cp\u003e我已经在使用 Telegram 接收 Unraid 的通知消息，体验一直很不错。考虑到这点，我决定将基础平台的通知也集中到 Telegram 上来。\u003c/p\u003e\n\u003ch2 id=\"初步尝试gotify-和-gotify2telegram\"\u003e初步尝试：Gotify 和 gotify2telegram\u003c/h2\u003e\n\u003cp\u003ePVE 和 PBS 除了支持邮件通知，还支持 Gotify 这个消息收集服务。理论上，我可以使用 \u003ca href=\"https://github.com/anhbh310/gotify2telegram\"\u003egotify2telegram\u003c/a\u003e 插件将 Gotify 的消息转发到 Telegram。\u003c/p\u003e\n\u003cp\u003e但是，这个方案存在两个问题：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e不支持通过 Gotify 的 Application 过滤消息，导致所有发送到 Gotify 的消息都会被无差别转发。\u003c/li\u003e\n\u003cli\u003e不支持对消息内容进行处理，降低了通知的可读性。比如，PVE 在备份客户机后会发送冗长的备份过程信息，这些信息在 Telegram 中会被截断成多条消息展示，非常不便于阅读。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"最终方案n8n--gotify-webhook\"\u003e最终方案：n8n + gotify-webhook\u003c/h2\u003e\n\u003cp\u003e为了解决上述问题，我找到了 \u003ca href=\"https://github.com/wuxs/gotify-webhook\"\u003egotify-webhook\u003c/a\u003e 插件。我的想法是通过这个插件将消息转发给 n8n 处理，然后再发送到 Telegram。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-09-06-16-33-19-mac_20240905114752.png\" alt=\"2024-09-06-16-33-19-mac_20240905114752\"\u003e\u003c/p\u003e\n\u003cp\u003e在提交了一个 PR 并被合并后，我终于实现了这个流程。现在，我的 Homelab 通知体验有了质的飞跃：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e消息经过 n8n 处理后更加简洁明了。例如，对于备份任务，如果成功了只会发送一条简短的成功通知，只有在失败时才会显示详细信息。\u003c/li\u003e\n\u003cli\u003e通过 n8n 的规则，我可以轻松过滤和分类不同类型的通知。\u003c/li\u003e\n\u003cli\u003eTelegram 的即时性让我能够更快地响应任何潜在的问题。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"总结\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e通过这次升级，我不仅简化了 Homelab 的日常维护工作，还提高了对系统状态的感知能力。如果你也在为繁琐的 Homelab 通知所困扰，不妨试试这个方案。\u003c/p\u003e","title":"用 n8n 优化 Homelab 通知流程：从邮件到 Telegram"},{"content":"最近在 YouTube 上看红警的视频，了解了一下主播用的对战平台，不仅仅是个当年浩方的翻版，而是进一步整合了红警游戏，等于是个带联网功能的红警，用着很方便。\n用 CrossOver 安装了红警 2 和鸿图对战平台，除了后者配置游戏的几个选项无法点击外，游戏运行效果堪称完美。\n对战平台不能选择玩家、阵营，虽然游戏运行没问题，可玩性大打折扣。\n安装过程很简单，安装完程序在 wine 的设置里把 ddraw 加上就行。\n","permalink":"http://0x3f.org/posts/play-ra2-on-mac/","summary":"\u003cp\u003e最近在 YouTube 上看红警的视频，了解了一下主播用的对战平台，不仅仅是个当年浩方的翻版，而是进一步整合了红警游戏，等于是个带联网功能的红警，用着很方便。\u003c/p\u003e\n\u003cp\u003e用 CrossOver 安装了红警 2 和鸿图对战平台，除了后者配置游戏的几个选项无法点击外，游戏运行效果堪称完美。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-08-22-17-27-46-IMG_2777.jpeg\" alt=\"2024-08-22-17-27-46-IMG_2777\"\u003e\u003c/p\u003e\n\u003cp\u003e对战平台不能选择玩家、阵营，虽然游戏运行没问题，可玩性大打折扣。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-08-22-17-34-53-1531724315569_.pic.jpeg\" alt=\"2024-08-22-17-34-53-1531724315569_.pic\"\u003e\u003c/p\u003e\n\u003cp\u003e安装过程很简单，安装完程序在 wine 的设置里把 ddraw 加上就行。\u003c/p\u003e","title":"在 Mac 上玩儿红警 2"},{"content":"早在一年前还在用 Inoreader 的时候就发现 Calibre 抓取某些订阅源之后图片不显示了，后来迁移到 Miniflux ，由于 Calibre 抓取的是它缓存的网页内容，所以这个问题暂时被规避了。现在改用 Readwise Reader 挑拣稍后读的内容，图片的问题又出现了，甚至增加了文章内容为空的情况。\n抽时间调试了一下，发现图片不显示是因为 Calibre 在抓取时没有发送 Referer 的 HTTP 报文头，内容为空是因为文章格式较为特殊（比如链接相对正文的比重较大）、导致 Calibre 当成非正文内容过滤掉了。\n然后了解了一下 Calibre Recipe 。官方文档比较简单，需要看源码辅助理解，有些问题还需要通过调试找到切入点。终于解决了所有问题，又可以用 Calibre Content Server 的网页端快乐地阅读了。\n突然觉得这种比较小的点很适合用短视频的形式表达，所以买了一个月剪映会员，用截图和录屏做了一个 30 秒的视频，旁白用 AI 语音，效果还不错。平时看过一些类似形式做的长视频，TTS 波澜不惊的颜色听多了挺难受，不过短视频就不存在这个问题，观众还没有疲劳就结束了。\n","permalink":"http://0x3f.org/posts/suddenly-became-a-youtuber/","summary":"\u003cp\u003e早在一年前还在用 Inoreader 的时候就发现 Calibre 抓取某些订阅源之后图片不显示了，后来迁移到 Miniflux ，由于 Calibre 抓取的是它缓存的网页内容，所以这个问题暂时被规避了。现在改用 Readwise Reader 挑拣稍后读的内容，图片的问题又出现了，甚至增加了文章内容为空的情况。\u003c/p\u003e\n\u003cp\u003e抽时间调试了一下，发现图片不显示是因为 Calibre 在抓取时没有发送 Referer 的 HTTP 报文头，内容为空是因为文章格式较为特殊（比如链接相对正文的比重较大）、导致 Calibre 当成非正文内容过滤掉了。\u003c/p\u003e\n\u003cp\u003e然后了解了一下 Calibre Recipe 。官方文档比较简单，需要看源码辅助理解，有些问题还需要通过调试找到切入点。终于解决了所有问题，又可以用 Calibre Content Server 的网页端快乐地阅读了。\u003c/p\u003e\n\u003cp\u003e突然觉得这种比较小的点很适合用短视频的形式表达，所以买了一个月剪映会员，用截图和录屏做了一个 30 秒的视频，旁白用 AI 语音，效果还不错。平时看过一些类似形式做的长视频，TTS 波澜不惊的颜色听多了挺难受，不过短视频就不存在这个问题，观众还没有疲劳就结束了。\u003c/p\u003e\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/uzQpO_G_vPg?si=8FBqc40NyFSyvlXZ\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen\u003e\u003c/iframe\u003e","title":"突然成了 Up 主"},{"content":"佰客城市版的货架是由多个 CNC 铝合金零件组装起来的，而且包含了易行轮的伸缩杆结构。系统越复杂，稳定性越差。此外，可能是为了颜值和重量，零件较为细小，进一步降低了强度。\n这个货架作为停车支架用是没有问题的，但如果经常推行或者搭乘公共交通工具，就不好用了：\n易行轮伸缩杆很细，推行时，如果不拉开，车子容易倒，如果拉开，经过非纯平地面（比如地铁站里的盲道）的时候容易颠坏。 货架强度不足以承托车身重量，在车身重心靠右的情况下，推行极易向左偏，地铁晃动的时候，车身会在货架上小幅度晃来晃去，晃得多了，螺丝就松了，零件之间的形变也会变大，导致产生异响。 佰客新出了银色的青春版货架，我买了一个，换掉了才用了不到一个月的城市版货架。青春版货架是焊接的一个整体，喷砂银，重量比城市版轻 50g 左右，外观不如城市版的好看，但是强度好得多，现在推行体验好多了。\n不过仍然存在 4 个易行轮三轮着地一轮悬空的问题，可能是货架的公差较大，也可能是车架的精度问题。\n城市版货架是个不太成功的设计，为了美观牺牲了实用性，在承重的关键位置用了复杂而脆弱的系统。佰客如果重视口碑的话，应该重新设计，并给买过车的客户一个实惠的升级价格。\n","permalink":"http://0x3f.org/posts/replacing-the-rack-of-bikes-folding-bike-with-the-se-version/","summary":"\u003cp\u003e佰客城市版的货架是由多个 CNC 铝合金零件组装起来的，而且包含了易行轮的伸缩杆结构。系统越复杂，稳定性越差。此外，可能是为了颜值和重量，零件较为细小，进一步降低了强度。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-28-23-21-11-95516D5E-A6A8-428E-B1F0-E94F8A359E30.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这个货架作为停车支架用是没有问题的，但如果经常推行或者搭乘公共交通工具，就不好用了：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e易行轮伸缩杆很细，推行时，如果不拉开，车子容易倒，如果拉开，经过非纯平地面（比如地铁站里的盲道）的时候容易颠坏。\u003c/li\u003e\n\u003cli\u003e货架强度不足以承托车身重量，在车身重心靠右的情况下，推行极易向左偏，地铁晃动的时候，车身会在货架上小幅度晃来晃去，晃得多了，螺丝就松了，零件之间的形变也会变大，导致产生异响。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e佰客新出了银色的青春版货架，我买了一个，换掉了才用了不到一个月的城市版货架。青春版货架是焊接的一个整体，喷砂银，重量比城市版轻 50g 左右，外观不如城市版的好看，但是强度好得多，现在推行体验好多了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-28-23-22-33-E2BBC24B-0DDA-49BB-BFD9-206D90C74D3A.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e不过仍然存在 4 个易行轮三轮着地一轮悬空的问题，可能是货架的公差较大，也可能是车架的精度问题。\u003c/p\u003e\n\u003cp\u003e城市版货架是个不太成功的设计，为了美观牺牲了实用性，在承重的关键位置用了复杂而脆弱的系统。佰客如果重视口碑的话，应该重新设计，并给买过车的客户一个实惠的升级价格。\u003c/p\u003e","title":"给佰客城市版国布更换青春版货架"},{"content":"佰客城市版国布的变速线是在头管内侧走线的，这会严重影响像 Fidlock 这样的水壶架的安装。\n这个问题应该跟指拨有关。佰客用的蓝图 A7 ，这是一款山地车指拨，长度较长，尤其在 M 把上微调旋钮离车把很近，走线空间非常有限。\n这个问题在 S 把上就不存在，事实上，看照片，用 S 把的佰客无界版就是在外侧走线的。\n我之前吐槽过这个指拨用在小布车架上不合理，为了缓解拨柄顶着大拇指的问题，需要把指拨向内侧平移一段距离，但这样微调旋钮就更接近 M 把了，更难通过头管外侧走线。\n而且小布的走线角度相比大行、风行的车的更大，这就导致微调旋钮处的线管受力很大。我的新车到手两个月，受力处的线管外的包胶就已经开裂了。\n所以国布要想做好，这个指拨是一定要重新设计的。\n看照片，R 布的指拨似乎用的也是蓝图 A7 ，但是走线是在外侧，所以买车前可能可以要求佰客改一下走线方式或者用 S 把，以免日后遇到这么尴尬的问题。\n","permalink":"http://0x3f.org/posts/wiring-issue-of-the-bikes-folding-bike/","summary":"\u003cp\u003e佰客城市版国布的变速线是在头管内侧走线的，这会严重影响像 Fidlock 这样的水壶架的安装。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-06-12-16-52-48-DSC00243.jpeg\" alt=\"2024-06-12-16-52-48-DSC00243\"\u003e\u003c/p\u003e\n\u003cp\u003e这个问题应该跟指拨有关。佰客用的蓝图 A7 ，这是一款山地车指拨，长度较长，尤其在 M 把上微调旋钮离车把很近，走线空间非常有限。\u003c/p\u003e\n\u003cp\u003e这个问题在 S 把上就不存在，事实上，看照片，用 S 把的佰客无界版就是在外侧走线的。\u003c/p\u003e\n\u003cp\u003e我之前吐槽过这个指拨用在小布车架上不合理，为了缓解拨柄顶着大拇指的问题，需要把指拨向内侧平移一段距离，但这样微调旋钮就更接近 M 把了，更难通过头管外侧走线。\u003c/p\u003e\n\u003cp\u003e而且小布的走线角度相比大行、风行的车的更大，这就导致微调旋钮处的线管受力很大。我的新车到手两个月，受力处的线管外的包胶就已经开裂了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-28-19-45-01-F28F4E05-12CA-464A-BF2E-689E9F6B3FF4.jpeg\" alt=\"2024-07-28-19-45-01-F28F4E05-12CA-464A-BF2E-689E9F6B3FF4\"\u003e\u003c/p\u003e\n\u003cp\u003e所以国布要想做好，这个指拨是一定要重新设计的。\u003c/p\u003e\n\u003cp\u003e看照片，R 布的指拨似乎用的也是蓝图 A7 ，但是走线是在外侧，所以买车前可能可以要求佰客改一下走线方式或者用 S 把，以免日后遇到这么尴尬的问题。\u003c/p\u003e","title":"佰客城市版国布的走线问题"},{"content":"\n用华为手环 9 的心率广播功能在码表上显示心率，测试了一周，体验不错。\n在选品前，考虑了 Apple Watch 、心率带（胸带）、心率带（臂带）和手环。\nApple Watch 本身没有心率广播功能，需要通过 iPhone 上的第三方 App 实现，但是会和码表 App 产生冲突，必须解绑后者才能广播心率，用起来太麻烦。\n心率带（胸带）使用心电原理测心率，准确度高，实时性好，续航长，价格低，但是使用麻烦，舒适性差。\n心率带（臂带）使用和 Apple Watch 相同的光电原理测测心率，准确度、实时性、续航的表现都弱于胸带，价格更贵，但是方便性和舒适性更好。\n手环也是光电原理，在测心率方面的优缺点可以和臂带等量齐观，但功能更多、使用场景更多、价格差不多甚至更低。\n考虑到我的应用场景：普通人；市区道路；折叠车；主要目的是锻炼、骑游和通勤，方便性和舒适性是很重要的选品标准。\n综合考虑，手环应该是个合适的选择。\n实际用下来，准确度可以和 Apple Watch 相提并论，实时性方面查到的可信数据是比胸带延时 4 到 5 秒左右，这就足够非专业运动员和无特殊医疗需求的普通人使用了。续航方面，心率广播状态下，每小时耗电大约是 2% ，完全不会有电量焦虑。\n","permalink":"http://0x3f.org/posts/huawei-band-9-as-a-heart-rate-monitor/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-25-00-48-02-IMG_2526.jpeg\" alt=\"2024-07-25-00-48-02-IMG_2526\"\u003e\u003c/p\u003e\n\u003cp\u003e用华为手环 9 的心率广播功能在码表上显示心率，测试了一周，体验不错。\u003c/p\u003e\n\u003cp\u003e在选品前，考虑了 Apple Watch 、心率带（胸带）、心率带（臂带）和手环。\u003c/p\u003e\n\u003cp\u003eApple Watch 本身没有心率广播功能，需要通过 iPhone 上的第三方 App 实现，但是会和码表 App 产生冲突，必须解绑后者才能广播心率，用起来太麻烦。\u003c/p\u003e\n\u003cp\u003e心率带（胸带）使用心电原理测心率，准确度高，实时性好，续航长，价格低，但是使用麻烦，舒适性差。\u003c/p\u003e\n\u003cp\u003e心率带（臂带）使用和 Apple Watch 相同的光电原理测测心率，准确度、实时性、续航的表现都弱于胸带，价格更贵，但是方便性和舒适性更好。\u003c/p\u003e\n\u003cp\u003e手环也是光电原理，在测心率方面的优缺点可以和臂带等量齐观，但功能更多、使用场景更多、价格差不多甚至更低。\u003c/p\u003e\n\u003cp\u003e考虑到我的应用场景：普通人；市区道路；折叠车；主要目的是锻炼、骑游和通勤，方便性和舒适性是很重要的选品标准。\u003c/p\u003e\n\u003cp\u003e综合考虑，手环应该是个合适的选择。\u003c/p\u003e\n\u003cp\u003e实际用下来，准确度可以和 Apple Watch 相提并论，实时性方面查到的可信数据是比胸带延时 4 到 5 秒左右，这就足够非专业运动员和无特殊医疗需求的普通人使用了。续航方面，心率广播状态下，每小时耗电大约是 2% ，完全不会有电量焦虑。\u003c/p\u003e","title":"心率带的平替：用华为手环 9 在自行车码表上显示心率"},{"content":"经过半个月的漫长等待，海淘的 MKS UX-D 非快拆脚踏终于到了，和之前买的快拆版一起，组了一副单边快拆脚踏。一副维格 V984T 在两辆车上来回倒腾的日子结束了。\n我的佰客城市版的原装折叠脚踏，在骑了不到两个月、里程不到一千公里的时候，异响到了让我难以忍受的程度。虽然我仍然认为折叠脚踏是最适合折叠车的，但市面上为数不多的那几款挑来挑去都不太满意，只能退而求其次，从快拆脚踏里找。\n这个过程仍然不轻松，因为大部分快拆脚踏都是我不喜欢的金属脚踏。在我看来，金属脚踏除了好看之外都是缺点，因为自身的特性，金属脚踏只能通过增大压强的方式防滑，比如钉踏，比如在竖直的金属片上刻齿，压强越大，和脚的接触面积越小，也就越伤鞋、越容易刮伤腿，不适合我这种喜欢穿着随意、主要在市区道路骑折叠车的普通人。尤其是在另一辆 KA349 上用了维格 V984T 之后，我现在挑脚踏都优先考虑塑料的了，塑料脚踏除了颜值不如金属之外都是优点：\n防滑且不伤鞋和腿 和脚的接触面积大，踩着舒服 轻 便宜 我想要塑料的快拆脚踏，但这似乎是个不可能完成的任务，直到找到 MKS UX-D ，大概市面上只有这么一款塑料的快拆脚踏。试骑了 30 公里，整体满意，符合预期，甚至颜值也不输金属，只是踏面稍小，踩上没有 V984T 那种人车合一的包覆感。\n","permalink":"http://0x3f.org/posts/mks-ux-d-pedal/","summary":"\u003cp\u003e经过半个月的漫长等待，海淘的 MKS UX-D 非快拆脚踏终于到了，和之前买的快拆版一起，组了一副单边快拆脚踏。一副维格 V984T 在两辆车上来回倒腾的日子结束了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-23-15-31-40-E222BA44-2408-4E83-B554-930D24760B70.jpeg\" alt=\"2024-07-23-15-31-40-E222BA44-2408-4E83-B554-930D24760B70\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-23-15-33-05-E40C8889-B3BF-43A3-828B-A67F70295E9B.jpeg\" alt=\"2024-07-23-15-33-05-E40C8889-B3BF-43A3-828B-A67F70295E9B\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-23-15-34-39-5AA9B9C9-5239-4327-B6C6-C518A58D4620.jpeg\" alt=\"2024-07-23-15-34-39-5AA9B9C9-5239-4327-B6C6-C518A58D4620\"\u003e\u003c/p\u003e\n\u003cp\u003e我的佰客城市版的原装折叠脚踏，在骑了不到两个月、里程不到一千公里的时候，异响到了让我难以忍受的程度。虽然我仍然认为折叠脚踏是最适合折叠车的，但市面上为数不多的那几款挑来挑去都不太满意，只能退而求其次，从快拆脚踏里找。\u003c/p\u003e\n\u003cp\u003e这个过程仍然不轻松，因为大部分快拆脚踏都是我不喜欢的金属脚踏。在我看来，金属脚踏除了好看之外都是缺点，因为自身的特性，金属脚踏只能通过增大压强的方式防滑，比如钉踏，比如在竖直的金属片上刻齿，压强越大，和脚的接触面积越小，也就越伤鞋、越容易刮伤腿，不适合我这种喜欢穿着随意、主要在市区道路骑折叠车的普通人。尤其是在另一辆 KA349 上用了维格 V984T 之后，我现在挑脚踏都优先考虑塑料的了，塑料脚踏除了颜值不如金属之外都是优点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e防滑且不伤鞋和腿\u003c/li\u003e\n\u003cli\u003e和脚的接触面积大，踩着舒服\u003c/li\u003e\n\u003cli\u003e轻\u003c/li\u003e\n\u003cli\u003e便宜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我想要塑料的快拆脚踏，但这似乎是个不可能完成的任务，直到找到 MKS UX-D ，大概市面上只有这么一款塑料的快拆脚踏。试骑了 30 公里，整体满意，符合预期，甚至颜值也不输金属，只是踏面稍小，踩上没有 V984T 那种人车合一的包覆感。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-23-15-35-04-72320DB0-90D6-4C4C-B280-52E03A223569.jpeg\" alt=\"2024-07-23-15-35-04-72320DB0-90D6-4C4C-B280-52E03A223569\"\u003e\u003c/p\u003e","title":"这款 MKS 塑料脚踏是我国布折叠车的最优解"},{"content":"本文聊聊在从 Inoreader 迁移到 Miniflux 后，我是怎样重建我的阅读工作流的。\n原来的阅读工作流 在用过的 RSS 阅读器里，Inoreader 最符合我的阅读习惯。它有以下优点：\n文章去重和过滤：由于订阅的资讯较多，这个功能能帮我节省很多时间。 接近 Vim 风格的快捷键：Vim 用户表示极度舒适。 多种布局：为不同的订阅源指定最合适的布局能极大提高阅读效率。 支持把标签输出为订阅源：方便通过 Calibre 订阅和抓取。 我在 Inoreader 里只做快速浏览，对需要阅读的文章打星标，随后集中对星标文章打标签。然后在 Calibre 里抓取指定标签的文章并生成电子书，既可以在 Calibre Content Server 的网页端阅读，也可以发送到 Kindle 离线阅读。\n电脑上的阅读体验 在电脑上，我一直钟爱使用 Calibre Content Server 的网页端进行阅读。它具备以下特点：\n自适应多栏布局：针对高分屏的优化，使得阅读体验更加舒适。 卡片式翻页：与传统的滚动式翻页相比，卡片式翻页在提高阅读效率的同时，也更加护眼。 自定义排版样式：可以根据自己的喜好调整阅读界面，打造个性化的阅读环境。 从 Inoreader 到 Miniflux 的转变 后来，Inoreader 的价格涨了很多，我尝试自建 Miniflux ，效果意外地好，但它有一个明显的局限性：只支持打星标，不支持打标签。这意味着我无法像使用 Inoreader 那样，通过标签对文章进行筛选和分类。\nReadwise Reader 的优势 不过 Miniflux 支持集成 Readwise Reader 。它不仅支持标签功能，还提供了列表接口。这让我意识到，如果能够将 Readwise Reader 的文档输出为订阅源，那么我的稍后读工作流将更加完善。\nRSSHub 路由发布 为了实现这一目标，我为 RSSHub 添加了一个路由，它可以将 Readwise Reader 的文档转换成订阅源。这样一来，我就可以在 Calibre Content Server 中愉快地阅读那些稍后阅读的文章了。\n新的流程是：\n该路由的详细用法可以参考以下文档：\nhttps://docs.rsshub.app/zh/routes/reading#readwise\n","permalink":"http://0x3f.org/posts/rsshub-route-for-readwise-reader-is-published/","summary":"\u003cp\u003e本文聊聊在从 Inoreader 迁移到 Miniflux 后，我是怎样重建我的阅读工作流的。\u003c/p\u003e\n\u003ch2 id=\"原来的阅读工作流\"\u003e原来的阅读工作流\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-11-17-49-10-SoWkIImgAStDuL8ioKZDJLKepaujISwerCqlBSd9p4lb0ijpSLczR9ZrOd-xWcTUVb5gOafgaSABTOjUpcXL20eEjkQoUZfd1PBKo_QUf-jtlfpJy69Pu_CLlKydzBrOl_lvh9PdqzgVhrxmh7Foindpdorenz07L0AHWIXysZ7znS8L4CFWMe6opzVkiuOxo3an9pEfA5NXMTVaf_tJa0o3A0GQ2N7eirqJ8FR1TJZdvvMa.png\" alt=\"2024-07-11-17-49-10-SoWkIImgAStDuL8ioKZDJLKepaujISwerCqlBSd9p4lb0ijpSLczR9ZrOd-xWcTUVb5gOafgaSABTOjUpcXL20eEjkQoUZfd1PBKo_QUf-jtlfpJy69Pu_CLlKydzBrOl_lvh9PdqzgVhrxmh7Foindpdorenz07L0AHWIXysZ7znS8L4CFWMe6opzVkiuOxo3an9pEfA5NXMTVaf_tJa0o3A0GQ2N7eirqJ8FR1TJZdvvMa\"\u003e\u003c/p\u003e\n\u003cp\u003e在用过的 RSS 阅读器里，Inoreader 最符合我的阅读习惯。它有以下优点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e文章去重和过滤\u003c/strong\u003e：由于订阅的资讯较多，这个功能能帮我节省很多时间。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e接近 Vim 风格的快捷键\u003c/strong\u003e：Vim 用户表示极度舒适。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e多种布局\u003c/strong\u003e：为不同的订阅源指定最合适的布局能极大提高阅读效率。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e支持把标签输出为订阅源\u003c/strong\u003e：方便通过 Calibre 订阅和抓取。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我在 Inoreader 里只做快速浏览，对需要阅读的文章打星标，随后集中对星标文章打标签。然后在 Calibre 里抓取指定标签的文章并生成电子书，既可以在 Calibre Content Server 的网页端阅读，也可以发送到 Kindle 离线阅读。\u003c/p\u003e\n\u003ch2 id=\"电脑上的阅读体验\"\u003e电脑上的阅读体验\u003c/h2\u003e\n\u003cp\u003e在电脑上，我一直钟爱使用 Calibre Content Server 的网页端进行阅读。它具备以下特点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e自适应多栏布局\u003c/strong\u003e：针对高分屏的优化，使得阅读体验更加舒适。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e卡片式翻页\u003c/strong\u003e：与传统的滚动式翻页相比，卡片式翻页在提高阅读效率的同时，也更加护眼。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e自定义排版样式\u003c/strong\u003e：可以根据自己的喜好调整阅读界面，打造个性化的阅读环境。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-07-11-18-06-02-IMG_2332.jpeg\" alt=\"2024-07-11-18-06-02-IMG_2332\"\u003e\u003c/p\u003e\n\u003ch2 id=\"从-inoreader-到-miniflux-的转变\"\u003e从 Inoreader 到 Miniflux 的转变\u003c/h2\u003e\n\u003cp\u003e后来，Inoreader 的价格涨了很多，我尝试自建 Miniflux ，效果意外地好，但它有一个明显的局限性：只支持打星标，不支持打标签。这意味着我无法像使用 Inoreader 那样，通过标签对文章进行筛选和分类。\u003c/p\u003e\n\u003ch2 id=\"readwise-reader-的优势\"\u003eReadwise Reader 的优势\u003c/h2\u003e\n\u003cp\u003e不过 Miniflux 支持集成 Readwise Reader 。它不仅支持标签功能，还提供了列表接口。这让我意识到，如果能够将 Readwise Reader 的文档输出为订阅源，那么我的稍后读工作流将更加完善。\u003c/p\u003e\n\u003ch2 id=\"rsshub-路由发布\"\u003eRSSHub 路由发布\u003c/h2\u003e\n\u003cp\u003e为了实现这一目标，我为 RSSHub 添加了一个路由，它可以将 Readwise Reader 的文档转换成订阅源。这样一来，我就可以在 Calibre Content Server 中愉快地阅读那些稍后阅读的文章了。\u003c/p\u003e","title":"打通稍后读工作流：Readwise Reader 的 RSSHub 路由发布"},{"content":"分享一下佰客国布城市版 2024 新版的开箱和骑行感受。\nTL;DR 整车比较精致，个别细节有待加强。 非常好骑，轮组很润。 比英布 C Line 和一般国布轻一点，不多。 除了座垫要到手换，整车无须大改，属于一辆到手就能骑的车。 解决了一些英布的问题，但还有优化的空间。 配色少，且以冷色为主。 磨合期会遇到一些小问题，线上售后会耐心解答和指导解决（可能没有专职的售后，有时候不能及时响应），需要一些简单的动手能力。没有体验过线下售后。 开箱感受 包装很紧凑：只有座垫和脚踏需要自己安装，据说以后整车都是装好的。 做工整体较为精致：用了很多 CNC 的银色部件，质感很好，抛光银的燕把和座管比磨砂银更有高级感，线管是透明表面+银色螺旋（可能是金属）内衬，有质感，银色的夹器和刹把好看，但表面近看有点粗糙，据说城市版是铜焊，漆水厚实，不像风行的漆那么脆皮。 肉球把套挺舒服。 轮组很润：花鼓声音不大，很润，实际骑行感受非常好。 自带延长杆的易行轮货架：CNC 货架很精致，重量更轻，拉开易行轮的延长杆可以解决折叠后重心不稳的问题，个人以为不如青春版那种 Q 版货架实用，拉开延长杆毕竟多出一步操作，比较麻烦，而且延长杆比较脆弱，不适合在拉开的状态下推行，可说是为了颜值和轻量化牺牲了实用性了。 预置了驻车盘：解决座管不完全放下时拎车散架的问题，方便推车过程中临时拎车。 尾灯很好用：座垫自带充电尾灯，挺好用，安装接口不通用，换座垫后用不了。 塑料猪鼻座：比铝合金的实用。 细节处理：脚踏安装孔预涂了润滑脂，刹车块是可替换刹皮的刹车靴。 磨合期遇到的一些问题 座管抛光层剥落：开箱就是抛光层剥落的座管，卖家寄了新的座管。 座管下滑：调紧座管夹可以解决，但锁和解锁座管夹会更费力，需要多次尝试、找到一个平衡点。 座管夹头复杂且不支持碳弓：座管复刻英布，夹头复杂、安装麻烦，且安装碳弓座垫需要换夹组（不便宜），暂时放弃使用碳弓座垫，改用钛弓。 座垫有翘翘板现象：卖家说需要 25nm 的扭力，但还是会有轻微的问题，不过并不影响乘坐舒适度。 座垫不舒服：仿棒槌哥 AEOLUS comp 座垫，比较硬且中间的空隙很长很宽，穿上骑行裤骑 30km 也难受，换了 TAOZIK 的钛弓座垫，好多了。 指拨不舒服：指拨用的蓝图 A7，柄较长，顶着大拇指，握把和变速都很难受，把指拨往远离把套的方向移动一段距离后，问题得到缓解，蓝图 A7 不是为小布设计的，直接拿来用体验不好，和“国布天花板”、“精益求精”的宣传给我拉高的预期有差距。 变速跳档：第三次骑的过程中出现变速跳档的现象，微调拧紧变速线之后，问题解决。 C 扣限位影响展开流畅度：C 扣限位是为了解决英布 C 扣扳手可能拧脱和 C 扣可能转动的问题，大梁上的 C 扣拧松后会向前倾斜导致短边会卡住折叠关节边缘，使车头部分的关节无法和大梁部分闭合，而当左手从车头离开去调整 C 扣时，在非纯平地面容易出现折叠关节重新展开导致很狼狈的问题。 挡泥板效果不完美：后挡泥板较短，会有少量泥水被甩出来，可能安装挡泥皮后能解决，但平价配件很难找，应该预置。 脚踏的踏感一般：景晔的这款铝合金折叠脚踏做工不错，也好看，但是重量较大，有点滑、不抓脚。 轮胎亏气：骑了三次才发现轮胎的气压只有 40 多 PSI，补气后好骑多了，理解可能是为了防止运输的过程中爆胎，但给一个明确的提示会好得多。 推行向左偏：因为重心靠右，通过改变推行姿势缓解：不要握着座垫鼻，而是扶着座垫右后方。 颜色少且缺乏暖色：的确有冷色更耐看的说法，但个人更喜欢车架是暖色，显得有生气。 重量比宣传的重：宣传的 9.5kg 是不带挡泥板和货架的，客服说加上后是 10+ kg，到手是 11.4kg，卖家解释是淘宝页面及客服掌握的信息更新不及时，新版做了一些优化和加强后重量有所上升，可以理解。 更新 2024-07-29 更换青春版货架 2024-07-28 走线的问题 2024-07-23 换了 MKS 塑料脚踏 2024-06-29 换掉了原装脚踏：踩踏过程中出现了异响，而且鞋底沾水之后非常滑，不光影响骑感，也不安全。 换了改良版货架：原装货架有设计缺陷，导致发生了断裂的问题，卖家寄了改良版，断裂位置不再使用螺丝固定，理论上降低了问题重现的概率。不过这种用 CNC 零件和钢螺丝组装的货架在重量和强度上天生不足，属于是为了颜值牺牲这两点了，使用时还得多加小心。市面上有些用铝合金管材焊接的一体货架，重量轻很多，精度未知，理论上强度应该会更好一些，就是不如 CNC 的好看。Ruhm 那种一体铸造的货架也挺精致，如果能在强度过关的前提下再轻一些（ 400 多克，比佰客城市版货架重 100 多克），就更好了。不管怎样，对于小布的货架，实用性是第一位的，其次是颜值，最后是重量，佰客城市版的货架多少有点本末倒置了。 ","permalink":"http://0x3f.org/posts/hands-on-the-city-version-of-bikes-folding-bike/","summary":"\u003cp\u003e分享一下佰客国布城市版 2024 新版的开箱和骑行感受。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-06-12-16-52-48-DSC00243.jpeg\" alt=\"2024-06-12-16-52-48-DSC00243\"\u003e\u003c/p\u003e\n\u003ch1 id=\"tldr\"\u003eTL;DR\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e整车比较精致，个别细节有待加强。\u003c/li\u003e\n\u003cli\u003e非常好骑，轮组很润。\u003c/li\u003e\n\u003cli\u003e比英布 C Line 和一般国布轻一点，不多。\u003c/li\u003e\n\u003cli\u003e除了座垫要到手换，整车无须大改，属于一辆到手就能骑的车。\u003c/li\u003e\n\u003cli\u003e解决了一些英布的问题，但还有优化的空间。\u003c/li\u003e\n\u003cli\u003e配色少，且以冷色为主。\u003c/li\u003e\n\u003cli\u003e磨合期会遇到一些小问题，线上售后会耐心解答和指导解决（可能没有专职的售后，有时候不能及时响应），需要一些简单的动手能力。没有体验过线下售后。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"开箱感受\"\u003e开箱感受\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e包装很紧凑\u003c/strong\u003e：只有座垫和脚踏需要自己安装，据说以后整车都是装好的。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e做工整体较为精致\u003c/strong\u003e：用了很多 CNC 的银色部件，质感很好，抛光银的燕把和座管比磨砂银更有高级感，线管是透明表面+银色螺旋（可能是金属）内衬，有质感，银色的夹器和刹把好看，但表面近看有点粗糙，据说城市版是铜焊，漆水厚实，不像风行的漆那么脆皮。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e肉球把套挺舒服\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e轮组很润\u003c/strong\u003e：花鼓声音不大，很润，实际骑行感受非常好。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e自带延长杆的易行轮货架\u003c/strong\u003e：CNC 货架很精致，重量更轻，拉开易行轮的延长杆可以解决折叠后重心不稳的问题，个人以为不如青春版那种 Q 版货架实用，拉开延长杆毕竟多出一步操作，比较麻烦，而且延长杆比较脆弱，不适合在拉开的状态下推行，可说是为了颜值和轻量化牺牲了实用性了。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e预置了驻车盘\u003c/strong\u003e：解决座管不完全放下时拎车散架的问题，方便推车过程中临时拎车。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e尾灯很好用\u003c/strong\u003e：座垫自带充电尾灯，挺好用，安装接口不通用，换座垫后用不了。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e塑料猪鼻座\u003c/strong\u003e：比铝合金的实用。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e细节处理\u003c/strong\u003e：脚踏安装孔预涂了润滑脂，刹车块是可替换刹皮的刹车靴。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"磨合期遇到的一些问题\"\u003e磨合期遇到的一些问题\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e座管抛光层剥落\u003c/strong\u003e：开箱就是抛光层剥落的座管，卖家寄了新的座管。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e座管下滑\u003c/strong\u003e：调紧座管夹可以解决，但锁和解锁座管夹会更费力，需要多次尝试、找到一个平衡点。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e座管夹头复杂且不支持碳弓\u003c/strong\u003e：座管复刻英布，夹头复杂、安装麻烦，且安装碳弓座垫需要换夹组（不便宜），暂时放弃使用碳弓座垫，改用钛弓。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e座垫有翘翘板现象\u003c/strong\u003e：卖家说需要 25nm 的扭力，但还是会有轻微的问题，不过并不影响乘坐舒适度。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e座垫不舒服\u003c/strong\u003e：仿棒槌哥 AEOLUS comp 座垫，比较硬且中间的空隙很长很宽，穿上骑行裤骑 30km 也难受，换了 TAOZIK 的钛弓座垫，好多了。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e指拨不舒服\u003c/strong\u003e：指拨用的蓝图 A7，柄较长，顶着大拇指，握把和变速都很难受，把指拨往远离把套的方向移动一段距离后，问题得到缓解，蓝图 A7 不是为小布设计的，直接拿来用体验不好，和“国布天花板”、“精益求精”的宣传给我拉高的预期有差距。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e变速跳档\u003c/strong\u003e：第三次骑的过程中出现变速跳档的现象，微调拧紧变速线之后，问题解决。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eC 扣限位影响展开流畅度\u003c/strong\u003e：C 扣限位是为了解决英布 C 扣扳手可能拧脱和 C 扣可能转动的问题，大梁上的 C 扣拧松后会向前倾斜导致短边会卡住折叠关节边缘，使车头部分的关节无法和大梁部分闭合，而当左手从车头离开去调整 C 扣时，在非纯平地面容易出现折叠关节重新展开导致很狼狈的问题。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e挡泥板效果不完美\u003c/strong\u003e：后挡泥板较短，会有少量泥水被甩出来，可能安装挡泥皮后能解决，但平价配件很难找，应该预置。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e脚踏的踏感一般\u003c/strong\u003e：景晔的这款铝合金折叠脚踏做工不错，也好看，但是重量较大，有点滑、不抓脚。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e轮胎亏气\u003c/strong\u003e：骑了三次才发现轮胎的气压只有 40 多 PSI，补气后好骑多了，理解可能是为了防止运输的过程中爆胎，但给一个明确的提示会好得多。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e推行向左偏\u003c/strong\u003e：因为重心靠右，通过改变推行姿势缓解：不要握着座垫鼻，而是扶着座垫右后方。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e颜色少且缺乏暖色\u003c/strong\u003e：的确有冷色更耐看的说法，但个人更喜欢车架是暖色，显得有生气。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e重量比宣传的重\u003c/strong\u003e：宣传的 9.5kg 是不带挡泥板和货架的，客服说加上后是 10+ kg，到手是 11.4kg，卖家解释是淘宝页面及客服掌握的信息更新不及时，新版做了一些优化和加强后重量有所上升，可以理解。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"更新\"\u003e更新\u003c/h1\u003e\n\u003ch2 id=\"2024-07-29\"\u003e2024-07-29\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/posts/replacing-the-rack-of-bikes-folding-bike-with-the-se-version\"\u003e更换青春版货架\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2024-07-28\"\u003e2024-07-28\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/posts/wiring-issue-of-the-bikes-folding-bike\"\u003e走线的问题\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2024-07-23\"\u003e2024-07-23\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/posts/mks-ux-d-pedal\"\u003e换了 MKS 塑料脚踏\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2024-06-29\"\u003e2024-06-29\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e换掉了原装脚踏\u003c/strong\u003e：踩踏过程中出现了异响，而且鞋底沾水之后非常滑，不光影响骑感，也不安全。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e换了改良版货架\u003c/strong\u003e：原装货架有设计缺陷，导致发生了断裂的问题，卖家寄了改良版，断裂位置不再使用螺丝固定，理论上降低了问题重现的概率。不过这种用 CNC 零件和钢螺丝组装的货架在重量和强度上天生不足，属于是为了颜值牺牲这两点了，使用时还得多加小心。市面上有些用铝合金管材焊接的一体货架，重量轻很多，精度未知，理论上强度应该会更好一些，就是不如 CNC 的好看。Ruhm 那种一体铸造的货架也挺精致，如果能在强度过关的前提下再轻一些（ 400 多克，比佰客城市版货架重 100 多克），就更好了。不管怎样，对于小布的货架，实用性是第一位的，其次是颜值，最后是重量，佰客城市版的货架多少有点本末倒置了。\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-06-29-22-25-57-IMG_2284.jpeg\" alt=\"2024-06-29-22-25-57-IMG_2284\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-06-29-22-26-29-IMG_2305.jpeg\" alt=\"2024-06-29-22-26-29-IMG_2305\"\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"体验精致与舒适：佰客城市版国产小布折叠车详评"},{"content":"休闲骑行脚踏的选择 休闲骑行的特点是单段持续时间较长、需要保持和队友的节奏，对车的好骑程度要求较高，对折叠便利性和折叠体积要求低。\n在选择休闲骑行的脚踏时，我考虑了以下几种类型：\n锁踏：由于市区路况复杂，休闲骑行不追求速度，因此锁踏并不适合。 钉踏：市面上产品众多，价格和外观选择丰富。但钉踏容易伤鞋，也容易把腿划破。之前买了用圆头防滑钉、号称不伤鞋的辉哥 J6 脚踏，骑了一个月也磨坏了运动鞋底的防滑纹。 平踏：最适合市区骑游的场景，我的期望是： 大踏面：提供舒适的踩踏体验。 抓脚但不伤鞋：在保证稳定性的同时，不伤鞋。 重量轻：对于折叠、携带的要求不高，可以牺牲快拆或折叠功能。 我了解或使用过的脚踏包括：\nMKS：重量较重，价格较高。 维格 M111 类似脚踏：外观相似，采用 DU 轴或 DU + 单培林，在平踏中较为常见，视觉效果简洁，价格不贵，但踏面较小。包括： M111：外观、做工、重量表现最佳，价格最贵。 M248：做工一般，踏面和轴用螺丝结合。 M921：做工好，一体成形，漆面光滑。（下图右侧） 大行 Jifo 原装快拆脚踏：快拆设计方便，但安装复杂，且难以购买。（上图左侧） LP 的快拆脚踏：一体成形，但漆面差。 最终，我选择了维格的尼龙脚踏 V984T 。\n维格提供了多种尼龙脚踏，我选择的是体积较小、重量较轻、与车外观搭配较为协调的 V984T 。它满足了我对配件和脚踏的所有选择标准，而且价格仅为 15￥ 包邮。这款脚踏的踩踏体验极为舒适，脚掌与踏面的贴合度非常好，有人体工学的感觉，超过了以往用过的所有脚踏。\n关于脚踏润度的题外话 理论上，润度更高的脚踏可以提高踩踏效率，但对于我们普通人在市区道路上的骑行场景来说，追求高润度并没有太大意义。DU 轴的脚踏已经完全够用，既满足了日常需求，又保持了合理的价格。\n","permalink":"http://0x3f.org/posts/wellgo-v984t-pedal/","summary":"\u003ch2 id=\"休闲骑行脚踏的选择\"\u003e休闲骑行脚踏的选择\u003c/h2\u003e\n\u003cp\u003e休闲骑行的特点是单段持续时间较长、需要保持和队友的节奏，对车的好骑程度要求较高，对折叠便利性和折叠体积要求低。\u003c/p\u003e\n\u003cp\u003e在选择休闲骑行的脚踏时，我考虑了以下几种类型：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e锁踏\u003c/strong\u003e：由于市区路况复杂，休闲骑行不追求速度，因此锁踏并不适合。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e钉踏\u003c/strong\u003e：市面上产品众多，价格和外观选择丰富。但钉踏容易伤鞋，也容易把腿划破。之前买了用圆头防滑钉、号称不伤鞋的辉哥 J6 脚踏，骑了一个月也磨坏了运动鞋底的防滑纹。\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-05-23-10-55-03-IMG_1909.jpeg\" alt=\"2024-05-23-10-55-03-IMG_1909\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e平踏\u003c/strong\u003e：最适合市区骑游的场景，我的期望是：\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e大踏面\u003c/strong\u003e：提供舒适的踩踏体验。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e抓脚但不伤鞋\u003c/strong\u003e：在保证稳定性的同时，不伤鞋。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e重量轻\u003c/strong\u003e：对于折叠、携带的要求不高，可以牺牲快拆或折叠功能。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我了解或使用过的脚踏包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eMKS\u003c/strong\u003e：重量较重，价格较高。\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-05-23-11-14-07-IMG_1920.jpeg\" alt=\"2024-05-23-11-14-07-IMG_1920\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e维格 M111 类似脚踏\u003c/strong\u003e：外观相似，采用 DU 轴或 DU + 单培林，在平踏中较为常见，视觉效果简洁，价格不贵，但踏面较小。包括：\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eM111\u003c/strong\u003e：外观、做工、重量表现最佳，价格最贵。\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-05-23-11-01-54-IMG_1916.jpeg\" alt=\"2024-05-23-11-01-54-IMG_1916\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eM248\u003c/strong\u003e：做工一般，踏面和轴用螺丝结合。\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-05-23-11-04-52-IMG_1917.jpeg\" alt=\"2024-05-23-11-04-52-IMG_1917\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eM921\u003c/strong\u003e：做工好，一体成形，漆面光滑。（下图右侧）\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-05-23-11-06-29-IMG_0827.jpeg\" alt=\"右侧 M921 左侧 Jifo 原装脚踏\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e大行 Jifo 原装快拆脚踏\u003c/strong\u003e：快拆设计方便，但安装复杂，且难以购买。（上图左侧）\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLP 的快拆脚踏\u003c/strong\u003e：一体成形，但漆面差。\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-05-23-11-12-04-IMG_1919.jpeg\" alt=\"2024-05-23-11-12-04-IMG_1919\"\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e最终，我选择了维格的尼龙脚踏 V984T 。\u003c/p\u003e\n\u003cp\u003e维格提供了多种尼龙脚踏，我选择的是体积较小、重量较轻、与车外观搭配较为协调的 V984T 。它满足了我对配件和脚踏的所有选择标准，而且价格仅为 15￥ 包邮。这款脚踏的踩踏体验极为舒适，脚掌与踏面的贴合度非常好，有人体工学的感觉，超过了以往用过的所有脚踏。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-05-23-11-15-13-IMG_1911.jpeg\" alt=\"2024-05-23-11-15-13-IMG_1911\"\u003e\u003c/p\u003e\n\u003ch2 id=\"关于脚踏润度的题外话\"\u003e关于脚踏润度的题外话\u003c/h2\u003e\n\u003cp\u003e理论上，润度更高的脚踏可以提高踩踏效率，但对于我们普通人在市区道路上的骑行场景来说，追求高润度并没有太大意义。DU 轴的脚踏已经完全够用，既满足了日常需求，又保持了合理的价格。\u003c/p\u003e","title":"15￥ 包邮的尼龙脚踏，实现了我对休闲骑行脚踏的所有想象"},{"content":"上次尝试过彰星夹器后，我用回了原装的单轴夹器。但是前刹手感差、刹车力弱、刹臂移动距离不对称的问题一直困扰着我。直到最近找到了价格合适的大行夹器。\n这个夹器主体看起来和 eezz 的原装夹器一样，只是螺帽螺杆是公路车那种隐藏式的，而且是后刹。我没有 eezz ，不了解原装后刹是什么样的。\n用上次改装彰星夹器的物料改装了一下：\n安装测试，结果很完美，刹车力、刹车手感和颜值都有了很大提升。\n粗略了解了一下脱漆、抛光、抗氧化的方法，觉得太麻烦，没有处理成银色，好在黑色夹器并不明显，在 Jifo 这车上也不违和，就这样吧。\n","permalink":"http://0x3f.org/posts/the-end-of-road-to-modifying-jifos-front-brake/","summary":"\u003cp\u003e\u003ca href=\"/posts/the-road-to-modifying-jifos-front-brake/\"\u003e上次\u003c/a\u003e尝试过彰星夹器后，我用回了原装的单轴夹器。但是前刹手感差、刹车力弱、刹臂移动距离不对称的问题一直困扰着我。直到最近找到了价格合适的大行夹器。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-29-21-40-24-IMG_1656.jpeg\" alt=\"2024-04-29-21-40-24-IMG_1656\"\u003e\u003c/p\u003e\n\u003cp\u003e这个夹器主体看起来和 eezz 的原装夹器一样，只是螺帽螺杆是公路车那种隐藏式的，而且是后刹。我没有 eezz ，不了解原装后刹是什么样的。\u003c/p\u003e\n\u003cp\u003e用上次改装彰星夹器的物料改装了一下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-29-21-46-22-IMG_1657.jpeg\" alt=\"2024-04-29-21-46-22-IMG_1657\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-29-21-46-25-IMG_1659.jpeg\" alt=\"2024-04-29-21-46-25-IMG_1659\"\u003e\u003c/p\u003e\n\u003cp\u003e安装测试，结果很完美，刹车力、刹车手感和颜值都有了很大提升。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-29-21-47-51-IMG_1661.jpeg\" alt=\"2024-04-29-21-47-51-IMG_1661\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-29-21-47-54-IMG_1662.jpeg\" alt=\"2024-04-29-21-47-54-IMG_1662\"\u003e\u003c/p\u003e\n\u003cp\u003e粗略了解了一下脱漆、抛光、抗氧化的方法，觉得太麻烦，没有处理成银色，好在黑色夹器并不明显，在 Jifo 这车上也不违和，就这样吧。\u003c/p\u003e","title":"Jifo 前刹的改造之路：好事多磨"},{"content":"拥有一辆绝版老车 Jifo ，就像拥有一个珍贵的老友。然而，当它出现问题时，维修之路往往充满挑战。\n在前不久的一次骑行中，我的 Jifo 飞轮突然发生跳齿。回家后，我检查发现问题出在张链器的弹簧上——它断了。\n由于 Jifo 使用的是非标件，市场上很难找到合适的替换件，而且价格昂贵。因此，我决定尝试寻找第三方的平替产品。\n便宜的替代品 我首先尝试了两种便宜的替代品。由于导链轮和基座之间的距离较大且无法调节，它们并不适合Jifo。\n碳客和禧玛诺 尽管我没有实际测试过这两款产品，但从图片上看，它们似乎也存在同样的问题。碳客的款式虽然距离可调，但最小距离可能仍然超出 Jifo 的规格。\nMUQZI 我随后尝试了 MUQZI 的张链器，它的调节范围较大，可以使用。然而，实际使用中，链条会蹭到导链轮两侧的挡板，这也不是理想的解决方案。\n回归原装 最终，我决定回归使用原装的张链器。尽管价格昂贵，且未来寻找替换件同样困难，但它体积小、重量轻，安装方便，且不需要截断链条。\n结语 在安装过程中，我发现这辆车之前进行过不太成功的改装。尾钩安装张链器的孔中有四分之三的螺纹已经滑丝。幸运的是，目前还能固定住。我计划稍后使用螺丝胶进行加固。如果螺纹完全滑丝，我将不得不考虑使用丝锥和丝套来挽救，这是一体尾钩设计的一个潜在弊端。\n","permalink":"http://0x3f.org/posts/fixing-the-chain-tensioner-of-dahon-jifo/","summary":"\u003cp\u003e拥有一辆绝版老车 Jifo ，就像拥有一个珍贵的老友。然而，当它出现问题时，维修之路往往充满挑战。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-15-20-16-20-e3e356bd402bd5fcb4157225c29f5966.jpg\" alt=\"2024-01-15-20-16-20-e3e356bd402bd5fcb4157225c29f5966\"\u003e\u003c/p\u003e\n\u003cp\u003e在前不久的一次骑行中，我的 Jifo 飞轮突然发生跳齿。回家后，我检查发现问题出在张链器的弹簧上——它断了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-49-17-IMG_1541.jpeg\" alt=\"2024-04-24-15-49-17-IMG_1541\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-49-23-IMG_1539.jpeg\" alt=\"2024-04-24-15-49-23-IMG_1539\"\u003e\u003c/p\u003e\n\u003cp\u003e由于 Jifo 使用的是非标件，市场上很难找到合适的替换件，而且价格昂贵。因此，我决定尝试寻找第三方的平替产品。\u003c/p\u003e\n\u003ch1 id=\"便宜的替代品\"\u003e便宜的替代品\u003c/h1\u003e\n\u003cp\u003e我首先尝试了两种便宜的替代品。由于导链轮和基座之间的距离较大且无法调节，它们并不适合Jifo。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-41-42-IMG_1677.jpeg\" alt=\"2024-04-24-15-41-42-IMG_1677\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-41-46-IMG_1676.jpeg\" alt=\"2024-04-24-15-41-46-IMG_1676\"\u003e\u003c/p\u003e\n\u003ch1 id=\"碳客和禧玛诺\"\u003e碳客和禧玛诺\u003c/h1\u003e\n\u003cp\u003e尽管我没有实际测试过这两款产品，但从图片上看，它们似乎也存在同样的问题。碳客的款式虽然距离可调，但最小距离可能仍然超出 Jifo 的规格。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-42-58-IMG_1679.jpeg\" alt=\"2024-04-24-15-42-58-IMG_1679\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-43-03-IMG_1678.jpeg\" alt=\"2024-04-24-15-43-03-IMG_1678\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-43-06-IMG_1680.jpeg\" alt=\"2024-04-24-15-43-06-IMG_1680\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-43-10-IMG_1681.jpeg\" alt=\"2024-04-24-15-43-10-IMG_1681\"\u003e\u003c/p\u003e\n\u003ch1 id=\"muqzi\"\u003eMUQZI\u003c/h1\u003e\n\u003cp\u003e我随后尝试了 MUQZI 的张链器，它的调节范围较大，可以使用。然而，实际使用中，链条会蹭到导链轮两侧的挡板，这也不是理想的解决方案。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-44-25-IMG_1674.jpeg\" alt=\"2024-04-24-15-44-25-IMG_1674\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-44-35-IMG_1675.jpeg\" alt=\"2024-04-24-15-44-35-IMG_1675\"\u003e\u003c/p\u003e\n\u003ch1 id=\"回归原装\"\u003e回归原装\u003c/h1\u003e\n\u003cp\u003e最终，我决定回归使用原装的张链器。尽管价格昂贵，且未来寻找替换件同样困难，但它体积小、重量轻，安装方便，且不需要截断链条。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-15-48-37-IMG_1533.jpeg\" alt=\"2024-04-24-15-48-37-IMG_1533\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-04-24-16-19-54-IMG_1683.jpeg\" alt=\"2024-04-24-16-19-54-IMG_1683\"\u003e\u003c/p\u003e\n\u003ch1 id=\"结语\"\u003e结语\u003c/h1\u003e\n\u003cp\u003e在安装过程中，我发现这辆车之前进行过不太成功的改装。尾钩安装张链器的孔中有四分之三的螺纹已经滑丝。幸运的是，目前还能固定住。我计划稍后使用螺丝胶进行加固。如果螺纹完全滑丝，我将不得不考虑使用丝锥和丝套来挽救，这是一体尾钩设计的一个潜在弊端。\u003c/p\u003e","title":"修复绝版老车 Jifo 的张链器：一次艰难的维修之旅"},{"content":"在 Unraid 操作系统的日常使用中，启动 U 盘的损坏可能会导致一系列问题，从而影响到整个系统的稳定性和数据的安全性。本文将探讨启动 U 盘损坏时的表现、解决办法，以及如何通过备份恢复系统。\n启动 U 盘损坏的表现 当你的 Unraid 系统遇到以下情况时，很可能是启动 U 盘出现了问题：\n只读模式：在尝试启动 Unraid 时，系统可能会提示文件系统为只读，导致无法正常启动。这种情况下，服务器可能会卡住，无法进入操作界面。 磁盘工具无法修复：如果尝试将 U 盘插入 Mac 电脑，并使用磁盘工具的 First Aid 功能，但无法修复问题，这进一步证实了 U 盘的损坏。 恢复备份的步骤 面对启动 U 盘的损坏，恢复备份是解决这一问题的有效方法。以下是详细的恢复步骤：\n下载闪存备份：首先，你需要从 Unraid Connect 下载你的闪存备份。这通常可以通过 Unraid 的 WebGUI 界面完成。 使用 Unraid USB Creator：接下来，使用 Unraid USB Creator 工具将备份恢复到一个新的 U 盘。这个工具可以在 Windows 或 macOS 上运行，并且可以从 Unraid 官网下载。 启动并重新授权：在新的 U 盘上恢复备份后，你需要启动 Unraid 系统。启动后，进入 Main 页面，获取你的 Key 文件，并按照提示重新授权。这将确保你的 Unraid 系统能够识别新的启动 U 盘。 参考资源 在处理启动 U 盘损坏的问题时，以下官方文档提供了宝贵的指导：\nChanging the flash device | Unraid Docs 这篇文档详细介绍了如何更换 Unraid 的启动 U 盘，包括备份、恢复和重新授权的全过程。它为用户在遇到类似问题时提供了清晰的操作步骤和建议。\n结语 启动 U 盘的损坏虽然令人头疼，但通过正确的备份和恢复流程，你可以轻松地解决这一问题。记得定期检查你的 U 盘状态，并保持备份的更新，这样可以在遇到问题时迅速恢复你的 Unraid 系统。\n","permalink":"http://0x3f.org/posts/how-to-recover-from-a-crash-of-the-unraid-flash-drive/","summary":"\u003cp\u003e在 Unraid 操作系统的日常使用中，启动 U 盘的损坏可能会导致一系列问题，从而影响到整个系统的稳定性和数据的安全性。本文将探讨启动 U 盘损坏时的表现、解决办法，以及如何通过备份恢复系统。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-23-16-33-19-Aid1Uo.png\" alt=\"2024-02-23-16-33-19-Aid1Uo\"\u003e\u003c/p\u003e\n\u003ch2 id=\"启动-u-盘损坏的表现\"\u003e启动 U 盘损坏的表现\u003c/h2\u003e\n\u003cp\u003e当你的 Unraid 系统遇到以下情况时，很可能是启动 U 盘出现了问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e只读模式\u003c/strong\u003e：在尝试启动 Unraid 时，系统可能会提示文件系统为只读，导致无法正常启动。这种情况下，服务器可能会卡住，无法进入操作界面。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e磁盘工具无法修复\u003c/strong\u003e：如果尝试将 U 盘插入 Mac 电脑，并使用磁盘工具的 First Aid 功能，但无法修复问题，这进一步证实了 U 盘的损坏。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"恢复备份的步骤\"\u003e恢复备份的步骤\u003c/h2\u003e\n\u003cp\u003e面对启动 U 盘的损坏，恢复备份是解决这一问题的有效方法。以下是详细的恢复步骤：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e下载闪存备份\u003c/strong\u003e：首先，你需要从 Unraid Connect 下载你的闪存备份。这通常可以通过 Unraid 的 WebGUI 界面完成。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e使用 Unraid USB Creator\u003c/strong\u003e：接下来，使用 Unraid USB Creator 工具将备份恢复到一个新的 U 盘。这个工具可以在 Windows 或 macOS 上运行，并且可以从 Unraid 官网下载。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e启动并重新授权\u003c/strong\u003e：在新的 U 盘上恢复备份后，你需要启动 Unraid 系统。启动后，进入 Main 页面，获取你的 Key 文件，并按照提示重新授权。这将确保你的 Unraid 系统能够识别新的启动 U 盘。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"参考资源\"\u003e参考资源\u003c/h2\u003e\n\u003cp\u003e在处理启动 U 盘损坏的问题时，以下官方文档提供了宝贵的指导：\u003c/p\u003e","title":"Unraid 启动 U 盘损坏：症状、解决方案与备份恢复"},{"content":"多年前，我曾使用过非智能的码表，那时的骑行记录简单而纯粹。随着时间的推移，我更换了折叠车，骑行更多是为了休闲和享受。在这个阶段，手机和智能手表已经足够满足我记录骑行数据的需求，而且我并不喜欢在车上挂太多东西，保持简洁是我的风格。\n然而，随着 Apple Watch S4 的续航能力逐渐下降，加之 iPhone 在极端气温下续航表现不佳，我开始考虑寻找一款能够替代这些设备的智能码表。在尝试了 iGPSPORT BSC200 后，我发现其路线导航功能很鸡肋，在路况复杂的地方非常难用，这促使我转向了 iGPSPORT iGS630S 。\niGS630S 给我的第一印象是其搜星速度非常快，这对于户外骑行来说是一个巨大的优势。在实际使用中，尽管它的续航时间并没有达到宣传的 45 小时，但至少 25 小时的续航能力已经足够我完成大部分骑行活动。定位和测速的准确性也让我印象深刻，尤其是在通过立交桥而失去卫星信号时，它没有出现像手机和手表那样夸张的失准问题。\n在使用路书导航时，iGS630S 的表现尤为出色。它的地图导航功能直观易用，让我在复杂的路况中也能轻松找到正确的路线。此外，它还配备了光感功能，能够在隧道等光线较暗的环境中自动调整屏幕亮度，这一点在实际骑行中非常实用。\niGS630S 的手机 App 设计同样令人满意。界面美观、简洁，操作流畅，完全符合我对智能设备的审美要求。这使得数据同步和路线规划变得异常便捷，极大地提升了我的骑行体验。\n当然，任何产品都有其不足之处。在使用 iGS630S 进行位置点导航时，我发现其路线规划能力相较于手机地图有所不足。此外，当偏离预定路线时，它的自动规划速度也不如手机地图响应迅速。在外观设计上，iGS630S 也不如 BSC 系列那样吸引人。\n总的来说，iGPSPORT iGS630S 是一款功能强大、续航可靠的智能码表。尽管在某些方面还有待改进，但它已经足够满足我对智能骑行的所有期待。对于追求高效、便捷骑行体验的骑手来说，iGS630S 无疑是一个值得考虑的选择。\n","permalink":"http://0x3f.org/posts/hands-on-igpsport-igs630s/","summary":"\u003cp\u003e多年前，我曾使用过非智能的码表，那时的骑行记录简单而纯粹。随着时间的推移，我更换了折叠车，骑行更多是为了休闲和享受。在这个阶段，手机和智能手表已经足够满足我记录骑行数据的需求，而且我并不喜欢在车上挂太多东西，保持简洁是我的风格。\u003c/p\u003e\n\u003cp\u003e然而，随着 Apple Watch S4 的续航能力逐渐下降，加之 iPhone 在极端气温下续航表现不佳，我开始考虑寻找一款能够替代这些设备的智能码表。在尝试了 iGPSPORT BSC200 后，我发现其路线导航功能很鸡肋，在路况复杂的地方非常难用，这促使我转向了 iGPSPORT iGS630S 。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-22-21-13-03-IMG_1092.jpeg\" alt=\"2024-02-22-21-13-03-IMG_1092\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-22-21-20-02-IMG_1208.jpeg\" alt=\"2024-02-22-21-20-02-IMG_1208\"\u003e\u003c/p\u003e\n\u003cp\u003eiGS630S 给我的第一印象是其搜星速度非常快，这对于户外骑行来说是一个巨大的优势。在实际使用中，尽管它的续航时间并没有达到宣传的 45 小时，但至少 25 小时的续航能力已经足够我完成大部分骑行活动。定位和测速的准确性也让我印象深刻，尤其是在通过立交桥而失去卫星信号时，它没有出现像手机和手表那样夸张的失准问题。\u003c/p\u003e\n\u003cp\u003e在使用路书导航时，iGS630S 的表现尤为出色。它的地图导航功能直观易用，让我在复杂的路况中也能轻松找到正确的路线。此外，它还配备了光感功能，能够在隧道等光线较暗的环境中自动调整屏幕亮度，这一点在实际骑行中非常实用。\u003c/p\u003e\n\u003cp\u003eiGS630S 的手机 App 设计同样令人满意。界面美观、简洁，操作流畅，完全符合我对智能设备的审美要求。这使得数据同步和路线规划变得异常便捷，极大地提升了我的骑行体验。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-22-21-24-27-3D01C7B9-6110-4EBF-9F06-906D18D46E4E_1_102_o.jpeg\" alt=\"2024-02-22-21-24-27-3D01C7B9-6110-4EBF-9F06-906D18D46E4E_1_102_o\"\u003e\u003c/p\u003e\n\u003cp\u003e当然，任何产品都有其不足之处。在使用 iGS630S 进行位置点导航时，我发现其路线规划能力相较于手机地图有所不足。此外，当偏离预定路线时，它的自动规划速度也不如手机地图响应迅速。在外观设计上，iGS630S 也不如 BSC 系列那样吸引人。\u003c/p\u003e\n\u003cp\u003e总的来说，iGPSPORT iGS630S 是一款功能强大、续航可靠的智能码表。尽管在某些方面还有待改进，但它已经足够满足我对智能骑行的所有期待。对于追求高效、便捷骑行体验的骑手来说，iGS630S 无疑是一个值得考虑的选择。\u003c/p\u003e","title":"我的 iGPSPORT iGS630S 体验：告别手机与手表，拥抱专业骑行伴侣"},{"content":"在信息爆炸的时代，我们每天都在被各种新闻、文章和更新淹没。作为一个热衷于高效获取信息的读者，我一直在寻找一个理想的 RSS 阅读器，它能够让我快速筛选出感兴趣的内容，同时提供舒适的阅读体验。经过多年的探索，Inoreader 成为了我的首选，它几乎满足了我对 RSS 阅读器的所有期望。然而，最近 Inoreader 的价格调整让我不得不重新审视我的选择。\n我理想中的 RSS 阅读器 我理想中的 RSS 阅读器应该具备以下几个特点：\n关键词过滤：这让我能够避免浪费时间在不感兴趣的内容上，专注于那些真正有价值的信息。 多种视图支持：至少包括列表和卡片视图，这样我可以为不同的订阅源选择最合适的视图。例如，对于变形金刚的优惠信息，卡片视图能让我一眼看到感兴趣的型号。 稍后读功能：RSS 阅读器对我来说主要是快速浏览的工具，对于那些需要深入阅读的内容，我希望能够标记为稍后阅读。 快捷键支持：快捷键能够极大提高我的阅读效率，让我在浏览时更加得心应手。 Inoreader 的变迁 Inoreader 在过去几年里几乎完全符合我的需求，即使在前两年涨价后，它仍然允许老用户以原价续费，这让我感到非常满意。然而，最近我收到了一封邮件，通知我年费直接涨了近一倍。这让我不得不开始考虑转移到私有云部署的 RSS 订阅工具。\n试用 FreshRSS 和 Miniflux 在尝试了 FreshRSS 和 Miniflux 之后，我发现 FreshRSS 存在过滤规则保存后为空的问题，另外全文抓取也需要更多更复杂的配置，不如 Miniflux 稳定和简单。最终，我决定保留 Miniflux。\nMiniflux 的优势 Miniflux 是用 Go 语言实现的，拥有极简的 WebUI，占用系统资源较少，抓取能力出色。它支持根据订阅源的更新频率定制抓取时间间隔，还支持多种 Web 服务的集成，如我在用的 Readwise Reader。我选择使用 Docker 将 Miniflux 部署到 NAS 中，经过几天的试用，稳定性令人满意。\nMiniflux 的不足 尽管 Miniflux 在功能上满足了我的需求，但其 Web 界面过于简洁，不太适合我快速浏览大量订阅内容的工作流。为了解决这个问题，我在 macOS 上配合 NetNewsWire 使用 Miniflux，不过这个阅读器缺少多种视图等功能，只能算是差强人意。\n未来的选择 如果没有意外，我计划在本月底 Inoreader 订阅到期后，正式放弃使用它，转而全面拥抱 Miniflux。虽然这个决定伴随着对 Inoreader 的不舍，但我相信 Miniflux 能够为我提供一个更加经济、灵活且高效的 RSS 阅读体验。\n结语 在这个不断变化的数字世界中，找到适合自己的工具至关重要。Miniflux 虽然不是完美的解决方案，但它的灵活性和开源特性让我看到了无限的可能性。我期待着与 Miniflux 一起成长，探索更多高效阅读的新方式。\n","permalink":"http://0x3f.org/posts/replacing-inoreader-with-miniflux/","summary":"\u003cp\u003e在信息爆炸的时代，我们每天都在被各种新闻、文章和更新淹没。作为一个热衷于高效获取信息的读者，我一直在寻找一个理想的 RSS 阅读器，它能够让我快速筛选出感兴趣的内容，同时提供舒适的阅读体验。经过多年的探索，Inoreader 成为了我的首选，它几乎满足了我对 RSS 阅读器的所有期望。然而，最近 Inoreader 的价格调整让我不得不重新审视我的选择。\u003c/p\u003e\n\u003ch1 id=\"我理想中的-rss-阅读器\"\u003e我理想中的 RSS 阅读器\u003c/h1\u003e\n\u003cp\u003e我理想中的 RSS 阅读器应该具备以下几个特点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e关键词过滤\u003c/strong\u003e：这让我能够避免浪费时间在不感兴趣的内容上，专注于那些真正有价值的信息。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e多种视图支持\u003c/strong\u003e：至少包括列表和卡片视图，这样我可以为不同的订阅源选择最合适的视图。例如，对于变形金刚的优惠信息，卡片视图能让我一眼看到感兴趣的型号。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e稍后读功能\u003c/strong\u003e：RSS 阅读器对我来说主要是快速浏览的工具，对于那些需要深入阅读的内容，我希望能够标记为稍后阅读。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e快捷键支持\u003c/strong\u003e：快捷键能够极大提高我的阅读效率，让我在浏览时更加得心应手。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"inoreader-的变迁\"\u003eInoreader 的变迁\u003c/h1\u003e\n\u003cp\u003eInoreader 在过去几年里几乎完全符合我的需求，即使在前两年涨价后，它仍然允许老用户以原价续费，这让我感到非常满意。然而，最近我收到了一封邮件，通知我年费直接涨了近一倍。这让我不得不开始考虑转移到私有云部署的 RSS 订阅工具。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-13-21-31-08-Screenshot_20240207-012352_Original.jpeg\" alt=\"2024-02-13-21-31-08-Screenshot_20240207-012352_Original\"\u003e\u003c/p\u003e\n\u003ch1 id=\"试用-freshrss-和-miniflux\"\u003e试用 FreshRSS 和 Miniflux\u003c/h1\u003e\n\u003cp\u003e在尝试了 FreshRSS 和 Miniflux 之后，我发现 FreshRSS 存在过滤规则保存后为空的问题，另外全文抓取也需要更多更复杂的配置，不如 Miniflux 稳定和简单。最终，我决定保留 Miniflux。\u003c/p\u003e\n\u003ch1 id=\"miniflux-的优势\"\u003eMiniflux 的优势\u003c/h1\u003e\n\u003cp\u003eMiniflux 是用 Go 语言实现的，拥有极简的 WebUI，占用系统资源较少，抓取能力出色。它支持根据订阅源的更新频率定制抓取时间间隔，还支持多种 Web 服务的集成，如我在用的 Readwise Reader。我选择使用 Docker 将 Miniflux 部署到 NAS 中，经过几天的试用，稳定性令人满意。\u003c/p\u003e\n\u003ch1 id=\"miniflux-的不足\"\u003eMiniflux 的不足\u003c/h1\u003e\n\u003cp\u003e尽管 Miniflux 在功能上满足了我的需求，但其 Web 界面过于简洁，不太适合我快速浏览大量订阅内容的工作流。为了解决这个问题，我在 macOS 上配合 NetNewsWire 使用 Miniflux，不过这个阅读器缺少多种视图等功能，只能算是差强人意。\u003c/p\u003e\n\u003ch1 id=\"未来的选择\"\u003e未来的选择\u003c/h1\u003e\n\u003cp\u003e如果没有意外，我计划在本月底 Inoreader 订阅到期后，正式放弃使用它，转而全面拥抱 Miniflux。虽然这个决定伴随着对 Inoreader 的不舍，但我相信 Miniflux 能够为我提供一个更加经济、灵活且高效的 RSS 阅读体验。\u003c/p\u003e","title":"从 Inoreader 到 Miniflux：寻找理想的 RSS 阅读器之旅"},{"content":"在当今数据中心管理中，数据备份是确保业务连续性和灾难恢复的关键环节。即使是 Home Lab ，也需要保证重要数据的安全。Proxmox Virtual Environment (PVE) 提供了一个强大的平台来管理虚拟化基础设施，而 Proxmox Backup Server (PBS) 则是其官方推荐的备份解决方案。本文将详细介绍如何使用 PBS 对 Proxmox VE 的虚拟机或容器（Guest）和宿主机（Host）进行备份，以及如何设置自动化备份流程。\nGuest 的备份 使用 PBS Proxmox Backup Server (PBS) 是一个功能强大的备份工具，它提供了多种备份选项，包括增量备份、加密备份、自动备份以及自动修剪等功能。这些功能使得 PBS 成为与 PVE 结合紧密的理想选择。\n优势 增量备份：只备份自上次备份以来发生变化的数据，节省存储空间和时间。 加密备份：确保备份数据的安全性。 自动备份：设置定时任务，无需手动干预。 自动修剪：自动清理旧的备份，保持存储空间的合理使用。 与 PVE 结合紧密：PBS 专为 PVE 设计，备份和恢复过程无缝对接。 步骤 安装 PBS\nLXC 方式：创建一个 Debian 容器，然后添加 PBS 的源。这种方式轻量级，但 LXC 容器只能使用 RAW 格式的镜像。 ISO 方式：通过 PBS 官方 ISO 镜像创建虚拟机。这种方式限制较少，能适应更多硬件环境。 创建 PBS 备份用户\n在 PBS 中，进入 Configuration → Access Control → User Management 创建一个新用户，例如 dataguard。\n创建 Datastore\n如果使用单独的磁盘或磁盘镜像，可以在 Configuration → Administration → Storage/Disks -\u0026gt; Directory 中添加，并选中“Add as Datastore”。 如果使用 NFS，先在 /etc/fstab 中挂载到一个目录，然后在 Datastore → Add Datastore 中添加。 配置自动修剪规则\n例如，保留最近 7 天的每日备份、8 周的每周备份和 6 个月的每月备份。\n配置 Datastore\n在新建的 Datastore 的 Permissions 选项卡中为新建的用户赋权，通常使用 DatastoreAdmin 角色。如果需要备份多台机器，可以在 Content 选项卡中创建对应的命名空间。\n配置 PVE\n在 Datacenter → Storage 中添加 Proxmox Backup Server，然后在 Datacenter → Backup 中创建备份计划。\nHost 的备份 在 PBS 支持备份 PVE 主机之前，我们可以使用脚本通过 proxmox-backup-client 将重要文件备份到 PBS。\n脚本 https://raw.githubusercontent.com/xbot/homelab/main/pve/backup.sh。\n配置 在 /root/.profile 中添加以下环境变量：\n1 2 3 export PBS_NAMESPACE=\u0026#34;[命名空间]\u0026#34; export PBS_PASSWORD=\u0026#34;[PBS 备份用户的密码]\u0026#34; export PBS_REPOSITORY=\u0026#34;[备份用户名]@pbs@[PBS主机名或IP]:[Datastore名称]\u0026#34; 执行 手动执行脚本以确保一切正常。 使用 cron 定时任务自动执行脚本。 通过以上步骤，你可以确保你的 Proxmox VE 环境得到妥善的备份，无论是虚拟机还是主机。记得定期检查备份状态，确保备份过程顺利进行，并在必要时进行恢复测试。这样，即使面对数据丢失的风险，你也能迅速恢复业务。\n","permalink":"http://0x3f.org/posts/proxmox-ve-backup-guide/","summary":"\u003cp\u003e在当今数据中心管理中，数据备份是确保业务连续性和灾难恢复的关键环节。即使是 Home Lab ，也需要保证重要数据的安全。Proxmox Virtual Environment (PVE) 提供了一个强大的平台来管理虚拟化基础设施，而 Proxmox Backup Server (PBS) 则是其官方推荐的备份解决方案。本文将详细介绍如何使用 PBS 对 Proxmox VE 的虚拟机或容器（Guest）和宿主机（Host）进行备份，以及如何设置自动化备份流程。\u003c/p\u003e\n\u003ch1 id=\"guest-的备份\"\u003eGuest 的备份\u003c/h1\u003e\n\u003ch2 id=\"使用-pbs\"\u003e使用 PBS\u003c/h2\u003e\n\u003cp\u003eProxmox Backup Server (PBS) 是一个功能强大的备份工具，它提供了多种备份选项，包括增量备份、加密备份、自动备份以及自动修剪等功能。这些功能使得 PBS 成为与 PVE 结合紧密的理想选择。\u003c/p\u003e\n\u003ch3 id=\"优势\"\u003e优势\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e增量备份\u003c/strong\u003e：只备份自上次备份以来发生变化的数据，节省存储空间和时间。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e加密备份\u003c/strong\u003e：确保备份数据的安全性。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e自动备份\u003c/strong\u003e：设置定时任务，无需手动干预。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e自动修剪\u003c/strong\u003e：自动清理旧的备份，保持存储空间的合理使用。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e与 PVE 结合紧密\u003c/strong\u003e：PBS 专为 PVE 设计，备份和恢复过程无缝对接。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"步骤\"\u003e步骤\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e安装 PBS\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eLXC 方式\u003c/strong\u003e：创建一个 Debian 容器，然后添加 PBS 的源。这种方式轻量级，但 LXC 容器只能使用 RAW 格式的镜像。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eISO 方式\u003c/strong\u003e：通过 PBS 官方 ISO 镜像创建虚拟机。这种方式限制较少，能适应更多硬件环境。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e创建 PBS 备份用户\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e在 PBS 中，进入 Configuration → Access Control → User Management 创建一个新用户，例如 \u003ccode\u003edataguard\u003c/code\u003e。\u003c/p\u003e","title":"Proxmox VE 备份指南"},{"content":"在虚拟化环境中，尤其是使用 Proxmox VE 或其他虚拟化平台时，有时我们需要增加 Intel 核显的显存孔径（Aperture Size），以便让更多虚拟机用上显卡的硬件加速。例如，我的 i5-8600t CPU 的核显是 UHD630 ，它的显存孔径被限制为 256M ，这只能提供一个 1200p 或两个 768p 的虚拟 GPU ，显然太少了。而当我们把这个值上调到 1024M ，就能获得更多或性能更高的虚拟 GPU 。\n这可以通过修改 BIOS 设置来实现，但通常主板 BIOS 不提供直接的选项来调整这个值。幸运的是，我们可以通过一些工具来间接修改这个设置。以下是详细的步骤：\n步骤 1: 下载和主板上同版本的 BIOS 首先，你需要从主板制造商的官方网站下载与你的主板型号相匹配的 BIOS 文件。确保下载的是与你的主板上安装的 BIOS 版本相同的文件，以便后续操作不会引发兼容性问题。\n步骤 2: 使用 UEFITool 打开 BIOS 接下来，你需要使用 UEFITool，这是一个 UEFI 固件图像查看器和编辑器。下载并安装 UEFITool，然后使用它打开你下载的 BIOS 文件。\n步骤 3: 搜索“aperture size” 在 UEFITool 中，打开搜索对话框并选择“Text”类型，然后输入“aperture size”进行搜索。搜索结果中可能会有多个匹配项。\n步骤 4: 导出 Body 并转换 选择一个搜索结果，导出其 Body。然后，使用 IFRExtractor-RS，这是一个 Rust 实用程序，可以将 UEFI IFR 数据提取成人类可读的文本。运行 IFRExtractor-RS 并指定你刚刚导出的文件，它会生成一个文本文件。\n步骤 5: 找到“VarOffset”值 在生成的文本文件中，搜索“aperture size”，找到包含内存大小选项的部分。记下“VarOffset”的值，例如：0x8A5。\n步骤 6: 准备 U 盘并修改设置 将 U 盘格式化为 FAT32 文件系统，并在 U 盘的根目录下创建一个 /EFI/BOOT 目录。然后，下载 grub-mod-setup_var，这是一个修改过的 GRUB，允许调整隐藏的 BIOS 设置。将 modGRUBShell.efi 文件复制到 /EFI/BOOT 目录，并重命名为 bootx64.efi。\n步骤 7: 重启并执行设置 重启你的计算机，并从 U 盘引导。在 GRUB 菜单中选择使用 bootx64.efi 启动。在 GRUB shell 中，执行以下命令来修改显存孔径：\n1 setup_var 0x8A5 0x7 这里的 0x8A5 是你之前记下的“VarOffset”值，0x7 是你想要设置的新值，代表 1GB 的显存。\n步骤 8: 重启并验证 重启你的计算机，并在启动后使用以下命令来验证显存孔径是否已成功修改：\n1 lspci -vs 00:02.0 你应该能看到显存孔径的值已经更新。\n请注意，这些步骤可能需要一定的技术知识，并且在操作过程中可能会有风险。在进行任何修改之前，请确保你已经备份了重要数据，并且了解可能的后果。如果你不确定自己的操作，建议寻求专业人士的帮助。\n","permalink":"http://0x3f.org/posts/guide-to-increasing-intel-graphics-aperture-size/","summary":"\u003cp\u003e在虚拟化环境中，尤其是使用 Proxmox VE 或其他虚拟化平台时，有时我们需要增加 Intel 核显的显存孔径（Aperture Size），以便让更多虚拟机用上显卡的硬件加速。例如，我的 i5-8600t CPU 的核显是 UHD630 ，它的显存孔径被限制为 256M ，这只能提供一个 1200p 或两个 768p 的虚拟 GPU ，显然太少了。而当我们把这个值上调到 1024M ，就能获得更多或性能更高的虚拟 GPU 。\u003c/p\u003e\n\u003cp\u003e这可以通过修改 BIOS 设置来实现，但通常主板 BIOS 不提供直接的选项来调整这个值。幸运的是，我们可以通过一些工具来间接修改这个设置。以下是详细的步骤：\u003c/p\u003e\n\u003ch3 id=\"步骤-1-下载和主板上同版本的-bios\"\u003e步骤 1: 下载和主板上同版本的 BIOS\u003c/h3\u003e\n\u003cp\u003e首先，你需要从主板制造商的官方网站下载与你的主板型号相匹配的 BIOS 文件。确保下载的是与你的主板上安装的 BIOS 版本相同的文件，以便后续操作不会引发兼容性问题。\u003c/p\u003e\n\u003ch3 id=\"步骤-2-使用-uefitool-打开-bios\"\u003e步骤 2: 使用 UEFITool 打开 BIOS\u003c/h3\u003e\n\u003cp\u003e接下来，你需要使用 \u003ca href=\"https://github.com/LongSoft/UEFITool\"\u003eUEFITool\u003c/a\u003e，这是一个 UEFI 固件图像查看器和编辑器。下载并安装 UEFITool，然后使用它打开你下载的 BIOS 文件。\u003c/p\u003e\n\u003ch3 id=\"步骤-3-搜索aperture-size\"\u003e步骤 3: 搜索“aperture size”\u003c/h3\u003e\n\u003cp\u003e在 UEFITool 中，打开搜索对话框并选择“Text”类型，然后输入“aperture size”进行搜索。搜索结果中可能会有多个匹配项。\u003c/p\u003e\n\u003ch3 id=\"步骤-4-导出-body-并转换\"\u003e步骤 4: 导出 Body 并转换\u003c/h3\u003e\n\u003cp\u003e选择一个搜索结果，导出其 Body。然后，使用 \u003ca href=\"https://github.com/LongSoft/IFRExtractor-RS\"\u003eIFRExtractor-RS\u003c/a\u003e，这是一个 Rust 实用程序，可以将 UEFI IFR 数据提取成人类可读的文本。运行 IFRExtractor-RS 并指定你刚刚导出的文件，它会生成一个文本文件。\u003c/p\u003e","title":"榨干 Intel 核显潜能，让更多虚拟机用上显卡"},{"content":"Proxmox Virtual Environment（PVE）是一个功能强大的开源虚拟化管理平台。它允许用户在单个主机上运行多个虚拟机，每个虚拟机都可以拥有自己的操作系统。为了进一步提升虚拟机的性能，特别是对于那些需要图形处理能力的应用，我们可以通过配置 Intel® Graphics Virtualization Technology –g (GVT-g) 来实现。GVT-g 是一种硬件辅助的虚拟化技术，它允许虚拟机直接访问宿主机的图形处理单元（GPU），从而提高图形性能。本文将详细介绍如何在 PVE 中为 Intel 核显开启 GVT-g 。\n本文环境：\n操作系统：PVE 8.0 CPU： Intel Core i5-8600t 核显：UHD630 步骤 1 ：修改 GRUB 配置 首先，我们需要确保 GRUB 引导加载器在启动时启用了必要的参数。打开/etc/default/grub文件，并找到GRUB_CMDLINE_LINUX_DEFAULT行。添加以下参数：\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on iommu=pt i915.enable_gvt=1\u0026#34; 这将启用 Intel IOMMU（Input/Output Memory Management Unit）和 GVT-g 。保存文件后，运行以下命令来更新 GRUB 配置：\n1 sudo update-grub 步骤 2 ：添加内核模块 接下来，我们需要确保 PVE 在启动时加载必要的内核模块。编辑/etc/modules文件，添加以下模块：\n1 2 3 4 5 vfio vfio_iommu_type1 vfio_pci vfio_virqfd kvmgt 如果你之前因为配置直通核显而在/etc/modprobe.d/pve-blacklist.conf中屏蔽了显卡驱动，现在需要解除屏蔽。这可以通过注释掉或删除相关行来实现。\n完成修改后，运行以下命令来更新 initramfs ：\n1 sudo update-initramfs -u -k all 步骤 3 ：重启系统 为了使更改生效，我们需要重启系统。在重启后，可以通过以下命令来检查 GVT-g 是否已经成功启用：\n1 dmesg | grep -e DMAR -e IOMMU -e AMD-Vi 这将显示与 IOMMU 相关的内核消息。如果一切顺利，你应该能看到相关的启用信息。\n步骤4：验证 GVT-g 支持 最后，我们可以检查系统是否成功启用 GVT-g 。在终端中运行以下命令：\n1 ls /sys/bus/pci/devices/0000:00:02.0/mdev_supported_types 如果输出中包含多种规格的虚拟 GPU ，那么 GVT-g 已经准备好被使用了。\n结语 通过以上步骤，你已经成功地为 Intel 核显配置了 GVT-g 。这将为你的 PVE 上更多的虚拟机提供更好的图形性能，特别是在运行需要高性能图形处理的应用时。\n请注意，虚拟化技术不断发展，确保你的 PVE 内核版本支持 GVT-g ，并且硬件也满足要求。如果你的硬件或软件版本不支持 GVT-g ，可能需要考虑其他虚拟化技术或升级你的系统。\n","permalink":"http://0x3f.org/posts/guide-to-configuring-gvt-g-graphics-acceleration/","summary":"\u003cp\u003eProxmox Virtual Environment（PVE）是一个功能强大的开源虚拟化管理平台。它允许用户在单个主机上运行多个虚拟机，每个虚拟机都可以拥有自己的操作系统。为了进一步提升虚拟机的性能，特别是对于那些需要图形处理能力的应用，我们可以通过配置 Intel® Graphics Virtualization Technology –g (GVT-g) 来实现。GVT-g 是一种硬件辅助的虚拟化技术，它允许虚拟机直接访问宿主机的图形处理单元（GPU），从而提高图形性能。本文将详细介绍如何在 PVE 中为 Intel 核显开启 GVT-g 。\u003c/p\u003e\n\u003cp\u003e本文环境：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e操作系统：PVE 8.0\u003c/li\u003e\n\u003cli\u003eCPU： Intel Core i5-8600t\u003c/li\u003e\n\u003cli\u003e核显：UHD630\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"步骤-1-修改-grub-配置\"\u003e步骤 1 ：修改 GRUB 配置\u003c/h3\u003e\n\u003cp\u003e首先，我们需要确保 GRUB 引导加载器在启动时启用了必要的参数。打开\u003ccode\u003e/etc/default/grub\u003c/code\u003e文件，并找到\u003ccode\u003eGRUB_CMDLINE_LINUX_DEFAULT\u003c/code\u003e行。添加以下参数：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eGRUB_CMDLINE_LINUX_DEFAULT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;quiet intel_iommu=on iommu=pt i915.enable_gvt=1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这将启用 Intel IOMMU（Input/Output Memory Management Unit）和 GVT-g 。保存文件后，运行以下命令来更新 GRUB 配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo update-grub\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"步骤-2-添加内核模块\"\u003e步骤 2 ：添加内核模块\u003c/h3\u003e\n\u003cp\u003e接下来，我们需要确保 PVE 在启动时加载必要的内核模块。编辑\u003ccode\u003e/etc/modules\u003c/code\u003e文件，添加以下模块：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evfio\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evfio_iommu_type1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evfio_pci\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evfio_virqfd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekvmgt\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e如果你之前因为配置直通核显而在\u003ccode\u003e/etc/modprobe.d/pve-blacklist.conf\u003c/code\u003e中屏蔽了显卡驱动，现在需要解除屏蔽。这可以通过注释掉或删除相关行来实现。\u003c/p\u003e","title":"GVT-g 配置指南：实现多虚拟机共享 Intel 核显硬件加速"},{"content":"最近，我对我的 Homelab 进行了一次重大调整，从 Unraid 迁移到了 Proxmox VE（PVE），并用它实现了对 Unraid 的虚拟化，这一转变不仅提高了系统的稳定性、灵活性，还带来了一系列令人惊喜的改进。在这篇文章中，我将分享这次调整的动机、硬件升级以及软件配置的详细过程。\n动机：解耦虚拟机与 Unraid 我决定将虚拟机从 Unraid 中分离出来，这样做的目的是为了减轻 Unraid 重启时对整个网络环境的影响，降低磁盘阵列卡住的风险，并加速 Unraid 的重启过程。\n此外，这样的调整也使得使用 Proxmox Backup Server (PBS) 进行备份变得更加方便，减少了对 Unraid 缓存盘的占用，并优化了硬盘的休眠策略，减少了不必要的唤醒次数。\n最后，减少虚拟化嵌套层数，简化了架构，提高了整体效率。\n硬件升级 机箱改造： 为了适应新的硬件配置，我用角磨机切掉了蜗牛星际机箱 B 款的横梁，因为它挡住了 PCIe 插槽。这一小小的改动为后续的硬件安装提供了空间。 主板与扩展卡： 主板只有一个 M.2 插槽，我选择在这里安装了 PVE。为了加装第二款 NVME 固态硬盘，我购买了 PCIe 转 M.2 扩展卡，将 Unraid 的缓存盘插到了这个扩展卡上。小火炉铠侠 RC10 在加装了扩展卡附带的散热片后降温效果显著，目测温度下降了大约 15℃，Unraid 系统再也没有出现过报警。 视频采集卡： 为了在没有额外显示器的情况下管理 Homelab ，我购买了视频采集卡，并配合 iPad 使用，作为临时显示器。 软件配置 直通设备： 在 PVE 中，我将 Unraid 系统 U 盘、Sata 控制器、外置硬盘以及 NVME 缓存盘直通（passthrough）给了 Unraid 虚拟机。这样做的好处是，仍然使用 Unraid 作为 NAS 系统管理所有存储资源，并继续使用 Unraid 优秀的应用社区。同时把主板的第二块网卡做了直通，防止 NAS 吞吐量较大时影响访问宿主机及其它客户机的稳定性。\n显卡优化： 对于 i5-8600t 的集成显卡 UHD630，我开启了 GVT-g（Intel® Graphics Virtualization Technology –g）功能，并增加了显存孔径（Aperture Size）。默认的孔径只有 256MB，这限制了虚拟机的显卡性能，只能支持一个 1200p 或两个 768p 的显卡。通过将孔径增加到 1024MB，虚拟机现在可以共享更强大的显卡资源，使 Jellyfin 可以直接使用硬件加速解码，提高了性能和响应速度，也为运行更高分辨率或更多虚拟机提供了可能。\n修改 Docker 网络： 在运行了一段时间后，我发现 Unraid 几乎每天都会失联一次，表现为 CPU 、内存负载正常，但 IP 地址丢失。所以我把 Unraid 里 Docker 服务的默认自定义网络类型从 macvlan 改成了 ipvlan ，到目前为止，没有再发生同样的问题。但这又带来一个新的问题：使用 bridge 网络的容器无法和使用 ipvlan 网络的容器通讯，我的解决办法是创建一个 bridge 类型的网络并把需要互相通讯的容器添加进去。 结语 通过这一系列调整，我的 Homelab 更加灵活、高效，同时在硬件和软件层面都得到了优化。这个过程中的每一个改进都让我更好地满足了不断变化的需求，也为未来的扩展奠定了更好的基础。\n","permalink":"http://0x3f.org/posts/a-smooth-transition-from-unraid-to-pve/","summary":"\u003cp\u003e最近，我对我的 Homelab 进行了一次重大调整，从 Unraid 迁移到了 Proxmox VE（PVE），并用它实现了对 Unraid 的虚拟化，这一转变不仅提高了系统的稳定性、灵活性，还带来了一系列令人惊喜的改进。在这篇文章中，我将分享这次调整的动机、硬件升级以及软件配置的详细过程。\u003c/p\u003e\n\u003ch1 id=\"动机解耦虚拟机与-unraid\"\u003e动机：解耦虚拟机与 Unraid\u003c/h1\u003e\n\u003cp\u003e我决定将虚拟机从 Unraid 中分离出来，这样做的目的是为了减轻 Unraid 重启时对整个网络环境的影响，降低磁盘阵列卡住的风险，并加速 Unraid 的重启过程。\u003c/p\u003e\n\u003cp\u003e此外，这样的调整也使得使用 Proxmox Backup Server (PBS) 进行备份变得更加方便，减少了对 Unraid 缓存盘的占用，并优化了硬盘的休眠策略，减少了不必要的唤醒次数。\u003c/p\u003e\n\u003cp\u003e最后，减少虚拟化嵌套层数，简化了架构，提高了整体效率。\u003c/p\u003e\n\u003ch1 id=\"硬件升级\"\u003e硬件升级\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e机箱改造：\u003c/strong\u003e 为了适应新的硬件配置，我用角磨机切掉了蜗牛星际机箱 B 款的横梁，因为它挡住了 PCIe 插槽。这一小小的改动为后续的硬件安装提供了空间。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-05-22-40-47-IMG_1058.jpeg\" alt=\"2024-02-05-22-40-47-IMG_1058\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-05-22-42-35-DSC00141.jpg\" alt=\"2024-02-05-22-42-35-DSC00141\"\u003e\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e\u003cstrong\u003e主板与扩展卡：\u003c/strong\u003e 主板只有一个 M.2 插槽，我选择在这里安装了 PVE。为了加装第二款 NVME 固态硬盘，我购买了 PCIe 转 M.2 扩展卡，将 Unraid 的缓存盘插到了这个扩展卡上。小火炉铠侠 RC10 在加装了扩展卡附带的散热片后降温效果显著，目测温度下降了大约 15℃，Unraid 系统再也没有出现过报警。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-20-21-15-19-IMG_1203.jpeg\" alt=\"2024-02-20-21-15-19-IMG_1203\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-20-21-17-07-1E419BB6-4057-41B4-B7A5-6F3033154257_4_5005_c.jpeg\" alt=\"2024-02-20-21-17-07-1E419BB6-4057-41B4-B7A5-6F3033154257_4_5005_c\"\u003e\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e\u003cstrong\u003e视频采集卡：\u003c/strong\u003e 为了在没有额外显示器的情况下管理 Homelab ，我购买了视频采集卡，并配合 iPad 使用，作为临时显示器。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-02-05-23-20-26-IMG_1079.jpeg\" alt=\"2024-02-05-23-20-26-IMG_1079\"\u003e\u003c/p\u003e\n\u003ch1 id=\"软件配置\"\u003e软件配置\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e直通设备：\u003c/strong\u003e 在 PVE 中，我将 Unraid 系统 U 盘、Sata 控制器、外置硬盘以及 NVME 缓存盘直通（passthrough）给了 Unraid 虚拟机。这样做的好处是，仍然使用 Unraid 作为 NAS 系统管理所有存储资源，并继续使用 Unraid 优秀的应用社区。同时把主板的第二块网卡做了直通，防止 NAS 吞吐量较大时影响访问宿主机及其它客户机的稳定性。\u003c/p\u003e","title":"Homelab 升级记：从 Unraid 到 Proxmox VE 的平滑过渡"},{"content":"在这个数字化时代，数据安全比以往任何时候都更加重要。无论是个人生活还是工作，我们都需要一个可靠的备份方案来确保数据的安全。今天，我想分享我的家庭数据备份方案，它不仅涵盖了我所有的虚拟机、容器和配置数据，还包括了 NAS 上的重要文件，如照片、密码、笔记和待办事项。这个方案遵循了著名的 3-2-1 备份策略，并且通过精心选择的备份工具，确保了数据的安全性和高效性。\n数据种类 首先，让我们来了解我需要备份的数据种类。我有两个 PVE（Proxmox Virtual Environment）宿主机，上面运行着多个虚拟机和容器。这些虚拟机和容器包含了我所有的工作和个人项目。为了备份这些数据，我选择了 PBS（Proxmox Backup Server）作为备份存储。同时，我还使用 proxmox-backup-client 将 PVE 的配置数据也备份到 PBS 。\n除了虚拟机和容器，我的 NAS 上还存储着许多重要数据，包括家庭照片、密码管理器的数据库、个人笔记以及待办事项列表。这些数据对我来说同样重要，因此我也将它们纳入了备份计划。\n备份策略 我遵循的备份策略是 3-2-1 原则，即至少有三份备份，存储在两种不同的媒介上，且至少有一份在其他地方。这个策略可以有效地防止数据丢失。\n3-2-1策略的具体实现 为了实现这一策略，我部署了两个 Kopia 实例，并行运行，分别将数据备份到阿里云盘和我的移动硬盘。这样做的原因是 KopiaUI 目前只支持同时连接一个仓库，而并行备份可以确保即使上游备份出现问题，也不会影响下游的备份进程。\n为什么选择并行而不是串行 串行备份可能会导致一个问题：如果上游的备份过程中出现错误，那么这个错误会被传递到下游的备份。通过并行备份，我们可以避免这种情况，确保每个备份都是独立的。\n备份工具的选择 在选择备份工具时，我考虑了以下几个标准：\n支持本地和云备份：这样可以确保数据在本地和远程都有备份。 支持增量备份：只备份自上次备份以来发生变化的数据，节省时间和存储空间。 支持压缩和加密：保护数据安全的同时，减少存储需求。 支持将备份数据分割成一定大小：这对于远程备份尤其有用，可以提高小文件的上传速度，降低大文件上传失败的风险。 支持定时备份：自动化的定时备份可以确保数据始终是最新的。 稳定性和易用性：工具需要稳定运行，并且用户界面友好，易于操作。 在对比了多个备份工具后，我选择了 Kopia 和 Duplicati 。以下是它们的优缺点对比：\nDuplicati 优点：\n易于部署，通过 Docker 部署非常简单。 用户界面友好，易于操作。 支持同时连接多个仓库。 缺点：\n使用 .Net 实现，可能会占用更多的系统资源。 有关于稳定性的传闻，尽管这可能因环境而异。 Kopia 优点：\n稳定性的负面反馈较少，运行效率高。 占用资源相对较少，对系统的影响小。 用户界面简洁，易于理解。 缺点：\n部署和上手难度较高，相关资料较少，官方文档不够详尽。 不支持同时连接多个仓库，这在某些情况下可能会造成不便。 高级功能通常需要通过命令行实现，对于不熟悉命令行的用户来说可能不够友好。 结语 通过这样的备份方案，我可以确保我的数据在多种情况下都能得到保护。无论是硬件故障还是意外删除，我都有办法恢复我的数据。这给了我极大的安心，让我可以专注于我的工作和家庭生活，而不必担心数据安全问题。希望我的分享能为你的家庭数据备份提供一些启示。\n参考 Synchronization and backup programs - ArchWiki (archlinux.org) ","permalink":"http://0x3f.org/posts/my-homelab-backup-strategy/","summary":"\u003cp\u003e在这个数字化时代，数据安全比以往任何时候都更加重要。无论是个人生活还是工作，我们都需要一个可靠的备份方案来确保数据的安全。今天，我想分享我的家庭数据备份方案，它不仅涵盖了我所有的虚拟机、容器和配置数据，还包括了 NAS 上的重要文件，如照片、密码、笔记和待办事项。这个方案遵循了著名的 3-2-1 备份策略，并且通过精心选择的备份工具，确保了数据的安全性和高效性。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-31-20-40-32-_d0c7d6aa-d312-4749-89ce-d3996aaaddf6.jpeg\" alt=\"2024-01-31-20-40-32-_d0c7d6aa-d312-4749-89ce-d3996aaaddf6\"\u003e\u003c/p\u003e\n\u003ch3 id=\"数据种类\"\u003e数据种类\u003c/h3\u003e\n\u003cp\u003e首先，让我们来了解我需要备份的数据种类。我有两个 PVE（Proxmox Virtual Environment）宿主机，上面运行着多个虚拟机和容器。这些虚拟机和容器包含了我所有的工作和个人项目。为了备份这些数据，我选择了 PBS（Proxmox Backup Server）作为备份存储。同时，我还使用 proxmox-backup-client 将 PVE 的配置数据也备份到 PBS 。\u003c/p\u003e\n\u003cp\u003e除了虚拟机和容器，我的 NAS 上还存储着许多重要数据，包括家庭照片、密码管理器的数据库、个人笔记以及待办事项列表。这些数据对我来说同样重要，因此我也将它们纳入了备份计划。\u003c/p\u003e\n\u003ch3 id=\"备份策略\"\u003e备份策略\u003c/h3\u003e\n\u003cp\u003e我遵循的备份策略是 3-2-1 原则，即至少有三份备份，存储在两种不同的媒介上，且至少有一份在其他地方。这个策略可以有效地防止数据丢失。\u003c/p\u003e\n\u003ch4 id=\"3-2-1策略的具体实现\"\u003e3-2-1策略的具体实现\u003c/h4\u003e\n\u003cp\u003e为了实现这一策略，我部署了两个 Kopia 实例，并行运行，分别将数据备份到阿里云盘和我的移动硬盘。这样做的原因是 KopiaUI 目前只支持同时连接一个仓库，而并行备份可以确保即使上游备份出现问题，也不会影响下游的备份进程。\u003c/p\u003e\n\u003ch4 id=\"为什么选择并行而不是串行\"\u003e为什么选择并行而不是串行\u003c/h4\u003e\n\u003cp\u003e串行备份可能会导致一个问题：如果上游的备份过程中出现错误，那么这个错误会被传递到下游的备份。通过并行备份，我们可以避免这种情况，确保每个备份都是独立的。\u003c/p\u003e\n\u003ch4 id=\"备份工具的选择\"\u003e备份工具的选择\u003c/h4\u003e\n\u003cp\u003e在选择备份工具时，我考虑了以下几个标准：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e支持本地和云备份\u003c/strong\u003e：这样可以确保数据在本地和远程都有备份。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e支持增量备份\u003c/strong\u003e：只备份自上次备份以来发生变化的数据，节省时间和存储空间。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e支持压缩和加密\u003c/strong\u003e：保护数据安全的同时，减少存储需求。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e支持将备份数据分割成一定大小\u003c/strong\u003e：这对于远程备份尤其有用，可以提高小文件的上传速度，降低大文件上传失败的风险。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e支持定时备份\u003c/strong\u003e：自动化的定时备份可以确保数据始终是最新的。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e稳定性和易用性\u003c/strong\u003e：工具需要稳定运行，并且用户界面友好，易于操作。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在对比了多个备份工具后，我选择了 Kopia 和 Duplicati 。以下是它们的优缺点对比：\u003c/p\u003e\n\u003ch5 id=\"duplicati\"\u003eDuplicati\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e优点\u003c/strong\u003e：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e易于部署，通过 Docker 部署非常简单。\u003c/li\u003e\n\u003cli\u003e用户界面友好，易于操作。\u003c/li\u003e\n\u003cli\u003e支持同时连接多个仓库。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e缺点\u003c/strong\u003e：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用 .Net 实现，可能会占用更多的系统资源。\u003c/li\u003e\n\u003cli\u003e有关于稳定性的传闻，尽管这可能因环境而异。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"kopia\"\u003eKopia\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e优点\u003c/strong\u003e：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e稳定性的负面反馈较少，运行效率高。\u003c/li\u003e\n\u003cli\u003e占用资源相对较少，对系统的影响小。\u003c/li\u003e\n\u003cli\u003e用户界面简洁，易于理解。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e缺点\u003c/strong\u003e：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e部署和上手难度较高，相关资料较少，官方文档不够详尽。\u003c/li\u003e\n\u003cli\u003e不支持同时连接多个仓库，这在某些情况下可能会造成不便。\u003c/li\u003e\n\u003cli\u003e高级功能通常需要通过命令行实现，对于不熟悉命令行的用户来说可能不够友好。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"结语\"\u003e结语\u003c/h3\u003e\n\u003cp\u003e通过这样的备份方案，我可以确保我的数据在多种情况下都能得到保护。无论是硬件故障还是意外删除，我都有办法恢复我的数据。这给了我极大的安心，让我可以专注于我的工作和家庭生活，而不必担心数据安全问题。希望我的分享能为你的家庭数据备份提供一些启示。\u003c/p\u003e","title":"我的家庭数据备份方案"},{"content":"蚂蚁腿走大路，装了个全银色杠杆撞击式的车铃也够用，一半也算是配合全银车把，起个装饰作用。Jifo 走街串巷，骑了两次胡同就感觉原装车铃用着难受了。\n猫眼这款横拨铃铛（PB-1000P），拨一下响两声，声音清脆，音量不小，有二八大杠六厘米大铃的灵魂和大行原装车铃的风格身量，非常符合我对 Jifo 优化体验、尽量保留原车风格的改装思路。\n到手后发现，作为一个左手铃，铃体中轴是靠后的，大拇指拨动铃柄，其它四指要脱离刹把，效率不高，也不安全。试了几种安装方位，最后感觉左手吊装是最优方案，只需要食指自然下移就能搭在铃柄上，其它手指握住车把、刹把不用动，既安全、效率又高，而且 Jifo 把横较窄，车铃正装的话左侧一半把横几乎就搭载不了任何东西了，吊装之后铃铛被刹把遮挡，反而既能节省空间又让视觉效果更简洁。\n如果一定要正装的话，可以考虑 PB-1100P ，中轴居中，姆指更好够到。怪不得铃体相同的 PB-1000P 便宜不少，应该是为了兼容左手指拨所做的妥协，所幸 Jifo 这车也很特别，负负得正了属于是。\n出车试铃效果不错，连拨两下响铃四声，既过瘾，让行人避让的效果又好，唯一不足是铃声向下，于音量有损。\n","permalink":"http://0x3f.org/posts/highly-recommend-the-cat-eye-bell/","summary":"\u003cp\u003e蚂蚁腿走大路，装了个全银色杠杆撞击式的车铃也够用，一半也算是配合全银车把，起个装饰作用。Jifo 走街串巷，骑了两次胡同就感觉原装车铃用着难受了。\u003c/p\u003e\n\u003cp\u003e猫眼这款横拨铃铛（PB-1000P），拨一下响两声，声音清脆，音量不小，有二八大杠六厘米大铃的灵魂和大行原装车铃的风格身量，非常符合我对 Jifo 优化体验、尽量保留原车风格的改装思路。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-22-22-36-38-IMG_1043.jpeg\" alt=\"2024-01-22-22-36-38-IMG_1043\"\u003e\u003c/p\u003e\n\u003cp\u003e到手后发现，作为一个左手铃，铃体中轴是靠后的，大拇指拨动铃柄，其它四指要脱离刹把，效率不高，也不安全。试了几种安装方位，最后感觉左手吊装是最优方案，只需要食指自然下移就能搭在铃柄上，其它手指握住车把、刹把不用动，既安全、效率又高，而且 Jifo 把横较窄，车铃正装的话左侧一半把横几乎就搭载不了任何东西了，吊装之后铃铛被刹把遮挡，反而既能节省空间又让视觉效果更简洁。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-22-22-37-39-IMG_1034.jpeg\" alt=\"2024-01-22-22-37-39-IMG_1034\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-22-22-38-10-IMG_1044.jpeg\" alt=\"2024-01-22-22-38-10-IMG_1044\"\u003e\u003c/p\u003e\n\u003cp\u003e如果一定要正装的话，可以考虑 PB-1100P ，中轴居中，姆指更好够到。怪不得铃体相同的 PB-1000P 便宜不少，应该是为了兼容左手指拨所做的妥协，所幸 Jifo 这车也很特别，负负得正了属于是。\u003c/p\u003e\n\u003cp\u003e出车试铃效果不错，连拨两下响铃四声，既过瘾，让行人避让的效果又好，唯一不足是铃声向下，于音量有损。\u003c/p\u003e","title":"猫眼铃铛，我的梦中情铃"},{"content":"大行 Jifo 的原装前刹是单轴夹器，刹车力较弱，和后刹刹车力不一致会导致急刹车时发生甩尾，不安全。所以从这个车型在 12 年上市以后，就一直有人在探索前刹的改装方案。\nJifo 原装夹器的行程较短（约 51mm），左侧拉线，使用 51mm （裸露）长度的螺杆和普通螺母安装，想找到满足这些条件的双轴夹器是不可能的，不然十几年过去了，也不至于没有一个完美的改装案例。\n考虑了两种改造思路。\n一是用 Jifo 的升级版 eezz 的前夹器。从某种程度上说，这几乎是最完美的方案——行程合适、左侧拉线、双轴，但唯一的问题是只有黑色，需要脱漆、抛光并解决氧化的问题，而且物稀价贵，时间和物料成本较高。\n再就是用普通夹器改造。目前只能找到极少的左侧拉线的双轴夹器，但因为行程不合适，用不了。只能退而求其次，从右侧拉线的产品里挑。之前有人用彦豪 539 改过，但是不知道为什么，彦豪的夹器很少单卖，量少而且价格很高。所幸最后找到了彰星的夹器，做工用料都很好，而且造型美观。\n另买了个垃圾夹器，拆螺杆、螺母和垫片用。\n改装很成功，CP 值、刹车力和手感都有很大提升。\n但是折叠时必须小心翼翼地找刁钻的角度，否则容易撞到夹器，折叠后夹器和连接杆会因有干涉而产生轻微的损伤。\n所以想要完美地折叠，只能用左侧拉线的夹器，彰星的这款如果有左侧版本就太完美了，可惜难遂我愿，现在市面上的夹器几乎全是右侧拉线的，只能徒叹奈何了。\n总之这次的改造也能用，但权衡之下，我觉得折叠的流畅度更重要，何况原装的夹器也不是完全不能用，换装永杰 470 刹车皮之后制动力有一定的提升。暂时先这样吧，改造过的夹器留作备份了。\n2024-04-29 现在有了新的进展。 ","permalink":"http://0x3f.org/posts/the-road-to-modifying-jifos-front-brake/","summary":"\u003cp\u003e大行 Jifo 的原装前刹是单轴夹器，刹车力较弱，和后刹刹车力不一致会导致急刹车时发生甩尾，不安全。所以从这个车型在 12 年上市以后，就一直有人在探索前刹的改装方案。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-15-20-16-20-e3e356bd402bd5fcb4157225c29f5966.jpg\" alt=\"2024-01-15-20-16-20-e3e356bd402bd5fcb4157225c29f5966\"\u003e\u003c/p\u003e\n\u003cp\u003eJifo 原装夹器的行程较短（约 51mm），左侧拉线，使用 51mm （裸露）长度的螺杆和普通螺母安装，想找到满足这些条件的双轴夹器是不可能的，不然十几年过去了，也不至于没有一个完美的改装案例。\u003c/p\u003e\n\u003cp\u003e考虑了两种改造思路。\u003c/p\u003e\n\u003cp\u003e一是用 Jifo 的升级版 eezz 的前夹器。从某种程度上说，这几乎是最完美的方案——行程合适、左侧拉线、双轴，但唯一的问题是只有黑色，需要脱漆、抛光并解决氧化的问题，而且物稀价贵，时间和物料成本较高。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-15-19-35-39-12_161782_e4b20df32aa0866.jpg\" alt=\"2024-01-15-19-35-39-12_161782_e4b20df32aa0866\"\u003e\u003c/p\u003e\n\u003cp\u003e再就是用普通夹器改造。目前只能找到极少的左侧拉线的双轴夹器，但因为行程不合适，用不了。只能退而求其次，从右侧拉线的产品里挑。之前有人用彦豪 539 改过，但是不知道为什么，彦豪的夹器很少单卖，量少而且价格很高。所幸最后找到了彰星的夹器，做工用料都很好，而且造型美观。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-15-19-43-24-DSC00137.jpg\" alt=\"2024-01-15-19-43-24-DSC00137\"\u003e\u003c/p\u003e\n\u003cp\u003e另买了个垃圾夹器，拆螺杆、螺母和垫片用。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-15-19-44-36-DSC00136.jpg\" alt=\"2024-01-15-19-44-36-DSC00136\"\u003e\u003c/p\u003e\n\u003cp\u003e改装很成功，CP 值、刹车力和手感都有很大提升。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-15-19-45-51-DSC00139.jpg\" alt=\"2024-01-15-19-45-51-DSC00139\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2024-01-15-19-46-03-DSC00140.jpg\" alt=\"2024-01-15-19-46-03-DSC00140\"\u003e\u003c/p\u003e\n\u003cp\u003e但是折叠时必须小心翼翼地找刁钻的角度，否则容易撞到夹器，折叠后夹器和连接杆会因有干涉而产生轻微的损伤。\u003c/p\u003e\n\u003cp\u003e所以想要完美地折叠，只能用左侧拉线的夹器，彰星的这款如果有左侧版本就太完美了，可惜难遂我愿，现在市面上的夹器几乎全是右侧拉线的，只能徒叹奈何了。\u003c/p\u003e\n\u003cp\u003e总之这次的改造也能用，但权衡之下，我觉得折叠的流畅度更重要，何况原装的夹器也不是完全不能用，换装永杰 470 刹车皮之后制动力有一定的提升。暂时先这样吧，改造过的夹器留作备份了。\u003c/p\u003e\n\u003chr\u003e\n\u003cul\u003e\n\u003cli\u003e2024-04-29 现在有了\u003ca href=\"/posts/the-end-of-road-to-modifying-jifos-front-brake/\"\u003e新的进展\u003c/a\u003e。\u003c/li\u003e\n\u003c/ul\u003e","title":"Jifo 前刹的改造之路：彰星夹器的优缺点"},{"content":"本文旨在通过把 MariaDB 的错误日志重定向到 Docker 的错误控制台以实现通过 Loki 收集日志，并使用日志轮转控制日志文件大小。\n指定固定的日志文件名 1 2 [mariadb] log_error=/config/databases/mariadb.err 把容器中的错误日志重定向到 Docker 日志控制台 在容器的环境变量中添加以下内容：\n1 2 DOCKER_MODS=lscr.io/linuxserver/mods:universal-stdout-logs LOGS_TO_STDOUT=/config/databases/mariadb.err 设置 MariaDB 的 root@localhost 用户的鉴权方式 创建 root@localhost 用户：\n1 CREATE USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED VIA \u0026#39;unix_socket\u0026#39;; 或更改已存在的 root@localhost 用户的鉴权方式：\n1 ALTER USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED VIA \u0026#39;unix_socket\u0026#39;; 受权 RELOAD 给 root@localhost 用户 1 GRANT RELOAD ON *.* TO \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39;;` 配置 logrotate 在宿主机创建 /etc/logrotate.d/mariadb：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 /mnt/user/appdata/mariadb/databases/mariadb.err { su nobody users missingok create 660 nobody users notifempty daily minsize 1M maxsize 100M rotate 30 dateext dateformat .%Y-%m-%d-%H-%M-%S compress delaycompress sharedscripts olddir ../archive/ createolddir 770 nobody users postrotate # just if mysqld is really running if docker exec mariadb test -x /usr/bin/mysqladmin \u0026amp;\u0026amp; \\ docker exec mariadb /usr/bin/mysqladmin ping \u0026amp;\u0026gt;/dev/null then docker exec mariadb /usr/bin/mysqladmin --local flush-error-log \\ flush-engine-log flush-general-log flush-slow-log fi endscript } 可通过以下命令测试效果：\n1 logrotate --force /etc/logrotate.d/mariadb` ","permalink":"http://0x3f.org/posts/steps-to-implement-redirection-and-rotation-for-error-logs-of-docker-deployed-mariadb/","summary":"\u003cp\u003e本文旨在通过把 MariaDB 的错误日志重定向到 Docker 的错误控制台以实现通过 Loki 收集日志，并使用日志轮转控制日志文件大小。\u003c/p\u003e\n\u003ch1 id=\"指定固定的日志文件名\"\u003e指定固定的日志文件名\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[mariadb]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elog_error\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/config/databases/mariadb.err\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch1 id=\"把容器中的错误日志重定向到-docker-日志控制台\"\u003e把容器中的错误日志重定向到 Docker 日志控制台\u003c/h1\u003e\n\u003cp\u003e在容器的环境变量中添加以下内容：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eDOCKER_MODS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003elscr.io/linuxserver/mods:universal-stdout-logs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eLOGS_TO_STDOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/config/databases/mariadb.err\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch1 id=\"设置-mariadb-的-rootlocalhost-用户的鉴权方式\"\u003e设置 MariaDB 的 root@localhost 用户的鉴权方式\u003c/h1\u003e\n\u003cp\u003e创建 root@localhost 用户：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eUSER\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;root\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;localhost\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eIDENTIFIED\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eVIA\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;unix_socket\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e或更改已存在的 root@localhost 用户的鉴权方式：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eALTER\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eUSER\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;root\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;localhost\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eIDENTIFIED\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eVIA\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;unix_socket\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch1 id=\"受权-reload-给-rootlocalhost-用户\"\u003e受权 RELOAD 给 root@localhost 用户\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eGRANT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eRELOAD\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eON\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eTO\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;root\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;localhost\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch1 id=\"配置-logrotate\"\u003e配置 logrotate\u003c/h1\u003e\n\u003cp\u003e在宿主机创建 \u003ccode\u003e/etc/logrotate.d/mariadb\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/mnt/user/appdata/mariadb/databases/mariadb.err \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        su nobody users\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        missingok\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        create \u003cspan class=\"m\"\u003e660\u003c/span\u003e nobody users\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        notifempty\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        daily\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        minsize 1M\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        maxsize 100M\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        rotate \u003cspan class=\"m\"\u003e30\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        dateext\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        dateformat .%Y-%m-%d-%H-%M-%S\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        compress\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        delaycompress\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        sharedscripts \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        olddir ../archive/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        createolddir \u003cspan class=\"m\"\u003e770\u003c/span\u003e nobody users\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    postrotate\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# just if mysqld is really running\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e mariadb \u003cspan class=\"nb\"\u003etest\u003c/span\u003e -x /usr/bin/mysqladmin \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e           docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e mariadb /usr/bin/mysqladmin ping \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u0026gt;/dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           docker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e mariadb /usr/bin/mysqladmin --local flush-error-log \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e              flush-engine-log flush-general-log flush-slow-log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    endscript\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e可通过以下命令测试效果：\u003c/p\u003e","title":"轻松管理 Docker 下的 MariaDB 错误日志：重定向到日志控制台和日志轮转"},{"content":"映射下载机端口到外网 申请公网 IP 找宽带客服给分配公网 IP 地址。现在一般是给城域网地址了吧，不过也能用。\n配置光猫桥接 找宽带客服提要求，会安排维修人员上门处理。\n配置路由器 映射下载机端口 把 BT 客户端所在的 IP 和端口映射到外网：\n打开 uPnP 配置 BT 客户端 指定固定的端口号，和前面路由器里的端口映射对应：\n更新 Trackers 从下面网址获取最新的 tracker 服务器，保存到 BT 客户端里：\nhttps://trackerslist.com/best.txt\n其它问题 Alternative Rate Limits qBittorrent 有个可选限速的配置，默认是 10KiBps ，如果误点了状态栏的按钮可能会启用这个配置，导致速度上不去。\n","permalink":"http://0x3f.org/posts/how-to-optimize-bt-download-speed/","summary":"\u003ch1 id=\"映射下载机端口到外网\"\u003e映射下载机端口到外网\u003c/h1\u003e\n\u003ch2 id=\"申请公网-ip\"\u003e申请公网 IP\u003c/h2\u003e\n\u003cp\u003e找宽带客服给分配公网 IP 地址。现在一般是给城域网地址了吧，不过也能用。\u003c/p\u003e\n\u003ch2 id=\"配置光猫桥接\"\u003e配置光猫桥接\u003c/h2\u003e\n\u003cp\u003e找宽带客服提要求，会安排维修人员上门处理。\u003c/p\u003e\n\u003ch2 id=\"配置路由器\"\u003e配置路由器\u003c/h2\u003e\n\u003ch3 id=\"映射下载机端口\"\u003e映射下载机端口\u003c/h3\u003e\n\u003cp\u003e把 BT 客户端所在的 IP 和端口映射到外网：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-15-23-15-55-IMG_0699.jpeg\" alt=\"2023-11-15-23-15-55-IMG_0699\"\u003e\u003c/p\u003e\n\u003ch3 id=\"打开-upnp\"\u003e打开 uPnP\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-15-23-16-47-mac_20231106165924.png\" alt=\"2023-11-15-23-16-47-mac_20231106165924\"\u003e\u003c/p\u003e\n\u003ch2 id=\"配置-bt-客户端\"\u003e配置 BT 客户端\u003c/h2\u003e\n\u003cp\u003e指定固定的端口号，和前面路由器里的端口映射对应：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-15-23-23-27-mac_20231106165358.png\" alt=\"2023-11-15-23-23-27-mac_20231106165358\"\u003e\u003c/p\u003e\n\u003ch1 id=\"更新-trackers\"\u003e更新 Trackers\u003c/h1\u003e\n\u003cp\u003e从下面网址获取最新的 tracker 服务器，保存到 BT 客户端里：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://trackerslist.com/best.txt\"\u003ehttps://trackerslist.com/best.txt\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-15-23-24-11-mac_20231106165512.png\" alt=\"2023-11-15-23-24-11-mac_20231106165512\"\u003e\u003c/p\u003e\n\u003ch1 id=\"其它问题\"\u003e其它问题\u003c/h1\u003e\n\u003ch2 id=\"alternative-rate-limits\"\u003eAlternative Rate Limits\u003c/h2\u003e\n\u003cp\u003eqBittorrent 有个可选限速的配置，默认是 10KiBps ，如果误点了状态栏的按钮可能会启用这个配置，导致速度上不去。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-15-23-24-50-IMG_0632.jpeg\" alt=\"2023-11-15-23-24-50-IMG_0632\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-15-23-24-51-mac_20231106165553.png\" alt=\"2023-11-15-23-24-51-mac_20231106165553\"\u003e\u003c/p\u003e","title":"优化 BT 下载速度的方法"},{"content":"以前一直只用 1L 的车头包，想多带点东西时就会觉得很局促，而且折叠之前要先把包里的东西拿出来，多有不便。最近试用了几款尾包，分享一下我的使用感受。\n洛克兄弟尾包，美而不便 最初被洛克兄弟这款 0.73L 的尾包吸引是因为它的外形，增一分太大，减一分太小，线条流畅而不古板，点缀不多又不寒酸，突出一个恰到好处。\n包的内部收纳设计尚可，内壁两侧各有一个夹层，兼顾了零碎的收纳和保留了较大的剩余空间。拉开底部的拉锁还可以进一步扩展容量，这一点考虑得很周到。如果开口处能再加一个夹层就更好了。\n装车后整体也比较满意，但有个使用上较为不便的问题：挑座垫。它的开口上沿紧贴座垫，如果座垫后缘稍长就会压住开口，再加上这款包用的防水拉锁阻尼较大，所以拉的时候很不方便。在我另外一个后缘较短的座垫上，这个问题会得到缓解。\n此外，包的后部可以挂尾灯，这点很好。\n考虑之后还是退了，毕竟一个提供方便的东西，如果用起来有感到不便的地方，还是有点本末倒置了。\nINBIKE 尾包很好，除了颜值 INBIKE 的这款尾包在材质和工艺上和洛克兄弟的很像。由造型的原因，容量明显大于后者，开口也不易被座垫遮挡，加上它的防水拉锁阻尼没那么大，所以相对来说更容量拉开。\n内部收纳设计较为简单，除了开口处有一个夹层外，再无空间的划分，也算兼顾了小物价的收纳并提供了更大的一体空间。\n包的后盖也提供了挂载尾灯的位点。\n在相似的材质、工艺下，这款包的价格比洛克兄弟那款便宜三分之一左右，而容量更大，使用更方便，确实是个很有性价比的选择。唯一让我不满意的地方是造型比较呆板，点缀有点俗气。\n迪卡侬尾包，目标明确，针对性很强 迪卡侬的这款尾包容量不大（0.6L），内部分割为上下两层，下层有三个夹层，适合带点修车工具和备胎，想带点别的随身物品就不够用了，所以目标很明确，针对性很强。\n此外，造型好看，开口位于下方、且没有采用防水拉锁，很方便存取物品，外表覆盖大面积反光涂层，夜骑很亮。\n总之，适合专业骑行，不适合日常使用。\n犀牛尾包，轻且防水……没了 犀牛的这款尾包为了追求极致的轻量，减掉了一切可以减掉的东西，没有分割内部收纳空间、没有尾灯挂载位点，把重量压缩到了 70g 附近。包体材料是 600D TPU ，使用防水拉锁，看起来防水效果应该很不错。\n但它的内部什么夹层、分隔都没有，就是一整块收纳空间，稍大点的东西放不下，小东西堆在一起不好取用。\n8￥包邮的帆布包，完美满足我骑行收纳需求 此前试用的几款正经的尾包，要么使用不方便，要么收纳空间太小，而且它们都太正经了，和我这菜车的气质不搭嘎。我对尾包的所有想象在于容量大、使用方便、休闲风，直到偶然发现这个战术回收包，这不就是我的梦中情包么？\n用了一段时间，效果非常理想。外侧三个夹层，加上包内超大收纳空间，平时带一些随身物品绰绰有余，偶尔买点干果零食甚至直接往里一塞就行。\n重点是，只要8块包邮！同等容量的某网红车包价格是它的7倍，而收纳设计还更简陋。\n鲁迅说过，要啥自行车！\n","permalink":"http://0x3f.org/posts/experience-on-several-bicycle-saddle-bags/","summary":"\u003cp\u003e以前一直只用 1L 的车头包，想多带点东西时就会觉得很局促，而且折叠之前要先把包里的东西拿出来，多有不便。最近试用了几款尾包，分享一下我的使用感受。\u003c/p\u003e\n\u003ch1 id=\"洛克兄弟尾包美而不便\"\u003e洛克兄弟尾包，美而不便\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-32-57-DSC00106.JPG\" alt=\"2023-11-14-22-32-57-DSC00106\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-33-00-DSC00107.JPG\" alt=\"2023-11-14-22-33-00-DSC00107\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-33-03-DSC00108.JPG\" alt=\"2023-11-14-22-33-03-DSC00108\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-33-05-DSC00109.JPG\" alt=\"2023-11-14-22-33-05-DSC00109\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-33-07-DSC00110.JPG\" alt=\"2023-11-14-22-33-07-DSC00110\"\u003e\u003c/p\u003e\n\u003cp\u003e最初被洛克兄弟这款 0.73L 的尾包吸引是因为它的外形，增一分太大，减一分太小，线条流畅而不古板，点缀不多又不寒酸，突出一个恰到好处。\u003c/p\u003e\n\u003cp\u003e包的内部收纳设计尚可，内壁两侧各有一个夹层，兼顾了零碎的收纳和保留了较大的剩余空间。拉开底部的拉锁还可以进一步扩展容量，这一点考虑得很周到。如果开口处能再加一个夹层就更好了。\u003c/p\u003e\n\u003cp\u003e装车后整体也比较满意，但有个使用上较为不便的问题：挑座垫。它的开口上沿紧贴座垫，如果座垫后缘稍长就会压住开口，再加上这款包用的防水拉锁阻尼较大，所以拉的时候很不方便。在我另外一个后缘较短的座垫上，这个问题会得到缓解。\u003c/p\u003e\n\u003cp\u003e此外，包的后部可以挂尾灯，这点很好。\u003c/p\u003e\n\u003cp\u003e考虑之后还是退了，毕竟一个提供方便的东西，如果用起来有感到不便的地方，还是有点本末倒置了。\u003c/p\u003e\n\u003ch1 id=\"inbike-尾包很好除了颜值\"\u003eINBIKE 尾包很好，除了颜值\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-37-16-DSC00111.JPG\" alt=\"2023-11-14-22-37-16-DSC00111\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-37-18-DSC00112.JPG\" alt=\"2023-11-14-22-37-18-DSC00112\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-37-21-DSC00113.JPG\" alt=\"2023-11-14-22-37-21-DSC00113\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-37-23-DSC00114.JPG\" alt=\"2023-11-14-22-37-23-DSC00114\"\u003e\u003c/p\u003e\n\u003cp\u003eINBIKE 的这款尾包在材质和工艺上和洛克兄弟的很像。由造型的原因，容量明显大于后者，开口也不易被座垫遮挡，加上它的防水拉锁阻尼没那么大，所以相对来说更容量拉开。\u003c/p\u003e\n\u003cp\u003e内部收纳设计较为简单，除了开口处有一个夹层外，再无空间的划分，也算兼顾了小物价的收纳并提供了更大的一体空间。\u003c/p\u003e\n\u003cp\u003e包的后盖也提供了挂载尾灯的位点。\u003c/p\u003e\n\u003cp\u003e在相似的材质、工艺下，这款包的价格比洛克兄弟那款便宜三分之一左右，而容量更大，使用更方便，确实是个很有性价比的选择。唯一让我不满意的地方是造型比较呆板，点缀有点俗气。\u003c/p\u003e\n\u003ch1 id=\"迪卡侬尾包目标明确针对性很强\"\u003e迪卡侬尾包，目标明确，针对性很强\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-39-18-DSC00119.JPG\" alt=\"2023-11-14-22-39-18-DSC00119\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-39-21-DSC00120.JPG\" alt=\"2023-11-14-22-39-21-DSC00120\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-39-24-DSC00121.JPG\" alt=\"2023-11-14-22-39-24-DSC00121\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-39-26-DSC00122.JPG\" alt=\"2023-11-14-22-39-26-DSC00122\"\u003e\u003c/p\u003e\n\u003cp\u003e迪卡侬的这款尾包容量不大（0.6L），内部分割为上下两层，下层有三个夹层，适合带点修车工具和备胎，想带点别的随身物品就不够用了，所以目标很明确，针对性很强。\u003c/p\u003e\n\u003cp\u003e此外，造型好看，开口位于下方、且没有采用防水拉锁，很方便存取物品，外表覆盖大面积反光涂层，夜骑很亮。\u003c/p\u003e\n\u003cp\u003e总之，适合专业骑行，不适合日常使用。\u003c/p\u003e\n\u003ch1 id=\"犀牛尾包轻且防水没了\"\u003e犀牛尾包，轻且防水……没了\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-41-10-DSC00123.JPG\" alt=\"2023-11-14-22-41-10-DSC00123\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-41-12-DSC00124.JPG\" alt=\"2023-11-14-22-41-12-DSC00124\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-41-15-DSC00125.JPG\" alt=\"2023-11-14-22-41-15-DSC00125\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-41-17-DSC00126.JPG\" alt=\"2023-11-14-22-41-17-DSC00126\"\u003e\u003c/p\u003e\n\u003cp\u003e犀牛的这款尾包为了追求极致的轻量，减掉了一切可以减掉的东西，没有分割内部收纳空间、没有尾灯挂载位点，把重量压缩到了 70g 附近。包体材料是 600D TPU ，使用防水拉锁，看起来防水效果应该很不错。\u003c/p\u003e\n\u003cp\u003e但它的内部什么夹层、分隔都没有，就是一整块收纳空间，稍大点的东西放不下，小东西堆在一起不好取用。\u003c/p\u003e\n\u003ch1 id=\"8包邮的帆布包完美满足我骑行收纳需求\"\u003e8￥包邮的帆布包，完美满足我骑行收纳需求\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-42-54-DSC00115.JPG\" alt=\"2023-11-14-22-42-54-DSC00115\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-42-56-DSC00116.JPG\" alt=\"2023-11-14-22-42-56-DSC00116\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-42-58-DSC00117.JPG\" alt=\"2023-11-14-22-42-58-DSC00117\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-11-14-22-43-00-DSC00118.JPG\" alt=\"2023-11-14-22-43-00-DSC00118\"\u003e\u003c/p\u003e\n\u003cp\u003e此前试用的几款正经的尾包，要么使用不方便，要么收纳空间太小，而且它们都太正经了，和我这菜车的气质不搭嘎。我对尾包的所有想象在于容量大、使用方便、休闲风，直到偶然发现这个战术回收包，这不就是我的梦中情包么？\u003c/p\u003e\n\u003cp\u003e用了一段时间，效果非常理想。外侧三个夹层，加上包内超大收纳空间，平时带一些随身物品绰绰有余，偶尔买点干果零食甚至直接往里一塞就行。\u003c/p\u003e\n\u003cp\u003e重点是，只要8块包邮！同等容量的某网红车包价格是它的7倍，而收纳设计还更简陋。\u003c/p\u003e\n\u003cp\u003e鲁迅说过，要啥自行车！\u003c/p\u003e","title":"8￥包邮的帆布包，实现了我对骑行收纳的所有想象"},{"content":"\n之前试用过第一次发售的版本，体验非常糟糕。前不久发现翰林阅又发了预售通知，原来经过上次哀鸿遍野的退货潮，他们迭代了产品重新上市了。\n新的工业设计比之前好看 外壳正面由原来内嵌到背盖里改成了覆盖式，隐藏了边缝。 外壳边缘和屏幕边缘的下凹处都有倒角，视觉效果圆润且触感很好。 品牌标识由原来的深色大字改成了浅色小字，看起来和谐多了。 做工比之前好了很多，但还是不够好 边缝比以前小多了，但是有的边角还是有缝，按压没有咔哒声了，但能看到轻微的跷跷板现象。 显示效果进步有限 屏幕的显示效果好了很多，墨迹不均匀的问题没有了，但还是没解决残影问题 背光的灯箱效果没解决 背光不像之前那样没法看了，但还是泛蓝、有灯箱效果，和文石 Poke5S 一样，弱光下看起来很不舒服 系统简陋，优化很差 连输入法的设置都没有，无法使用双拼，在电子墨水屏幕上用全拼体验太差了。 在微信读书中输入笔记时，光标的闪动会每隔几秒触发一次屏幕全刷新，体验很差。 和之前一样，看着挺好的配置，操作一点都不跟手。 总结 更新后的新机器做工好了很多，边缘的倒角和背盖的斜坡设计使得握持感比我现在用的墨案 Air 好很多，如果不是背光太影响阅读体验以及系统优化太差，它应该是个非常符合我需求的阅读器。\n","permalink":"http://0x3f.org/posts/hands-on-the-new-hanlinyue-read6-pro/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-10-02-17-08-57-DSC00101.jpg\" alt=\"2023-10-02-17-08-57-DSC00101\"\u003e\u003c/p\u003e\n\u003cp\u003e之前\u003ca href=\"/posts/hands-on-hanlinyue-read6-pro/\"\u003e试用过第一次发售的版本\u003c/a\u003e，体验非常糟糕。前不久发现翰林阅又发了预售通知，原来经过上次哀鸿遍野的退货潮，他们迭代了产品重新上市了。\u003c/p\u003e\n\u003ch1 id=\"新的工业设计比之前好看\"\u003e新的工业设计比之前好看\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e外壳正面由原来内嵌到背盖里改成了覆盖式，隐藏了边缝。\u003c/li\u003e\n\u003cli\u003e外壳边缘和屏幕边缘的下凹处都有倒角，视觉效果圆润且触感很好。\u003c/li\u003e\n\u003cli\u003e品牌标识由原来的深色大字改成了浅色小字，看起来和谐多了。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"做工比之前好了很多但还是不够好\"\u003e做工比之前好了很多，但还是不够好\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e边缝比以前小多了，但是有的边角还是有缝，按压没有咔哒声了，但能看到轻微的跷跷板现象。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"显示效果进步有限\"\u003e显示效果进步有限\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e屏幕的显示效果好了很多，墨迹不均匀的问题没有了，但还是没解决残影问题\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-10-02-17-11-20-DSC00100.jpg\" alt=\"2023-10-02-17-11-20-DSC00100\"\u003e\u003c/p\u003e\n\u003ch1 id=\"背光的灯箱效果没解决\"\u003e背光的灯箱效果没解决\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e背光不像之前那样没法看了，但还是泛蓝、有灯箱效果，和文石 Poke5S 一样，弱光下看起来很不舒服\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-10-02-17-10-41-DSC00103.jpg\" alt=\"2023-10-02-17-10-41-DSC00103\"\u003e\u003c/p\u003e\n\u003ch1 id=\"系统简陋优化很差\"\u003e系统简陋，优化很差\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e连输入法的设置都没有，无法使用双拼，在电子墨水屏幕上用全拼体验太差了。\u003c/li\u003e\n\u003cli\u003e在微信读书中输入笔记时，光标的闪动会每隔几秒触发一次屏幕全刷新，体验很差。\u003c/li\u003e\n\u003cli\u003e和之前一样，看着挺好的配置，操作一点都不跟手。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"总结\"\u003e总结\u003c/h1\u003e\n\u003cp\u003e更新后的新机器做工好了很多，边缘的倒角和背盖的斜坡设计使得握持感比我现在用的墨案 Air 好很多，如果不是背光太影响阅读体验以及系统优化太差，它应该是个非常符合我需求的阅读器。\u003c/p\u003e","title":"重新发售的翰林阅 Read6 Pro 使用体验"},{"content":"抢票的过程令人很不愉快，各种报错，拼命地点了一通后，终于抢到了当天和周三的票，每天生成了好几单，说明当时系统有重复下单的问题（今天再看的时候已经改成点完按钮以后、响应返回之前禁止点击了）。结果当天下午过去后刷不进去，再看的时候发现当天的订单都不见了，只剩下周三的一个单。这种情况肯定是人为删了。跟我前后脚到场的也有一家人也是这种情况。工作人员说去查数据库，等了半天也没结果，正好维修人员来修宽带，我就回家了，不知道那家人后来进没进去。\n等到周三终于进去了。\n安保等级很高，到处都是工作人员。内部装修很好，基础设施完备，毕竟是新馆，因为每天限 500 个名额，人也不多，总体观展体验很好。展品很硬，有一些只在书和电视上看过的东西，像是赴了个多年的约会。赶上了下午三点的讲解，耗时一个半小时，听完正好清场，讲解员很辛苦也很专业，但我觉得讲得太浅，只是简介性质。一共四层，第一层主要是两具陪葬车马，二、三层是主要内容，四层偏近代。文创店在一层，东西一般，不少人在那买了本子到各展区盖章，觉得没什么意义，就没有做。\n","permalink":"http://0x3f.org/posts/my-first-visit-to-the-national-archaeological-museum-of-china/","summary":"\u003cp\u003e抢票的过程令人很不愉快，各种报错，拼命地点了一通后，终于抢到了当天和周三的票，每天生成了好几单，说明当时系统有重复下单的问题（今天再看的时候已经改成点完按钮以后、响应返回之前禁止点击了）。结果当天下午过去后刷不进去，再看的时候发现当天的订单都不见了，只剩下周三的一个单。这种情况肯定是人为删了。跟我前后脚到场的也有一家人也是这种情况。工作人员说去查数据库，等了半天也没结果，正好维修人员来修宽带，我就回家了，不知道那家人后来进没进去。\u003c/p\u003e\n\u003cp\u003e等到周三终于进去了。\u003c/p\u003e\n\u003cp\u003e安保等级很高，到处都是工作人员。内部装修很好，基础设施完备，毕竟是新馆，因为每天限 500 个名额，人也不多，总体观展体验很好。展品很硬，有一些只在书和电视上看过的东西，像是赴了个多年的约会。赶上了下午三点的讲解，耗时一个半小时，听完正好清场，讲解员很辛苦也很专业，但我觉得讲得太浅，只是简介性质。一共四层，第一层主要是两具陪葬车马，二、三层是主要内容，四层偏近代。文创店在一层，东西一般，不少人在那买了本子到各展区盖章，觉得没什么意义，就没有做。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-35-IMG_0353.jpg\" alt=\"2023-09-27-23-40-35-IMG_0353\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-54-IMG_0356.jpg\" alt=\"2023-09-27-23-40-54-IMG_0356\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-51-IMG_0359.jpg\" alt=\"2023-09-27-23-40-51-IMG_0359\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-47-IMG_0362.jpg\" alt=\"2023-09-27-23-40-47-IMG_0362\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-49-IMG_0360.jpg\" alt=\"2023-09-27-23-40-49-IMG_0360\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-44-IMG_0364.jpg\" alt=\"2023-09-27-23-40-44-IMG_0364\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-42-IMG_0365.jpg\" alt=\"2023-09-27-23-40-42-IMG_0365\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-27-23-40-40-IMG_0366.jpg\" alt=\"2023-09-27-23-40-40-IMG_0366\"\u003e\u003c/p\u003e","title":"首刷中国考古博物馆"},{"content":"今年对微信读书载体的寻觅12落在了墨案 Air 上。\n优点是屏幕显示和背光这两个核心指标过关。Carta 1200、300 PPI，文字的锐度不错，底色较白，背光比较自然，相对其它国产 6 寸阅读器来说更接近纸质书的效果，不会过度影响阅读的沉浸感。\n和文石 Poke5S 的对比：\n抛开 212 的 PPI 不说，后者的背光在环境光强度较高的时候看着还行，但是弱光条件下明显泛蓝，调节暖色光也没有用，感觉冷光是冷光、暖光是暖光，而墨案 Air 的两色背光融合度好得多。\n不过，这都 2023 年了，国产阅读器在 Carta 1200 加持下的显示效果都比不过 6 年前的 Kindle Oasis 2 ，后者还是 Carta 1000 。如果不是有些书的特定版本只在微信读书上有，我才不在这些电子垃圾上花时间。\n缺点比较多。\n首先是反应慢，明显不跟手，和其它主要竞品比简直没眼看。不过，鉴于主要操作只有翻页，也就问题不大了。\n其次，残影明显。这算是国产阅读器的通病了。不过拿电子书阅读器看的一般都是纯文字的书，残影只在显示图片时严重影响观感，也算勉强可以接受。\n256 灰阶默认是关闭的，这很难理解，除非打开会有更大的问题，但我暂时没发现。打开后图片过渡更平滑，但依然看不到文石 Poke5S 能看到的阴影：\n此外还有：\n屏幕盖板是塑料材质，需要注意刮花。 做工一般，边缘有点割手。 前黑后蓝有条纹，外观一般。 今年 6 寸国产阅读器还是没有让我很满意的，考虑到影响阅读体验的核心指标还说得过去，另外背面有弧度、握持感不错，先就它了。\n文石 Poke5S 的使用感受\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n翰林阅 Read6 Pro 的使用感受\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"http://0x3f.org/posts/hands-on-moaan-air/","summary":"\u003cp\u003e今年对微信读书载体的寻觅\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e落在了墨案 Air 上。\u003c/p\u003e\n\u003cp\u003e优点是屏幕显示和背光这两个核心指标过关。Carta 1200、300 PPI，文字的锐度不错，底色较白，背光比较自然，相对其它国产 6 寸阅读器来说更接近纸质书的效果，不会过度影响阅读的沉浸感。\u003c/p\u003e\n\u003cp\u003e和文石 Poke5S 的对比：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-12-23-19-04-DSC00095.jpg\" alt=\"2023-09-12-23-19-04-DSC00095\"\u003e\u003c/p\u003e\n\u003cp\u003e抛开 212 的 PPI 不说，后者的背光在环境光强度较高的时候看着还行，但是弱光条件下明显泛蓝，调节暖色光也没有用，感觉冷光是冷光、暖光是暖光，而墨案 Air 的两色背光融合度好得多。\u003c/p\u003e\n\u003cp\u003e不过，这都 2023 年了，国产阅读器在 Carta 1200 加持下的显示效果都比不过 6 年前的 Kindle Oasis 2 ，后者还是 Carta 1000 。如果不是有些书的特定版本只在微信读书上有，我才不在这些电子垃圾上花时间。\u003c/p\u003e\n\u003cp\u003e缺点比较多。\u003c/p\u003e\n\u003cp\u003e首先是反应慢，明显不跟手，和其它主要竞品比简直没眼看。不过，鉴于主要操作只有翻页，也就问题不大了。\u003c/p\u003e\n\u003cp\u003e其次，残影明显。这算是国产阅读器的通病了。不过拿电子书阅读器看的一般都是纯文字的书，残影只在显示图片时严重影响观感，也算勉强可以接受。\u003c/p\u003e\n\u003cp\u003e256 灰阶默认是关闭的，这很难理解，除非打开会有更大的问题，但我暂时没发现。打开后图片过渡更平滑，但依然看不到文石 Poke5S 能看到的阴影：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-09-12-23-44-27-DSC00096.jpg\" alt=\"2023-09-12-23-44-27-DSC00096\"\u003e\u003c/p\u003e\n\u003cp\u003e此外还有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e屏幕盖板是塑料材质，需要注意刮花。\u003c/li\u003e\n\u003cli\u003e做工一般，边缘有点割手。\u003c/li\u003e\n\u003cli\u003e前黑后蓝有条纹，外观一般。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e今年 6 寸国产阅读器还是没有让我很满意的，考虑到影响阅读体验的核心指标还说得过去，另外背面有弧度、握持感不错，先就它了。\u003c/p\u003e\n\u003cdiv class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\"\u003e\n\u003cp\u003e\u003ca href=\"/posts/hands-on-boox-poke5s/\"\u003e文石 Poke5S 的使用感受\u003c/a\u003e\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:2\"\u003e\n\u003cp\u003e\u003ca href=\"/posts/hands-on-hanlinyue-read6-pro/\"\u003e翰林阅 Read6 Pro 的使用感受\u003c/a\u003e\u0026#160;\u003ca href=\"#fnref:2\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e","title":"墨案 Air 的使用感受"},{"content":"refine-task 的功能非常简单，它为选中的任务打开一个输入框，将用户输入的内容作为新的任务内容保存，原来的任务内容会被挪到备注里：\nYour browser does not support the video tag. 我用快捷指令“收集 Tweet 到 OmniFocus”收集 tweets ，但是因为 tweet 内容较长，不方便 review 的时候快速了解为什么收集这条内容，所以我用快捷指令“提炼 OmniFocus”利用 ChatGPT 提炼待办事项并复制到剪贴板，接着这个快捷指令会调用 refine-task 把条目原文移动到备注里并打开输入框由用户粘贴或者输入待办事项。\n","permalink":"http://0x3f.org/posts/omnifocus-plugin-refine-task-v1-release-notes/","summary":"\u003cp\u003e\u003ca href=\"https://github.com/xbot/omnifocus-plugin-refine-task\"\u003erefine-task\u003c/a\u003e 的功能非常简单，它为选中的任务打开一个输入框，将用户输入的内容作为新的任务内容保存，原来的任务内容会被挪到备注里：\u003c/p\u003e\n\u003cvideo controls autoplay loop width=\"100%\"\u003e\n  \u003csource src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-30-22-04-08-Kapture 2023-08-30 at 19.33.05.mp4\" type=\"video/mp4\"\u003e\n  Your browser does not support the video tag.\n\u003c/video\u003e\n\u003cp\u003e我用快捷指令“\u003ca href=\"https://www.icloud.com/shortcuts/dd3a5d430a434d39aff4e3092e7abfee\"\u003e收集 Tweet 到 OmniFocus\u003c/a\u003e”收集 tweets ，但是因为 tweet 内容较长，不方便 review 的时候快速了解为什么收集这条内容，所以我用快捷指令“\u003ca href=\"https://www.icloud.com/shortcuts/899467b735304519aa4b26b8c7756433\"\u003e提炼 OmniFocus\u003c/a\u003e”利用 ChatGPT 提炼待办事项并复制到剪贴板，接着这个快捷指令会调用 refine-task 把条目原文移动到备注里并打开输入框由用户粘贴或者输入待办事项。\u003c/p\u003e","title":"OmniFocus 插件 refine-task v1.0 小记"},{"content":"做饭产生的湿垃圾，说多不多，说少不少，不想浪费垃圾袋，等快满了才扔。但是每次掀开桶盖都跟开盲盒似的，被各种难言的味儿熏一跟头，有几天吃水果比较多，打开桶盖跟天女散花一样，很多小虫子🪰。\n疫情期间剩下不少酒精消毒液，最近灵机一动，每次饭后给厨余垃圾喷一点，几天下来既不生虫也没有怪味儿。🤪\n","permalink":"http://0x3f.org/posts/summer-kitchen-organic-waste-preservation-insect-prevention-tips/","summary":"\u003cp\u003e做饭产生的湿垃圾，说多不多，说少不少，不想浪费垃圾袋，等快满了才扔。但是每次掀开桶盖都跟开盲盒似的，被各种难言的味儿熏一跟头，有几天吃水果比较多，打开桶盖跟天女散花一样，很多小虫子🪰。\u003c/p\u003e\n\u003cp\u003e疫情期间剩下不少酒精消毒液，最近灵机一动，每次饭后给厨余垃圾喷一点，几天下来既不生虫也没有怪味儿。🤪\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-26-19-10-23-IMG_0264.jpeg\" alt=\"2023-08-26-19-10-23-IMG_0264\"\u003e\u003c/p\u003e","title":"夏季厨余垃圾防腐防虫绝招"},{"content":"Twitter for macOS 不支持用 Esc 键关闭图片预览窗口，不符合我的习惯。下面是针对 Twitter App 把 Esc 键映射为 Cmd+W 的配置。\n","permalink":"http://0x3f.org/posts/using-karabiner-elements-to-close-twitter-app-windows-with-the-esc-key/","summary":"\u003cp\u003eTwitter for macOS 不支持用 Esc 键关闭图片预览窗口，不符合我的习惯。下面是针对 Twitter App 把 Esc 键映射为 Cmd+W 的配置。\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/xbot/483d360beae96f734f7b44a298e33125.js\"\u003e\u003c/script\u003e","title":"通过 Karabiner-Elements 实现用 Esc 键关闭 Twitter App 的窗口"},{"content":"之前用的 Xee 看图的时候经常雪花屏，所以换了 PictureView 。\n有这些特点：\n启动速度很快。 界面简洁。 支持关闭图片自动退出。 提供 4 种浏览布局。 支持快捷键。 ","permalink":"http://0x3f.org/posts/pictureview-simple-easy-to-use-macos-image-viewer-app/","summary":"\u003cp\u003e之前用的 Xee 看图的时候经常雪花屏，所以换了 \u003ca href=\"https://wl879.github.io/apps/picview/index.html\"\u003ePictureView\u003c/a\u003e 。\u003c/p\u003e\n\u003cp\u003e有这些特点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e启动速度很快。\u003c/li\u003e\n\u003cli\u003e界面简洁。\u003c/li\u003e\n\u003cli\u003e支持关闭图片自动退出。\u003c/li\u003e\n\u003cli\u003e提供 4 种浏览布局。\u003c/li\u003e\n\u003cli\u003e支持快捷键。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-25-11-00-10-pictureview.gif\" alt=\"2023-08-25-11-00-10-pictureview\"\u003e\u003c/p\u003e","title":"PictureView: 极简而好用的 macOS 看图 App"},{"content":"截至当前版本（0.11.1），Neovide 在 macOS 下只能从命令行启动，为方便起见，有时候我希望通过 RayCast 或者 Dashboard 启动它，或者通过右键菜单“Open with”用它直接打开选中的文件。\n方法是通过 Automator 创建一个“Application”类型的新文档，添加一个“Run AppleScript”的 Action 。然后填入下面的内容：\n最后将文档保存到 Application 目录，命名为“Neovide”。\n","permalink":"http://0x3f.org/posts/how-to-run-neovide-from-macos-desktop/","summary":"\u003cp\u003e截至当前版本（0.11.1），Neovide 在 macOS 下只能从命令行启动，为方便起见，有时候我希望通过 RayCast 或者 Dashboard 启动它，或者通过右键菜单“Open with”用它直接打开选中的文件。\u003c/p\u003e\n\u003cp\u003e方法是通过 Automator 创建一个“Application”类型的新文档，添加一个“Run AppleScript”的 Action 。然后填入下面的内容：\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/xbot/a2f1d38e8eb02665ef7cf9ba082ccd12.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003e最后将文档保存到 Application 目录，命名为“Neovide”。\u003c/p\u003e","title":"从 macOS 桌面运行 Neovide 的方法"},{"content":"之前提到想挑一个便携美观的微信读书载体，第一眼就被文石 Poke5S 的白色机身吸引了。\n试用了一段时间，总结了一些比较戳我的优点：\n便携：可能是长宽最小的 6 寸阅读器。 美观：白色，做工质感还可以。 屏幕：Carta 1100 （销售宣传诈称 Carta 1200）。 操作：日常操作、翻页速度较快。 配件：支持磁吸保护壳，自动休眠、唤醒。 还有缺点：\n屏幕：像素密度 212 PPI 。 残影：图片显示有明显残影。 背光：有明显的灯箱效果。 购买：白色版捆绑销售保护壳，价格太贵。 鉴于 212 PPI 和背光的灯箱效果降低了阅读体验，考虑到这个价格，最后还是退货了。\n","permalink":"http://0x3f.org/posts/hands-on-boox-poke5s/","summary":"\u003cp\u003e之前\u003ca href=\"/posts/hands-on-hanlinyue-read6-pro/\"\u003e提到\u003c/a\u003e想挑一个便携美观的微信读书载体，第一眼就被文石 Poke5S 的白色机身吸引了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-19-18-33-23-PXL_20230720_100716361_Original.jpeg\" alt=\"2023-08-19-18-33-23-PXL_20230720_100716361_Original\"\u003e\u003c/p\u003e\n\u003cp\u003e试用了一段时间，总结了一些比较戳我的优点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e便携：可能是长宽最小的 6 寸阅读器。\u003c/li\u003e\n\u003cli\u003e美观：白色，做工质感还可以。\u003c/li\u003e\n\u003cli\u003e屏幕：Carta 1100 （销售宣传诈称 Carta 1200）。\u003c/li\u003e\n\u003cli\u003e操作：日常操作、翻页速度较快。\u003c/li\u003e\n\u003cli\u003e配件：支持磁吸保护壳，自动休眠、唤醒。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e还有缺点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e屏幕：像素密度 212 PPI 。\u003c/li\u003e\n\u003cli\u003e残影：图片显示有明显残影。\u003c/li\u003e\n\u003cli\u003e背光：有明显的灯箱效果。\u003c/li\u003e\n\u003cli\u003e购买：白色版捆绑销售保护壳，价格太贵。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e鉴于 212 PPI 和背光的灯箱效果降低了阅读体验，考虑到这个价格，最后还是退货了。\u003c/p\u003e","title":"文石 Poke5S 的使用感受"},{"content":"更新 2023-10-02：重新发售的翰林阅 Read6 Pro 使用体验 虽然 Kindle 退出中国对我影响不大，但是近期想看的一些特定版本的书在其它地方没有找到、却在微信读书里垂手可得，所以想着挑个方便的阅读器。先是尝试了文石的 Poke5S ，各方面都挺好，就是屏幕分辨率只有 212 PPI 。然后正好看到了翰林阅 Read6 Pro 预售的消息，看配置非常符合我的想象：\n便携美观：6 英寸、白色。 显示效果好：Carta 1200、300 PPI、无盖板。 运行流畅：4G 运存、4核×1.5GHz CPU 。 微信读书友好：入口在一级菜单。 但是到手后很失望。\n最大的问题是背光效果很差，泛蓝、不均匀，看着很难受，到了完全无法接受的程度。\n另外前面板边缝很明显，让当年的 Kindle Paperwhite 都自叹不如，按压有咔哒声。第三个问题是字体墨迹不均匀，升级固件后好了点，但还是能看出来。虽然有 4G 运存，但是翻页速度的表现不好。最后就是送了一堆非常差的配件：翻页器做工很差，按键手感难以言表；支架质感极差，有股呛人的味儿；保护套没看，没有开盒的心情了，把印象分直接拉到谷底。\n没想到这都 2023 年了，挑个中意的阅读器还是那么难！\n","permalink":"http://0x3f.org/posts/hands-on-hanlinyue-read6-pro/","summary":"\u003ch6 id=\"更新\"\u003e更新\u003c/h6\u003e\n\u003cul\u003e\n\u003cli\u003e2023-10-02：\u003ca href=\"/posts/hands-on-the-new-hanlinyue-read6-pro/\"\u003e重新发售的翰林阅 Read6 Pro 使用体验\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003e虽然 Kindle 退出中国对我影响不大，但是近期想看的一些特定版本的书在其它地方没有找到、却在微信读书里垂手可得，所以想着挑个方便的阅读器。先是尝试了文石的 Poke5S ，各方面都挺好，就是屏幕分辨率只有 212 PPI 。然后正好看到了翰林阅 Read6 Pro 预售的消息，看配置非常符合我的想象：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e便携美观：6 英寸、白色。\u003c/li\u003e\n\u003cli\u003e显示效果好：Carta 1200、300 PPI、无盖板。\u003c/li\u003e\n\u003cli\u003e运行流畅：4G 运存、4核×1.5GHz CPU 。\u003c/li\u003e\n\u003cli\u003e微信读书友好：入口在一级菜单。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e但是到手后很失望。\u003c/p\u003e\n\u003cp\u003e最大的问题是背光效果很差，泛蓝、不均匀，看着很难受，到了完全无法接受的程度。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-12-15-33-06-PXL_20230726_093004018.jpg\" alt=\"2023-08-12-15-33-06-PXL_20230726_093004018\"\u003e\u003c/p\u003e\n\u003cp\u003e另外前面板边缝很明显，让当年的 Kindle Paperwhite 都自叹不如，按压有咔哒声。第三个问题是字体墨迹不均匀，升级固件后好了点，但还是能看出来。虽然有 4G 运存，但是翻页速度的表现不好。最后就是送了一堆非常差的配件：翻页器做工很差，按键手感难以言表；支架质感极差，有股呛人的味儿；保护套没看，没有开盒的心情了，把印象分直接拉到谷底。\u003c/p\u003e\n\u003cp\u003e没想到这都 2023 年了，挑个中意的阅读器还是那么难！\u003c/p\u003e","title":"翰林阅 Read6 Pro 的使用感受"},{"content":"\n用迁移助理迁移数据到一台新的 Mac ，点对点传输提示要几个小时。改用 SuperDuper! 复制到固态移动硬盘，再用迁移助理迁移，几分钟就好了。\n趁着今年 SSD 降价攒了个移动硬盘，把机械的卖了，省了太多时间了。\n","permalink":"http://0x3f.org/posts/speed-up-mac-migration-with-superduper-and-migration-assistant/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-05-22-44-49-IMG_0191.jpeg\" alt=\"2023-08-05-22-44-49-IMG_0191\"\u003e\u003c/p\u003e\n\u003cp\u003e用迁移助理迁移数据到一台新的 Mac ，点对点传输提示要几个小时。改用 SuperDuper! 复制到固态移动硬盘，再用迁移助理迁移，几分钟就好了。\u003c/p\u003e\n\u003cp\u003e趁着今年 SSD 降价攒了个移动硬盘，把机械的卖了，省了太多时间了。\u003c/p\u003e","title":"用 SuperDuper! 配合迁移助理加速 Mac 的迁移"},{"content":"我对 MPM-13 的感受比较复杂。\n一方面，人形和隐藏形态俱佳，材质和做工在近年官方出品的东西里面也属上乘，变形过程虽然复杂，但是依然有官方玩具常有的逻辑在里面，不像很多第三方的设计为变形而变形。但是同时，面对这较大的体型和复杂的变形步骤，我要做足心理建设才能鼓足勇气变它一次。这不符合我对一款好的变形金刚的判断标准。\n在我看来，变形金刚最大的价值在于变形过程是不是好玩。所谓好玩，就是流畅有逻辑，既不简陋又没有不必要的复杂，像很多第三方为了追求两种形态的极致还原而把变形过程设计得极其复杂就属于舍本逐末了。昨天收拾箱子的时候看到 IDW 的宇宙飞碟、滑翔机等几个指挥官级的老玩具，拿起来随手一变，很有乐趣。回头想想，变形金刚最吸引我们的地方不就在于玩的过程么。讲人形，不如高达，讲隐藏形态，不如各种模型，变形金刚不是什么高大上的东西，相反，就是个闲来无事时拿来享受个人时光和回忆的玩具。\n一款玩具不应该让人有心理负担，所以 MPM-13 是个适合站柜的镇宅神物，但不是个可以随手变个来回享受简单乐趣的好玩具。\n再来聊聊它的本体。\n自从 MP 系列涨价、质量下降以及 3.0 接连翻车之后，最近几年我就没再买过这个系列的东西。这次 MPM-13 实在是挑不出什么大毛病，价格也合适，算是回坑了。\n八角尖尖，不成想盒封最完美的一次来自拼多多。\n隐藏形态是 MH-53 重型运输直升机，解决了 SS-08 底盘暴露的问题，360 度无死角，即便在 MP 线里也是无出其右。就是缺个支架，飞机没有支架就没有灵魂。\n人形，迄今最还原的眩晕。电影线最失败的地方在于反派的造型和人设塑造得太差劲，眩晕在霸天虎里算是相对较好的，人设没那么不堪，反派形态的猥琐特征被大量的板件遮盖，反而显得很有机械感。\n","permalink":"http://0x3f.org/posts/hands-on-transformer-mpm-13-blackout/","summary":"\u003cp\u003e我对 MPM-13 的感受比较复杂。\u003c/p\u003e\n\u003cp\u003e一方面，人形和隐藏形态俱佳，材质和做工在近年官方出品的东西里面也属上乘，变形过程虽然复杂，但是依然有官方玩具常有的逻辑在里面，不像很多第三方的设计为变形而变形。但是同时，面对这较大的体型和复杂的变形步骤，我要做足心理建设才能鼓足勇气变它一次。这不符合我对一款好的变形金刚的判断标准。\u003c/p\u003e\n\u003cp\u003e在我看来，变形金刚最大的价值在于变形过程是不是好玩。所谓好玩，就是流畅有逻辑，既不简陋又没有不必要的复杂，像很多第三方为了追求两种形态的极致还原而把变形过程设计得极其复杂就属于舍本逐末了。昨天收拾箱子的时候看到 IDW 的宇宙飞碟、滑翔机等几个指挥官级的老玩具，拿起来随手一变，很有乐趣。回头想想，变形金刚最吸引我们的地方不就在于玩的过程么。讲人形，不如高达，讲隐藏形态，不如各种模型，变形金刚不是什么高大上的东西，相反，就是个闲来无事时拿来享受个人时光和回忆的玩具。\u003c/p\u003e\n\u003cp\u003e一款玩具不应该让人有心理负担，所以 MPM-13 是个适合站柜的镇宅神物，但不是个可以随手变个来回享受简单乐趣的好玩具。\u003c/p\u003e\n\u003cp\u003e再来聊聊它的本体。\u003c/p\u003e\n\u003cp\u003e自从 MP 系列涨价、质量下降以及 3.0 接连翻车之后，最近几年我就没再买过这个系列的东西。这次 MPM-13 实在是挑不出什么大毛病，价格也合适，算是回坑了。\u003c/p\u003e\n\u003cp\u003e八角尖尖，不成想盒封最完美的一次来自拼多多。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-01-07-23-08-32-IMG_9707.jpeg\" alt=\"八角尖尖，不成想盒封最完美的一次来自拼多多\"\u003e\u003c/p\u003e\n\u003cp\u003e隐藏形态是 MH-53 重型运输直升机，解决了 SS-08 底盘暴露的问题，360 度无死角，即便在 MP 线里也是无出其右。就是缺个支架，飞机没有支架就没有灵魂。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-01-07-23-08-36-IMG_9708.jpeg\" alt=\"隐藏形态，MH-53 重型运输直升机\"\u003e\u003c/p\u003e\n\u003cp\u003e人形，迄今最还原的眩晕。电影线最失败的地方在于反派的造型和人设塑造得太差劲，眩晕在霸天虎里算是相对较好的，人设没那么不堪，反派形态的猥琐特征被大量的板件遮盖，反而显得很有机械感。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-01-07-23-08-40-IMG_9709.jpeg\" alt=\"人形，迄今最还原的眩晕\"\u003e\u003c/p\u003e","title":"变形金刚 MPM-13 眩晕玩评"},{"content":"前段时间大概是因为防疫政策的关系，有几个书名在网上很常见，《叫魂》是其中的一个。\n书的主要内容是乾隆年间起自民间、漫延数省的一阵对妖术索魂的社会性恐慌，并最终被灌水诗人、盖章爱好者乾隆大帝解读为针对满清统治的政治阴谋，继而调动全国官僚系统追索因刑讯逼供而幻想出来的幕后谋主的事件。围绕叫魂事件对其产生的社会背景、皇帝的心理和官僚阶层的应对之策等方面做了一些讨论。\n翻译札记里有段话说得很好：\n君主是如何实现其对官僚的控制的呢？孔飞力通过对叫魂妖术危机的进一步讨论，提出了“政治罪”这样一个概念。他强调了政治罪为帝国政治的运作提供了燃料。按照他的定义，政治罪指的是威胁帝国安全的各种形式的谋反，它们是超出常规的非常事件，无法由官僚制度的行政常规来处理。这种非常的形势给了君主极大的自由来动员、驱策和整肃他的官僚，并强化他对官僚机器的控制（因为在常规情况下，一切行政事务都可以、而且应该照章办事，专制君主也不得不遵守由这些行政则例所定下的游戏规则，这种常规的管理给君主的活动留下的空间有限） 。在叫魂危机中，乾隆皇帝正是利用了妖术恐惧这样的非常事件，迫使整个官僚机器把清剿当做压倒一切的政治，并以清剿的表现来赏罚官僚，从而强化他对官僚的控制的。\n太祖的大字报和世宗的轮子大抵如此，但如果非要影射当下以寄托对时情的不满，似乎又有点玩弄阴谋论的肤浅的小聪明了。\n","permalink":"http://0x3f.org/posts/a-short-review-of-soulstealers/","summary":"\u003cp\u003e前段时间大概是因为防疫政策的关系，有几个书名在网上很常见，《叫魂》是其中的一个。\u003c/p\u003e\n\u003cp\u003e书的主要内容是乾隆年间起自民间、漫延数省的一阵对妖术索魂的社会性恐慌，并最终被灌水诗人、盖章爱好者乾隆大帝解读为针对满清统治的政治阴谋，继而调动全国官僚系统追索因刑讯逼供而幻想出来的幕后谋主的事件。围绕叫魂事件对其产生的社会背景、皇帝的心理和官僚阶层的应对之策等方面做了一些讨论。\u003c/p\u003e\n\u003cp\u003e翻译札记里有段话说得很好：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e君主是如何实现其对官僚的控制的呢？孔飞力通过对叫魂妖术危机的进一步讨论，提出了“政治罪”这样一个概念。他强调了政治罪为帝国政治的运作提供了燃料。按照他的定义，政治罪指的是威胁帝国安全的各种形式的谋反，它们是超出常规的非常事件，无法由官僚制度的行政常规来处理。这种非常的形势给了君主极大的自由来动员、驱策和整肃他的官僚，并强化他对官僚机器的控制（因为在常规情况下，一切行政事务都可以、而且应该照章办事，专制君主也不得不遵守由这些行政则例所定下的游戏规则，这种常规的管理给君主的活动留下的空间有限） 。在叫魂危机中，乾隆皇帝正是利用了妖术恐惧这样的非常事件，迫使整个官僚机器把清剿当做压倒一切的政治，并以清剿的表现来赏罚官僚，从而强化他对官僚的控制的。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e太祖的大字报和世宗的轮子大抵如此，但如果非要影射当下以寄托对时情的不满，似乎又有点玩弄阴谋论的肤浅的小聪明了。\u003c/p\u003e","title":"读《叫魂》小记"},{"content":"OmniFocus 是个非常强大的待办列表 App ，最大的特点之一是支持开发插件。如果你跟我一样有各种稀奇古怪的需求且其它待办 App 不能满足时，可以试试它，尽管很贵，但是很值。\ngenerate-work-journal 是一个生成工作日志的工具，可以根据当天完成的、满足特定条件的任务一键生成日报，以节省时间。\n包含以下特性：\n只对特定目录下的日志有效。 支持大型任务（包含多项任务的 project ）和单项任务。 多种输出格式： 纯文本 Markdown 无序列表 Markdown 有序列表 自动追加任务状态描述： 进行中 已完成 自定义 通过标签过滤不需要的记录。 今天 generate-work-journal 发布了 4.0 版本，加入了自动判断状态为“进行中”的任务的功能。对于设置为周期重复的任务，如果还存在待执行状态的记录，那么当天已完成的记录将被认为是“进行中”。可以在设置选项中指定该状态的文字描述，和“已完成”状态一样，如果文字描述为空，最终生成的日志内容将不包含状态的描述。\n","permalink":"http://0x3f.org/posts/omnifocus-plugin-generate-work-journal-v2.0-release-notes/","summary":"\u003cp\u003eOmniFocus 是个非常强大的待办列表 App ，最大的特点之一是支持开发插件。如果你跟我一样有各种稀奇古怪的需求且其它待办 App 不能满足时，可以试试它，尽管很贵，但是很值。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/omnifocus-plugin-generate-work-journal\"\u003egenerate-work-journal\u003c/a\u003e 是一个生成工作日志的工具，可以根据当天完成的、满足特定条件的任务一键生成日报，以节省时间。\u003c/p\u003e\n\u003cp\u003e包含以下特性：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e只对特定目录下的日志有效。\u003c/li\u003e\n\u003cli\u003e支持大型任务（包含多项任务的 project ）和单项任务。\u003c/li\u003e\n\u003cli\u003e多种输出格式：\n\u003cul\u003e\n\u003cli\u003e纯文本\u003c/li\u003e\n\u003cli\u003eMarkdown 无序列表\u003c/li\u003e\n\u003cli\u003eMarkdown 有序列表\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e自动追加任务状态描述：\n\u003cul\u003e\n\u003cli\u003e进行中\u003c/li\u003e\n\u003cli\u003e已完成\u003c/li\u003e\n\u003cli\u003e自定义\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e通过标签过滤不需要的记录。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e今天 generate-work-journal 发布了 4.0 版本，加入了自动判断状态为“进行中”的任务的功能。对于设置为周期重复的任务，如果还存在待执行状态的记录，那么当天已完成的记录将被认为是“进行中”。可以在设置选项中指定该状态的文字描述，和“已完成”状态一样，如果文字描述为空，最终生成的日志内容将不包含状态的描述。\u003c/p\u003e","title":"OmniFocus 插件 generate-work-journal v4.0 小记"},{"content":"OmniFocus 是个非常强大的待办列表 App ，最大的特点之一是支持开发插件。如果你跟我一样有各种稀奇古怪的需求且其它待办 App 不能满足时，可以试试它，尽管很贵，但是很值。\nchecklist 是一个把 OmniFocus 变成检查清单 App 的插件，源自我周期性重复检查一些事项的需求，例如：收拾行李、储备物资和审查代码。\n之前用过一款专门的手机 App ，对于检查清单这个领域来说，确实做得已经很极致了，但是最大的问题是没有电脑端，对于像代码审查这种需要更多、更复杂的编辑操作的清单来说，在手机上操作真是太麻烦了。还有一点就是手机毕竟还不是一个常规意义上的“正经”工具，工作时间捧着手机显得很奇怪。\nchecklist 就是这种背景下的产物。它的基本逻辑是：用 OmniFocus 的 project 当清单模板，一个 project 对应一个模板。模板集中存在专门的 folder 下。在需要检查清单的 project 下点击插件按钮选择清单模板，将在该 project 下创建和模板中相同的任务列表。\n以下录屏直观地展示了插件的用法：\n凭借 OmniFocus 原本就很强大的任务列表功能， checklist 近乎完美地实现了我对一个检查清单 App 的需求。不光我的手机上又少了一个 App ，而且考虑到那个 App 高达一百多的售价，说支持多端的 checklist 价值 200￥ 似乎也不过分。\n","permalink":"http://0x3f.org/posts/omnifocus-plugin-checklist-v2.0-release-notes/","summary":"\u003cp\u003eOmniFocus 是个非常强大的待办列表 App ，最大的特点之一是支持开发插件。如果你跟我一样有各种稀奇古怪的需求且其它待办 App 不能满足时，可以试试它，尽管很贵，但是很值。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/omnifocus-plugin-checklist\"\u003echecklist\u003c/a\u003e 是一个把 OmniFocus 变成检查清单 App 的插件，源自我周期性重复检查一些事项的需求，例如：收拾行李、储备物资和审查代码。\u003c/p\u003e\n\u003cp\u003e之前用过一款专门的手机 App ，对于检查清单这个领域来说，确实做得已经很极致了，但是最大的问题是没有电脑端，对于像代码审查这种需要更多、更复杂的编辑操作的清单来说，在手机上操作真是太麻烦了。还有一点就是手机毕竟还不是一个常规意义上的“正经”工具，工作时间捧着手机显得很奇怪。\u003c/p\u003e\n\u003cp\u003echecklist 就是这种背景下的产物。它的基本逻辑是：用 OmniFocus 的 project 当清单模板，一个 project 对应一个模板。模板集中存在专门的 folder 下。在需要检查清单的 project 下点击插件按钮选择清单模板，将在该 project 下创建和模板中相同的任务列表。\u003c/p\u003e\n\u003cp\u003e以下录屏直观地展示了插件的用法：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2022-12-11-18-57-32-omnifocus-plugin-checklist-v2-demo.gif\" alt=\"2022-12-11-18-57-32-omnifocus-plugin-checklist-v2-demo\"\u003e\u003c/p\u003e\n\u003cp\u003e凭借 OmniFocus 原本就很强大的任务列表功能， checklist 近乎完美地实现了我对一个检查清单 App 的需求。不光我的手机上又少了一个 App ，而且考虑到那个 App 高达一百多的售价，说支持多端的 checklist 价值 200￥ 似乎也不过分。\u003c/p\u003e","title":"OmniFocus 插件 checklist v2.0 小记"},{"content":"OmniFocus 是个非常强大的待办列表 App ，最大的特点之一是支持开发插件。如果你跟我一样有各种稀奇古怪的需求且其它待办 App 不能满足时，可以试试它，尽管很贵，但是很值。\nreschedule-objects 是一个给选中的任务或项目快速排期的插件，源自我特定的时间做特定的事的需求。\n今天 reschedule-objects 发布了 3.0 版本，主要包括三部分的变化。\n首先是重构。随着我写的插件数的增加，有些代码可以复用，有些 Omni Automation API 比较烦琐，所以有了封装一个工具类的想法，正好 Omni 应用也支持这样，所以封装了 libdev 开发库。另外，之前很多地方写得很差劲，这次也一并优化了一下。\n其次是用多选组件模拟单选操作，实现了用户体验的提升。Omni Automation API 对于单选操作只提供了下拉列表这一个组件，对于高频操作会显得很低效，这段时间用下来觉得很难受。文档说表单的验证方法可以增减表单里的字段，利用这一点曲线解决了这个问题，用多选组件实现了 radio group 。缺点是切换选项时表单可能产生抖动。\n第三个变化是加入了清除排期的功能。目前还需要通过同一个入口触发，最多需要三次点击。还有优化空间，考虑未来重构成多 Action 的插件，可以通过单独的按钮触发，最少只要一次点击就可以了。\n","permalink":"http://0x3f.org/posts/omnifocus-plugin-reschedule-objects-v3.0-release-notes/","summary":"\u003cp\u003eOmniFocus 是个非常强大的待办列表 App ，最大的特点之一是支持开发插件。如果你跟我一样有各种稀奇古怪的需求且其它待办 App 不能满足时，可以试试它，尽管很贵，但是很值。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/omnifocus-plugin-reschedule-objects\"\u003ereschedule-objects\u003c/a\u003e 是一个给选中的任务或项目快速排期的插件，源自我特定的时间做特定的事的需求。\u003c/p\u003e\n\u003cp\u003e今天 reschedule-objects 发布了 3.0 版本，主要包括三部分的变化。\u003c/p\u003e\n\u003cp\u003e首先是重构。随着我写的插件数的增加，有些代码可以复用，有些 Omni Automation API 比较烦琐，所以有了封装一个工具类的想法，正好 Omni 应用也支持这样，所以封装了 \u003ca href=\"https://github.com/xbot/omnifocus-plugin-libdev\"\u003elibdev\u003c/a\u003e 开发库。另外，之前很多地方写得很差劲，这次也一并优化了一下。\u003c/p\u003e\n\u003cp\u003e其次是用多选组件模拟单选操作，实现了用户体验的提升。Omni Automation API 对于单选操作只提供了下拉列表这一个组件，对于高频操作会显得很低效，这段时间用下来觉得很难受。文档说表单的验证方法可以增减表单里的字段，利用这一点曲线解决了这个问题，用多选组件实现了 radio group 。缺点是切换选项时表单可能产生抖动。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2022-12-11-16-57-10-omnifocus-plugin-checklist-v3-01.gif\" alt=\"2022-12-11-16-57-10-omnifocus-plugin-checklist-v3-01\"\u003e\u003c/p\u003e\n\u003cp\u003e第三个变化是加入了清除排期的功能。目前还需要通过同一个入口触发，最多需要三次点击。还有优化空间，考虑未来重构成多 Action 的插件，可以通过单独的按钮触发，最少只要一次点击就可以了。\u003c/p\u003e","title":"OmniFocus 插件 reschedule-objects v3.0 小记"},{"content":"保存 tweet 到 OnniFocus 并提取内嵌链接的快捷指令，绕过了iOS 16 快捷指令“Make rich text from HTML”丢失编码信息导致乱码的 bug 。\nhttps://www.icloud.com/shortcuts/fc68643daa044b44959f16b0a94ec598\n","permalink":"http://0x3f.org/posts/a-shortcuts-that-saves-tweets-to-omnifocus/","summary":"\u003cp\u003e保存 tweet 到 OnniFocus 并提取内嵌链接的快捷指令，绕过了iOS 16 快捷指令“Make rich text from HTML”丢失编码信息导致乱码的 bug 。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.icloud.com/shortcuts/fc68643daa044b44959f16b0a94ec598\"\u003ehttps://www.icloud.com/shortcuts/fc68643daa044b44959f16b0a94ec598\u003c/a\u003e\u003c/p\u003e","title":"保存 tweet 到 OmniFocus 的快捷指令"},{"content":"我用 Hugo + GitHub Pages 写博客，之前一直通过命令新建文章，然后在编辑器里一项一项修改 Front Matters ，最后再通过命令提交上去。有一天突然觉得这样太麻烦了，应该可以用图形界面简化一下。\nTypora 收费之后，Obsidian 可能是最好的免费 Markdown 编辑器了。这里用到三个插件：QuickAdd 、 Templater 和 Obsidian Git 。\n在 Hugo 目录下创建两个子目录 templates 和 scripts ，设置 Templater 的选项 Template folder location 为 templates 。\n然后在 templates 目录下创建模板 New Post.md：\n1 2 3 4 5 6 7 8 9 --- title: \u0026#34;{{VALUE:articleTitle}}\u0026#34; slug: \u0026#34;{{VALUE:articleSlug}}\u0026#34; date: {{VALUE:articleTimestamp}} categories: [\u0026#34;{{VALUE:articleCategory}}\u0026#34;] tags: toc: false draft: true --- 在 scripts 下创建脚本 create_new_post.js：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 module.exports = async (params) =\u0026gt; { QuickAdd = params; const title = await QuickAdd.quickAddApi.inputPrompt(\u0026#34;Blog - Title\u0026#34;); var slug = await QuickAdd.quickAddApi.inputPrompt(\u0026#34;Blog - Slug\u0026#34;); const category = await QuickAdd.quickAddApi.checkboxPrompt([\u0026#34;计算机\u0026#34;, \u0026#34;青梅煮酒\u0026#34;, \u0026#34;行见\u0026#34;], [\u0026#34;计算机\u0026#34;]); if (typeof slug === \u0026#39;undefined\u0026#39;) { slug = title; } QuickAdd.variables[\u0026#34;articleTitle\u0026#34;] = title; QuickAdd.variables[\u0026#34;articleSlug\u0026#34;] = slug; QuickAdd.variables[\u0026#34;articleFilename\u0026#34;] = slug.toLowerCase().replace(/[^A-Za-z0-9\\s]/g, \u0026#39;\u0026#39;).replace(/\\s+/g, \u0026#39;-\u0026#39;); QuickAdd.variables[\u0026#34;articleCategory\u0026#34;] = category; QuickAdd.variables[\u0026#34;articleTimestamp\u0026#34;] = QuickAdd.quickAddApi.date.now(\u0026#39;YYYY-MM-DDTHH:mm:ssZ\u0026#39;); console.log(QuickAdd.variables); }; 然后在 QuickAdd 里创建一个新的 Macro ，先添加脚本 create_new_post （位置 1），再创建一个 Template Choice （位置 2）：\n然后配置这个 Template Choice ：\n接着创建一个类型为 Macro 的 Choice ：\n最后配置 Obsidian Git ：\nCommit message on manual backup/commit 填 Content updates. 选中 List filenames affected by commit in the commit body 这样就可以通过以下步骤创建和发布新文章了：\n执行 QuickAdd: Run QuickAdd 命令。 选择 Create New Post 。 填写文章标题等各项内容。 写完后执行 Obsidian Git: Commit all changes 。 执行 Obsidian Git: Push 。 ","permalink":"http://0x3f.org/posts/how-to-write-blog-with-obsidian/","summary":"\u003cp\u003e我用 Hugo + GitHub Pages 写博客，之前一直通过命令新建文章，然后在编辑器里一项一项修改 Front Matters ，最后再通过命令提交上去。有一天突然觉得这样太麻烦了，应该可以用图形界面简化一下。\u003c/p\u003e\n\u003cp\u003eTypora 收费之后，Obsidian 可能是最好的免费 Markdown 编辑器了。这里用到三个插件：QuickAdd 、 Templater 和 Obsidian Git 。\u003c/p\u003e\n\u003cp\u003e在 Hugo 目录下创建两个子目录 \u003ccode\u003etemplates\u003c/code\u003e 和 \u003ccode\u003escripts\u003c/code\u003e ，设置 Templater 的选项 \u003ccode\u003eTemplate folder location\u003c/code\u003e 为 \u003ccode\u003etemplates\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e然后在 \u003ccode\u003etemplates\u003c/code\u003e 目录下创建模板 \u003ccode\u003eNew Post.md\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e9\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-markdown\" data-lang=\"markdown\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etitle: \u0026#34;{{VALUE:articleTitle}}\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eslug: \u0026#34;{{VALUE:articleSlug}}\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edate: {{VALUE:articleTimestamp}}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecategories: [\u0026#34;{{VALUE:articleCategory}}\u0026#34;]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etags:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etoc: false\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edraft: true\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e在 \u003ccode\u003escripts\u003c/code\u003e 下创建脚本 \u003ccode\u003ecreate_new_post.js\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etitle\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equickAddApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einputPrompt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Blog - Title\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eslug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equickAddApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einputPrompt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Blog - Slug\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecategory\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equickAddApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echeckboxPrompt\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;计算机\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;青梅煮酒\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;行见\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;计算机\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003eslug\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;undefined\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eslug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;articleTitle\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;articleSlug\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eslug\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;articleFilename\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eslug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/[^A-Za-z0-9\\s]/g\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\\s+/g\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;articleCategory\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecategory\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;articleTimestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equickAddApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;YYYY-MM-DDTHH:mm:ssZ\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eQuickAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后在 QuickAdd 里创建一个新的 Macro ，先添加脚本 \u003ccode\u003ecreate_new_post\u003c/code\u003e （位置 1），再创建一个 Template Choice （位置 2）：\u003c/p\u003e","title":"用 Obsidian 写博客的方法"},{"content":"写了个自动设置节假日和工作日闹钟的快捷指令，数据源用的是苹果官方的“中国大陆节假日”日历。\nhttps://www.icloud.com/shortcuts/97960ed8326e43d387b0d7bb459667dd\n需要先订阅上述日历，订阅方法见这个快捷指令里的说明。\n最后把它配置到自动化（比如助眠开始时执行）里就可以了。\n","permalink":"http://0x3f.org/posts/yet-another-shortcuts-that-sets-alarms-for-chinese-holidays-and-workdays-automatically/","summary":"\u003cp\u003e写了个自动设置节假日和工作日闹钟的快捷指令，数据源用的是苹果官方的“中国大陆节假日”日历。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.icloud.com/shortcuts/97960ed8326e43d387b0d7bb459667dd\"\u003ehttps://www.icloud.com/shortcuts/97960ed8326e43d387b0d7bb459667dd\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e需要先订阅上述日历，订阅方法见这个快捷指令里的说明。\u003c/p\u003e\n\u003cp\u003e最后把它配置到自动化（比如助眠开始时执行）里就可以了。\u003c/p\u003e","title":"自动设置节假日和工作日闹钟的快捷指令"},{"content":"我用 Hammerspoon 收集网页到 OmniFocus ，它的 SendToOmniFocus 对 Chrome 家族的浏览器有原生的支持，但并不适用于 Arc 浏览器。\n看 SendToOmniFocus 的源码是用 Apple Script 获取 Chrome 家族浏览器中网页的信息的，但最初我没有解决怎样用同样的办法拿到 Arc 浏览器网页信息的问题。所以采取通过剪贴板中转的方式实现。\n首先配置 Surfingkeys 实现把网页信息组装成特定格式复制到剪贴板：\n1 2 3 4 5 6 7 8 9 10 11 mapkey(\u0026#39;yO\u0026#39;, \u0026#39;Copy OmniFocus sensible info.\u0026#39;, yankOmniFocusSensibleInfo); function yankOmniFocusSensibleInfo() { var info_arr = []; info_arr.push(\u0026#34;#omnifocus_sensible\u0026#34;); info_arr.push(document.title); info_arr.push(window.location.href); Clipboard.write(info_arr.join(\u0026#34;\\n\u0026#34;)); } 然后在 Hammerspoon 中监听剪贴板，一旦发现特定格式的文本，就调用 Apple Script 填充解析到的网页信息到 OmniFocus 的对话框：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 -- Interpolate table values into a string -- From http://lua-users.org/wiki/StringInterpolation local function interp(s, tab) return (s:gsub(\u0026#39;($%b{})\u0026#39;, function(w) return tab[w:sub(3, -2)] or w end)) end -- Read a whole file into a string local function slurp(path) local f = assert(io.open(path)) local s = f:read(\u0026#34;*a\u0026#34;) f:close() return s end local pasteboard = require(\u0026#39;hs.pasteboard\u0026#39;) local function open_omnifocus_edit_dialog(lines) local module_dir = debug.getinfo(1, \u0026#34;S\u0026#34;).source:sub(2):match(\u0026#34;(.*/)\u0026#34;) local template_file = module_dir .. \u0026#39;../templates/add_webpage_to_omnifocus.tpl\u0026#39; local text=slurp(template_file) local data = { title = lines[2], url = lines[3], } local as_script = interp(text, data) hs.osascript.applescript(as_script) end if GetOption(\u0026#39;watch_omnifocus_sensible_data\u0026#39;, \u0026#39;off\u0026#39;) == \u0026#39;on\u0026#39; then OmniFocusPasteboardWatcher = pasteboard.watcher.new(function(pasteboard_content) local lines = {} for line in string.gmatch(pasteboard_content, \u0026#34;[^\\r\\n]+\u0026#34;) do table.insert(lines, line) end if #lines == 3 and lines[1] == \u0026#39;#omnifocus_sensible\u0026#39; then open_omnifocus_edit_dialog(lines) end end) OmniFocusPasteboardWatcher:start() end 后来解决了前面提到的问题，可以直接获取网页信息的 Apple Script 如下：\n1 2 3 4 5 6 7 8 9 10 11 tell application \u0026#34;Arc\u0026#34; set tabURL to URL of active tab of window 1 set tabTitle to title of active tab of window 1 tell front document of application \u0026#34;OmniFocus\u0026#34; tell quick entry make new inbox task with properties {name:(\u0026#34;Review: \u0026#34; \u0026amp; tabTitle), note:tabURL as text} open end tell end tell display notification \u0026#34;Successfully exported tab \u0026#39;\u0026#34; \u0026amp; tabTitle \u0026amp; \u0026#34;\u0026#39; to OmniFocus\u0026#34; with title \u0026#34;Send tab to OmniFocus\u0026#34; end tell Hammerspoon 里这样配置：\n1 2 3 4 spoon.SendToOmniFocus:registerApplication(\u0026#39;Arc\u0026#39;, { as_scriptfile = os.getenv(\u0026#39;HOME\u0026#39;) .. \u0026#39;/.hammerspoon/templates/add_arc_webpage_to_omnifocus.applescript\u0026#39;, itemname = \u0026#39;tab\u0026#39; }) 以上提到的代码片断的完整版本见以下链接：\nSurfingkeys 的配置 Hammerspoon 的配置 ","permalink":"http://0x3f.org/posts/how-to-collect-webpage-from-the-arc-browser-to-omnifocus/","summary":"\u003cp\u003e我用 \u003ca href=\"https://www.hammerspoon.org/\"\u003eHammerspoon\u003c/a\u003e 收集网页到 \u003ca href=\"https://www.omnigroup.com/omnifocus/\"\u003eOmniFocus\u003c/a\u003e ，它的 \u003ca href=\"https://www.hammerspoon.org/Spoons/SendToOmniFocus.html\"\u003eSendToOmniFocus\u003c/a\u003e 对 Chrome 家族的浏览器有原生的支持，但并不适用于 \u003ca href=\"https://thebrowser.company/\"\u003eArc 浏览器\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e看 SendToOmniFocus 的源码是用 Apple Script 获取 Chrome 家族浏览器中网页的信息的，但最初我没有解决怎样用同样的办法拿到 Arc 浏览器网页信息的问题。所以采取通过剪贴板中转的方式实现。\u003c/p\u003e\n\u003cp\u003e首先配置 \u003ca href=\"https://github.com/brookhong/Surfingkeys\"\u003eSurfingkeys\u003c/a\u003e 实现把网页信息组装成特定格式复制到剪贴板：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003emapkey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;yO\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Copy OmniFocus sensible info.\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"nx\"\u003eyankOmniFocusSensibleInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eyankOmniFocusSensibleInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003einfo_arr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003einfo_arr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;#omnifocus_sensible\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003einfo_arr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003einfo_arr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehref\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eClipboard\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo_arr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后在 Hammerspoon 中监听剪贴板，一旦发现特定格式的文本，就调用 Apple Script 填充解析到的网页信息到 OmniFocus 的对话框：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-lua\" data-lang=\"lua\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- Interpolate table values into a string\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- From http://lua-users.org/wiki/StringInterpolation\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"kr\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003einterp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etab\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003egsub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;($%b{})\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etab\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"ow\"\u003eor\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e-- Read a whole file into a string\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"kr\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eslurp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eio.open\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;*a\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003epasteboard\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;hs.pasteboard\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"kr\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen_omnifocus_edit_dialog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003emodule_dir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edebug.getinfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;S\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;(.*/)\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003etemplate_file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodule_dir\u003c/span\u003e \u003cspan class=\"o\"\u003e..\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;../templates/add_webpage_to_omnifocus.tpl\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eslurp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etemplate_file\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etitle\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003eas_script\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einterp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ehs.osascript\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapplescript\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eas_script\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eGetOption\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;watch_omnifocus_sensible_data\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;off\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;on\u0026#39;\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eOmniFocusPasteboardWatcher\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epasteboard.watcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epasteboard_content\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003elines\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kr\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"kr\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003estring.gmatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epasteboard_content\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;[^\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e]+\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003etable.insert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;#omnifocus_sensible\u0026#39;\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eopen_omnifocus_edit_dialog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eOmniFocusPasteboardWatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e后来解决了前面提到的问题，可以直接获取网页信息的 Apple Script 如下：\u003c/p\u003e","title":"用 Hammerspoon 收集 Arc 浏览器网页到 OmniFocus 的方法"},{"content":"我原本用 SWAG 做 Home Lab 的反向代理，它自带很多服务的配置模板，只需要复制后改几个参数就能工作，还有通过 ACME 自动更新 SSL 证书的功能，但是从某个时间起，首次访问经由它代理的服务会报 404 或 502 的错误，刷新页面就恢复正常，然后隔段时间后又会再次发生，另外还会偶尔出现页面无法显示最新的状态的问题，尤以当服务出错时发生居多。\n最近尝试用 Caddy 代替 SWAG ，效果非常好，再也没有出现上述问题。而且 Caddy 的使用很简单，只需要在 Caddyfile 中加几行配置信息就能实现对一个服务的反向代理。当然，它也集成了自动更新 SSL 证书的功能。此外，它的镜像只有 80 多 MB ，在我测试的几个反向代理服务里是最节省空间的。\n出于安全考虑，我没有把 Home Lab 的服务暴露在公网上，所以需要通过 DNS challenge 的方式申请 SSL 证书。我的 Docker 容器部署在 Unraid 上，官方软件仓库里的 Caddy 镜像并不包含 Cloudflare 的模块，所以找了个打包了该模块的镜像，看起来更新得还很及时。\n镜像的 README 里有申请 Cloudflare API Token 的说明，部署容器前填到环境变量里即可。这里有个小坑，创建容器前需要手动创建 Caddyfile ，空文件就行，否则会报错：\nAre you trying to mount a directory onto a file\nCaddy 不如 SWAG 的地方是没有为服务提供配置模板，所以我保留了后者的配置目录，作为在前者中配置服务时的参考。以下是我的 Caddyfile 的示例，展示了怎样配置泛域名的反向代理和 SSL 证书的自动申请，以及服务的几种典型反向代理配置：\n此外也试用了 Nginx Proxy Manager ，这个名字起得一点品牌意识都没有，以前就是因为名字太烂没用它，不过用后发现也是个很好的东西，完全通过 UI 配置，上手很容易，而且配置即时生效，不像 SWAG 和 Caddy 还需要重启服务。\n","permalink":"http://0x3f.org/posts/reverse-proxying-home-lab-with-caddy/","summary":"\u003cp\u003e我原本用 \u003ca href=\"https://docs.linuxserver.io/general/swag\"\u003eSWAG\u003c/a\u003e 做 Home Lab 的反向代理，它自带很多服务的配置模板，只需要复制后改几个参数就能工作，还有通过 ACME 自动更新 SSL 证书的功能，但是从某个时间起，首次访问经由它代理的服务会报 404 或 502 的错误，刷新页面就恢复正常，然后隔段时间后又会再次发生，另外还会偶尔出现页面无法显示最新的状态的问题，尤以当服务出错时发生居多。\u003c/p\u003e\n\u003cp\u003e最近尝试用 \u003ca href=\"https://caddyserver.com/docs/\"\u003eCaddy\u003c/a\u003e 代替 SWAG ，效果非常好，再也没有出现上述问题。而且 Caddy 的使用很简单，只需要在 Caddyfile 中加几行配置信息就能实现对一个服务的反向代理。当然，它也集成了自动更新 SSL 证书的功能。此外，它的镜像只有 80 多 MB ，在我测试的几个反向代理服务里是最节省空间的。\u003c/p\u003e\n\u003cp\u003e出于安全考虑，我没有把 Home Lab 的服务暴露在公网上，所以需要通过 DNS challenge 的方式申请 SSL 证书。我的 Docker 容器部署在 Unraid 上，官方软件仓库里的 Caddy 镜像并不包含 Cloudflare 的模块，所以找了个打包了该模块的\u003ca href=\"https://github.com/SlothCroissant/caddy-cloudflaredns\"\u003e镜像\u003c/a\u003e，看起来更新得还很及时。\u003c/p\u003e\n\u003cp\u003e镜像的 README 里有申请 Cloudflare API Token 的说明，部署容器前填到环境变量里即可。这里有个小坑，创建容器前需要手动创建 Caddyfile ，空文件就行，否则会报错：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAre you trying to mount a directory onto a file\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCaddy 不如 SWAG 的地方是没有为服务提供配置模板，所以我保留了后者的配置目录，作为在前者中配置服务时的参考。以下是我的 Caddyfile 的示例，展示了怎样配置泛域名的反向代理和 SSL 证书的自动申请，以及服务的几种典型反向代理配置：\u003c/p\u003e","title":"用 Caddy 做 Home Lab 的反向代理"},{"content":"This plugin uses the power of LeaderF to perform PHP namespace related tasks.\nhttps://github.com/xbot/Leaderf-phpnamespace\nFeatures Insert use statements for FQCNs. Sort use statements alphabetically. Expand class names to FQCNs. Insert namespace for the current file. All the above features support the fuzzy searching function and all the three modes (nameonly, fullpath and regex) provided by LeaderF. Requirements LeaderF ctags is properly configured in Vim/Neovim. Install Use any of your favourite plugin manager to install it, for example:\nvim-plug 1 Plug \u0026#39;xbot/Leaderf-phpnamespace\u0026#39; Setup 1 2 3 4 5 \u0026#34; Import the current class under cursor. noremap \u0026lt;leader\u0026gt;iu :\u0026lt;C-U\u0026gt;\u0026lt;C-R\u0026gt;=printf(\u0026#34;Leaderf phpns --input %s\u0026#34;, expand(\u0026#34;\u0026lt;cword\u0026gt;\u0026#34;))\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt; \u0026#34; Expand the classname under cursor to its FQCN form. noremap \u0026lt;leader\u0026gt;ec :\u0026lt;C-U\u0026gt;\u0026lt;C-R\u0026gt;=printf(\u0026#34;Leaderf phpns --input %s --expand\u0026#34;, expand(\u0026#34;\u0026lt;cword\u0026gt;\u0026#34;))\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt; Commands Command Description LeaderfPhpns Choose an FQCN to import. PHPNamespaceInsert Insert namespace for the current file. Press F1 in the popup window to get more help.\nOptions Option Default Description g:Lf_PHPNamespaceExpandToAbsolute 1 Expand the classname under cursor to absolute FQCN. g:Lf_PHPNamespaceSortAfterImport 1 Sort the use statements block alphabetically after importing a class. ","permalink":"http://0x3f.org/posts/leaderf-phpnamespace-yet-another-php-namespace-resolver/","summary":"\u003cp\u003eThis plugin uses the power of \u003ca href=\"https://github.com/Yggdroot/LeaderF\"\u003eLeaderF\u003c/a\u003e to perform PHP namespace related tasks.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/Leaderf-phpnamespace\"\u003ehttps://github.com/xbot/Leaderf-phpnamespace\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"features\"\u003eFeatures\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eInsert \u003ccode\u003euse\u003c/code\u003e statements for FQCNs.\u003c/li\u003e\n\u003cli\u003eSort \u003ccode\u003euse\u003c/code\u003e statements alphabetically.\u003c/li\u003e\n\u003cli\u003eExpand class names to FQCNs.\u003c/li\u003e\n\u003cli\u003eInsert namespace for the current file.\u003c/li\u003e\n\u003cli\u003eAll the above features support the fuzzy searching function and all the three modes (nameonly, fullpath and regex) provided by LeaderF.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Yggdroot/LeaderF\"\u003eLeaderF\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003ectags is properly configured in Vim/Neovim.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"install\"\u003eInstall\u003c/h2\u003e\n\u003cp\u003eUse any of your favourite plugin manager to install it, for example:\u003c/p\u003e","title":"Leaderf-phpnamespace: Yet another PHP namespace resolver"},{"content":"Unraid 6.11 的 release note 没提弃用 NerdPack ，浪费了我很多时间。😞\n当前版本的 Unraid 是基于 Slackware 15.0 的，可以手动从以下站点下载软件包手动安装：\nhttps://slackware.pkgs.org/15.0/slackware-x86_64/ https://slackonly.com/pub/packages/15.0-x86_64/ 把下载的软件包放到运行中的 Unraid 的 /boot/extra 目录（不存在就手动创建）下，重启系统后自动安装或者通过 installpkg 命令手动安装。例如：\n1 installpkg vim-8.2.4256-x86_64-1.txz 更简单的方法是使用 un-get ：\n1 2 3 4 5 6 un-get search vim un-get install python3 python-pip python-setuptools un-get remove vim un-get update un-get cleanup un-get upgrade 这个命令目前不解决依赖关系，而且存在部分包无法下载或找不到的现象，还是需要手动干预。\n作者没有在项目主页写安装说明，而是写在 Reddit 帖子里了。\n2022-10-07 更新 出了个新的 NerdTools ，界面和 NerdPack 一样难用，包的数量现在还很少，但版本较新，还有一些 un-get 目前搜不到的包（比如: fzf）。可以作为补充。\n","permalink":"http://0x3f.org/posts/how-to-install-packages-after-nerdpack-is-deprecated-in-unraid-6.11/","summary":"\u003cp\u003eUnraid 6.11 的 release note 没提弃用 NerdPack ，浪费了我很多时间。😞\u003c/p\u003e\n\u003cp\u003e当前版本的 Unraid 是基于 Slackware 15.0 的，可以手动从以下站点下载软件包手动安装：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://slackware.pkgs.org/15.0/slackware-x86_64/\"\u003ehttps://slackware.pkgs.org/15.0/slackware-x86_64/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://slackonly.com/pub/packages/15.0-x86_64/\"\u003ehttps://slackonly.com/pub/packages/15.0-x86_64/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e把下载的软件包放到运行中的 Unraid 的 \u003ccode\u003e/boot/extra\u003c/code\u003e 目录（不存在就手动创建）下，重启系统后自动安装或者通过 \u003ccode\u003einstallpkg\u003c/code\u003e 命令手动安装。例如：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einstallpkg vim-8.2.4256-x86_64-1.txz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e更简单的方法是使用 \u003ca href=\"https://github.com/ich777/un-get\"\u003eun-get\u003c/a\u003e ：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eun-get search vim\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eun-get install python3 python-pip python-setuptools\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eun-get remove vim\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eun-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eun-get cleanup\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eun-get upgrade\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这个命令目前不解决依赖关系，而且存在部分包无法下载或找不到的现象，还是需要手动干预。\u003c/p\u003e\n\u003cp\u003e作者没有在项目主页写安装说明，而是写在 \u003ca href=\"https://www.reddit.com/r/unRAID/comments/wy9nft/unget_a_simple_command_line_tool_to_install/\"\u003eReddit 帖子\u003c/a\u003e里了。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"2022-10-07-更新\"\u003e2022-10-07 更新\u003c/h3\u003e\n\u003cp\u003e出了个新的 NerdTools ，界面和 NerdPack 一样难用，包的数量现在还很少，但版本较新，还有一些 un-get 目前搜不到的包（比如: fzf）。可以作为补充。\u003c/p\u003e","title":"Unraid 6.11 弃用 NerdPack 的解决办法"},{"content":"纯文本有很多好处，比如可以用 Git 管理，方便备份和追溯，方便多机同步和分享。\n之前使用 VS Code 的插件 Rest Client ，从浏览器后台复制请求数据过来就可以用，很方便。但是存在一些用起来不舒服的地方，比如：\n不方便对接口分组管理。 不方便快速查找接口。 这些在对纯文本操作效率更高的 Vim 里都可以解决，但是之前尝试过的一些 Vim 的 RESTful 客户端插件还不成熟，最近发现 rest.nvim 基本可以满足日常使用需要了。\nrest.nvim 是个 Neovim 的插件，和 Rest Client 支持的格式差异较小，迁移很方便。这样我就可以用 Vim 的折叠特性对接口分组管理，用插件 Leaderf 的模糊查找特性快速定位接口，当然，对纯文本的任何编辑和操作在 Vim 里就是浑然天成、行云流水的。\n它的大致用法如下：\n在工作目录下创建环境变量文件 .env ：\n1 2 3 4 5 6 base_url=http://myapp.dev header_accept_json=application/json, application/problem+json, text/plain, */* header_content_type_json=application/json;charset=utf-8 header_cookie_debug_session=XDEBUG_SESSION=1;app_session=1ObUjvLvEYjVhJ8tbzn5BorN7TViNtI1S625140e user_email=user@test.com user_password=password 在工作目录下创建请求文件（例如 myapp.http ）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ### Login POST {{base_url}}/v1/sessions Accept: {{header_accept_json}} Content-Type: {{header_content_type_json}} Cookie: {{header_cookie_debug_session}} {\u0026#34;email\u0026#34;: \u0026#34;{{user_email}}\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;{{user_password}}\u0026#34;} ### Get an article GET {{base_url}}/v1/articles/DiJeb7IQHo8FOFkXulieyA Accept: {{header_accept_json}} Cookie: {{header_cookie_debug_session}} ### Create an article POST {{base_url}}/v1/articles Accept: {{header_accept_json}} Cookie: {{header_cookie_debug_session}} Content-Type: {{header_content_type_json}} { \u0026#34;title\u0026#34;: \u0026#34;Hello world\u0026#34;, \u0026#34;Content\u0026#34;: \u0026#34;This is a dummy post.\u0026#34; } 然后就可以用插件提供的命令触发请求了。\n不过这个插件目前还不能保持会话，所以每次请求完登录接口都要手动把会话信息复制到环境变量中，比较麻烦。这里我用 Vim 自身的机制来解决：\n这样，每次请求完登录接口就会自动把 cookie 写入 .env 文件中了。\n2022-09-27 更新 关于会话的保持，有种更简单的实现方式。\nrest.nvim 支持在请求中使用 curl 命令的参数，所以上述请求文件可以写成如下形式：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 ### Login POST {{base_url}}/v1/sessions Accept: {{header_accept_json}} Content-Type: {{header_content_type_json}} -c cookies {\u0026#34;email\u0026#34;: \u0026#34;{{user_email}}\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;{{user_password}}\u0026#34;} ### Get an article GET {{base_url}}/v1/articles/DiJeb7IQHo8FOFkXulieyA Accept: {{header_accept_json}} -b cookies ### Create an article POST {{base_url}}/v1/articles Accept: {{header_accept_json}} Content-Type: {{header_content_type_json}} -b cookies { \u0026#34;title\u0026#34;: \u0026#34;Hello world\u0026#34;, \u0026#34;Content\u0026#34;: \u0026#34;This is a dummy post.\u0026#34; } 通过 -c 参数将响应中的 cookie 自动存储到名为 cookies 的文件中，并通过 -b 参数指定发送请求时使用该文件中的 cookie 。不过，当前版本存在一个小问题，生成的文件名前会带一个空格，不影响正常使用，但如果要加入 .gitignore 中的话需要注意这点。\n之前的实现方法对于其它鉴权方式仍有意义。\n","permalink":"http://0x3f.org/posts/send-restful-requests-with-neovim/","summary":"\u003cp\u003e纯文本有很多好处，比如可以用 Git 管理，方便备份和追溯，方便多机同步和分享。\u003c/p\u003e\n\u003cp\u003e之前使用 VS Code 的插件 Rest Client ，从浏览器后台复制请求数据过来就可以用，很方便。但是存在一些用起来不舒服的地方，比如：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e不方便对接口分组管理。\u003c/li\u003e\n\u003cli\u003e不方便快速查找接口。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这些在对纯文本操作效率更高的 Vim 里都可以解决，但是之前尝试过的一些 Vim 的 RESTful 客户端插件还不成熟，最近发现 \u003ca href=\"https://github.com/rest-nvim/rest.nvim\"\u003erest.nvim\u003c/a\u003e 基本可以满足日常使用需要了。\u003c/p\u003e\n\u003cp\u003erest.nvim 是个 Neovim 的插件，和 Rest Client 支持的格式差异较小，迁移很方便。这样我就可以用 Vim 的折叠特性对接口分组管理，用插件 Leaderf 的模糊查找特性快速定位接口，当然，对纯文本的任何编辑和操作在 Vim 里就是浑然天成、行云流水的。\u003c/p\u003e\n\u003cp\u003e它的大致用法如下：\u003c/p\u003e\n\u003cp\u003e在工作目录下创建环境变量文件 \u003ccode\u003e.env\u003c/code\u003e ：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebase_url\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ehttp://myapp.dev\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eheader_accept_json\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eapplication/json, application/problem+json, text/plain, */*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eheader_content_type_json\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eapplication/json;charset=utf-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eheader_cookie_debug_session\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eXDEBUG_SESSION=1;app_session=1ObUjvLvEYjVhJ8tbzn5BorN7TViNtI1S625140e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003euser_email\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003euser@test.com\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003euser_password\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003epassword\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e在工作目录下创建请求文件（例如 \u003ccode\u003emyapp.http\u003c/code\u003e ）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-http\" data-lang=\"http\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e### Login\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003ePOST {{base_url}}/v1/sessions\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eAccept: {{header_accept_json}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eContent-Type: {{header_content_type_json}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eCookie: {{header_cookie_debug_session}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e{\u0026#34;email\u0026#34;: \u0026#34;{{user_email}}\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;{{user_password}}\u0026#34;}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e### Get an article\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eGET {{base_url}}/v1/articles/DiJeb7IQHo8FOFkXulieyA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eAccept: {{header_accept_json}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eCookie: {{header_cookie_debug_session}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e### Create an article\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003ePOST {{base_url}}/v1/articles\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eAccept: {{header_accept_json}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eCookie: {{header_cookie_debug_session}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eContent-Type: {{header_content_type_json}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e    \u0026#34;title\u0026#34;: \u0026#34;Hello world\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e    \u0026#34;Content\u0026#34;: \u0026#34;This is a dummy post.\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后就可以用插件提供的命令触发请求了。\u003c/p\u003e","title":"用 Neovim 调试 RESTful 接口"},{"content":"我的 Vim 插件数快到 150 了，弊端也越来越明显。\n最大的问题是稳定性，经常批量更新后发现某个功能不工作了，尤其是大部分问题只有在用到的时候才发现，非常影响效率。\n我用的插件管理工具是 vim-plug ，虽然有回滚到上一次的功能，但是我手比较欠，经常频繁更新，往往发现一个问题时已经更新了几次了，所以这个功能对我来说不是很适用。\n好在它提供了做快照的命令 :PlugSnapshot ，其实就是把当前所有插件的 Git 哈希值输出到一个 Vim 脚本里，恢复快照的时候只要执行这个脚本就行了。\n为了方便使用，创建一个自定义命令：\n1 command! SnapshotPlugins PlugSnapshot ~/.vim/plugin.lock 然后把生成的 plugin.lock 文件加入 Git 仓库，必要的时候可以利用 git bisect 快速找到问题出处。\n恢复的命令如下：\n1 vim -S plugin.lock ","permalink":"http://0x3f.org/posts/create-snapshot-for-vim-plugins/","summary":"\u003cp\u003e我的 Vim 插件数快到 150 了，弊端也越来越明显。\u003c/p\u003e\n\u003cp\u003e最大的问题是稳定性，经常批量更新后发现某个功能不工作了，尤其是大部分问题只有在用到的时候才发现，非常影响效率。\u003c/p\u003e\n\u003cp\u003e我用的插件管理工具是 \u003ca href=\"https://github.com/junegunn/vim-plug\"\u003evim-plug\u003c/a\u003e ，虽然有回滚到上一次的功能，但是我手比较欠，经常频繁更新，往往发现一个问题时已经更新了几次了，所以这个功能对我来说不是很适用。\u003c/p\u003e\n\u003cp\u003e好在它提供了做快照的命令 \u003ccode\u003e:PlugSnapshot\u003c/code\u003e ，其实就是把当前所有插件的 Git 哈希值输出到一个 Vim 脚本里，恢复快照的时候只要执行这个脚本就行了。\u003c/p\u003e\n\u003cp\u003e为了方便使用，创建一个自定义命令：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eSnapshotPlugins\u003c/span\u003e \u003cspan class=\"nx\"\u003ePlugSnapshot\u003c/span\u003e \u003cspan class=\"p\"\u003e~\u003c/span\u003e\u003cspan class=\"sr\"\u003e/.vim/\u003c/span\u003e\u003cspan class=\"nx\"\u003eplugin\u003c/span\u003e.\u003cspan class=\"nx\"\u003elock\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后把生成的 \u003ccode\u003eplugin.lock\u003c/code\u003e 文件加入 Git 仓库，必要的时候可以利用 \u003ccode\u003egit bisect\u003c/code\u003e 快速找到问题出处。\u003c/p\u003e\n\u003cp\u003e恢复的命令如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evim -S plugin.lock\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"给 Vim 插件做快照"},{"content":"LeaderF-folder is a plugin for LeaderF that aims to open a subfolder quickly.\nRequirements LeaderF fd Dirbuf: Optional, can be changed to other file managers. Setup This plugin takes Dirbuf as the default solution to open the chosen subfolder. You can use the following option to customize it:\n1 let g:Lf_FolderAcceptSelectionCmd = \u0026#39;Dirbuf\u0026#39; Usage 1 :LeaderfFolder Press F1 to get more help\n","permalink":"http://0x3f.org/posts/the-leaderf-folder-plugin/","summary":"\u003cp\u003e\u003ca href=\"https://github.com/xbot/LeaderF-folder\"\u003eLeaderF-folder\u003c/a\u003e is a plugin for \u003ca href=\"https://github.com/Yggdroot/LeaderF\"\u003eLeaderF\u003c/a\u003e that aims to open a subfolder quickly.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/LeaderF-folder/main/image/screencast.gif\" alt=\"screen cast\"\u003e\u003c/p\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Yggdroot/LeaderF\"\u003eLeaderF\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/sharkdp/fd\"\u003efd\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/elihunter173/dirbuf.nvim\"\u003eDirbuf\u003c/a\u003e: Optional, can be changed to other file managers.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"setup\"\u003eSetup\u003c/h2\u003e\n\u003cp\u003eThis plugin takes \u003ca href=\"https://github.com/elihunter173/dirbuf.nvim\"\u003eDirbuf\u003c/a\u003e as the default solution to open the chosen subfolder. You can use the following option to customize it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eLf_FolderAcceptSelectionCmd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Dirbuf\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eLeaderfFolder\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ePress \u003ccode\u003eF1\u003c/code\u003e to get more help\u003c/p\u003e","title":"Leaderf-folder: Quickly open a subfolder"},{"content":"简介 Horizon 针对 Laravel 的 Redis 队列，增加了可视化、进程池等特性。\n特性 可视化仪表板 Worker 进程池的维护和调度 词汇表 master supervisor: 主进程，通过 proc_open() 启动 supervisor 子进程。 environments: 可以按 APP_ENV 针对不同环境创建多套配置。 supervisors: Horizon 自己的进程池概念，与托管后台进程的软件 Supervisor 没有关系。 workers: 队列消费者进程，每个 supervisor 中包含多个 worker。 负载均衡策略 false 一个 supervisor 下的所有 worker 全部用于按队列名称的顺序逐个队列消费任务。\nsimple 一个 supervisor 下的所有 worker 被平均分配给每个队列。\nauto 一个 supervisor 下空闲的 worker 会被优先分配给负载最高的队列。同时保证空闲队列有配置项 minProcesses 数量的 worker 待命。\n超时提醒 如果一个队列执行任务的时间超过预先配置的时间限制，horizon 将终止该任务并可以通过短信、邮件或 Slack 发送通知。\nHorizon 每分钟查询一次执行任务的时间超过配置值的队列：\n每 5 分钟发送一次通知：\n吞吐量和平均耗时统计 需要通过定时任务周期性执行 artisan horizon:snapshot 命令生成统计数据并存储到 Redis 中。\n1 $schedule-\u0026gt;command(\u0026#39;horizon:snapshot\u0026#39;)-\u0026gt;everyFiveMinutes() 按 Job 查看统计图表：\n标签 如果任务中包含了 Eloquent model, Horizon 会自动使用这个 model 的 ID 给任务打标签。也可以通过覆盖 tags() 方法自己定义：\n1 2 3 4 public function tags(): array { return [\u0026#39;tests\u0026#39;, \u0026#39;test:\u0026#39; . $this-\u0026gt;id]; } 通过标签监控和查看任务的执行情况：\n问题 Horizon 不消费队列 问题的表现 artisan horizon 启动后不消费队列 dashboard 中看不到 supervisor-1 artisan horizon:list 可以看到 supervisor-1 artisan horizon:supervisors 查不到 supervisor-1 Redis 中 Horizon 的元数据存储在两个目录中 原因 Laravel 在 .env 之外会根据 APP_ENV 加载对应环境的 dotenv 文件：\nHorizon 先启动 master 进程，之后 master 启动 supervisor 进程。\n在 master 启动时，由于 .env 文件还没有被加载，所以 APP_ENV 为空，导致 .env.local 没有被加载。由于 .env 中没有设置 APP_NAME ，所以 Horizon 在取 prefix 的时候得到了默认值 laravel 。\n在 supervisor 进程被启动时，由于 master 进程已经加载了 .env 文件，所以 .env.local 被加载。由于 .env.local 中设置了 APP_NAME ，所以 Horizon 在取 prefix 的时候得到了配置值 retail 。\n所以 master 进程的元数据被存储到 laravel_horizon 下，supervisor 进程的元数据被存储到 retail_horizon 下。\n解决 .env 中设置 APP_NAME artisan horizon --env local ","permalink":"http://0x3f.org/posts/an-introduction-of-laravel-horizon/","summary":"\u003ch2 id=\"简介\"\u003e简介\u003c/h2\u003e\n\u003cp\u003eHorizon 针对 Laravel 的 Redis 队列，增加了可视化、进程池等特性。\u003c/p\u003e\n\u003ch2 id=\"特性\"\u003e特性\u003c/h2\u003e\n\u003ch3 id=\"可视化仪表板\"\u003e可视化仪表板\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2022-08-06-20-27-48-xu94E4.jpg\" alt=\"2022-08-06-20-27-48-xu94E4\"\u003e\u003c/p\u003e\n\u003ch3 id=\"worker-进程池的维护和调度\"\u003eWorker 进程池的维护和调度\u003c/h3\u003e\n\u003ch4 id=\"词汇表\"\u003e词汇表\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003emaster supervisor: 主进程，通过 \u003ccode\u003eproc_open()\u003c/code\u003e 启动 supervisor 子进程。\u003c/li\u003e\n\u003cli\u003eenvironments: 可以按 \u003ccode\u003eAPP_ENV\u003c/code\u003e 针对不同环境创建多套配置。\u003c/li\u003e\n\u003cli\u003esupervisors: Horizon 自己的进程池概念，与托管后台进程的软件 Supervisor 没有关系。\u003c/li\u003e\n\u003cli\u003eworkers: 队列消费者进程，每个 supervisor 中包含多个 worker。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"负载均衡策略\"\u003e负载均衡策略\u003c/h4\u003e\n\u003ch5 id=\"false\"\u003efalse\u003c/h5\u003e\n\u003cp\u003e一个 supervisor 下的所有 worker 全部用于按队列名称的顺序逐个队列消费任务。\u003c/p\u003e\n\u003ch5 id=\"simple\"\u003esimple\u003c/h5\u003e\n\u003cp\u003e一个 supervisor 下的所有 worker 被平均分配给每个队列。\u003c/p\u003e\n\u003ch5 id=\"auto\"\u003eauto\u003c/h5\u003e\n\u003cp\u003e一个 supervisor 下空闲的 worker 会被优先分配给负载最高的队列。同时保证空闲队列有配置项 minProcesses 数量的 worker 待命。\u003c/p\u003e\n\u003ch3 id=\"超时提醒\"\u003e超时提醒\u003c/h3\u003e\n\u003cp\u003e如果一个队列执行任务的时间超过预先配置的时间限制，horizon 将终止该任务并可以通过短信、邮件或 Slack 发送通知。\u003c/p\u003e\n\u003cp\u003eHorizon 每分钟查询一次执行任务的时间超过配置值的队列：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2022-08-06-20-30-29-t2RJyM.jpg\" alt=\"2022-08-06-20-30-29-t2RJyM\"\u003e\u003c/p\u003e\n\u003cp\u003e每 5 分钟发送一次通知：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2022-08-06-20-31-03-USbLPG.jpg\" alt=\"2022-08-06-20-31-03-USbLPG\"\u003e\u003c/p\u003e\n\u003ch3 id=\"吞吐量和平均耗时统计\"\u003e吞吐量和平均耗时统计\u003c/h3\u003e\n\u003cp\u003e需要通过定时任务周期性执行 \u003ccode\u003eartisan horizon:snapshot\u003c/code\u003e 命令生成统计数据并存储到 Redis 中。\u003c/p\u003e","title":"Laravel Horizon 简介"},{"content":" 下载最新的 Factory Image 。\n解压两次得到 boot.img 。\n用数据线连接电脑并允许 USB 调试。\n复制 boot.img 到手机\n1 adb push boot.img /sdcard/Download/ 在手机上的 Magisk 里给 boot.img 打补丁。\n执行命令\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 把打完补丁的文件复制到电脑上 adb pull /sdcard/Download/magisk_patched-25101_MNbd5.img . # 启动到 bootloader adb reboot bootloader # 查看设备连接正常 fastboot devices # 刷 boot.img fastboot flash boot_a magisk_patched-25101_MNbd5.img fastboot flash boot_b magisk_patched-25101_MNbd5.img # 重启 fastboot reboot 参考 How to Patch Stock Boot Image via Magisk and Flash it using Fastboot Root Google Pixel 5 Android 12 using Magisk 附：更新 Pixel 5 的 Magisk 缩小状态栏的模块的步骤 直接覆盖原模块会导致功能不生效。\n移除原模块并重启。\n下载匹配系统版本的模块，复制新压缩包到手机\n1 adb push LCwaterfall.zip /sdcard/Download/ 安装模块并重启。\n","permalink":"http://0x3f.org/posts/steps-to-reflash-magisk-after-pixel-5-monthly-update/","summary":"\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e下载最新的 \u003ca href=\"https://developers.google.com/android/images#redfin\"\u003eFactory Image\u003c/a\u003e 。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e解压两次得到 boot.img 。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e用数据线连接电脑并允许 USB 调试。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e复制 boot.img 到手机\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eadb push boot.img /sdcard/Download/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在手机上的 Magisk 里给 boot.img 打补丁。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e执行命令\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 把打完补丁的文件复制到电脑上\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eadb pull /sdcard/Download/magisk_patched-25101_MNbd5.img .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 启动到 bootloader\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eadb reboot bootloader\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 查看设备连接正常\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efastboot devices\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 刷 boot.img\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efastboot flash boot_a magisk_patched-25101_MNbd5.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efastboot flash boot_b magisk_patched-25101_MNbd5.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 重启\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efastboot reboot\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"参考\"\u003e参考\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.droidwin.com/patch-stock-boot-image-flash-magisk/\"\u003eHow to Patch Stock Boot Image via Magisk and Flash it using Fastboot\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.androidinfotech.com/33493-root-google-pixel-5-redfin-android-12/\"\u003eRoot Google Pixel 5 Android 12 using Magisk\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"附更新-pixel-5-的-magisk-缩小状态栏的模块的步骤\"\u003e附：更新 Pixel 5 的 Magisk 缩小状态栏的模块的步骤\u003c/h1\u003e\n\u003cp\u003e直接覆盖原模块会导致功能不生效。\u003c/p\u003e","title":"Pixel 5 每月更新后重刷 Magisk 的步骤"},{"content":"在生成 Cobertura 格式的代码覆盖报告时程序报了如下错误：\nGenerating code coverage report in Cobertura XML format \u0026hellip; PHP Fatal error: Cannot declare class App\\FakeNamespace\\GenericProvider, because the name is already in use in /builds/fake_project/app/FakeNamespace/GenericProvider.php on line 17\n对应的代码和单元测试执行均无问题。\n经排查，直接原因是使用了 Mockery 的 Instance Mocking 1特性 mock 代码中的硬依赖关系（Hard Dependency）。\n该特性的实现利用了类的自动加载机制和依赖注入技术。对依赖关系 mock 的实例保存在 Mockery 的容器中，同时生成一个 stub 文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php namespace Mockery; class Mockery_App_FakeNamespace_GenericProvider { private Container $container; function doSomething($param) { // internal code check expectations return $this-\u0026gt;container-\u0026gt;get(\u0026#39;App\\FakeNamespace\\GenericProvider::doSomething\u0026#39;)-\u0026gt;expectations(); } } 当代码中实例化这个类的时候，Mockery 自动加载该文件，从而代替了对原类文件的加载。\n此后，如果再次 require 原类文件，就会报文章开头提到的错误。\n解决办法是重构代码，把硬依赖关系改为使用依赖注入实现。例如在 Laravel 中通过容器获取对象实例，而不是直接 new 一个类。\nhttps://docs.mockery.io/en/latest/reference/creating_test_doubles.html#overloading\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"http://0x3f.org/posts/the-solution-of-class-redeclaration-error-raised-while-generating-php-code-coverage-report/","summary":"\u003cp\u003e在生成 Cobertura 格式的代码覆盖报告时程序报了如下错误：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eGenerating code coverage report in Cobertura XML format \u0026hellip; PHP Fatal error:  Cannot declare class App\\FakeNamespace\\GenericProvider, because the name is already in use in /builds/fake_project/app/FakeNamespace/GenericProvider.php on line 17\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e对应的代码和单元测试执行均无问题。\u003c/p\u003e\n\u003cp\u003e经排查，直接原因是使用了 Mockery 的 \u003ca href=\"http://docs.mockery.io/en/latest/reference/instance_mocking.html\"\u003eInstance Mocking\u003c/a\u003e \u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e特性 mock 代码中的硬依赖关系（\u003ca href=\"https://robertbasic.com/blog/mocking-hard-dependencies-with-mockery/\"\u003eHard Dependency\u003c/a\u003e）。\u003c/p\u003e\n\u003cp\u003e该特性的实现利用了类的自动加载机制和依赖注入技术。对依赖关系 mock 的实例保存在 Mockery 的容器中，同时生成一个 stub 文件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nx\"\u003eMockery\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMockery_App_FakeNamespace_GenericProvider\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nx\"\u003eContainer\u003c/span\u003e \u003cspan class=\"nv\"\u003e$container\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003edoSomething\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$param\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// internal code check expectations\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003econtainer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;App\\FakeNamespace\\GenericProvider::doSomething\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eexpectations\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e当代码中实例化这个类的时候，Mockery 自动加载该文件，从而代替了对原类文件的加载。\u003c/p\u003e","title":"解决 PHPUnit 生成代码覆盖报告时抛出重复定义类的错误的办法"},{"content":"在 ClashX 中使用机场的订阅链接时，如果需要添加自定义的规则，且在定时更新订阅的链接时不会被覆盖，解决的方法是创建一个新的配置文件，使用 Clash 的 proxy-providers 和 rule-providers 分别引用订阅的链接和开源的规则集：\n然后就可以在 rules 区块里添加自定义规则了。\n","permalink":"http://0x3f.org/posts/customize-rules-for-clashx-while-using-a-subscribed-link/","summary":"\u003cp\u003e在 ClashX 中使用机场的订阅链接时，如果需要添加自定义的规则，且在定时更新订阅的链接时不会被覆盖，解决的方法是创建一个新的配置文件，使用 Clash 的 \u003ca href=\"https://github.com/Dreamacro/clash/wiki/configuration#proxy-providers\"\u003eproxy-providers\u003c/a\u003e 和 \u003ca href=\"https://github.com/Dreamacro/clash/wiki/premium-core-features#rule-providers\"\u003erule-providers\u003c/a\u003e 分别引用订阅的链接和开源的规则集：\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/xbot/26f540ae8fad51cf27152f2385caccee.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003e然后就可以在 \u003ccode\u003erules\u003c/code\u003e 区块里添加自定义规则了。\u003c/p\u003e","title":"ClashX 在使用订阅链接的同时添加自定义规则的方法"},{"content":"我的开发环境部署在 Linux VM 里，普通的远程复制用 vim-oscyank 插件是可以实现的。但是当我想用 fugitive 的 :GBrowse 命令打开 Gitlab 链接的时候遇到了困难，甚至我想退而求其次、通过 :GBrowse! 复制链接都不可得，因为 fugitive 的代码里通过 has('clipboard') 判断 Vim 是否可以使用系统剪贴板，且我的 Linux VM 不满足该特性的条件（见 :help clipboard）。所以用 lemonade 解决这个问题。\n实现方式 lemonade 虽然支持客户端和服务端直接通信，但是并不提供安全保障，所以我采取 SSH 端口远程转发的方式并用 autossh 保持连接。\n首先分别在服务端（MacOS）和客户端（Linux VM）创建 lemonade 的配置文件（~/.config/lemonade.toml）：\n服务端：\n1 2 3 port = 2489 allow = \u0026#39;127.0.0.1\u0026#39; line-ending = \u0026#39;lf\u0026#39; 客户端：\n1 2 3 4 5 port = 2489 host = \u0026#39;localhost\u0026#39; trans-loopback = true trans-localfile = true line-ending = \u0026#39;lf\u0026#39; 然后创建 MacOS 的服务配置文件：\n~/Library/LaunchAgents/org.0x3f.lemonade.plist\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE plist PUBLIC \u0026#34;-//Apple//DTD PLIST 1.0//EN\u0026#34; \u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;\u0026gt; \u0026lt;plist version=\u0026#34;1.0\u0026#34;\u0026gt; \u0026lt;dict\u0026gt; \u0026lt;key\u0026gt;KeepAlive\u0026lt;/key\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;Label\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;org.0x3f.lemonade\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;ProgramArguments\u0026lt;/key\u0026gt; \u0026lt;array\u0026gt; \u0026lt;string\u0026gt;/Users/donie/.go/bin/lemonade\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;server\u0026lt;/string\u0026gt; \u0026lt;/array\u0026gt; \u0026lt;key\u0026gt;RunAtLoad\u0026lt;/key\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;StandardErrorPath\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/opt/homebrew/var/log/lemonade-error.log\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;StandardOutPath\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/opt/homebrew/var/log/lemonade-output.log\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;WorkingDirectory\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/Users/donie\u0026lt;/string\u0026gt; \u0026lt;/dict\u0026gt; \u0026lt;/plist\u0026gt; ~/Library/LaunchAgents/org.0x3f.autossh.plist\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE plist PUBLIC \u0026#34;-//Apple//DTD PLIST 1.0//EN\u0026#34; \u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;\u0026gt; \u0026lt;plist version=\u0026#34;1.0\u0026#34;\u0026gt; \u0026lt;dict\u0026gt; \u0026lt;key\u0026gt;KeepAlive\u0026lt;/key\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;Label\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;org.0x3f.autossh\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;ProgramArguments\u0026lt;/key\u0026gt; \u0026lt;array\u0026gt; \u0026lt;string\u0026gt;/opt/homebrew/bin/autossh\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;-f\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;-N\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;-M\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;4444\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;-R\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;2489:127.0.0.1:2489\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;arch\u0026lt;/string\u0026gt; \u0026lt;/array\u0026gt; \u0026lt;key\u0026gt;RunAtLoad\u0026lt;/key\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;StandardErrorPath\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/opt/homebrew/var/log/autossh-error.log\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;StandardOutPath\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/opt/homebrew/var/log/autossh-output.log\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;WorkingDirectory\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/Users/donie\u0026lt;/string\u0026gt; \u0026lt;/dict\u0026gt; \u0026lt;/plist\u0026gt; 注意：上述配置在我的 MacBook Air M1 里工作良好，但是在另一台 Intel iMac 里，需要去掉 -f 参数，否则无法启动 autossh 。\n启动服务：\n1 2 3 launchctl load -w ~/Library/LaunchAgents/org.0x3f.lemonade.plist launchctl load -w ~/Library/LaunchAgents/org.0x3f.autossh.plist 在 Linux VM 里给 lemonade 创建别名，使 fugitive 调用 xdg-open 打开链接时实际通过 lemonade 执行。由于真实的 xdg-open 在 /usr/bin 下，且在我的 PATH 环境变量里 /usr/local/bin 位于 /usr/bin 之前，所以我把别名建在这个目录下面：\n1 sudo ln -s /usr/bin/lemonade /usr/local/bin/xdg-open 存在的问题 lemonade 的客户端不支持多服务端的配置，在通过 SSH 端口远程转发的前提下，只能借助 --port 参数指定不同的端口，可以在 ~/.zshenv （或同类文件）里定义一个保存端口的环境变量，通过 $SSH_CLIENT 选择对应的端口。\n","permalink":"http://0x3f.org/posts/assisting-neovim-with-remote-development-using-lemonade-and-autossh/","summary":"\u003cp\u003e我的开发环境部署在 Linux VM 里，普通的远程复制用 \u003ca href=\"https://github.com/ojroques/vim-oscyank\"\u003evim-oscyank\u003c/a\u003e 插件是可以实现的。但是当我想用 \u003ca href=\"https://github.com/tpope/vim-fugitive\"\u003efugitive\u003c/a\u003e 的 \u003ccode\u003e:GBrowse\u003c/code\u003e 命令打开 Gitlab 链接的时候遇到了困难，甚至我想退而求其次、通过 \u003ccode\u003e:GBrowse!\u003c/code\u003e 复制链接都不可得，因为 fugitive 的代码里通过 \u003ccode\u003ehas('clipboard')\u003c/code\u003e 判断 Vim 是否可以使用系统剪贴板，且我的 Linux VM 不满足该特性的条件（见 \u003ccode\u003e:help clipboard\u003c/code\u003e）。所以用 \u003ca href=\"https://github.com/lemonade-command/lemonade\"\u003elemonade\u003c/a\u003e 解决这个问题。\u003c/p\u003e\n\u003ch1 id=\"实现方式\"\u003e实现方式\u003c/h1\u003e\n\u003cp\u003elemonade 虽然支持客户端和服务端直接通信，但是并不提供安全保障，所以我采取 SSH 端口远程转发的方式并用 \u003ca href=\"https://www.harding.motd.ca/autossh/\"\u003eautossh\u003c/a\u003e 保持连接。\u003c/p\u003e\n\u003cp\u003e首先分别在服务端（MacOS）和客户端（Linux VM）创建 lemonade 的配置文件（\u003ccode\u003e~/.config/lemonade.toml\u003c/code\u003e）：\u003c/p\u003e\n\u003cp\u003e服务端：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eport\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e2489\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eallow\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;127.0.0.1\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eline-ending\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;lf\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e客户端：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eport\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e2489\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ehost\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;localhost\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etrans-loopback\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etrans-localfile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eline-ending\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;lf\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后创建 MacOS 的服务配置文件：\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e~/Library/LaunchAgents/org.0x3f.lemonade.plist\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE plist PUBLIC \u0026#34;-//Apple//DTD PLIST 1.0//EN\u0026#34; \u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;plist\u003c/span\u003e \u003cspan class=\"na\"\u003eversion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;1.0\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dict\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eKeepAlive\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;true/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eLabel\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003eorg.0x3f.lemonade\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eProgramArguments\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;array\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003e/Users/donie/.go/bin/lemonade\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003eserver\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;/array\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eRunAtLoad\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;true/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eStandardErrorPath\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003e/opt/homebrew/var/log/lemonade-error.log\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eStandardOutPath\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003e/opt/homebrew/var/log/lemonade-output.log\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eWorkingDirectory\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003e/Users/donie\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/dict\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/plist\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003e~/Library/LaunchAgents/org.0x3f.autossh.plist\u003c/code\u003e\u003c/p\u003e","title":"使用 lemonade 和 autossh 辅助 Neovim 远程开发"},{"content":"家庭网络环境 使用 OpenWrt （以下简称 OP ）做旁路网关 OP 内建 OpenClash （以下简称 OC ）访问不存在的网站 OP 内建 WireGuard （以下简称 WG ）做内网穿透 使用 AdGuard Home （以下简称 AH ）做内网 DNS 和广告过滤 之前遇到的问题 不管怎样配置，内网和 WG 下的内网主机名解析和科学上网这 4 种场景总有至少一个不工作。\n期间创建过一个虚拟机做独立的 WG Server ，内建 SmartDNS （以下简称 SD ）做 AH 的上游，其它场景工作得很好，只是无法通过旁路网关访问不存在的网站。\n解决方法 首先如果要正常使用 OC ，就必须使用它的 DNS 解析。\n同时，又要达到使用 AH 做内网主机名解析和广告过滤的目的，所以要把 OC 设成 AH 的唯一上游。\n然后最棘手的问题来了。如果把 AH 设成 dnsmasq 的上游， WG 下不能解析内网主机名。如果把 AH 设成监听 53 端口，则内网无法解析主机名。\n想到之前在独立的 WG Server 上用 SD 在两种场景下都可以正常解析，就试着用它代替 dnsmasq ，结果柳暗花明，所以场景都跑通了。\n遗留的问题 OP 内置的 AH 在监听 53 端口时，为什么内网无法通过它解析？（与 SD 一样，监听的是“:::53”） OP 内置的 AH 作为 dnsmasq 的上游时，为什么内网可以解析而 WG 不能？ ","permalink":"http://0x3f.org/posts/make-adguard-home-and-openclash-work-together/","summary":"\u003ch1 id=\"家庭网络环境\"\u003e家庭网络环境\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e使用 OpenWrt （\u003cem\u003e以下简称 OP\u003c/em\u003e ）做旁路网关\u003c/li\u003e\n\u003cli\u003eOP 内建 OpenClash （\u003cem\u003e以下简称 OC\u003c/em\u003e ）访问不存在的网站\u003c/li\u003e\n\u003cli\u003eOP 内建 WireGuard （\u003cem\u003e以下简称 WG\u003c/em\u003e ）做内网穿透\u003c/li\u003e\n\u003cli\u003e使用 AdGuard Home （\u003cem\u003e以下简称 AH\u003c/em\u003e ）做内网 DNS 和广告过滤\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"之前遇到的问题\"\u003e之前遇到的问题\u003c/h1\u003e\n\u003cp\u003e不管怎样配置，内网和 WG 下的内网主机名解析和科学上网这 4 种场景总有至少一个不工作。\u003c/p\u003e\n\u003cp\u003e期间创建过一个虚拟机做独立的 WG Server ，内建 SmartDNS （\u003cem\u003e以下简称 SD\u003c/em\u003e ）做 AH 的上游，其它场景工作得很好，只是无法通过旁路网关访问不存在的网站。\u003c/p\u003e\n\u003ch1 id=\"解决方法\"\u003e解决方法\u003c/h1\u003e\n\u003cp\u003e首先如果要正常使用 OC ，就必须使用它的 DNS 解析。\u003c/p\u003e\n\u003cp\u003e同时，又要达到使用 AH 做内网主机名解析和广告过滤的目的，所以要把 OC 设成 AH 的唯一上游。\u003c/p\u003e\n\u003cp\u003e然后最棘手的问题来了。如果把 AH 设成 dnsmasq 的上游， WG 下不能解析内网主机名。如果把 AH 设成监听 53 端口，则内网无法解析主机名。\u003c/p\u003e\n\u003cp\u003e想到之前在独立的 WG Server 上用 SD 在两种场景下都可以正常解析，就试着用它代替 dnsmasq ，结果柳暗花明，所以场景都跑通了。\u003c/p\u003e","title":"让 AdGuard Home 和 OpenClash 协同工作"},{"content":"我目前用 SWAG 做 Homelab 的反向代理，在和其它服务一样为 Seafile 配置好后，访问时却报如下错误：\nContradictory scheme headers\n原因是 Seafile 的 Docker 镜像里已经使用了 NGINX 做反代，而且配置里包含和 SWAG 反代相同的配置项：\n1 proxy_set_header X-Forwarded-Proto $scheme； 此时，通过 HTTPS 访问的 SWAG 反代传递的 HEADER 里 X-Forwarded-Proto 是 https ，而通过 HTTP 访问的 Seafile 传递的是 http ，就会报以上错误。\n一种解决方法是，把 Seafile 的 /etc/nginx/conf.d/seafile.nginx.conf 复制到宿主机，把文件中 X-Forwarded-Proto 这一行注释掉，然后映射到 Docker 容器的上述路径上：\n1 -v \u0026#39;/mnt/user/appdata/seafile/seafile.nginx.conf\u0026#39;:\u0026#39;/etc/nginx/conf.d/seafile.nginx.conf\u0026#39;:\u0026#39;ro\u0026#39; 需要注意的是，不同版本的 Seafile 镜像里该文件的路径可能不同。\n","permalink":"http://0x3f.org/posts/setup-reverse-proxy-for-seafile/","summary":"\u003cp\u003e我目前用 SWAG 做 Homelab 的反向代理，在和其它服务一样为 Seafile 配置好后，访问时却报如下错误：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eContradictory scheme headers\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e原因是 Seafile 的 Docker 镜像里已经使用了 NGINX 做反代，而且配置里包含和 SWAG 反代相同的配置项：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-NGINX\" data-lang=\"NGINX\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eproxy_set_header\u003c/span\u003e \u003cspan class=\"s\"\u003eX-Forwarded-Proto\u003c/span\u003e \u003cspan class=\"nv\"\u003e$scheme；\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e此时，通过 HTTPS 访问的 SWAG 反代传递的 HEADER 里 \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e 是 \u003ccode\u003ehttps\u003c/code\u003e ，而通过 HTTP 访问的 Seafile 传递的是 \u003ccode\u003ehttp\u003c/code\u003e ，就会报以上错误。\u003c/p\u003e\n\u003cp\u003e一种解决方法是，把 Seafile 的 \u003ccode\u003e/etc/nginx/conf.d/seafile.nginx.conf\u003c/code\u003e 复制到宿主机，把文件中 \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e 这一行注释掉，然后映射到 Docker 容器的上述路径上：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-v \u003cspan class=\"s1\"\u003e\u0026#39;/mnt/user/appdata/seafile/seafile.nginx.conf\u0026#39;\u003c/span\u003e:\u003cspan class=\"s1\"\u003e\u0026#39;/etc/nginx/conf.d/seafile.nginx.conf\u0026#39;\u003c/span\u003e:\u003cspan class=\"s1\"\u003e\u0026#39;ro\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e需要注意的是，不同版本的 Seafile 镜像里该文件的路径可能不同。\u003c/p\u003e","title":"为 Seafile 配置反向代理的问题"},{"content":"把个人数据收集到 NAS 之后，我开始着手实现 NAS 的异地备份，以补足数据安全的最后一环。\n综合考虑过多种方案之后，感觉还是通过移动硬盘冷备最合适我目前的状况。之前闲置的 Buffalo 3.5\u0026rsquo; 外置硬盘不方便携带，所以放在家里做冗余备份。新买一块 2.5\u0026rsquo; 移动硬盘，每隔一段时间拿回家更新一下备份。\n正好希捷 Basic 简系列和东芝新小黑 A3 有优惠，分别以 380 ￥和 370 ￥的价格入手了 2T 容量款，对比结果如下：\n写入速度方面，200G 大文件，东芝比希捷快大概一分钟，速度分别为 142 MB/s 和 137 MB/s 。另对一个总大小为 140G 的目录（内含多个大文件）做写入的结果也是前者比后者稍快一点。\n温度表现上，写入过程中东芝保持在 41℃ 左右，希捷在 45℃ ~ 51℃ 的范围。\n希捷的尺寸（117mm × 80mm × 14.8mm）比东芝（109mm × 78mm × 14.0mm）明显大一些。\n价格也是东芝更便宜。\n外观上都是塑料感很强，正面简单到只有一个 LOGO ，背面是规格标签，东芝的标签居中而且尤其大，十分难看。正面棱角稍方，底部稍圆润，虽然是为了优化握持感，但我觉得不太好看。希捷只有灰色款有优惠，到手观感确实不如黑色。\n整体来说，东芝的这款 2T 的新小黑 A3 在可见的各方面都比同容量希捷 Basic 简系列更有优势。\n","permalink":"http://0x3f.org/posts/seagate-basic-vs-toshiba-a3/","summary":"\u003cp\u003e\u003ca href=\"/posts/my-first-nas/\"\u003e把个人数据收集到 NAS\u003c/a\u003e 之后，我开始着手实现 NAS 的异地备份，以补足数据安全的最后一环。\u003c/p\u003e\n\u003cp\u003e综合考虑过多种方案之后，感觉还是通过移动硬盘冷备最合适我目前的状况。之前闲置的 Buffalo 3.5\u0026rsquo; 外置硬盘不方便携带，所以放在家里做冗余备份。新买一块 2.5\u0026rsquo; 移动硬盘，每隔一段时间拿回家更新一下备份。\u003c/p\u003e\n\u003cp\u003e正好希捷 Basic 简系列和东芝新小黑 A3 有优惠，分别以 380 ￥和 370 ￥的价格入手了 2T 容量款，对比结果如下：\u003c/p\u003e\n\u003cp\u003e写入速度方面，200G 大文件，东芝比希捷快大概一分钟，速度分别为 142 MB/s 和 137 MB/s 。另对一个总大小为 140G 的目录（内含多个大文件）做写入的结果也是前者比后者稍快一点。\u003c/p\u003e\n\u003cp\u003e温度表现上，写入过程中东芝保持在 41℃ 左右，希捷在 45℃ ~ 51℃ 的范围。\u003c/p\u003e\n\u003cp\u003e希捷的尺寸（117mm × 80mm × 14.8mm）比东芝（109mm × 78mm × 14.0mm）明显大一些。\u003c/p\u003e\n\u003cp\u003e价格也是东芝更便宜。\u003c/p\u003e\n\u003cp\u003e外观上都是塑料感很强，正面简单到只有一个 LOGO ，背面是规格标签，东芝的标签居中而且尤其大，十分难看。正面棱角稍方，底部稍圆润，虽然是为了优化握持感，但我觉得不太好看。希捷只有灰色款有优惠，到手观感确实不如黑色。\u003c/p\u003e\n\u003cp\u003e整体来说，东芝的这款 2T 的新小黑 A3 在可见的各方面都比同容量希捷 Basic 简系列更有优势。\u003c/p\u003e","title":"希捷 Basic 简系列和东芝新小黑 A3 的简单对比"},{"content":"检查列表 xbot/omnifocus-plugin-checklist\n在 OmniFocus 中指定一个 folder ，其下的所有 project 都将作为 checklist 的模板。\n选中一或多个 projects 并触发这个插件的 action ，在弹出的对话框中选择要用的模板，将会在目标 projects 中创建同名 task ，模板中的 tasks 创建为该 task 的子任务。\n模板的 Parallel 、 Complete with last action 、 tags 和 note 会被同步过去。\n生成工作日志 xbot/omnifocus-plugin-generate-work-journal\n用于每天下班前一键生成工作日志。\n插件会收集名为 Work 的目录下当天完成的 Tasks 并根据 Task 标题和 Note 的内容追加不同的状态描述。例如，标题包含“面试”的 Task 不追加状态描述；Note 为空的 Task 追加“完成”，否则追加 Note 的内容。目录目前是写死的，没有做通用性适配。\n打开 Jira Ticket xbot/omnifocus-plugin-open-jira-ticket\n从被选中的 Project 标题中解析 Jira Ticket 序号，并根据配置的 Jira URL 打开对应的 Ticket 。如果选中的是 Task ，使用其所属的 Project 。\n在 Flomo 中搜索当前 Project xbot/omnifocus-plugin-find-in-flomo\n从被选中的 Project 标题中按自定义规则解析关键词，并在 Flomo 中搜索相关的笔记。可以指定一个 Tag 辅助过滤。\n这个插件的通用性做得稍好，解析关键词的正则表达式可以自定义，解析出的结果可以填充到自定义模板中作为 Flomo 的搜索词。\nFlomo 目前只支持通过单个 Tag 过滤，所以配置界面只能指定一个 Tag 。\n转换 Tasks 为指定目录下的 Projects xbot/omnifocus-plugin-convert-to-projects\nOmniFocus 自带的转换功能会把新 Project 追加到库的末尾，需要先跳转到 Projects Perspective 再拖动到目标目录。所以写了这个插件，转换前先指定目标目录，转换后自动跳转到新的 Projects 。\n选中的目录会被记录，下次执行转换操作时默认选中上次使用的目录。\n重置 Review 视图 xbot/omnifocus-plugin-reset-review-status\n我希望实现早晚两次 Review ，这个插件可以帮我做到这一点。\n重新排期 xbot/omnifocus-plugin-reschedule-objects\n为选中的 Tasks 或 Projects 重新指定 Defer 和 Due 时间。\n可用的时间段有：\nMorning ：9:30 ~ 12:00 Noon ：12:00 ~ 14:00 Afternoon ：14:00 ~ 18:30 Evening ：18:30 ~ 23:00 Daytime ：9:30 ~ 18:30 Whole Day ：9:30 ~ 23:00 目前时间段是按我的时间制定的，暂时不可自定义。\n使用当前网页或邮件创建 Task omnifocus.lua\n这个不是 OmniFocus 插件，是 Hammerspoon 的脚本。\n通过快捷键把当前浏览器（Chrome 及其衍生物）页签或电邮（Outlook 或 Mail）添加到 OmniFocus 。\n主要使用 Hammerspoon 的 Spoon SendToOmniFocus 实现，但它会在创建的 Task 标题前插入 “Review:”前缀，所以我增加了一个快捷键用于过滤它，如果新建的是 Jira Ticket 的 Task ，还会过滤掉无用的后缀。\n写日记 每日回顾\n这是个快捷指令。\n可以列出指定日期从 0 点到第二天凌晨 3 点之间完成的所有任务，你可以选择重要的内容并粘贴到 Day One 中新创建的日记里。\n从 Tweet 里提炼待办事项 xbot/omnifocus-plugin-refine-task\n我用快捷指令“收集 Tweet 到 OmniFocus”收集 tweets ，然后用快捷指令“提炼 OmniFocus”利用 ChatGPT 提炼待办事项并复制到剪贴板，接着这个快捷指令会调用插件 refine-task 把条目原文移动到备注里并打开输入框由用户粘贴或者输入待办事项。\n","permalink":"http://0x3f.org/posts/the-omnifocus-plugins-i-am-using/","summary":"\u003ch1 id=\"检查列表\"\u003e检查列表\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/omnifocus-plugin-checklist\"\u003exbot/omnifocus-plugin-checklist\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在 OmniFocus 中指定一个 folder ，其下的所有 project 都将作为 checklist 的模板。\u003c/p\u003e\n\u003cp\u003e选中一或多个 projects 并触发这个插件的 action ，在弹出的对话框中选择要用的模板，将会在目标 projects 中创建同名 task ，模板中的 tasks 创建为该 task 的子任务。\u003c/p\u003e\n\u003cp\u003e模板的 Parallel 、 Complete with last action 、 tags 和 note 会被同步过去。\u003c/p\u003e\n\u003ch1 id=\"生成工作日志\"\u003e生成工作日志\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/omnifocus-plugin-generate-work-journal\"\u003exbot/omnifocus-plugin-generate-work-journal\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e用于每天下班前一键生成工作日志。\u003c/p\u003e\n\u003cp\u003e插件会收集名为 \u003ccode\u003eWork\u003c/code\u003e 的目录下当天完成的 Tasks 并根据 Task 标题和 Note 的内容追加不同的状态描述。例如，标题包含“面试”的 Task 不追加状态描述；Note 为空的 Task 追加“完成”，否则追加 Note 的内容。目录目前是写死的，没有做通用性适配。\u003c/p\u003e\n\u003ch1 id=\"打开-jira-ticket\"\u003e打开 Jira Ticket\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/omnifocus-plugin-open-jira-ticket\"\u003exbot/omnifocus-plugin-open-jira-ticket\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e从被选中的 Project 标题中解析 Jira Ticket 序号，并根据配置的 Jira URL 打开对应的 Ticket 。如果选中的是 Task ，使用其所属的 Project 。\u003c/p\u003e","title":"我在用的 OmniFocus 插件"},{"content":"Vim 没有很好的 Git commits viewer ，普通的 diff 模式对于很小的 commit 还行，文件较多、改动较大的 commit 看起来很糟糕。\ngv.vim + Diffview.nvim 是我目前找到的最好的解决方案，下面稍加配置，实现在 gv.vim 的 log 界面通过快捷键 vv 在 Diffview.nvim 里打开光标所在行对应的 commit ：\n1 2 3 4 5 6 7 8 9 10 11 12 lua \u0026lt;\u0026lt; EOF function _G.diff_view_commit(commit_hash) require\u0026#39;diffview\u0026#39;.open(commit_hash .. \u0026#39;~1..\u0026#39; .. commit_hash) end EOF au! FileType GV nnoremap vv \u0026lt;Esc\u0026gt;:call \u0026lt;SID\u0026gt;DiffviewCommitUnderCursor()\u0026lt;CR\u0026gt; function! s:DiffviewCommitUnderCursor() normal! ^2f w call v:lua.diff_view_commit(expand(\u0026#39;\u0026lt;cword\u0026gt;\u0026#39;)) endfunction ","permalink":"http://0x3f.org/posts/check-commit-with-diffview-in-gv-vim/","summary":"\u003cp\u003eVim 没有很好的 Git commits viewer ，普通的 diff 模式对于很小的 commit 还行，文件较多、改动较大的 commit 看起来很糟糕。\u003c/p\u003e\n\u003cp\u003egv.vim + Diffview.nvim 是我目前找到的最好的解决方案，下面稍加配置，实现在 gv.vim 的 log 界面通过快捷键 \u003ccode\u003evv\u003c/code\u003e 在 Diffview.nvim 里打开光标所在行对应的 commit ：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003elua\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003e_G\u003c/span\u003e.\u003cspan class=\"nx\"\u003ediff_view_commit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecommit_hash\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;diffview\u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecommit_hash\u003c/span\u003e .. \u003cspan class=\"s1\"\u003e\u0026#39;~1..\u0026#39;\u003c/span\u003e .. \u003cspan class=\"nx\"\u003ecommit_hash\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003eGV\u003c/span\u003e \u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"nx\"\u003evv\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eEsc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e:\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSID\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eDiffviewCommitUnderCursor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003eDiffviewCommitUnderCursor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003enormal\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e ^\u003cspan class=\"m\"\u003e2\u003c/span\u003ef \u003cspan class=\"nx\"\u003ew\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e:\u003cspan class=\"nx\"\u003elua\u003c/span\u003e.\u003cspan class=\"nx\"\u003ediff_view_commit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;cword\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"在 gv.vim 中使用 Diffview.nvim 查看提交内容"},{"content":"Hammerspoon（以下简称 HS）是个很好用的效率工具脚手架，我一直用它实现 APP 启动器、窗口控制、桌面常亮等功能。\nHS 可以通过写脚本可以实现很多个性化的需求。最快的上手方式是直接安装别人写好的脚本，然后根据自己的需要稍加修改即可。如果需要深度定制，可以自行实现新的模块。\nHS 使用 Lua 语言。我在 08 年左右用过一年的 SciTE 编辑器，它也通过内嵌的 Lua 配置和扩展功能，所以学了这个语言。当时 NGINX 也才刚起步， Lua 主要还是被用在游戏脚本的开发，并没有现在使用得如此广泛。当时对这个语言的印象是两个极端，一是速度非常快，远远超过 PHP 和 Python ，比 C 也只慢一点点；二是开发库非常简陋，其它脚本语言一行就能实现的常见功能，它往往要从头开始写。\n总之 Lua 是个很精简的语言，可以通过 Y 分钟速成 X 的教程快速熟悉它的语法，然后浏览一遍官方入门指南。HS 提供了很多方便的模块，通过 API 文档查看。\n由于经常需要切换键盘映射方案，所以我写了一个简单的模块来实现这个功能：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 local hotkey = require \u0026#34;hs.hotkey\u0026#34; hotkey.bind(hyper, \u0026#34;K\u0026#34;, function() local configFile = os.getenv(\u0026#39;HOME\u0026#39;) .. \u0026#39;/.config/karabiner/karabiner.json\u0026#39; if hs.json.read(configFile) == nil then hs.alert.show(\u0026#39;Failed to read config file!\u0026#39;) return end local configs = hs.json.read(configFile) local profiles = configs[\u0026#39;profiles\u0026#39;] local selectedIndex = nil for i = 1, #profiles do if profiles[i][\u0026#39;selected\u0026#39;] == true then selectedIndex = i break end end local switchToIndex = selectedIndex + 1 if switchToIndex \u0026gt; #profiles then switchToIndex = 1 end profiles[switchToIndex][\u0026#39;selected\u0026#39;] = true profiles[selectedIndex][\u0026#39;selected\u0026#39;] = false hs.json.write(configs, configFile, true, true) hs.alert.show(profiles[switchToIndex][\u0026#39;name\u0026#39;] .. \u0026#39; activated!\u0026#39;) end) 源码见这里。\n代码非常简单，通过 HS 的 API hotkey.bind() 绑定快捷键到一个包含所有功能逻辑的匿名函数上。最后在 init.lua 里引入这个模块即可。\n除此之外， HS 还有个 Spoon 的功能，一个 Spoon 其实就是它的一个插件。官方维护了一份 spoon 的列表 。Spoon 的详细用法可以参考 Github 上官方仓库的说明。\n以 SendToOmniFocus.spoon 为例，下载 zip 文件并解压到 ~/.hammerspoon/Spoons 目录，新增如下模块：\n1 2 3 4 5 hs.loadSpoon(\u0026#39;SendToOmniFocus\u0026#39;) spoon.SendToOmniFocus:bindHotkeys({send_to_omnifocus = {{\u0026#39;ctrl\u0026#39;, \u0026#39;alt\u0026#39;, \u0026#39;cmd\u0026#39;}, \u0026#39;O\u0026#39;}}) spoon.SendToOmniFocus:registerApplication(\u0026#39;Brave Browser\u0026#39;, { apptype = \u0026#34;chromeapp\u0026#34;, itemname = \u0026#34;tab\u0026#34; }) 源码见这里。\n","permalink":"http://0x3f.org/posts/hammerspoon-quick-start/","summary":"\u003cp\u003eHammerspoon（\u003cem\u003e以下简称 HS\u003c/em\u003e）是个很好用的效率工具脚手架，我一直用它实现 APP 启动器、窗口控制、桌面常亮等功能。\u003c/p\u003e\n\u003cp\u003eHS 可以通过写脚本可以实现很多个性化的需求。最快的上手方式是直接安装别人写好的\u003ca href=\"https://github.com/sugood/hammerspoon\"\u003e脚本\u003c/a\u003e，然后根据自己的需要稍加修改即可。如果需要深度定制，可以自行实现新的模块。\u003c/p\u003e\n\u003cp\u003eHS 使用 Lua 语言。我在 08 年左右用过一年的 \u003ca href=\"https://www.scintilla.org/SciTE.html\"\u003eSciTE\u003c/a\u003e 编辑器，它也通过内嵌的 Lua 配置和扩展功能，所以学了这个语言。当时 NGINX 也才刚起步， Lua 主要还是被用在游戏脚本的开发，并没有现在使用得如此广泛。当时对这个语言的印象是两个极端，一是速度非常快，远远超过 PHP 和 Python ，比 C 也只慢一点点；二是开发库非常简陋，其它脚本语言一行就能实现的常见功能，它往往要从头开始写。\u003c/p\u003e\n\u003cp\u003e总之 Lua 是个很精简的语言，可以通过 \u003ca href=\"https://learnxinyminutes.com/docs/zh-cn/lua-cn/\"\u003eY 分钟速成 X\u003c/a\u003e 的教程快速熟悉它的语法，然后浏览一遍\u003ca href=\"https://www.hammerspoon.org/go/\"\u003e官方入门指南\u003c/a\u003e。HS 提供了很多方便的模块，通过 \u003ca href=\"https://www.hammerspoon.org/docs/index.html\"\u003eAPI 文档\u003c/a\u003e查看。\u003c/p\u003e\n\u003cp\u003e由于经常需要切换键盘映射方案，所以我写了一个简单的模块来实现这个功能：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-lua\" data-lang=\"lua\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003ehotkey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequire\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;hs.hotkey\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ehotkey.bind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehyper\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;K\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003econfigFile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eos.getenv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;HOME\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e..\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;/.config/karabiner/karabiner.json\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ehs.json\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfigFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ehs.alert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Failed to read config file!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003econfigs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehs.json\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfigFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003eprofiles\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfigs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;profiles\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003eselectedIndex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003eprofiles\u003c/span\u003e \u003cspan class=\"kr\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eprofiles\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;selected\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eselectedIndex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"kr\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003eswitchToIndex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eselectedIndex\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eswitchToIndex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003eprofiles\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e \u003cspan class=\"n\"\u003eswitchToIndex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eprofiles\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eswitchToIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;selected\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eprofiles\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eselectedIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;selected\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ehs.json\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfigs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econfigFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ehs.alert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprofiles\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eswitchToIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e..\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39; activated!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e源码见\u003ca href=\"https://github.com/xbot/hammerspoon/blob/master/modules/karabiner.lua\"\u003e这里\u003c/a\u003e。\u003c/p\u003e","title":"Hammerspoon 快速入门"},{"content":"在 NAS 上搭了个自动追剧、追影的工作流，体验非常好。\n只需要把想看的美剧或者电影添加到监控列表里，就可以在资源出现之后自动下载并通知到手机或电脑，全程无值守，回家打开电视就能看。\n用到这些工具：\nJackett: BT 索引工具，负责搜索资源。 Prowlarr: Jackett 的平替，和 Radarr/Sonarr 同步 indexer 更方便，对 torrent 网站的限流机制处理得更好。 Sonarr: 电视剧管理工具，负责管理追剧列表、调用 Jackett 搜索、资源监控、下载调度。 Radarr: 电影管理工具，功能同 Sonarr 。 qBittorrent: BT 下载工具。 ChineseSubFinder: 字幕搜索工具。 Jellyfin: 媒体中心，负责影视剧转码、播放、管理。 Telegram: 接收通知。 nzb360: Android APP ， Sonarr 、 Radarr 、 qBittorrent 的客户端。 LunaSea: iOS 的 nzb360 平替，功能和用户体验稍逊后者。 Jackett 是 BT 资源索引工具，可以对添加到索引列表中的 BT 资源站点做集中搜索。\n在 Jackett 因某个 indexer 由于其网站的限流措施而响应失败导致 Radarr 无法搜索且无法修改 indexer 配置后，我改用了 Prowlarr 。它不仅解决了之前遇到的问题，还可以自动同步 indexer 配置到 Radarr 和 Sonarr，并且它们的 UI 也十分统一。\nSonarr 专门用来管理剧集，与 Jackett 集成后可以在 Sonarr 的页面上搜索并添加到监控列表。剧集更新后会自动调用下载服务下载，随后导入并刮削元数据。特别地，如果发现有更清晰的资源，它可以自动下载并替换现有的资源。\nRadarr 的功能和 Sonarr 几乎一样，只不过它是用来管理电影的。\nqBittorrent 是下载工具。\nJellyfin 是媒体中心，实现对影视资源的管理、转码、播放功能。在播放终端解码能力弱或者网络不够好的场景下比较有用。如果电视的播放器（例如 Infuse 7）刷新海报墙比较慢，Jellyfin 会因为是持续运行的服务而有更好的体验。\n这里还需要用到 ChineseSubFinder ，它会监视媒体目录并自动下载合适的字幕。\n当资源被添加、删除或下载时，通过 Telegram 发送通知到手机或者电脑。\nnzb360 是 Sonarr 、 Radarr 、 qBittorrent 的 Android 客户端。UI 很漂亮，使用体验也非常好。还可以添加 Jellyfin 等系统的 Web UI ，实现对整个工作流的一站式访问。\n在 iOS 上我用 LunaSea 作为 nzb360 的平替，但是在功能和用户体验上要稍逊于后者，作为 Android 手机不在手边时的临时替代品。\n","permalink":"http://0x3f.org/posts/auto-workflow-of-following-tv-series-and-movies/","summary":"\u003cp\u003e在 NAS 上搭了个自动追剧、追影的工作流，体验非常好。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2021-11-21-17-24-06-%E8%87%AA%E5%8A%A8%E8%BF%BD%E5%89%A7%E6%B5%81%E7%A8%8B.svg\" alt=\"自动追剧流程\"\u003e\u003c/p\u003e\n\u003cp\u003e只需要把想看的美剧或者电影添加到监控列表里，就可以在资源出现之后自动下载并通知到手机或电脑，全程无值守，回家打开电视就能看。\u003c/p\u003e\n\u003cp\u003e用到这些工具：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003e\u003cstrong\u003eJackett\u003c/strong\u003e: BT 索引工具，负责搜索资源。\u003c/del\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProwlarr\u003c/strong\u003e: Jackett 的平替，和 Radarr/Sonarr 同步 indexer 更方便，对 torrent 网站的限流机制处理得更好。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSonarr\u003c/strong\u003e: 电视剧管理工具，负责管理追剧列表、调用 Jackett 搜索、资源监控、下载调度。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRadarr\u003c/strong\u003e: 电影管理工具，功能同 Sonarr 。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eqBittorrent\u003c/strong\u003e: BT 下载工具。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eChineseSubFinder\u003c/strong\u003e: 字幕搜索工具。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eJellyfin\u003c/strong\u003e: 媒体中心，负责影视剧转码、播放、管理。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTelegram\u003c/strong\u003e: 接收通知。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003enzb360\u003c/strong\u003e: Android APP ， Sonarr 、 Radarr 、 qBittorrent 的客户端。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLunaSea\u003c/strong\u003e: iOS 的 nzb360 平替，功能和用户体验稍逊后者。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eJackett 是 BT 资源索引工具，可以对添加到索引列表中的 BT 资源站点做集中搜索。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2021-11-21-17-50-31-jackett-01.jpg\" alt=\"2021-11-21-17-50-31-jackett-01\"\u003e\u003c/p\u003e\n\u003cp\u003e在 Jackett 因某个 indexer 由于其网站的限流措施而响应失败导致 Radarr 无法搜索且无法修改 indexer 配置后，我改用了 Prowlarr 。它不仅解决了之前遇到的问题，还可以自动同步 indexer 配置到 Radarr 和 Sonarr，并且它们的 UI 也十分统一。\u003c/p\u003e","title":"自动追剧的工作流"},{"content":"\n年初终于攒了一台 NAS 。\n之前用一块 1T 的 Buffalo 外置硬盘，但是多年之后，我开始担心这头老水牛还能活多久，况且它的剩余空间也已经不多了。与此同时，手机和电脑的存储空间也像油腻大叔的头发一样越来越少，我必须把沉淀的冷数据迁移出去。身边像有一群饥饿的东西拼命向我伸手。\n而且，随着数码设备的增加，尤其在添了一台 Apple TV 后，出于看 YouTube 的目的，我更需要通过软路由的方式改善家庭网络的翻墙体验。\n再者，以前看影剧都是把 U 盘插到电视或者微投上，或者通过电脑串流，多少也有点麻烦。\n于是打算用一台 All-in-one 解决所有问题。\n硬件规格 最初考虑过群晖、威联通之类的品牌 NAS ，如果能得到更好的使用体验，多花点钱也是可以的。但是看过硬件规格后，感觉我要是以这个价格买了，那就算人生的污点了。\n所以开始准备攒机，按优先级列举一下要求：\n美观，不要傻大黑粗的直男风。 体积小。 兼顾功耗和性能。 内存大（16 ~ 32 G）。 先后拟了 4 套配置，和某淘宝店的套装做了一下对比：\n- 淘宝店方案 价格 方案 1 价格 方案 2 价格 方案 3 价格 方案 4 价格 机箱 万由 410 - 万由 410 680 迎广 MS04 930 蜗牛星际B涂装改风扇 275 蜗牛星际B涂装改风扇 275 电源 益衡 200W - 益衡 7025B 236 机箱内置 - 益衡 7025B 236 益衡 7025B 236 主板 B365-ITX 定制工控板 - 华擎 Z390M-ITX/ac 1199 华擎 Z390M-ITX/ac 1199 华擎 Z390M-ITX/ac 1199 华擎 Z390M-ITX/ac（二） 700 CPU I5-8600T - I5-8600T 825 I5-8600T 825 I5-8600T 825 I5-8600T 825 散热器 - - AVC 28mm 115X 23 AVC 28mm 115X 23 AVC 28mm 115X 23 AVC 28mm 115X 23 内存 镁光 DDR4 16G 2666 - 光威 DDR4 2666 16G 379 光威 DDR4 2666 16G 379 光威 DDR4 2666 16G 379 海盗船 DDR4 3000 16G×2（二） 700 总计 - 2999 - 3342 - 3356 - 2937 - 2759 最后选了第 4 种。\n其实最难挑的是机箱，专门给 NAS 用的本来就少，大多数还都是没有设计感的商务风，所以最终选了个人喷涂改装的蜗牛星际 B 款机箱。喷涂质量一般，细节粗糙，远看还行。内部空间很逼仄，费了半天功夫也没装上主板，只好用钳子把主板支架的一角掰弯才搞定。\n主板只能用 ITX 小板，比 ATX 板贵很多，买的二手，降低成本。\nCPU 用当时比较热门的 i5-8600T ，散片刚从 1k+ 降到 800+ 。6 核， T 系列，兼顾性能和功耗。\n主板卖家同时也在卖两条海盗船的 16 G 内存，就打包一起买了。\n硬盘用了 4 块 4T 的酷狼，后来又加了一条 500G 的 M.2 SSD 当缓存盘，实现硬盘自动休眠。\n软件平台 选系统的时候纠结了一阵子，一旦选定了可能会用相当长的时间，不想因为换系统倒腾数据。\n列了一下需求，按优先级依次是：\n稳定、安全。 使用方便，功能完善，体验好。 支持 Docker 和虚拟机，性能损失小。 界面美观。 可以方便地实现硬件直通和硬盘自动休眠。 对比了几种常见的 NAS 系统。虽然群晖的系统如雷贯耳，但是对黑群的稳定性有顾虑。ESXi 是商业软件，据说用户体验不错，不过是纯粹的虚拟机平台，不是基于 Linux 的，所以不支持原生的 Docker 。 PVE 基于 Debian ，但是可视化界面比较简陋，需要大量命令行操作和配置。 TrueNAS 以健壮性和 ZFS 著称，但是基于 BSD ，不原生支持 Docker 。\n剩下一对瑜亮，OVM 和 Unraid 。 OVM 基于 Debian ，界面简洁易用 ，功能较完善，开源免费，如果没有后者，我肯定就用它了。 Unraid 是商业软件，功能的完备程度、界面的美观程度和易用性都要好于 OVM ，通过校验盘实现冗余备份的方式可以较简单地增减硬盘。\n最后买了 Unraid 的 Basic Plan 。\n使用感受 目前主要使用以下功能：\n服务 功能 AdGuard Home DNS 缓存、广告过滤 Archlinux VM + Redis + MySQL 开发环境 Cloudflare-DDNS DDNS DDNSTO 备用内网穿透 DokuWiki 个人维基 Heimdall 导航页 Jellyfin 媒体中心 NAS 存储个人数据、监控视频、 Calibre Library OpenWrt 旁路网关 PhotoPrism 照片管理 SWAG Let\u0026rsquo;s Encrypt 证书申请/维护、反向代理 Time Machine 备份 Macbook Pro VaultWarden 密码管理 WireGuard VPN ZeroTier 内网穿透 qBittorrent P2P 下载。 tinyMediaManager 影视信息刮削 微力同步 替代 Dropbox 、传输照片到 PhotoPrism NAS 是我用得最多的功能，平时冷数据全往里扔，减少心理负担。\n用 OpenWrt 做旁路网关实现家庭网络翻墙，体验总体还好。为了让 Unraid 的各项功能正常工作，也需要走旁路网关，所以把 OpenWrt 部署到另一台小主机上了。\n我那 17 年 8 G 内存的丐版 Macbook Pro 最近越来越显得力不从心，所以时隔多年之后，重新在虚拟机上用回了 Archlinux ， AUR 依然好用，Linux 依然飞快。把开发环境迁移过去，我可以一边流畅地写代码，一边追忆 good old days ，很开心。\n虽然没有摄影的爱好，多年积攒的照片也不是我那基础款的 iCloud 和免费的 Google Photos 能放下的，所以一直在外置硬盘里扔着，很少再看。PhotoPrism 有机器学习的能力，可以通过图像识别给照片打标签，也可以实现人脸识别，不过准确度比较一般，算是勉强可用的图片管理系统，总算让我有动力偶尔翻翻旧照片了。\n在调研同步照片到 PhotoPrism 的方法的过程中，如果不是注意到了微力同步，我可能就买 PhotoSync 了，在同步照片这个事上，它已经做得足够好了。然而前者不但可以解决这个场景的需求，还可以替代我那只有三个设备限制的免费 Plan 的 Dropbox ，在增加了一台 iMac 之后，早就已经被退出一台设备再登录另一台弄得心碎了。\n关于密码管理，在我的 Linux 时代，用了多年 Keepass ，前几年换到 Mac 一段时间后迁移到了 1Password ，虽然它是体验最好的工具，但是在发现 Bitwarden 已经能达到它百分之八九十的体验后，还是想着能省则省吧，好歹一年也有 35$ 。由于早年管理粗犷，且经过多次迁移，累积了很多需要整理的数据，但是免费版的 Bitwarden 账户弱化了这方面的功能。于是我自建了 Vaultwarden 。\n在启用了越来越多的服务后，就不能只局限在内网使用了。有两个选择，一个是内网穿透，一个是 DDNS 。ZeroTier 做内网穿透体验很好。不过最近开通了公网 IP 、配置了 DDNS ，开始用 WireGuard ，暂时把 ZeroTier 当作备用线路了。\n服务增加后另一个大问题是记忆的压力。反向代理可以实现通过域名访问各种 Docker 服务，避免记忆一堆端口号。SWAG 集成了 ACME 工具和 NGINX ，可以很方便地自动申请和更新 SSL 证书，提供了大量的反向代理模板，稍加修改就可以通过 HTTPS 访问各种内网服务。由于当前版本的 SWAG 的 ACME 默认并不支持小众的 namesilo ，我只好把域名的 DNS 解析服务迁移到了 Cloudflare ，并通过 Cloudflare-DDNS 自动更新 DNS 记录。\n随大流搭了 Adguard Home ，众所周知的目的是 DNS 缓存、防污染和过滤广告，而我暂时还没有什么体会。\nJellyfin 也是随大流搭的。在我看来，媒体中心的作用除了在移动端看电影，就是当机械硬盘或家庭千兆网络无法支撑 Remux 4k 这种动辄 50GB 的高清电影的流畅播放时用来转码的。所以可以视自己的需求取舍。\n在媒体中心或者电视上展示 NAS 中电影的海报墙需要刮削工具。桌面版 tinyMediaManager 的体验很好，但是在 Docker 里部署的会有一些我暂时没能解决的问题，而且还显示效果不好、输入中文麻烦。\n我很在意硬盘的自动休眠，当然暂时也不打算挂 PT ，目前大部分资源都通过阿里云盘下载，有些优先级不高或者云盘里找不到的也会扔到 qBittorrent 里慢慢下。qBittorrent 是在我这里唯一可用性还可以接受的 BT 下载工具，当然也需要经常更新 trackers 。\n为了方便在移动端访问家庭网络里的服务，我用 Heimdall 搭建了一个导航页，有很美观的 UI ，而且对移动端很友好。\n最后算笔有意思的账吧，攒这台 All-in-one 软硬件花了大概 7k ，替代 Dropbox Plus 119.88$/y 、 iCloud 200G 252￥/y 、 Google One 200G 29.99$/y 、 1Password 35$/y ，每年省 1.5k ，大约 5 年回本。而如果考虑到省了一台 32G 、 1TB 的 M1 Max ，那真是感觉赚了一个亿……\n","permalink":"http://0x3f.org/posts/my-first-nas/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2021-11-09-00-57-46-my-first-nas.jpg\" alt=\"2021-11-09-00-57-46-my-first-nas\"\u003e\u003c/p\u003e\n\u003cp\u003e年初终于攒了一台 NAS 。\u003c/p\u003e\n\u003cp\u003e之前用一块 1T 的 Buffalo 外置硬盘，但是多年之后，我开始担心这头老水牛还能活多久，况且它的剩余空间也已经不多了。与此同时，手机和电脑的存储空间也像油腻大叔的头发一样越来越少，我必须把沉淀的冷数据迁移出去。身边像有一群饥饿的东西拼命向我伸手。\u003c/p\u003e\n\u003cp\u003e而且，随着数码设备的增加，尤其在添了一台 Apple TV 后，出于看 YouTube 的目的，我更需要通过软路由的方式改善家庭网络的翻墙体验。\u003c/p\u003e\n\u003cp\u003e再者，以前看影剧都是把 U 盘插到电视或者微投上，或者通过电脑串流，多少也有点麻烦。\u003c/p\u003e\n\u003cp\u003e于是打算用一台 All-in-one 解决所有问题。\u003c/p\u003e\n\u003ch2 id=\"硬件规格\"\u003e硬件规格\u003c/h2\u003e\n\u003cp\u003e最初考虑过群晖、威联通之类的品牌 NAS ，如果能得到更好的使用体验，多花点钱也是可以的。但是看过硬件规格后，感觉我要是以这个价格买了，那就算人生的污点了。\u003c/p\u003e\n\u003cp\u003e所以开始准备攒机，按优先级列举一下要求：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e美观，不要傻大黑粗的直男风。\u003c/li\u003e\n\u003cli\u003e体积小。\u003c/li\u003e\n\u003cli\u003e兼顾功耗和性能。\u003c/li\u003e\n\u003cli\u003e内存大（16 ~ 32 G）。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e先后拟了 4 套配置，和某淘宝店的套装做了一下对比：\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth style=\"text-align: center\"\u003e-\u003c/th\u003e\n          \u003cth\u003e淘宝店方案\u003c/th\u003e\n          \u003cth\u003e价格\u003c/th\u003e\n          \u003cth\u003e方案 1\u003c/th\u003e\n          \u003cth\u003e价格\u003c/th\u003e\n          \u003cth\u003e方案 2\u003c/th\u003e\n          \u003cth\u003e价格\u003c/th\u003e\n          \u003cth\u003e方案 3\u003c/th\u003e\n          \u003cth\u003e价格\u003c/th\u003e\n          \u003cth\u003e方案 4\u003c/th\u003e\n          \u003cth\u003e价格\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e机箱\u003c/td\u003e\n          \u003ctd\u003e万由 410\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e万由 410\u003c/td\u003e\n          \u003ctd\u003e680\u003c/td\u003e\n          \u003ctd\u003e迎广 MS04\u003c/td\u003e\n          \u003ctd\u003e930\u003c/td\u003e\n          \u003ctd\u003e蜗牛星际B涂装改风扇\u003c/td\u003e\n          \u003ctd\u003e275\u003c/td\u003e\n          \u003ctd\u003e蜗牛星际B涂装改风扇\u003c/td\u003e\n          \u003ctd\u003e275\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e电源\u003c/td\u003e\n          \u003ctd\u003e益衡 200W\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e益衡 7025B\u003c/td\u003e\n          \u003ctd\u003e236\u003c/td\u003e\n          \u003ctd\u003e机箱内置\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e益衡 7025B\u003c/td\u003e\n          \u003ctd\u003e236\u003c/td\u003e\n          \u003ctd\u003e益衡 7025B\u003c/td\u003e\n          \u003ctd\u003e236\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e主板\u003c/td\u003e\n          \u003ctd\u003eB365-ITX 定制工控板\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e华擎 Z390M-ITX/ac\u003c/td\u003e\n          \u003ctd\u003e1199\u003c/td\u003e\n          \u003ctd\u003e华擎 Z390M-ITX/ac\u003c/td\u003e\n          \u003ctd\u003e1199\u003c/td\u003e\n          \u003ctd\u003e华擎 Z390M-ITX/ac\u003c/td\u003e\n          \u003ctd\u003e1199\u003c/td\u003e\n          \u003ctd\u003e华擎 Z390M-ITX/ac（二）\u003c/td\u003e\n          \u003ctd\u003e700\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003eCPU\u003c/td\u003e\n          \u003ctd\u003eI5-8600T\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003eI5-8600T\u003c/td\u003e\n          \u003ctd\u003e825\u003c/td\u003e\n          \u003ctd\u003eI5-8600T\u003c/td\u003e\n          \u003ctd\u003e825\u003c/td\u003e\n          \u003ctd\u003eI5-8600T\u003c/td\u003e\n          \u003ctd\u003e825\u003c/td\u003e\n          \u003ctd\u003eI5-8600T\u003c/td\u003e\n          \u003ctd\u003e825\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e散热器\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003eAVC 28mm 115X\u003c/td\u003e\n          \u003ctd\u003e23\u003c/td\u003e\n          \u003ctd\u003eAVC 28mm 115X\u003c/td\u003e\n          \u003ctd\u003e23\u003c/td\u003e\n          \u003ctd\u003eAVC 28mm 115X\u003c/td\u003e\n          \u003ctd\u003e23\u003c/td\u003e\n          \u003ctd\u003eAVC 28mm 115X\u003c/td\u003e\n          \u003ctd\u003e23\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e内存\u003c/td\u003e\n          \u003ctd\u003e镁光 DDR4 16G 2666\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e光威 DDR4 2666 16G\u003c/td\u003e\n          \u003ctd\u003e379\u003c/td\u003e\n          \u003ctd\u003e光威 DDR4 2666 16G\u003c/td\u003e\n          \u003ctd\u003e379\u003c/td\u003e\n          \u003ctd\u003e光威 DDR4 2666 16G\u003c/td\u003e\n          \u003ctd\u003e379\u003c/td\u003e\n          \u003ctd\u003e海盗船 DDR4 3000 16G×2（二）\u003c/td\u003e\n          \u003ctd\u003e700\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e总计\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e2999\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e3342\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e3356\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e2937\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003e2759\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e最后选了第 4 种。\u003c/p\u003e","title":"我的第一台 NAS"},{"content":"我希望找到一种体验较好的方式，把两部手机和索尼黑卡上的照片集中同步到 NAS 上交由 PhotoPrism 托管。\n需求如下：\n可以方便地发送多平台照片到 NAS 。 可以单向同步手机到 NAS 并忽略手机的删除操作，以节省手机的存储空间。 可以实现内网穿透且简单稳定。 便宜。 对比了 PhotoSync 、 Resilio Sync 、 Syncthing 和微力同步（verysync）。\nPhotoSync 作为专门针对同步照片的场景设计的 APP ，完美覆盖前两点，第三点可以借助 NAS 已经配置好的内网穿透实现，但是需要购买相应的 Plan ，而且 Android 和 iOS 平台要各自单独购买。\nResilio Sync 实现内网穿透需要引入新的依赖关系，不完全满足第三点。\nSyncthing 看起来不错，但是没有官方的 iOS 客户端。\n微力同步据说是基于 Syncthing 的，且补上了后者缺失的一环。各平台免费，只有 iOS 上需要花 12￥ 买 APP 。\n我的 NAS 运行的是 Unraid ， Community Applications 里没有微力同步，在这里找到了别人配置好的模板，部署很方便。\n试用后因为太好用，干脆把 Dropbox 目录也放到微力同步里，卸载了会占用很多内存且免费方案 3 个端的限制早已捉襟见肘的 Dropbox 。\n","permalink":"http://0x3f.org/posts/replace-dropbox-with-verysync/","summary":"\u003cp\u003e我希望找到一种体验较好的方式，把两部手机和索尼黑卡上的照片集中同步到 NAS 上交由 PhotoPrism 托管。\u003c/p\u003e\n\u003cp\u003e需求如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e可以方便地发送多平台照片到 NAS 。\u003c/li\u003e\n\u003cli\u003e可以单向同步手机到 NAS 并忽略手机的删除操作，以节省手机的存储空间。\u003c/li\u003e\n\u003cli\u003e可以实现内网穿透且简单稳定。\u003c/li\u003e\n\u003cli\u003e便宜。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e对比了 PhotoSync 、 Resilio Sync 、 Syncthing 和微力同步（verysync）。\u003c/p\u003e\n\u003cp\u003ePhotoSync 作为专门针对同步照片的场景设计的 APP ，完美覆盖前两点，第三点可以借助 NAS 已经配置好的内网穿透实现，但是需要购买相应的 Plan ，而且 Android 和 iOS 平台要各自单独购买。\u003c/p\u003e\n\u003cp\u003eResilio Sync 实现内网穿透需要引入新的依赖关系，不完全满足第三点。\u003c/p\u003e\n\u003cp\u003eSyncthing 看起来不错，但是没有官方的 iOS 客户端。\u003c/p\u003e\n\u003cp\u003e微力同步据说是基于 Syncthing 的，且补上了后者缺失的一环。各平台免费，只有 iOS 上需要花 12￥ 买 APP 。\u003c/p\u003e\n\u003cp\u003e我的 NAS 运行的是 Unraid ， Community Applications 里没有微力同步，在\u003ca href=\"https://github.com/shuosiw/unraid\"\u003e这里\u003c/a\u003e找到了别人配置好的模板，部署很方便。\u003c/p\u003e\n\u003cp\u003e试用后因为太好用，干脆把 Dropbox 目录也放到微力同步里，卸载了会占用很多内存且免费方案 3 个端的限制早已捉襟见肘的 Dropbox 。\u003c/p\u003e","title":"用微力同步换掉了 Dropbox"},{"content":"我使用部署在 NAS 中的 qBittorrent 下载资源，每次手动复制磁力链链接到 qBittorrent 的 WebUI 很麻烦。\nRemote Torrent Adder 是 Chrome 的扩展，可以通过右键菜单把 magnet 等协议的链接发送到多种下载工具，其中就包括 qBittorrent 。\n安装过程不是那么顺利，这个开源小工具并没有对用户体验做更多的优化。\n首先初次安装后，配置界面会有一个初始的、针对 Vuze SwingUI 的配置，需要把它删掉，再添加针对 qBittorrent v4.1+ WebUI 的配置，填好各项配置后选中 Label/Directory interactivity 复选框。因为我把电影和剧集分目录存放，开始下载前需要指定存储目录。\n第一次点菜单的时候没有反应，后来刷新页面后就好了。但是弹出来的指定下载目录的对话框没有选项，经测试发现第一次需要手工填写，之后有了缓存就可以选了。\n","permalink":"http://0x3f.org/posts/take-remote-torrent-adder-as-client-of-qbittorrent/","summary":"\u003cp\u003e我使用部署在 NAS 中的 qBittorrent 下载资源，每次手动复制磁力链链接到 qBittorrent 的 WebUI 很麻烦。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://chrome.google.com/webstore/detail/remote-torrent-adder/oabphaconndgibllomdcjbfdghcmenci?hl=zh-CN\"\u003eRemote Torrent Adder\u003c/a\u003e 是 Chrome 的扩展，可以通过右键菜单把 magnet 等协议的链接发送到多种下载工具，其中就包括 qBittorrent 。\u003c/p\u003e\n\u003cp\u003e安装过程不是那么顺利，这个开源小工具并没有对用户体验做更多的优化。\u003c/p\u003e\n\u003cp\u003e首先初次安装后，配置界面会有一个初始的、针对 Vuze SwingUI 的配置，需要把它删掉，再添加针对 qBittorrent v4.1+ WebUI 的配置，填好各项配置后选中 \u003cstrong\u003eLabel/Directory\ninteractivity\u003c/strong\u003e 复选框。因为我把电影和剧集分目录存放，开始下载前需要指定存储目录。\u003c/p\u003e\n\u003cp\u003e第一次点菜单的时候没有反应，后来刷新页面后就好了。但是弹出来的指定下载目录的对话框没有选项，经测试发现第一次需要手工填写，之后有了缓存就可以选了。\u003c/p\u003e","title":"使用 Remote Torrent Adder 做 qBittorrent 的客户端"},{"content":"zsh-autoenv 可以实现当进入特定的目录时加载特定的 zshrc 文件，并当切换到其它目录时取消其中的变更。后者在当前的版本下，对环境变量、命令别名和函数有效。\n使用方法为：\n在目录（如 ~/project ）下创建文件 .autoenv.zsh :\n1 2 3 4 5 6 7 8 autostash TEST_VAR=\u0026#39;This is a test variable.\u0026#39; autostash alias test_cmd=\u0026#39;echo \u0026#34;This is a test alias.\u0026#34;\u0026#39; autostash test_func test_func() { echo \u0026#34;This is a test function.\u0026#34; } 出于安全考虑， zsh-autoenv 会对 .autoenv.zsh 做哈希校验，所以第一次或者做变动后进入该目录时，都会要求确认是否接受此文件最新的内容。\n此外，如果进入的目录不存在 .autoenv.zsh， zsh-autoenv 会自动向上查找最近的同名文件并加载，上溯的层级可以通过配置项定义。\n最后，它提供了一个命令 autoenv-edit 用来快速打开和编辑 .autoenv.zsh 文件。\n","permalink":"http://0x3f.org/posts/implement-directory-specific-zshrc-with-zsh-autoenv/","summary":"\u003cp\u003e\u003ca href=\"https://github.com/Tarrasch/zsh-autoenv\"\u003ezsh-autoenv\u003c/a\u003e 可以实现当进入特定的目录时加载特定的 zshrc 文件，并当切换到其它目录时取消其中的变更。后者在当前的版本下，对环境变量、命令别名和函数有效。\u003c/p\u003e\n\u003cp\u003e使用方法为：\u003c/p\u003e\n\u003cp\u003e在目录（如 \u003ccode\u003e~/project\u003c/code\u003e ）下创建文件 \u003ccode\u003e.autoenv.zsh\u003c/code\u003e :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-zsh\" data-lang=\"zsh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eautostash \u003cspan class=\"nv\"\u003eTEST_VAR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;This is a test variable.\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eautostash \u003cspan class=\"nb\"\u003ealias\u003c/span\u003e \u003cspan class=\"nv\"\u003etest_cmd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;echo \u0026#34;This is a test alias.\u0026#34;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eautostash test_func\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etest_func\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;This is a test function.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e出于安全考虑， zsh-autoenv 会对 \u003ccode\u003e.autoenv.zsh\u003c/code\u003e 做哈希校验，所以第一次或者做变动后进入该目录时，都会要求确认是否接受此文件最新的内容。\u003c/p\u003e\n\u003cp\u003e此外，如果进入的目录不存在 \u003ccode\u003e.autoenv.zsh\u003c/code\u003e， zsh-autoenv 会自动向上查找最近的同名文件并加载，上溯的层级可以通过配置项定义。\u003c/p\u003e\n\u003cp\u003e最后，它提供了一个命令 \u003ccode\u003eautoenv-edit\u003c/code\u003e 用来快速打开和编辑 \u003ccode\u003e.autoenv.zsh\u003c/code\u003e 文件。\u003c/p\u003e","title":"用 zsh-autoenv 实现目录级别的 zshrc"},{"content":"利用 PHPUnit 9.x 的 extension 特性，可以记录每个测试用例的耗时并存储到 CSV 文件中。\nExtension 代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;?php declare(strict_types=1); namespace Tests; use PHPUnit\\Runner\\AfterTestHook; class LongRunningTestsLogger implements AfterTestHook { public function __construct(private string $log_file) { } public function executeAfterTest(string $test, float $time): void { $fp = fopen($this-\u0026gt;log_file . \u0026#39;.csv\u0026#39;, \u0026#39;a\u0026#39;); fputcsv($fp, [$test, $time]); fclose($fp); } } phpunit.xml 的配置：\n1 2 3 4 5 6 7 \u0026lt;extensions\u0026gt; \u0026lt;extension class=\u0026#34;Tests\\LongRunningTestsLogger\u0026#34;\u0026gt; \u0026lt;arguments\u0026gt; \u0026lt;string\u0026gt;profiling\u0026lt;/string\u0026gt; \u0026lt;/arguments\u0026gt; \u0026lt;/extension\u0026gt; \u0026lt;/extensions\u0026gt; ","permalink":"http://0x3f.org/posts/method-for-phpunit-9.x-performance-analysis/","summary":"\u003cp\u003e利用 PHPUnit 9.x 的 extension 特性，可以记录每个测试用例的耗时并存储到 CSV 文件中。\u003c/p\u003e\n\u003cp\u003eExtension 代码：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estrict_types\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nx\"\u003eTests\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003ePHPUnit\\Runner\\AfterTestHook\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongRunningTestsLogger\u003c/span\u003e \u003cspan class=\"k\"\u003eimplements\u003c/span\u003e \u003cspan class=\"nx\"\u003eAfterTestHook\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__construct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e \u003cspan class=\"nv\"\u003e$log_file\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAfterTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estring\u003c/span\u003e \u003cspan class=\"nv\"\u003e$test\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003efloat\u003c/span\u003e \u003cspan class=\"nv\"\u003e$time\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003elog_file\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;.csv\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003efputcsv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$test\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$time\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003efclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ephpunit.xml 的配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;extensions\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026lt;extension\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Tests\\LongRunningTestsLogger\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nt\"\u003e\u0026lt;arguments\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003eprofiling\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nt\"\u003e\u0026lt;/arguments\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nt\"\u003e\u0026lt;/extension\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;/extensions\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"PHPUnit 9.x 性能分析的方法"},{"content":"问题的场景是，以 http 用户运行的 FPM 进程访问 /tmp 下由普通用户运行的 CLI 进程创建的文件时，报如下错误：\nFailed to open stream.\n原因是 PHP-FPM 的 systemd 配置中默认对 FPM 进程单独挂载 /tmp 目录。\n具体对应：\n/usr/lib/systemd/system/php-fpm.service\n中的：\nPrivateTmp=true\n","permalink":"http://0x3f.org/posts/php-failed-to-open-stream-under-tmp-in-archlinux/","summary":"\u003cp\u003e问题的场景是，以 http 用户运行的 FPM 进程访问 \u003ccode\u003e/tmp\u003c/code\u003e 下由普通用户运行的 CLI 进程创建的文件时，报如下错误：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFailed to open stream.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e原因是 PHP-FPM 的 systemd 配置中默认对 FPM 进程单独挂载 \u003ccode\u003e/tmp\u003c/code\u003e 目录。\u003c/p\u003e\n\u003cp\u003e具体对应：\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e/usr/lib/systemd/system/php-fpm.service\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e中的：\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePrivateTmp=true\u003c/code\u003e\u003c/p\u003e","title":"Archlinux 下 PHP 不能读取 /tmp 下文件的问题"},{"content":"Archlinux 使用 systemd-tmpfiles 管理 /var/run 下的临时目录。这意味着如果我手动创建 /var/run/php 目录，在系统重启后将不复存在。\n解决的办法是修改 /usr/lib/tmpfiles.d/php-fpm.conf 文件，把默认的目录名 php-fpm 改成 php。\n但这会带来另一个问题，当 PHP 被重装或升级后，该文件会被覆盖。所以，解决的方法是复制后再修改。\n","permalink":"http://0x3f.org/posts/create-directory-under-/var/run-in-archlinux/","summary":"\u003cp\u003eArchlinux 使用 \u003ca href=\"https://wiki.archlinux.org/title/systemd#systemd-tmpfiles_-_temporary_files\"\u003esystemd-tmpfiles\u003c/a\u003e 管理 \u003ccode\u003e/var/run\u003c/code\u003e 下的临时目录。这意味着如果我手动创建 \u003ccode\u003e/var/run/php\u003c/code\u003e 目录，在系统重启后将不复存在。\u003c/p\u003e\n\u003cp\u003e解决的办法是修改 \u003ccode\u003e/usr/lib/tmpfiles.d/php-fpm.conf\u003c/code\u003e 文件，把默认的目录名 \u003ccode\u003ephp-fpm\u003c/code\u003e 改成 \u003ccode\u003ephp\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e但这会带来另一个问题，当 PHP 被重装或升级后，该文件会被覆盖。所以，解决的方法是复制后再修改。\u003c/p\u003e","title":"Archlinux 下在 /var/run 下创建目录的方法"},{"content":"尽管我用东西很爱惜，QC35 的耳罩表面在前年也开始了剥落，并终于在今年早些时候裂开了。\n了解到官方耳罩太贵（380￥左右），而且就这四年的使用情况而言，质量一般。所以打算买第三方的自己换。最终在淘宝上买了排序靠前、35包邮的蛋白皮款。\n安装过程比较简单（官方说明），把旧耳罩扯下来，再把新的耳罩的包边逐个塞到耳机的卡扣里就行，就是容易边塞边松脱。\n替换前后：\n用了两天，不管是外观还是材质，和原装没有区别。\n作为易耗品，以后可以考虑在阿里巴巴上买，更便宜。\n","permalink":"http://0x3f.org/posts/change-muffs-for-bose-qc35/","summary":"\u003cp\u003e尽管我用东西很爱惜，QC35 的耳罩表面在前年也开始了剥落，并终于在今年早些时候裂开了。\u003c/p\u003e\n\u003cp\u003e了解到官方耳罩太贵（380￥左右），而且就这四年的使用情况而言，质量一般。所以打算买第三方的自己换。最终在淘宝上买了排序靠前、35包邮的蛋白皮款。\u003c/p\u003e\n\u003cp\u003e安装过程比较简单（\u003ca href=\"https://www.bose.cn/zh_cn/support/article/ear-cushion-replacement-qc25.html\"\u003e官方说明\u003c/a\u003e），把旧耳罩扯下来，再把新的耳罩的包边逐个塞到耳机的卡扣里就行，就是容易边塞边松脱。\u003c/p\u003e\n\u003cp\u003e替换前后：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-10-04-18-59-53-IMG_7891.jpg\" alt=\"IMG_7891\"\u003e\u003c/p\u003e\n\u003cp\u003e用了两天，不管是外观还是材质，和原装没有区别。\u003c/p\u003e\n\u003cp\u003e作为易耗品，以后可以考虑在阿里巴巴上买，更便宜。\u003c/p\u003e","title":"给 Bose QC35 更换新耳罩"},{"content":"前几天发现因为 Hugo 的不兼容更新导致我在用的主题在部署时报错，所以打算装回旧版。但是网上找到的 Homebrew 回滚方法已过时，新的方法更简单，但找到具体说明也费了点功夫。\n以回滚 Hugo 到 0.74.3 为例：\n1 2 3 4 brew uninstall hugo brew tap-new donie/hugo-0-74-3 brew extract --version 0.74.3 hugo donie/hugo-0-74-3 brew install hugo@0.74.3 即：先创建一个名为“donie/hugo-0-74-3”的 tap ，然后通过 extract 命令把相应版本的数据放到里面，就可以安装了。\n","permalink":"http://0x3f.org/posts/rollback-to-old-version-with-homebrew/","summary":"\u003cp\u003e前几天发现因为 Hugo 的不兼容更新导致我在用的主题在部署时报错，所以打算装回旧版。但是网上找到的 Homebrew 回滚方法已过时，新的方法更简单，但找到具体说明也费了点功夫。\u003c/p\u003e\n\u003cp\u003e以回滚 Hugo 到 0.74.3 为例：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebrew uninstall hugo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebrew tap-new donie/hugo-0-74-3\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebrew extract --version 0.74.3 hugo donie/hugo-0-74-3\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebrew install hugo@0.74.3\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e即：先创建一个名为“donie/hugo-0-74-3”的 tap ，然后通过 extract 命令把相应版本的数据放到里面，就可以安装了。\u003c/p\u003e","title":"使用 Homebrew 安装旧版程序"},{"content":"久坐疲劳，所以打算买个升降台。\n乐歌 M3S 我是个颜党，在所有有白色款的型号里，先选中了造型简约的乐歌 M3S。\n实物很重，虽然有些地方稍显粗糙（比如平板插槽底部很粗犷地用热熔胶粘合），但是整体上做工扎实。\n但是试用之后发现一个很严重的问题，Z 形结构虽然美观，但是不够稳定，敲键盘时用力一点就会有明显晃动。\n乐歌 M9S 一开始没有把 X 形结构当做首选是因为感觉不太好看。重新审视后感觉 M9S 观感尚可。\n实物证明，虽然 X 形结构的美感不如 Z 形，但是稳定性远胜后者。\nM9S 的另一个优点是可以把笔记本电脑放在键盘托上使用。\n当然家里使用还是电动升降桌更好，毕竟桌子上摆这么个庞然大物显得很突兀，而且丧失了其它功能。升降台更适合办公室。\n","permalink":"http://0x3f.org/posts/a-trial-on-standing-desk/","summary":"\u003cp\u003e久坐疲劳，所以打算买个升降台。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"乐歌-m3s\"\u003e乐歌 M3S\u003c/h2\u003e\n\u003cp\u003e我是个颜党，在所有有白色款的型号里，先选中了造型简约的乐歌 M3S。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-10-02-20-44-40-BE042D7B-24E5-4BFD-A68C-08117A858CE0_1_105_c.jpeg\" alt=\"BE042D7B-24E5-4BFD-A68C-08117A858CE0_1_105_c\"\u003e\u003c/p\u003e\n\u003cp\u003e实物很重，虽然有些地方稍显粗糙（比如平板插槽底部很粗犷地用热熔胶粘合），但是整体上做工扎实。\u003c/p\u003e\n\u003cp\u003e但是试用之后发现一个很严重的问题，Z 形结构虽然美观，但是不够稳定，敲键盘时用力一点就会有明显晃动。\u003c/p\u003e\n\u003ch2 id=\"乐歌-m9s\"\u003e乐歌 M9S\u003c/h2\u003e\n\u003cp\u003e一开始没有把 X 形结构当做首选是因为感觉不太好看。重新审视后感觉 M9S 观感尚可。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-10-02-20-54-50-EB634356-7F03-439D-BC6D-F3CE22C34FCF_1_105_c.jpeg\" alt=\"EB634356-7F03-439D-BC6D-F3CE22C34FCF_1_105_c\"\u003e\u003c/p\u003e\n\u003cp\u003e实物证明，虽然 X 形结构的美感不如 Z 形，但是稳定性远胜后者。\u003c/p\u003e\n\u003cp\u003eM9S 的另一个优点是可以把笔记本电脑放在键盘托上使用。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e当然家里使用还是电动升降桌更好，毕竟桌子上摆这么个庞然大物显得很突兀，而且丧失了其它功能。升降台更适合办公室。\u003c/p\u003e","title":"买了个升降台，开始站立办公"},{"content":"讯飞的中文语音识别做得很好，十几年前在学校的一次讲座上就见识过讯飞的语音技术，印象深刻。录音笔结合语音识别是现在的一个趋势，把一个比较专业向的工具推向普及，做好了可以是个很有用的效率工具。我曾经跟一些产品经理讲过，如果我是他们，就买一个录音笔，无论是收集、讨论还是评审需求，都是个很好的工具，不至于丢三落四、误人误己。\n讯飞的录音笔包含终身免费的转写服务，是个很吸引人的点。这次试用了 A1 和 SR101 两款，谈谈感受。\n无处安放的 A1 优点 工业设计很有特点，外形模仿磁带，附带贴纸，既怀旧又酷炫，属于数码潮玩向的东西。 体积小巧，火柴盒大小。 录音效果明显好于 iPhone X。 特点 通过蓝牙和手机传输数据，交互很流畅。 缺点 不支持待机，5分钟无操作自动关机，不适合做备忘。 录音过程中不支持做标记，所以不适合做会议记录。 有安全隐患，手机可以不经授权连接并读取录音笔里的数据。 总结 几乎完全不满足我的使用场景，所以无处安放。感觉如果能增加标记功能和实现一键录音就值得一用。\n五脏俱全但囿于软件的 SR101 优点 工业设计年轻时尚。 支持待机、标记、一键录音。 有屏幕，更方便。 缺点 通过触屏做标记，误操作的机率很大，影响效率。 待机状态下，一键录音有3秒左右的等待时间。 录音数据通过云盘和手机 APP 同步，等待时间超过 A1 很多，极其影响体验。 录音效果不如 A1。 总结 功能覆盖我的所有需求，但是体验总是离及格线差那么一点。\n讯飞在中文语音识别这个核心技术上的成就勿庸置疑，但是它的产品总是在体验上做得差一点。我用过的讯飞产品里，手机输入法是最接近满意分数线的，但是它的动图搜索功能真的是很反人类，交互很繁复。\n这两款录音笔各自有独特的点、有吸引人的地方，但是最大的短板在软件的体验上，导致不太适合把它们当成效率工具。基于这个出发点，我云了几个设想：\n允许自动转写，目前只能逐条手工操作转写，如果录音较多，会不厌其烦。 做开放平台，和 IFTTT 之类的服务打通。 支持 iOS Shortcuts 之类的效率工具。 ","permalink":"http://0x3f.org/posts/a-trial-on-iflytec-a1-and-sr101-voice-recorder/","summary":"\u003cp\u003e讯飞的中文语音识别做得很好，十几年前在学校的一次讲座上就见识过讯飞的语音技术，印象深刻。录音笔结合语音识别是现在的一个趋势，把一个比较专业向的工具推向普及，做好了可以是个很有用的效率工具。我曾经跟一些产品经理讲过，如果我是他们，就买一个录音笔，无论是收集、讨论还是评审需求，都是个很好的工具，不至于丢三落四、误人误己。\u003c/p\u003e\n\u003cp\u003e讯飞的录音笔包含终身免费的转写服务，是个很吸引人的点。这次试用了 A1 和 SR101 两款，谈谈感受。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"无处安放的-a1\"\u003e无处安放的 A1\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-09-30-19-12-38-image-20200930191237542.png\" alt=\"image-20200930191237542\"\u003e\u003c/p\u003e\n\u003ch3 id=\"优点\"\u003e优点\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e工业设计很有特点，外形模仿磁带，附带贴纸，既怀旧又酷炫，属于数码潮玩向的东西。\u003c/li\u003e\n\u003cli\u003e体积小巧，火柴盒大小。\u003c/li\u003e\n\u003cli\u003e录音效果明显好于 iPhone X。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"特点\"\u003e特点\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e通过蓝牙和手机传输数据，交互很流畅。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"缺点\"\u003e缺点\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e不支持待机，5分钟无操作自动关机，不适合做备忘。\u003c/li\u003e\n\u003cli\u003e录音过程中不支持做标记，所以不适合做会议记录。\u003c/li\u003e\n\u003cli\u003e有安全隐患，手机可以不经授权连接并读取录音笔里的数据。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"总结\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e几乎完全不满足我的使用场景，所以无处安放。感觉如果能增加标记功能和实现一键录音就值得一用。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"五脏俱全但囿于软件的-sr101\"\u003e五脏俱全但囿于软件的 SR101\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-09-30-19-01-35-b450e9378bc7479bbc038ed3861c6d1a.jpg\" alt=\"讯飞智能录音笔SR101\"\u003e\u003c/p\u003e\n\u003ch3 id=\"优点-1\"\u003e优点\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e工业设计年轻时尚。\u003c/li\u003e\n\u003cli\u003e支持待机、标记、一键录音。\u003c/li\u003e\n\u003cli\u003e有屏幕，更方便。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"缺点-1\"\u003e缺点\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e通过触屏做标记，误操作的机率很大，影响效率。\u003c/li\u003e\n\u003cli\u003e待机状态下，一键录音有3秒左右的等待时间。\u003c/li\u003e\n\u003cli\u003e录音数据通过云盘和手机 APP 同步，等待时间超过 A1 很多，极其影响体验。\u003c/li\u003e\n\u003cli\u003e录音效果不如 A1。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"总结-1\"\u003e总结\u003c/h3\u003e\n\u003cp\u003e功能覆盖我的所有需求，但是体验总是离及格线差那么一点。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e讯飞在中文语音识别这个核心技术上的成就勿庸置疑，但是它的产品总是在体验上做得差一点。我用过的讯飞产品里，手机输入法是最接近满意分数线的，但是它的动图搜索功能真的是很反人类，交互很繁复。\u003c/p\u003e\n\u003cp\u003e这两款录音笔各自有独特的点、有吸引人的地方，但是最大的短板在软件的体验上，导致不太适合把它们当成效率工具。基于这个出发点，我云了几个设想：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e允许自动转写，目前只能逐条手工操作转写，如果录音较多，会不厌其烦。\u003c/li\u003e\n\u003cli\u003e做开放平台，和 IFTTT 之类的服务打通。\u003c/li\u003e\n\u003cli\u003e支持 iOS Shortcuts 之类的效率工具。\u003c/li\u003e\n\u003c/ul\u003e","title":"试用讯飞 A1 和 SR101 录音笔"},{"content":"数据库事务的一致性 数据库事务有四个特性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability），简称“ACID”。\n其中，“一致性”指的是数据库层面的一致性，与应用层面的一致性不同。\n数据库层面的一致性是说，事务具备把数据库从一个正确的状态迁移到另一个正确的状态的特性。所谓正确的状态，是指任何写入数据库的数据都满足数据库既定的规则，这些规则包括各种约束、级联回滚、触发器以及任何它们的组合。\n与数据库层面的一致性不同，应用层面的一致性要求保证结果的正确性。例如，当执行如下 SQL 语句时：\n1 update accounts set balance = balance + 1 where id = 3 我希望最终的结果是在事务开始时 id = 3 的这行数据 balance 列的值的基础上加一，否则，结果就是不正确的。\n因此，只要写入的数据满足数据库的规则，就保证了数据库层面的一致性。数据库层面的一致性并不保证数据正确1。\nMySQL 事务的隔离级别与幻读问题 隔离级别 隔离性是指：多个事务并发执行时，每个事务对数据库所做的更改必须与其它事务隔离。\n隔离性是并发控制的主要目标2，并发控制用来实现在保证应用层面一致性的前提下，尽可能快地对并发请求做出响应。由此可见，隔离性和并发能力是一对此消彼长的关系。极端情况下，如果并发的请求按顺序执行，隔离性是最好的，但是响应最慢，反之亦然。\n在此基础上，产生了四个隔离级别的划分。由低到高依次为：读未提交、读已提交、可重复读、序列化。据前所述，它们的并发能力是依次下降的。\n因此，隔离级别的本质是通过适度地破坏隔离性来提高并发能力。\n隔离级别的问题 隔离级别不同，存在的问题也不一样。\n“读未提交”的级别最低、并发能力最高，存在的问题也最多，包括：脏读、不可重复读、幻读。其中，脏读是这个级别独有的，即事务 A 读取了并发事务 B 未提交的数据。\n“读已提交”顾名思义，事务 A 不会读取并发事务 B 未提交的数据，但可以读取其已提交的。因此，这个级别存在不可重复读和幻读的问题。\n在“可重复读”级别下，同一事务中两次同样的查询结果一致，不会受并发事务的影响，它因此也解决了不可重复读的问题。但还会存在幻读问题。\n“序列化”级别要求对查询的对象加范围锁并保持到事务结束，因此，它避免了幻读的问题。\n幻读问题（Phantom Reads） 幻读问题是个很 tricky 的问题，以至于网上找到的很多文章对它的理解都是不全面甚至是错误的。\n幻读即同一事务中两次相同查询的结果集不一致。乍一看，好像和不可重复读是一样的。那它们的区别是什么呢？\n事实上，幻读是不可重复读的一种特殊情况。换句话说，只要存在幻行（Phantom Rows），就是幻读问题。\n所谓幻行，即同一事务中两次相同的查询结果集的非空差集里的元素，或者说第二次查询后发现不存在于前一次结果集中的行。\n幻行产生的原因主要是除“序列化”之外的隔离级别不要求对查询结果加范围锁，导致并发事务在查询范围内插入新的行后被当前事务查到。\nMVCC 在此基础上，MySQL 的 InnoDB 引擎实现了“多版本并发控制”（MVCC: Multiversion Concurrency Control）。\n简单地说，InnoDB 的表存在两个隐藏列，用于记录每行数据的版本信息。当插入一行数据时，InnoDB 将当前事务的版本信息一并写入。当修改一行数据时，InnoDB 先将该行做一次复制，并把当前版本信息写入进去。查询时，只返回版本小于等于当前事务版本的数据。通过这样保证一个事务中查询到的是事务开始前已经存在的数据或当前事务写入的数据。其它事务写入的数据则不会被读取。\n从这个意义上讲，InnoDB 通过 MVCC 解决了这种幻读问题。\nNext-Key Lock 上述普通的 SELECT 查询属于 InnoDB 读操作的一种：快照读。此外，还存在一种“当前读”。快照读顾名思义读取的是快照中的内容，而当前读读取的是当前最新的数据。INSERT、DELETE、UPDATE、SELECT \u0026hellip; FOR UPDATE 都是当前读。\n因此，还存在一种特殊情况：\n以及另一种特殊情况：\n以上两种情况都是在有当前读操作时可能发生的幻读问题。这是 MVCC 无法解决的。\nInnoDB 用 Next-Key Lock 解决这种幻读问题。\nNext-Key Lock 实际上是记录锁（Record Lock）和间隙锁（Gap Lock）的结合。加锁规则如下：\nNext-Key Lock 的格式是左开右闭。例如：( 5, 9 ] 表示间隙 ( 5, 9 ) 的间隙锁和 9 的行锁。 对查询条件范围的“行和间隙”（如果存在）加锁。 对于等值查询： 对于唯一索引，Next-Key Lock 退化为行锁。 向右遍历至查询条件范围内最后一个值右侧节点时，若该节点不满足等值条件，Next-Key Lock 退化为间隙锁。 例如，users 表结构如下：\n列名 类型 索引 id bigint 唯一 age smallint 不唯一 表中的数据：\nid age 1 10 5 50 11 30 对于上述第一种问题，事务 A 中通过任何一种当前读操作 id = 3 的行（例如 INSERT），都会自动给这个索引值加记录锁。此时，事务 B 中再插入 id = 3 的数据时就会被阻塞。从而避免了这种幻读问题。\n对于第二种问题，事务 A 中对 age = 30 的数据加排他锁：\n1 select * from users where age = 30 for update 数据库会加 ( (10, 1), (30, 11) ] 和 ( (30, 11), (50, 5) ] 两个 Next-Key Lock 。注意，由于 InnoDB 使用 B+ 树存储索引，且对于辅助索引， B+ 树叶子节点存储的是索引值和主键值，所以这里间隙用 ( ( 头节点索引值, 头节点主键值 ), ( 尾节点索引值, 尾节点主键值 ) ) 表示。而且，由于 (30, 11) 右侧间隙的尾结点 (50, 5) 不满足等值条件，所以这个 Next-Key Lock 退化为间隙锁 ( (30, 11), (50, 5) ) 。\n此时，事务 B 更新 age = 30 的数据时将会被阻塞。也就避免了这种幻读问题。\n总结 InnoDB 通过 MVCC 解决了普通查询中的幻读问题，通过 Next-Key Lock 解决了当前读导致的幻读问题。\nhttps://en.wikipedia.org/wiki/Consistency_(database_systems)\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://en.wikipedia.org/wiki/ACID#Isolation\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"http://0x3f.org/posts/isolation-levels-and-phantom-reads-in-mysql/","summary":"\u003ch2 id=\"数据库事务的一致性\"\u003e数据库事务的一致性\u003c/h2\u003e\n\u003cp\u003e数据库事务有四个特性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability），简称“ACID”。\u003c/p\u003e\n\u003cp\u003e其中，“一致性”指的是数据库层面的一致性，与应用层面的一致性不同。\u003c/p\u003e\n\u003cp\u003e数据库层面的一致性是说，事务具备把数据库从一个正确的状态迁移到另一个正确的状态的特性。所谓正确的状态，是指任何写入数据库的数据都满足数据库既定的规则，这些规则包括各种约束、级联回滚、触发器以及任何它们的组合。\u003c/p\u003e\n\u003cp\u003e与数据库层面的一致性不同，应用层面的一致性要求保证结果的正确性。例如，当执行如下 SQL 语句时：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eupdate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eaccounts\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ebalance\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ebalance\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ewhere\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e我希望最终的结果是在事务开始时 id = 3 的这行数据 balance 列的值的基础上加一，否则，结果就是不正确的。\u003c/p\u003e\n\u003cp\u003e因此，只要写入的数据满足数据库的规则，就保证了数据库层面的一致性。\u003cstrong\u003e数据库层面的一致性并不保证数据正确\u003c/strong\u003e\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e。\u003c/p\u003e\n\u003ch2 id=\"mysql-事务的隔离级别与幻读问题\"\u003eMySQL 事务的隔离级别与幻读问题\u003c/h2\u003e\n\u003ch3 id=\"隔离级别\"\u003e隔离级别\u003c/h3\u003e\n\u003cp\u003e隔离性是指：多个事务并发执行时，每个事务对数据库所做的更改必须与其它事务隔离。\u003c/p\u003e\n\u003cp\u003e隔离性是并发控制的主要目标\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e，并发控制用来实现在保证应用层面一致性的前提下，尽可能快地对并发请求做出响应。由此可见，隔离性和并发能力是一对此消彼长的关系。极端情况下，如果并发的请求按顺序执行，隔离性是最好的，但是响应最慢，反之亦然。\u003c/p\u003e\n\u003cp\u003e在此基础上，产生了四个隔离级别的划分。由低到高依次为：读未提交、读已提交、可重复读、序列化。据前所述，它们的并发能力是依次下降的。\u003c/p\u003e\n\u003cp\u003e因此，\u003cstrong\u003e隔离级别的本质是通过适度地破坏隔离性来提高并发能力。\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"隔离级别的问题\"\u003e隔离级别的问题\u003c/h3\u003e\n\u003cp\u003e隔离级别不同，存在的问题也不一样。\u003c/p\u003e\n\u003cp\u003e“读未提交”的级别最低、并发能力最高，存在的问题也最多，包括：脏读、不可重复读、幻读。其中，脏读是这个级别独有的，即事务 A 读取了并发事务 B 未提交的数据。\u003c/p\u003e\n\u003cp\u003e“读已提交”顾名思义，事务 A 不会读取并发事务 B 未提交的数据，但可以读取其已提交的。因此，这个级别存在不可重复读和幻读的问题。\u003c/p\u003e\n\u003cp\u003e在“可重复读”级别下，同一事务中两次同样的查询结果一致，不会受并发事务的影响，它因此也解决了不可重复读的问题。但还会存在幻读问题。\u003c/p\u003e\n\u003cp\u003e“序列化”级别要求对查询的对象加范围锁并保持到事务结束，因此，它避免了幻读的问题。\u003c/p\u003e\n\u003ch3 id=\"幻读问题phantom-reads\"\u003e幻读问题（Phantom Reads）\u003c/h3\u003e\n\u003cp\u003e幻读问题是个很 tricky 的问题，以至于网上找到的很多文章对它的理解都是不全面甚至是错误的。\u003c/p\u003e\n\u003cp\u003e幻读即同一事务中两次相同查询的结果集不一致。乍一看，好像和不可重复读是一样的。那它们的区别是什么呢？\u003c/p\u003e\n\u003cp\u003e事实上，幻读是不可重复读的一种特殊情况。换句话说，\u003cstrong\u003e只要存在幻行（Phantom Rows），就是幻读问题\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e所谓幻行，即同一事务中两次相同的查询结果集的非空差集里的元素，或者说第二次查询后发现不存在于前一次结果集中的行。\u003c/p\u003e\n\u003cp\u003e幻行产生的原因主要是除“序列化”之外的隔离级别不要求对查询结果加范围锁，导致并发事务在查询范围内插入新的行后被当前事务查到。\u003c/p\u003e\n\u003ch4 id=\"mvcc\"\u003eMVCC\u003c/h4\u003e\n\u003cp\u003e在此基础上，MySQL 的 InnoDB 引擎实现了“多版本并发控制”（MVCC: Multiversion Concurrency Control）。\u003c/p\u003e\n\u003cp\u003e简单地说，InnoDB 的表存在两个隐藏列，用于记录每行数据的版本信息。当插入一行数据时，InnoDB 将当前事务的版本信息一并写入。当修改一行数据时，InnoDB 先将该行做一次复制，并把当前版本信息写入进去。查询时，只返回版本小于等于当前事务版本的数据。通过这样保证一个事务中查询到的是事务开始前已经存在的数据或当前事务写入的数据。其它事务写入的数据则不会被读取。\u003c/p\u003e","title":"MySQL 事务的一致性、隔离级别与幻读问题"},{"content":"\n生平第一次修电脑。\n17款的 MacBook Pro 13`，该有的问题全有——键盘随机连击或无反应、在桌面上放不平且触控板反馈很弱、疑似电池鼓包。\n用过 ThinkPad X200 和 X220，虽然屏幕很渣，但从来没出过问题。上一台电脑是 15 款的 MacBook Air，用了三年，也没事儿。只能说这届苹果不行。\nAPP 上预约的三里屯店，时间下午两点多。太古里门口和店门口分别出示了一次健康码。虽然是工作日、而且在疫情期间，店里人不多也不少，还是等了一会儿。\n常规的询问和联机检查，大概花了十几分钟，没有要求提供任何凭证。店员说因为键盘和电池都在一起，所以是要一块换的。时间上快则一天，慢则两三天，就能修好。\n第二天晚上九点半，接到一个陌生座机号码打来的电话，以为是营销电话，而且之前看过有说换键盘用了一周时间的帖子，所以没往这上面想，就没接。\n第三天晚上看手机电池健康状态的时候，偶然看到电脑的维修状态是已完成，才意识到，回电话过去果然是三里屯苹果商店，但是没人接。\n今天早上九点多，再次打过去，说是十点才营业。于是决定直接过去。\n交接需要出示身份证，花了几分钟验机，很快结束。期间问店员如果之后键盘再坏了怎么办，说是有一年保修期，而且因为批次不同的原因，换过的键盘不容易再出问题。暗笑，换个批次就能解决的话，新款何至于换回剪刀脚？！\n回家后用了一会儿，新键盘和触控板体验很棒，没有打油的阻尼感沁人心脾，发了条 tweet 说：找回了初恋的感觉。\n","permalink":"http://0x3f.org/posts/story-of-repairing-macbook-pro/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-26-23-36-49-%E4%B8%89%E9%87%8C%E5%B1%AF%E5%A4%AA%E5%8F%A4%E9%87%8C%E5%8D%97%E5%8C%BA.jpg\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003e生平第一次修电脑。\u003c/p\u003e\n\u003cp\u003e17款的 MacBook Pro 13`，该有的问题全有——键盘随机连击或无反应、在桌面上放不平且触控板反馈很弱、疑似电池鼓包。\u003c/p\u003e\n\u003cp\u003e用过 ThinkPad X200 和 X220，虽然屏幕很渣，但从来没出过问题。上一台电脑是 15 款的 MacBook Air，用了三年，也没事儿。只能说这届苹果不行。\u003c/p\u003e\n\u003cp\u003eAPP 上预约的三里屯店，时间下午两点多。太古里门口和店门口分别出示了一次健康码。虽然是工作日、而且在疫情期间，店里人不多也不少，还是等了一会儿。\u003c/p\u003e\n\u003cp\u003e常规的询问和联机检查，大概花了十几分钟，没有要求提供任何凭证。店员说因为键盘和电池都在一起，所以是要一块换的。时间上快则一天，慢则两三天，就能修好。\u003c/p\u003e\n\u003cp\u003e第二天晚上九点半，接到一个陌生座机号码打来的电话，以为是营销电话，而且之前看过有说换键盘用了一周时间的帖子，所以没往这上面想，就没接。\u003c/p\u003e\n\u003cp\u003e第三天晚上看手机电池健康状态的时候，偶然看到电脑的维修状态是已完成，才意识到，回电话过去果然是三里屯苹果商店，但是没人接。\u003c/p\u003e\n\u003cp\u003e今天早上九点多，再次打过去，说是十点才营业。于是决定直接过去。\u003c/p\u003e\n\u003cp\u003e交接需要出示身份证，花了几分钟验机，很快结束。期间问店员如果之后键盘再坏了怎么办，说是有一年保修期，而且因为批次不同的原因，换过的键盘不容易再出问题。暗笑，换个批次就能解决的话，新款何至于换回剪刀脚？！\u003c/p\u003e\n\u003cp\u003e回家后用了一会儿，新键盘和触控板体验很棒，没有打油的阻尼感沁人心脾，发了条 tweet 说：找回了初恋的感觉。\u003c/p\u003e","title":"MacBook Pro 维修记"},{"content":"一切源于我这个颜党的喜新厌旧。\n总想找到一个极简而不失现代感的主题，在这个过程中，发现越来越多比较贴近我口味的主题都是适配 Hugo 的。趁最近有时间，就换了过来。\n创建一个空站点 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 安装 hugo brew install hugo # 创建空站点 hugo new site Blog # 安装 LoveIt 主题 cd Blog git init git submodule add https://github.com/dillonzq/LoveIt.git themes/LoveIt cp -f themes/LoveIt/exampleSite/config.toml . # 配置 config.toml # 在本机预览效果 hugo server -D 写一篇新文章 1 hugo new posts/test.md Hugo 需要自己指定文章的相对路径和文件名，这一点不如 Hexo 自动化程度高。\n迁移文章 注意：以下命令和脚本仅适用于本博客，不加判断地使用可能会修改不需要变动的内容。\n统一文章后缀 历史原因，用过的文件后缀不止一种，这次把.mkd和.markdown统一成.md。\n1 rename -s .mkd .md -s .markdown .md * 删除不兼容的 Front Matter 1 gsed -i \u0026#39;/^type:\\s*post/d\u0026#39; * 修改不规范的 Front Matter 我用单分类、多标签的方式管理文章，所以以前都是把分类名直接写在categories:后面了，Hugo 要求必须使用连接符前缀另起一行。\n1 perl -pi -e \u0026#39;s/(?\u0026lt;=^categories:)/\\n-/g\u0026#39; * 也是因为历史的原因，有的文章没有日期时间，有的格式也不统一。Hugo 对日期时间的格式要求比较严格。这里把所有没有秒的时间后补全。\n1 perl -pi -e \u0026#39;s/(?\u0026lt;=^date:\\s\\d{4}-\\d{2}-\\d{2}\\s\\d{2}:\\d{2}$)/:00/g\u0026#39; * 替换文章摘要标签 Hugo 不允许“more”两侧有空格：\n1 gsed -ri \u0026#39;s/!-- more --/!--more--/g\u0026#39; * 补充和转换复杂内容 此外还有诸如日期时间缺失、转换 Octopress 标签到 Markdown 格式等问题，另外为了保持 Permalink 不变，准备每篇文章都补充一个Front Matter slug。所以写了一个 PHP 脚本：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 #!/usr/bin/env php \u0026lt;?php if ($argc \u0026lt; 2) { file_put_contents(\u0026#39;php://stderr\u0026#39;, \u0026#34;需输入一个合法的文件路径\\n\u0026#34;); exit(1); } for ($i=1; $i \u0026lt; $argc; $i++) { handle_file($argv[$i]); } function handle_file($filePath) { $content = file_get_contents($filePath); $lines = explode(\u0026#34;\\n\u0026#34;, $content); $isDateMissing = empty(preg_grep(\u0026#39;/^date:\\s*/\u0026#39;, $lines)); if ($isDateMissing) { append_date($filePath, $lines); } $isSlugMissing = empty(preg_grep(\u0026#39;/^slug:\\s/\u0026#39;, $lines)); if ($isSlugMissing) { append_slug($filePath, $lines); } convert_hexo_tags($lines); file_put_contents($filePath, implode(\u0026#34;\\n\u0026#34;, $lines)); } function append_date($filePath, \u0026amp;$lines) { // 获取文件名中的日期 $arr = []; preg_match(\u0026#39;/\\d{4}-\\d{2}-\\d{2}/\u0026#39;, basename($filePath), $arr); if (empty($arr)) { file_put_contents(\u0026#39;php://stderr\u0026#39;, \u0026#34;未能从文件名中找到日期\\n\u0026#34;); exit(1); } foreach ($lines as $idx =\u0026gt; $line) { if (strpos($line, \u0026#39;title:\u0026#39;) === 0) { $lines = array_merge( array_slice($lines, 0, $idx + 1), [\u0026#34;date: {$arr[0]} 00:00:00\u0026#34;], array_slice($lines, $idx + 1) ); break; } } } function append_slug($filePath, \u0026amp;$lines) { if (! preg_match(\u0026#39;/(?\u0026lt;=\\d{4}-\\d{2}-\\d{2}-).*(?=\\.)/\u0026#39;, basename($filePath), $matches)) { file_put_contents(\u0026#39;php://stderr\u0026#39;, \u0026#34;未能从文件名中找到slug\\n\u0026#34;); exit(1); } foreach ($lines as $idx =\u0026gt; $line) { if (strpos($line, \u0026#39;title:\u0026#39;) === 0) { $lines = array_merge( array_slice($lines, 0, $idx + 1), [\u0026#34;slug: \u0026#34; . str_replace(\u0026#39;-\u0026#39;, \u0026#39; \u0026#39;, $matches[0])], array_slice($lines, $idx + 1) ); break; } } } function convert_hexo_tags(\u0026amp;$lines) { foreach ($lines as $idx =\u0026gt; $line) { if (preg_match(\u0026#39;/(?\u0026lt;={%\\simg\\s).*(?=\\s\\d+\\s%})/\u0026#39;, $line, $matches) || preg_match(\u0026#39;/(?\u0026lt;={%\\simg\\s).*(?=\\s%})/\u0026#39;, $line, $matches) ) { $lines[$idx] = \u0026#34;![]({$matches[0]})\u0026#34;; } if (preg_match(\u0026#39;/(?\u0026lt;={%\\scodeblock\\slang:).*(?=\\s[a-zA-Z0-9.]+\\s%})/\u0026#39;, $line, $matches) || preg_match(\u0026#39;/(?\u0026lt;={%\\scodeblock\\slang:).*(?=\\s%})/\u0026#39;, $line, $matches) || preg_match(\u0026#39;/(?\u0026lt;={%\\scodeblock).*(?=\\s%})/\u0026#39;, $line, $matches) ) { $lines[$idx] = \u0026#34;```{$matches[0]}\u0026#34;; } if (preg_match(\u0026#39;/{%\\sendcodeblock\\s%}/\u0026#39;, $line)) { $lines[$idx] = \u0026#34;```\u0026#34;; } } } 执行：\n1 ls content/posts | sed \u0026#34;s:^:`pwd`/content/posts/:\u0026#34; | xargs ./convert.php 实现全文检索 默认的 Lunr 方式开箱即用，但速度较慢，而且中文分词做得不好。所以使用 Algolia 实现。\n注册账号并选用免费方案后，在“API Keys”页面复制“Application ID”、“Search-Only API Key”和“Admin API Key”。\n在项目根目录下创建 .env 文件：\n1 2 3 4 ALGOLIA_APP_ID=XXXXXX ALGOLIA_ADMIN_KEY=XXXXXX ALGOLIA_INDEX_NAME=0x3f.org ALGOLIA_INDEX_FILE=public/index.json APP_ID 和 ADMIN_KEY 是前面复制的三项中的值，INDEX_NAME 是 Algolia 上的索引名称，随便起一个就行。INDEX_FILE 是生成站点时自动生成的索引文件的路径，一般不需要修改。\n安装自动提交索引到 Algolia 的脚本：\n1 npm install atomic-algolia -g 执行提交：\n1 atomic-algolia 因为我所用的主题是支持 Algolia 的，所以把 “Application ID”、“Search-Only Key”和索引名称填到配置文件中对应的项后就可以使用搜索了。\n添加评论功能 用了很多年 Disqus ，这次打算换用 Github Issues ，选择了 Utterances 。\n主题原生支持，注册账号后简单配置即可。\nFavicon 原来简单粗暴地用了唯一在的图标文件，这次改用 Favicon Generator 生成一套对多平台浏览器优化的图标。\n把全套文件放到 static/ 目录下即可。\n部署到 Github Pages Github Pages 支持多种站点生成方式，由于 Hexo 默认使用 master 分支管理生成的静态资源，而站点源码存放在 source 分支，所以我打算沿用这个方案，在继续使用 master 分支存放静态资源的同时，新增一个 hugo 分支，管理源码。\n手动部署 Hugo 会将生成的静态资源存放在项目根目录下的public目录中，所以需要将 master 分支检出到该目录：\n1 git worktree add -B master public origin/master 生成站点并部署：\n1 2 3 4 hugo cd public \u0026amp;\u0026amp; git add —all git commit git push -f origin master 很快就能看到新网站了。\n自动部署 Hugo 并没有提供 Hexo 那样的自动部署命令，所以要么把上述手动部署的命令写成脚本，要么使用自动部署工具，恰好 Github Actions 可以很好地实现。\n创建 .github/workflows/main.yml 文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 name: github pages on: push: branches: - hugo jobs: deploy: runs-on: ubuntu-18.04 steps: - uses: actions/checkout@v2 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: # hugo-version: \u0026#39;0.71.1\u0026#39; hugo-version: \u0026#39;latest\u0026#39; # extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public publish_branch: master - name: Update Algolia Index env: ALGOLIA_APP_ID: XXXXXX ALGOLIA_ADMIN_KEY: ${{ secrets.ALGOLIA_ADMIN_KEY }} ALGOLIA_INDEX_NAME: 0x3f.org ALGOLIA_INDEX_FILE: public/index.json run: | sudo apt-get -yqq install npm sudo npm install atomic-algolia -g atomic-algolia 注意替换 ALGOLIA_APP_ID 的真实值，并把 Algolia 的“Admin API Key”添加到 Github 项目设置中的“Secrets”里，名称为“ALGOLIA_ADMIN_KEY”。\n以后再在 hugo 分支推送新的提交时，Github Actions 就会自动执行部署操作。\n从06年在中国博客网上开始写文章，到后来换到个人搭建并售卖的 Wordpress，五年颠沛流离的博客生涯终于在12年结束并定居到 Github 上，之后 Octopress 一用就又是五年。17年，因为 Octopress 转换速度太慢，换成了 Hexo。\n我想，这次折腾之后，应该能再安分五年吧。\n","permalink":"http://0x3f.org/posts/migrate-from-hexo-to-hugo/","summary":"\u003cp\u003e一切源于我这个颜党的喜新厌旧。\u003c/p\u003e\n\u003cp\u003e总想找到一个极简而不失现代感的主题，在这个过程中，发现越来越多比较贴近我口味的主题都是适配 Hugo 的。趁最近有时间，就换了过来。\u003c/p\u003e","title":"从 Hexo 到 Hugo"},{"content":"昨天执行git pull的时候发现会一直卡在那儿，排除了各种可能，而且 Github 上的项目也是可以正常拉取的，说明跟网络、代理等关系应该不大，git 命令本身也工作正常。\n问题集中在公司的项目上，所有项目都无法拉取代码。起先怀疑是公司自建的 Gitlab 出了问题，但是其他人那里又是正常的，甚至跟我同一局域网的电脑上也是正常的。\n也就是说问题应该出在我自己的电脑上。考虑到前两天还能正常使用，之后唯一一件相关的事就是升级 macOS 到 10.15.4 了。\n然而用 Homebrew 重新安装 git 等相关的几个包也没能解决问题，于是用ssh -T -v git@gitlab.xxx.com -p 8848调试，输出如下：\ndonie@Donies  ~  ssh -T -v git@gitlab.xxx.com -p 8848 OpenSSH_8.1p1, LibreSSL 2.7.3 debug1: Reading configuration data /Users/donie/.ssh/config debug1: /Users/donie/.ssh/config line 9: Applying options for gitlab.xxx.com debug1: Reading configuration data /etc/ssh/ssh_config debug1: /etc/ssh/ssh_config line 47: Applying options for * debug1: Connecting to gitlab.xxx.com port 8848. 卡在了“Connecting to gitlab.xxx.com port 8848”这一步，但是telnet gitlab.xxx.com 8848却是通的。\n问题陷入僵局。\nGoogle的过程中偶然注意到别人正常的调试信息中这一步的输出是有 IP 地址的，如下所示：\ndebug1: Connecting to gitlab.xxx.com [xxx.xxx.xxx.xxx] port 8848. 首先怀疑应该是主机名映射出了问题，但是无论是修改 Hosts 还是在 ~/.ssh/config 中指定都还是不行，ping 主机名也能正常解析出 IP 地址。\n问题陷入绝境。\n绝望之际，突然想到会不会是 SSH 自身出了问题呢？which ssh发现是系统自带的，所以装上 Homebrew 的版本试了一下，竟然好了！\nbugOS !!!\n","permalink":"http://0x3f.org/posts/debug-git-connection-with-ssh/","summary":"\u003cp\u003e昨天执行\u003ccode\u003egit pull\u003c/code\u003e的时候发现会一直卡在那儿，排除了各种可能，而且 Github 上的项目也是可以正常拉取的，说明跟网络、代理等关系应该不大，git 命令本身也工作正常。\u003c/p\u003e\n\u003cp\u003e问题集中在公司的项目上，所有项目都无法拉取代码。起先怀疑是公司自建的 Gitlab 出了问题，但是其他人那里又是正常的，甚至跟我同一局域网的电脑上也是正常的。\u003c/p\u003e\n\u003cp\u003e也就是说问题应该出在我自己的电脑上。考虑到前两天还能正常使用，之后唯一一件相关的事就是升级 macOS 到 10.15.4 了。\u003c/p\u003e\n\u003cp\u003e然而用 Homebrew 重新安装 git 等相关的几个包也没能解决问题，于是用\u003ccode\u003essh -T -v git@gitlab.xxx.com -p 8848\u003c/code\u003e调试，输出如下：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edonie@Donies  ~  ssh -T -v git@gitlab.xxx.com -p 8848\nOpenSSH_8.1p1, LibreSSL 2.7.3\ndebug1: Reading configuration data /Users/donie/.ssh/config\ndebug1: /Users/donie/.ssh/config line 9: Applying options for gitlab.xxx.com\ndebug1: Reading configuration data /etc/ssh/ssh_config\ndebug1: /etc/ssh/ssh_config line 47: Applying options for *\ndebug1: Connecting to gitlab.xxx.com port 8848.\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e卡在了“Connecting to gitlab.xxx.com port 8848”这一步，但是\u003ccode\u003etelnet gitlab.xxx.com 8848\u003c/code\u003e却是通的。\u003c/p\u003e","title":"用 SSH 命令调试 Git 的连接问题"},{"content":"VS Code的Vim插件有个很贴心的功能，可以在切换到普通模式时自动切换到英文输入法，而当切换回插入模式时再换到此前的输入法。\n设置的方法很简单。先安装im-select，然后配置如下（macOS）：\n当然，在Vim里也可以利用im-select实现这个功能。\n","permalink":"http://0x3f.org/posts/auto-switch-input-method-while-changing-vim-mode/","summary":"\u003cp\u003eVS Code的Vim插件有个很贴心的功能，可以在切换到普通模式时自动切换到英文输入法，而当切换回插入模式时再换到此前的输入法。\u003c/p\u003e\n\u003cp\u003e设置的方法很简单。先安装\u003ca href=\"https://github.com/daipeihust/im-select\"\u003eim-select\u003c/a\u003e，然后配置如下（macOS）：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-02-19-21-59-02-510Ak5.png\" alt=\"2020-02-19-21-59-02-510Ak5\"\u003e\u003c/p\u003e\n\u003cp\u003e当然，在Vim里也可以利用im-select实现这个功能。\u003c/p\u003e","title":"改变 Vim 模式时自动切换输入法的方法"},{"content":"通过单元测试解决问题或者调试代码，可以避开错综复杂的依赖关系、直击问题的核心，从而极大地节约时间、提高效率。\n但是，当创建测试类成为一个经常发生的操作时，每次都手动创建类、引入基类、添加测试方法就显得很烦琐。我需要这样一个解决方案，让我可以立即开始着手写测试代码。\n方案一：文件模板 通过VS Code的插件Template，可以实现把事先准备好的一个测试类文件模板复制到工程目录下。\n安装完后，第一次执行Template: Create New命令会在当前工程根目录下创建文件“template.config.js”和目录“.templates”。\n在“.templates”中创建测试类模板文件，例如：\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;?php namespace Tests; use Tests\\TransactionalTestCase; class AnyTest extends TransactionalTestCase { public function testAnything() { } } 下次再执行Template的命令或者侧边栏文件管理器中的右键菜单项时，就可以选择该模板了。\nTemplate有个很大的短板，目前的版本还不支持全局模板，每个工程下都维护一套模板还是很烦琐的。\n方案二：代码片断 代码片断（以下统称Snippet）可能是VS Code做得最烂的一个功能，我曾无数次泪流满面地回想起有Vim和UltiSnips相伴的美好时光。\n解决方案是这样的：\n先通过插件File Utils的File: New File Relative to Project Root命令在工程目录下创建一个空白文件（如AnyTest.php）。然后再通过Snippet快速插入测试类的脚手架代码。\n这里有一个问题，VS Code的PHP Snippet只有在\u0026lt;?php标签之内才能生效，所以如果创建一个针对PHP语言的Snippet，在上面创建的这个空白文件里是无法触发的。\nVS Code的Snippet总体上分为工程和通用两类，所谓工程类（Project Snippet Scope），就是只对当前工程生效，存储在工程根目录下的“.vscode”目录中。通用类（Language Snippet Scope）是我们平时最常用的，对所有工程都会生效。它又分为语言和全局两种。语言类（Language Snippet File）是针对具体的语言定义的Snippet集合，文件名为语言名称，后缀是“.json”，如“php.json”。全局类（Global Snippet File）通常是不受限于语言的，当然也可以指定单个Snippet对哪些语言启用，文件名随意，后缀是“.code-snippets”。\n因此，测试类脚手架代码的Snippet不能定义在“php.json”中，而应放在“global.code-snippets”里：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026#34;PHPUnit：新测试类\u0026#34;: { \u0026#34;prefix\u0026#34;: \u0026#34;newcase\u0026#34;, \u0026#34;body\u0026#34;: [ \u0026#34;\u0026lt;?php\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;namespace Tests${1:\\\\\\\\${2:SubNameSpace}};\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;use Tests\\\\\\\\${3|TransactionalTestCase,TestCase|};\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;class ${TM_FILENAME_BASE} extends $3\u0026#34;, \u0026#34;{\u0026#34;, \u0026#34; $0\u0026#34;, \u0026#34;}\u0026#34; ], \u0026#34;description\u0026#34;: \u0026#34;PHPUnit：新测试类\u0026#34;, \u0026#34;scope\u0026#34;: \u0026#34;html,php\u0026#34;, }, 这里通过选项“scope”设定只对“html”和“php”两种语言生效，注意如果只设定“php”也是只能在\u0026lt;?php标签内才能生效的。\n","permalink":"http://0x3f.org/posts/quickly-create-phpunit-test-cases-with-vscode/","summary":"\u003cp\u003e通过单元测试解决问题或者调试代码，可以避开错综复杂的依赖关系、直击问题的核心，从而极大地节约时间、提高效率。\u003c/p\u003e\n\u003cp\u003e但是，当创建测试类成为一个经常发生的操作时，每次都手动创建类、引入基类、添加测试方法就显得很烦琐。我需要这样一个解决方案，让我可以立即开始着手写测试代码。\u003c/p\u003e","title":"在 VS Code 中快速创建 PHPUnit 测试类的方法"},{"content":"微博图床的域名不知道什么时候改了，Google找不到相关信息，经过排查发现原域名中的“ws”改成了“wx”，浪费了不少时间。\n于是打算换图床。\nGithub自从去年扩大免费账户享受的权利后，单个仓库的大小没有硬性限制，很适合做图床。\nuPic是个很好用的图床辅助工具，支持Github。\n同类工具还有PicGo。\n","permalink":"http://0x3f.org/posts/take-github-as-image-hosting-service/","summary":"\u003cp\u003e微博图床的域名不知道什么时候改了，Google找不到相关信息，经过排查发现原域名中的“ws”改成了“wx”，浪费了不少时间。\u003c/p\u003e\n\u003cp\u003e于是打算换图床。\u003c/p\u003e","title":"用Github当图床"},{"content":"今天遇到一个奇怪的问题，一次调用带引用传递形参的方法后，该形参对应的变量值没有按预期改变。\n先后排除了方法声明、调用和被调方法内部逻辑的问题，唯一的可能应该是框架自身的某些因素导致的。由于该行代码的作者是通过Facade调用Service中的这个方法，所以怀疑问题可能出在Facade上。于是改用从容器中获取Service实例的方式，发现变量值是可以改变的，也进一步验证了这个猜测。\n通过单步调试，发现Illuminate\\Support\\Facades\\Facade::__callStatic()直接把所有参数的值作为一个一维数组传递给被调方法，导致被调方法中的引用传递参数在方法执行后没有被改变。\n我个人的观点是，应该尽量避免使用引用传递、全局变量这种东西，所有方法和函数应该按标准的IO模型封装，甚至在Controller的方法中都不应该直接echo \u0026amp; die，而是应该将结果返回并由框架处理对调用方的输出行为。\n保持实现方式的简单统一，从长期看可以较好地降低开发和维护成本。大道至简。\n","permalink":"http://0x3f.org/posts/lumen-facade-doesnot-support-pass-by-reference-param/","summary":"\u003cp\u003e今天遇到一个奇怪的问题，一次调用带引用传递形参的方法后，该形参对应的变量值没有按预期改变。\u003c/p\u003e","title":"关于Lumen的Facade不支持引用传递的看法"},{"content":"C4 Model是一种简洁有序的架构模型，四个“C”分别表示“Context”、“Container”、“Component”和“Code”，是由上而下逐步细化的四个层级。\nContex即上下文，它表示我们正在构架的软件系统和用户、其它系统之间的关系。例如：\n容器（Container）把关注点放在被架构的系统本身，显示组成系统的容器（例如：APP、Web端、API、微服务、数据库等）及彼此之间的关系。例如：\n组件（Component）把一个容器放大，拆分成不同的抽象逻辑，这一层级已经涉及代码层面的内容。例如：\n而抽象逻辑内部代码之间的关系由Code这一层展示。\nC4-PlantUML是为PlantUML封装的一套模板，用来画C4架构图既美观又方便。下面是我画的样子：\n和上面的例子相比，好像不太适合画较复杂的架构，布局不太好处理，另外连线太多容易重叠在一块傻傻分不清楚。\n","permalink":"http://0x3f.org/posts/design-software-architecture-with-c4-plantuml/","summary":"\u003cp\u003e\u003ca href=\"https://c4model.com\"\u003eC4 Model\u003c/a\u003e是一种简洁有序的架构模型，四个“C”分别表示“Context”、“Container”、“Component”和“Code”，是由上而下逐步细化的四个层级。\u003c/p\u003e","title":"用C4-PlantUML画软件架构图"},{"content":"原来在Linux下用小小输入法，输入日期时间很方便。换到Mac后，很早就在关注这个问题，直到后来鼠须管实现了嵌入Lua脚本的功能才得以解决。\n在“用户设定”目录下创建文件rime.lua，内容如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 function date_translator(input, seg) if (input == \u0026#34;date\u0026#34;) then --- Candidate(type, start, end, text, comment) yield(Candidate(\u0026#34;date\u0026#34;, seg.start, seg._end, os.date(\u0026#34;%Y-%m-%d\u0026#34;), \u0026#34;日期\u0026#34;)) yield(Candidate(\u0026#34;date\u0026#34;, seg.start, seg._end, os.date(\u0026#34;%Y年%m月%d日\u0026#34;), \u0026#34;日期\u0026#34;)) end if (input == \u0026#34;time\u0026#34;) then --- Candidate(type, start, end, text, comment) yield(Candidate(\u0026#34;date\u0026#34;, seg.start, seg._end, os.date(\u0026#34;%H:%M\u0026#34;), \u0026#34;时间\u0026#34;)) yield(Candidate(\u0026#34;date\u0026#34;, seg.start, seg._end, os.date(\u0026#34;%H:%M:%S\u0026#34;), \u0026#34;时间\u0026#34;)) end if (input == \u0026#34;datetime\u0026#34;) then --- Candidate(type, start, end, text, comment) yield(Candidate(\u0026#34;date\u0026#34;, seg.start, seg._end, os.date(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;), \u0026#34;日期时间\u0026#34;)) end end --- 过滤器：单字在先 function single_char_first_filter(input) local l = {} for cand in input:iter() do if (utf8.len(cand.text) == 1) then yield(cand) else table.insert(l, cand) end end for i, cand in ipairs(l) do yield(cand) end end 然后在码表配置文件的“engine/translators”下追加lua_translator@date_translator。\n最后，重新部署即可。\n","permalink":"http://0x3f.org/posts/input-date-and-time-with-rime/","summary":"\u003cp\u003e原来在Linux下用小小输入法，输入日期时间很方便。换到Mac后，很早就在关注这个问题，直到后来鼠须管实现了嵌入Lua脚本的功能才得以解决。\u003c/p\u003e","title":"用鼠须管输入日期时间的方法"},{"content":"很长一段时间，我们都在用 MySQLWorkbench 画 ER 图。但是这个东西有一些缺陷，导致体验很不好。\n首先它生成的文件是二进制的，做不了版本控制。这意味着在版本迭代的过程中做数据结构评审的体验很糟糕。其次，离线文件难以管理，不利于团队协作。第三，图形界面虽然简单，但并不等价于高效。用它画图的成本还是比较高的。\nPlantUML 是个基于文本、灵活且强大的 UML 画图工具，高度可定制，而且可以集成到多种开发工具中。主流的 IDE 、文本编辑器都可以集成 PlantUML ，以便用自己最熟悉的工具画图并实时预览。基于文本的特性使得版本控制和 Code Review 很容易实现。如果 VCS 用的是 Gitlab ，可以更进一步，借助 PlantUML Server 实现实时预览。即使对于像 Github 这种暂时没有提供支持的 Web 平台，也有变通的解决方案。\n基于以上情况，我封装了一个用 PlantUML 画 ER 图的模板。用这个模板画图的源码如下：\n@startuml !include https://raw.githubusercontent.com/xbot/plantuml-erd/master/src/Library.iuml \u0026#39; avoid problems with angled crows feet skinparam linetype ortho \u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39; \u0026#39; Entities \u0026#39; \u0026#39; Relationships \u0026#39; one-to-one relationship \u0026#39; user -- user_profile : \u0026#34;A user only \\nhas one profile\u0026#34; \u0026#39; one to may relationship \u0026#39; user --\u0026gt; session : \u0026#34;A user may have\\n many sessions\u0026#34; \u0026#39; many to many relationship \u0026#39; Add mark if you like \u0026#39; user \u0026#34;1\u0026#34; --\u0026gt; \u0026#34;*\u0026#34; user_group : \u0026#34;A user may be \\nin many groups\u0026#34; \u0026#39; group \u0026#34;1\u0026#34; --\u0026gt; \u0026#34;0..N\u0026#34; user_group : \u0026#34;A group may \\ncontain many users\u0026#34; \u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39; Table(posts, 文章表) { PRIMARY_KEY TIMESTAMPS Column(\u0026#34;title\u0026#34;, \u0026#34;NVARCHAR[30]\u0026#34;, 1, \u0026#34;\u0026#34;, \u0026#34;标题\u0026#34;) Column(\u0026#34;status\u0026#34;, UN(\u0026#34;TINYINT\u0026#34;), 1, \u0026#34;1\u0026#34;, \u0026#34;状态\u0026#34;, \u0026#34;1:草稿; 2:已发布\u0026#34;) Column(\u0026#34;source\u0026#34;, UN(\u0026#34;TINYINT\u0026#34;), 1, \u0026#34;\u0026#34;, \u0026#34;来源：1，原创；2，转载\u0026#34;) Column(\u0026#34;category_id\u0026#34;, PK_TYPE, 1, \u0026#34;\u0026#34;, \u0026#34;分类\u0026#34;) Column(\u0026#34;created_by\u0026#34;, PK_TYPE, 1, \u0026#34;0\u0026#34;, \u0026#34;创建者ID\u0026#34;) Column(\u0026#34;published_at\u0026#34;, \u0026#34;DATETIME\u0026#34;, 0, \u0026#34;\u0026#34;, \u0026#34;发表时间\u0026#34;) Column(\u0026#34;content\u0026#34;, \u0026#34;TEXT\u0026#34;, 1, \u0026#34;\u0026#34;, \u0026#34;内容\u0026#34;) } Table(comments, 评论表) { PRIMARY_KEY TIMESTAMPS Column(\u0026#34;post_id\u0026#34;, PK_TYPE, 1, \u0026#34;\u0026#34;, \u0026#34;文章ID\u0026#34;) Column(\u0026#34;user_id\u0026#34;, PK_TYPE, 1, \u0026#34;\u0026#34;, \u0026#34;用户ID\u0026#34;) Column(\u0026#34;content\u0026#34;, \u0026#34;NVARCHAR[255]\u0026#34;, 1, \u0026#34;\u0026#34;, \u0026#34;评论内容\u0026#34;) } Table(post_logs, 文章日志表) { PRIMARY_KEY TIMESTAMPS Column(\u0026#34;post_id\u0026#34;, PK_TYPE, 1, \u0026#34;\u0026#34;, \u0026#34;文章ID\u0026#34;) Column(\u0026#34;user_id\u0026#34;, PK_TYPE, 1, \u0026#34;\u0026#34;, \u0026#34;操作者ID\u0026#34;) Column(\u0026#34;action\u0026#34;, UN(\u0026#34;TINYINT\u0026#34;), 1, \u0026#34;0\u0026#34;, \u0026#34;操作类型\u0026#34;, \u0026#34;1:创建; 2:修改; 3:删除\u0026#34;) Column(\u0026#34;data\u0026#34;, \u0026#34;TEXT\u0026#34;, 0, \u0026#34;\u0026#34;, \u0026#34;操作详情\u0026#34;) } posts ||..o{ comments posts ||..|{ post_logs @enduml 效果：\n具体的源码和例子可以参考 Git 仓库。\n下面说说怎么集成到 Gitlab。\n首先需要一个可用的 PlantUML Server 。官方提供了一个现成的、开放的服务（http://www.plantuml.com/plantuml/）。如果对响应速度或私密性有要求，就需要部署私有的服务了。\n官方提供了多种部署方式，我用的是最简单的 docker 方式。\n首先克隆官方仓库。\n然后在仓库根目录下执行命令：\n1 docker run -d -p 18080:8080 plantuml/plantuml-server:jetty 其中“18080”是服务器提供对外服务的端口。\n最后，把上述服务地址配置到 Gitlab 里即可，选项路径为管理区域→Settings→PlantUML。\n之后，可以创建 Markdown 文件，格式为：\n1 2 3 ```plantuml PlantUML源码 ``` 当在 Gitlab 中点击该文件时，就会显示实时渲染的图了。\n对于 Github 这种暂时不支持集成 PlantUML 的平台，可以利用 PlantUML Server 提供的代理服务实现，拼接一个如下所示的 URL 并当作图片链接插入网页即可：\nhttp://www.plantuml.com/plantuml/proxy?cache=no\u0026amp;src=https://raw.githubusercontent.com/xbot/plantuml-erd/master/examples/Posts.md ","permalink":"http://0x3f.org/posts/plantuml-erd/","summary":"\u003cp\u003e很长一段时间，我们都在用 MySQLWorkbench 画 ER 图。但是这个东西有一些缺陷，导致体验很不好。\u003c/p\u003e\n\u003cp\u003e首先它生成的文件是二进制的，做不了版本控制。这意味着在版本迭代的过程中做数据结构评审的体验很糟糕。其次，离线文件难以管理，不利于团队协作。第三，图形界面虽然简单，但并不等价于高效。用它画图的成本还是比较高的。\u003c/p\u003e\n\u003cp\u003ePlantUML 是个基于文本、灵活且强大的 UML 画图工具，高度可定制，而且可以集成到多种开发工具中。主流的 IDE 、文本编辑器都可以集成 PlantUML ，以便用自己最熟悉的工具画图并实时预览。基于文本的特性使得版本控制和 Code Review 很容易实现。如果 VCS 用的是 Gitlab ，可以更进一步，借助 PlantUML Server 实现实时预览。即使对于像 Github 这种暂时没有提供支持的 Web 平台，也有变通的解决方案。\u003c/p\u003e","title":"用 PlantUML 实现 ERD"},{"content":"Bose QC35曾是带给我巨大幸福感的工具，并且三年来一直处于重度使用的状态。但是它的一些弱点，使得在某些细分场景下并不能得到很好的体验。首先是包耳式的设计在夏天会很热。其次，虽然有折叠的功能，但头戴式的设计对于日常通勤来说，还是不够便携。再次，QC35一代的降噪级别只能通过APP设置，很麻烦，所以我一直都保持默认开启状态，出于安全性考虑，不适合徒步或者骑行。\n于是后来买了一副AirPods（以下简称AP）。高温和骑行的体验得以改善，但一直被通勤过程中北京公交糟糕的乘坐体验所困扰。其实在购买AP之前，更想买的是带降噪功能的耳塞，当时索尼的降噪豆一代才刚上市，评测普遍反馈体验不太好，而QC30的狗圈又让我完全接受不能，除此之外，在当时并无更多的选择。AP其实是权衡之后妥协的结果。\n所以从看到AirPods Pro（以下简称APP）上市的消息到下单，并没有考虑太久。下单时提示可能一到两周才能到货，但其实第二天就发了货，次日到手。体验了几天，说说感受。\n降噪效果 首先是最大的卖点，降噪。整体上不如QC35，但完全可以接受。\n在主要的应用场景（通勤）下，对公交车、马路上的低频噪音过滤效果明显，戴上之后一秒钟，整个世界都安静了。仍然能听到较为清楚的人声，好处是可以听到报站声、避免坐过站，但旁边大声打电话的声音也会产生一定的干扰。\n佩戴舒适度 对APP主要的疑虑应该就是入耳式的设计。对于我来说，默认的中号耳塞确实会有明显的胀感，戴的时间稍长就会不舒服。换上小号之后好很多，可以长时间佩戴，但稳固度会受到一定影响。\n稳固度 我戴AP时，右耳容易松脱。APP的稳固度会好于AP，但吃东西时右耳仍然会松脱。而且换成小号耳塞也会影响到稳固度。\n操控体验 之前对APP捏的操控方式有些顾虑，担心会影响稳固度。实际体验下来没有那么严重，可能跟入耳式、柄较短和重心靠上有关。但还是会在每次操作后不自觉地扶一下。整体上操控比AP敲击的方式精准，但不如后者方便。\n音质和续航 我不是个音乐发烧友，对音质不敏感。续航方面也没有过多关注。这两方面大致是Apple一贯的水准吧，和AP相比差不多。\n通话体验 我很少打电话，留做后补吧。\n结尾 我曾说过，我对耳机的核心需求是降噪、无线和舒适。AirPods Pro完全可以满足这样的需求。QC35仍是我降噪效果最好、佩戴最舒适的耳机，而APP会是通勤、高温场景下绝对的主力。至于AP，我想知道iOS 13的音频共享什么时候迁移到macOS上？\n","permalink":"http://0x3f.org/posts/the-expirence-of-airpods-pro/","summary":"\u003cp\u003eBose QC35曾是带给我巨大幸福感的工具，并且三年来一直处于重度使用的状态。但是它的一些弱点，使得在某些细分场景下并不能得到很好的体验。首先是包耳式的设计在夏天会很热。其次，虽然有折叠的功能，但头戴式的设计对于日常通勤来说，还是不够便携。再次，QC35一代的降噪级别只能通过APP设置，很麻烦，所以我一直都保持默认开启状态，出于安全性考虑，不适合徒步或者骑行。\u003c/p\u003e\n\u003cp\u003e于是后来买了一副AirPods（以下简称AP）。高温和骑行的体验得以改善，但一直被通勤过程中北京公交糟糕的乘坐体验所困扰。其实在购买AP之前，更想买的是带降噪功能的耳塞，当时索尼的降噪豆一代才刚上市，评测普遍反馈体验不太好，而QC30的狗圈又让我完全接受不能，除此之外，在当时并无更多的选择。AP其实是权衡之后妥协的结果。\u003c/p\u003e\n\u003cp\u003e所以从看到AirPods Pro（以下简称APP）上市的消息到下单，并没有考虑太久。下单时提示可能一到两周才能到货，但其实第二天就发了货，次日到手。体验了几天，说说感受。\u003c/p\u003e","title":"AirPods Pro的使用感受"},{"content":"被测单元有一行实例化一个类的代码，而且该类的构造方法需要参数。基于面向单元测试编程的原则，通过容器的makeWith()方法实现：\n1 $api = app()-\u0026gt;makeWith(Api::class, [\u0026#39;config\u0026#39; =\u0026gt; $config]); 但是在执行单元测试时发现，虽然测试代码中已经mock了这个类且注入到容器，但在被测单元中取到的还是原类的实例。\n实际上，测试代码中在将mock的实例注入容器时使用的是instance()方法：\n1 $this-\u0026gt;app-\u0026gt;instance($class, $mockedObj); 而容器在取带构造参数的类的实例时，并不取通过instance()方法注册进来的实例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 protected function resolve($abstract, $parameters = []) { $abstract = $this-\u0026gt;getAlias($abstract); $needsContextualBuild = ! empty($parameters) || ! is_null( $this-\u0026gt;getContextualConcrete($abstract) ); // If an instance of the type is currently being managed as a singleton we\u0026#39;ll // just return an existing instance instead of instantiating new instances // so the developer can keep using the same objects instance every time. if (isset($this-\u0026gt;instances[$abstract]) \u0026amp;\u0026amp; ! $needsContextualBuild) { return $this-\u0026gt;instances[$abstract]; } $this-\u0026gt;with[] = $parameters; $concrete = $this-\u0026gt;getConcrete($abstract); // We\u0026#39;re ready to instantiate an instance of the concrete type registered for // the binding. This will instantiate the types, as well as resolve any of // its \u0026#34;nested\u0026#34; dependencies recursively until all have gotten resolved. if ($this-\u0026gt;isBuildable($concrete, $abstract)) { $object = $this-\u0026gt;build($concrete); } else { $object = $this-\u0026gt;make($concrete); } // ... } 当存在构造参数时，容器认为是“上下文相关的构造”（needsContextualBuild），所以尝试通过具体的（concrete）逻辑实时构造。\n进一步地，getConcrete()方法的实现如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 protected function getConcrete($abstract) { if (! is_null($concrete = $this-\u0026gt;getContextualConcrete($abstract))) { return $concrete; } // If we don\u0026#39;t have a registered resolver or concrete for the type, we\u0026#39;ll just // assume each type is a concrete name and will attempt to resolve it as is // since the container should be able to resolve concretes automatically. if (isset($this-\u0026gt;bindings[$abstract])) { return $this-\u0026gt;bindings[$abstract][\u0026#39;concrete\u0026#39;]; } return $abstract; } 它从bindings数组中获取构造逻辑。因此，可以将测试代码中注册被mock的实例的方法改成如下所示：\n1 $this-\u0026gt;app-\u0026gt;offsetSet($class, $mockedObj); 因为offsetSet()方法就是通过bind()方法把被mock的实例注册到容器的：\n1 2 3 4 5 6 public function offsetSet($key, $value) { $this-\u0026gt;bind($key, $value instanceof Closure ? $value : function () use ($value) { return $value; }); } ","permalink":"http://0x3f.org/posts/mocking-objects-made-by-laravel-container-with-parameters/","summary":"\u003cp\u003e被测单元有一行实例化一个类的代码，而且该类的构造方法需要参数。基于面向单元测试编程的原则，通过容器的makeWith()方法实现：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$api\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003emakeWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eApi\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;config\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e但是在执行单元测试时发现，虽然测试代码中已经mock了这个类且注入到容器，但在被测单元中取到的还是原类的实例。\u003c/p\u003e","title":"解决Laravel中makeWith()无法取到被mock的实例的问题"},{"content":"单元测试可以方便地伪造和回滚测试数据，这个特性决定了它其实是一个效率工具。\n例如在开发退款单、发票的时候，由于这种后置的功能依赖订单、支付、库存等前置的数据，因此需要频繁地创建这些测试数据，这就导致开发的效率极低，有时甚至需要切换多个系统做诸如增加库存、下单、支付等操作。虽然在开发环境可以通过直接修改数据使之恢复可被测试的状态，但仍然存在效率很低、遗留垃圾数据和存在隐患等问题。\n单元测试可以完美地解决这些问题。\n伪造测试数据 在Laravel/Lumen中，利用Model Factory、Faker可以很方便地伪造测试数据。进一步地，只需要伪造被测单元依赖的数据，不需要真实、完整的数据。这些在《单元测试的技巧》一文中有详细介绍。\n测试数据只是被测单元依赖关系的一种，利用Mockery框架对依赖关系做伪造和断言是非常重要的知识。Mock是单元测试的灵魂！\n回滚数据库 Laravel/Lumen提供了DatabaseTransactions和DatabaseMigrations（不同版本可能有差异）这样的Trait，可以自动在每个测试方法执行后自动回滚数据库。\n调试代码 不管是调试测试代码还是被测单元，调试代码在结合单元测试的开发过程中都是个强需求。通常调试代码有两种方式：打印并中断（echo \u0026amp; die）和单步调试。这两者在单元测试中都可以很方便地实现。\n打印并中断 某些版本的PHPUnit会抑制标准输出，某些配置项（beStrictAboutOutputDuringTests=\u0026quot;true\u0026quot;）也会导致在有标准输出时中断单元测试的执行。可通过把信息打印到标准错误输出设备绕过：\n1 fwrite(STDERR, \u0026#34;Behold:\\n\u0026#34; . var_export($order, true) . \u0026#34;\\n\u0026#34;); 单步调试 单元测试是通过命令行执行的，因此可以利用XDebug支持CLI的特性触发单步调试：\n1 export XDEBUG_CONFIG=\u0026#34;idekey=VSCODE\u0026#34; 性能调优 和单步调试一样，可以通过环境变量实现：\n1 export XDEBUG_CONFIG=\u0026#34;idekey=VSCODE profiler_enable=1\u0026#34; 但是性能分析会极大地降低代码执行效率，因此建议通过命令参数的方式实现：\n1 php -d \u0026#34;xdebug.profiler_enable=1\u0026#34; ./vendor/bin/phpunit ","permalink":"http://0x3f.org/posts/use-unit-test-as-an-efficiency-tool/","summary":"\u003cp\u003e单元测试可以方便地伪造和回滚测试数据，这个特性决定了它其实是一个效率工具。\u003c/p\u003e\n\u003cp\u003e例如在开发退款单、发票的时候，由于这种后置的功能依赖订单、支付、库存等前置的数据，因此需要频繁地创建这些测试数据，这就导致开发的效率极低，有时甚至需要切换多个系统做诸如增加库存、下单、支付等操作。虽然在开发环境可以通过直接修改数据使之恢复可被测试的状态，但仍然存在效率很低、遗留垃圾数据和存在隐患等问题。\u003c/p\u003e\n\u003cp\u003e单元测试可以完美地解决这些问题。\u003c/p\u003e","title":"利用单元测试为开发提效"},{"content":"同一逻辑可以有多种实现方式，选择对单元测试友好的方式可以提高写测试代码的效率。\n返回被创建的对象 通常创建数据的接口只需要返回错误信息，成功时返回空即可，不需要返回被创建的数据。故创建数据的方法可以定义成无返回值。并且，如果我们并不关注数据是不是实际上被插入到数据库中，可以通过mock那部分的逻辑实现，事实上，这其实是更符合单元测试的理念的。\n但如果希望测试这一点，就需要到数据库中查询数据是否存在。有时候，如果被创建数据的特征不明显或不唯一，按这种方式实现就很困难。此时，如果被测单元返回被创建的对象实例，就可以省掉这一步，从而简化测试代码、提高执行效率。\n唾弃乱注入的恶习 遵循MVCSR的分层规范：\nController只实现校验参数、获取参数、调用Service、返回值，不封装具体业务逻辑。 Service只注入本对象的Repository，对其它对象的逻辑的调用均通过该对象的Facade实现。 Repository只注入本对象的Model，只封装本对象的逻辑。 Controller和Service中对任何其它Service的调用均通过Facade实现。 否则，写测试代码时对被测单元的依赖关系的处理会很麻烦。\n使用Facade Laravel/Lumen的Facade集成了Mockery，可以极大简化mocking。\n对使用依赖注入的方式调用的逻辑做mocking时代码是这样的：\n1 2 3 $fakeOrderService = \\Mockery::mock(OrderService::class); $fakeOrderService-\u0026gt;shouldReceive(\u0026#39;update\u0026#39;)-\u0026gt;once()-\u0026gt;andReturn(true); $this-\u0026gt;app-\u0026gt;instance(OrderService::class, $fakeOrderService); 而当使用Facade时，只需一行代码：\n1 OrderFacade::shouldReceive(\u0026#39;udpate\u0026#39;)-\u0026gt;once()-\u0026gt;andReturn(true); 使用app(Model::class)而不是new Model() 在Laravel/Lumen中，当代码中需要获取一个对象Model的实例时，通过容器实现会比直接new对单元测试更友好。因为借助容器，可以方便地mock这个Model。\n","permalink":"http://0x3f.org/posts/unit-test-oriented-programming/","summary":"\u003cp\u003e同一逻辑可以有多种实现方式，选择对单元测试友好的方式可以提高写测试代码的效率。\u003c/p\u003e","title":"面向单元测试编程"},{"content":"以下是我平时写单元测试时总结的一些最佳实践，有些是和具体的框架强相关的。\n利用Model Factory生成测试数据 Laravel/Lumen的Model Factory是个很好的工具。\n事先定义好主要对象的Model Factory，可以在写单元测试的代码时方便地生成临时数据：\n1 2 // 在数据库中创建一条发票的数据，并返回其Model的实例 $invoice = factory(\\App\\Models\\Invoice::class)-\u0026gt;create(); 此外，借助Faker，可以为Model Factory定义仿真数据：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 $factory-\u0026gt;define(\\App\\Models\\Invoice::class, function () { $faker = Faker\\Factory::create(\u0026#39;zh_CN\u0026#39;); $enFaker = Faker\\Factory::create(\u0026#39;en_US\u0026#39;); return [ \u0026#39;user_id\u0026#39; =\u0026gt; 1, \u0026#39;amount\u0026#39; =\u0026gt; 100, \u0026#39;title\u0026#39; =\u0026gt; $faker-\u0026gt;company, \u0026#39;taxpayer_id\u0026#39; =\u0026gt; $faker-\u0026gt;randomNumber(), \u0026#39;bank\u0026#39; =\u0026gt; $faker-\u0026gt;bank, \u0026#39;account\u0026#39; =\u0026gt; $enFaker-\u0026gt;bankAccountNumber, \u0026#39;company_registration_address\u0026#39; =\u0026gt; $faker-\u0026gt;address, \u0026#39;company_registration_phone\u0026#39; =\u0026gt; $faker-\u0026gt;phoneNumber, \u0026#39;consignee_name\u0026#39; =\u0026gt; $faker-\u0026gt;name, \u0026#39;consignee_province\u0026#39; =\u0026gt; $faker-\u0026gt;state, \u0026#39;consignee_city\u0026#39; =\u0026gt; $faker-\u0026gt;city, \u0026#39;consignee_district\u0026#39; =\u0026gt; $faker-\u0026gt;citySuffix, \u0026#39;consignee_address\u0026#39; =\u0026gt; $faker-\u0026gt;address, \u0026#39;consignee_phone\u0026#39; =\u0026gt; $faker-\u0026gt;phoneNumber, \u0026#39;zip_code\u0026#39; =\u0026gt; $faker-\u0026gt;postcode, \u0026#39;remark\u0026#39; =\u0026gt; $faker-\u0026gt;text, \u0026#39;status\u0026#39; =\u0026gt; 1, ]; }); 只伪造被测单元所需的数据 单元测试只关注被测单元本身，并不关注整体功能，所以无须保证测试数据的完整性。换言之，如果被测单元只用到了订单主表数据，就没必要创建一个包含子单、SPU/SKU、支付记录等在内的完整订单。\n利用dataProvider简化测试代码 当多个测试用例逻辑相似时，可以把它们抽象成一个测试方法，并用dataProvider提供每个用例的数据和断言。从而使测试代码变得更为简洁、易懂和便于维护。\n单独测试被测单元的校验逻辑 通常我们会用标准的IO模型实现一个方法，同时对包含校验不合法在内的异常情况抛出相应异常。\nPHPUnit提供了expectException()系列方法用于断言异常的抛出。但由于代码抛出了异常、程序被中断，故无法在一次测试中对多个异常做断言。\n因此，可以把对一个方法校验逻辑的测试单独抽象出一个测试方法，并用dataProvider提供测试数据和断言。\n利用工具查看代码覆盖率 PHPUnit提供参数--coverage-html生成覆盖率分析结果的HTML页面，但在IDE或编辑器里相对实时地查看结果会更方便。\n主流IDE或编辑器一般都集成了这个功能或提供了相关插件，如Coverage Gutters。\n","permalink":"http://0x3f.org/posts/phpunit-tips/","summary":"\u003cp\u003e以下是我平时写单元测试时总结的一些最佳实践，有些是和具体的框架强相关的。\u003c/p\u003e","title":"PHP单元测试的技巧"},{"content":"执行单元测试时遇到报错：\nBadMethodCallException: Method [validateIdList] does not exist. id_list是一个自定义的校验规则，通过Illuminate\\Support\\Facades\\Validator::extend()在AppServiceProvider::boot()中注册。由于存在一个和该规则配套的、通过Illuminate\\Support\\Facades\\Request::macro()注册的扩展方法getIDs()，故通过Illuminate\\Support\\Facades\\Request::hasMacro()判断当该方法不存在时才注册，并把这个校验规则的注册逻辑也放到了这个判断里。\n同一接口，在Postman中测试并无异常。通过日志看到，AppServiceProvider::boot()被执行了两次，这也很好理解，执行单元测试本身时会初始化一次，当单元测试调用被测试接口时，是第二次调用。也就是在这次调用中，抛出了这个异常。\n那么，为什么getIDs()方法没有问题，而id_list校验规则却不存在呢？\n通过源码可以看到，macro()方法来自于Illuminate\\Support\\Traits\\Macroable，该Trait内部使用静态变量$macros存储被注册的逻辑。而注册校验规则的extend()方法来自于Illuminate\\Validation\\Factory这个类。此类在Illuminate\\Validation\\ValidationServiceProvider中被注册为单例。\n因此，当第二次被执行时，静态存储的getIDs()方法仍然存在，而id_list由于程序实例被重置，已经不存在了。\n综上，解决的办法是把注册自定义校验规则的逻辑拿到hasMacro()外面。\n","permalink":"http://0x3f.org/posts/unit-test-in-laravel-complains-validation-rule-not-exist/","summary":"\u003cp\u003e执行单元测试时遇到报错：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eBadMethodCallException: Method [validateIdList] does not exist.\n\u003c/code\u003e\u003c/pre\u003e","title":"Lumen单元测试提示自定义校验规则不存在的问题"},{"content":"./artisan excel:write --driver=spout --amount=100000 写入数据100000行。 用时：156秒。 最大使用内存：2750.5106964111 M。 ./artisan excel:write --driver=laravel-excel --amount=100000 写入数据100000行。 用时：305秒。 最大使用内存：1330.7370758057 M。 ./artisan excel:read ./storage/app/test.xlsx --driver=spout 读取数据100001行。 用时：576秒。 最大使用内存：122.15303039551 M。 ./artisan excel:read ./storage/app/test.xlsx --driver=laravel-excel 读取数据100001行。 用时：166秒。 最大使用内存：739.48976898193 M。 基本上，Laravel Excel写XLSX的性能是Spout的一半，但内存占用是对方的一半。而在读文件上，前者的性能是后者的约3倍多，而内存占用是后者的6倍。\n测试环境：\nMBP 3.1 GHz Intel Core i5 8G内存 PHP 7.1.30 Laravel 5.8.27 Laravel Excel 3.1.14 Spout 3.0.1 ","permalink":"http://0x3f.org/posts/performance-comparation-for-laravel-excel-and-spout/","summary":"\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e./artisan excel:write --driver=spout --amount=100000\n写入数据100000行。\n用时：156秒。\n最大使用内存：2750.5106964111 M。\n\n./artisan excel:write --driver=laravel-excel --amount=100000\n写入数据100000行。\n用时：305秒。\n最大使用内存：1330.7370758057 M。\n\n./artisan excel:read ./storage/app/test.xlsx --driver=spout\n读取数据100001行。\n用时：576秒。\n最大使用内存：122.15303039551 M。\n\n./artisan excel:read ./storage/app/test.xlsx --driver=laravel-excel\n读取数据100001行。\n用时：166秒。\n最大使用内存：739.48976898193 M。\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e基本上，Laravel Excel写XLSX的性能是Spout的一半，但内存占用是对方的一半。而在读文件上，前者的性能是后者的约3倍多，而内存占用是后者的6倍。\u003c/p\u003e\n\u003cp\u003e测试环境：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMBP 3.1 GHz Intel Core i5 8G内存\u003c/li\u003e\n\u003cli\u003ePHP 7.1.30\u003c/li\u003e\n\u003cli\u003eLaravel 5.8.27\u003c/li\u003e\n\u003cli\u003eLaravel Excel 3.1.14\u003c/li\u003e\n\u003cli\u003eSpout 3.0.1\u003c/li\u003e\n\u003c/ul\u003e","title":"对比Laravel Excel和Spout的读写性能"},{"content":"蹩脚的译文看着实在费解，干脆去看《Clean Code》的原版。第14章“Successive Refinement（逐步改进）”讲的是对一个用Java实现的解析命令行参数的类Args重构的过程。\n很多人都应该好好看看这章。\n如果你觉得用了类就是面向对象编程，就去看看Args的第一版代码，一定程度上它是面向过程的。这种代码在我们项目中比比皆是。\n如果你觉得重构代码容易出问题，去看看作者是怎么利用单元测试保证重构的质量的。\n如果你觉得只要能实现业务逻辑就万事大吉，去看看这章结尾的总结部分：\nProgrammers who satisfy themselves with merely working code are behaving unprofessionally. They may fear that they don’t have time to improve the structure and design of their code, but I disagree. Nothing has a more profound and long-term degrading effect upon a development project than bad code.\n第一句的意思就是——抱有这种看法的人是不专业的。\n接下来作者说：\nBut bad code rots and ferments, becoming an inexorable weight that drags the team down. Time and time again I have seen teams grind to a crawl because, in their haste, they created a malignant morass of code that forever thereafter dominated their destiny.\n很多人总是抱怨老项目的代码写得不好，而我审核他们代码的时候听到最多的话是“这回先这样吧”……亲，你正在成为自己厌恶的人，而你终将被别人厌恶！\n本章开头的部分有一段话：\nMost freshman programmers (like most grade-schoolers) don’t follow this advice particularly well. They believe that the primary goal is to get the program working. Once it’s “working,” they move on to the next task, leaving the “working” program in whatever state they finally got it to “work.” Most seasoned programmers know that this is professional suicide.\n当你还是个“freshman”的时候，你觉得精益求精无关紧要是可以被短暂地容忍的，而当你不再fresh的时候还表现得像个freshman，你的职业生涯几乎就走到头了（professional suicide）。\n","permalink":"http://0x3f.org/posts/after-reading-chapter-14-of-clean-code/","summary":"\u003cp\u003e蹩脚的译文看着实在费解，干脆去看《Clean Code》的原版。第14章“Successive Refinement（逐步改进）”讲的是对一个用Java实现的解析命令行参数的类Args重构的过程。\u003c/p\u003e\n\u003cp\u003e很多人都应该好好看看这章。\u003c/p\u003e","title":"《Clean Code》第十四章读后"},{"content":"面临的问题 测试环境杂乱导致的问题\n每个任务都要搭建测试环境，或者把闲置的测试环境切换到待测试分支。麻烦，而且容易出问题。\n抢占beta环境的问题\n每个任务部署到beta环境时都要和别人确认，同时其它任务都要等待。\n上线任务A把尚在测试中的任务B的部分代码部署上线的问题\n先把feature分支合并到master分支，再部署到beta环境。\n任务A和B在逻辑上互斥或者代码有冲突，导致问题在上线后才发现\n测试阶段是针对每个feature分支测试，而不是针对一个集成的分支。\n不能保证所有上线的代码都经过测试\n直接把feature分支合并到master分支，不能保证所有代码都经过测试。\n原因分析 直接原因：\n用feature分支部署测试，导致有多套测试环境。 只有一个beta环境，导致抢占。 部署到beta环境前先把feature分支和master合并，导致上线时把尚在beta环境测试的代码带上线。 根本原因是，一个项目同时有多个任务并行开发上线。\n两种发布模式 按版本发布 优点 可以有专门的分支跟踪测试、beta环境，这两个环境各自只部署一个实例即可。 缺点 存在版本发布周期，做完的任务不能马上上线。 要改变我们目前的发布模式，产品部门的规划也要调整，业务部门的接受度也是个问题。 持续发布 优点 和我们目前的发布模式一致，只需要调整内部工作流即可，产品部门和业务部门无感。 缺点 多任务并行开发和上线的问题很难解决。 选型的基本原则 要保证所有上线的代码是经过测试的。 解决上述问题。 减少开发、测试、运维的负担。 调研的工作流 Git Flow Git Flow是个基于按版本发布模型的工作流：\n一方面，标准的git flow存在按版本打标签的操作，版本号冲突处理起来很麻烦。当然，也可以不用标准的git flow命令，而是用基本的git命令，但是操作会复杂很多，要求用户对git flow的原理有很强的掌握。 另一方面，develop是其它分支的上游，这意味着只有当develop分支稳定之后才可以发布上线，而这一点对于多任务并行开发的场景来说，很难保证。 需要和产品部门协商，统一规划版本发布周期，每个版本包含的所有任务统一集中上线。 能解决所有问题，但是结合我们自身的情况，再考虑到网站属于持续发布的模型，改成按版本发布不现实。 Github Flow Github Flow是基于持续发布模型的工作流。也和我们之前的方案大体一致。\nGitlab Flow Gitlab Flow是在Github Flow的基础上做的扩展：增加了用于跟踪预发布环境和线上环境的分支，并约定由上游到下游的合并规则。即master分支是一切分支的上游，所有分支必须基于master分支创建，并且由上游向下游合并。\n同样，Gitlab Flow也没有解决以上问题。\n其它方案（一） 在现有工作流的基础上调整细节：\n承认master分支和线上环境一致，即合并到master分支的内容，默认立即上线。进一步地，可以实现自动化部署。 用feature分支实现开发、测试、beta的整个过程，上线前合并到master。 分别在提测、部署beta、上线节点前必须合并master分支的最新变更。 合并时如果有冲突，解决完后必须回归测试相关功能。 存在的问题：\n能解决问题1、2、3，解决不了问题4和5。\n环境部署比较麻烦\n测试、beta环境的部署可以用自动化的方案减少部署的负担。\n可能不能保证合并到master分支的内容都经过测试，例如feature分支和master分支合并出错，或者合并到master前追加了一部分代码。\n所以当feature分支进入beta阶段时，就应该把它保护起来，只允许改bug。如果和master分支出现了冲突，解决完冲突后要回归测试。\n缺点 把临时分支设成被保护状态很麻烦。 每个阶段解决完与master的冲突后，都需要回归测试。\n其它方案（二） 存在的问题：\n能解决问题1、2、3、4，解决不了问题5。 因为在合并feature分支时，要在dev和beta中解决冲突，所以这两个分支不能被保护，存在被滥用的可能性。可能影响测试和beta环境的稳定性。 也可以保护这两个分支，当feature分支和它们存在冲突时，再从feature分支检出新分支，在这个分支上合并冲突并通过MR合并到dev或beta分支。如果之后需要改bug，在原来的feature分支上开发，然后合并到新分支，再通过MR合并到dev或beta分支。 可能存在部署测试、beta、上线每个阶段都需要合并冲突的情况。 其它方案（三） 存在的问题：\n本质上和前一种方案没有区别。 能解决问题1、2、3、4，解决不了问题5。 能解决dev和beta分支没有被保护导致滥用的问题。 同样可能存在个人仓库的永久分支被滥用的问题。 操作比较复杂。 思考 我们的beta环境其实是第二个测试环境，是否真有必要？ 总结 保证所有代码都经过测试的原则和多任务并行开发上线的模式是一对矛盾。要保证前者，就必须使代码在各分支间单向流动，比如feature分支合并到dev分支、dev合并到beta分支、beta分支再合并到master分支。要实现后者，单向流动就不可取，否则就会出现问题2和3。\nGit Flow是最大程度能解决以上所有问题的方案，不过结合我们自身的情况很难实施。\n“其它方案（二）”是个各方面比较均衡的方案，能解决大部分问题。前提是假设开发者会遵循提交标准：\n只在feature开发完成才合并到dev或beta分支 不直接在dev或beta分支上做提交 不对dev或beta分支做改变提交历史等危险操作 不在上线前夹带私货（把未经测试的代码合并到master分支） 没有哪个工作流能完全解决我们的问题，最终还是要和团队协作模式的调整配合。\n","permalink":"http://0x3f.org/posts/investigation-report-of-git-flows/","summary":"\u003ch2 id=\"面临的问题\"\u003e面临的问题\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e测试环境杂乱导致的问题\u003c/p\u003e\n\u003cp\u003e每个任务都要搭建测试环境，或者把闲置的测试环境切换到待测试分支。麻烦，而且容易出问题。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e抢占beta环境的问题\u003c/p\u003e\n\u003cp\u003e每个任务部署到beta环境时都要和别人确认，同时其它任务都要等待。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e上线任务A把尚在测试中的任务B的部分代码部署上线的问题\u003c/p\u003e\n\u003cp\u003e先把feature分支合并到master分支，再部署到beta环境。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e任务A和B在逻辑上互斥或者代码有冲突，导致问题在上线后才发现\u003c/p\u003e\n\u003cp\u003e测试阶段是针对每个feature分支测试，而不是针对一个集成的分支。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e不能保证所有上线的代码都经过测试\u003c/p\u003e\n\u003cp\u003e直接把feature分支合并到master分支，不能保证所有代码都经过测试。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e","title":"Git工作流调研报告"},{"content":"单元测试是个好东西，解决了我很多问题，不论开发效率还是代码质量，都给我助益良多。最近想在团队内部推广，就拟了个规范草稿：\n什么是单元？ 单元是逻辑的最小单位，是函数或方法。\n单元测试意味着只测试单元本身，单元内部调用的其它接口、函数和方法等均称为依赖关系。依赖关系自有它们对应的单元测试负责，不在本单元的测试范围内。\n怎么测试单元？（Stub \u0026amp; Mock） 依赖关系是脆弱的，它会导致单元测试的编写和运行效率低下，甚至易于失败。以下是项目中的一个测试用例，由于依赖了用户服务，且该服务在我家无法访问，导致测试失败：\ndonie@Donies \u0026gt; ~/Projects/app/service-biz \u0026gt;\u0026gt; master \u0026gt; phpunitat57 -- INSERT -- PHPUnit 5.7.26 by Sebastian Bergmann and contributors. ......E. 8 / 8 (100%) Time: 5.59 seconds, Memory: 22.00MB There was 1 error: 1) Tests\\\\Quotation\\\\QuotationTest::testUpdateQuotationProject GuzzleHttp\\\\Exception\\\\ConnectException: cURL error 28: Connection timed out after 2003 milliseconds (see \u0026lt;http://curl.haxx.se/libcurl/c/libcurl-errors.html\u0026gt;) /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php:186 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php:150 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php:103 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Handler/CurlHandler.php:43 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Handler/Proxy.php:28 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Handler/Proxy.php:51 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/PrepareBodyMiddleware.php:72 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Middleware.php:30 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/RedirectMiddleware.php:68 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Middleware.php:59 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/HandlerStack.php:67 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Client.php:275 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Client.php:123 /Users/donie/Projects/app/service-biz/vendor/guzzlehttp/guzzle/src/Client.php:129 /Users/donie/Projects/app/service-biz/app/Services/UserService.php:61 /Users/donie/Projects/app/service-biz/app/Services/UserService.php:96 /Users/donie/Projects/app/service-biz/app/Services/QuotationService.php:121 /Users/donie/Projects/app/service-biz/vendor/illuminate/support/Facades/Facade.php:221 /Users/donie/Projects/app/service-biz/tests/Quotation/QuotationTest.php:154 ERRORS! Tests: 8, Assertions: 8, Errors: 1. 要实现真正的单元测试，不可避免地要对单元内部的依赖关系进行伪造，即Mock。\n规范 目录结构 tests/ ↳ Api/ ↳ Services/ ↳ Repositories/ ↳ Helpers/ ↳ TestCase.php ↳ TransactionalTestCase.php 继承关系 App\\Tests\\TestCase ↳Tests\\TestCase ↳Tests\\Api\\TagTest ... ↳Tests\\TransactionalTestCase ↳Tests\\Services\\TagTest ... 接口测试 所有接口都必须有测试用例，代码覆盖率100% 位于tests/Api下，命名空间是Tests/Api 和被测试的Controller对应 只测试路由和Action本单元的代码，不测试具体业务逻辑 具体业务逻辑封装在Service层，由该层的单元测试负责 测试代码中通过Facade实现对Service层的Mock 单元测试 Service 所有Service层的方法都必须有测试用例，代码覆盖率不低于90% 位于tests/Services目录下，命名空间是Tests/Services 和被测试的Service对应 通过Facade调用Service层并实现对被测试单元依赖关系的Mock Repository 复杂的或有必要的方法要有测试用例，其余可以通过Service层的单元测试覆盖到，代码覆盖率不低于90% 位于tests/Repositories目录下，命名空间是Tests/Repositories 和被测试的Repository对应 Helper Functions 复杂的或有必要的函数要有测试用例，其余可以通过其它层的单元测试覆盖到，代码覆盖率100% 位于tests/Helpers目录下，命名空间是Tests/Helpers 每个测试用例和被测试的helper函数对应 辅助方法 基类中封装如下辅助方法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 /** * Mock一个对象并返回伪造的实例 * * 可通过回调匿名函数定制Mock的实例的行为特征。 * 当$inject参数为false时，Mock的实例不被注入容器，缺省为注入。 * * @param mixed $class 类名字符串或类本身 * @param callable $handler 回调匿名函数，接收Mock的实例作为参数，用于定制实例自身行为特征 * @param bool $inject 是否注入容器，缺省为true * * @return \\\\Mockery\\\\MockInterface */ protected function mock($class, callable $handler = null, bool $inject = true): MockInterface { $mockedObj = \\Mockery::mock($class); if (is_callable($handler)) { call_user_func($handler, $mockedObj); } if ($inject) { $this-\u0026gt;app-\u0026gt;instance($class, $mockedObj); } return $mockedObj; } /** * Mock一个单例模式的类 * * 可通过回调匿名函数定制Mock的实例的行为特征。 * * @param mixed $class 类名字符串或类本身 * @param callable $handler 回调匿名函数，接收Mock的实例作为参数，用于定制实例自身行为特征 */ protected function mockSingleton($class, callable $handler = null): void { $mockedObj = \\Mockery::mock($class); if (is_callable($handler)) { call_user_func($handler, $mockedObj); } $ref = new \\ReflectionProperty($class, \u0026#39;instance\u0026#39;); $ref-\u0026gt;setAccessible(true); $ref-\u0026gt;setValue(null, $mockedObj); } /** * 触发对象的private或protected方法 * * @param object $object 对象实例 * @param string $methodName 方法名 * @param array $parameters 参数数组 * * @return mixed 被触发方法的返回值 */ protected function invokeMethod(\u0026amp;$object, $methodName, array $parameters = []) { $reflection = new \\ReflectionClass(get_class($object)); $method = $reflection-\u0026gt;getMethod($methodName); $method-\u0026gt;setAccessible(true); return $method-\u0026gt;invokeArgs($object, $parameters); } ","permalink":"http://0x3f.org/posts/unit-testing-standard-for-laravel-based-projects/","summary":"\u003cp\u003e单元测试是个好东西，解决了我很多问题，不论开发效率还是代码质量，都给我助益良多。最近想在团队内部推广，就拟了个规范草稿：\u003c/p\u003e","title":"基于Laravel的项目的单元测试规范"},{"content":"习惯频繁地保存源码，但是每次保存都有明显的卡顿，于是用Vim自己的调优功能跟踪了一下。\n依次执行以下命令：\n:profile start profile.log :profile file * :profile func * 然后执行保存操作，再执行以下命令：\n:profile pause :noautocmd qall! 在当前目录下生成的文件profile.log里，看到执行时间最长的是Syntastic的函数，禁用这个扩展后保存果然比原来快多了。\n但是Syntastic是个很有用的扩展，所以Google一下有没有异步执行的方法，偶然发现了ALE，主要特性就是异步执行。试用之后觉得很好用，就把前者卸了。\nALE的初始配置如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026#34; ALE let g:ale_sign_column_always = 1 let g:ale_set_highlights = 0 let g:airline#extensions#ale#enabled = 1 \u0026#34;自定义error和warning图标 let g:ale_sign_error = \u0026#39;✗\u0026#39; let g:ale_sign_warning = \u0026#39;⚠\u0026#39; \u0026#34; 显示Linter名称,出错或警告等相关信息 let g:ale_echo_msg_error_str = \u0026#39;E\u0026#39; let g:ale_echo_msg_warning_str = \u0026#39;W\u0026#39; let g:ale_echo_msg_format = \u0026#39;[%linter%] %s [%severity%]\u0026#39; \u0026#34; PHP let g:ale_php_phpcs_standard = \u0026#39;PSR2\u0026#39; let g:ale_php_phpmd_ruleset = \u0026#39;~/.phpmd.xml\u0026#39; \u0026#34; 普通模式下，sp前往上一个错误或警告，sn前往下一个错误或警告 nmap sp \u0026lt;Plug\u0026gt;(ale_previous_wrap) nmap sn \u0026lt;Plug\u0026gt;(ale_next_wrap) \u0026#34; 触发/关闭语法检查 nmap \u0026lt;Leader\u0026gt;at :ALEToggle\u0026lt;CR\u0026gt; \u0026#34; 查看错误或警告的详细信息 nmap \u0026lt;Leader\u0026gt;ad :ALEDetail\u0026lt;CR\u0026gt; ","permalink":"http://0x3f.org/posts/replace-syntastic-with-ale/","summary":"\u003cp\u003e习惯频繁地保存源码，但是每次保存都有明显的卡顿，于是用Vim自己的调优功能跟踪了一下。\u003c/p\u003e","title":"用ALE替换了Syntastic"},{"content":"开源工具最常见的问题就是文档不全，实现一个需求的时候只能苦苦Google，甚至连蒙带猜。这也是我逐渐倾向买用户体验更好的收费软件的原因。\n鼠须管是自带特殊符号码表的，在用户配置目录中的symbols.yaml，但是有的码表需要手动配置。经过查资料和摸索，关键在于以下几项配置：\n1 2 3 4 5 6 7 punctuator: import_preset: symbols recognizer: import_preset: default patterns: punct: \u0026#34;^/([a-z]+|[0-9]0?)$\u0026#34; 然后就可以通过【/】+【编码】的方式显示符号备选项了，具体的编码可以到symbols.yaml里看，当然一般为了方便定制该码表，会复制并重命名该文件，然后上述的配置项里也要做相应的修改。\n","permalink":"http://0x3f.org/posts/input-punctuations-with-rime/","summary":"\u003cp\u003e\u003cem\u003e开源工具最常见的问题就是文档不全，实现一个需求的时候只能苦苦Google，甚至连蒙带猜。这也是我逐渐倾向买用户体验更好的收费软件的原因。\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e鼠须管是自带特殊符号码表的，在用户配置目录中的\u003ccode\u003esymbols.yaml\u003c/code\u003e，但是有的码表需要手动配置。经过查资料和摸索，关键在于以下几项配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003epunctuator\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimport_preset\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003esymbols\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003erecognizer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimport_preset\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edefault\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epatterns\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003epunct\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;^/([a-z]+|[0-9]0?)$\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后就可以通过\u003ccode\u003e【/】+【编码】\u003c/code\u003e的方式显示符号备选项了，具体的编码可以到\u003ccode\u003esymbols.yaml\u003c/code\u003e里看，当然一般为了方便定制该码表，会复制并重命名该文件，然后上述的配置项里也要做相应的修改。\u003c/p\u003e","title":"配置鼠须管的特殊符号输入"},{"content":"我叫王战斗，男，喵星人，狸花族，现年四个半月，折合成你们两脚兽的年龄算7岁了。\n虽然刚降临你星不久，但是我已经能驯服和驾驭两脚兽这种低等生物了。因为我发现这种生物本性里有一个致命弱点：对它很好反而不会珍惜，故作高冷却奴颜婢膝求抱抱！我们喵星管这叫「贱」。\n开始的时候，我的驭兽术还不熟练，而且我酷爱往两脚兽的脖子里钻，然后蹭它们的脸。结果它们不干了，在我才两个月零九天的时候就把我交给了现在这头两脚兽。是它们不懂喵星习俗好不好？！而且作为一个刚断奶的小正太，卖个萌怎么啦，怪我咯？\n我一直在暗中观察现在这头两脚兽。发现每隔五天，它都会在巢穴里待上两天，然后在接下来的五天里每天都消失一段时间。虽然有点好奇，不过也不是什么大事，只要我有吃有喝、两脚兽按时铲屎，每天给它放个风什么的我也OK，这是我们喵星高等生物的自我修养。\n不过还是要测试一下这货的驯服度。所以我命令它伺候我睡个午觉： 这货竟然没有反抗！！！\n有一天我发现它竟然在偷看我练习家传绝学「黑虎掏心」，我就瞪它，就瞪它： 有时候两脚兽全神贯注地照镜子，我就想看看它看的啥，然后它就扒拉我，我想一定是我高大威猛的身躯挡住它了： 这老头叫马霸霸，挺能白话的，它的巢穴已经被我军占领了： 那天两脚兽带回来一只老鼠，我一眼就看出来是假的，但是这货一碰就叫啊，然后我就停不下来了，你星管这叫口嫌体正直，看著两脚兽谜之微笑，我觉得中了奸计： 更有甚者，它竟然趁我睡著的时候拍我裸照，还传到网上： 生亦何欢，死亦何惧。趁两脚兽上厕所的时候，叼走了卷纸，然后撕稀碎，有能耐学我们喵星人上完厕所自己舔干净啊？！ 没想到报复来得如此突然，两脚兽不知道从哪儿搞了一瓶毒气，走到哪儿揣到哪儿，我一想搞事情就各种喷： 真臭啊，臭到怀疑喵生啊！ 话说回来，大部分时间两脚兽还是没那么讨厌。比如这个会喷水的盒子，被我霸占后就成了我最常喝水的东西兼洗脚盆： 两脚兽的厨艺也不赖： 吹嘘自己慷慨的时候，两脚兽就指著这口袋说：「比我吃得都好。」其实就是618的打折货。 两脚兽就是个肥宅兼Nerd，且不说为了给我做饭专门买了台电动切碎机和保鲜盒。铲个屎都装绝命毒师： 某天整了把稀奇古怪的东西在床上、沙发上各种吸，完事非要说是我干的： 我的天啊！不就掉个毛么，全宇宙只有你们两脚兽光著屁股满世界跑！ 我来，我见，我征服。我是王战斗，一个普通的驯兽师。 ","permalink":"http://0x3f.org/posts/i-am-wang-zhandou/","summary":"\u003cp\u003e我叫王战斗，男，喵星人，狸花族，现年四个半月，折合成你们两脚兽的年龄算7岁了。\u003c/p\u003e\n\u003cp\u003e虽然刚降临你星不久，但是我已经能驯服和驾驭两脚兽这种低等生物了。因为我发现这种生物本性里有一个致命弱点：对它很好反而不会珍惜，故作高冷却奴颜婢膝求抱抱！我们喵星管这叫「贱」。\u003c/p\u003e\n\u003cp\u003e开始的时候，我的驭兽术还不熟练，而且我酷爱往两脚兽的脖子里钻，然后蹭它们的脸。结果它们不干了，在我才两个月零九天的时候就把我交给了现在这头两脚兽。是它们不懂喵星习俗好不好？！而且作为一个刚断奶的小正太，卖个萌怎么啦，怪我咯？\u003c/p\u003e\n\u003cp\u003e我一直在暗中观察现在这头两脚兽。发现每隔五天，它都会在巢穴里待上两天，然后在接下来的五天里每天都消失一段时间。虽然有点好奇，不过也不是什么大事，只要我有吃有喝、两脚兽按时铲屎，每天给它放个风什么的我也OK，这是我们喵星高等生物的自我修养。\u003c/p\u003e\n\u003cp\u003e不过还是要测试一下这货的驯服度。所以我命令它伺候我睡个午觉：\n\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvx0d5683j31kw1kwb29.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这货竟然没有反抗！！！\u003c/p\u003e\n\u003cp\u003e有一天我发现它竟然在偷看我练习家传绝学「黑虎掏心」，我就瞪它，就瞪它：\n\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx0z5chyj31ei1ei4qp.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e有时候两脚兽全神贯注地照镜子，我就想看看它看的啥，然后它就扒拉我，我想一定是我高大威猛的身躯挡住它了：\n\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvx1dzxegj31kw16okjm.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这老头叫马霸霸，挺能白话的，它的巢穴已经被我军占领了：\n\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx1v8jh3j31kw1kwhdu.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e那天两脚兽带回来一只老鼠，我一眼就看出来是假的，但是这货一碰就叫啊，然后我就停不下来了，你星管这叫口嫌体正直，看著两脚兽谜之微笑，我觉得中了奸计：\n\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvx2fq5ltj30sz0prq8x.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e更有甚者，它竟然趁我睡著的时候拍我裸照，还传到网上：\n\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx2ix4jej31kw23ve84.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e生亦何欢，死亦何惧。趁两脚兽上厕所的时候，叼走了卷纸，然后撕稀碎，有能耐学我们喵星人上完厕所自己舔干净啊？！\n\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvx2zgpawj31kw1kw1kz.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e没想到报复来得如此突然，两脚兽不知道从哪儿搞了一瓶毒气，走到哪儿揣到哪儿，我一想搞事情就各种喷：\n\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvx332k34j30lc0sgn0a.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e真臭啊，臭到怀疑喵生啊！\n\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx3jj4ktj31kw23v1kz.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e话说回来，大部分时间两脚兽还是没那么讨厌。比如这个会喷水的盒子，被我霸占后就成了我最常喝水的东西兼洗脚盆：\n\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvxatojbkj31260v9k0s.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e两脚兽的厨艺也不赖：\n\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvxb51icjj31kw1kw1kz.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e吹嘘自己慷慨的时候，两脚兽就指著这口袋说：「比我吃得都好。」其实就是618的打折货。\n\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvx61t9ogj31kw1kw1kz.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e两脚兽就是个肥宅兼Nerd，且不说为了给我做饭专门买了台电动切碎机和保鲜盒。铲个屎都装绝命毒师：\n\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvx6f8zwzj31kw14fhdv.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e某天整了把稀奇古怪的东西在床上、沙发上各种吸，完事非要说是我干的：\n\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvx709q7qj31kw16o4qq.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e我的天啊！不就掉个毛么，全宇宙只有你们两脚兽光著屁股满世界跑！\n\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx75b1f9j31kw1kw7wi.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e我来，我见，我征服。我是王战斗，一个普通的驯兽师。\n\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvx7kbr2hj30sg0sg0zr.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"我叫王战斗"},{"content":"结论 倾向于通过wkhtmltopdf+消息队列实现。\n工作流程：\n用户保存表单 推送生成pdf的任务到队列 同时页面显示「正在生成PDF文档，请稍候」并轮询后端接口 PDF生成后，页面显示下载按钮 后端 dompdf 纯PHP实现。工作原理是把HTML转换成PDF。\n优点：\n不需要PHP调用命令行，安全性高。 缺点：\nHTML/CSS支持不完全，实测多个网页转换后排版错乱。 中文网页转换后，中文都是问号（网上说有解决办法1、2，未测试）。 CPU占用比较高（网上的说法，没有实测具体有多高）。 参考：\nlaravel-dompdf主页 mpdf 纯PHP实现。工作原理是把HTML转换成PDF。\n优点：\n不需要PHP调用命令行，安全性高。 缺点（未实测）：\nHTML/CSS支持不完整。 生成PDF耗时长。 参考：\nlaravel-pdf主页 mpdf文档 mpdf主页 mpdf与fpdf的使用比较 PDFtk Server PDFtk Server是个命令行程序。工作原理是利用FDF表单替换PDF模板中的占位符。实现方案有：纯PHP实现FDF + PDFtk、FPDI + PDFtk。\n优点：\n直接替换PDF模板，实现成本低，最大程度保证生成的PDF的效果。 缺点：\n需要允许PHP调用命令行，有安全隐患。 只能实现简单的字符串替换（例如公司名称），不能替换有格式文本。 参考：\nFPDI PHP的FDF手册 PDFtk的使用方法 纯PHP实现FDF + PDFtk wkhtmltopdf wkhtmltopdf是个命令行程序。工作原理是转换HTML到PDF。实现方案是laravel-snappy。\n优点：\n由于内嵌webkit核心，HTML/CSS的支持没有问题。 缺点：\n需要允许PHP调用命令行，有安全隐患。 wkhtmltopdf体积40M，并发较多时影响服务器性能和稳定性（需要考虑用队列辅助实现，异步执行，需要需求变更交互方式）。 参考：\nlaravel-snappy主页 CutyCapt 命令行程序。工作原理和wkhtmtopdf相同。\n优缺点同wkhtmltopdf，但是最近的更新在13年。\n参考：\nCutyCapt主页 Prince 命令行程序。工作原理是转换HTML到PDF。\n优点：\nHTML/CSS的支持很好。 文档很全 缺点：\n收费，而且很贵。（免费版会在输出的文档右上角打一个Logo） 需要允许PHP执行命令行，有安全隐患。 需要考虑用队列辅助实现，异步执行，需要需求变更交互方式。 参考：\nPrince官网 前端 jsPDF 工作原理有两种：编程方式动态生成和转换HTML到PDF。有三个插件支持转换HTML到PDF：fromHTML、addHTML和html2pdf。\nfromHTML最老，优点是直接转换HTML到PDF，缺点是对复杂的HTML/CSS支持得不好。实测结果，UTF-8编码的中文网页，转换到PDF都是乱码。\naddHTML较新，但目前处于deprecated状态，利用html2canvas/rasterizeHTML创建一个canvas，然后把HTML转换成图片、再转换成PDF。实测结果，对中文网页和CSS支持得都不错，但是对分页支持得不好，指定分页选项后图片被拉伸并强行分割，很难看。\nhtml2pdf是正在开发的功能，还没完成。\n参考：\nhttps://stackoverflow.com/questions/44778260/what-are-the-differences-between-jspdfs-methods-addhtml-and-fromhtml pdfkit 只能通过编程（//调用接口指定内容、分页等相关属性//）生成PDF，不支持从HTML转换到PDF。\npdfmake 据说扩展自pdfkit。只能通过编程（//调用接口指定内容、分页等相关属性//）生成PDF，不支持从HTML转换到PDF。而且需要引用字体文件转换成的js文件，不适合中文内容。\n变通方案 利用浏览器打印PDF Chrome、Firefox、Safari的最新版都支持打印网页到PDF，Edge未测试。\n优点：\n实现成本低。 缺点：\n用户体验差。 导出word文档 优点：\n实现成本低。（未证实） 缺点：\n用户可更改文档。 参考 https://blog.stahlmandesign.com/export-html-to-pdf-how-hard-can-it-be/ PHP输出PDF打印HTML5+CSS3打印格式控制(Prince和wkhtmltopdf) ","permalink":"http://0x3f.org/posts/pdf-creating-solutions/","summary":"\u003ch2 id=\"结论\"\u003e结论\u003c/h2\u003e\n\u003cp\u003e倾向于通过wkhtmltopdf+消息队列实现。\u003c/p\u003e\n\u003cp\u003e工作流程：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e用户保存表单\u003c/li\u003e\n\u003cli\u003e推送生成pdf的任务到队列\u003c/li\u003e\n\u003cli\u003e同时页面显示「正在生成PDF文档，请稍候」并轮询后端接口\u003c/li\u003e\n\u003cli\u003ePDF生成后，页面显示下载按钮\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"后端\"\u003e后端\u003c/h2\u003e\n\u003ch3 id=\"dompdf\"\u003edompdf\u003c/h3\u003e\n\u003cp\u003e纯PHP实现。工作原理是把HTML转换成PDF。\u003c/p\u003e\n\u003cp\u003e优点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e不需要PHP调用命令行，安全性高。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e缺点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eHTML/CSS支持不完全，实测多个网页转换后排版错乱。\u003c/li\u003e\n\u003cli\u003e中文网页转换后，中文都是问号（网上说有解决办法\u003ca href=\"http://www.cnblogs.com/xxoome/p/6083542.html\"\u003e1\u003c/a\u003e、\u003ca href=\"http://blog.51cto.com/lampzxr/1916038\"\u003e2\u003c/a\u003e，未测试）。\u003c/li\u003e\n\u003cli\u003eCPU占用比较高（网上的说法，没有实测具体有多高）。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e参考：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https///github.com/barryvdh/laravel-dompdf\"\u003elaravel-dompdf主页\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"mpdf\"\u003empdf\u003c/h3\u003e\n\u003cp\u003e纯PHP实现。工作原理是把HTML转换成PDF。\u003c/p\u003e\n\u003cp\u003e优点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e不需要PHP调用命令行，安全性高。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e缺点（未实测）：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eHTML/CSS支持不完整。\u003c/li\u003e\n\u003cli\u003e生成PDF耗时长。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e参考：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https///github.com/niklasravnsborg/laravel-pdf\"\u003elaravel-pdf主页\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https///mpdf.github.io\"\u003empdf文档\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https///github.com/mpdf/mpdf\"\u003empdf主页\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.cnblogs.com/attitudeY/p/7297948.html\"\u003empdf与fpdf的使用比较\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"pdftk-server\"\u003ePDFtk Server\u003c/h3\u003e\n\u003cp\u003ePDFtk Server是个命令行程序。工作原理是利用FDF表单替换PDF模板中的占位符。实现方案有：纯PHP实现FDF + PDFtk、FPDI + PDFtk。\u003c/p\u003e\n\u003cp\u003e优点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e直接替换PDF模板，实现成本低，最大程度保证生成的PDF的效果。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e缺点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e需要允许PHP调用命令行，有安全隐患。\u003c/li\u003e\n\u003cli\u003e只能实现简单的字符串替换（例如公司名称），不能替换有格式文本。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e参考：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https///www.setasign.com/products/fpdi/manual/#p-58\"\u003eFPDI\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://php.net/manual/zh/intro.fdf.php\"\u003ePHP的FDF手册\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https///stackoverflow.com/questions/1389964/merge-fdf-data-into-a-pdf-file-using-php\"\u003ePDFtk的使用方法\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https///www.sitepoint.com/filling-pdf-forms-pdftk-php/\"\u003e纯PHP实现FDF + PDFtk\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"wkhtmltopdf\"\u003ewkhtmltopdf\u003c/h3\u003e\n\u003cp\u003ewkhtmltopdf是个命令行程序。工作原理是转换HTML到PDF。实现方案是laravel-snappy。\u003c/p\u003e\n\u003cp\u003e优点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e由于内嵌webkit核心，HTML/CSS的支持没有问题。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e缺点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e需要允许PHP调用命令行，有安全隐患。\u003c/li\u003e\n\u003cli\u003ewkhtmltopdf体积40M，并发较多时影响服务器性能和稳定性（需要考虑用队列辅助实现，异步执行，需要需求变更交互方式）。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e参考：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https///github.com/barryvdh/laravel-snappy\"\u003elaravel-snappy主页\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"cutycapt\"\u003eCutyCapt\u003c/h3\u003e\n\u003cp\u003e命令行程序。工作原理和wkhtmtopdf相同。\u003c/p\u003e\n\u003cp\u003e优缺点同wkhtmltopdf，但是最近的更新在13年。\u003c/p\u003e\n\u003cp\u003e参考：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://cutycapt.sourceforge.net\"\u003eCutyCapt主页\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"prince\"\u003ePrince\u003c/h3\u003e\n\u003cp\u003e命令行程序。工作原理是转换HTML到PDF。\u003c/p\u003e\n\u003cp\u003e优点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eHTML/CSS的支持很好。\u003c/li\u003e\n\u003cli\u003e文档很全\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e缺点：\u003c/p\u003e","title":"生成PDF的方案调研"},{"content":"读完了《刺杀骑士团长》。\n开始一直以为是类似《禁闭岛》那样的表达手法，觉得当个悬疑的故事看也不错，结果直到最后一页，才发现连装神弄鬼都不是，顿时觉得六十块钱花得有点冤。单从表达手法上说，不喜欢神神叨叨的东西。凭著炒魔幻现实主义的冷饭得诺奖怕是不大可能。\n故事的大致情节是：生活平淡的画家，突遇婚变，逃避现实的过程中经历一系列魔幻和现实交错的事，最后解开心结，回到现实，找到救赎。\n这本书要表达的东西很多，出现的每一个主体都存在于多条叙事线中，只粗略读过一遍，大概也就理解了个皮毛。最主要的，是两个概念和五幅画。\n两个概念，分别是「理念」和「隐喻」。\n理念是人在自我审视下出现的另一个「我」，包括善的和恶的。象征善的理念的是「骑士团长」，一个时隐时现、身高60厘米的古代日本武士形象。象征恶的理念的是「白色斯巴鲁男子」，随时提醒「我」：你的恶，我都知道。\n隐喻是人生各种经历的具象化的形象。\n五幅画，分别是《刺杀骑士团长》、《免色肖像画》、《白色斯巴鲁男子》、《杂木林中的洞穴》和《真理惠肖像画》。\n《刺杀骑士团长》的作用很多。首先，从这幅画引出被遗忘的二战中的往事，包括雨田具彦在奥地利和雨田继彦在南京的遭遇。其次，骑士团长于「我」，是善的理念的象征，于雨田具彦，是隐藏数十年挥之不去的心结。第三，最终「我」刺杀了骑士团长，一方面解了雨田具彦的心结，使其安详地离世，另一方面，这是「我」进入隐喻世界的前提，也是解救真理惠的必要条件。\n《白色斯巴鲁男子》象征「我」的恶的理念，也是所有人的恶的理念。\n《免色肖像画》引出免色这个重要角色。免色是个从世俗的各方面看都臻于完美的男人，然而这幅画真正打动他的，恰恰是表现出了那些深藏的、消极的、恶的不完美的东西。\n《杂木林中的洞穴》既是魔幻的开端，也是魔幻的终点。一切魔幻的开始，源于深夜中听到的铃声。而「我」穿过隐喻世界，逃回现实世界，也发生在这个洞里。\n《真理惠肖像画》。真理惠既是「我」的妹妹「路」的替身，也是免色的心结。「我」通过刺杀骑士团长、穿过隐喻世界「解救」了真理惠，实际上解开了对「路」早逝的心结。\n很多年前读过《挪威的森林》，沮丧得要命，那时就认为少不读村上春树，至今如故。\n","permalink":"http://0x3f.org/posts/after-reading-killing-commendatore/","summary":"\u003cp\u003e读完了《刺杀骑士团长》。\u003c/p\u003e\n\u003cp\u003e开始一直以为是类似《禁闭岛》那样的表达手法，觉得当个悬疑的故事看也不错，结果直到最后一页，才发现连装神弄鬼都不是，顿时觉得六十块钱花得有点冤。单从表达手法上说，不喜欢神神叨叨的东西。凭著炒魔幻现实主义的冷饭得诺奖怕是不大可能。\u003c/p\u003e\n\u003cp\u003e故事的大致情节是：生活平淡的画家，突遇婚变，逃避现实的过程中经历一系列魔幻和现实交错的事，最后解开心结，回到现实，找到救赎。\u003c/p\u003e\n\u003cp\u003e这本书要表达的东西很多，出现的每一个主体都存在于多条叙事线中，只粗略读过一遍，大概也就理解了个皮毛。最主要的，是两个概念和五幅画。\u003c/p\u003e\n\u003cp\u003e两个概念，分别是「理念」和「隐喻」。\u003c/p\u003e\n\u003cp\u003e理念是人在自我审视下出现的另一个「我」，包括善的和恶的。象征善的理念的是「骑士团长」，一个时隐时现、身高60厘米的古代日本武士形象。象征恶的理念的是「白色斯巴鲁男子」，随时提醒「我」：你的恶，我都知道。\u003c/p\u003e\n\u003cp\u003e隐喻是人生各种经历的具象化的形象。\u003c/p\u003e\n\u003cp\u003e五幅画，分别是《刺杀骑士团长》、《免色肖像画》、《白色斯巴鲁男子》、《杂木林中的洞穴》和《真理惠肖像画》。\u003c/p\u003e\n\u003cp\u003e《刺杀骑士团长》的作用很多。首先，从这幅画引出被遗忘的二战中的往事，包括雨田具彦在奥地利和雨田继彦在南京的遭遇。其次，骑士团长于「我」，是善的理念的象征，于雨田具彦，是隐藏数十年挥之不去的心结。第三，最终「我」刺杀了骑士团长，一方面解了雨田具彦的心结，使其安详地离世，另一方面，这是「我」进入隐喻世界的前提，也是解救真理惠的必要条件。\u003c/p\u003e\n\u003cp\u003e《白色斯巴鲁男子》象征「我」的恶的理念，也是所有人的恶的理念。\u003c/p\u003e\n\u003cp\u003e《免色肖像画》引出免色这个重要角色。免色是个从世俗的各方面看都臻于完美的男人，然而这幅画真正打动他的，恰恰是表现出了那些深藏的、消极的、恶的不完美的东西。\u003c/p\u003e\n\u003cp\u003e《杂木林中的洞穴》既是魔幻的开端，也是魔幻的终点。一切魔幻的开始，源于深夜中听到的铃声。而「我」穿过隐喻世界，逃回现实世界，也发生在这个洞里。\u003c/p\u003e\n\u003cp\u003e《真理惠肖像画》。真理惠既是「我」的妹妹「路」的替身，也是免色的心结。「我」通过刺杀骑士团长、穿过隐喻世界「解救」了真理惠，实际上解开了对「路」早逝的心结。\u003c/p\u003e\n\u003cp\u003e很多年前读过《挪威的森林》，沮丧得要命，那时就认为少不读村上春树，至今如故。\u003c/p\u003e","title":"少不读村上"},{"content":"效果如下： 尽管鼠须管的Github仓库一直在更新，但释出版已经很久没有更新了，所以下面的美化基于网络上个人编译的版本。这篇文章里有该版本和「花园明朝」字体的下载链接，按照文中的说明替换鼠须管的程序。（注意：官方当前释出版本鼠须管不支持下文通过patch自定义配置的方式，会造成原配置信息丢失。也不支持图示的样式。）\n然后参考这篇文章，把新的颜色方案移植到用户配置中。\n图示样式使用「dust」方案。原色彩方案的字体设置的有点小，需要把font_point和label_font_point分别从14和10修改成18和14。原方案的第一顺序字体是「HYQiHei-55S Book」，要使用图示的花园明朝字体，可以不安装或者从配置信息中去掉该字体。由于原方案中已存在的配置项不能通过patch的方式覆盖，所以只能直接修改squirrel.yaml文件。\n","permalink":"http://0x3f.org/posts/beautify-squrrel-input-method/","summary":"\u003cp\u003e效果如下：\n\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvx9h8tgtj30n20bqaah.jpg\" alt=\"Ulysses_2018-04-21 20-43-42@2x\"\u003e\u003c/p\u003e\n\u003cp\u003e尽管鼠须管的Github仓库一直在更新，但释出版已经很久没有更新了，所以下面的美化基于网络上个人编译的版本。\u003ca href=\"https://scomper.me/gtd/-shu-xu-guan-de-diao-jiao-bi-ji\"\u003e这篇文章\u003c/a\u003e里有该版本和「花园明朝」字体的下载链接，按照文中的说明替换鼠须管的程序。（\u003cem\u003e注意：官方当前释出版本鼠须管不支持下文通过patch自定义配置的方式，会造成原配置信息丢失。也不支持图示的样式。\u003c/em\u003e）\u003c/p\u003e\n\u003cp\u003e然后参考\u003ca href=\"https://scomper.me/gtd/shu-xu-guan-shu-ru-fa-de-xin-pei-se\"\u003e这篇文章\u003c/a\u003e，把新的颜色方案移植到用户配置中。\u003c/p\u003e\n\u003cp\u003e图示样式使用「dust」方案。原色彩方案的字体设置的有点小，需要把font_point和label_font_point分别从14和10修改成18和14。原方案的第一顺序字体是「HYQiHei-55S Book」，要使用图示的花园明朝字体，可以不安装或者从配置信息中去掉该字体。由于原方案中已存在的配置项不能通过patch的方式覆盖，所以只能直接修改squirrel.yaml文件。\u003c/p\u003e","title":"鼠须管的美化"},{"content":"和Chrome相比，Safari更省电、需要更少的系统资源，而且Chrome还有一些莫名其妙的问题，比如在没有运行的时候，从Alfred执行搜索会启动两个窗口，一个是之前的会话，另一个是当前的搜索页面。并且，启用了一些扩展之后Safari的体验可以改进很多。所以平时用Safari更多一些。\nsVim 作为注重效率的Vim党和键盘党，这种扩展是使用任何浏览器必备的东西。最常用的就是用标记打开链接的功能。\nTampermonkey 油猴脚本管理器，应该是任何浏览器必备的东西。\nAutoPagerize 用Google搜索时自动滚动到下一页。\nRSS Menu 当发现当前页面有可订阅的RSS链接时，在工具栏图标上显示提示。\nInstapaper 稍后读工具。\nTurn Off the Lights 看视频时降低网页其余部分亮度。\nScroll To Top Button 在页面右下角显示一个浮动的跳转到页首按钮。\nPush for Kindle FiveFilters.org的发送到Kindle按钮。\noctotree GitHub侧边栏。\nTranslate 翻译当前页。\nWikiWand 优化维基百科阅读体验。\nXdebug Helper PHP单步调试辅助工具。\nAdBlock 广告过滤器。\nSessions 网页会话管理器。如果打开的页面太多，又可能在将来再用到，可以保存会话后清理掉，用到的时候再打开保存过的会话。虽然没有Chrome下的Session Buddy和Tab Snooze好用，但是解决关键问题也够了。\n","permalink":"http://0x3f.org/posts/the-safari-extensions-i-am-using/","summary":"\u003cp\u003e和Chrome相比，Safari更省电、需要更少的系统资源，而且Chrome还有一些莫名其妙的问题，比如在没有运行的时候，从Alfred执行搜索会启动两个窗口，一个是之前的会话，另一个是当前的搜索页面。并且，启用了一些扩展之后Safari的体验可以改进很多。所以平时用Safari更多一些。\u003c/p\u003e\n\u003ch2 id=\"svim\"\u003esVim\u003c/h2\u003e\n\u003cp\u003e作为注重效率的Vim党和键盘党，这种扩展是使用任何浏览器必备的东西。最常用的就是用标记打开链接的功能。\u003c/p\u003e\n\u003ch2 id=\"tampermonkey\"\u003eTampermonkey\u003c/h2\u003e\n\u003cp\u003e油猴脚本管理器，应该是任何浏览器必备的东西。\u003c/p\u003e\n\u003ch2 id=\"autopagerize\"\u003eAutoPagerize\u003c/h2\u003e\n\u003cp\u003e用Google搜索时自动滚动到下一页。\u003c/p\u003e\n\u003ch2 id=\"rss-menu\"\u003eRSS Menu\u003c/h2\u003e\n\u003cp\u003e当发现当前页面有可订阅的RSS链接时，在工具栏图标上显示提示。\u003c/p\u003e\n\u003ch2 id=\"instapaper\"\u003eInstapaper\u003c/h2\u003e\n\u003cp\u003e稍后读工具。\u003c/p\u003e\n\u003ch2 id=\"turn-off-the-lights\"\u003eTurn Off the Lights\u003c/h2\u003e\n\u003cp\u003e看视频时降低网页其余部分亮度。\u003c/p\u003e\n\u003ch2 id=\"scroll-to-top-button\"\u003eScroll To Top Button\u003c/h2\u003e\n\u003cp\u003e在页面右下角显示一个浮动的跳转到页首按钮。\u003c/p\u003e\n\u003ch2 id=\"push-for-kindle\"\u003ePush for Kindle\u003c/h2\u003e\n\u003cp\u003eFiveFilters.org的发送到Kindle按钮。\u003c/p\u003e\n\u003ch2 id=\"octotree\"\u003eoctotree\u003c/h2\u003e\n\u003cp\u003eGitHub侧边栏。\u003c/p\u003e\n\u003ch2 id=\"translate\"\u003eTranslate\u003c/h2\u003e\n\u003cp\u003e翻译当前页。\u003c/p\u003e\n\u003ch2 id=\"wikiwand\"\u003eWikiWand\u003c/h2\u003e\n\u003cp\u003e优化维基百科阅读体验。\u003c/p\u003e\n\u003ch2 id=\"xdebug-helper\"\u003eXdebug Helper\u003c/h2\u003e\n\u003cp\u003ePHP单步调试辅助工具。\u003c/p\u003e\n\u003ch2 id=\"adblock\"\u003eAdBlock\u003c/h2\u003e\n\u003cp\u003e广告过滤器。\u003c/p\u003e\n\u003ch2 id=\"sessions\"\u003eSessions\u003c/h2\u003e\n\u003cp\u003e网页会话管理器。如果打开的页面太多，又可能在将来再用到，可以保存会话后清理掉，用到的时候再打开保存过的会话。虽然没有Chrome下的Session Buddy和Tab Snooze好用，但是解决关键问题也够了。\u003c/p\u003e","title":"我在用的Safari扩展"},{"content":"Adblock Plus作者的那篇博客可能会影响很多人。我并不关心那些情怀的东西，只看疗效。\n简单地对比了下AdBlock、Adblock Plus、uBlock在Safari for Mac上的效果，所有样本和环境均为当前最新版本。AdBlock开启Safari内容过滤后是最好的，成功地过滤掉了我常访问的一个BT下载网站上的所有广告，而不开启Safari内容过滤时，会出现部分广告先显示后隐藏的情况。uBlock漏掉了个别不容易屏蔽的。而Adblock Plus最差，缺省设置下一条都没过滤掉，在选择更多的过滤规则后才过滤掉一部分。由于样本很单一，本结论不具有普适性。\n说句题外话，我觉得Adblock Plus这名字起得动机就挺不纯的，没有详细考证过，印象中这个东西是比AdBlock后出现的，而且这名字很容易让人理解成AdBlock的加强版。\n","permalink":"http://0x3f.org/posts/a-simple-comparison-among-adblock-ublock-and-adblock-plus/","summary":"\u003cp\u003eAdblock Plus作者的那篇博客可能会影响很多人。我并不关心那些情怀的东西，只看疗效。\u003c/p\u003e\n\u003cp\u003e简单地对比了下AdBlock、Adblock Plus、uBlock在Safari for Mac上的效果，所有样本和环境均为当前最新版本。AdBlock开启Safari内容过滤后是最好的，成功地过滤掉了我常访问的一个BT下载网站上的所有广告，而不开启Safari内容过滤时，会出现部分广告先显示后隐藏的情况。uBlock漏掉了个别不容易屏蔽的。而Adblock Plus最差，缺省设置下一条都没过滤掉，在选择更多的过滤规则后才过滤掉一部分。由于样本很单一，本结论不具有普适性。\u003c/p\u003e\n\u003cp\u003e说句题外话，我觉得Adblock Plus这名字起得动机就挺不纯的，没有详细考证过，印象中这个东西是比AdBlock后出现的，而且这名字很容易让人理解成AdBlock的加强版。\u003c/p\u003e","title":"广告过滤工具AdBlock、Adblock Plus和uBlock的简单对比"},{"content":"根据这条消息，变形金刚真人电影系列将会被新团队重置，原定在明年的第6部被取消。也就是说，看完今年大黄蜂的电影后，2021年前都不会有变形金刚主题的新片了。\n这种壮士断腕的做法多少算是个好消息吧，经历了变5的失败，再让麦克尔贝这么折腾下去，变形金刚这个IP就完蛋了。\n我对这件事是无可无不可的。作为一个八零后，我对变形金刚的情怀来自G1动画，所以我的关注点主要是还原G1动画风格的Master Piece系列。在MPM-3出来之前，我对电影系的玩具没多大兴趣。\n当年变1上映的时候，我很难认同电影系的风格。但是后来从变1到变3，也逐渐地开始接受它，毕竟随著技术的进步，审美风格也会发生变化，没必要固守二、三十年前的东西。我对电影系最大的意见是剧情太烂，有句话很对，说一部戏好不好关键看反派角色，《蝙蝠侠之黑暗骑士崛起》之所以口碑不错，主要是大反派小丑这个角色很立体。回头说当年的G1动画最成功的一点也是霸天虎尤其威震天这个角色塑造得比较成功。反观电影系，相对于汽车人华丽的人形态和隐藏形态，霸天虎阵营就是一群猥琐的低级生物，而且人物性格的塑造极其脸谱化。\n直到后来变4的时候，风格进一步变化，加入大量骑士元素，机械元素的减少导致科技感进一步下降。最要命的是变4的玩具做得实在是一塌糊涂。至于变5，那真是电影做得和玩具一样烂。\n真是成也麦克尔贝，败也麦克尔贝。\n","permalink":"http://0x3f.org/posts/transformers-live-action-movie-series-reset/","summary":"\u003cp\u003e根据这条\u003ca href=\"http://news.tfw2005.com/2018/02/16/transformers-cinematic-universe-current-movie-series-rebooted-358641\"\u003e消息\u003c/a\u003e，变形金刚真人电影系列将会被新团队重置，原定在明年的第6部被取消。也就是说，看完今年大黄蜂的电影后，2021年前都不会有变形金刚主题的新片了。\u003c/p\u003e\n\u003cp\u003e这种壮士断腕的做法多少算是个好消息吧，经历了变5的失败，再让麦克尔贝这么折腾下去，变形金刚这个IP就完蛋了。\u003c/p\u003e\n\u003cp\u003e我对这件事是无可无不可的。作为一个八零后，我对变形金刚的情怀来自G1动画，所以我的关注点主要是还原G1动画风格的Master Piece系列。在MPM-3出来之前，我对电影系的玩具没多大兴趣。\u003c/p\u003e\n\u003cp\u003e当年变1上映的时候，我很难认同电影系的风格。但是后来从变1到变3，也逐渐地开始接受它，毕竟随著技术的进步，审美风格也会发生变化，没必要固守二、三十年前的东西。我对电影系最大的意见是剧情太烂，有句话很对，说一部戏好不好关键看反派角色，《蝙蝠侠之黑暗骑士崛起》之所以口碑不错，主要是大反派小丑这个角色很立体。回头说当年的G1动画最成功的一点也是霸天虎尤其威震天这个角色塑造得比较成功。反观电影系，相对于汽车人华丽的人形态和隐藏形态，霸天虎阵营就是一群猥琐的低级生物，而且人物性格的塑造极其脸谱化。\u003c/p\u003e\n\u003cp\u003e直到后来变4的时候，风格进一步变化，加入大量骑士元素，机械元素的减少导致科技感进一步下降。最要命的是变4的玩具做得实在是一塌糊涂。至于变5，那真是电影做得和玩具一样烂。\u003c/p\u003e\n\u003cp\u003e真是成也麦克尔贝，败也麦克尔贝。\u003c/p\u003e","title":"变形金刚真人电影系列被重置"},{"content":"\n我不喜欢冗余的东西。如果桌子足够大，我能接受的极限是87键。然而我的Filco 87圣手二代黑茶已经吃灰很久了，之前的主力是Poker II白青。所以目前主要的关注点还是在60键上。\n我对Poker整体上还是比较满意的，尤其是按键编程的功能很方便。但是有两点让我很不满意。一是做工一般，键帽的活动幅度较大，远远没有Filco的扎实感。二是不支持蓝牙，无线化是一个用了就回不去的东西。\niQunix F60就是这么个东西，符合我对键盘所有的核心需求：支持蓝牙、做工好、60%布局、Cherry轴、PBT键帽。用了一段时间，整体是满意的。\n买的银白色，收到的是侧刻，算是个小惊喜吧，虽然不如无刻骚气，至少不像正刻那么平庸。铝合金外框加白色PBT键帽的颜值很高，整体很有质感。\n做工比Poker好很多，找回了Filco的扎实感。PBT的键帽不打油，这一点超过了Filco。\n续航一般，轻度使用可以持续一周。信号强度也很一般，一米的距离，已能感受到明显的延迟。不过这些在实际的使用中不是什么大问题。\n功能上，不支持键盘编程，这点不如Poker。但是可以用组合键交换左侧WIN键和ALT键，对Mac很友好。代替方向键的组合键位也比Poker合理。此外，可以用组合键切换有线和无线模式，支持在3台设备之间切换。\n","permalink":"http://0x3f.org/posts/iqunix-f60/","summary":"\u003cp\u003e\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvx01vj5ej31kw0w04qq.jpg\" alt=\"fullsizeoutput_392\"\u003e\u003c/p\u003e\n\u003cp\u003e我不喜欢冗余的东西。如果桌子足够大，我能接受的极限是87键。然而我的Filco 87圣手二代黑茶已经吃灰很久了，之前的主力是Poker II白青。所以目前主要的关注点还是在60键上。\u003c/p\u003e\n\u003cp\u003e我对Poker整体上还是比较满意的，尤其是按键编程的功能很方便。但是有两点让我很不满意。一是做工一般，键帽的活动幅度较大，远远没有Filco的扎实感。二是不支持蓝牙，无线化是一个用了就回不去的东西。\u003c/p\u003e\n\u003cp\u003eiQunix F60就是这么个东西，符合我对键盘所有的核心需求：支持蓝牙、做工好、60%布局、Cherry轴、PBT键帽。用了一段时间，整体是满意的。\u003c/p\u003e\n\u003cp\u003e买的银白色，收到的是侧刻，算是个小惊喜吧，虽然不如无刻骚气，至少不像正刻那么平庸。铝合金外框加白色PBT键帽的颜值很高，整体很有质感。\u003c/p\u003e\n\u003cp\u003e做工比Poker好很多，找回了Filco的扎实感。PBT的键帽不打油，这一点超过了Filco。\u003c/p\u003e\n\u003cp\u003e续航一般，轻度使用可以持续一周。信号强度也很一般，一米的距离，已能感受到明显的延迟。不过这些在实际的使用中不是什么大问题。\u003c/p\u003e\n\u003cp\u003e功能上，不支持键盘编程，这点不如Poker。但是可以用组合键交换左侧WIN键和ALT键，对Mac很友好。代替方向键的组合键位也比Poker合理。此外，可以用组合键切换有线和无线模式，支持在3台设备之间切换。\u003c/p\u003e","title":"iQunix F60使用感受"},{"content":"我妈的老SIM卡不能用在iPhone里。因为我的卡就是从大卡剪过来的，所以骑车转了一大圈，临近年关，大部分修手机的店、合作营业厅都关了，最后一个卖手机的店里的老板说这种老卡不能剪，只能换卡。\n之前听附近移动营业厅里的大堂经理说，换卡需要机主本人、身份证和服务密码，而且异地补卡只能去部分较大的营业厅。这个可以在网上营业厅里查到。\n事先在网上营业厅重置了服务密码。第二天一早，去了最近的可以异地补卡的营业厅。工作人员给了张纸条，让写下手机号、服务密码，他们查了一下，说是鉴权失败，让第二天再去。留了营业厅的电话，事先让他们查一下，确认可以办了再去。\n第三天早上十点，打电话过去，说是办异地补卡的人还没来。十一点再打过去，查了一下，说是可以办了。去之前差点没带手机，因为感觉就是办张卡，回来装也一样。事实证明，不带会后悔。\n补卡也需要用手写板签字和人脸识别，因为是2d图像识别，所以很傻，需要摇头、点头、眨眼、张嘴，在张嘴这一步重试了很多次都失败……\n补的第一张卡插到手机里不能识别，第二张才成功。\n总结以上，异地补卡需要注意这些点：\n本人、身份证、服务密码（服务密码可以去网上营业厅重置，前提是卡还在，还能接到短信） 去能办理异地补卡的营业厅（可以在网上营业厅查询，或者打客服电话） 不要去太早，最好事先打电话让他们查一下，确认可以办了再去 一定要带手机和开卡槽的工具，现场装卡测试 ","permalink":"http://0x3f.org/posts/story-of-changing-sim-card/","summary":"\u003cp\u003e我妈的老SIM卡不能用在iPhone里。因为我的卡就是从大卡剪过来的，所以骑车转了一大圈，临近年关，大部分修手机的店、合作营业厅都关了，最后一个卖手机的店里的老板说这种老卡不能剪，只能换卡。\u003c/p\u003e\n\u003cp\u003e之前听附近移动营业厅里的大堂经理说，换卡需要机主本人、身份证和服务密码，而且异地补卡只能去部分较大的营业厅。这个可以在网上营业厅里查到。\u003c/p\u003e\n\u003cp\u003e事先在网上营业厅重置了服务密码。第二天一早，去了最近的可以异地补卡的营业厅。工作人员给了张纸条，让写下手机号、服务密码，他们查了一下，说是鉴权失败，让第二天再去。留了营业厅的电话，事先让他们查一下，确认可以办了再去。\u003c/p\u003e\n\u003cp\u003e第三天早上十点，打电话过去，说是办异地补卡的人还没来。十一点再打过去，查了一下，说是可以办了。去之前差点没带手机，因为感觉就是办张卡，回来装也一样。事实证明，不带会后悔。\u003c/p\u003e\n\u003cp\u003e补卡也需要用手写板签字和人脸识别，因为是2d图像识别，所以很傻，需要摇头、点头、眨眼、张嘴，在张嘴这一步重试了很多次都失败……\u003c/p\u003e\n\u003cp\u003e补的第一张卡插到手机里不能识别，第二张才成功。\u003c/p\u003e\n\u003cp\u003e总结以上，异地补卡需要注意这些点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e本人、身份证、服务密码（服务密码可以去网上营业厅重置，前提是卡还在，还能接到短信）\u003c/li\u003e\n\u003cli\u003e去能办理异地补卡的营业厅（可以在网上营业厅查询，或者打客服电话）\u003c/li\u003e\n\u003cli\u003e不要去太早，最好事先打电话让他们查一下，确认可以办了再去\u003c/li\u003e\n\u003cli\u003e一定要带手机和开卡槽的工具，现场装卡测试\u003c/li\u003e\n\u003c/ul\u003e","title":"异地补卡下的北京中年"},{"content":"效果虽说没别人说的夸张，也的确刷得很干净，再就是缓解了胳膊的疲劳感。\n有个问题。刚开始的几天，虽然电池已经充满，但是震动强度很一般，而且手柄底部的压力警示灯一直闪，试过拔掉刷头，问题还在，说明是手柄的问题。直到提示电量紧张后第二次充电，之后才恢复正常。\nApp、多种刷头、多种模式、压力警示和三级震动强度都是噱头，刷个牙而已，HX6730足够了，多交的几百块钱除了智商税，也就颜值和无线充电有点价值了。\n电动牙刷不是个用了就回不去的东西，不过体验确实很好，刷牙不再是例行公事和负担，而是件挺有意思的事。\n","permalink":"http://0x3f.org/posts/philips-hx9903-42/","summary":"\u003cp\u003e效果虽说没别人说的夸张，也的确刷得很干净，再就是缓解了胳膊的疲劳感。\u003c/p\u003e\n\u003cp\u003e有个问题。刚开始的几天，虽然电池已经充满，但是震动强度很一般，而且手柄底部的压力警示灯一直闪，试过拔掉刷头，问题还在，说明是手柄的问题。直到提示电量紧张后第二次充电，之后才恢复正常。\u003c/p\u003e\n\u003cp\u003eApp、多种刷头、多种模式、压力警示和三级震动强度都是噱头，刷个牙而已，HX6730足够了，多交的几百块钱除了智商税，也就颜值和无线充电有点价值了。\u003c/p\u003e\n\u003cp\u003e电动牙刷不是个用了就回不去的东西，不过体验确实很好，刷牙不再是例行公事和负担，而是件挺有意思的事。\u003c/p\u003e","title":"飞利浦电动牙刷HX9903/42使用感受"},{"content":"Authy的界面很花哨，但并不实用，管理多个两步验证账号时查询效率很低。OTP Auth采用更直观的列表布局，并且支持搜索，在用户体验和效率上有更大的优势。两者之间没有批量迁移数据的方式，只能逐个手动添加，很麻烦。\n","permalink":"http://0x3f.org/posts/migrate-from-authy-to-otp-auth/","summary":"\u003cp\u003eAuthy的界面很花哨，但并不实用，管理多个两步验证账号时查询效率很低。OTP Auth采用更直观的列表布局，并且支持搜索，在用户体验和效率上有更大的优势。两者之间没有批量迁移数据的方式，只能逐个手动添加，很麻烦。\u003c/p\u003e","title":"用OTP Auth替换了Authy"},{"content":"很多项目会把转义操作放在后端接口获取参数的地方，从而忽略了这样一个问题——为什么主流框架都不在获取参数的方法里实现这一点？\n以Laravel为例，如果可以这样获取转义后的参数：$request-\u0026gt;escape('content')，代码会显得更优雅，而实际上只能用自己封装的函数手工转义：my_escape($request-\u0026gt;get('content'))，很丑陋的代码。\n事实上，主流框架并非没有提供防御XSS的封装，只是都放在模板引擎里。这样做的依据是，XSS的原理是在原本用于展示的数据里包含了可执行的文本，但不是所有展示的位置都不应该包含可执行的文本。从另一角度上说，后端应该校验前端传递的数据，但不应该篡改它。\n","permalink":"http://0x3f.org/posts/better-to-do-defenses-against-xss-in-front-end/","summary":"\u003cp\u003e很多项目会把转义操作放在后端接口获取参数的地方，从而忽略了这样一个问题——为什么主流框架都不在获取参数的方法里实现这一点？\u003c/p\u003e\n\u003cp\u003e以Laravel为例，如果可以这样获取转义后的参数：\u003ccode\u003e$request-\u0026gt;escape('content')\u003c/code\u003e，代码会显得更优雅，而实际上只能用自己封装的函数手工转义：\u003ccode\u003emy_escape($request-\u0026gt;get('content'))\u003c/code\u003e，很丑陋的代码。\u003c/p\u003e\n\u003cp\u003e事实上，主流框架并非没有提供防御XSS的封装，只是都放在模板引擎里。这样做的依据是，XSS的原理是在原本用于展示的数据里包含了可执行的文本，但不是所有展示的位置都不应该包含可执行的文本。从另一角度上说，后端应该校验前端传递的数据，但不应该篡改它。\u003c/p\u003e","title":"对XSS的防御更适合放在前端"},{"content":"大概这是我第一次看月全食，暗红色，挺大个儿，但是拍出来就显得很小。论效果， iPhone X 还不如几年前的 LX5 。\n","permalink":"http://0x3f.org/posts/lunar-eclipse/","summary":"\u003cp\u003e大概这是我第一次看月全食，暗红色，挺大个儿，但是拍出来就显得很小。论效果， iPhone X 还不如几年前的 LX5 。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-25-11-32-18-E9217241-82D8-4B12-8327-48DC8D947709_1_105_c.jpeg\" alt=\"2023-08-25-11-32-18-E9217241-82D8-4B12-8327-48DC8D947709_1_105_c\"\u003e\u003c/p\u003e","title":"癸丑望，月有食之"},{"content":"由于集成了Mockery，Laravel的Facade对单元测试非常友好，只需要一行代码就能实现mocking。\n例如，测试目标方法中调用了订单工具类的一个方法，在使用依赖注入的方式时，需要用三行代码实现对这个方法的mocking：\n1 2 3 $fakeOrderTool = m::mock(\\App\\Tool\\Order::class); $fakeOrderTool-\u0026gt;shouldReceive(\u0026#39;getById\u0026#39;)-\u0026gt;once()-\u0026gt;with($id)-\u0026gt;andReturn($fakeOrder); $this-\u0026gt;app-\u0026gt;instance(\\App\\Tool\\Order::class, $fakeOrderTool); 而用Facade是这样的：\n1 OrderFacade::shouldReceive(\u0026#39;getById\u0026#39;)-\u0026gt;once()-\u0026gt;with($id)-\u0026gt;andReturn($fakeOrder); 当测试目标方法也属于订单工具类时，需要部分mock这个类，所以还要加上一行：\n1 OrderFacade::makePartial(); 但如果订单工具类的构造方法里有需要注入的依赖关系，这里并不会被执行。所以我在工具类基类里封装了一个方法，用反射机制实现手工注入依赖关系：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /** * 注入依赖，用于单元测试 * * @return void * @author donieli * @since 5 * @version 5 */ public function injectDependencies() { $reflector = new \\ReflectionClass(get_class($this)); $params = $reflector-\u0026gt;getConstructor()-\u0026gt;getParameters(); $args = []; foreach ($params as $param) { $paramClass = $param-\u0026gt;getClass(); if (empty($paramClass)) { throw new \\Exception(\u0026#39;Dependency named \u0026#39;.$param-\u0026gt;getName().\u0026#39; cannot be injected.\u0026#39;); } $instance = app()-\u0026gt;make($paramClass-\u0026gt;getName()); $args[] = $instance; } call_user_func_array([$this, \u0026#39;__construct\u0026#39;], $args); } 然后就可以这样处理：\n1 2 3 OrderFacade::shouldReceive(\u0026#39;getById\u0026#39;)-\u0026gt;with($id)-\u0026gt;once()-\u0026gt;andReturn($fakeOrder); OrderFacade::makePartial(); OrderFacade::injectDependencies(); ","permalink":"http://0x3f.org/posts/manual-dependency-injection-with-laravel/","summary":"\u003cp\u003e由于集成了Mockery，Laravel的Facade对单元测试非常友好，只需要一行代码就能实现mocking。\u003c/p\u003e\n\u003cp\u003e例如，测试目标方法中调用了订单工具类的一个方法，在使用依赖注入的方式时，需要用三行代码实现对这个方法的mocking：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$fakeOrderTool\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e\\App\\Tool\\Order\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$fakeOrderTool\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;getById\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$id\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fakeOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e\\App\\Tool\\Order\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fakeOrderTool\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e而用Facade是这样的：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eOrderFacade\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;getById\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$id\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fakeOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e当测试目标方法也属于订单工具类时，需要部分mock这个类，所以还要加上一行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eOrderFacade\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003emakePartial\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e但如果订单工具类的构造方法里有需要注入的依赖关系，这里并不会被执行。所以我在工具类基类里封装了一个方法，用反射机制实现手工注入依赖关系：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * 注入依赖，用于单元测试\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return  void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @author  donieli\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since   5\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @version 5\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003einjectDependencies\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$reflector\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003e\\ReflectionClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eget_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$reflector\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$args\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$params\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$param\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$paramClass\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$param\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetClass\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$paramClass\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003e\\Exception\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Dependency named \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$param\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; cannot be injected.\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$instance\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003emake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$paramClass\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$instance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ecall_user_func_array\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;__construct\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后就可以这样处理：\u003c/p\u003e","title":"解决Laravel的Facade在被Mock时不自动注入依赖的一种方法"},{"content":"Vultr新加坡节点挂了两天了，不能翻墙简直什么都干不了。早上用CloudSpeed看了下，洛杉矶机房的响应速度还不错，就迁移了过去。\nShadowsocksR 这个很简单，用一键安装脚本。\n网络加速 用BBR，一键安装脚本。\nTiny Tiny RSS 先按照之前的笔记安装ttrss。\n然后重建一个空的ttrss的数据库：\n1 2 docker exec f6d92ad8efba /usr/bin/psql -c \u0026#34;drop database ttrss\u0026#34; docker exec f6d92ad8efba /usr/bin/psql -c \u0026#34;create database ttrss\u0026#34; 把数据库的备份复制到容器里并导入：\n1 2 docker cp ttrss.sql f6d92ad8efba:/tmp/ttrss.sql docker exec f6d92ad8efba /usr/bin/psql -d ttrss -f /tmp/ttrss.sql postgres 以root身份登录容器并删除备份文件：\n1 2 docker exec -it --user root f6d92ad8efba /bin/sh rm /tmp/ttrss.sql ","permalink":"http://0x3f.org/posts/migrate-vultr-from-singapore-to-los-angeles/","summary":"\u003cp\u003eVultr新加坡节点挂了两天了，不能翻墙简直什么都干不了。早上用CloudSpeed看了下，洛杉矶机房的响应速度还不错，就迁移了过去。\u003c/p\u003e\n\u003ch2 id=\"shadowsocksr\"\u003eShadowsocksR\u003c/h2\u003e\n\u003cp\u003e这个很简单，用\u003ca href=\"https://github.com/91yun/shadowsocks_install\"\u003e一键安装脚本\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 id=\"网络加速\"\u003e网络加速\u003c/h2\u003e\n\u003cp\u003e用BBR，\u003ca href=\"https://teddysun.com/489.html\"\u003e一键安装脚本\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 id=\"tiny-tiny-rss\"\u003eTiny Tiny RSS\u003c/h2\u003e\n\u003cp\u003e先按照之前的\u003ca href=\"/post/ttrss/\"\u003e笔记\u003c/a\u003e安装ttrss。\u003c/p\u003e\n\u003cp\u003e然后重建一个空的ttrss的数据库：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e f6d92ad8efba /usr/bin/psql -c \u003cspan class=\"s2\"\u003e\u0026#34;drop database ttrss\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e f6d92ad8efba /usr/bin/psql -c \u003cspan class=\"s2\"\u003e\u0026#34;create database ttrss\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e把数据库的备份复制到容器里并导入：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker cp ttrss.sql f6d92ad8efba:/tmp/ttrss.sql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e f6d92ad8efba /usr/bin/psql -d ttrss -f /tmp/ttrss.sql postgres\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e以root身份登录容器并删除备份文件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it --user root f6d92ad8efba /bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm /tmp/ttrss.sql\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"从Vultr新加坡迁移到洛杉矶"},{"content":"买了Unlox。早就知道MacID，阴差阳错一直没买，所以这又是一次后知后觉的行为。\n曾经用过一段时间ControlPlane，通过多种条件自动判断场景以启用或关闭锁屏密码。后来在一次系统升级之后就不能用了。因为这个东西本身体验也不是很好，免费的东西折腾起来太耗费精力，所以付费买体验也是个不错的选择。\n有三个功能对我来说很有用。\n首先是用Face ID解锁Mac。在Mac被唤醒后，iPhone X自动弹出解锁的通知，点击后Unlox被打开并自动调用Face ID，验证通过后Mac即被解锁。不过两次Face ID验证稍显繁琐，如果在iPhone锁屏界面验证通过后就自动解锁，体验会更好。不过我猜应该是iOS在这个地方不会通知到App。\n其次是Tap解锁。用手指点击触摸板，点击次数和每次用的手指数目可以自定义。这个方式确实很方便。为了加强安全性，还可以设置当手机断开时禁用Tap解锁。\n第三是离开时自动锁屏。可以设置当手机和Mac之间的蓝牙连接信号减弱多少时自动锁屏。虽然对于Macbook用处不大，也不失为忘记合上屏幕时的一种补救手段。\n此外还有其它一些功能，例如通过手机锁定或解锁Mac、靠近时自动唤醒Mac等。\n今年Apple应该会全系支持Face ID，所以这只是一个过渡方案。\n","permalink":"http://0x3f.org/posts/unlox/","summary":"\u003cp\u003e买了Unlox。早就知道MacID，阴差阳错一直没买，所以这又是一次后知后觉的行为。\u003c/p\u003e\n\u003cp\u003e曾经用过一段时间ControlPlane，通过多种条件自动判断场景以启用或关闭锁屏密码。后来在一次系统升级之后就不能用了。因为这个东西本身体验也不是很好，免费的东西折腾起来太耗费精力，所以付费买体验也是个不错的选择。\u003c/p\u003e\n\u003cp\u003e有三个功能对我来说很有用。\u003c/p\u003e\n\u003cp\u003e首先是用Face ID解锁Mac。在Mac被唤醒后，iPhone X自动弹出解锁的通知，点击后Unlox被打开并自动调用Face ID，验证通过后Mac即被解锁。不过两次Face ID验证稍显繁琐，如果在iPhone锁屏界面验证通过后就自动解锁，体验会更好。不过我猜应该是iOS在这个地方不会通知到App。\u003c/p\u003e\n\u003cp\u003e其次是Tap解锁。用手指点击触摸板，点击次数和每次用的手指数目可以自定义。这个方式确实很方便。为了加强安全性，还可以设置当手机断开时禁用Tap解锁。\u003c/p\u003e\n\u003cp\u003e第三是离开时自动锁屏。可以设置当手机和Mac之间的蓝牙连接信号减弱多少时自动锁屏。虽然对于Macbook用处不大，也不失为忘记合上屏幕时的一种补救手段。\u003c/p\u003e\n\u003cp\u003e此外还有其它一些功能，例如通过手机锁定或解锁Mac、靠近时自动唤醒Mac等。\u003c/p\u003e\n\u003cp\u003e今年Apple应该会全系支持Face ID，所以这只是一个过渡方案。\u003c/p\u003e","title":"Unlox：兼顾安全和体验的东西深得我心"},{"content":"通密之所以不应该被过分指责，是因为有其存在的道理，没有哪种方案的管理成本比它更低，它不需要购买昂贵的1password，不需要担心临时用的时候突然想不起来，而且，只要这个密码足够强壮并且使用环境足够安全，大多数情况下也不会有什么问题。通密的问题在于它的风险成本太高，一旦一处泄漏，所有使用这个密码的地方都不安全。\n另一个极端是，使用很复杂的密码，每个账号都不同，甚至用密码生成工具生成完全没有规律的随机字符串。这种方案的安全性很高，高到连你自己都记不住。\n所以我需要这样一套好的方案，它应该在安全性和易用性之间取得一个比较好的平衡，并且随著方法论和工具链的进化，这个平衡可以无限逼近黄金分割点。\n首先，密码应该是复杂但容易记住的。密码的复杂度和记忆负担并不成正比，例如如果你实在记不住“ppnn13%,dkstFeb1st”，那么这样呢——“娉娉袅袅十三余，豆蔻梢头二月初”。密码只是一个字符串，如果不去死记最终的值，而是字符串背后的规律，记忆的压力就会小很多。\n但考虑到每个账号都想一个这样的密码是不现实的，而且怎么解决记忆密码和账号的对应关系的问题？所以进一步，可以用这样的密码当前缀，每个密码的前缀都一样，然后针对每个账号创造一个后缀，这个后缀应该是每个账号都不同的，且和账号有某种只有你自己才知道的关联，这样你可以随时根据账号计算出它的后缀。例如，可以用账号拼音首字母（当然，实际的规则应该更复杂一点）。\n这样你就有了足够复杂、每个账号都不同并且很容易记住的密码。进一步地，在私有设备上可以利用文本替换功能（例如：Alfred for Mac的Snippets功能）快速输入通用前缀，某些支持按键编程的机械键盘会有更好的体验。\n不过好记性不如烂笔头，为防万一，还是需要一个Plan B。主流的密码管理工具主要有这么几种：\n浏览器的账号记忆功能 操作系统的keychain 在线密码管理工具 离线密码管理工具 浏览器一般是把密码以明文存储在本地的，firefox虽然有个主密码，但只是个幌子，别人仍然可以拿到它记录密码的数据库文件。这种做法的逻辑在于，设备上存储的数据的安全性由操作系统和用户负责，换句话说，用户不应该允许他人用自己的权限登录设备。但实际上很难避免这种情况，而且还要考虑到系统被入侵的可能。所以，只应该让浏览器记住那些最不重要的账号。\n相对来说，操作系统的keychain一般有自动锁定的功能，会更安全一些。但是仍无法完全避免上述问题。而且keychain只能记录账号和密码，无法存储更多的附加信息。所以这种工具也只应该存储一些不重要的账号。\n最著名的在线密码管理工具应该是Lastpass。关于它的安全性有很多种说法，不过我觉得但凡是敏感数据都不要存储到线上，所以这种方式不予考虑。\n我倾向于使用离线的密码管理工具。1password据说很好用，但是太贵了，而且开源免费的keepass已经完全够用了。我在Mac上用KeePassXC，在iOS中用MiniKeePass，私钥文件离线存储，然后数据库文件用Dropbox同步就可以了。\n此外，对于重要的账号，如果支持两步验证，一定要开启，然后用OTP Auth管理即可。\n最终的方案是：\n方法论：统一的复杂但有规律的前缀+根据账号计算出来的后缀 工具链：KeePass + OTP Auth + Dropbox ","permalink":"http://0x3f.org/posts/the-best-practice-of-password-management/","summary":"\u003cp\u003e通密之所以不应该被过分指责，是因为有其存在的道理，没有哪种方案的管理成本比它更低，它不需要购买昂贵的1password，不需要担心临时用的时候突然想不起来，而且，只要这个密码足够强壮并且使用环境足够安全，大多数情况下也不会有什么问题。通密的问题在于它的风险成本太高，一旦一处泄漏，所有使用这个密码的地方都不安全。\u003c/p\u003e\n\u003cp\u003e另一个极端是，使用很复杂的密码，每个账号都不同，甚至用密码生成工具生成完全没有规律的随机字符串。这种方案的安全性很高，高到连你自己都记不住。\u003c/p\u003e\n\u003cp\u003e所以我需要这样一套好的方案，它应该在安全性和易用性之间取得一个比较好的平衡，并且随著方法论和工具链的进化，这个平衡可以无限逼近黄金分割点。\u003c/p\u003e\n\u003cp\u003e首先，密码应该是复杂但容易记住的。密码的复杂度和记忆负担并不成正比，例如如果你实在记不住“ppnn13%,dkstFeb1st”，那么这样呢——“娉娉袅袅十三余，豆蔻梢头二月初”。密码只是一个字符串，如果不去死记最终的值，而是字符串背后的规律，记忆的压力就会小很多。\u003c/p\u003e\n\u003cp\u003e但考虑到每个账号都想一个这样的密码是不现实的，而且怎么解决记忆密码和账号的对应关系的问题？所以进一步，可以用这样的密码当前缀，每个密码的前缀都一样，然后针对每个账号创造一个后缀，这个后缀应该是每个账号都不同的，且和账号有某种只有你自己才知道的关联，这样你可以随时根据账号计算出它的后缀。例如，可以用账号拼音首字母（\u003cem\u003e当然，实际的规则应该更复杂一点\u003c/em\u003e）。\u003c/p\u003e\n\u003cp\u003e这样你就有了足够复杂、每个账号都不同并且很容易记住的密码。进一步地，在私有设备上可以利用文本替换功能（\u003cem\u003e例如：Alfred for Mac的Snippets功能\u003c/em\u003e）快速输入通用前缀，某些支持按键编程的机械键盘会有更好的体验。\u003c/p\u003e\n\u003cp\u003e不过好记性不如烂笔头，为防万一，还是需要一个Plan B。主流的密码管理工具主要有这么几种：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e浏览器的账号记忆功能\u003c/li\u003e\n\u003cli\u003e操作系统的keychain\u003c/li\u003e\n\u003cli\u003e在线密码管理工具\u003c/li\u003e\n\u003cli\u003e离线密码管理工具\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e浏览器一般是把密码以明文存储在本地的，firefox虽然有个主密码，但只是个幌子，别人仍然可以拿到它记录密码的数据库文件。这种做法的逻辑在于，设备上存储的数据的安全性由操作系统和用户负责，换句话说，用户不应该允许他人用自己的权限登录设备。但实际上很难避免这种情况，而且还要考虑到系统被入侵的可能。所以，只应该让浏览器记住那些最不重要的账号。\u003c/p\u003e\n\u003cp\u003e相对来说，操作系统的keychain一般有自动锁定的功能，会更安全一些。但是仍无法完全避免上述问题。而且keychain只能记录账号和密码，无法存储更多的附加信息。所以这种工具也只应该存储一些不重要的账号。\u003c/p\u003e\n\u003cp\u003e最著名的在线密码管理工具应该是Lastpass。关于它的安全性有很多种说法，不过我觉得但凡是敏感数据都不要存储到线上，所以这种方式不予考虑。\u003c/p\u003e\n\u003cp\u003e我倾向于使用离线的密码管理工具。1password据说很好用，但是太贵了，而且开源免费的keepass已经完全够用了。我在Mac上用KeePassXC，在iOS中用MiniKeePass，私钥文件离线存储，然后数据库文件用Dropbox同步就可以了。\u003c/p\u003e\n\u003cp\u003e此外，对于重要的账号，如果支持两步验证，一定要开启，然后用OTP Auth管理即可。\u003c/p\u003e\n\u003cp\u003e最终的方案是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e方法论：统一的复杂但有规律的前缀+根据账号计算出来的后缀\u003c/li\u003e\n\u003cli\u003e工具链：KeePass + OTP Auth + Dropbox\u003c/li\u003e\n\u003c/ul\u003e","title":"密码管理的最佳实践"},{"content":"错误信息：\n1205 Lock wait timeout exceeded; try restarting transaction\n原因之一是测试用例里重写的tearDown()方法中没有调用父类的该方法。因为DatabaseTransaction这个trait自动开启了事务，对应的回滚方法在测试用例基类的tearDown()中执行。\n","permalink":"http://0x3f.org/posts/1205-lock-wait-timeout-exceeded/","summary":"\u003cp\u003e错误信息：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e1205 Lock wait timeout exceeded; try restarting transaction\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e原因之一是测试用例里重写的tearDown()方法中没有调用父类的该方法。因为DatabaseTransaction这个trait自动开启了事务，对应的回滚方法在测试用例基类的tearDown()中执行。\u003c/p\u003e","title":"Laravel单元测试错误：1205 Lock wait timeout exceeded"},{"content":"实践环境 Charles 4.2 iOS 11.2.1 安装证书 按照Charles菜单（Help -\u0026gt; SSL Proxying -\u0026gt; Install Charles Root Certificate on a Mobile Device or Remote Browser）的指示，设置iOS的系统代理。\n为了以后使用方便，可以在代理工具（如ShadowRocket）里设置，注意使用时应配置代理工具对全部流量使用代理，如果使用PAC之类动态代理可能会拦截不到。\n在iOS的Safari中访问上面提示中的网址，会弹出提示安装证书。iOS 10.3以后还要设置信任该证书（设置-\u0026gt;通用-\u0026gt;关于本机-\u0026gt;证书信任设置）。\n配置Charles拦截HTTPS请求 路径为：Proxy -\u0026gt; SSL Proxying Settings\n可以设置对特定的主机名和端口拦截，也可以直接保存，此时对所有请求均会拦截。\n拦截 iOS中打开上述代理，APP中发送的请求就会在Charles里列出来。\n","permalink":"http://0x3f.org/posts/ios-app-intercepting-using-charles/","summary":"\u003ch2 id=\"实践环境\"\u003e实践环境\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCharles 4.2\u003c/li\u003e\n\u003cli\u003eiOS 11.2.1\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"安装证书\"\u003e安装证书\u003c/h2\u003e\n\u003cp\u003e按照Charles菜单（Help -\u0026gt; SSL Proxying -\u0026gt; Install Charles Root Certificate on a Mobile Device or Remote Browser）的指示，设置iOS的系统代理。\u003c/p\u003e\n\u003cp\u003e为了以后使用方便，可以在代理工具（如ShadowRocket）里设置，注意使用时应配置代理工具对全部流量使用代理，如果使用PAC之类动态代理可能会拦截不到。\u003c/p\u003e\n\u003cp\u003e在iOS的Safari中访问上面提示中的网址，会弹出提示安装证书。iOS 10.3以后还要设置信任该证书（设置-\u0026gt;通用-\u0026gt;关于本机-\u0026gt;证书信任设置）。\u003c/p\u003e\n\u003ch2 id=\"配置charles拦截https请求\"\u003e配置Charles拦截HTTPS请求\u003c/h2\u003e\n\u003cp\u003e路径为：Proxy -\u0026gt; SSL Proxying Settings\u003c/p\u003e\n\u003cp\u003e可以设置对特定的主机名和端口拦截，也可以直接保存，此时对所有请求均会拦截。\u003c/p\u003e\n\u003ch2 id=\"拦截\"\u003e拦截\u003c/h2\u003e\n\u003cp\u003eiOS中打开上述代理，APP中发送的请求就会在Charles里列出来。\u003c/p\u003e","title":"用Charles拦截iOS APP HTTPS请求"},{"content":"我并不试图系统地谈TDD，因为我在这方面的经验还不足以做到这一点。但是TDD的一些方法论和工具确实解决了我在实际开发过程中遇到的一些问题。\n第一个问题是健壮性。尤其是对于我这样思维发散、容易迷失又喜欢重构的人，TDD给了我一个明确的目标，在一切刚开始的时候，我要做的只是满足测试用例，让它们由红变绿。到了重构阶段，我就可以把精力放到优化代码上面，且不必对健壮性有过多的担心。在此之前，由于手动测试比较麻烦，很多时候惰性会说服潜意识告诉自己这部分逻辑很简单、不会有什么bug，结果提交测试后却一再地发生问题。\n第二个问题是效率。曾经只有不忙的时候才会写测试用例，但是现在一般都会写，因为确实可以提高开发效率，而不只是保证重构的健壮性。可能对于所有对单元测试不熟悉的人来说，这都是匪夷所思的，我也曾认为单元测试只是用来保证健壮性的，必然和开发效率是一对矛盾，因为要花很多时间写测试代码。这种想法首先是因为对单元测试不熟悉，所以才需要花很多时间在上面。其次是没有看到它所带来的好处。\n例如你要实现一整套退款单的功能，退款单是依赖订单的，这意味著你需要不只一条符合条件的订单数据。但是订单是有状态的，随著时间的推移、人为的操作或者开发过程中程序的影响，状态会变得不再符合你的要求，这时候你就必须停下来去做更多符合要求的订单。而创建订单也存在很多麻烦，你需要找到有库存的商品，有时候还要去库管系统中补充库存，然后下单并支付。最后花了很多时间做出来的订单，因为正在开发的退款单的程序出现的一个小问题变得不能使用！时间被大量浪费在创建所依赖的上游数据上。\n这时候如果用单元测试并mock出依赖关系，就可以随时随地、无限制地执行相关的业务逻辑。对效率的提高不言而喻。\n特别的，mock并不是随时可以抓起的救命稻草，它的原罪在于：不负责任地滥用mock会导致很多问题被掩盖。因此，对mock的使用应该是节制的、目标明确的。\n当然，这并不包括单纯地为了提高代码覆盖率而使用mock，只所以这是个在很多强制TDD的团队里的普遍现象，归根结底是因为KPI是万恶之源，任何好的方法论，一旦沦为KPI，就离死不远了。\n","permalink":"http://0x3f.org/posts/the-real-income-of-tdd/","summary":"\u003cp\u003e我并不试图系统地谈TDD，因为我在这方面的经验还不足以做到这一点。但是TDD的一些方法论和工具确实解决了我在实际开发过程中遇到的一些问题。\u003c/p\u003e\n\u003cp\u003e第一个问题是健壮性。尤其是对于我这样思维发散、容易迷失又喜欢重构的人，TDD给了我一个明确的目标，在一切刚开始的时候，我要做的只是满足测试用例，让它们由红变绿。到了重构阶段，我就可以把精力放到优化代码上面，且不必对健壮性有过多的担心。在此之前，由于手动测试比较麻烦，很多时候惰性会说服潜意识告诉自己这部分逻辑很简单、不会有什么bug，结果提交测试后却一再地发生问题。\u003c/p\u003e\n\u003cp\u003e第二个问题是效率。曾经只有不忙的时候才会写测试用例，但是现在一般都会写，因为确实可以提高开发效率，而不只是保证重构的健壮性。可能对于所有对单元测试不熟悉的人来说，这都是匪夷所思的，我也曾认为单元测试只是用来保证健壮性的，必然和开发效率是一对矛盾，因为要花很多时间写测试代码。这种想法首先是因为对单元测试不熟悉，所以才需要花很多时间在上面。其次是没有看到它所带来的好处。\u003c/p\u003e\n\u003cp\u003e例如你要实现一整套退款单的功能，退款单是依赖订单的，这意味著你需要不只一条符合条件的订单数据。但是订单是有状态的，随著时间的推移、人为的操作或者开发过程中程序的影响，状态会变得不再符合你的要求，这时候你就必须停下来去做更多符合要求的订单。而创建订单也存在很多麻烦，你需要找到有库存的商品，有时候还要去库管系统中补充库存，然后下单并支付。最后花了很多时间做出来的订单，因为正在开发的退款单的程序出现的一个小问题变得不能使用！时间被大量浪费在创建所依赖的上游数据上。\u003c/p\u003e\n\u003cp\u003e这时候如果用单元测试并mock出依赖关系，就可以随时随地、无限制地执行相关的业务逻辑。对效率的提高不言而喻。\u003c/p\u003e\n\u003cp\u003e特别的，mock并不是随时可以抓起的救命稻草，它的原罪在于：不负责任地滥用mock会导致很多问题被掩盖。因此，对mock的使用应该是节制的、目标明确的。\u003c/p\u003e\n\u003cp\u003e当然，这并不包括单纯地为了提高代码覆盖率而使用mock，只所以这是个在很多强制TDD的团队里的普遍现象，归根结底是因为KPI是万恶之源，任何好的方法论，一旦沦为KPI，就离死不远了。\u003c/p\u003e","title":"测试驱动开发的实际收益"},{"content":"BaiduPCS是个命令行工具，用于下载百度网盘中的资源。之前用的是浏览器插件，需要先创建分享，再拿到下载链接，最后用下载工具下载。这个工具可以直接执行一条命令下载指定的资源，非常方便。\n这里有安装说明，然后按照使用说明操作即可。\n","permalink":"http://0x3f.org/posts/baidupcs/","summary":"\u003cp\u003eBaiduPCS是个命令行工具，用于下载百度网盘中的资源。之前用的是浏览器插件，需要先创建分享，再拿到下载链接，最后用下载工具下载。这个工具可以直接执行一条命令下载指定的资源，非常方便。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/GangZhuo/BaiduPCS/blob/master/README.md\"\u003e这里\u003c/a\u003e有安装说明，然后按照\u003ca href=\"https://github.com/GangZhuo/BaiduPCS/wiki/BaiduPCS-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8\"\u003e使用说明\u003c/a\u003e操作即可。\u003c/p\u003e","title":"BaiduPCS：当前最好用的百度网盘下载工具"},{"content":"“熊猫吃短信”是个新上架的App，用于过滤垃圾短信。据说是基于机器学习训练出来的，用了一周，识别得非常准确。\n之前用的腾讯手机管家，即使把“精准识别”、“上传到云端”等选项都打开，还会有漏网之鱼，而且会牺牲隐私。这个App声称不会主动上传短信。最重要的是，这一周里所有不关心的短信都被过滤掉了，而且没有失误。\n","permalink":"http://0x3f.org/posts/panda-eats-sms/","summary":"\u003cp\u003e“熊猫吃短信”是个新上架的App，用于过滤垃圾短信。据说是基于机器学习训练出来的，用了一周，识别得非常准确。\u003c/p\u003e\n\u003cp\u003e之前用的腾讯手机管家，即使把“精准识别”、“上传到云端”等选项都打开，还会有漏网之鱼，而且会牺牲隐私。这个App声称不会主动上传短信。最重要的是，这一周里所有不关心的短信都被过滤掉了，而且没有失误。\u003c/p\u003e","title":"iOS垃圾短信过滤器：熊猫吃短信"},{"content":"\n早在Paperwhite 1的时候我就不喜欢它的工业设计：边框太宽，屏幕内陷。此外，非人体工学设计和没有实体翻页键导致单手握持体验很差。再有就是做工的问题，机身表面接缝处缝隙明显而不均匀、通体强烈的塑料感。然而还是从一代用到了三代，除了kpw是kindle全系列里性价比最高的产品线之外，还有就是没有其它任何一款产品解决了kpw的主要问题。\n例如Voage，虽然屏幕不内陷了、楔形机身优化了握持感、增加了翻页键，但整体的设计只算是在kpw基础上的优化，何况各项硬件配置和kpw3几乎无差。\n后来当第一代Oasis发布的时候，看了第一眼就瞬间失掉了兴趣。捆绑的充电保护壳绝对是体验杀手，装上壳比kpw还要厚重，不装的话本体的续航又很差，频繁拆装也很不方便，这样的体验连kpw都不如。所以我很不看好它，果然很快在今年六月就下架了。\n十月刚看到新Oasis的消息时，马上觉得这回终于有买的价值了。\u0010\n首先是7寸的屏幕，瞬间和其它产品线拉开了距离。更大的屏幕意味著能展示更多内容，增加了宽度后也更接近实体书的观感。\n工业设计相对于我的kpw3当然是有了质的改变。玻璃材质的纯平表面，金属背壳，没有了kpw的塑料感，显得更精致。得益于窄边框，7寸屏的机身长度比6寸的kpw还短。虽然因为加宽了屏幕和增加了单手握持的边框导致机身宽度超过kpw很多，不过在平时携带中并没有造成很多困扰。\n单手握持是ko系列的主要卖点，实际使用体验当然很好。为握持设计的宽边框加上实体翻页键非常方便。虽然因为加大屏幕和增加续航导致194g的重量远远超过1代的131g，但还是比kpw轻了10g，而且主要重量集中在单手握持的一边，杠杆效应很小。配合重力感应，随时换手可以有效缓解疲劳。当然，作为长时间单手握持的阅读设备，重量自然越轻越好，这一点上，ko还有很大优化的空间。\n此外，新ko的做工远远好于kpw，没有了廉价感。12颗背光灯使得背光的均匀度比kpw强了很多，几乎不会有kpw上明显的光影。性能上是现在kindle全系列里最高的，翻页时虽然还会看到闪屏，但比以前已经快了很多。自动亮度调节算是个聊胜于无的功能吧。至于防水和有声书，我没有这方面的需求。\n如果说缺点的话，还是续航。虽然相对于1代本体，续航已经达到可用的水平，但是对于被其它产品线惯坏的我们来说，新ko电量的消耗还是快了点。我没有精确的对比，但是能明显地感觉到比kpw掉得快不少。\n","permalink":"http://0x3f.org/posts/the-all-new-kindle-oasis/","summary":"\u003cp\u003e\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvwzr2sbyj31kw1kwe83.jpg\" alt=\"fullsizeoutput_358\"\u003e\u003c/p\u003e\n\u003cp\u003e早在Paperwhite 1的时候我就不喜欢它的工业设计：边框太宽，屏幕内陷。此外，非人体工学设计和没有实体翻页键导致单手握持体验很差。再有就是做工的问题，机身表面接缝处缝隙明显而不均匀、通体强烈的塑料感。然而还是从一代用到了三代，除了kpw是kindle全系列里性价比最高的产品线之外，还有就是没有其它任何一款产品解决了kpw的主要问题。\u003c/p\u003e\n\u003cp\u003e例如Voage，虽然屏幕不内陷了、楔形机身优化了握持感、增加了翻页键，但整体的设计只算是在kpw基础上的优化，何况各项硬件配置和kpw3几乎无差。\u003c/p\u003e\n\u003cp\u003e后来当第一代Oasis发布的时候，看了第一眼就瞬间失掉了兴趣。捆绑的充电保护壳绝对是体验杀手，装上壳比kpw还要厚重，不装的话本体的续航又很差，频繁拆装也很不方便，这样的体验连kpw都不如。所以我很不看好它，果然很快在今年六月就下架了。\u003c/p\u003e\n\u003cp\u003e十月刚看到新Oasis的消息时，马上觉得这回终于有买的价值了。\u0010\u003c/p\u003e\n\u003cp\u003e首先是7寸的屏幕，瞬间和其它产品线拉开了距离。更大的屏幕意味著能展示更多内容，增加了宽度后也更接近实体书的观感。\u003c/p\u003e\n\u003cp\u003e工业设计相对于我的kpw3当然是有了质的改变。玻璃材质的纯平表面，金属背壳，没有了kpw的塑料感，显得更精致。得益于窄边框，7寸屏的机身长度比6寸的kpw还短。虽然因为加宽了屏幕和增加了单手握持的边框导致机身宽度超过kpw很多，不过在平时携带中并没有造成很多困扰。\u003c/p\u003e\n\u003cp\u003e单手握持是ko系列的主要卖点，实际使用体验当然很好。为握持设计的宽边框加上实体翻页键非常方便。虽然因为加大屏幕和增加续航导致194g的重量远远超过1代的131g，但还是比kpw轻了10g，而且主要重量集中在单手握持的一边，杠杆效应很小。配合重力感应，随时换手可以有效缓解疲劳。当然，作为长时间单手握持的阅读设备，重量自然越轻越好，这一点上，ko还有很大优化的空间。\u003c/p\u003e\n\u003cp\u003e此外，新ko的做工远远好于kpw，没有了廉价感。12颗背光灯使得背光的均匀度比kpw强了很多，几乎不会有kpw上明显的光影。性能上是现在kindle全系列里最高的，翻页时虽然还会看到闪屏，但比以前已经快了很多。自动亮度调节算是个聊胜于无的功能吧。至于防水和有声书，我没有这方面的需求。\u003c/p\u003e\n\u003cp\u003e如果说缺点的话，还是续航。虽然相对于1代本体，续航已经达到可用的水平，但是对于被其它产品线惯坏的我们来说，新ko电量的消耗还是快了点。我没有精确的对比，但是能明显地感觉到比kpw掉得快不少。\u003c/p\u003e","title":"全新Kindle Oasis使用感受"},{"content":"以前的做法是先用湿巾清理，再用纸巾擦干。后来屏幕的触感逐渐不如开始时顺滑，也更容易沾指纹和灰尘，而且不容易清除。估计应该是湿巾的酒精会腐蚀屏幕的涂层，纸巾粗糙的表面也会造成磨损。\n现在先用软毛刷扫除灰尘，然后用3M魔布擦拭。效果应该会更好。\n","permalink":"http://0x3f.org/posts/how-to-clean-a-phone/","summary":"\u003cp\u003e以前的做法是先用湿巾清理，再用纸巾擦干。后来屏幕的触感逐渐不如开始时顺滑，也更容易沾指纹和灰尘，而且不容易清除。估计应该是湿巾的酒精会腐蚀屏幕的涂层，纸巾粗糙的表面也会造成磨损。\u003c/p\u003e\n\u003cp\u003e现在先用软毛刷扫除灰尘，然后用3M魔布擦拭。效果应该会更好。\u003c/p\u003e","title":"清洁手机的最佳实践"},{"content":"不知不觉已经很多年没有用过Firefox了。在Chrome发布之前，这只狐狸以一己之力扛著互联网承前启后的大旗。后来被Chrome在网页加载速度上吊打，逐渐式微。之后还在用Firefox的人一般也只是因为受不了Chrome的内存占用。\nFirefox Quantum刚发布的时候我就安装了，以为是个全新的项目，新项目初期往往特性不健全，所以就没有太多关注。\n然后发现版本号接续了旧版，也兼容原Firefox的插件，所以就装上几个必要的插件，尝试了一下。新的UI借鉴了Chrome，不像原来那么过时。最重要的是内存占用和网页打开速度比Chrome有优势。如官方宣传语所说——快而不俗。\n准备把默认浏览器改成FQ，用一段时间看看。\n","permalink":"http://0x3f.org/posts/firefox-quantum/","summary":"\u003cp\u003e不知不觉已经很多年没有用过Firefox了。在Chrome发布之前，这只狐狸以一己之力扛著互联网承前启后的大旗。后来被Chrome在网页加载速度上吊打，逐渐式微。之后还在用Firefox的人一般也只是因为受不了Chrome的内存占用。\u003c/p\u003e\n\u003cp\u003eFirefox Quantum刚发布的时候我就安装了，以为是个全新的项目，新项目初期往往特性不健全，所以就没有太多关注。\u003c/p\u003e\n\u003cp\u003e然后发现版本号接续了旧版，也兼容原Firefox的插件，所以就装上几个必要的插件，尝试了一下。新的UI借鉴了Chrome，不像原来那么过时。最重要的是内存占用和网页打开速度比Chrome有优势。如官方宣传语所说——快而不俗。\u003c/p\u003e\n\u003cp\u003e准备把默认浏览器改成FQ，用一段时间看看。\u003c/p\u003e","title":"Firefox Quantum：狐狸的反击"},{"content":"StanAngeloff/php.vim应该是目前最新、最全的PHP语法高亮插件了，它解决了旧版本无法高亮@throws的问题。\n默认会把方法注释全部当做普通注释显示，也就是没有高亮，需要专门做配置：\n1 2 3 4 5 6 7 8 9 function! PhpSyntaxOverride() hi! def link phpDocTags phpDefine hi! def link phpDocParam phpType endfunction augroup phpSyntaxOverride autocmd! autocmd FileType php call PhpSyntaxOverride() augroup END ","permalink":"http://0x3f.org/posts/the-best-php-syntax-file-of-vim/","summary":"\u003cp\u003e\u003ca href=\"https://github.com/StanAngeloff/php.vim\"\u003eStanAngeloff/php.vim\u003c/a\u003e应该是目前最新、最全的PHP语法高亮插件了，它解决了旧版本无法高亮\u003ccode\u003e@throws\u003c/code\u003e的问题。\u003c/p\u003e\n\u003cp\u003e默认会把方法注释全部当做普通注释显示，也就是没有高亮，需要专门做配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e9\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003ePhpSyntaxOverride\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ehi\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003edef\u003c/span\u003e \u003cspan class=\"nx\"\u003elink\u003c/span\u003e \u003cspan class=\"nx\"\u003ephpDocTags\u003c/span\u003e  \u003cspan class=\"nx\"\u003ephpDefine\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ehi\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003edef\u003c/span\u003e \u003cspan class=\"nx\"\u003elink\u003c/span\u003e \u003cspan class=\"nx\"\u003ephpDocParam\u003c/span\u003e \u003cspan class=\"nx\"\u003ephpType\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eaugroup\u003c/span\u003e \u003cspan class=\"nx\"\u003ephpSyntaxOverride\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003ePhpSyntaxOverride\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eaugroup\u003c/span\u003e \u003cspan class=\"nx\"\u003eEND\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Vim最好的PHP语法高亮插件"},{"content":"我相信所有注重体验的人都不愿意用保护壳，我也一样，所以用iPhone 6的两年多里绝大部分时间也都是裸奔。\n对于给X加壳这件事，我是很矛盾的，然而面对这个既易碎又碎不起的东西，贫穷限制了我对体验的偏执。\n对于壳的选择，我有这些考虑：\n防护性好：毕竟这是加壳的唯一目的，所以那些超薄的壳就在考虑范围内了。 易装卸：只有出门时会加壳，在家要去掉，所以这是个很频繁的行为，既要容易操作，又要不伤手机。 易维护：方便清洁，所以皮质的就不考虑了。 贴合度高，触感好：体验还是很重要，软壳一般很难做到这一点，所以范围限制在硬壳上。 外观简约。 材料安全。 试错成本低：少花冤枉钱，节省时间精力。 符合这些条件的就只剩下官方硅胶壳了，然而我还是在颜色的选择上纠结了很长时间。因为硅胶壳容易粘灰，所以越是浅色越不明显，然而深色可以减少和X黑色前面板的割裂感。最终选择了钴蓝色。\n用了一周的时间，完全符合预期。\n","permalink":"http://0x3f.org/posts/iphone-x-silicone-case/","summary":"\u003cp\u003e我相信所有注重体验的人都不愿意用保护壳，我也一样，所以用iPhone 6的两年多里绝大部分时间也都是裸奔。\u003c/p\u003e\n\u003cp\u003e对于给X加壳这件事，我是很矛盾的，然而面对这个既易碎又碎不起的东西，贫穷限制了我对体验的偏执。\u003c/p\u003e\n\u003cp\u003e对于壳的选择，我有这些考虑：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e防护性好：毕竟这是加壳的唯一目的，所以那些超薄的壳就在考虑范围内了。\u003c/li\u003e\n\u003cli\u003e易装卸：只有出门时会加壳，在家要去掉，所以这是个很频繁的行为，既要容易操作，又要不伤手机。\u003c/li\u003e\n\u003cli\u003e易维护：方便清洁，所以皮质的就不考虑了。\u003c/li\u003e\n\u003cli\u003e贴合度高，触感好：体验还是很重要，软壳一般很难做到这一点，所以范围限制在硬壳上。\u003c/li\u003e\n\u003cli\u003e外观简约。\u003c/li\u003e\n\u003cli\u003e材料安全。\u003c/li\u003e\n\u003cli\u003e试错成本低：少花冤枉钱，节省时间精力。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e符合这些条件的就只剩下官方硅胶壳了，然而我还是在颜色的选择上纠结了很长时间。因为硅胶壳容易粘灰，所以越是浅色越不明显，然而深色可以减少和X黑色前面板的割裂感。最终选择了钴蓝色。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvwz3j8r1j31kw16onpd.jpg\" alt=\"IMG_0008\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvwzf3edsj31kw16oqv5.jpg\" alt=\"IMG_0009\"\u003e\u003c/p\u003e\n\u003cp\u003e用了一周的时间，完全符合预期。\u003c/p\u003e","title":"iPhone X官方硅胶保护壳使用感受"},{"content":"上周看了《疾速追杀》和《疾速特攻》，后者是前者的第二部。\n情节比较老套：一个因爱退隐的职业杀手，在妻子病逝、黑道欺凌下，不得以奋起反击、与整个杀手行业为敌，最后善恶有报、空余萧索。\n知道这部戏是因为和《极寒之城》是同一个导演，卖点都是暴力美学，风格不同。《极寒之城》用不加特效的长镜头表现格斗的残酷，画风冷峻。《疾速》系列更像《杀死比尔》，场面华丽，十步杀一人、千里不留行。\n关于暴力美学，维基百科是这么解释的：\n主要在官感上，使暴力以美学的方式呈现，诗意的画面，甚至幻想中的镜头来表现人性暴力面和暴力行为。观赏者本身往往惊叹于艺术化的表现形式，无法对内容产生具体的不舒适感。支持人士往往称「暴力程度与票房收入成正比」，社会道德捍卫者和舆论谴责人士则称其是对社会道德教化的阻碍和负面影响；恐引发心理未臻成熟的人们，间接以为暴力行为亦是一种美感的呈现。\n在众多香港导演中，吴宇森是运用这种电影表现手法的代表性人物。其标志性的白鸽漫天飞舞，手持双枪的英雄人物纵横在屏幕之上，使象征和平和安详的白鸽与血腥暴力的枪弹形成了强烈的视觉反差，吸引了无数的目光。\n然而我并不打算马上去看新《追捕》，炒冷饭的鲜有好戏，等等再说。\n","permalink":"http://0x3f.org/posts/movie-john-wick/","summary":"\u003cp\u003e上周看了《疾速追杀》和《疾速特攻》，后者是前者的第二部。\u003c/p\u003e\n\u003cp\u003e情节比较老套：一个因爱退隐的职业杀手，在妻子病逝、黑道欺凌下，不得以奋起反击、与整个杀手行业为敌，最后善恶有报、空余萧索。\u003c/p\u003e\n\u003cp\u003e知道这部戏是因为和《极寒之城》是同一个导演，卖点都是暴力美学，风格不同。《极寒之城》用不加特效的长镜头表现格斗的残酷，画风冷峻。《疾速》系列更像《杀死比尔》，场面华丽，十步杀一人、千里不留行。\u003c/p\u003e\n\u003cp\u003e关于暴力美学，维基百科是这么解释的：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e主要在官感上，使暴力以美学的方式呈现，诗意的画面，甚至幻想中的镜头来表现人性暴力面和暴力行为。观赏者本身往往惊叹于艺术化的表现形式，无法对内容产生具体的不舒适感。支持人士往往称「暴力程度与票房收入成正比」，社会道德捍卫者和舆论谴责人士则称其是对社会道德教化的阻碍和负面影响；恐引发心理未臻成熟的人们，间接以为暴力行为亦是一种美感的呈现。\u003c/p\u003e\n\u003cp\u003e在众多香港导演中，吴宇森是运用这种电影表现手法的代表性人物。其标志性的白鸽漫天飞舞，手持双枪的英雄人物纵横在屏幕之上，使象征和平和安详的白鸽与血腥暴力的枪弹形成了强烈的视觉反差，吸引了无数的目光。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e然而我并不打算马上去看新《追捕》，炒冷饭的鲜有好戏，等等再说。\u003c/p\u003e","title":"电影《疾速追杀》"},{"content":"上手用了两天，感觉优点多于缺点，总体是进步的。\n如果没有新的工业设计，我可能会把小6继续用下去。毕竟当初就对小6的白带和粗边框很不满意，虽然8因为改回玻璃背板已经基本解决白带问题，但是前面板几乎没有变化，一个工业设计用了四代，再优秀也审美疲劳了，而且那个屏占比在现在的千元机里也是倒数了，哪怕把边框做得再窄一点，8也不至于跳水成现在这样。\n买的银色，实际观感更接近乳白色，而深空灰更接近黑色。后者配色的一体性并没有别人说的那么好，而前者配色也没有很强的割裂感。\n宽度比6稍大，长度更长，单手握持无压力，不过单手操作就别想了，即使是6，搭配指环单手操作也不方便。\n前面板在息屏状态下一体性很好。当然我不认为这是个很重要的标准，好像罗永浩说过黑色边框可以隐藏低成本的做工，白色边框想做好更难，不管真假，息屏美学就是个营销手段，有谁会盯著息屏的手机瞅？\n功能方面，这次最大的卖点就是Face ID，体验真是比Touch ID好太多！尤其是我手汗多，指纹解锁失败率很高，不过这些年倒是因此养成了一天洗几十次手的习惯……\n性能上，找回了6在iOS8时的流畅度。如果没有意外，6在iOS11下就现在这德性了，追求流畅度的在10.3.3止步吧。\n拍照方面，「世界第二」的摄像头效果搭配人像模式效果比6好很多。\n至于续航，虽然免不了一天一充，起码比6在iOS11下强多了，毕竟多了一千毫安。\n此外，作为古老的小6的用户，3D Touch、抬手亮屏、随时喊Siri也有更好的体验。\n屏幕方面，全面屏+OLED效果拔群。看久了X的屏幕，再看6的会觉得模糊很多。另外，True Tone比起Night Shift也更智能了。\n异形屏不是苹果的首创，全面屏也不是小米的首创，而它们连同三星S8已然成了全面屏的三个流派。我个人更倾向于异形屏，虽然iPhone X的屏占比实际上并不是非常高，不过观感上更彻底。S8用曲面屏把左右边框做到视觉上宽度接近零，不过三星的供货问题是这个流派最大的障碍。至于小米MIX，完全就是在低成本、供应链和软件生态话语权弱、硬件技术落后等因素作用下、利用普通LCD面板追全面屏热度的怪胎。MIX1就是个半成品，到了MIX2才算基本可用。所以小米不是第一个做全面屏的，但是是第一个不要脸的，还是老罗实在，「全面屏」后面还加个「almost」。\n未来一两年，从千元机到高端机会全面普及全面屏。中低端机型主流应该会选择坚果Pro2的风格，用普通面板，然后尽量把边框做窄。高端机型在异型屏和曲面屏之间会有一场好戏。\n取消Home键换来的新的交互方式，整体上是进步了。回到主界面和切换任务这两个常用操作改用触摸手势，取消了到实体键的依赖，也提高了效率。侧边键得到了更充分的利用，呼出Siri和Apple Pay从Home键挪了过来。如果同时按侧边键+音量减能自定义或者实现像坚果Pro2闪念胶囊按键那样的功能会更好。\n缺点主要是边框和厚度，原本我对小6的厚度是很满意的，只是希望把边框做窄点。现在不但祖传的粗边还在，还越做越厚是什么毛病？！\n","permalink":"http://0x3f.org/posts/iphone-x/","summary":"\u003cp\u003e上手用了两天，感觉优点多于缺点，总体是进步的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvwxh8lvvj31kw16ohdv.jpg\" alt=\"P1030587\"\u003e\u003c/p\u003e\n\u003cp\u003e如果没有新的工业设计，我可能会把小6继续用下去。毕竟当初就对小6的白带和粗边框很不满意，虽然8因为改回玻璃背板已经基本解决白带问题，但是前面板几乎没有变化，一个工业设计用了四代，再优秀也审美疲劳了，而且那个屏占比在现在的千元机里也是倒数了，哪怕把边框做得再窄一点，8也不至于跳水成现在这样。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvwxoqh8rj31kw16ohdv.jpg\" alt=\"P1030579\"\u003e\u003c/p\u003e\n\u003cp\u003e买的银色，实际观感更接近乳白色，而深空灰更接近黑色。后者配色的一体性并没有别人说的那么好，而前者配色也没有很强的割裂感。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvwxy4xfyj31kw16ob2b.jpg\" alt=\"P1030585\"\u003e\u003c/p\u003e\n\u003cp\u003e宽度比6稍大，长度更长，单手握持无压力，不过单手操作就别想了，即使是6，搭配指环单手操作也不方便。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvwy2ob4ej31kw16ob2b.jpg\" alt=\"P1030584\"\u003e\u003c/p\u003e\n\u003cp\u003e前面板在息屏状态下一体性很好。当然我不认为这是个很重要的标准，好像罗永浩说过黑色边框可以隐藏低成本的做工，白色边框想做好更难，不管真假，息屏美学就是个营销手段，有谁会盯著息屏的手机瞅？\u003c/p\u003e\n\u003cp\u003e功能方面，这次最大的卖点就是Face ID，体验真是比Touch ID好太多！尤其是我手汗多，指纹解锁失败率很高，不过这些年倒是因此养成了一天洗几十次手的习惯……\u003c/p\u003e\n\u003cp\u003e性能上，找回了6在iOS8时的流畅度。如果没有意外，6在iOS11下就现在这德性了，追求流畅度的在10.3.3止步吧。\u003c/p\u003e\n\u003cp\u003e拍照方面，「世界第二」的摄像头效果搭配人像模式效果比6好很多。\u003c/p\u003e\n\u003cp\u003e至于续航，虽然免不了一天一充，起码比6在iOS11下强多了，毕竟多了一千毫安。\u003c/p\u003e\n\u003cp\u003e此外，作为古老的小6的用户，3D Touch、抬手亮屏、随时喊Siri也有更好的体验。\u003c/p\u003e\n\u003cp\u003e屏幕方面，全面屏+OLED效果拔群。看久了X的屏幕，再看6的会觉得模糊很多。另外，True Tone比起Night Shift也更智能了。\u003c/p\u003e\n\u003cp\u003e异形屏不是苹果的首创，全面屏也不是小米的首创，而它们连同三星S8已然成了全面屏的三个流派。我个人更倾向于异形屏，虽然iPhone X的屏占比实际上并不是非常高，不过观感上更彻底。S8用曲面屏把左右边框做到视觉上宽度接近零，不过三星的供货问题是这个流派最大的障碍。至于小米MIX，完全就是在低成本、供应链和软件生态话语权弱、硬件技术落后等因素作用下、利用普通LCD面板追全面屏热度的怪胎。MIX1就是个半成品，到了MIX2才算基本可用。所以小米不是第一个做全面屏的，但是是第一个不要脸的，还是老罗实在，「全面屏」后面还加个「almost」。\u003c/p\u003e\n\u003cp\u003e未来一两年，从千元机到高端机会全面普及全面屏。中低端机型主流应该会选择坚果Pro2的风格，用普通面板，然后尽量把边框做窄。高端机型在异型屏和曲面屏之间会有一场好戏。\u003c/p\u003e\n\u003cp\u003e取消Home键换来的新的交互方式，整体上是进步了。回到主界面和切换任务这两个常用操作改用触摸手势，取消了到实体键的依赖，也提高了效率。侧边键得到了更充分的利用，呼出Siri和Apple Pay从Home键挪了过来。如果同时按侧边键+音量减能自定义或者实现像坚果Pro2闪念胶囊按键那样的功能会更好。\u003c/p\u003e\n\u003cp\u003e缺点主要是边框和厚度，原本我对小6的厚度是很满意的，只是希望把边框做窄点。现在不但祖传的粗边还在，还越做越厚是什么毛病？！\u003c/p\u003e","title":"iPhone X使用感受"},{"content":"这是最近看的电影里让我印象最深的一部。\n故事背景是1989年柏林墙倒塌前发生在德国的一场谍战。剧情组织得很一般，冷战和谍战这两个卖点做得都不成功，虽然塞隆和波多拉两位女神的床戏挽救了一切，但是女同的卖点只是一道开胃菜，最精彩的部分是中后段的一场动作戏，塞隆单挑一群克格勃，同时还要保护一个东德叛谍，长达数分钟的一个长镜头，场面极为真实，一改一般好莱坞动作片里打不死的风格。\n","permalink":"http://0x3f.org/posts/movie-atomic-blonde/","summary":"\u003cp\u003e这是最近看的电影里让我印象最深的一部。\u003c/p\u003e\n\u003cp\u003e故事背景是1989年柏林墙倒塌前发生在德国的一场谍战。剧情组织得很一般，冷战和谍战这两个卖点做得都不成功，虽然塞隆和波多拉两位女神的床戏挽救了一切，但是女同的卖点只是一道开胃菜，最精彩的部分是中后段的一场动作戏，塞隆单挑一群克格勃，同时还要保护一个东德叛谍，长达数分钟的一个长镜头，场面极为真实，一改一般好莱坞动作片里打不死的风格。\u003c/p\u003e","title":"电影《极寒之城》"},{"content":"\n这本书讲的是「什么是美」。读完后对美有了一些基本的概念，才知道我的审美水平还停留在「以快感为美」的阶段。\n朱自清的序里的一些话说得很好：「新文化是「外国的影响」，自然不错；但说一般青年不留余地地鄙弃旧的文学艺术，却非真理。」、「许多青年腻味了，索性一切不管，只抱著一条道理，「有文艺的嗜好就可以谈文艺」。这是「以不了了之」，究竟「谈」不出什么来。」\n","permalink":"http://0x3f.org/posts/after-reading-tan-mei/","summary":"\u003cp\u003e\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvwx0p3twj31kw1kwhdu.jpg\" alt=\"fullsizeoutput_301\"\u003e\u003c/p\u003e\n\u003cp\u003e这本书讲的是「什么是美」。读完后对美有了一些基本的概念，才知道我的审美水平还停留在「以快感为美」的阶段。\u003c/p\u003e\n\u003cp\u003e朱自清的序里的一些话说得很好：「新文化是「外国的影响」，自然不错；但说一般青年不留余地地鄙弃旧的文学艺术，却非真理。」、「许多青年腻味了，索性一切不管，只抱著一条道理，「有文艺的嗜好就可以谈文艺」。这是「以不了了之」，究竟「谈」不出什么来。」\u003c/p\u003e","title":"读完《谈美》"},{"content":"优势 自定义过滤器 全功能，无限制 利用已有VPS，无需额外费用 安装 安装并启动docker 1 2 3 4 curl https://get.docker.com/ | sh // centos7 systemctl start docker 安装postgre 1 docker run -d --name ttrssdb nornagon/postgres 安装tiny tiny rss 1 docker run -d --link ttrssdb:db -p 80:80 -e SELF_URL_PATH=http://example.org/ttrss fischerman/docker-ttrss example.org替换成VPS的IP或者对应的域名。\n配置 配置主程序 访问http://example.org/ttrss，用户名admin，密码password。\n伪装成fever 如果RSS阅读器不支持ttrss，但支持fever，例如reeder，可以通过安装插件伪装成fever：\n1 2 3 git clone https://github.com/rannen/tinytinyrss-fever-plugin.git docker cp fever [[CONTAINER ID]]:/var/www/plugins 然后去设置见面启用fever插件，并在fever插件的配置栏设置单独的密码，该栏目中会显示在RSS阅读器中使用的接口地址，用户名就是admin。\n备份 每天凌晨3点备份数据库到dropbox。\n下载dropbox上传脚本 在VPS的/root下执行：\n1 wget https://raw.github.com/andreafabrizi/Dropbox-Uploader/master/dropbox_uploader.sh 执行命令并按提示操作：\n1 ./dropbox_uploader.sh info 创建备份脚本 创建/root/backup.sh：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/bin/bash SCRIPT_DIR=\u0026#34;/root\u0026#34; NOW=$(date +\u0026#34;%Y%m%d\u0026#34;) TMP_PATH=\u0026#39;/tmp\u0026#39; DOCKER_ID_TTRSS=\u0026#39;39cec6a7xcb7\u0026#39; TTRSS_DB=\u0026#34;$TMP_PATH/ttrss.sql\u0026#34; BAK_FILE_NAME=\u0026#34;vps-$NOW.tar.gz\u0026#34; BAK_FILE=\u0026#34;$TMP_PATH/$BAK_FILE_NAME\u0026#34; DROPBOX_DIR=\u0026#34;\u0026#34; docker exec \u0026#34;$DOCKER_ID_TTRSS\u0026#34; /usr/bin/pg_dump ttrss \u0026gt; \u0026#34;$TTRSS_DB\u0026#34; echo \u0026#34;数据库备份完成，打包网站数据中...\u0026#34; tar cfzP \u0026#34;$BAK_FILE\u0026#34; \u0026#34;$TTRSS_DB\u0026#34; echo \u0026#34;所有数据打包完成，准备上传...\u0026#34; # 用脚本上传到dropbox \u0026#34;$SCRIPT_DIR\u0026#34;/dropbox_uploader.sh upload \u0026#34;$BAK_FILE\u0026#34; \u0026#34;$DROPBOX_DIR/$BAK_FILE_NAME\u0026#34; if [ $? -eq 0 ];then echo \u0026#34;上传完成\u0026#34; else echo \u0026#34;上传失败，重新尝试\u0026#34; fi # 删除本地的临时文件 rm -f \u0026#34;$TTRSS_DB\u0026#34; \u0026#34;$BAK_FILE\u0026#34; 39cec6a7xcb7替换成实际的postgresql容器的ID。\n创建定时任务 在crontab -e 里添加：\n0 3 * * * /bin/bash /root/backup.sh \u0026gt; /dev/null ","permalink":"http://0x3f.org/posts/ttrss/","summary":"\u003ch2 id=\"优势\"\u003e优势\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e自定义过滤器\u003c/li\u003e\n\u003cli\u003e全功能，无限制\u003c/li\u003e\n\u003cli\u003e利用已有VPS，无需额外费用\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"安装\"\u003e安装\u003c/h2\u003e\n\u003ch3 id=\"安装并启动docker\"\u003e安装并启动docker\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl https://get.docker.com/ \u003cspan class=\"p\"\u003e|\u003c/span\u003e sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e// centos7\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl start docker\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"安装postgre\"\u003e安装postgre\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -d --name ttrssdb nornagon/postgres\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"安装tiny-tiny-rss\"\u003e安装tiny tiny rss\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -d --link ttrssdb:db -p 80:80 -e \u003cspan class=\"nv\"\u003eSELF_URL_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://example.org/ttrss fischerman/docker-ttrss\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003eexample.org\u003c/code\u003e替换成VPS的IP或者对应的域名。\u003c/p\u003e\n\u003ch2 id=\"配置\"\u003e配置\u003c/h2\u003e\n\u003ch3 id=\"配置主程序\"\u003e配置主程序\u003c/h3\u003e\n\u003cp\u003e访问\u003ccode\u003ehttp://example.org/ttrss\u003c/code\u003e，用户名\u003ccode\u003eadmin\u003c/code\u003e，密码\u003ccode\u003epassword\u003c/code\u003e。\u003c/p\u003e\n\u003ch3 id=\"伪装成fever\"\u003e伪装成fever\u003c/h3\u003e\n\u003cp\u003e如果RSS阅读器不支持ttrss，但支持fever，例如reeder，可以通过安装插件伪装成fever：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/rannen/tinytinyrss-fever-plugin.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker cp fever \u003cspan class=\"o\"\u003e[[\u003c/span\u003eCONTAINER ID\u003cspan class=\"o\"\u003e]]\u003c/span\u003e:/var/www/plugins\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后去设置见面启用fever插件，并在fever插件的配置栏设置单独的密码，该栏目中会显示在RSS阅读器中使用的接口地址，用户名就是\u003ccode\u003eadmin\u003c/code\u003e。\u003c/p\u003e\n\u003ch2 id=\"备份\"\u003e备份\u003c/h2\u003e\n\u003cp\u003e每天凌晨3点备份数据库到dropbox。\u003c/p\u003e\n\u003ch3 id=\"下载dropbox上传脚本\"\u003e下载dropbox上传脚本\u003c/h3\u003e\n\u003cp\u003e在VPS的\u003ccode\u003e/root\u003c/code\u003e下执行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://raw.github.com/andreafabrizi/Dropbox-Uploader/master/dropbox_uploader.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e执行命令并按提示操作：\u003c/p\u003e","title":"用Tiny Tiny RSS搭建私人阅读器的步骤"},{"content":"我见过两种程序员，一种是想做事的，一种是混饭吃的。\n第一种人最容易犯两个错误，一是过度优化，二是过度设计。两种错误共同的原因是经验不足，不同的地方是过度优化往往出于知其然不知其所以然，而过度设计一般是想得太远从而脱离实际。\n比如我见过的一个人，凡是联表的语句，都要拆开来写，完全不考虑这些联表语句实际会不会发生性能问题。**这就是过度优化，只记住一些成例和范式，不从实际出发，胶柱鼓瑟，刻舟求剑。**联表当然会造成数据量以笛卡尔积的形式增长，但如果所联表的数据量并不大，或者通过限制条件过滤后的数据量不大，并不会出现性能问题，而拆开SQL语句会导致代码量增大、可读性下降，是得不偿失的。\n至于过度设计，我自己就是个很好的反面教材。刚工作的时候，我在写程序之前和过程中会不断地冒出新的想法，设想到很多种可能，为了照顾到这些可能性，我会不断地重构程序，导致出活很慢。多数人并不会认真了解别人，只是从结果上武断地下结论。所以关于我写程序太慢的说法就悄悄流传开，而那些程序写得很烂、混饭吃但出活很快的人反而获利颇丰。最可笑的是过了很长时间后回顾曾经设想到的可能性，几乎全部没有发生。为一些将来可能发生而实际没有发生的可能性，在一开始就花费更多的成本，这就是过度设计。\n不过经验作为知识存量，是不值钱的，假以时间，有一定认知水平、不甘于庸俗的人总可以积累得到。所以相对于第二种人，我宁愿和第一种共事。\n","permalink":"http://0x3f.org/posts/talk-about-excessive-design/","summary":"\u003cp\u003e我见过两种程序员，一种是想做事的，一种是混饭吃的。\u003c/p\u003e\n\u003cp\u003e第一种人最容易犯两个错误，一是过度优化，二是过度设计。两种错误共同的原因是经验不足，不同的地方是过度优化往往出于知其然不知其所以然，而过度设计一般是想得太远从而脱离实际。\u003c/p\u003e\n\u003cp\u003e比如我见过的一个人，凡是联表的语句，都要拆开来写，完全不考虑这些联表语句实际会不会发生性能问题。**这就是过度优化，只记住一些成例和范式，不从实际出发，胶柱鼓瑟，刻舟求剑。**联表当然会造成数据量以笛卡尔积的形式增长，但如果所联表的数据量并不大，或者通过限制条件过滤后的数据量不大，并不会出现性能问题，而拆开SQL语句会导致代码量增大、可读性下降，是得不偿失的。\u003c/p\u003e\n\u003cp\u003e至于过度设计，我自己就是个很好的反面教材。刚工作的时候，我在写程序之前和过程中会不断地冒出新的想法，设想到很多种可能，为了照顾到这些可能性，我会不断地重构程序，导致出活很慢。多数人并不会认真了解别人，只是从结果上武断地下结论。所以关于我写程序太慢的说法就悄悄流传开，而那些程序写得很烂、混饭吃但出活很快的人反而获利颇丰。最可笑的是过了很长时间后回顾曾经设想到的可能性，几乎全部没有发生。\u003cstrong\u003e为一些将来可能发生而实际没有发生的可能性，在一开始就花费更多的成本，这就是过度设计。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e不过经验作为知识存量，是不值钱的，假以时间，有一定认知水平、不甘于庸俗的人总可以积累得到。所以相对于第二种人，我宁愿和第一种共事。\u003c/p\u003e","title":"过度优化和过度设计"},{"content":"搭在vultr东京节点的SS在家里的网络上已经不能用了，lantern和大杀器也不稳定到基本没有可用性的程度。短短几天时间，三把梯子挂了仨。\n搭好了SSR，等着晚上回去测试。\nSSR一键部署脚本：https://github.com/91yun/shadowsocks_install Mac的SSR客户端：https://github.com/qinyuhang/ShadowsocksX-NG-R/releases iOS的SSR客户端：ShadowRocket ","permalink":"http://0x3f.org/posts/ready-for-ssr/","summary":"\u003cp\u003e搭在vultr东京节点的SS在家里的网络上已经不能用了，lantern和大杀器也不稳定到基本没有可用性的程度。短短几天时间，三把梯子挂了仨。\u003c/p\u003e\n\u003cp\u003e搭好了SSR，等着晚上回去测试。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSSR一键部署脚本：https://github.com/91yun/shadowsocks_install\u003c/li\u003e\n\u003cli\u003eMac的SSR客户端：https://github.com/qinyuhang/ShadowsocksX-NG-R/releases\u003c/li\u003e\n\u003cli\u003eiOS的SSR客户端：ShadowRocket\u003c/li\u003e\n\u003c/ul\u003e","title":"搭好了SSR"},{"content":"gv.vim是fugitive的插件，用于查看git提交历史，特点是速度快、好用。我现在用它做code review。\n1 2 3 4 nnoremap \u0026lt;leader\u0026gt;gll :GV --no-merges\u0026lt;CR\u0026gt; nnoremap \u0026lt;leader\u0026gt;glc :GV!\u0026lt;CR\u0026gt; nnoremap \u0026lt;leader\u0026gt;gla :GV --no-merges --author\u0026lt;space\u0026gt; nnoremap \u0026lt;leader\u0026gt;glg :GV --no-merges --grep\u0026lt;space\u0026gt; ","permalink":"http://0x3f.org/posts/gv-vim/","summary":"\u003cp\u003e\u003ca href=\"https://github.com/junegunn/gv.vim\"\u003egv.vim\u003c/a\u003e是fugitive的插件，用于查看git提交历史，特点是速度快、好用。我现在用它做code review。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003egll\u003c/span\u003e :\u003cspan class=\"nx\"\u003eGV\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003eno\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003emerges\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eglc\u003c/span\u003e :\u003cspan class=\"nx\"\u003eGV\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003egla\u003c/span\u003e :\u003cspan class=\"nx\"\u003eGV\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003eno\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003emerges\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003espace\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eglg\u003c/span\u003e :\u003cspan class=\"nx\"\u003eGV\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003eno\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003emerges\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"nx\"\u003egrep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003espace\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"用gv.vim查看git提交历史"},{"content":"在:Gstatus中查看diff时，报错：\nError detected while processing function Phpqa#PhpLint: line 8: E684: list index out of range: 0 E116: Invalid arguments for function match(l:php_list[0],\u0026ldquo;No syntax errors\u0026rdquo;) == -1 E15: Invalid expression: 0 != v:shell_error \u0026amp;\u0026amp; match(l:php_list[0],\u0026ldquo;No syntax errors\u0026rdquo;) == -1\n这是phpqa的bug，有人创建了PR，但作者没有合并，需要手工合并：\n1 curl -L https://github.com/joonty/vim-phpqa/pull/43.patch | git am ","permalink":"http://0x3f.org/posts/solve-the-incompatablility-between-fugitive-and-phpqa/","summary":"\u003cp\u003e在\u003ccode\u003e:Gstatus\u003c/code\u003e中查看diff时，报错：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eError detected while processing function Phpqa#PhpLint:                                                                                                                                    \u003cbr\u003e\nline    8:                                                                                                                                                                                 \u003cbr\u003e\nE684: list index out of range: 0                                                                                                                                                           \u003cbr\u003e\nE116: Invalid arguments for function match(l:php_list[0],\u0026ldquo;No syntax errors\u0026rdquo;) == -1                                                                                                         \u003cbr\u003e\nE15: Invalid expression: 0 != v:shell_error \u0026amp;\u0026amp; match(l:php_list[0],\u0026ldquo;No syntax errors\u0026rdquo;) == -1\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这是phpqa的bug，有人创建了PR，但作者没有合并，需要手工合并：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -L https://github.com/joonty/vim-phpqa/pull/43.patch \u003cspan class=\"p\"\u003e|\u003c/span\u003e git am\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"解决phpqa和fugitive不兼容的问题"},{"content":"这是我读过的第一本美学书。梳理了中国文艺和审美发展的历史脉络，浅显易懂。\n多读点美学还是很有必要的，能减少点俗气，那就最好了。\n","permalink":"http://0x3f.org/posts/after-reading-historical-evolution-of-aesthetics/","summary":"\u003cp\u003e这是我读过的第一本美学书。梳理了中国文艺和审美发展的历史脉络，浅显易懂。\u003c/p\u003e\n\u003cp\u003e多读点美学还是很有必要的，能减少点俗气，那就最好了。\u003c/p\u003e","title":"读完《美的历程》"},{"content":"表前缀是个过时的东西。在计算机资源比较昂贵的时代，出于节约成本的需要，会把多个系统的数据放在同一个数据库实例里，所以才会用前缀区分。如今各种云的普及，使这个问题早已经不存在，大家的资源都是冗余的，没有人会把多个系统的表放到同一个库里，这会给运维带来不必要的麻烦。\n然而身边总是会遇到胶柱鼓瑟的人，知其然而不知其所以然。表前缀既非必要，又会导致一些问题。\n其一是写代码时的困扰。比如我经常会在用查询构造器时忘了给表别名加前缀，直到程序报错才突然想起来。\n其二是代码重构的问题。在构造SQL语句的过程中，总是免不了会写原生的语句，这时就得写死表前缀。如果将来表前缀发生变化，重构代码时会麻烦而容易出错。\n","permalink":"http://0x3f.org/posts/why-prefixes-are-not-needed-for-table-names/","summary":"\u003cp\u003e表前缀是个过时的东西。在计算机资源比较昂贵的时代，出于节约成本的需要，会把多个系统的数据放在同一个数据库实例里，所以才会用前缀区分。如今各种云的普及，使这个问题早已经不存在，大家的资源都是冗余的，没有人会把多个系统的表放到同一个库里，这会给运维带来不必要的麻烦。\u003c/p\u003e\n\u003cp\u003e然而身边总是会遇到胶柱鼓瑟的人，知其然而不知其所以然。表前缀既非必要，又会导致一些问题。\u003c/p\u003e\n\u003cp\u003e其一是写代码时的困扰。比如我经常会在用查询构造器时忘了给表别名加前缀，直到程序报错才突然想起来。\u003c/p\u003e\n\u003cp\u003e其二是代码重构的问题。在构造SQL语句的过程中，总是免不了会写原生的语句，这时就得写死表前缀。如果将来表前缀发生变化，重构代码时会麻烦而容易出错。\u003c/p\u003e","title":"为什么不应该给表名加前缀"},{"content":"AlfredTweet是用来解决“最后一公里”问题的东西，有了它就可以随时发推了。\n需要修改源码指定代理：\n1 2 3 4 5 6 7 8 9 // twitteroauth.php function http($url, $method, $postfields = NULL) { // ... curl_setopt($ci, CURLOPT_HTTPPROXYTUNNEL, TRUE); curl_setopt($ci, CURLOPT_PROXY, \u0026#39;127.0.0.1:1086\u0026#39;); curl_setopt($ci, CURLOPT_PROXYTYPE, CURLPROXY_SOCKS5); // ... } ","permalink":"http://0x3f.org/posts/tweet-with-alfredtweet/","summary":"\u003cp\u003eAlfredTweet是用来解决“最后一公里”问题的东西，有了它就可以随时发推了。\u003c/p\u003e\n\u003cp\u003e需要修改源码指定代理：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e9\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// twitteroauth.php\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003ehttp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$url\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$method\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$postfields\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"nx\"\u003ecurl_setopt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ci\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eCURLOPT_HTTPPROXYTUNNEL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eTRUE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecurl_setopt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ci\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eCURLOPT_PROXY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;127.0.0.1:1086\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecurl_setopt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ci\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eCURLOPT_PROXYTYPE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eCURLPROXY_SOCKS5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"用AlfredTweet发推"},{"content":"一周前读完了《汉书》。\n因为读过《资治通鉴》，这次并没有发现太多新鲜的东西，印象最深的是班氏父子的严谨，超过了两个司马。比如对于成帝的死，作为通史的《通鉴》居然写得比断代的《汉书》还详细，对于史书，详和实似乎是一对矛盾，前者自然更好看，而后者显然更严谨。\n秦汉之际，中国先后完成了两次宏大的社会实践。一次是秦的法家实践，一次是王莽的儒家改制。历史先后把机会给了构成中国日后民族性格最主要的两个思想流派，又用残酷的现实给这两个处处针锋相对的对头以当头棒喝。两家对对方缺陷的研究都在对方的失败里得到印证，而同时对自身的问题又都视而不见。这是非常戏剧性的一幕，儒法之争作为中国两千年政治的基本矛盾和规律，在一开始就被证明谁都不能独力承担给这个国家指明出路的责任。\n按照钱穆在《中国历代政治得失》里的说法，昂扬向上的知识分子在先秦百家争鸣最大成就的儒法两家全部失败后就颓了，怀疑和茫然蔓延开来，第一帝国也由此走向衰亡。而从另一角度，李泽厚在《美的历程》里却认为，社会实践的失败引发了思想的解放和自我意识的觉醒，第一帝国在政治上的失败并没有影响其文化向心力，胡尘狼烟中的北方仍以文弱江南为衣冠正朔所在。\n对于接下来的《后汉书》，我的期待不高，凭借门阀起家的光武帝一改前汉打压豪强的政策，章帝之后再无中兴，然后是在无休止的宦戚之争、鲜卑盗边和羌乱中回响的桓灵的叹息。\n第一帝国在巅峰中死去。\n","permalink":"http://0x3f.org/posts/after-reading-han-shu/","summary":"\u003cp\u003e一周前读完了《汉书》。\u003c/p\u003e\n\u003cp\u003e因为\u003ca href=\"/post/after-reading-tong-jian/\"\u003e读过《资治通鉴》\u003c/a\u003e，这次并没有发现太多新鲜的东西，印象最深的是班氏父子的严谨，超过了两个司马。比如对于成帝的死，作为通史的《通鉴》居然写得比断代的《汉书》还详细，对于史书，详和实似乎是一对矛盾，前者自然更好看，而后者显然更严谨。\u003c/p\u003e\n\u003cp\u003e秦汉之际，中国先后完成了两次宏大的社会实践。一次是秦的法家实践，一次是王莽的儒家改制。历史先后把机会给了构成中国日后民族性格最主要的两个思想流派，又用残酷的现实给这两个处处针锋相对的对头以当头棒喝。两家对对方缺陷的研究都在对方的失败里得到印证，而同时对自身的问题又都视而不见。这是非常戏剧性的一幕，儒法之争作为中国两千年政治的基本矛盾和规律，在一开始就被证明谁都不能独力承担给这个国家指明出路的责任。\u003c/p\u003e\n\u003cp\u003e按照钱穆在《中国历代政治得失》里的说法，昂扬向上的知识分子在先秦百家争鸣最大成就的儒法两家全部失败后就颓了，怀疑和茫然蔓延开来，第一帝国也由此走向衰亡。而从另一角度，李泽厚在《美的历程》里却认为，社会实践的失败引发了思想的解放和自我意识的觉醒，第一帝国在政治上的失败并没有影响其文化向心力，胡尘狼烟中的北方仍以文弱江南为衣冠正朔所在。\u003c/p\u003e\n\u003cp\u003e对于接下来的《后汉书》，我的期待不高，凭借门阀起家的光武帝一改前汉打压豪强的政策，章帝之后再无中兴，然后是在无休止的宦戚之争、鲜卑盗边和羌乱中回响的桓灵的叹息。\u003c/p\u003e\n\u003cp\u003e第一帝国在巅峰中死去。\u003c/p\u003e","title":"读完《汉书》"},{"content":"什么是docker docker是一种容器，这篇文章对容器的定义是：\n容器是一组运行在Linux操作系统上并使用命名空间进程进行分隔的进程，有了容器就无需再启动和维护虚拟机。与虚拟机技术相比，容器的最大不同之处在于打包格式和可移植性。构建容器的目的在于为现代基础设施降低占用空间和启动时间、提供重用性、更好地利用服务器资源，并更好地集成到整个开发生态系统中（例如持续集成和交付生命周期）。\n容器相对于虚拟机有以下优点：\n更高效地利用系统资源 更快的启动速度 一致的运行环境 持续的交付和部署 更轻松的迁移 维护和扩展的便利性 基本概念 镜像 Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。\n镜像分为黑箱镜像和dockerfile。\n前者通过实际创建和配置docker容器并通过docker commit记录每个版本的变更，优点是简单直观，缺点是不能记录在基础镜像上做了哪些操作，并且在多次修改之后，镜像会变得很臃肿。\ndockerfile是镜像的配置文件，部署时docker根据配置内容生成容器，优点是可以清楚地记录每次修改的内容、镜像体积很小，缺点是编写时比较复杂。\n容器 容器是镜像运行的实体。\n仓库 分发镜像的服务。\n编排 容器的编排包含如下一系列任务：\n调度（包括部署、复制、扩展、复活、重新调度、升级、降级等） 资源管理（内存、CPU、存储空间、端口、IP、镜像等） 服务管理（即使用标签、分组、命名空间、负载均衡和准备就绪检查将多个容器编排在一起） 安装 我在黑苹果下安装。Mac下安装docker有两种方式：Docker for Mac或Docker Toolbox。前者最简单，后者在前者的系统要求不能被满足的情况下使用。后者的卸载比较麻烦，具体参照这里。\n我用前种方式安装，启动时报错：\ncom.docker.osx.hyperkit.linux failed to start\n解决方法是到BIOS里打开VT特性，有说法说黑苹果不支持VT，我这里是可以的。\n镜像加速器 一般用阿里云的镜像服务。\ndocker的使用 拉取镜像 1 docker pull base/archlinux 列出镜像 1 docker images 创建容器 1 docker run --name arch --it base/archlinux bash 终止容器 exit或ctrl-d\n启动已终止容器 1 docker start arch attach运行中的容器 1 docker attach arch detach运行中的容器 ctrl+p ctrl+q或者：\n1 docker detach arch 查看容器 1 2 3 4 5 # 查看运行中的容器 docker ps -q # 查看所有，包括已终止的 docker ps -a 删除已终止容器 1 docker rm arch ","permalink":"http://0x3f.org/posts/what-is-docker/","summary":"\u003ch2 id=\"什么是docker\"\u003e什么是docker\u003c/h2\u003e\n\u003cp\u003edocker是一种容器，\u003ca href=\"http://www.infoq.com/cn/articles/container-landscape-2016\"\u003e这篇文章\u003c/a\u003e对容器的定义是：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e容器是一组运行在Linux操作系统上并使用命名空间进程进行分隔的进程，有了容器就无需再启动和维护虚拟机。与虚拟机技术相比，容器的最大不同之处在于打包格式和可移植性。构建容器的目的在于为现代基础设施降低占用空间和启动时间、提供重用性、更好地利用服务器资源，并更好地集成到整个开发生态系统中（例如持续集成和交付生命周期）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e容器相对于虚拟机有以下优点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e更高效地利用系统资源\u003c/li\u003e\n\u003cli\u003e更快的启动速度\u003c/li\u003e\n\u003cli\u003e一致的运行环境\u003c/li\u003e\n\u003cli\u003e持续的交付和部署\u003c/li\u003e\n\u003cli\u003e更轻松的迁移\u003c/li\u003e\n\u003cli\u003e维护和扩展的便利性\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"基本概念\"\u003e基本概念\u003c/h2\u003e\n\u003ch3 id=\"镜像\"\u003e镜像\u003c/h3\u003e\n\u003cp\u003eDocker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。\u003c/p\u003e\n\u003cp\u003e镜像分为黑箱镜像和dockerfile。\u003c/p\u003e\n\u003cp\u003e前者通过实际创建和配置docker容器并通过\u003ccode\u003edocker commit\u003c/code\u003e记录每个版本的变更，优点是简单直观，缺点是不能记录在基础镜像上做了哪些操作，并且在多次修改之后，镜像会变得很臃肿。\u003c/p\u003e\n\u003cp\u003edockerfile是镜像的配置文件，部署时docker根据配置内容生成容器，优点是可以清楚地记录每次修改的内容、镜像体积很小，缺点是编写时比较复杂。\u003c/p\u003e\n\u003ch3 id=\"容器\"\u003e容器\u003c/h3\u003e\n\u003cp\u003e容器是镜像运行的实体。\u003c/p\u003e\n\u003ch3 id=\"仓库\"\u003e仓库\u003c/h3\u003e\n\u003cp\u003e分发镜像的服务。\u003c/p\u003e\n\u003ch3 id=\"编排\"\u003e编排\u003c/h3\u003e\n\u003cp\u003e容器的编排包含如下一系列任务：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e调度（包括部署、复制、扩展、复活、重新调度、升级、降级等）\u003c/li\u003e\n\u003cli\u003e资源管理（内存、CPU、存储空间、端口、IP、镜像等）\u003c/li\u003e\n\u003cli\u003e服务管理（即使用标签、分组、命名空间、负载均衡和准备就绪检查将多个容器编排在一起）\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"安装\"\u003e安装\u003c/h2\u003e\n\u003cp\u003e我在黑苹果下安装。Mac下安装docker有两种方式：Docker for Mac或Docker Toolbox。前者最简单，后者在前者的系统要求不能被满足的情况下使用。后者的卸载比较麻烦，具体参照\u003ca href=\"https://github.com/widuu/chinese_docker/blob/master/installation/mac.md\"\u003e这里\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e我用前种方式安装，启动时报错：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ecom.docker.osx.hyperkit.linux failed to start\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e解决方法是到BIOS里打开VT特性，有说法说黑苹果不支持VT，我这里是可以的。\u003c/p\u003e\n\u003ch3 id=\"镜像加速器\"\u003e镜像加速器\u003c/h3\u003e\n\u003cp\u003e一般用阿里云的镜像服务。\u003c/p\u003e\n\u003ch2 id=\"docker的使用\"\u003edocker的使用\u003c/h2\u003e\n\u003ch3 id=\"拉取镜像\"\u003e拉取镜像\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker pull base/archlinux\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"列出镜像\"\u003e列出镜像\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker images\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"创建容器\"\u003e创建容器\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run --name arch --it base/archlinux bash\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"终止容器\"\u003e终止容器\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eexit\u003c/code\u003e或\u003ccode\u003ectrl-d\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"启动已终止容器\"\u003e启动已终止容器\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker start arch\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"attach运行中的容器\"\u003eattach运行中的容器\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker attach arch\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"detach运行中的容器\"\u003edetach运行中的容器\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ectrl+p ctrl+q\u003c/code\u003e或者：\u003c/p\u003e","title":"什么是docker"},{"content":"hexo在生成tag目录时默认保持大小写，如果tag名称掺杂了大小写，会导致用tag索引文章的链接无法访问。解决的办法是强制hexo使用小写的文件或目录名，修改_config.yml：\n1 filename_case: 1 即便如此，还要把之前生成的结果从托管服务器上删除，不过在Mac这样的不区分大小写的文件系统中，直接部署新生成的结果是无效的，这时需要删除hexo目录下的.deploy_git目录并重新部署：\n1 2 3 4 rm -rf .deploy_git hexo clean hexo d -g ","permalink":"http://0x3f.org/posts/let-hexo-use-lowercase-filename/","summary":"\u003cp\u003ehexo在生成tag目录时默认保持大小写，如果tag名称掺杂了大小写，会导致用tag索引文章的链接无法访问。解决的办法是强制hexo使用小写的文件或目录名，修改\u003ccode\u003e_config.yml\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yml\" data-lang=\"yml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003efilename_case\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e即便如此，还要把之前生成的结果从托管服务器上删除，不过在Mac这样的不区分大小写的文件系统中，直接部署新生成的结果是无效的，这时需要删除hexo目录下的\u003ccode\u003e.deploy_git\u003c/code\u003e目录并重新部署：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm -rf .deploy_git\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehexo clean\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehexo d -g\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"让hexo使用小写文件名"},{"content":"vim-test允许在Vim中直接执行一个或多个单元测试，并使用预设的或自定义的执行策略。\n例如，命令:TestNearest可以执行当前测试文件中离光标最近的一个测试方法。而:TestFile、:TestSuite和:TestLast分别执行整个测试文件、测试项目和最近一次执行过的测试。这在编写测试代码时能很大地提高效率。\n执行策略是执行测试的方式和环境。例如缺省状态下，将使用:!执行测试命令，这会从Vim切换回终端。而在MacVim下，可以选择在iTerm或者系统自带的Terminal中执行。\n","permalink":"http://0x3f.org/posts/make-writing-unit-tests-easier-with-vim-test/","summary":"\u003cp\u003evim-test允许在Vim中直接执行一个或多个单元测试，并使用预设的或自定义的执行策略。\u003c/p\u003e\n\u003cp\u003e例如，命令\u003ccode\u003e:TestNearest\u003c/code\u003e可以执行当前测试文件中离光标最近的一个测试方法。而\u003ccode\u003e:TestFile\u003c/code\u003e、\u003ccode\u003e:TestSuite\u003c/code\u003e和\u003ccode\u003e:TestLast\u003c/code\u003e分别执行整个测试文件、测试项目和最近一次执行过的测试。这在编写测试代码时能很大地提高效率。\u003c/p\u003e\n\u003cp\u003e执行策略是执行测试的方式和环境。例如缺省状态下，将使用\u003ccode\u003e:!\u003c/code\u003e执行测试命令，这会从Vim切换回终端。而在MacVim下，可以选择在iTerm或者系统自带的Terminal中执行。\u003c/p\u003e","title":"用vim-test简化单元测试的编写"},{"content":"我曾说过方正北魏楷书是最佳的阅读字体，不过后来感觉长时间阅读的体验还是普通的楷体更好。但这并不妨碍在Reeder、博客这种短时阅读场合突出页面的设计感。\n今天把博客（hexo）的webfont改成了方正北魏楷书，用font-spider压缩后，从13M缩减到1.4M。方法是这样的：\n首先把完整的字体复制到主题的字体目录中（themes/crisp/source/fonts），文件名为FZBeiWeiKaiShu-full.ttf。\n在CSS中加入webfont配置：\n1 2 3 4 5 @font-face { font-family: \u0026#39;FZBeiWeiKaiShu\u0026#39;; src: url(\u0026#39;../fonts/FZBeiWeiKaiShu.ttf\u0026#39;) format(\u0026#39;truetype\u0026#39;), url(\u0026#39;../fonts/FZBeiWeiKaiShu-full.ttf\u0026#39;) format(\u0026#39;truetype\u0026#39;); } FZBeiWeiKaiShu.ttf是压缩后的字体文件名，这样访问时浏览器会优先下载压缩后的字体。\n然后把CSS中使用字体的地方都指定为FZBeiWeiKaiShu。\n在博客根目录下创建脚本update_fonts.sh：\n1 2 3 4 5 6 7 8 9 10 11 12 #!/bin/sh hexo clean hexo g find public -name \u0026#34;*.html\u0026#34; |xargs sed -i \u0026#39;\u0026#39; \u0026#34;s#/styles/crisp.css#$HOME/Projects/blog/public/styles/crisp.css#g\u0026#34; find public -name \u0026#34;*.html\u0026#34;|xargs font-spider cp -f public/fonts/FZBeiWeiKaiShu.ttf themes/crisp/source/fonts/FZBeiWeiKaiShu.ttf hexo clean hexo s -g 除非用到新的字符，否则不需要经常更新字体。\nfont-spider会提示一共使用了多少种字符，我这么多年也只用到三千多种，真是太没文化了。🤥\n","permalink":"http://0x3f.org/posts/set-blog-webfont-to-fzbeiweikaishu/","summary":"\u003cp\u003e我曾说过\u003ca href=\"/post/best-practices-of-calibre-on-formatting/\"\u003e方正北魏楷书是最佳的阅读字体\u003c/a\u003e，不过后来感觉长时间阅读的体验还是普通的楷体更好。但这并不妨碍在Reeder、博客这种短时阅读场合突出页面的设计感。\u003c/p\u003e\n\u003cp\u003e今天把博客（hexo）的webfont改成了方正北魏楷书，用font-spider压缩后，从13M缩减到1.4M。方法是这样的：\u003c/p\u003e\n\u003cp\u003e首先把完整的字体复制到主题的字体目录中（themes/crisp/source/fonts），文件名为\u003ccode\u003eFZBeiWeiKaiShu-full.ttf\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e在CSS中加入webfont配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-css\" data-lang=\"css\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"k\"\u003efont-face\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \t\u003cspan class=\"nt\"\u003efont-family\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;FZBeiWeiKaiShu\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nt\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;../fonts/FZBeiWeiKaiShu.ttf\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nt\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;truetype\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"nt\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;../fonts/FZBeiWeiKaiShu-full.ttf\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nt\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;truetype\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003eFZBeiWeiKaiShu.ttf\u003c/code\u003e是压缩后的字体文件名，这样访问时浏览器会优先下载压缩后的字体。\u003c/p\u003e\n\u003cp\u003e然后把CSS中使用字体的地方都指定为\u003ccode\u003eFZBeiWeiKaiShu\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e在博客根目录下创建脚本\u003ccode\u003eupdate_fonts.sh\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehexo clean\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehexo g\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efind public -name \u003cspan class=\"s2\"\u003e\u0026#34;*.html\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003exargs sed -i \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;s#/styles/crisp.css#\u003c/span\u003e\u003cspan class=\"nv\"\u003e$HOME\u003c/span\u003e\u003cspan class=\"s2\"\u003e/Projects/blog/public/styles/crisp.css#g\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efind public -name \u003cspan class=\"s2\"\u003e\u0026#34;*.html\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003exargs font-spider\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp -f public/fonts/FZBeiWeiKaiShu.ttf themes/crisp/source/fonts/FZBeiWeiKaiShu.ttf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehexo clean\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehexo s -g\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e除非用到新的字符，否则不需要经常更新字体。\u003c/p\u003e\n\u003cp\u003efont-spider会提示一共使用了多少种字符，我这么多年也只用到三千多种，真是太没文化了。🤥\u003c/p\u003e","title":"把博客字体改成了方正北魏楷书"},{"content":"关于数据库操作是否应该mock的问题，我认为查询一般不应该mock，可以避免一些问题，但如果查询的结果可能影响到断言，就应该mock了。\nLaravel的DB facade完整的mock实例是这样的：\n","permalink":"http://0x3f.org/posts/how-to-mock-the-db-facade-of-laravel/","summary":"\u003cp\u003e关于数据库操作是否应该mock的问题，我认为查询一般不应该mock，可以避免一些问题，但如果查询的结果可能影响到断言，就应该mock了。\u003c/p\u003e\n\u003cp\u003eLaravel的DB facade完整的mock实例是这样的：\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/xbot/d0ace9c1ebdb161adf229c9a9c62f2bf.js\"\u003e\u003c/script\u003e","title":"Mock Laravel的DB Facade的方法"},{"content":"vim-laravel是个极简而实用的插件，只提供一个:Artisan命令。但它并不仅仅是artisan的一个wrapper，还可以实现一些贴心的自动化，利如自动打开artisan make:*创建的文件。\n","permalink":"http://0x3f.org/posts/speed-up-artisan-with-vim-laravel/","summary":"\u003cp\u003evim-laravel是个极简而实用的插件，只提供一个\u003ccode\u003e:Artisan\u003c/code\u003e命令。但它并不仅仅是\u003ccode\u003eartisan\u003c/code\u003e的一个wrapper，还可以实现一些贴心的自动化，利如自动打开\u003ccode\u003eartisan make:*\u003c/code\u003e创建的文件。\u003c/p\u003e","title":"用vim-laravel简化laravel下的开发"},{"content":"vim-php-namespace是个简单实用的插件，提供三种功能：\n自动用use语句导入光标下的类 自动把光标下的类名扩展成完整命名空间的格式 自动排序use语句 此外，还提供一个选项控制是否在导入类后自动排序use语句。\n","permalink":"http://0x3f.org/posts/manage-php-namespaces-with-vim-php-namespace/","summary":"\u003cp\u003evim-php-namespace是个简单实用的插件，提供三种功能：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自动用use语句导入光标下的类\u003c/li\u003e\n\u003cli\u003e自动把光标下的类名扩展成完整命名空间的格式\u003c/li\u003e\n\u003cli\u003e自动排序use语句\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e此外，还提供一个选项控制是否在导入类后自动排序use语句。\u003c/p\u003e","title":"用vim-php-namespace管理PHP的命名空间"},{"content":"昨天用vim-clevertab换掉了supertab，但是实际使用中总是出莫名其妙的问题。看了一下插件源码，使用全局变量判断状态，这是个很不靠谱的方案，所以还是卸掉了。\n下面的配置可以很好的解决问题：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 let g:UltiSnipsExpandTrigger=\u0026#34;\u0026lt;c-tab\u0026gt;\u0026#34; let g:UltiSnipsJumpForwardTrigger=\u0026#34;\u0026lt;c-tab\u0026gt;\u0026#34; let g:UltiSnipsJumpBackwardTrigger=\u0026#34;\u0026lt;s-tab\u0026gt;\u0026#34; let g:UltiSnipsSnippetsDir=\u0026#39;~/.vim/UltiSnips\u0026#39; let g:ulti_expand_or_jump_res = 0 function! CleverTab()\u0026#34;{{{ call UltiSnips#ExpandSnippetOrJump() if g:ulti_expand_or_jump_res return \u0026#34;\u0026#34; else if pumvisible() return \u0026#34;\\\u0026lt;c-n\u0026gt;\u0026#34; else return neocomplete#start_manual_complete() endif endif endfunction\u0026#34;}}} inoremap \u0026lt;silent\u0026gt; \u0026lt;tab\u0026gt; \u0026lt;c-r\u0026gt;=CleverTab()\u0026lt;cr\u0026gt; snoremap \u0026lt;silent\u0026gt; \u0026lt;tab\u0026gt; \u0026lt;esc\u0026gt;:call UltiSnips#ExpandSnippetOrJump()\u0026lt;cr\u0026gt; ultisnips没有禁用按键映射的开关，而默认的映射会干扰上述配置，所以这里把默认的映射改成了\u0026lt;c-tab\u0026gt;。\n","permalink":"http://0x3f.org/posts/reconcile-neocomplete-with-ultisnips/","summary":"\u003cp\u003e昨天用vim-clevertab换掉了supertab，但是实际使用中总是出莫名其妙的问题。看了一下插件源码，使用全局变量判断状态，这是个很不靠谱的方案，所以还是卸掉了。\u003c/p\u003e\n\u003cp\u003e下面的配置可以很好的解决问题：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eUltiSnipsExpandTrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;c-tab\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eUltiSnipsJumpForwardTrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;c-tab\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eUltiSnipsJumpBackwardTrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;s-tab\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eUltiSnipsSnippetsDir\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;~/.vim/UltiSnips\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eulti_expand_or_jump_res\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eCleverTab\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u0026#34;{{{\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eUltiSnips\u003c/span\u003e#\u003cspan class=\"nx\"\u003eExpandSnippetOrJump\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eulti_expand_or_jump_res\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003epumvisible\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\\\u0026lt;c-n\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eneocomplete\u003c/span\u003e#\u003cspan class=\"nx\"\u003estart_manual_complete\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\u0026#34;}}}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003einoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003esilent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003etab\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"nx\"\u003eCleverTab\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ecr\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003esnoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003esilent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003etab\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eesc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e:\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eUltiSnips\u003c/span\u003e#\u003cspan class=\"nx\"\u003eExpandSnippetOrJump\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ecr\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eultisnips没有禁用按键映射的开关，而默认的映射会干扰上述配置，所以这里把默认的映射改成了\u003ccode\u003e\u0026lt;c-tab\u0026gt;\u003c/code\u003e。\u003c/p\u003e","title":"使neocomplete和ultisnips共用tab键的方法"},{"content":"和RESTfull一样，GraphQL也是一种基于HTTP的接口实现方式。它区别于前者的主要有两点：数据格式的自定义和请求的合并。\n本质上，GraphQL是为了解决RESTful中前后端在业务逻辑上的耦合关系。在RESTful中，接口是为前端具体的业务需求定制的，从实现什么样的功能，到返回哪些数据，都是既定的，所以很难被其它业务逻辑共用，即使可以共用，前端也必须发送多个请求到后端，因而造成资源浪费、效率下降。\nGraphQL实现的是一套逻辑积木，每个封装好的业务逻辑都是原子的，前端可以自由选择使用哪些，也可以定制返回数据的格式。并且这一切，都可以通过一次请求实现。\n当然，GraphQL也有一些短板。比如缓存，对于RESTfull接口，可以根据操作的幂等性实现负载均衡层面的缓存，而对于GraphQL，由于请求数据格式灵活且可能很大，请求会用POST方式发送，这样就必须改变缓存的实现方式。再一点是嵌套的层级问题，GraphQL的灵活性允许查询类型之间彼此嵌套，如果层级过多，可能导致严重的性能和可用性问题，因此需要注意限制嵌套的层级。还有就是GraphQL的实现复杂度比RESTful要高，需要权衡使用哪种实现方案。\nGraphQL用schema管理接口，可以根据业务等因素划分schema，例如需要权限验证的和公开的。每个schema包含两类接口：query和mutation，分别用来查询和变更数据。\n下面在Laravel中简单实现一个query接口。\n先安装folklore/graphql库。\n实现文章类型：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 namespace App\\GraphQL\\Type; use GraphQL\\Type\\Definition\\Type; use Folklore\\GraphQL\\Support\\Type as GraphQLType; class PostType extends GraphQLType { public function fields() { return [ \u0026#39;id\u0026#39; =\u0026gt; [ \u0026#39;type\u0026#39; =\u0026gt; Type::nonNull(Type::string()), \u0026#39;description\u0026#39; =\u0026gt; \u0026#39;The id of the post\u0026#39; ], \u0026#39;title\u0026#39; =\u0026gt; [ \u0026#39;type\u0026#39; =\u0026gt; Type::string(), \u0026#39;description\u0026#39; =\u0026gt; \u0026#39;Post title\u0026#39; ] ]; } protected function resolveTitleField($root, $args) { return $root-\u0026gt;post_title; } } 实现文章的查询逻辑：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 namespace App\\GraphQL\\Query; use GraphQL; use GraphQL\\Type\\Definition\\Type; use Folklore\\GraphQL\\Support\\Query; use App\\Models\\Post; class PostQuery extends Query { public function type() { return Type::listOf(GraphQL::type(\u0026#39;Post\u0026#39;)); } public function resolve($root, $args) { if(isset($args[\u0026#39;id\u0026#39;])) { return Post::where(\u0026#39;id\u0026#39; , $args[\u0026#39;id\u0026#39;])-\u0026gt;get(); } else { return Post::all(); } } } 在config/graphql.php中注册类型和逻辑：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026#39;schemas\u0026#39; =\u0026gt; [ \u0026#39;default\u0026#39; =\u0026gt; [ \u0026#39;query\u0026#39; =\u0026gt; [ \u0026#39;posts\u0026#39; =\u0026gt; \u0026#39;App\\GraphQL\\Query\\PostQuery\u0026#39; ], \u0026#39;mutation\u0026#39; =\u0026gt; [ ] ], ], \u0026#39;types\u0026#39; =\u0026gt; [ \u0026#39;Post\u0026#39; =\u0026gt; \u0026#39;App\\GraphQL\\Type\\PostType\u0026#39;, ], 请求及结果如下：\nGraphQL并不是RESTful的替代方案，是否用前者替代后者，取决于是否愿意为了灵活性而增加复杂度。两者有各自的适用领域，GraphQL更适合用来实现开放接口。\n","permalink":"http://0x3f.org/posts/graphql-vs-restful/","summary":"\u003cp\u003e和RESTfull一样，GraphQL也是一种基于HTTP的接口实现方式。它区别于前者的主要有两点：数据格式的自定义和请求的合并。\u003c/p\u003e\n\u003cp\u003e本质上，GraphQL是为了解决RESTful中前后端在业务逻辑上的耦合关系。在RESTful中，接口是为前端具体的业务需求定制的，从实现什么样的功能，到返回哪些数据，都是既定的，所以很难被其它业务逻辑共用，即使可以共用，前端也必须发送多个请求到后端，因而造成资源浪费、效率下降。\u003c/p\u003e\n\u003cp\u003eGraphQL实现的是一套逻辑积木，每个封装好的业务逻辑都是原子的，前端可以自由选择使用哪些，也可以定制返回数据的格式。并且这一切，都可以通过一次请求实现。\u003c/p\u003e\n\u003cp\u003e当然，GraphQL也有一些短板。比如缓存，对于RESTfull接口，可以根据操作的幂等性实现负载均衡层面的缓存，而对于GraphQL，由于请求数据格式灵活且可能很大，请求会用POST方式发送，这样就必须改变缓存的实现方式。再一点是嵌套的层级问题，GraphQL的灵活性允许查询类型之间彼此嵌套，如果层级过多，可能导致严重的性能和可用性问题，因此需要注意限制嵌套的层级。还有就是GraphQL的实现复杂度比RESTful要高，需要权衡使用哪种实现方案。\u003c/p\u003e\n\u003cp\u003eGraphQL用schema管理接口，可以根据业务等因素划分schema，例如需要权限验证的和公开的。每个schema包含两类接口：query和mutation，分别用来查询和变更数据。\u003c/p\u003e\n\u003cp\u003e下面在Laravel中简单实现一个query接口。\u003c/p\u003e\n\u003cp\u003e先安装\u003ca href=\"https://github.com/Folkloreatelier/laravel-graphql\"\u003efolklore/graphql\u003c/a\u003e库。\u003c/p\u003e\n\u003cp\u003e实现文章类型：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nx\"\u003eApp\\GraphQL\\Type\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eGraphQL\\Type\\Definition\\Type\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eFolklore\\GraphQL\\Support\\Type\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eGraphQLType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePostType\u003c/span\u003e \u003cspan class=\"k\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eGraphQLType\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003efields\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"s1\"\u003e\u0026#39;id\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"s1\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eType\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003enonNull\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eType\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"s1\"\u003e\u0026#39;description\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;The id of the post\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"s1\"\u003e\u0026#39;title\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"s1\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eType\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"s1\"\u003e\u0026#39;description\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Post title\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eresolveTitleField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$root\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$root\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003epost_title\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e实现文章的查询逻辑：\u003c/p\u003e","title":"GraphQL：RESTful之外的接口实现方案"},{"content":"四年零两个月前，我在Vim的邮件组中征询pathogen和vundle的优劣。一个人建议我试试VAM，语气幽怨——他是它的作者。\n试过之后就从pathogen迁移到了VAM，因为它兼有前者和vundle的优点，在当时，这是最好的插件管理器。就这样用了很久，期间还写了点脚本简化插件的管理，VAM工作得很好。\n最近发现越来越多的插件的文档里提到vim-plug，亮点是支持并行安装和更新，这真是解决了VAM最大的痛点：我叠代了十年的vimrc里用了很多插件，串行的VAM每次更新都让我很痛苦。\n另外，vim-plug较VAM的另一个优势是简单。这倒不是说后者很难用，只是作者过于追求灵活性，导致有些工作实现起来相对更复杂。例如，有的插件安装之后需要做一些额外的操作，VAM需要自己实现回调函数，然后挂到post-install钩子上。而对于vim-plug，只需要在注册插件的地方增加一个选项。对于插件的懒加载，也是同样。\nVAM也有自己的优势。其中之一是可以自动处理依赖关系：当一个要被安装的插件依赖别的插件时，相应的依赖也会被自动安装。还有就是对多源的支持：既可以拉取github上的插件，也可以从vim.org或其它源安装。而vim-plug就只支持github。\n所以，vim-plug并没有全面超过VAM，只是没有明显的短板、功能又刚刚够用。\n","permalink":"http://0x3f.org/posts/replaced-vam-with-vim-plug/","summary":"\u003cp\u003e四年零两个月前，我在Vim的邮件组中\u003ca href=\"https://groups.google.com/forum/#!topic/vim_use/P3xpaHr8-do\"\u003e征询pathogen和vundle的优劣\u003c/a\u003e。一个人建议我试试VAM，语气幽怨——他是它的作者。\u003c/p\u003e\n\u003cp\u003e试过之后就从pathogen迁移到了VAM，因为它兼有前者和vundle的优点，在当时，这是最好的插件管理器。就这样用了很久，期间还写了点脚本\u003ca href=\"/post/simplify-vim-addon-installation-issues/\"\u003e简化插件的管理\u003c/a\u003e，VAM工作得很好。\u003c/p\u003e\n\u003cp\u003e最近发现越来越多的插件的文档里提到vim-plug，亮点是支持并行安装和更新，这真是解决了VAM最大的痛点：我叠代了十年的vimrc里用了很多插件，串行的VAM每次更新都让我很痛苦。\u003c/p\u003e\n\u003cp\u003e另外，vim-plug较VAM的另一个优势是简单。这倒不是说后者很难用，只是作者过于追求灵活性，导致有些工作实现起来相对更复杂。例如，有的插件安装之后需要做一些额外的操作，VAM需要自己实现回调函数，然后挂到post-install钩子上。而对于vim-plug，只需要在注册插件的地方增加一个选项。对于插件的懒加载，也是同样。\u003c/p\u003e\n\u003cp\u003eVAM也有自己的优势。其中之一是可以自动处理依赖关系：当一个要被安装的插件依赖别的插件时，相应的依赖也会被自动安装。还有就是对多源的支持：既可以拉取github上的插件，也可以从vim.org或其它源安装。而vim-plug就只支持github。\u003c/p\u003e\n\u003cp\u003e所以，vim-plug并没有全面超过VAM，只是没有明显的短板、功能又刚刚够用。\u003c/p\u003e","title":"用vim-plug换掉了vim-addon-manager"},{"content":"输入-显示每个窗口的hint，输入hint跳转，简单而高效：\n","permalink":"http://0x3f.org/posts/choosewin-vim/","summary":"\u003cp\u003e输入\u003ccode\u003e-\u003c/code\u003e显示每个窗口的hint，输入hint跳转，简单而高效：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvwyakdmzj30or0gan0m.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"用choosewin.vim切换窗口"},{"content":"前些天用denite取代unite，用--with-python3重装了vim，结果发现vdebug只支持python 2。\nvim同时只能在py2和py3中选一个，据说可以通过重新编译python实现共存，但是我在编译py3的时候失败。\nneovim同时支持两个版本，但是尝试deoplete失败，报「Invalid Channel」的错误，似乎是python-neovim的锅。而且由于neovim内建lua、不支持has('lua')，所以不能fall back到neocomplete。\n万般无奈，只好换回unite。\n","permalink":"http://0x3f.org/posts/bothered-by-python-2-vs-3/","summary":"\u003cp\u003e前些天用denite取代unite，用\u003ccode\u003e--with-python3\u003c/code\u003e重装了vim，结果发现vdebug只支持python 2。\u003c/p\u003e\n\u003cp\u003evim同时只能在py2和py3中选一个，据说可以通过重新编译python实现共存，但是我在编译py3的时候失败。\u003c/p\u003e\n\u003cp\u003eneovim同时支持两个版本，但是尝试deoplete失败，报「Invalid Channel」的错误，似乎是python-neovim的锅。而且由于neovim内建lua、不支持\u003ccode\u003ehas('lua')\u003c/code\u003e，所以不能fall back到neocomplete。\u003c/p\u003e\n\u003cp\u003e万般无奈，只好换回unite。\u003c/p\u003e","title":"Python 2还是3是个纠结的问题"},{"content":"闲鱼上突然收到询价消息，于是突发奇想，在闲置很久的X220上装个黑苹果玩玩。\n过程很简单，参考这两个链接：link1和link2。\n内置的无线网卡不能驱动，用了个闲置的USB卡。蓝牙能用耳机，但不能airdrop。关机会变重启。此外没别的问题了。\n现在计算机性能真是过剩的，n年前的机器，除了机械硬盘慢了点，其它毫无压力。\n我在twitter上说：“似可再战三年。”\n","permalink":"http://0x3f.org/posts/installed-hackintosh-in-thinkpad-x220/","summary":"\u003cp\u003e闲鱼上突然收到询价消息，于是突发奇想，在闲置很久的X220上装个黑苹果玩玩。\u003c/p\u003e\n\u003cp\u003e过程很简单，参考这两个链接：\u003ca href=\"https://www.youtube.com/watch?v=e_VDC-wUXis\"\u003elink1\u003c/a\u003e和\u003ca href=\"http://x220.mcdonnelltech.com\"\u003elink2\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvwwwbzydj30sg0sg7be.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e内置的无线网卡不能驱动，用了个闲置的USB卡。蓝牙能用耳机，但不能airdrop。关机会变重启。此外没别的问题了。\u003c/p\u003e\n\u003cp\u003e现在计算机性能真是过剩的，n年前的机器，除了机械硬盘慢了点，其它毫无压力。\u003c/p\u003e\n\u003cp\u003e我在twitter上说：“似可再战三年。”\u003c/p\u003e","title":"给Thinkpad X220装了黑苹果"},{"content":"goyo.vim是给vim提供专注写作模式的插件，配合markdown效果不错：\n最好在单独的vim实例中使用，已发现和vim-workspace配合不好的情况。\n对markdown文件自动开启goyo的配置如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 function! s:auto_goyo() if \u0026amp;ft == \u0026#39;markdown\u0026#39; Goyo 80 else let bufnr = bufnr(\u0026#39;%\u0026#39;) Goyo! execute \u0026#39;b \u0026#39;.bufnr endif endfunction augroup goyo_markdown autocmd! autocmd BufNewFile,BufRead * call s:auto_goyo() augroup END ","permalink":"http://0x3f.org/posts/distraction-free-writing-in-vim/","summary":"\u003cp\u003egoyo.vim是给vim提供专注写作模式的插件，配合markdown效果不错：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvwwvhfjlj31400p0q6b.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e最好在单独的vim实例中使用，已发现和vim-workspace配合不好的情况。\u003c/p\u003e\n\u003cp\u003e对markdown文件自动开启goyo的配置如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003eauto_goyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u0026amp;\u003cspan class=\"nx\"\u003eft\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;markdown\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eGoyo\u003c/span\u003e \u003cspan class=\"m\"\u003e80\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ebufnr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebufnr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eGoyo\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eexecute\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;b \u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003ebufnr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eaugroup\u003c/span\u003e \u003cspan class=\"nx\"\u003egoyo_markdown\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eBufNewFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003eBufRead\u003c/span\u003e * \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003eauto_goyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eaugroup\u003c/span\u003e \u003cspan class=\"nx\"\u003eEND\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"利用goyo.vim专注写作"},{"content":"用session.vim一直有几个痛点。一是保存会话后，退出时仍然会提示保存。二是会话会记录vimrc，恢复会话后用的仍然是旧的配置。\nvim-workspace没有这些问题，而且实现了更多功能。\n","permalink":"http://0x3f.org/posts/replace-session-vim-with-vim-workspace/","summary":"\u003cp\u003e用session.vim一直有几个痛点。一是保存会话后，退出时仍然会提示保存。二是会话会记录vimrc，恢复会话后用的仍然是旧的配置。\u003c/p\u003e\n\u003cp\u003evim-workspace没有这些问题，而且实现了更多功能。\u003c/p\u003e","title":"用vim-workspace换掉了session.vim"},{"content":"在尝试了多种方案后，我又一次换掉了自动补全插件。\n工具应该是能提高生产力的，而不是相反，很长一段时间以来，YouCompleteMe带给我的却是个疑惑，真不知道这个东东到底是提高了我的生产力，还是反之。自动补全在提高输入速度和准确度上都有助益，但是有时候补全选项弹出的又很慢。\n测试了nvim-complete-manager+LanguageClient-neovim+LanguageServer-php-neovim、deoplete+phpcd、deoplete+padawan、neocomplete+phpcomplete-extended，效果都非常不理想。最后选择了neocomplete+phpcomplete，速度可以接受，表现比YCM稳定，功能该有的都有。\n相关阅读： How to Make YouCompleteMe Compatible with UltiSnips Vim的终极自动补全插件：NeoComplCache ","permalink":"http://0x3f.org/posts/replace-youcompleteme-with-neocomplete/","summary":"\u003cp\u003e在尝试了多种方案后，我又一次换掉了自动补全插件。\u003c/p\u003e\n\u003cp\u003e工具应该是能提高生产力的，而不是相反，很长一段时间以来，YouCompleteMe带给我的却是个疑惑，真不知道这个东东到底是提高了我的生产力，还是反之。自动补全在提高输入速度和准确度上都有助益，但是有时候补全选项弹出的又很慢。\u003c/p\u003e\n\u003cp\u003e测试了nvim-complete-manager+LanguageClient-neovim+LanguageServer-php-neovim、deoplete+phpcd、deoplete+padawan、neocomplete+phpcomplete-extended，效果都非常不理想。最后选择了neocomplete+phpcomplete，速度可以接受，表现比YCM稳定，功能该有的都有。\u003c/p\u003e\n\u003ch3 id=\"相关阅读\"\u003e相关阅读：\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/post/make-youcompleteme-ultisnips-compatible/\"\u003eHow to Make YouCompleteMe Compatible with UltiSnips\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/neocomplcache-vim/\"\u003eVim的终极自动补全插件：NeoComplCache\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"用neocomplete换掉了YouCompleteMe"},{"content":"之前对比过几个模糊查询插件（Fuzzy Finder），最后选定了ctrlp。\n用了下LeaderF，在速度和匹配的准确度上都明显超过了ctrlp，所以用它换掉了后者。\n只是在交互方式上，我更喜欢ctrlp，文件列表高度是动态变化的，最匹配的行和输入焦点都在窗口的最下方。LeaderF是定高的，最匹配的行在最上方，个人认为不如前者自然。\n能解决痛点的才是好东西，什么时候能换掉YouCompleteMe就好了。\n","permalink":"http://0x3f.org/posts/leaderf-currently-the-best-fuzzy-finder-of-vim/","summary":"\u003cp\u003e之前\u003ca href=\"/post/ctrlp-vs-unite-vs-command-t-vs-fuzzyfinder/\"\u003e对比过几个模糊查询插件\u003c/a\u003e（Fuzzy Finder），最后选定了ctrlp。\u003c/p\u003e\n\u003cp\u003e用了下\u003ca href=\"https://github.com/Yggdroot/LeaderF\"\u003eLeaderF\u003c/a\u003e，在速度和匹配的准确度上都明显超过了ctrlp，所以用它换掉了后者。\u003c/p\u003e\n\u003cp\u003e只是在交互方式上，我更喜欢ctrlp，文件列表高度是动态变化的，最匹配的行和输入焦点都在窗口的最下方。LeaderF是定高的，最匹配的行在最上方，个人认为不如前者自然。\u003c/p\u003e\n\u003cp\u003e能解决痛点的才是好东西，什么时候能换掉YouCompleteMe就好了。\u003c/p\u003e","title":"LeaderF，也许是Vim最好的模糊查询插件"},{"content":"利用闭包绑定：\n1 2 3 4 5 6 7 $ctrlr = new UserController; $tester = function () use ($uid) { $this-\u0026gt;getUser($uid); }; $runner = $tester-\u0026gt;bindTo($ctrlr, $ctrlr); $runner(); ","permalink":"http://0x3f.org/posts/how-to-test-private-or-protected-methods-in-php/","summary":"\u003cp\u003e利用闭包绑定：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$ctrlr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserController\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$tester\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$uid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$uid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$runner\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tester\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ebindTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ctrlr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ctrlr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$runner\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"怎样测试PHP的Private或Protected方法"},{"content":"\n今年端午恰好是开公众号一周年，成绩就不晒了，因为没有成绩，当初的目标好像一个都没实现，想著端午写几句话，结果又拖了一个月……\n这一年跌宕起伏，却是不足与人道，倒是最近看了两部剧，感觉还不错。\n《白鹿原》前段时间很火，我没看过原著，好像我骨子里不是个喜欢小说的，十几年前听说这本书的时候也没什么去读的冲动。这次看拍得还不错，就买了乐视的会员，每天追到凌晨一点。整体来说质量不错，阵容不算豪华，主演的几位演技都挺好，适合我这种没看过原著又很龟毛的。看过的就不用追了，影视剧永远赶不上原著。\n《外乡人》的知名度就差远了，我也是从豆瓣上翻高分剧翻出来的。几年前的一部冷门剧，题材就很冷，讲沪漂的。剧情贴近现实，演员的表演也很真实，分数就高在这儿了，能做到这两点的太少了。\n题图是我的窗外，前段时间天气好的时候拍的，Snapseed真是个好东西，嗯。\n","permalink":"http://0x3f.org/posts/routine-talk-170629/","summary":"\u003cp\u003e\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvwyid54yj30wv0igdm7.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e今年端午恰好是开公众号一周年，成绩就不晒了，因为没有成绩，当初的目标好像一个都没实现，想著端午写几句话，结果又拖了一个月……\u003c/p\u003e\n\u003cp\u003e这一年跌宕起伏，却是不足与人道，倒是最近看了两部剧，感觉还不错。\u003c/p\u003e\n\u003cp\u003e《白鹿原》前段时间很火，我没看过原著，好像我骨子里不是个喜欢小说的，十几年前听说这本书的时候也没什么去读的冲动。这次看拍得还不错，就买了乐视的会员，每天追到凌晨一点。整体来说质量不错，阵容不算豪华，主演的几位演技都挺好，适合我这种没看过原著又很龟毛的。看过的就不用追了，影视剧永远赶不上原著。\u003c/p\u003e\n\u003cp\u003e《外乡人》的知名度就差远了，我也是从豆瓣上翻高分剧翻出来的。几年前的一部冷门剧，题材就很冷，讲沪漂的。剧情贴近现实，演员的表演也很真实，分数就高在这儿了，能做到这两点的太少了。\u003c/p\u003e\n\u003cp\u003e题图是我的窗外，前段时间天气好的时候拍的，Snapseed真是个好东西，嗯。\u003c/p\u003e","title":"白鹿原、外乡人和窗外"},{"content":"指定GVim 8使用Numix主题并最小程度影响既有的脚本、快捷键。\n我这里gvim安装在/usr/bin/gvim，$PATH中/usr/local/bin在/usr/bin前面，所以在/usr/local/bin下创建gvim：\n1 2 3 #!/bin/sh GTK_THEME=Numix /usr/bin/gvim \u0026#34;$@\u0026#34; 同理，对gvimdiff也做同样处理。\n","permalink":"http://0x3f.org/posts/specify-a-theme-for-each-gtk-3-app/","summary":"\u003cp\u003e指定GVim 8使用Numix主题并最小程度影响既有的脚本、快捷键。\u003c/p\u003e\n\u003cp\u003e我这里gvim安装在\u003ccode\u003e/usr/bin/gvim\u003c/code\u003e，$PATH中\u003ccode\u003e/usr/local/bin\u003c/code\u003e在\u003ccode\u003e/usr/bin\u003c/code\u003e前面，所以在\u003ccode\u003e/usr/local/bin\u003c/code\u003e下创建gvim：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eGTK_THEME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNumix /usr/bin/gvim \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$@\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e同理，对gvimdiff也做同样处理。\u003c/p\u003e","title":"为每个GTK3应用指定单独的主题"},{"content":"做以下配置，使mycli按需使用pager，并在数据过多时不破坏表格格式：\n1 2 3 4 # ~/.my.cnf [client] pager = less -FSXR ","permalink":"http://0x3f.org/posts/fine-tune-mycli/","summary":"\u003cp\u003e做以下配置，使mycli按需使用pager，并在数据过多时不破坏表格格式：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ~/.my.cnf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[client]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epager\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003eless -FSXR\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"调校mycli"},{"content":"实现根据文章的关键词搜索出相关的文章，并按相关性排序。\n数据库版本是5.6.x，还不能像5.7那样支持中文的全文检索，所以另外创建一列保存关键词的编码。方法为base64转码并去掉「%」符号：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;?php /** * 转换关键词到全文检索的格式 * * @param mixed $keywords 关键词数组或英文逗号分隔的字符串 * @return string */ function encode_keywords($keywords) { $encoder = function ($keyword) { return str_replace(\u0026#39;%\u0026#39;, \u0026#39;\u0026#39;, urlencode(trim($keyword))); }; if (!is_array($keywords)) { $keywords = explode(\u0026#39;,\u0026#39;, $keywords); } return implode(\u0026#39; \u0026#39;, array_map($encoder, $keywords)); } 对该列创建全文检索的索引：\n1 CREATE FULLTEXT INDEX idx_post_keywords ON posts (keywords_ft); 查询语句：\n1 2 3 4 5 6 7 8 9 10 11 SELECT id, title, keywords, (MATCH (keywords_ft) AGAINST (\u0026#39;E697B6E5B09A E5A8B1E4B990E59C88\u0026#39; IN NATURAL LANGUAGE MODE)) AS `score` FROM posts WHERE MATCH (keywords_ft) AGAINST (\u0026#39;E697B6E5B09A E5A8B1E4B990E59C88\u0026#39; IN NATURAL LANGUAGE MODE) ORDER BY score DESC LIMIT 10 ","permalink":"http://0x3f.org/posts/fulltext-searching-in-mysql/","summary":"\u003cp\u003e实现根据文章的关键词搜索出相关的文章，并按相关性排序。\u003c/p\u003e\n\u003cp\u003e数据库版本是5.6.x，还不能像5.7那样支持中文的全文检索，所以另外创建一列保存关键词的编码。方法为base64转码并去掉「%」符号：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * 转换关键词到全文检索的格式\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @param   mixed $keywords 关键词数组或英文逗号分隔的字符串\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @return  string\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eencode_keywords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$keywords\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$encoder\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$keyword\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003estr_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eurlencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etrim\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$keyword\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eis_array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$keywords\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$keywords\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eexplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;,\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$keywords\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eimplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003earray_map\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$keywords\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e对该列创建全文检索的索引：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eFULLTEXT\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eINDEX\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eidx_post_keywords\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eON\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eposts\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekeywords_ft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e查询语句：\u003c/p\u003e","title":"用MySQL的全文检索实现相关性排序"},{"content":"我对剪贴板管理工具的核心需求有四个：\n记录文本 记录图片 快速搜索 独立软件包 CopyQ是Linux上唯一满足这些需求的实现，虽然体验上跟Mac下的竞品还有差距。\n用法：\ncopyq：运行 copyq menu：显示剪贴板历史管理菜单 copyq show：显示剪贴板历史管理窗口 ","permalink":"http://0x3f.org/posts/copyq/","summary":"\u003cp\u003e我对剪贴板管理工具的核心需求有四个：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e记录文本\u003c/li\u003e\n\u003cli\u003e记录图片\u003c/li\u003e\n\u003cli\u003e快速搜索\u003c/li\u003e\n\u003cli\u003e独立软件包\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCopyQ是Linux上唯一满足这些需求的实现，虽然体验上跟Mac下的竞品还有差距。\u003c/p\u003e\n\u003cp\u003e用法：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecopyq\u003c/code\u003e：运行\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecopyq menu\u003c/code\u003e：显示剪贴板历史管理菜单\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecopyq show\u003c/code\u003e：显示剪贴板历史管理窗口\u003c/li\u003e\n\u003c/ul\u003e","title":"CopyQ，也许是Linux最好的剪贴板管理工具"},{"content":"我的iPhone 6总是在锁屏后不久就从华为E5573S断开，但是连接家里的WiFi不会有这个问题，iOS同版本的iPad mini 4连接E5573S也正常。\n两台机器里E5573S的连接属性界面有差异，iPhone 6里有「自动加入」等两个选项，这在同机其它WiFi连接里是没有的，iPad里也没有。所以猜测应该是iPhone里连接本身的问题，忽略掉该连接，再重新连，就好了。\n","permalink":"http://0x3f.org/posts/solve-the-auto-breaking-problem-of-huawei-e5573s/","summary":"\u003cp\u003e我的iPhone 6总是在锁屏后不久就从华为E5573S断开，但是连接家里的WiFi不会有这个问题，iOS同版本的iPad mini 4连接E5573S也正常。\u003c/p\u003e\n\u003cp\u003e两台机器里E5573S的连接属性界面有差异，iPhone 6里有「自动加入」等两个选项，这在同机其它WiFi连接里是没有的，iPad里也没有。所以猜测应该是iPhone里连接本身的问题，忽略掉该连接，再重新连，就好了。\u003c/p\u003e","title":"手机锁屏后自动断开WiFi的解决办法"},{"content":"Tmux的控制模式（Control Mode）可以把tmux的窗口映射为本地虚拟终端的窗口，也就是说，用户可以像操作本地虚拟终端一样操作tmux。这对备受tmux的emacs风格的热键绑定折磨或需要嵌套tmux的人来说非常有用。\n在支持这个特性的虚拟终端（例如「iTerm」）里，执行tmux -CC即可。当然也可以tmux -CC a恢复会话。\n","permalink":"http://0x3f.org/posts/improve-productivity-with-tmux-control-mode/","summary":"\u003cp\u003eTmux的控制模式（Control Mode）可以把tmux的窗口映射为本地虚拟终端的窗口，也就是说，用户可以像操作本地虚拟终端一样操作tmux。这对备受tmux的emacs风格的热键绑定折磨或需要嵌套tmux的人来说非常有用。\u003c/p\u003e\n\u003cp\u003e在支持这个特性的虚拟终端（例如「iTerm」）里，执行\u003ccode\u003etmux -CC\u003c/code\u003e即可。当然也可以\u003ccode\u003etmux -CC a\u003c/code\u003e恢复会话。\u003c/p\u003e","title":"用Tmux的控制模式提高生产力"},{"content":"最近在Archlinux上开始用SwitchHosts!管理主机映射方案，它可能是Linux下做这件事的最好的工具了。\n在Mac下也用它替换掉了Gas Mask，因为支持Alfred Workflow。相对的缺点是不支持在状态栏图标上显示当前方案名称，不过Alfred里可以，一定程度上缓解了这个问题。\n","permalink":"http://0x3f.org/posts/switch-hosts-with-switchhosts/","summary":"\u003cp\u003e最近在Archlinux上开始用SwitchHosts!管理主机映射方案，它可能是Linux下做这件事的最好的工具了。\u003c/p\u003e\n\u003cp\u003e在Mac下也用它替换掉了Gas Mask，因为支持Alfred Workflow。相对的缺点是不支持在状态栏图标上显示当前方案名称，不过Alfred里可以，一定程度上缓解了这个问题。\u003c/p\u003e","title":"用SwitchHosts!切换主机映射方案"},{"content":"GVim 8用的是GTK 3，原来在~/.gtkrc-2.0里加样式的方法不能用了。\nGTK 3的样式在~/.config/gtk-3.0/gtk.css里：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 /** * Adapt to the nova colorscheme */ @define-color VIM_BG_FIX #3C4C55; window#vim-main-window { background-color: @VIM_BG_FIX; } window#vim-main-window notebook header { background-color: #1E272C; border-bottom-width: 0; } window#vim-main-window notebook tab { border-bottom-width: 0; } window#vim-main-window notebook tab label { padding-left:5px; padding-right:5px; padding-top:1px; padding-bottom:2px; color: #7CBDC6; } window#vim-main-window notebook tab:checked label { background-color: #7CBDC6; color: #1E272C; } 查看GTK 3程序的样式结构的方法是用GTK Inspector：\n1 GTK_DEBUG=interactive gvim ","permalink":"http://0x3f.org/posts/how-to-customize-gvim8-tab-style/","summary":"\u003cp\u003eGVim 8用的是GTK 3，原来在\u003ccode\u003e~/.gtkrc-2.0\u003c/code\u003e里加样式的方法不能用了。\u003c/p\u003e\n\u003cp\u003eGTK 3的样式在\u003ccode\u003e~/.config/gtk-3.0/gtk.css\u003c/code\u003e里：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-css\" data-lang=\"css\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e * Adapt to the nova colorscheme\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"k\"\u003edefine-color\u003c/span\u003e \u003cspan class=\"nt\"\u003eVIM_BG_FIX\u003c/span\u003e \u003cspan class=\"p\"\u003e#\u003c/span\u003e\u003cspan class=\"nn\"\u003e3C4C55\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\u003cspan class=\"nn\"\u003evim-main-window\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ebackground-color\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eVIM_BG_FIX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\u003cspan class=\"nn\"\u003evim-main-window\u003c/span\u003e \u003cspan class=\"nt\"\u003enotebook\u003c/span\u003e \u003cspan class=\"nt\"\u003eheader\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ebackground-color\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mh\"\u003e#1E272C\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eborder-bottom-width\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\u003cspan class=\"nn\"\u003evim-main-window\u003c/span\u003e \u003cspan class=\"nt\"\u003enotebook\u003c/span\u003e \u003cspan class=\"nt\"\u003etab\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eborder-bottom-width\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\u003cspan class=\"nn\"\u003evim-main-window\u003c/span\u003e \u003cspan class=\"nt\"\u003enotebook\u003c/span\u003e \u003cspan class=\"nt\"\u003etab\u003c/span\u003e \u003cspan class=\"nt\"\u003elabel\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epadding-left\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"kt\"\u003epx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epadding-right\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"kt\"\u003epx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epadding-top\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"kt\"\u003epx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epadding-bottom\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"kt\"\u003epx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ecolor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mh\"\u003e#7CBDC6\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\u003cspan class=\"nn\"\u003evim-main-window\u003c/span\u003e \u003cspan class=\"nt\"\u003enotebook\u003c/span\u003e \u003cspan class=\"nt\"\u003etab\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nd\"\u003echecked\u003c/span\u003e \u003cspan class=\"nt\"\u003elabel\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ebackground-color\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mh\"\u003e#7CBDC6\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ecolor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mh\"\u003e#1E272C\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e查看GTK 3程序的样式结构的方法是用GTK Inspector：\u003c/p\u003e","title":"自定义GVIM 8标签栏样式的方法"},{"content":"v2ex、优酷、什么值得买用qiandao.today实现。优点是依赖少，速度快，支持的范围广，可扩展。缺点是对京东和京东金融无效。\n京东和京东金融使用daily-signin。缺点是依赖docker，速度慢。\n淘宝签到没有有效的脚本，用淘金币一键领取。\n飞猪也没有有效脚本，手工签：\nhttp://trip.taobao.com/mytrip/?tvm=tvip http://trip.taobao.com/mytrip/ http://h5.m.taobao.com/trip/member/index.html ","permalink":"http://0x3f.org/posts/the-best-practice-of-checking-in/","summary":"\u003cp\u003ev2ex、优酷、什么值得买用\u003ca href=\"https://qiandao.today\"\u003eqiandao.today\u003c/a\u003e实现。优点是依赖少，速度快，支持的范围广，可扩展。缺点是对京东和京东金融无效。\u003c/p\u003e\n\u003cp\u003e京东和京东金融使用\u003ca href=\"https://github.com/yidinghan/daily-signin\"\u003edaily-signin\u003c/a\u003e。缺点是依赖docker，速度慢。\u003c/p\u003e\n\u003cp\u003e淘宝签到没有有效的脚本，用\u003ca href=\"http://www.duoduodazhe.com/App/Web/Taobao-Coin/\"\u003e淘金币一键领取\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e飞猪也没有有效脚本，手工签：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://trip.taobao.com/mytrip/?tvm=tvip\"\u003ehttp://trip.taobao.com/mytrip/?tvm=tvip\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://trip.taobao.com/mytrip/\"\u003ehttp://trip.taobao.com/mytrip/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://h5.m.taobao.com/trip/member/index.html\"\u003ehttp://h5.m.taobao.com/trip/member/index.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"网站签到的最佳实践"},{"content":"有时候我们希望检查代码或数据的更新对网页产生的影响，如果能把这个过程集成到git等版本控制系统中，在提交成果的同时自动批量执行，将会极大地提高生产力。\n首先网页的截图可以用PhantomJS、Headless Chrome实现：\n1 2 3 4 5 var page = require(\u0026#39;webpage\u0026#39;).create(); page.open(\u0026#39;http://github.com/\u0026#39;, function() { page.render(\u0026#39;github.png\u0026#39;); phantom.exit(); }); 图片的差异比较用GraphicsMagick实现：\n1 gm compare old.png new.png -file diff.png -highlight-style assign 为方便查看，还可以把截图做成gif动图：\n1 gm convert -delay 20 old.png diff.png new.png diff.gif ","permalink":"http://0x3f.org/posts/check-changes-of-webpage-by-comparing-screenshots/","summary":"\u003cp\u003e有时候我们希望检查代码或数据的更新对网页产生的影响，如果能把这个过程集成到git等版本控制系统中，在提交成果的同时自动批量执行，将会极大地提高生产力。\u003c/p\u003e\n\u003cp\u003e首先网页的截图可以用PhantomJS、Headless Chrome实现：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;webpage\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003epage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;http://github.com/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003epage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;github.png\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003ephantom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e图片的差异比较用GraphicsMagick实现：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egm compare old.png new.png -file diff.png -highlight-style assign\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e为方便查看，还可以把截图做成gif动图：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egm convert -delay \u003cspan class=\"m\"\u003e20\u003c/span\u003e old.png diff.png new.png diff.gif\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"通过比较截图检查网页变化"},{"content":"关于PHPUnit代码覆盖率的很多概念，官方文档中讲的十分清楚，本文仅就部分语焉不详的细节做些补充。\n虽然phpunit.xml不是必需，但每次都输入完整的命令很不方便，所以一般都要生成这个配置文件。用phpunit --generate-configuration生成的phpunit.xml默认包含forceCoversAnnotation=\u0026quot;true\u0026quot;，它表示必须在测试方法头部的注释里显式使用@covers标签声明统计范围，例如：\n1 2 3 4 5 6 7 8 9 10 /** * @covers Ox3f\\LaravelUtils\\Log\\Log::\u0026lt;public\u0026gt; * @covers Ox3f\\LaravelUtils\\Log\\Log::parseCallStack * @covers Ox3f\\LaravelUtils\\Log\\Log::__construct * @covers Ox3f\\LaravelUtils\\Log\\Log::__callStatic */ public function testAll() { // ... } 否则在执行统计代码覆盖率的命令时，会报risk：\nThere was 1 risky test:\nOx3f\\LaravelUtils\\Log\\LogTest::testAll This test does not have a @covers annotation but is expected to have one 如果希望单元测试覆盖全部代码、且不用一一显式声明，可以将此选项的值改成 false。\n之后即可使用明令phpunit —coverage-html ./report统计代码覆盖率，统计结果保存在report目录中。\n参考 官方文档：第11章-代码覆盖率分析 ","permalink":"http://0x3f.org/posts/how-to-count-code-coverage-of-phpunit/","summary":"\u003cp\u003e关于PHPUnit代码覆盖率的很多概念，官方文档中讲的十分清楚，本文仅就部分语焉不详的细节做些补充。\u003c/p\u003e\n\u003cp\u003e虽然phpunit.xml不是必需，但每次都输入完整的命令很不方便，所以一般都要生成这个配置文件。用\u003ccode\u003ephpunit --generate-configuration\u003c/code\u003e生成的phpunit.xml默认包含\u003ccode\u003eforceCoversAnnotation=\u0026quot;true\u0026quot;\u003c/code\u003e，它表示必须在测试方法头部的注释里显式使用\u003ccode\u003e@covers\u003c/code\u003e标签声明统计范围，例如：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @covers Ox3f\\LaravelUtils\\Log\\Log::\u0026lt;public\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @covers Ox3f\\LaravelUtils\\Log\\Log::parseCallStack\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @covers Ox3f\\LaravelUtils\\Log\\Log::__construct\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @covers Ox3f\\LaravelUtils\\Log\\Log::__callStatic\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003etestAll\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e否则在执行统计代码覆盖率的命令时，会报risk：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThere was 1 risky test:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eOx3f\\LaravelUtils\\Log\\LogTest::testAll\nThis test does not have a @covers annotation but is expected to have one\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e如果希望单元测试覆盖全部代码、且不用一一显式声明，可以将此选项的值改成\n\u003ccode\u003efalse\u003c/code\u003e。\u003c/p\u003e","title":"PHPUnit代码覆盖率的统计方法"},{"content":"简述 上篇文章讨论了如何利用命名空间实现对PHP内建函数的mocking，本文介绍另一种实现方法——依赖注入。\n出于编写可测试代码的需要，依赖注入是经常使用的一种技术。通过把代码中依赖的其它数据获取服务提取出来、和原有逻辑解耦，提高代码的可测试性。只需mock这些依赖并注入到测试对象中即可。\n实现 对原有代码的重构 先把原有代码用依赖注入的方式重构（为突出重点，省略了和上篇文章中重复的部分）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // ... use Ox3f\\LaravelUtils\\Services\\Builtins; /** * Class Log * @author donie */ class Log { // ... private $builtins; // Builtin functions private function __construct() { $this-\u0026gt;builtins = new Builtins(); // ... } // ... public static function inject($key, $service) { self::getInstance()-\u0026gt;$key = $service; } /** * Parse the call stack * * @return void */ private function parseCallStack() { $traceInfo = $this-\u0026gt;builtins-\u0026gt;debug_backtrace(DEBUG_BACKTRACE_PROVIDE_OBJECT|DEBUG_BACKTRACE_IGNORE_ARGS, 5); // ... } // ... } Builtins类的实现：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php namespace Ox3f\\LaravelUtils\\Services; /** * Class Builtins * @author donie */ class Builtins { public function debug_backtrace() { return call_user_func_array(\u0026#39;debug_backtrace\u0026#39;, func_get_args()); } } 把debug_backtrace()封装进了Builtins类，并在测试对象中通过这个类调用内建函数。inject()用于注入依赖，这样可以在测试类中把mock注入到测试对象中。\n测试类的实现 代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 \u0026lt;?php use PHPUnit\\Framework\\TestCase; use Illuminate\\Support\\Facades\\Auth; use Illuminate\\Support\\Facades\\Request; use Illuminate\\Support\\Facades\\Log as LaravelLog; use Ox3f\\LaravelUtils\\Log\\Log; use \\Mockery as m; class LogTest extends TestCase { public function setUp() { Auth::shouldReceive(\u0026#39;user\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn((object)[\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;jim\u0026#39;,]); } public function tearDown() { m::close(); } /** * @covers Ox3f\\LaravelUtils\\Log\\Log::saveInput * @covers Ox3f\\LaravelUtils\\Log\\Log::saveOutput * @covers Ox3f\\LaravelUtils\\Log\\Log::parseCallStack * @covers Ox3f\\LaravelUtils\\Log\\Log::getInstance * @covers Ox3f\\LaravelUtils\\Log\\Log::__construct * @covers Ox3f\\LaravelUtils\\Log\\Log::__callStatic */ public function testAll() { $mock = m::mock(\u0026#39;Ox3f\\LaravelUtils\\Services\\Builtins\u0026#39;); $mock-\u0026gt;shouldReceive(\u0026#39;debug_backtrace\u0026#39;) -\u0026gt;andReturnUsing(function() use ($mock) { if ($mock-\u0026gt;calledInController) { return json_decode(\u0026#39;[{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/xbot\\/laravel-utils\\/src\\/Log\\/Log.php\u0026#34;,\u0026#34;line\u0026#34;:85,\u0026#34;function\u0026#34;:\u0026#34;parseCallStack\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Api\\/V1\\/Controllers\\/WorkController.php\u0026#34;,\u0026#34;line\u0026#34;:29,\u0026#34;function\u0026#34;:\u0026#34;saveInput\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;function\u0026#34;:\u0026#34;save\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Api\\\\\\V1\\\\\\Controllers\\\\\\WorkController\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/Controller.php\u0026#34;,\u0026#34;line\u0026#34;:55,\u0026#34;function\u0026#34;:\u0026#34;call_user_func_array\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/ControllerDispatcher.php\u0026#34;,\u0026#34;line\u0026#34;:44,\u0026#34;function\u0026#34;:\u0026#34;callAction\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Illuminate\\\\\\Routing\\\\\\Controller\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;}]\u0026#39;, true); } else { return json_decode(\u0026#39;[{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/xbot\\/laravel-utils\\/src\\/Log\\/Log.php\u0026#34;,\u0026#34;line\u0026#34;:85,\u0026#34;function\u0026#34;:\u0026#34;parseCallStack\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Notation.php\u0026#34;,\u0026#34;line\u0026#34;:21,\u0026#34;function\u0026#34;:\u0026#34;saveInput\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Api\\/V1\\/Controllers\\/NotationController.php\u0026#34;,\u0026#34;line\u0026#34;:32,\u0026#34;function\u0026#34;:\u0026#34;incrNo\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Notation\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;function\u0026#34;:\u0026#34;save\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Api\\\\\\V1\\\\\\Controllers\\\\\\NotationController\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/Controller.php\u0026#34;,\u0026#34;line\u0026#34;:55,\u0026#34;function\u0026#34;:\u0026#34;call_user_func_array\u0026#34;}]\u0026#39;, true); } }); Log::inject(\u0026#39;builtins\u0026#39;, $mock); // test being called in a plain method $mock-\u0026gt;calledInController = false; LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | App\\Notation::incrNo | Input:1\u0026#39;); Log::saveInput(1); LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | App\\Notation::incrNo | Output:2\u0026#39;); Log::saveOutput(2); // test being called in a controller action $mock-\u0026gt;calledInController = true; Request::shouldReceive(\u0026#39;path\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn(\u0026#39;api/user\u0026#39;); Request::shouldReceive(\u0026#39;except\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;_url\u0026#39;) -\u0026gt;andReturn([\u0026#39;id\u0026#39; =\u0026gt; 18,]); LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | api/user | Input:{\u0026#34;id\u0026#34;:18}\u0026#39;); Log::saveInput(); Request::shouldReceive(\u0026#39;path\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn(\u0026#39;api/user\u0026#39;); LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | api/user | Output:2\u0026#39;); Log::saveOutput(2); Request::shouldReceive(\u0026#39;path\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn(\u0026#39;api/user\u0026#39;); LaravelLog::shouldReceive(\u0026#39;error\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | api/user | this is an error\u0026#39;); Log::error(\u0026#39;this is an error\u0026#39;); $this-\u0026gt;assertEquals(0, 0); } } Builtins是个普通类，很容易mock。\n","permalink":"http://0x3f.org/posts/mock-php-built-in-functions-using-dependency-injection/","summary":"\u003ch2 id=\"简述\"\u003e简述\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"/post/mock-php-built-in-functions-using-namespace/\"\u003e上篇文章\u003c/a\u003e讨论了如何利用命名空间实现对PHP内建函数的mocking，本文介绍另一种实现方法——依赖注入。\u003c/p\u003e\n\u003cp\u003e出于编写可测试代码的需要，依赖注入是经常使用的一种技术。通过把代码中依赖的其它数据获取服务提取出来、和原有逻辑解耦，提高代码的可测试性。只需mock这些依赖并注入到测试对象中即可。\u003c/p\u003e\n\u003ch2 id=\"实现\"\u003e实现\u003c/h2\u003e\n\u003ch3 id=\"对原有代码的重构\"\u003e对原有代码的重构\u003c/h3\u003e\n\u003cp\u003e先把原有代码用依赖注入的方式重构（\u003cem\u003e为突出重点，省略了和上篇文章中重复的部分\u003c/em\u003e）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eOx3f\\LaravelUtils\\Services\\Builtins\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * Class Log\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @author donie\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLog\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$builtins\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e        \u003cspan class=\"c1\"\u003e// Builtin functions\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__construct\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ebuiltins\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eBuiltins\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003einject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$service\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$key\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$service\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Parse the call stack\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eparseCallStack\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$traceInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ebuiltins\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003edebug_backtrace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eDEBUG_BACKTRACE_PROVIDE_OBJECT\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"nx\"\u003eDEBUG_BACKTRACE_IGNORE_ARGS\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003eBuiltins\u003c/code\u003e类的实现：\u003c/p\u003e","title":"利用依赖注入Mock PHP的内建函数"},{"content":"简述 Mock PHP的内建函数一般有两种方法：命名空间法和依赖注入法。\n命名空间法是利用PHP优先使用同命名空间内函数的特性，在测试对象的命名空间内重载内建函数来实现。前提是内建函数在被调用时没有使用命名空间，例如：\\debug_backtrace()是不能使用本方法的。\n上篇文章《接口编程中记录日志的最佳实践》中实现的日志类中，核心部分调用了debug_backtrace()函数获取方法调用堆栈。下面讨论下如何利用命名空间法实现对此函数的mock。\n实现 先看代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 \u0026lt;?php namespace Ox3f\\LaravelUtils\\Log; use PHPUnit\\Framework\\TestCase; use Illuminate\\Support\\Facades\\Auth; use Illuminate\\Support\\Facades\\Request; use Illuminate\\Support\\Facades\\Log as LaravelLog; use Ox3f\\LaravelUtils\\Log\\Log; $calledInController = false; function debug_backtrace() { global $calledInController; if ($calledInController) { return json_decode(\u0026#39;[{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/xbot\\/laravel-utils\\/src\\/Log\\/Log.php\u0026#34;,\u0026#34;line\u0026#34;:85,\u0026#34;function\u0026#34;:\u0026#34;parseCallStack\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Api\\/V1\\/Controllers\\/WorkController.php\u0026#34;,\u0026#34;line\u0026#34;:29,\u0026#34;function\u0026#34;:\u0026#34;saveInput\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;function\u0026#34;:\u0026#34;save\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Api\\\\\\V1\\\\\\Controllers\\\\\\WorkController\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/Controller.php\u0026#34;,\u0026#34;line\u0026#34;:55,\u0026#34;function\u0026#34;:\u0026#34;call_user_func_array\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/ControllerDispatcher.php\u0026#34;,\u0026#34;line\u0026#34;:44,\u0026#34;function\u0026#34;:\u0026#34;callAction\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Illuminate\\\\\\Routing\\\\\\Controller\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;}]\u0026#39;, true); } else { return json_decode(\u0026#39;[{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/xbot\\/laravel-utils\\/src\\/Log\\/Log.php\u0026#34;,\u0026#34;line\u0026#34;:85,\u0026#34;function\u0026#34;:\u0026#34;parseCallStack\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Notation.php\u0026#34;,\u0026#34;line\u0026#34;:21,\u0026#34;function\u0026#34;:\u0026#34;saveInput\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Api\\/V1\\/Controllers\\/NotationController.php\u0026#34;,\u0026#34;line\u0026#34;:32,\u0026#34;function\u0026#34;:\u0026#34;incrNo\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Notation\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;function\u0026#34;:\u0026#34;save\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Api\\\\\\V1\\\\\\Controllers\\\\\\NotationController\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/Controller.php\u0026#34;,\u0026#34;line\u0026#34;:55,\u0026#34;function\u0026#34;:\u0026#34;call_user_func_array\u0026#34;}]\u0026#39;, true); } } class LogTest extends TestCase { public function setUp() { Auth::shouldReceive(\u0026#39;user\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn((object)[\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;jim\u0026#39;,]); } /** * @covers Ox3f\\LaravelUtils\\Log\\Log::saveInput * @covers Ox3f\\LaravelUtils\\Log\\Log::saveOutput * @covers Ox3f\\LaravelUtils\\Log\\Log::parseCallStack * @covers Ox3f\\LaravelUtils\\Log\\Log::getInstance * @covers Ox3f\\LaravelUtils\\Log\\Log::__construct * @covers Ox3f\\LaravelUtils\\Log\\Log::__callStatic */ public function testAll() { global $calledInController; // test being called in a plain method $calledInController = false; LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | App\\Notation::incrNo | Input:1\u0026#39;); Log::saveInput(1); LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | App\\Notation::incrNo | Output:2\u0026#39;); Log::saveOutput(2); // test being called in a controller action $calledInController = true; Request::shouldReceive(\u0026#39;path\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn(\u0026#39;api/user\u0026#39;); Request::shouldReceive(\u0026#39;except\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;_url\u0026#39;) -\u0026gt;andReturn([\u0026#39;id\u0026#39; =\u0026gt; 18,]); LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | api/user | Input:{\u0026#34;id\u0026#34;:18}\u0026#39;); Log::saveInput(); Request::shouldReceive(\u0026#39;path\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn(\u0026#39;api/user\u0026#39;); LaravelLog::shouldReceive(\u0026#39;debug\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | api/user | Output:2\u0026#39;); Log::saveOutput(2); Request::shouldReceive(\u0026#39;path\u0026#39;) -\u0026gt;once() -\u0026gt;andReturn(\u0026#39;api/user\u0026#39;); LaravelLog::shouldReceive(\u0026#39;error\u0026#39;) -\u0026gt;once() -\u0026gt;with(\u0026#39;jim | api/user | this is an error\u0026#39;); Log::error(\u0026#39;this is an error\u0026#39;); $this-\u0026gt;assertEquals(0, 0); } } 最重要的是第一行，这里把测试类的命名空间设置得和测试对象一致，这样在下面重载的debug_backtrace()函数就会在测试对象中被优先使用。\n在重载的函数中，通过全局变量$calledInController选择输出事先捕获的真实数据，从而mock出符合我们需要的函数。\n","permalink":"http://0x3f.org/posts/mock-php-built-in-functions-using-namespace/","summary":"\u003ch2 id=\"简述\"\u003e简述\u003c/h2\u003e\n\u003cp\u003eMock PHP的内建函数一般有两种方法：命名空间法和依赖注入法。\u003c/p\u003e\n\u003cp\u003e命名空间法是利用PHP优先使用同命名空间内函数的特性，在测试对象的命名空间内重载内建函数来实现。前提是内建函数在被调用时没有使用命名空间，例如：\u003ccode\u003e\\debug_backtrace()\u003c/code\u003e是不能使用本方法的。\u003c/p\u003e\n\u003cp\u003e上篇文章\u003ca href=\"/post/the-best-practice-of-logging-in-api-programming/\"\u003e《接口编程中记录日志的最佳实践》\u003c/a\u003e中实现的日志类中，核心部分调用了\u003ccode\u003edebug_backtrace()\u003c/code\u003e函数获取方法调用堆栈。下面讨论下如何利用命名空间法实现对此函数的mock。\u003c/p\u003e\n\u003ch2 id=\"实现\"\u003e实现\u003c/h2\u003e\n\u003cp\u003e先看代码：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e93\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nx\"\u003eOx3f\\LaravelUtils\\Log\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003ePHPUnit\\Framework\\TestCase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eIlluminate\\Support\\Facades\\Auth\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eIlluminate\\Support\\Facades\\Request\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eIlluminate\\Support\\Facades\\Log\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eOx3f\\LaravelUtils\\Log\\Log\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$calledInController\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003edebug_backtrace\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e \u003cspan class=\"nv\"\u003e$calledInController\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$calledInController\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ejson_decode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;[{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/xbot\\/laravel-utils\\/src\\/Log\\/Log.php\u0026#34;,\u0026#34;line\u0026#34;:85,\u0026#34;function\u0026#34;:\u0026#34;parseCallStack\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Api\\/V1\\/Controllers\\/WorkController.php\u0026#34;,\u0026#34;line\u0026#34;:29,\u0026#34;function\u0026#34;:\u0026#34;saveInput\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;function\u0026#34;:\u0026#34;save\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Api\\\\\\V1\\\\\\Controllers\\\\\\WorkController\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/Controller.php\u0026#34;,\u0026#34;line\u0026#34;:55,\u0026#34;function\u0026#34;:\u0026#34;call_user_func_array\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/ControllerDispatcher.php\u0026#34;,\u0026#34;line\u0026#34;:44,\u0026#34;function\u0026#34;:\u0026#34;callAction\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Illuminate\\\\\\Routing\\\\\\Controller\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;}]\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ejson_decode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;[{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/xbot\\/laravel-utils\\/src\\/Log\\/Log.php\u0026#34;,\u0026#34;line\u0026#34;:85,\u0026#34;function\u0026#34;:\u0026#34;parseCallStack\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Notation.php\u0026#34;,\u0026#34;line\u0026#34;:21,\u0026#34;function\u0026#34;:\u0026#34;saveInput\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;Ox3f\\\\\\LaravelUtils\\\\\\Log\\\\\\Log\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/app\\/Api\\/V1\\/Controllers\\/NotationController.php\u0026#34;,\u0026#34;line\u0026#34;:32,\u0026#34;function\u0026#34;:\u0026#34;incrNo\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Notation\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;::\u0026#34;},{\u0026#34;function\u0026#34;:\u0026#34;save\u0026#34;,\u0026#34;class\u0026#34;:\u0026#34;App\\\\\\Api\\\\\\V1\\\\\\Controllers\\\\\\NotationController\u0026#34;,\u0026#34;object\u0026#34;:{},\u0026#34;type\u0026#34;:\u0026#34;-\u0026gt;\u0026#34;},{\u0026#34;file\u0026#34;:\u0026#34;\\/Users\\/xbot\\/Sites\\/sample-project\\/vendor\\/laravel\\/framework\\/src\\/Illuminate\\/Routing\\/Controller.php\u0026#34;,\u0026#34;line\u0026#34;:55,\u0026#34;function\u0026#34;:\u0026#34;call_user_func_array\u0026#34;}]\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLogTest\u003c/span\u003e \u003cspan class=\"k\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eTestCase\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetUp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eAuth\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;user\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;jim\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @covers Ox3f\\LaravelUtils\\Log\\Log::saveInput\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @covers Ox3f\\LaravelUtils\\Log\\Log::saveOutput\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @covers Ox3f\\LaravelUtils\\Log\\Log::parseCallStack\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @covers Ox3f\\LaravelUtils\\Log\\Log::getInstance\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @covers Ox3f\\LaravelUtils\\Log\\Log::__construct\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @covers Ox3f\\LaravelUtils\\Log\\Log::__callStatic\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003etestAll\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e \u003cspan class=\"nv\"\u003e$calledInController\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// test being called in a plain method\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"nv\"\u003e$calledInController\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;debug\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;jim | App\\Notation::incrNo | Input:1\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003esaveInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;debug\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;jim | App\\Notation::incrNo | Output:2\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003esaveOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// test being called in a controller action\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"nv\"\u003e$calledInController\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;path\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;api/user\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;except\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;_url\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;id\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e,]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;debug\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;jim | api/user | Input:{\u0026#34;id\u0026#34;:18}\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003esaveInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;path\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;api/user\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;debug\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;jim | api/user | Output:2\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003esaveOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;path\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;api/user\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;error\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;jim | api/user | this is an error\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;this is an error\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eassertEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e最重要的是第一行，这里把测试类的命名空间设置得和测试对象一致，这样在下面重载的\u003ccode\u003edebug_backtrace()\u003c/code\u003e函数就会在测试对象中被优先使用。\u003c/p\u003e","title":"利用命名空间Mock PHP的内建函数"},{"content":"解决什么问题 快速定位日志 降低记录成本 提高代码可读性 日志框架是项目开始阶段应该最先搭建好的内容之一，有助于极大地节约以后解决问题的时间和成本。但这也是最让我头疼的问题之一，因为记日志不光包括用什么记、怎么记，也包括记什么内容，这恰恰是最容易被忽略的问题。\n一条好的日志需要做到能让问题的跟踪者快速定位它在程序中的位置且包含关键数据。工作中不乏这样的团队成员，在移交接口问题的时候没有主动提供关键信息的意识，所谓关键信息，是指像问题发生的环境、接口名、传递的实参和返回结果这样的内容，使得面向契约编程本来是很好的开发模式，却得不到最好的应用。这时我们可以从自己接口的日志中得到一些弥补。\n但是日志的记录不应该占用很大的代码量，一来降低了代码的可读性，二来会耗费太多的时间精力。\n本文目的在于讨论一种日志记录的最佳实践方式，使得可以兼顾以上这些问题。\n实践 这里针对Laravel实现一个日志工具类，实现以下功能：\n兼容Laravel自己的日志系统 自动记录关键的业务数据 自动记录日志所属的接口名 自动记录接口的实参 记录接口的返回值 生成简洁规范的日志内容 代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 \u0026lt;?php namespace Ox3f\\LaravelUtils\\Log; use Illuminate\\Support\\Facades\\Log as LaravelLog; use Illuminate\\Support\\Facades\\Auth; use Illuminate\\Support\\Facades\\Request; /** * Class Log * @author donie */ class Log { private static $instance; private $id; // Identity of the log, username by default. private $referer; // Request path for RESTful APIs, method name for ordinary class methods. private $isHttp; // True for RESTful APIs, otherwise, false. private $callStackParsed; // Whether call stack has been parsed. private function __construct() { $user = Auth::user(); $this-\u0026gt;id = !empty($user-\u0026gt;name) ? $user-\u0026gt;name : \u0026#39;anonymous\u0026#39;; } private function __clone() {} public static function getInstance() { if (!self::$instance) { self::$instance = new self; } return self::$instance; } /** * Parse the call stack * * @return void */ private function parseCallStack() { $traceInfo = debug_backtrace(DEBUG_BACKTRACE_PROVIDE_OBJECT|DEBUG_BACKTRACE_IGNORE_ARGS, 5); $this-\u0026gt;referer = \u0026#39;\u0026#39;; $this-\u0026gt;isHttp = false; foreach ($traceInfo as $callInfo) { if ($callInfo[\u0026#39;class\u0026#39;] != __CLASS__) { if (preg_match(\u0026#39;/Controller$/\u0026#39;, $callInfo[\u0026#39;class\u0026#39;])) { $this-\u0026gt;referer = Request::path(); $this-\u0026gt;isHttp = true; } else { $this-\u0026gt;referer = $callInfo[\u0026#39;class\u0026#39;].$callInfo[\u0026#39;type\u0026#39;].$callInfo[\u0026#39;function\u0026#39;]; } break; } } $this-\u0026gt;callStackParsed = true; } /** * Wrapper of the laravel log facade * * @return void */ public static function __callStatic($name, $args) { if (!self::getInstance()-\u0026gt;callStackParsed) self::getInstance()-\u0026gt;parseCallStack(); $id = self::getInstance()-\u0026gt;id; $referer = self::getInstance()-\u0026gt;referer; $msg = !empty($args) ? $args[0] : \u0026#39;\u0026#39;; LaravelLog::$name(\u0026#34;{$id} | {$referer} | {$msg}\u0026#34;); self::getInstance()-\u0026gt;callStackParsed = false; } /** * Save parameters of the request or arguments of the method to log at debug level * * @param mixed $args Empty for HTTP calls, needed for ordinary class methods * @return void */ public static function saveInput($args=null) { self::getInstance()-\u0026gt;parseCallStack(); if (self::getInstance()-\u0026gt;isHttp) $args = Request::except(\u0026#39;_url\u0026#39;); self::debug(\u0026#39;Input:\u0026#39;.json_encode($args)); } /** * Save the output to log at debug level * * @param mixed $result Result to be saved * @return void */ public static function saveOutput($result) { self::getInstance()-\u0026gt;parseCallStack(); self::debug(\u0026#39;Output:\u0026#39;.json_encode($result)); } } 这是一个单例类，核心在于parseCallStack()方法，通过debug_backtrace()函数获取日志所在的接口，对于REST接口，得到HTTP请求的路径，对于接口类的方法，得到包含类名的接口名。此外，日志中还会记录当前的用户名，方便定位和复现问题。\nsaveInput()和saveOutput()是在此基础上封装的两个高级方法，用于记录接口的输入和输出，对于界定问题是否出在自己的接口或复现问题都有很重要的作用。对于REST接口，saveInput()可以自动获取请求中的参数，而对于接口类的方法，出于性能和内存占用考虑，没有允许debug_backtrace()返回参数信息，需要用户手动指定要记录的数据。\n使用方法 安装 1 composer require xbot/laravel-utils 使用 1 2 3 4 5 6 use Ox3f\\LaravelUtils\\Log\\Log; Log::saveInput(); // REST接口中自动保存请求数据 Log::saveInput(func_get_args()); // 接口类的方法中保存实参 Log::error(\u0026#39;This is an error.\u0026#39;); // 记录一条错误日志 Log::saveOutput($result); // 保存接口返回值 日志示例 [2017-04-25 06:46:11] local.DEBUG: donie | users/groups/33 | Input:{\u0026#34;check\u0026#34;:\u0026#34;1\u0026#34;} [2017-04-25 06:46:11] local.ERROR: donie | users/groups/33 | This is an error. 待讨论的问题 最佳实践需要持续改进，以下问题有待讨论：\n关键业务数据中是否应该包含Request ID？ 是否有必要对每次请求生成一个ID？这样可以很简单地过滤出一次请求中所有的日志。\n","permalink":"http://0x3f.org/posts/the-best-practice-of-logging-in-api-programming/","summary":"\u003ch2 id=\"解决什么问题\"\u003e解决什么问题\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e快速定位日志\u003c/li\u003e\n\u003cli\u003e降低记录成本\u003c/li\u003e\n\u003cli\u003e提高代码可读性\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e日志框架是项目开始阶段应该最先搭建好的内容之一，有助于极大地节约以后解决问题的时间和成本。但这也是最让我头疼的问题之一，因为记日志不光包括用什么记、怎么记，也包括记什么内容，这恰恰是最容易被忽略的问题。\u003c/p\u003e\n\u003cp\u003e一条好的日志需要做到能让问题的跟踪者快速定位它在程序中的位置且包含关键数据。工作中不乏这样的团队成员，在移交接口问题的时候没有主动提供关键信息的意识，所谓关键信息，是指像问题发生的环境、接口名、传递的实参和返回结果这样的内容，使得面向契约编程本来是很好的开发模式，却得不到最好的应用。这时我们可以从自己接口的日志中得到一些弥补。\u003c/p\u003e\n\u003cp\u003e但是日志的记录不应该占用很大的代码量，一来降低了代码的可读性，二来会耗费太多的时间精力。\u003c/p\u003e\n\u003cp\u003e本文目的在于讨论一种日志记录的最佳实践方式，使得可以兼顾以上这些问题。\u003c/p\u003e\n\u003ch2 id=\"实践\"\u003e实践\u003c/h2\u003e\n\u003cp\u003e这里针对Laravel实现一个日志工具类，实现以下功能：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e兼容Laravel自己的日志系统\u003c/li\u003e\n\u003cli\u003e自动记录关键的业务数据\u003c/li\u003e\n\u003cli\u003e自动记录日志所属的接口名\u003c/li\u003e\n\u003cli\u003e自动记录接口的实参\u003c/li\u003e\n\u003cli\u003e记录接口的返回值\u003c/li\u003e\n\u003cli\u003e生成简洁规范的日志内容\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e代码：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e  1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 93\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 94\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 95\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 96\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 97\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 98\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 99\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e100\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nx\"\u003eOx3f\\LaravelUtils\\Log\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eIlluminate\\Support\\Facades\\Log\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eIlluminate\\Support\\Facades\\Auth\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eIlluminate\\Support\\Facades\\Request\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * Class Log\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @author donie\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLog\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$instance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$id\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e              \u003cspan class=\"c1\"\u003e// Identity of the log, username by default.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$referer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e         \u003cspan class=\"c1\"\u003e// Request path for RESTful APIs, method name for ordinary class methods.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$isHttp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e          \u003cspan class=\"c1\"\u003e// True for RESTful APIs, otherwise, false.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$callStackParsed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Whether call stack has been parsed.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__construct\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$user\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eAuth\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$user\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nv\"\u003e$user\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;anonymous\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__clone\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$instance\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$instance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$instance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Parse the call stack\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eparseCallStack\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$traceInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edebug_backtrace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eDEBUG_BACKTRACE_PROVIDE_OBJECT\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"nx\"\u003eDEBUG_BACKTRACE_IGNORE_ARGS\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ereferer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eisHttp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$traceInfo\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$callInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$callInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;class\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"no\"\u003e__CLASS__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epreg_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/Controller$/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$callInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;class\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ereferer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eisHttp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ereferer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$callInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;class\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$callInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$callInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;function\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ecallStackParsed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Wrapper of the laravel log facade\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__callStatic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ecallStackParsed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eparseCallStack\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$id\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$referer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ereferer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$msg\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eLaravelLog\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$id\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e | \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$referer\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e | \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$msg\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ecallStackParsed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Save parameters of the request or arguments of the method to log at debug level\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param mixed $args Empty for HTTP calls, needed for ordinary class methods\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esaveInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eparseCallStack\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eisHttp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$args\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;_url\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Input:\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson_encode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$args\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Save the output to log at debug level\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param mixed $result Result to be saved\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esaveOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$result\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eparseCallStack\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Output:\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson_encode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$result\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这是一个单例类，核心在于\u003ccode\u003eparseCallStack()\u003c/code\u003e方法，通过\u003ccode\u003edebug_backtrace()\u003c/code\u003e函数获取日志所在的接口，对于REST接口，得到HTTP请求的路径，对于接口类的方法，得到包含类名的接口名。此外，日志中还会记录当前的用户名，方便定位和复现问题。\u003c/p\u003e","title":"接口编程中记录日志的最佳实践"},{"content":"BBR比锐速略快，看YouTube的1080p效果差别不大，SSH操作反应改善明显。\n两个都不用的情况：\n$ speedtest Retrieving speedtest.net configuration... Testing from Choopa (xx.xx.xx.xx)... Retrieving speedtest.net server list... Selecting best server based on ping... Hosted by Allied Telesis Capital Corporation (Fussa-shi) [41.04 km]: 88.085 ms Testing download speed................................................................................ Download: 1.81 Mbit/s Testing upload speed.................................................................................................... Upload: 7.48 Mbit/s 使用锐速的情况：\n$ speedtest Retrieving speedtest.net configuration... Testing from Choopa (xx.xx.xx.xx)... Retrieving speedtest.net server list... Selecting best server based on ping... Hosted by Allied Telesis Capital Corporation (Fussa-shi) [41.04 km]: 96.395 ms Testing download speed................................................................................ Download: 3.45 Mbit/s Testing upload speed.................................................................................................... Upload: 4.56 Mbit/s 用BBR的情况：\n$ speedtest Retrieving speedtest.net configuration... Testing from Choopa (xx.xx.xx.xx)... Retrieving speedtest.net server list... Selecting best server based on ping... Hosted by ASEINet (Tokyo) [12.58 km]: 340.353 ms Testing download speed................................................................................ Download: 4.54 Mbit/s Testing upload speed.................................................................................................... Upload: 5.71 Mbit/s ","permalink":"http://0x3f.org/posts/google-bbr-is-awesome/","summary":"\u003cp\u003eBBR比锐速略快，看YouTube的1080p效果差别不大，SSH操作反应改善明显。\u003c/p\u003e\n\u003cp\u003e两个都不用的情况：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ speedtest                                                                                      \nRetrieving speedtest.net configuration...\nTesting from Choopa (xx.xx.xx.xx)...\nRetrieving speedtest.net server list...\nSelecting best server based on ping...\nHosted by Allied Telesis Capital Corporation (Fussa-shi) [41.04 km]: 88.085 ms\nTesting download speed................................................................................\nDownload: 1.81 Mbit/s\nTesting upload speed....................................................................................................\nUpload: 7.48 Mbit/s\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e使用锐速的情况：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ speedtest\nRetrieving speedtest.net configuration...\nTesting from Choopa (xx.xx.xx.xx)...\nRetrieving speedtest.net server list...\nSelecting best server based on ping...\nHosted by Allied Telesis Capital Corporation (Fussa-shi) [41.04 km]: 96.395 ms\nTesting download speed................................................................................\nDownload: 3.45 Mbit/s\nTesting upload speed....................................................................................................\nUpload: 4.56 Mbit/s\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e用BBR的情况：\u003c/p\u003e","title":"Google BBR和锐速在Vultr上的对比"},{"content":"什么是CSRF Cross-site Request Forgery（简称CSRF），意思是跨站请求伪造。原理是利用网站服务器对浏览器的信任，通过一些技术手段欺骗用户的浏览器访问自己曾经认证过的网站，并执行一些危害用户利益的操作。\n例如，假设网站的会话信息保存在cookie中，提现的请求是GET http://www.sample.com/withdraw?toCard=123456\u0026amp;amount=10000，攻击者在自己的网页中通过img标签、iframe或者AJAX访问这个链接，并诱使用户访问这个网页，如果用户刚刚登录过sample.com，余额就会被转走。\n防止CSRF的方法 CSRF的关键在于用户的鉴权信息保存在cookie中，或攻击者可以拿到它。目前防止CSRF攻击的方法主要有两种：JWT和表单校验token。\nJWT的token通过HTTP请求的header传递，且由于浏览器的跨站限制，钓鱼网页中的JS无法拿到token，从而达到防止CSRF的目的。关于JWT更详细的介绍在「JSON Web Token简介」。\n表单校验token通常是存储在表单的隐藏字段中的一个随机字符串，服务器端通过比对表单提交的token判断请求是否伪造，此时需要注意服务器端的CORS配置，即便在有需要的情况下开放了，也应该严格限制允许的HTTP方法和域，否则，钓鱼网页的JS就可以拿到这个token，从而实现CSRF。\n","permalink":"http://0x3f.org/posts/introduction-of-cross-site-request-forgery/","summary":"\u003ch2 id=\"什么是csrf\"\u003e什么是CSRF\u003c/h2\u003e\n\u003cp\u003eCross-site Request Forgery（简称CSRF），意思是跨站请求伪造。原理是利用网站服务器对浏览器的信任，通过一些技术手段欺骗用户的浏览器访问自己曾经认证过的网站，并执行一些危害用户利益的操作。\u003c/p\u003e\n\u003cp\u003e例如，假设网站的会话信息保存在cookie中，提现的请求是\u003ccode\u003eGET http://www.sample.com/withdraw?toCard=123456\u0026amp;amount=10000\u003c/code\u003e，攻击者在自己的网页中通过img标签、iframe或者AJAX访问这个链接，并诱使用户访问这个网页，如果用户刚刚登录过sample.com，余额就会被转走。\u003c/p\u003e\n\u003ch2 id=\"防止csrf的方法\"\u003e防止CSRF的方法\u003c/h2\u003e\n\u003cp\u003eCSRF的关键在于用户的鉴权信息保存在cookie中，或攻击者可以拿到它。目前防止CSRF攻击的方法主要有两种：JWT和表单校验token。\u003c/p\u003e\n\u003cp\u003eJWT的token通过HTTP请求的header传递，且由于浏览器的跨站限制，钓鱼网页中的JS无法拿到token，从而达到防止CSRF的目的。关于JWT更详细的介绍在「\u003ca href=\"/post/introduction-of-json-web-token/\"\u003eJSON Web Token简介\u003c/a\u003e」。\u003c/p\u003e\n\u003cp\u003e表单校验token通常是存储在表单的隐藏字段中的一个随机字符串，服务器端通过比对表单提交的token判断请求是否伪造，此时需要注意服务器端的CORS配置，即便在有需要的情况下开放了，也应该严格限制允许的HTTP方法和域，否则，钓鱼网页的JS就可以拿到这个token，从而实现CSRF。\u003c/p\u003e","title":"Cross-site Request Forgery简介"},{"content":"什么是JWT？ JSON Web Token（简称JWT）是一种token格式，通常用来解决身份认证的问题，和会话（session）作用相同，常用在RESTful API或者OAuth认证上。\n和session相比，JWT有以下优势：\n服务器端的开销低 服务器端扩展方便 不用专门处理CSRF 由于session的实现方式需要在服务器端存储会话数据，所以当存在大量会话时，服务器端的存储压力会很大，并由此带来扩展上的复杂度（共享session）。而JWT可以把这些数据存储在token里，不需要服务器端存储，优势自然很明显。\n对于CSRF，由于session一般使用cookie实现，所以需要专门处理这个安全隐患。JWT借助HTTP请求的header传递，所以伪造成本更高。\nJWT和Bearer Token的关系 JWT在使用的时候要在token前面加上字符串「bearer」再填到HTTP请求的header里，这个值就是「Bearer Token」。为什么要这么做？它和JWT是什么关系？\n简单地说，JWT是一种token格式，Bearer Token是一种鉴权方案。\nHTTP的header项「Authorization」是在HTTP 1.0引入的，它的值的格式是类型+token，支持多种鉴权方案，bearer只是其中的一种。bearer方案中使用的token是JWT格式，这就是它们之间的关系。\nJWT的格式 JWT是一个用英文点号连接起来的、分成三个部分的字符串：header、payload和signature。\nheader header是个base64字符串，解密后是个JSON对象，包含一些元数据。例如：\n1 2 3 4 { \u0026#39;typ\u0026#39;: \u0026#39;JWT\u0026#39;, \u0026#39;alg\u0026#39;: \u0026#39;HS256\u0026#39; } 「typ」是格式，「alg」是加密方法。\npayload payload也是个base64字符串，解密后也是个JSON对象，一般包含两种数据：JWT标准数据和自定义数据。\nJWT标准数据常见的有：\niss：提供方。 sub：主题，一般是用户ID。 exp：过期时间。 iat：创建时间。 jti：token的唯一标识。 此外，和session一样，可以把一些自定义的数据存储在payload里。但由于token存储在客户端，所以不应该在这里存储敏感数据。\nsignature signature也是个base64字符串，解密后是个使用header里描述的加密方法针对header和payload加密的字符串。目的是防止这两部分的数据被篡改。\nJWT的使用原则 不存放敏感信息 保护好私钥 结合https使用 都是出于安全角度考虑。token存储在客户端，而且base64可以被解密，所以不能存储敏感数据。如果私钥泄漏，意味著签名可以被随意伪造。使用https可以更好的保护数据，防止中间人攻击。\nJWT相关开发资源 jwt.io有各种语言的JWT开发资源。\n","permalink":"http://0x3f.org/posts/introduction-of-json-web-token/","summary":"\u003ch2 id=\"什么是jwt\"\u003e什么是JWT？\u003c/h2\u003e\n\u003cp\u003eJSON Web Token（简称JWT）是一种token格式，通常用来解决身份认证的问题，和会话（session）作用相同，常用在RESTful API或者OAuth认证上。\u003c/p\u003e\n\u003cp\u003e和session相比，JWT有以下优势：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e服务器端的开销低\u003c/li\u003e\n\u003cli\u003e服务器端扩展方便\u003c/li\u003e\n\u003cli\u003e不用专门处理CSRF\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e由于session的实现方式需要在服务器端存储会话数据，所以当存在大量会话时，服务器端的存储压力会很大，并由此带来扩展上的复杂度（共享session）。而JWT可以把这些数据存储在token里，不需要服务器端存储，优势自然很明显。\u003c/p\u003e\n\u003cp\u003e对于CSRF，由于session一般使用cookie实现，所以需要专门处理这个安全隐患。JWT借助HTTP请求的header传递，所以伪造成本更高。\u003c/p\u003e\n\u003ch3 id=\"jwt和bearer-token的关系\"\u003eJWT和Bearer Token的关系\u003c/h3\u003e\n\u003cp\u003eJWT在使用的时候要在token前面加上字符串「bearer」再填到HTTP请求的header里，这个值就是「Bearer Token」。为什么要这么做？它和JWT是什么关系？\u003c/p\u003e\n\u003cp\u003e简单地说，JWT是一种token格式，Bearer Token是一种鉴权方案。\u003c/p\u003e\n\u003cp\u003eHTTP的header项「Authorization」是在HTTP 1.0引入的，它的值的格式是\u003ccode\u003e类型+token\u003c/code\u003e，支持多种鉴权方案，bearer只是其中的一种。bearer方案中使用的token是JWT格式，这就是它们之间的关系。\u003c/p\u003e\n\u003ch2 id=\"jwt的格式\"\u003eJWT的格式\u003c/h2\u003e\n\u003cp\u003eJWT是一个用英文点号连接起来的、分成三个部分的字符串：header、payload和signature。\u003c/p\u003e\n\u003ch3 id=\"header\"\u003eheader\u003c/h3\u003e\n\u003cp\u003eheader是个base64字符串，解密后是个JSON对象，包含一些元数据。例如：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"err\"\u003e\u0026#39;typ\u0026#39;:\u003c/span\u003e \u003cspan class=\"err\"\u003e\u0026#39;JWT\u0026#39;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"err\"\u003e\u0026#39;alg\u0026#39;:\u003c/span\u003e \u003cspan class=\"err\"\u003e\u0026#39;HS256\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e「typ」是格式，「alg」是加密方法。\u003c/p\u003e\n\u003ch3 id=\"payload\"\u003epayload\u003c/h3\u003e\n\u003cp\u003epayload也是个base64字符串，解密后也是个JSON对象，一般包含两种数据：JWT标准数据和自定义数据。\u003c/p\u003e\n\u003cp\u003eJWT标准数据常见的有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eiss：提供方。\u003c/li\u003e\n\u003cli\u003esub：主题，一般是用户ID。\u003c/li\u003e\n\u003cli\u003eexp：过期时间。\u003c/li\u003e\n\u003cli\u003eiat：创建时间。\u003c/li\u003e\n\u003cli\u003ejti：token的唯一标识。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e此外，和session一样，可以把一些自定义的数据存储在payload里。但由于token存储在客户端，所以不应该在这里存储敏感数据。\u003c/p\u003e\n\u003ch3 id=\"signature\"\u003esignature\u003c/h3\u003e\n\u003cp\u003esignature也是个base64字符串，解密后是个使用header里描述的加密方法针对header和payload加密的字符串。目的是防止这两部分的数据被篡改。\u003c/p\u003e\n\u003ch2 id=\"jwt的使用原则\"\u003eJWT的使用原则\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e不存放敏感信息\u003c/li\u003e\n\u003cli\u003e保护好私钥\u003c/li\u003e\n\u003cli\u003e结合https使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e都是出于安全角度考虑。token存储在客户端，而且base64可以被解密，所以不能存储敏感数据。如果私钥泄漏，意味著签名可以被随意伪造。使用https可以更好的保护数据，防止中间人攻击。\u003c/p\u003e\n\u003ch2 id=\"jwt相关开发资源\"\u003eJWT相关开发资源\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://jwt.io/\"\u003ejwt.io\u003c/a\u003e有各种语言的JWT开发资源。\u003c/p\u003e","title":"JSON Web Token简介"},{"content":"国内移动支付是劣质的繁荣，量很大，但是水平低。\n我个人对移动支付偏爱的程度依次是：Apple Pay \u0026gt; 支付宝 \u0026gt; 微信。Apple Pay的体验最好，后两个都多出一个扫码的步骤，微信更是很奇葩地要多一步选卡的操作。\n不过采访过一些人，结果是用微信的最多。\n原因当然是微信的社交切入点带来的普及程度，还有红包的成功，让这个体验最差的东西后来居上。支付宝因为意识到这一点，才不断焦虑地效颦，自乱阵脚，越做越烂。\n我自己平时使用的情况是，能用信用卡支付的一般用支付宝，只能转账的才用微信。而且线下支付还是微信居多。主要原因还是线下的收款方都是小商小贩，大多只会用微信。\n中国正在形成阶层社会，但草根仍是主流，得草根者得天下。\n","permalink":"http://0x3f.org/posts/get-the-inferior-class-get-the-throne/","summary":"\u003cp\u003e国内移动支付是劣质的繁荣，量很大，但是水平低。\u003c/p\u003e\n\u003cp\u003e我个人对移动支付偏爱的程度依次是：Apple Pay \u0026gt; 支付宝 \u0026gt; 微信。Apple Pay的体验最好，后两个都多出一个扫码的步骤，微信更是很奇葩地要多一步选卡的操作。\u003c/p\u003e\n\u003cp\u003e不过采访过一些人，结果是用微信的最多。\u003c/p\u003e\n\u003cp\u003e原因当然是微信的社交切入点带来的普及程度，还有红包的成功，让这个体验最差的东西后来居上。支付宝因为意识到这一点，才不断焦虑地效颦，自乱阵脚，越做越烂。\u003c/p\u003e\n\u003cp\u003e我自己平时使用的情况是，能用信用卡支付的一般用支付宝，只能转账的才用微信。而且线下支付还是微信居多。主要原因还是线下的收款方都是小商小贩，大多只会用微信。\u003c/p\u003e\n\u003cp\u003e中国正在形成阶层社会，但草根仍是主流，得草根者得天下。\u003c/p\u003e","title":"得草根者得天下"},{"content":"REST不是一项技术，而是一种设计风格。它的核心思想是实现一种清晰明确的语义，用来描述Web操作。包含两个主要因素：HTTP动词和资源地址。\nHTTP动词的使用原则 参与Web操作的HTTP动词主要有GET、POST、DELETE、PUT、HEAD、PATCH。实际上，几乎所有的操作只需GET和POST就可以实现，为什么还要有其它几种呢？目的就是为了实现清晰明确的语义：DELETE /api/v1/post/18肯定比GET /api/v1/post?id=18\u0026amp;action=delete更清楚。\n因此HTTP动词使用的重点在于明确语义。例如更新操作，很多文章会说创建资源用POST、修改用PUT，实际上是对REST风格理解不透彻。\n总体上，HTTP动词分为两类：幂等和非幂等。幂等是个数学概念，对于一元操作，如果它作用于任一元素两次以上后所得的结果和第一次相同，就认为它是幂等的。简单地说，如果一个接口，传递同样的实参，多次请求的结果和一次没有不同，就认为它是安全的、幂等的，反之，就是不安全、非幂等的。\nGET、DELETE、PUT、HEAD是幂等操作，POST和PATCH是非幂等操作。因此，修改操作用POST还是PUT，要看操作本身的幂等与否。举个例子，对于修改用户描述的接口，调用任意次得到的结果都是相同的，所以它是幂等的，应该用PUT。而对于修改用户登录积分的操作，假设每次登录加十分，重复调用会导致分数重复增加，这就是不安全、非幂等的，应该用POST。\n资源地址的命名原则 资源地址是对被操作资源位置的描述，因此应该有以下几个原则：\n全部使用名词 不使用驼峰风格 资源名称统一使用复数 对于前两个，因为对资源的操作已由HTTP动词表述，资源地址里不应该存在动词，否则会造成语义的混乱。此外，不存在动词也就不需要使用驼峰风格。例如，GET /api/v1/getUser/89，「get」在语义上就重复了。\n关于资源名称用复数的原则，主要是为了API在风格上的统一，同一种资源用同一个单词表示，单、复数用资源的id表示，URI里有id的就是单数，否则是复数。\n结论 REST是风格而不是技术，出bug的可能性不大，并不是能实现业务逻辑、没有bug就是好代码。风格错了，连REST都不算。\n","permalink":"http://0x3f.org/posts/some-principles-on-designing-restful-api/","summary":"\u003cp\u003eREST不是一项技术，而是一种设计风格。它的核心思想是实现一种清晰明确的语义，用来描述Web操作。包含两个主要因素：HTTP动词和资源地址。\u003c/p\u003e\n\u003ch2 id=\"http动词的使用原则\"\u003eHTTP动词的使用原则\u003c/h2\u003e\n\u003cp\u003e参与Web操作的HTTP动词主要有GET、POST、DELETE、PUT、HEAD、PATCH。实际上，几乎所有的操作只需GET和POST就可以实现，为什么还要有其它几种呢？目的就是为了实现清晰明确的语义：\u003ccode\u003eDELETE /api/v1/post/18\u003c/code\u003e肯定比\u003ccode\u003eGET /api/v1/post?id=18\u0026amp;action=delete\u003c/code\u003e更清楚。\u003c/p\u003e\n\u003cp\u003e因此HTTP动词使用的重点在于明确语义。例如更新操作，很多文章会说创建资源用POST、修改用PUT，实际上是对REST风格理解不透彻。\u003c/p\u003e\n\u003cp\u003e总体上，HTTP动词分为两类：幂等和非幂等。幂等是个数学概念，对于一元操作，如果它作用于任一元素两次以上后所得的结果和第一次相同，就认为它是幂等的。简单地说，如果一个接口，传递同样的实参，多次请求的结果和一次没有不同，就认为它是安全的、幂等的，反之，就是不安全、非幂等的。\u003c/p\u003e\n\u003cp\u003eGET、DELETE、PUT、HEAD是幂等操作，POST和PATCH是非幂等操作。因此，修改操作用POST还是PUT，要看操作本身的幂等与否。举个例子，对于修改用户描述的接口，调用任意次得到的结果都是相同的，所以它是幂等的，应该用PUT。而对于修改用户登录积分的操作，假设每次登录加十分，重复调用会导致分数重复增加，这就是不安全、非幂等的，应该用POST。\u003c/p\u003e\n\u003ch2 id=\"资源地址的命名原则\"\u003e资源地址的命名原则\u003c/h2\u003e\n\u003cp\u003e资源地址是对被操作资源位置的描述，因此应该有以下几个原则：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e全部使用名词\u003c/li\u003e\n\u003cli\u003e不使用驼峰风格\u003c/li\u003e\n\u003cli\u003e资源名称统一使用复数\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e对于前两个，因为对资源的操作已由HTTP动词表述，资源地址里不应该存在动词，否则会造成语义的混乱。此外，不存在动词也就不需要使用驼峰风格。例如，\u003ccode\u003eGET /api/v1/getUser/89\u003c/code\u003e，「get」在语义上就重复了。\u003c/p\u003e\n\u003cp\u003e关于资源名称用复数的原则，主要是为了API在风格上的统一，同一种资源用同一个单词表示，单、复数用资源的id表示，URI里有id的就是单数，否则是复数。\u003c/p\u003e\n\u003ch2 id=\"结论\"\u003e结论\u003c/h2\u003e\n\u003cp\u003eREST是风格而不是技术，出bug的可能性不大，并不是能实现业务逻辑、没有bug就是好代码。风格错了，连REST都不算。\u003c/p\u003e","title":"设计RESTful API的几个原则"},{"content":"Pre-request Script和Tests都是Javascript代码块。前者在请求发起前执行，通常用来生成请求数据，例如对用户注册接口随机生成用户名。后者在请求结束后执行，通常用来测试和处理返回值。\n以下是随机生成用户名的Pre-request Script：\n1 postman.setEnvironmentVariable(\u0026#34;random_username\u0026#34;, \u0026#34;测试用户\u0026#34; + Math.floor(Math.random()*1000000)); 产生的值存储在环境变量里，表单里直接引用环境变量即可。\n对于REST接口普遍使用的JWT，可以在登录接口的Tests里直接把返回的token更新到环境变量里，这样其它接口直接引用这个环境变量即可：\n1 2 3 4 var data = JSON.parse(responseBody); tests[\u0026#34;token is returned\u0026#34;] = typeof(data.token) == \u0026#34;string\u0026#34; \u0026amp;\u0026amp; data.token.length \u0026gt; 0 postman.setEnvironmentVariable(\u0026#34;token\u0026#34;, data.token); ","permalink":"http://0x3f.org/posts/pre-request-script-and-tests-in-postman/","summary":"\u003cp\u003ePre-request Script和Tests都是Javascript代码块。前者在请求发起前执行，通常用来生成请求数据，例如对用户注册接口随机生成用户名。后者在请求结束后执行，通常用来测试和处理返回值。\u003c/p\u003e\n\u003cp\u003e以下是随机生成用户名的Pre-request Script：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003epostman\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetEnvironmentVariable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;random_username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;测试用户\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efloor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erandom\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000000\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e产生的值存储在环境变量里，表单里直接引用环境变量即可。\u003c/p\u003e\n\u003cp\u003e对于REST接口普遍使用的JWT，可以在登录接口的Tests里直接把返回的token更新到环境变量里，这样其它接口直接引用这个环境变量即可：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponseBody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003etests\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;token is returned\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;string\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003epostman\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetEnvironmentVariable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;token\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Postman的Pre-request Script和Tests"},{"content":"\n用树莓派做音频airplay效果不错，老书架音箱又可以用起来了。\n实现方式是shairplay-sync，利用HDMI转VGA线上的3.5mm音频输出孔，因为我的树莓派2B的3.5mm音视频输出口没有合适的转接头。\n我用的是Arch Linux ARM，需要手动开启HDMI输出。修改/boot/config.txt：\n1 2 3 4 hdmi_force_hotplug=1 hdmi_drive=2 config_hdmi_boost=4 dtparam=audio=on 重启后，用alsamixer把树莓派音量调整到最大值。\nAUR里没有针对ARM的shairplay-sync，需要手动编译：\n1 git clone https://github.com/mikebrady/shairport-sync.git 1 2 # 生成configure autoreconf -i -f 1 2 3 4 5 6 # 针对systemd编译 ./configure --sysconfdir=/etc --with-alsa --with-avahi --with-ssl=openssl --with-metadata --with-soxr --with-systemd # END 1 2 3 4 5 6 7 8 # 如果shairport-sync用户不存在，新增用户和用户组 getent group shairport-sync \u0026amp;\u0026gt;/dev/null || sudo groupadd -r shairport-sync \u0026gt;/dev/null getent passwd shairport-sync \u0026amp;\u0026gt; /dev/null || sudo useradd -r -M -g shairport-sync -s /usr/bin/nologin -G audio shairport-sync \u0026gt;/dev/null # END airplay默认的服务名和树莓派的hostname一致，可以到/etc/shairport-sync.conf里修改：\ngeneral = { name = \u0026#34;pi\u0026#34;; } FAQ ALSA lib confmisc.c:767:(parse_card) cannot find card \u0026lsquo;0\u0026rsquo; 树莓派没声音，尝试用mpg123播放mp3时报这个错。解决办法是在/boot/config.txt里增加dtparam=audio=on。\n","permalink":"http://0x3f.org/posts/implement-airplay-with-raspberry-pi/","summary":"\u003cp\u003e\u003cimg src=\"http://ww1.sinaimg.cn/large/006tKfTcly1fepi05fa8ej31kw1kwx6q.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e用树莓派做音频airplay效果不错，老书架音箱又可以用起来了。\u003c/p\u003e\n\u003cp\u003e实现方式是shairplay-sync，利用HDMI转VGA线上的3.5mm音频输出孔，因为我的树莓派2B的3.5mm音视频输出口没有合适的转接头。\u003c/p\u003e\n\u003cp\u003e我用的是Arch Linux ARM，需要手动开启HDMI输出。修改\u003ccode\u003e/boot/config.txt\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ehdmi_force_hotplug\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ehdmi_drive\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003econfig_hdmi_boost\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edtparam\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eaudio=on\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e重启后，用alsamixer把树莓派音量调整到最大值。\u003c/p\u003e\n\u003cp\u003eAUR里没有针对ARM的shairplay-sync，需要手动编译：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/mikebrady/shairport-sync.git\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 生成configure\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eautoreconf -i -f\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 针对systemd编译\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure --sysconfdir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc --with-alsa --with-avahi --with-ssl\u003cspan class=\"o\"\u003e=\u003c/span\u003eopenssl --with-metadata --with-soxr --with-systemd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# END\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 如果shairport-sync用户不存在，新增用户和用户组\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egetent group shairport-sync \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u0026gt;/dev/null \u003cspan class=\"o\"\u003e||\u003c/span\u003e sudo groupadd -r shairport-sync \u0026gt;/dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egetent passwd shairport-sync \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u0026gt; /dev/null \u003cspan class=\"o\"\u003e||\u003c/span\u003e sudo useradd -r -M -g shairport-sync -s /usr/bin/nologin -G audio shairport-sync \u0026gt;/dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# END\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eairplay默认的服务名和树莓派的hostname一致，可以到\u003ccode\u003e/etc/shairport-sync.conf\u003c/code\u003e里修改：\u003c/p\u003e","title":"用Raspberry Pi实现音频Airplay"},{"content":"\n前言 传统的做法是用office写接口文档，这种方式的缺点很多：\n格式混乱 事实上，所有的传统富文本文档都存在这个问题，富文本的跨平台兼容性很差，很容易造成格式错乱。\n版本管理困难 依赖文件系统管理文档是很落后的做法，很难保证手头的文档是最新的版本。\n兼容性差 不是所有人都用windows。\n低效 对效率的负面影响很大程度上已经包含在前面几项里。此外，编辑工具的臃肿、编辑内容的同时还要调整样式、缺少全文检索等，也是导致效率下降的原因。\n理想情况 理想的接口文档应该有以下特征：\n方便创作 文档编辑最重要的是文档的内容，而不是编辑操作本身。所以编写文档的过程应该是简单快捷的，而且最好不需要额外的学习成本。\n排版简洁规范 技术文档的排版，简洁规范是最重要的，花哨的排版会降低效率。\n方便查阅 应该有目录或者大纲视图，并且可以方便地全文检索。\n在线协作 传统的离线文档不方便协作。\n多端兼容 允许在大多数常见平台编辑和使用文档。\n版本管理 可以查看什么人在什么时间改了哪些内容。\n交互式文档 所见即所得。可以修改参数、发送请求并查看接口返回值。\n可订阅 可以给接口打标签。用户可以订阅任意标签下的接口变更，也可以针对接口订阅。\n自动生成 如果代码的可读性足够好，何必浪费时间写文档？或者至少可以自动生成。\n当前实践 理想很丰满，但是目前还没有能满足以上所有需求的解决方案。权衡之下，markdown和wiki是目前比较合适的方案。\nmarkdown 用markdown写文档有以下特点：\n适合单文档形式 主流git托管平台都支持 适合个人创作 适合小型项目、需要移交开发成果的项目 下面是用markdown写的接口文档的例子： 主流markdown编辑器在转换过程中会为标题添加锚点，利用这个特性可以实现从接口列表跳转到接口详情。\n最佳工具 Cmd Markdown\n美观 跨平台 编辑操作支持Vim模式 wiki 用wiki写文档有这些特点：\n方便多层级文档 需要自己搭建平台 适合团队创作 适合长期、大型项目 最佳工具 dokuwiki\n刚刚好 结论 综上，小型的、托管在主流git平台的项目适合用markdown，公司级项目用wiki更好。但这还达不到理想的标准，需要继续探索更好的解决方案。\n","permalink":"http://0x3f.org/posts/the-best-practice-of-writing-api-documents/","summary":"\u003cp\u003e\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx9m0n7jj30rr0m8gpa.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e传统的做法是用office写接口文档，这种方式的缺点很多：\u003c/p\u003e\n\u003ch3 id=\"格式混乱\"\u003e格式混乱\u003c/h3\u003e\n\u003cp\u003e事实上，所有的传统富文本文档都存在这个问题，富文本的跨平台兼容性很差，很容易造成格式错乱。\u003c/p\u003e\n\u003ch3 id=\"版本管理困难\"\u003e版本管理困难\u003c/h3\u003e\n\u003cp\u003e依赖文件系统管理文档是很落后的做法，很难保证手头的文档是最新的版本。\u003c/p\u003e\n\u003ch3 id=\"兼容性差\"\u003e兼容性差\u003c/h3\u003e\n\u003cp\u003e不是所有人都用windows。\u003c/p\u003e\n\u003ch3 id=\"低效\"\u003e低效\u003c/h3\u003e\n\u003cp\u003e对效率的负面影响很大程度上已经包含在前面几项里。此外，编辑工具的臃肿、编辑内容的同时还要调整样式、缺少全文检索等，也是导致效率下降的原因。\u003c/p\u003e\n\u003ch2 id=\"理想情况\"\u003e理想情况\u003c/h2\u003e\n\u003cp\u003e理想的接口文档应该有以下特征：\u003c/p\u003e\n\u003ch3 id=\"方便创作\"\u003e方便创作\u003c/h3\u003e\n\u003cp\u003e文档编辑最重要的是文档的内容，而不是编辑操作本身。所以编写文档的过程应该是简单快捷的，而且最好不需要额外的学习成本。\u003c/p\u003e\n\u003ch3 id=\"排版简洁规范\"\u003e排版简洁规范\u003c/h3\u003e\n\u003cp\u003e技术文档的排版，简洁规范是最重要的，花哨的排版会降低效率。\u003c/p\u003e\n\u003ch3 id=\"方便查阅\"\u003e方便查阅\u003c/h3\u003e\n\u003cp\u003e应该有目录或者大纲视图，并且可以方便地全文检索。\u003c/p\u003e\n\u003ch3 id=\"在线协作\"\u003e在线协作\u003c/h3\u003e\n\u003cp\u003e传统的离线文档不方便协作。\u003c/p\u003e\n\u003ch3 id=\"多端兼容\"\u003e多端兼容\u003c/h3\u003e\n\u003cp\u003e允许在大多数常见平台编辑和使用文档。\u003c/p\u003e\n\u003ch3 id=\"版本管理\"\u003e版本管理\u003c/h3\u003e\n\u003cp\u003e可以查看什么人在什么时间改了哪些内容。\u003c/p\u003e\n\u003ch3 id=\"交互式文档\"\u003e交互式文档\u003c/h3\u003e\n\u003cp\u003e所见即所得。可以修改参数、发送请求并查看接口返回值。\u003c/p\u003e\n\u003ch3 id=\"可订阅\"\u003e可订阅\u003c/h3\u003e\n\u003cp\u003e可以给接口打标签。用户可以订阅任意标签下的接口变更，也可以针对接口订阅。\u003c/p\u003e\n\u003ch3 id=\"自动生成\"\u003e自动生成\u003c/h3\u003e\n\u003cp\u003e如果代码的可读性足够好，何必浪费时间写文档？或者至少可以自动生成。\u003c/p\u003e\n\u003ch2 id=\"当前实践\"\u003e当前实践\u003c/h2\u003e\n\u003cp\u003e理想很丰满，但是目前还没有能满足以上所有需求的解决方案。权衡之下，markdown和wiki是目前比较合适的方案。\u003c/p\u003e\n\u003ch3 id=\"markdown\"\u003emarkdown\u003c/h3\u003e\n\u003cp\u003e用markdown写文档有以下特点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e适合单文档形式\u003c/li\u003e\n\u003cli\u003e主流git托管平台都支持\u003c/li\u003e\n\u003cli\u003e适合个人创作\u003c/li\u003e\n\u003cli\u003e适合小型项目、需要移交开发成果的项目\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e下面是用markdown写的接口文档的例子：\n\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvx9zyd4tj30h81qbn05.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e主流markdown编辑器在转换过程中会为标题添加锚点，利用这个特性可以实现从接口列表跳转到接口详情。\u003c/p\u003e\n\u003ch4 id=\"最佳工具\"\u003e最佳工具\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://www.zybuluo.com\"\u003eCmd Markdown\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e美观\u003c/li\u003e\n\u003cli\u003e跨平台\u003c/li\u003e\n\u003cli\u003e编辑操作支持Vim模式\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"wiki\"\u003ewiki\u003c/h3\u003e\n\u003cp\u003e用wiki写文档有这些特点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e方便多层级文档\u003c/li\u003e\n\u003cli\u003e需要自己搭建平台\u003c/li\u003e\n\u003cli\u003e适合团队创作\u003c/li\u003e\n\u003cli\u003e适合长期、大型项目\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"最佳工具-1\"\u003e最佳工具\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://www.dokuwiki.org\"\u003edokuwiki\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e刚刚好\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"结论\"\u003e结论\u003c/h2\u003e\n\u003cp\u003e综上，小型的、托管在主流git平台的项目适合用markdown，公司级项目用wiki更好。但这还达不到理想的标准，需要继续探索更好的解决方案。\u003c/p\u003e","title":"编写接口文档的最佳实践"},{"content":"一个workflow对https链接的请求总是失败，而同样的接口在postman里是成功的。所以想对比一下两个请求的差异。\n尝试了两种抓包方式，都不成功。一种是用中间人攻击的原理，用的是mitmproxy，类似的还有charles、fiddler等。另一种是从网卡直接抓取，用的是wireshark。\n第一种情况，虽然在iOS里安装并信任了mitmproxy的伪证书、safari里也是可以正常访问https链接的，但在workflow里仍然不认。\n第二种情况，wireshark支持两种解密TLS包的方式：一是使用https服务的私钥，二是用浏览器输出的「SSLKEYLOGFILE」。这里需要用第二种。但是这种方式只对本机发送的请求有效，而且在实际操作中还发现有时候本机也解密不了。\n最后只能采用临时方案，把https链接改成http，然后用mitmproxy抓取，虽然请求是失败的，但是可以拿到请求本身的数据。\n","permalink":"http://0x3f.org/posts/a-failed-attempt-to-capture-workflow-requests/","summary":"\u003cp\u003e一个workflow对https链接的请求总是失败，而同样的接口在postman里是成功的。所以想对比一下两个请求的差异。\u003c/p\u003e\n\u003cp\u003e尝试了两种抓包方式，都不成功。一种是用中间人攻击的原理，用的是mitmproxy，类似的还有charles、fiddler等。另一种是从网卡直接抓取，用的是wireshark。\u003c/p\u003e\n\u003cp\u003e第一种情况，虽然在iOS里安装并信任了mitmproxy的伪证书、safari里也是可以正常访问https链接的，但在workflow里仍然不认。\u003c/p\u003e\n\u003cp\u003e第二种情况，wireshark支持两种解密TLS包的方式：一是使用https服务的私钥，二是用浏览器输出的「SSLKEYLOGFILE」。这里需要用第二种。但是这种方式只对本机发送的请求有效，而且在实际操作中还发现有时候本机也解密不了。\u003c/p\u003e\n\u003cp\u003e最后只能采用临时方案，把https链接改成http，然后用mitmproxy抓取，虽然请求是失败的，但是可以拿到请求本身的数据。\u003c/p\u003e","title":"一次对Workflow不完全成功的抓包过程"},{"content":"有一小片樱花集中的地方还是不错的，风来，落英缤纷。\n","permalink":"http://0x3f.org/posts/sakura-in-yuyuantan-park/","summary":"\u003cp\u003e有一小片樱花集中的地方还是不错的，风来，落英缤纷。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-08-25-11-27-14-2FC4E1F6-5DDF-4F5A-B952-B12F45516E5B_1_105_c.jpeg\" alt=\"2023-08-25-11-27-14-2FC4E1F6-5DDF-4F5A-B952-B12F45516E5B_1_105_c\"\u003e\u003c/p\u003e","title":"玉渊潭的樱花"},{"content":"转换成 PDF 和 FiveFilters 都不完美， send.reabble.cn 是迄今最好的解决方案，所以写了这个快捷指令：\nSend to Kindle\n注意：\n参照 Reabble 的说明做相关配置。 用 Kindle 接收邮箱创建一个联系人，并在快捷指令里选择他。 2023-04-20\n优化了提示信息。\n2021-10-05\n使用新的 send.reabble.cn 替换原 com 域名，修复发送失败的问题。\n","permalink":"http://0x3f.org/posts/send-to-kindle-with-shortcut/","summary":"\u003cp\u003e转换成 PDF 和 FiveFilters 都不完美， \u003ccode\u003esend.reabble.cn\u003c/code\u003e 是迄今最好的解决方案，所以写了这个快捷指令：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.icloud.com/shortcuts/4570dd39486c4d3fb35ee0bb1254e324\"\u003eSend to Kindle\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e注意：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e参照 Reabble 的说明做相关配置。\u003c/li\u003e\n\u003cli\u003e用 Kindle 接收邮箱创建一个联系人，并在快捷指令里选择他。\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e2023-04-20\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e优化了提示信息。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e2021-10-05\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e使用新的 send.reabble.cn 替换原 com 域名，修复发送失败的问题。\u003c/p\u003e\n\u003c/blockquote\u003e","title":"迄今最好的发送网页到 Kindle 的快捷指令"},{"content":"导入这里提供的配置文件。\n","permalink":"http://0x3f.org/posts/how-to-play-youku-under-shadowrocket/","summary":"\u003cp\u003e导入\u003ca href=\"http://www.abclite.cn/1995.html\"\u003e这里\u003c/a\u003e提供的配置文件。\u003c/p\u003e","title":"Shadowrocket下优酷无法播放的解决办法"},{"content":"RSS真是没落了，很多网站都没有明确输出Feed地址，每次想订阅都要浪费不少时间，所以写了这个Workflow。\n列出页面中所有的Feed地址，点击后复制到剪贴板 如果页面中的Feed地址是相对地址，自动转换为绝对地址 如果页面中没有Feed地址，列出常见的几种地址，并侦测被点选的地址，侦测成功后自动复制到剪贴板 ","permalink":"http://0x3f.org/posts/find-rss-with-workflow/","summary":"\u003cp\u003eRSS真是没落了，很多网站都没有明确输出Feed地址，每次想订阅都要浪费不少时间，所以写了这个\u003ca href=\"https://workflow.is/workflows/7f02a38a6c21414a96a4f96600c94662\"\u003eWorkflow\u003c/a\u003e。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e列出页面中所有的Feed地址，点击后复制到剪贴板\u003c/li\u003e\n\u003cli\u003e如果页面中的Feed地址是相对地址，自动转换为绝对地址\u003c/li\u003e\n\u003cli\u003e如果页面中没有Feed地址，列出常见的几种地址，并侦测被点选的地址，侦测成功后自动复制到剪贴板\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cimg src=\"https://ww1.sinaimg.cn/large/006tNc79ly1fdy95stcokj30ih0wugnk.jpg\" alt=\"\"\u003e\n\u003cimg src=\"https://ww3.sinaimg.cn/large/006tNc79ly1fdy95w6sncj30ih0wumyy.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"自动探测RSS地址的workflow"},{"content":"按以下步骤配置：\n在 Keychain 里创建一个密码项，填上 Apple ID 和密码。 下载 login_mas.kmmacros 并导入。 将 YOUR@EMAIL.COM 改成自己的 Apple ID 。 将 YOUR KEYCHAIN PASSWORD NAME 改成 Keychain 里密码项的名称。 ","permalink":"http://0x3f.org/posts/auto-login-mas-with-keyboard-maestro/","summary":"\u003cp\u003e按以下步骤配置：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e在 Keychain 里创建一个密码项，填上 Apple ID 和密码。\u003c/li\u003e\n\u003cli\u003e下载 \u003ca href=\"/attachments/login_mas.kmmacros\"\u003elogin_mas.kmmacros\u003c/a\u003e 并导入。\u003c/li\u003e\n\u003cli\u003e将 \u003ccode\u003eYOUR@EMAIL.COM\u003c/code\u003e 改成自己的 Apple ID 。\u003c/li\u003e\n\u003cli\u003e将 \u003ccode\u003eYOUR KEYCHAIN PASSWORD NAME\u003c/code\u003e 改成 Keychain 里密码项的名称。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2023-07-09-21-29-57-login_mas_with_keyboard_maestro.png\" alt=\"2023-07-09-21-29-57-login_mas_with_keyboard_maestro\"\u003e\u003c/p\u003e","title":"用 Keyboard Maestro 自动登录 Mac App Store"},{"content":"原则：\n一键切换 可以对特定应用设定初始输入状态 可以方便地确认当前输入状态 兼容外接键盘 思路：\n用Karabiner Elements把右Shift修改成F19，在系统里设置用F19切换输入法 用isHUD显示输入法状态 用Keyboard Maestro自动切换键盘布局 Karabiner Elements会使系统的键盘布局失效，且不能对不同的键盘使用不同的布局，所以只有用Keyboard Maestro自动切换。\nisHUD只在切换输入法时有效，理想情况是用Caps Lock键灯表示输入状态，不过目前没找到可用的解决办法。\n鼠须管可以对不同的应用设置初始输入状态，但只是在切换输入法后，例如对于Alfred，如果上次鼠须管处于中文输入状态，再次打开输入框的时候不会变成英文状态，因此需要在Alfred中设置初始输入法为英文。\n","permalink":"http://0x3f.org/posts/the-best-practice-of-switching-input-methods-in-macos/","summary":"\u003cp\u003e原则：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e一键切换\u003c/li\u003e\n\u003cli\u003e可以对特定应用设定初始输入状态\u003c/li\u003e\n\u003cli\u003e可以方便地确认当前输入状态\u003c/li\u003e\n\u003cli\u003e兼容外接键盘\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e思路：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e用Karabiner Elements把右Shift修改成F19，在系统里设置用F19切换输入法\u003c/li\u003e\n\u003cli\u003e用isHUD显示输入法状态\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/auto-switch-keyboard-layouts-in-macos/\"\u003e用Keyboard Maestro自动切换键盘布局\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eKarabiner Elements会使系统的键盘布局失效，且不能对不同的键盘使用不同的布局，所以只有用Keyboard Maestro自动切换。\u003c/p\u003e\n\u003cp\u003eisHUD只在切换输入法时有效，理想情况是用Caps Lock键灯表示输入状态，不过目前没找到可用的解决办法。\u003c/p\u003e\n\u003cp\u003e鼠须管可以对不同的应用设置初始输入状态，但只是在切换输入法后，例如对于Alfred，如果上次鼠须管处于中文输入状态，再次打开输入框的时候不会变成英文状态，因此需要在Alfred中设置初始输入法为英文。\u003c/p\u003e","title":"MacOS中切换输入法的最佳实践"},{"content":"Karabiner Elements不支持对不同的键盘自动使用不同的配置，所以本文通过监听USB键盘插拔事件实现自动切换。\n依赖： Keyboard Maestro php 脚本 Karabiner Elements会监听配置文件~/.config/karabiner/karabiner.json，如果有变动，会自动重新加载。\n切换配置的脚本在这里。\nKeyboard Maestro 键盘插入事件：\n键盘拔出事件：\n","permalink":"http://0x3f.org/posts/auto-switch-keyboard-layouts-in-macos/","summary":"\u003cp\u003eKarabiner Elements不支持对不同的键盘自动使用不同的配置，所以本文通过监听USB键盘插拔事件实现自动切换。\u003c/p\u003e\n\u003ch2 id=\"依赖\"\u003e依赖：\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eKeyboard Maestro\u003c/li\u003e\n\u003cli\u003ephp\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"脚本\"\u003e脚本\u003c/h2\u003e\n\u003cp\u003eKarabiner Elements会监听配置文件\u003ccode\u003e~/.config/karabiner/karabiner.json\u003c/code\u003e，如果有变动，会自动重新加载。\u003c/p\u003e\n\u003cp\u003e切换配置的脚本在\u003ca href=\"https://github.com/xbot/shell/blob/master/karabiner-elements-profile-switcher.php\"\u003e这里\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 id=\"keyboard-maestro\"\u003eKeyboard Maestro\u003c/h2\u003e\n\u003cp\u003e键盘插入事件：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://ww3.sinaimg.cn/large/006tNc79ly1fdt8iy3ydmj30cq0b6q3z.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e键盘拔出事件：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://ww2.sinaimg.cn/large/006tNc79ly1fdt8jz1aspj30cn0b1my6.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"MacOS下自动切换Karabiner Elements配置"},{"content":"\n近年明前都要试一种新茶，今年是碧螺春。\n不觉得有什么特别的地方，就是不耐泡。\n","permalink":"http://0x3f.org/posts/try-biluochun-2017/","summary":"\u003cp\u003e\u003cimg src=\"https://ww2.sinaimg.cn/large/006tNc79ly1fdsbari7pij30sg0sgk0d.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e近年明前都要试一种新茶，今年是碧螺春。\u003c/p\u003e\n\u003cp\u003e不觉得有什么特别的地方，就是不耐泡。\u003c/p\u003e","title":"尝新，明前碧螺春"},{"content":"\n继续清淡。\n依赖：\n挂面 小葱 香油、盐、陈醋、生抽 实现：\n小葱切丁，碗里放醋、生抽、盐 水烧开，下面，点一次水 捞面，浇汤 ","permalink":"http://0x3f.org/posts/noodles-in-acid-soup/","summary":"\u003cp\u003e\u003cimg src=\"https://ww4.sinaimg.cn/large/006tNc79ly1fdsballmi5j30sg0sgdnh.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e继续清淡。\u003c/p\u003e\n\u003cp\u003e依赖：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e挂面\u003c/li\u003e\n\u003cli\u003e小葱\u003c/li\u003e\n\u003cli\u003e香油、盐、陈醋、生抽\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e实现：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e小葱切丁，碗里放醋、生抽、盐\u003c/li\u003e\n\u003cli\u003e水烧开，下面，点一次水\u003c/li\u003e\n\u003cli\u003e捞面，浇汤\u003c/li\u003e\n\u003c/ol\u003e","title":"一碗酸汤面"},{"content":"\n心水沙发椅很久了，终于拔草。\n因为喜欢极简，之前一直用著一张双人小沙发，但是不够舒适，也不便移动。后来坐过一间餐厅的沙发椅感觉包覆感很好，就想著换一下，于是出掉了沙发，准备入一把伊姆斯椅，偶然看到现在这把，瞬间庆幸没有草率地买前者。\n在阳台上阅读变得更有趣了，这椅子和小抱枕很搭（不是照片中这个）。\n","permalink":"http://0x3f.org/posts/my-new-sofa-chair/","summary":"\u003cp\u003e\u003cimg src=\"https://ww2.sinaimg.cn/large/006tNc79ly1fdrdpa2eu2j30sg0sg7cu.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e心水沙发椅很久了，终于拔草。\u003c/p\u003e\n\u003cp\u003e因为喜欢极简，之前一直用著一张双人小沙发，但是不够舒适，也不便移动。后来坐过一间餐厅的沙发椅感觉包覆感很好，就想著换一下，于是出掉了沙发，准备入一把伊姆斯椅，偶然看到现在这把，瞬间庆幸没有草率地买前者。\u003c/p\u003e\n\u003cp\u003e在阳台上阅读变得更有趣了，这椅子和小抱枕很搭（\u003cem\u003e不是照片中这个\u003c/em\u003e）。\u003c/p\u003e","title":"沙发椅，让阅读更有趣"},{"content":"\n想吃点清淡的。\n依赖：\n挂面 小葱 香油、盐 实现：\n小葱切丁 水烧开，下面，点一次水 捞面沥水，撒葱花、盐，浇开水 ","permalink":"http://0x3f.org/posts/noodles-in-a-simple-sauce/","summary":"\u003cp\u003e\u003cimg src=\"https://ww2.sinaimg.cn/large/006tNbRwly1fdra76g0i1j30sg0sgjy4.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e想吃点清淡的。\u003c/p\u003e\n\u003cp\u003e依赖：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e挂面\u003c/li\u003e\n\u003cli\u003e小葱\u003c/li\u003e\n\u003cli\u003e香油、盐\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e实现：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e小葱切丁\u003c/li\u003e\n\u003cli\u003e水烧开，下面，点一次水\u003c/li\u003e\n\u003cli\u003e捞面沥水，撒葱花、盐，浇开水\u003c/li\u003e\n\u003c/ol\u003e","title":"一碗阳春面"},{"content":"\n没有平底锅和夹子是硬伤啊。\n依赖：\n土豆 黄豆酱、干辣椒、花椒、姜、蒜、油 实现：\n土豆切片，干辣椒掰两半，姜切丝，蒜切块 土豆片放沸水30秒，煎黄取出 放油、黄豆酱、干辣椒、花椒、姜、蒜，炒香 放土豆片，翻炒，太干的话放一点水 ","permalink":"http://0x3f.org/posts/new-dish-dry-pot-potato/","summary":"\u003cp\u003e\u003cimg src=\"https://ww1.sinaimg.cn/large/006tNbRwly1fdoid7q73mj30sg0sgwnf.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e没有平底锅和夹子是硬伤啊。\u003c/p\u003e\n\u003cp\u003e依赖：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e土豆\u003c/li\u003e\n\u003cli\u003e黄豆酱、干辣椒、花椒、姜、蒜、油\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e实现：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e土豆切片，干辣椒掰两半，姜切丝，蒜切块\u003c/li\u003e\n\u003cli\u003e土豆片放沸水30秒，煎黄取出\u003c/li\u003e\n\u003cli\u003e放油、黄豆酱、干辣椒、花椒、姜、蒜，炒香\u003c/li\u003e\n\u003cli\u003e放土豆片，翻炒，太干的话放一点水\u003c/li\u003e\n\u003c/ol\u003e","title":"干锅土豆片"},{"content":"鼠须管默认输出繁体，可以通过自带的过滤器转换成简体。这样做是科学的，因为繁体的异体字较多，从简转繁容易转错。\n对于只有简体的码表，可以转换成繁体，再通过过滤器转简体，但是会导致在简体状态下无法自造词。所以最好的办法是给繁体单独配一个码表。\n步骤为：\n复制简体码表的schema.yaml和dict.yaml文件 修改两个yaml文件的名称 文件内容中和文件名对应的内容也都改为和新文件名一致 修改schema.yaml中输入法的名称，使之和简体码表区分开 转换dict.yaml中的内容到繁体 重新部署 如果需要给繁体码表增加临时输出简体的功能，方法如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 在码表的schema.yaml中 # switches下增加 - name: simplification states: [ 汉字, 汉字 ] # engine下增加 filters: - simplifier - uniquifier #key_binder下增加 - { when: always, accept: Control+Shift+4, toggle: simplification } - { when: always, accept: Control+Shift+dollar, toggle: simplification } ","permalink":"http://0x3f.org/posts/switch-cn-tw-in-rime/","summary":"\u003cp\u003e鼠须管默认输出繁体，可以通过自带的过滤器转换成简体。这样做是科学的，因为繁体的异体字较多，从简转繁容易转错。\u003c/p\u003e\n\u003cp\u003e对于只有简体的码表，可以转换成繁体，再通过过滤器转简体，但是会导致在简体状态下无法自造词。所以最好的办法是给繁体单独配一个码表。\u003c/p\u003e\n\u003cp\u003e步骤为：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e复制简体码表的schema.yaml和dict.yaml文件\u003c/li\u003e\n\u003cli\u003e修改两个yaml文件的名称\u003c/li\u003e\n\u003cli\u003e文件内容中和文件名对应的内容也都改为和新文件名一致\u003c/li\u003e\n\u003cli\u003e修改schema.yaml中输入法的名称，使之和简体码表区分开\u003c/li\u003e\n\u003cli\u003e转换dict.yaml中的内容到繁体\u003c/li\u003e\n\u003cli\u003e重新部署\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e如果需要给繁体码表增加临时输出简体的功能，方法如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# 在码表的schema.yaml中\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# switches下增加\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003esimplification\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003estates\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e汉字, 汉字 ]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# engine下增加\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efilters\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003esimplifier\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003euniquifier\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e#key_binder下增加\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- {\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003ewhen: always, accept: Control+Shift+4, toggle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003esimplification }\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- {\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003ewhen: always, accept: Control+Shift+dollar, toggle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003esimplification }\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"鼠须管实现简繁转换的方法"},{"content":"\n去年学的。\n依赖：\n菜花 姜、干辣椒、花椒 黄豆酱、生抽、料酒、油 实现：\n菜花泡盐水 放油、姜、花椒、干辣椒、豆瓣酱，炒香 放菜花，翻炒入味 放生抽、料酒 ","permalink":"http://0x3f.org/posts/dry-pot-cauliflower/","summary":"\u003cp\u003e\u003cimg src=\"https://ww1.sinaimg.cn/large/006tNbRwly1fdfq6e4b0qj30sg0sg11s.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e去年学的。\u003c/p\u003e\n\u003cp\u003e依赖：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e菜花\u003c/li\u003e\n\u003cli\u003e姜、干辣椒、花椒\u003c/li\u003e\n\u003cli\u003e黄豆酱、生抽、料酒、油\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e实现：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e菜花泡盐水\u003c/li\u003e\n\u003cli\u003e放油、姜、花椒、干辣椒、豆瓣酱，炒香\u003c/li\u003e\n\u003cli\u003e放菜花，翻炒入味\u003c/li\u003e\n\u003cli\u003e放生抽、料酒\u003c/li\u003e\n\u003c/ol\u003e","title":"干锅菜花"},{"content":"\n去年学的，今天忘买蒜了，也挺好吃的。\n依赖：\n杏鲍菇 胡萝卜 青椒 姜、蒜、黑胡椒粉、淀粉、生抽、盐、油 实现：\n杏鲍菇、胡萝卜、蒜切片，青椒、姜切丝，淀粉勾芡 放油、蒜、姜，油热后放胡萝卜，炒至半熟 放杏鲍菇，炒软 芡汁入锅，放黑胡椒粉、生抽、盐 放青椒 炒至色泽出现、汤汁量合适出锅 ","permalink":"http://0x3f.org/posts/new-dish-mushroom-carrot-pepper/","summary":"\u003cp\u003e\u003cimg src=\"https://ww2.sinaimg.cn/large/006tNbRwly1fdekxg6n3nj30sg0sgn60.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e去年学的，今天忘买蒜了，也挺好吃的。\u003c/p\u003e\n\u003cp\u003e依赖：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e杏鲍菇\u003c/li\u003e\n\u003cli\u003e胡萝卜\u003c/li\u003e\n\u003cli\u003e青椒\u003c/li\u003e\n\u003cli\u003e姜、蒜、黑胡椒粉、淀粉、生抽、盐、油\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e实现：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e杏鲍菇、胡萝卜、蒜切片，青椒、姜切丝，淀粉勾芡\u003c/li\u003e\n\u003cli\u003e放油、蒜、姜，油热后放胡萝卜，炒至半熟\u003c/li\u003e\n\u003cli\u003e放杏鲍菇，炒软\u003c/li\u003e\n\u003cli\u003e芡汁入锅，放黑胡椒粉、生抽、盐\u003c/li\u003e\n\u003cli\u003e放青椒\u003c/li\u003e\n\u003cli\u003e炒至色泽出现、汤汁量合适出锅\u003c/li\u003e\n\u003c/ol\u003e","title":"胡萝卜炒杏鲍菇"},{"content":"两个方法：走代理和使用国内镜像。镜像有同步时间差，而且遇到国外资源还是慢。\nhomebrew用curl下载，用proxychains和环境变量http_proxy都没用，需要在~/.curlrc里配置：\nsocks5 = \u0026#34;127.0.0.1:1080\u0026#34; ","permalink":"http://0x3f.org/posts/speed-up-homebew/","summary":"\u003cp\u003e两个方法：走代理和使用国内镜像。镜像有同步时间差，而且遇到国外资源还是慢。\u003c/p\u003e\n\u003cp\u003ehomebrew用curl下载，用proxychains和环境变量http_proxy都没用，需要在\u003ccode\u003e~/.curlrc\u003c/code\u003e里配置：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003esocks5 = \u0026#34;127.0.0.1:1080\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e","title":"加速Homebrew"},{"content":"CORS的全称是「Cross-Origin Resource Sharing」，即跨域资源共享。\nCORS是比JSONP更强大的前端跨域请求的实现方式。JSONP只支持GET请求，而CORS支持更多种类。JSONP的优势是支持老版本的浏览器。\n实现CORS需要浏览器和服务器同时支持，主流框架有实现CORS的中间件，如：laravel-cors。\n具体参考：http://www.ruanyifeng.com/blog/2016/04/cors.html\n","permalink":"http://0x3f.org/posts/cors/","summary":"\u003cp\u003eCORS的全称是「Cross-Origin Resource Sharing」，即跨域资源共享。\u003c/p\u003e\n\u003cp\u003eCORS是比JSONP更强大的前端跨域请求的实现方式。JSONP只支持GET请求，而CORS支持更多种类。JSONP的优势是支持老版本的浏览器。\u003c/p\u003e\n\u003cp\u003e实现CORS需要浏览器和服务器同时支持，主流框架有实现CORS的中间件，如：\u003ca href=\"https://github.com/barryvdh/laravel-cors\"\u003elaravel-cors\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e具体参考：http://www.ruanyifeng.com/blog/2016/04/cors.html\u003c/p\u003e","title":"CORS：另一种前端跨域请求方式"},{"content":"假设有这样一段代码（光标在「|」位置）：\n$title = \u0026ldquo;Article:|\u0026rdquo; . $realTitle;\n要删除引号及其内容，并进入插入模式准备输入其它内容。\n如果执行ca\u0026quot;，会得到如下的结果：\n$title = |. $realTitle;\n连引号旁边的空格也删除了。\n如果不想删除空格，可以用c2i\u0026quot;。\n参考：Is it possible to exclude surrounding whitespace from the word-object a\u0026quot;?\n","permalink":"http://0x3f.org/posts/how-to-delete-quoted-text-object-in-vim/","summary":"\u003cp\u003e假设有这样一段代码（光标在「|」位置）：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e$title = \u0026ldquo;Article:|\u0026rdquo; . $realTitle;\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e要删除引号及其内容，并进入插入模式准备输入其它内容。\u003c/p\u003e\n\u003cp\u003e如果执行\u003ccode\u003eca\u0026quot;\u003c/code\u003e，会得到如下的结果：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e$title = |. $realTitle;\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e连引号旁边的空格也删除了。\u003c/p\u003e\n\u003cp\u003e如果不想删除空格，可以用\u003ccode\u003ec2i\u0026quot;\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e参考：\u003ca href=\"https://www.reddit.com/r/vim/comments/5v4gm5/is_it_possible_to_exclude_surrounding_whitespace/\"\u003eIs it possible to exclude surrounding whitespace from the word-object \u003ccode\u003ea\u0026quot;\u003c/code\u003e?\u003c/a\u003e\u003c/p\u003e","title":"怎样在Vim中删除引号文本对象"},{"content":"在以往的开发和管理中遇到很多问题，以至于我对理想中的技术团队有了一些想法。其中有两点经过实践证明有很强的可操作性，值得拿出来讨论一下：\n能用规则解决的问题就不要靠人解决 能用机器完成的任务就不要用人处理 这两点都反映了我的一个妄念，就是相信规则和机器，不相信人。人是最不靠谱的生产者，你永远无法保证团队中的每个人都处于很好的状态、拥有相近的技术水平和情商，这也是为什么我不觉得结对编程有什么可操作性。但如果有简单可行的规则，用来规范开发过程中的行为，那么解决开发过程中的冲突就不需要人为地和稀泥，生产效率也会得到提升。此外，机器最适合用来做重复性的任务，很多花大量的人力、物力、时间都没做得很好的事，交给机器来做恰恰是最好的解决办法。\n这些以往都只是我自己的想法，虽然在团队里有过很好的实践效果，但是并不指望和别人有所共鸣。国内的技术团队大多靠堆人、堆时间，很少有团队会把健康的世界观和可操作的方法论放在重要的位置，技术和技术从业者都是刍狗。当然这也无可厚非，毕竟先要解决生存问题，在模式创新为主的国内互联网行业，更新换代如此之快，产品早一天上线就多一分生存的可能。但是有没有可能既解决生存问题，又做出一个有荣誉感的团队呢？世间安得双全法，这是个值得持续讨论的问题。\n最近和别人聊天，竟然听到相同的想法，在具体的方法论上还得到很多补充。\n对于第一点。一个项目按业务线划分开发组、按功能模块划分开发任务本来是个很好的模式，但是接口的对接往往会有很多问题，例如术语使用的不严谨导致高昂的沟通成本、问题处理方法的不规范导致扯皮、冲突和低效。\n在我的团队里，用wiki维护著一套术语词典，开发过程中所有的文档、沟通都必须使用既定的用语，例如「退单」包括「退款单」和「退货单」，这三个术语分别表示不同而精确的概念，如果因为自己造词产生歧义或错用术语导致开发事故，责任是清楚的，问责对象也没有怨言。让有责任的人承担责任，比和稀泥对解决问题更有利。\n再比如，问题在流转过程中很容易出现接口人之间的扯皮甚至冲突，问题的根源并不是别人说你的代码有问题导致你不爽，而是别人做得不够专业让你觉得对方不负责任。在我的团队里，大家约定处理问题的规则是：\n谁接手，谁处理 转交问题时必须提供四项信息：复现问题的环境、完整的接口名、传递的实参和返回结果 首先当一个问题被反馈过来的时候，分配人会有一个初步的判断，指派给谁，谁处理，不能踢皮球。处理人如果界定问题发生在别人的接口里，应该把上述四项信息连同问题移交给相关责任人。这样做的好处是，一来可以避免误判给别人造成不必要的麻烦，二来让下游接口人可以马上复现并解决问题，而无须考虑上游的业务逻辑。这个规则的效果很好，团队里从来没有因为接口问题出现不愉快。\n对于第二点。代码质量是日常开发中最让人头疼的问题之一，出现频率高而且代价昂贵。不管是靠开发人员的经验，还是测试人员的工作，都对人的依赖很大，既不稳定又低效。以下这些方法能很好地解决这样的问题：\n使用Git，先进的生产关系需要更好的生产资料才能带来更高的生产力 提交代码时自动检查语法错误和代码规范 高覆盖率、自动化的单元测试 用模拟工具给单元测试供给测试数据 用脚本测试网页交互 用脚本给网页截图，用图片diff工具比较某次修改给网页带来的变化 ","permalink":"http://0x3f.org/posts/the-best-practices-of-developing/","summary":"\u003cp\u003e在以往的开发和管理中遇到很多问题，以至于我对理想中的技术团队有了一些想法。其中有两点经过实践证明有很强的可操作性，值得拿出来讨论一下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e能用规则解决的问题就不要靠人解决\u003c/li\u003e\n\u003cli\u003e能用机器完成的任务就不要用人处理\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这两点都反映了我的一个妄念，就是相信规则和机器，不相信人。人是最不靠谱的生产者，你永远无法保证团队中的每个人都处于很好的状态、拥有相近的技术水平和情商，这也是为什么我不觉得结对编程有什么可操作性。但如果有简单可行的规则，用来规范开发过程中的行为，那么解决开发过程中的冲突就不需要人为地和稀泥，生产效率也会得到提升。此外，机器最适合用来做重复性的任务，很多花大量的人力、物力、时间都没做得很好的事，交给机器来做恰恰是最好的解决办法。\u003c/p\u003e\n\u003cp\u003e这些以往都只是我自己的想法，虽然在团队里有过很好的实践效果，但是并不指望和别人有所共鸣。国内的技术团队大多靠堆人、堆时间，很少有团队会把健康的世界观和可操作的方法论放在重要的位置，技术和技术从业者都是刍狗。当然这也无可厚非，毕竟先要解决生存问题，在模式创新为主的国内互联网行业，更新换代如此之快，产品早一天上线就多一分生存的可能。但是有没有可能既解决生存问题，又做出一个有荣誉感的团队呢？世间安得双全法，这是个值得持续讨论的问题。\u003c/p\u003e\n\u003cp\u003e最近和别人聊天，竟然听到相同的想法，在具体的方法论上还得到很多补充。\u003c/p\u003e\n\u003cp\u003e对于第一点。一个项目按业务线划分开发组、按功能模块划分开发任务本来是个很好的模式，但是接口的对接往往会有很多问题，例如术语使用的不严谨导致高昂的沟通成本、问题处理方法的不规范导致扯皮、冲突和低效。\u003c/p\u003e\n\u003cp\u003e在我的团队里，用wiki维护著一套术语词典，开发过程中所有的文档、沟通都必须使用既定的用语，例如「退单」包括「退款单」和「退货单」，这三个术语分别表示不同而精确的概念，如果因为自己造词产生歧义或错用术语导致开发事故，责任是清楚的，问责对象也没有怨言。让有责任的人承担责任，比和稀泥对解决问题更有利。\u003c/p\u003e\n\u003cp\u003e再比如，问题在流转过程中很容易出现接口人之间的扯皮甚至冲突，问题的根源并不是别人说你的代码有问题导致你不爽，而是别人做得不够专业让你觉得对方不负责任。在我的团队里，大家约定处理问题的规则是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e谁接手，谁处理\u003c/li\u003e\n\u003cli\u003e转交问题时必须提供四项信息：复现问题的环境、完整的接口名、传递的实参和返回结果\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e首先当一个问题被反馈过来的时候，分配人会有一个初步的判断，指派给谁，谁处理，不能踢皮球。处理人如果界定问题发生在别人的接口里，应该把上述四项信息连同问题移交给相关责任人。这样做的好处是，一来可以避免误判给别人造成不必要的麻烦，二来让下游接口人可以马上复现并解决问题，而无须考虑上游的业务逻辑。这个规则的效果很好，团队里从来没有因为接口问题出现不愉快。\u003c/p\u003e\n\u003cp\u003e对于第二点。代码质量是日常开发中最让人头疼的问题之一，出现频率高而且代价昂贵。不管是靠开发人员的经验，还是测试人员的工作，都对人的依赖很大，既不稳定又低效。以下这些方法能很好地解决这样的问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用Git，先进的生产关系需要更好的生产资料才能带来更高的生产力\u003c/li\u003e\n\u003cli\u003e提交代码时自动检查语法错误和代码规范\u003c/li\u003e\n\u003cli\u003e高覆盖率、自动化的单元测试\u003c/li\u003e\n\u003cli\u003e用模拟工具给单元测试供给测试数据\u003c/li\u003e\n\u003cli\u003e用脚本测试网页交互\u003c/li\u003e\n\u003cli\u003e用脚本给网页截图，用图片diff工具比较某次修改给网页带来的变化\u003c/li\u003e\n\u003c/ul\u003e","title":"技术团队的两个最佳实践"},{"content":"合并分支有两种方式，merge和rebase。merge是根据三方合并的差异，创建一个新的提交。rebase是将上游分支的各个提交在比较差异后在下游分支上重演一遍。\nrebase适合对没有推送到远程的提交对象做合并，这样可以保持一个整洁的提交历史。若对已推送的提交对象使用rebase，可能导致其它已经拉取并创建了新的提交的人不得不重新合并，进而导致提交历史变得很混乱。\n基本的rebase：\n1 2 3 git rebase master unstable git checkout master git merge unstable 复杂的情况：存在三个分支，unstable基于master的某个提交创建，feature基于unstable的某个提交创建，要把feature合并到master而不合并unstable。更多分支时方法也一样。\n1 2 3 git rebase --onto master unstable feature git checkout master git merge feature rebase过程中如果存在冲突，合并后用git add标记已解决，再用git rebase --continue继续。如果解决冲突后仍然不能继续，可能是当前补丁的内容在下游分支已存在，可以用git rebase --skip跳过。\n","permalink":"http://0x3f.org/posts/git-rebase/","summary":"\u003cp\u003e合并分支有两种方式，merge和rebase。merge是根据三方合并的差异，创建一个新的提交。rebase是将上游分支的各个提交在比较差异后在下游分支上重演一遍。\u003c/p\u003e\n\u003cp\u003erebase适合对没有推送到远程的提交对象做合并，这样可以保持一个整洁的提交历史。若对已推送的提交对象使用rebase，可能导致其它已经拉取并创建了新的提交的人不得不重新合并，进而导致提交历史变得很混乱。\u003c/p\u003e\n\u003cp\u003e基本的rebase：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit rebase master unstable\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit checkout master\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit merge unstable\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e复杂的情况：存在三个分支，unstable基于master的某个提交创建，feature基于unstable的某个提交创建，要把feature合并到master而不合并unstable。更多分支时方法也一样。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit rebase --onto master unstable feature\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit checkout master\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit merge feature\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003erebase过程中如果存在冲突，合并后用\u003ccode\u003egit add\u003c/code\u003e标记已解决，再用\u003ccode\u003egit rebase --continue\u003c/code\u003e继续。如果解决冲突后仍然不能继续，可能是当前补丁的内容在下游分支已存在，可以用\u003ccode\u003egit rebase --skip\u003c/code\u003e跳过。\u003c/p\u003e","title":"Git的衍合"},{"content":"依赖 vim-jsbeautify js-beautify js-beautify的安装：\n1 2 3 npm -g install js-beautify # 或 pip install jsbeautifier 配置快捷键 1 2 3 4 vmap \u0026lt;leader\u0026gt;jsb :\u0026#39;\u0026lt;,\u0026#39;\u0026gt;!js-beautify -i\u0026lt;CR\u0026gt; autocmd FileType javascript noremap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;jsb :call JsBeautify()\u0026lt;CR\u0026gt; autocmd FileType html noremap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;htmlb :call HtmlBeautify()\u0026lt;CR\u0026gt; autocmd FileType css noremap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;cssb :call CSSBeautify()\u0026lt;CR\u0026gt; ","permalink":"http://0x3f.org/posts/vim-js-beautify/","summary":"\u003ch2 id=\"依赖\"\u003e依赖\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/maksimr/vim-jsbeautify\"\u003evim-jsbeautify\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/beautify-web/js-beautify\"\u003ejs-beautify\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ejs-beautify的安装：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm -g install js-beautify\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 或\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epip install jsbeautifier\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"配置快捷键\"\u003e配置快捷键\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003evmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ejsb\u003c/span\u003e :\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;,\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;!\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeautify\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ejavascript\u003c/span\u003e \u003cspan class=\"nx\"\u003enoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ejsb\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eJsBeautify\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e \u003cspan class=\"nx\"\u003enoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtmlb\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eHtmlBeautify\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ecss\u003c/span\u003e \u003cspan class=\"nx\"\u003enoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ecssb\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eCSSBeautify\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"在Vim中格式化Javascript、HTML和CSS"},{"content":"更新 日期 更新内容 2022-03-16 更新 80% 的内容。包含这几年所有的配置上的更新，并且把 ag 换成了 rg 。 2017-02-19 第一版。 目标 多文件搜索和替换\n使用 PCRE 正则表达式在工作目录下递归搜索 将选定文本自动转换成正则表达式 有较高的搜索速度 对搜索结果做替换 当前 buffer 内的搜索和替换\n一键将选定文本自动转换成正则表达式并执行搜索或替换 依赖 Ferret：实现对搜索和替换操作的封装。 ripgrep：搜索工具，速度快。 工具和方法 Ferret Ferret 是我用过的 vim 搜索扩展里最接近理想的一个，最大的优点是不用引号包裹搜索内容，且较大程度地支持 PCRE 正则表达式。\nEasyGrep 的缺点是正则表达式必须是 shellescape() 过的，手写不方便，也不直观。Ferret 在底层做了 shellescape() ，所以比 EasyGrep 简单一些。不过 Ferret 对反斜杠的处理仍然不直观，例如搜索App\\Link，正则表达式是App\\\\Link，而Ferret里只能用App\\\\\\\\Link。原因是从输入到执行，存在著三层转义：Vim命令行、Shell、grep/ag。所以对于EasyGrep，要搜索一个\\，必须输入\\\\\\\\\\\\\\\\。对于Ferret，由于底层做了shellescape()，只需要两层转义，即\\\\\\\\。当然这样也不方便，所以我用自定义函数XEscapeRegex()对选择的内容做这个事，不过最完美的方法当然是Ferret自己支持，或者自己再封装一下Ferret的命令，这样输入的正则表达式可读性就正常了。\nFerret 的另一个优点是可以对搜索结果做筛选，删除不需要做替换的行，再对剩下的行执行批量替换。当执行替换命令 :Acks 时，会自动把上一个 :Ack 命令中的正则表达式或关键词补全到命令的参数中。\nFerret 最大的问题在于，搜索使用 rg 、 ag 这样的命令行工具，而替换使用 Vim 内置的 :substitute 命令。前者使用 PCRE 正则表达式，而后者使用 Vim 自己的正则表达式。两者在格式上的不兼容导致对一些复杂的 pattern 做搜索和替换时，往往需要对 pattern 做修改才能正常对之前的搜索结果做替换。关于这个问题，后面细说。\nripgrep rg 是我用过的搜索工具里对速度和功能兼顾得最好的。\n转换选定内容到正则表达式 我使用自定义函数 EscapeRegex() 根据参数转换字符串到不同格式的正则表达式。主要用途为转换成给搜索当前缓冲区的 Vim 正则表达式，或给 Ferret 使用的 PCRE 正则表达式。\n解决 Ferret 搜索和替换命令的正则表达式兼容性问题 需要用到 Vim 的两个特性： magic 选项和 command-line window 。\n使用 magic 选项的控制符，可以使搜索内容中的特殊字符表现出不同的行为。例如，当表达式前附加 \\m 时，表示使用 Vim 内置的正则表达式格式，由于这是默认的行为，所以也可以省略这个控制符。\n以下是 4 种 magic 控制符的总结：\n控制符 含义 说明 \\m magic ^ $ . * ~ []等具有特殊含义。当然，反斜杠和表达模式起止的分隔符也算具有特殊含义。 \\M nomagic 仅 ^ $ 具有特殊含义。当然，反斜杠和表达模式起止的分隔符也算具有特殊含义。 \\v very magic 所有 ASCII 字符中（即键盘上能看到的字符），除了数字 0-9 、大小写字母 A-Za-z 和下划线 _ 外，全都有特殊含义。 \\V very nomagic 大多数字符都表示其本身，除了反斜杠 \\ ，以及用来表示模式起止的分隔符（如 / 或 ? ）。 所以对于当前 buffer 的搜索和替换，我使用 \\m ，即 Vim 内置的正则格式，并通过调用只传递第一个参数的 EscapeRegex() 函数把选中的内容转义成正则表达式。\n对于多文件的搜索，仍然通过 EscapeRegex() 函数转义正则，但此时需传递第二个参数（值为 1 ），从而转换成 PCRE 格式的正则。\n对于多文件的替换，把 \\v 控制符附加在正则表达式前面。在 very magic 格式下，大部分非字母和数字符号都被认为有特殊含义，此时，PCRE 表达式中的特殊字符是它的子集。多数情况下，替换前的搜索中使用的简单的表达式不需要修改就可以直接用于 :Acks 命令，当存在差集中的字符时，修改表达式并对这些字符做转义即可。\n为了简化这个步骤，这里需要用到 command-line window 。通过 cedit 选项配置的快捷键，可以在 Vim 的命令模式下打开包含当前正在编辑以及之前执行过的命令的窗口。如果在普通模式下，可以通过 q: 指令打开。此时，把光标置于要转义的命令所在行，然后执行相应的快捷键即可，我这里定义的是 \u0026lt;leader\u0026gt;ss ，它调用的是自定义函数 EscapeFerretPatternInCurrentLine() ，此函数简单地对当前行中的特定字符做转义。\n配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 set cedit=\\\u0026lt;C-E\u0026gt; \u0026#34; Find and replace nmap \u0026lt;leader\u0026gt;// yiw/\\\u0026lt;\u0026lt;C-R\u0026gt;\u0026#34;\\\u0026gt;\\C vmap \u0026lt;leader\u0026gt;// y/\\m\u0026lt;C-R\u0026gt;=EscapeRegex(@\u0026#34;)\u0026lt;CR\u0026gt;\\C nmap \u0026lt;leader\u0026gt;rr yiw:%s/\\\u0026lt;\u0026lt;C-R\u0026gt;\u0026#34;\\\u0026gt;\\C//g\u0026lt;LEFT\u0026gt;\u0026lt;LEFT\u0026gt; vmap \u0026lt;leader\u0026gt;rr y:%s/\u0026lt;C-R\u0026gt;=EscapeRegex(@\u0026#34;)\u0026lt;CR\u0026gt;\\C//g\u0026lt;LEFT\u0026gt;\u0026lt;LEFT\u0026gt; nmap \u0026lt;leader\u0026gt;rl yiw:s/\\\u0026lt;\u0026lt;C-R\u0026gt;\u0026#34;\\\u0026gt;\\C//g\u0026lt;LEFT\u0026gt;\u0026lt;LEFT\u0026gt; vmap \u0026lt;leader\u0026gt;rl y:s/\u0026lt;C-R\u0026gt;=EscapeRegex(@\u0026#34;)\u0026lt;CR\u0026gt;\\C//g\u0026lt;LEFT\u0026gt;\u0026lt;LEFT\u0026gt; let g:FerretExecutable=\u0026#39;rg\u0026#39; let g:FerretExecutableArguments = { \\ \u0026#39;rg\u0026#39;: \u0026#39;--no-ignore-vcs --vimgrep --no-heading --no-config --max-columns 4096 --follow -g !vendor/composer/ -g !storage/ -g !node_modules/\u0026#39; \\ } let g:FerretQFHandler=\u0026#39;botright copen 20\u0026#39; let g:FerretLLHandler=\u0026#39;botright lopen 20\u0026#39; nmap \u0026lt;leader\u0026gt;ak \u0026lt;Plug\u0026gt;(FerretAck) nmap \u0026lt;leader\u0026gt;lak \u0026lt;Plug\u0026gt;(FerretLack) nmap \u0026lt;leader\u0026gt;aw \u0026lt;Plug\u0026gt;(FerretAckWord) nmap \u0026lt;leader\u0026gt;as \u0026lt;Plug\u0026gt;(FerretAcks) vmap \u0026lt;leader\u0026gt;ak y:Ack \u0026lt;C-R\u0026gt;=EscapeRegex(@\u0026#34;, 1)\u0026lt;CR\u0026gt; vmap \u0026lt;leader\u0026gt;lak y:Lack \u0026lt;C-R\u0026gt;=EscapeRegex(@\u0026#34;, 1)\u0026lt;CR\u0026gt; \u0026#34; The patterns passed to the :Ack command may be not compatible with the \u0026#34; :Acks command, so we need to escape some characters in them additionally \u0026#34; in the command-line window. augroup escape_ferret_pattern_in_the_current_line_in_commandline_window au! au BufEnter * if mode() == \u0026#39;n\u0026#39; \u0026amp;\u0026amp; getcmdwintype() == \u0026#39;\u0026#39; | nnoremap \u0026lt;leader\u0026gt;ss :call EscapeFerretPatternInCurrentLine()\u0026lt;CR\u0026gt; | endif augroup END function! EscapeFerretPatternInCurrentLine() exec \u0026#39;s/\u0026gt;/\\\\\u0026gt;/g\u0026#39; exec \u0026#39;s/\u0026amp;/\\\\\u0026amp;/g\u0026#39; endfunction \u0026#34; 转义正则表达式特殊字符，以便在正则表达式中使用 \u0026#34; a:1 是否转义为vimgrep的pattern格式，1，2 \u0026#34; a:2 是否用shellescape()转义，1是转义，2是转义并去掉两侧单引号 function! EscapeRegex(str, ...)\u0026#34;{{{ let pattern = a:str let pattern = escape(pattern, \u0026#39;^$.*[]~\u0026#34;/\\\u0026#39;) if a:0 \u0026amp;\u0026amp; a:1 let pattern = escape(pattern, \u0026#39;()+?{}|\u0026#39;) let pattern = substitute(pattern, \u0026#39;\\\\/\u0026#39;, \u0026#39;/\u0026#39;, \u0026#39;g\u0026#39;) if a:1 == 2 let pattern = escape(pattern, \u0026#39;\\\u0026#39;) endif endif if a:0 \u0026gt; 1 \u0026amp;\u0026amp; a:2 let pattern = shellescape(pattern) if a:2 == 2 let pattern = pattern[1:-2] endif endif let whitespacePattern = a:0 \u0026amp;\u0026amp; a:1 ? \u0026#39;\\\\s\\+\u0026#39; : \u0026#39;\\\\s\\\\+\u0026#39; let pattern = substitute(pattern, \u0026#39;\\s\\+\u0026#39;, whitespacePattern, \u0026#39;g\u0026#39;) return pattern endfunction\u0026#34;}}} ","permalink":"http://0x3f.org/posts/the-best-practice-of-searching-in-vim/","summary":"\u003ch2 id=\"更新\"\u003e更新\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e日期\u003c/th\u003e\n          \u003cth\u003e更新内容\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e2022-03-16\u003c/td\u003e\n          \u003ctd\u003e更新 80% 的内容。包含这几年所有的配置上的更新，并且把 ag 换成了 rg 。\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e2017-02-19\u003c/td\u003e\n          \u003ctd\u003e第一版。\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"目标\"\u003e目标\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e多文件搜索和替换\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用 PCRE 正则表达式在工作目录下递归搜索\u003c/li\u003e\n\u003cli\u003e将选定文本自动转换成正则表达式\u003c/li\u003e\n\u003cli\u003e有较高的搜索速度\u003c/li\u003e\n\u003cli\u003e对搜索结果做替换\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e当前 buffer 内的搜索和替换\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e一键将选定文本自动转换成正则表达式并执行搜索或替换\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"依赖\"\u003e依赖\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/wincent/ferret\"\u003eFerret\u003c/a\u003e：实现对搜索和替换操作的封装。\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/BurntSushi/ripgrep\"\u003eripgrep\u003c/a\u003e：搜索工具，速度快。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"工具和方法\"\u003e工具和方法\u003c/h2\u003e\n\u003ch3 id=\"ferret\"\u003eFerret\u003c/h3\u003e\n\u003cp\u003eFerret 是我用过的 vim 搜索扩展里最接近理想的一个，最大的优点是不用引号包裹搜索内容，且较大程度地支持 PCRE 正则表达式。\u003c/p\u003e\n\u003cp\u003eEasyGrep 的缺点是正则表达式必须是 shellescape() 过的，手写不方便，也不直观。Ferret 在底层做了 shellescape() ，所以比 EasyGrep 简单一些。\u003cdel\u003e不过 Ferret 对反斜杠的处理仍然不直观，例如搜索\u003ccode\u003eApp\\Link\u003c/code\u003e，正则表达式是\u003ccode\u003eApp\\\\Link\u003c/code\u003e，而Ferret里只能用\u003ccode\u003eApp\\\\\\\\Link\u003c/code\u003e。原因是从输入到执行，存在著三层转义：Vim命令行、Shell、grep/ag。所以对于EasyGrep，要搜索一个\u003ccode\u003e\\\u003c/code\u003e，必须输入\u003ccode\u003e\\\\\\\\\\\\\\\\\u003c/code\u003e。对于Ferret，由于底层做了shellescape()，只需要两层转义，即\u003ccode\u003e\\\\\\\\\u003c/code\u003e。当然这样也不方便，所以我用自定义函数XEscapeRegex()对选择的内容做这个事，不过最完美的方法当然是Ferret自己支持，或者自己再封装一下Ferret的命令，这样输入的正则表达式可读性就正常了。\u003c/del\u003e\u003c/p\u003e\n\u003cp\u003eFerret 的另一个优点是可以对搜索结果做筛选，删除不需要做替换的行，再对剩下的行执行批量替换。当执行替换命令 \u003ccode\u003e:Acks\u003c/code\u003e 时，会自动把上一个 \u003ccode\u003e:Ack\u003c/code\u003e 命令中的正则表达式或关键词补全到命令的参数中。\u003c/p\u003e\n\u003cp\u003eFerret 最大的问题在于，搜索使用 rg 、 ag 这样的命令行工具，而替换使用 Vim 内置的 \u003ccode\u003e:substitute\u003c/code\u003e 命令。前者使用 PCRE 正则表达式，而后者使用 Vim 自己的正则表达式。两者在格式上的不兼容导致对一些复杂的 pattern 做搜索和替换时，往往需要对 pattern 做修改才能正常对之前的搜索结果做替换。关于这个问题，后面细说。\u003c/p\u003e","title":"Vim 查找与替换的最佳实践"},{"content":"\n我很容易受环境影响，即便在家里比较安静的时候，也经常集中不了注意力。小时候总是可以连续几个小时读一本书，现在已经很久没有长时间专心做一件事了。戴了一段时间QC35，又重新找回了这种感觉，干什么事都很专心，感觉很安静，心态平和很多。\n之前先入手了森海大馒头，不过没有降噪的功能，所以必须一直配合白噪声使用，时间长了还是有点累的。另外，有线耳机实在不方便，所有的数码设备都应该无线化，对生活品质的提升会很大。虽然大馒头作为出街向的东西，手机也推得动，但是要发挥音质，还是得上耳放，我不是发烧友，这木耳就算了。\n所以对QC35长草很久了，后来大法又出了MDR 1000X，作为对标QC35的东西，有这些优点：\n独立的降噪开关 手势操作 快速反应模式 音质 QC35的优势：\n穿戴更舒适 同时连接两个设备 关于耳机，我的核心需求是：\n降噪效果好 无线 舒适 在满足核心需求的基础上，选择有价格优势的东西。1000X肯定更方便，不过没有这些功能好像问题也不大。而且有些噱头的实际体验究竟有多好，我是有疑问的，比如手势的误操作问题。在我看来，为这些噱头买单不值，所以最后选了QC35。\n使用一段时间下来体验确实很好，已经对这久违的安静上瘾了，长时间戴也没有不适感，同时连接电脑和手机也很方便。\n","permalink":"http://0x3f.org/posts/the-experience-of-bose-qc35/","summary":"\u003cp\u003e\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvwyum8eyj31kw11y1kx.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e我很容易受环境影响，即便在家里比较安静的时候，也经常集中不了注意力。小时候总是可以连续几个小时读一本书，现在已经很久没有长时间专心做一件事了。戴了一段时间QC35，又重新找回了这种感觉，干什么事都很专心，感觉很安静，心态平和很多。\u003c/p\u003e\n\u003cp\u003e之前先入手了森海大馒头，不过没有降噪的功能，所以必须一直配合白噪声使用，时间长了还是有点累的。另外，有线耳机实在不方便，所有的数码设备都应该无线化，对生活品质的提升会很大。虽然大馒头作为出街向的东西，手机也推得动，但是要发挥音质，还是得上耳放，我不是发烧友，这木耳就算了。\u003c/p\u003e\n\u003cp\u003e所以对QC35长草很久了，后来大法又出了MDR 1000X，作为对标QC35的东西，有这些优点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e独立的降噪开关\u003c/li\u003e\n\u003cli\u003e手势操作\u003c/li\u003e\n\u003cli\u003e快速反应模式\u003c/li\u003e\n\u003cli\u003e音质\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eQC35的优势：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e穿戴更舒适\u003c/li\u003e\n\u003cli\u003e同时连接两个设备\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e关于耳机，我的核心需求是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e降噪效果好\u003c/li\u003e\n\u003cli\u003e无线\u003c/li\u003e\n\u003cli\u003e舒适\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在满足核心需求的基础上，选择有价格优势的东西。1000X肯定更方便，不过没有这些功能好像问题也不大。而且有些噱头的实际体验究竟有多好，我是有疑问的，比如手势的误操作问题。在我看来，为这些噱头买单不值，所以最后选了QC35。\u003c/p\u003e\n\u003cp\u003e使用一段时间下来体验确实很好，已经对这久违的安静上瘾了，长时间戴也没有不适感，同时连接电脑和手机也很方便。\u003c/p\u003e","title":"Bose QC35，这安静有毒"},{"content":"Postman如果不显示API返回结果，而是报错：\nCould not get any response\n有一种原因是响应的header存在错误：\n图中以双引号开头的第一行是有问题的。\nPS：httpie是个好东西。\n","permalink":"http://0x3f.org/posts/postman-could-not-get-any-response/","summary":"\u003cp\u003ePostman如果不显示API返回结果，而是报错：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCould not get any response\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e有一种原因是响应的header存在错误：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx7lf9t7j30jd04fq3q.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e图中以双引号开头的第一行是有问题的。\u003c/p\u003e\n\u003cp\u003ePS：\u003ca href=\"https://httpie.org\"\u003ehttpie\u003c/a\u003e是个好东西。\u003c/p\u003e","title":"Postman: Could Not Get Any Response"},{"content":"实现基于SSL的安全的WebSocket。\nNGINX配置 server { listen 4431; server_name ws.sample.com; ssl on; ssl_certificate ssl/server.crt; ssl_certificate_key ssl/server.key; ssl_session_timeout 5m; ssl_session_cache shared:SSL:50m; ssl_protocols SSLv3 SSLv2 TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP; location / { proxy_pass http://127.0.0.1:4759; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;Upgrade\u0026#34;; proxy_set_header X-Real-IP $remote_addr; proxy_read_timeout 60s; } } 常见问题 连不上或连接时报错 WebSocket network error: OSStatus Error -9807: Invalid certificate chain\n如果使用的是自签证书或者证书针对的域名和连接所指定的不符，会出这种问题。\nwss一分钟自动断开 NGINX里设置proxy_read_timeout或者程序实现心跳。\n","permalink":"http://0x3f.org/posts/implement-wss-with-nginx/","summary":"\u003cp\u003e实现基于SSL的安全的WebSocket。\u003c/p\u003e\n\u003ch2 id=\"nginx配置\"\u003eNGINX配置\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eserver {\n    listen 4431;\n    server_name ws.sample.com;\n\n    ssl on;\n    ssl_certificate ssl/server.crt;\n    ssl_certificate_key ssl/server.key;\n    ssl_session_timeout 5m;\n    ssl_session_cache shared:SSL:50m;\n    ssl_protocols SSLv3 SSLv2 TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;\n\n    location /\n    {\n        proxy_pass http://127.0.0.1:4759;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \u0026#34;Upgrade\u0026#34;;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_read_timeout 60s;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"常见问题\"\u003e常见问题\u003c/h2\u003e\n\u003ch3 id=\"连不上或连接时报错\"\u003e连不上或连接时报错\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWebSocket network error: OSStatus Error -9807: Invalid certificate chain\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e如果使用的是自签证书或者证书针对的域名和连接所指定的不符，会出这种问题。\u003c/p\u003e\n\u003ch3 id=\"wss一分钟自动断开\"\u003ewss一分钟自动断开\u003c/h3\u003e\n\u003cp\u003eNGINX里设置proxy_read_timeout或者程序实现心跳。\u003c/p\u003e","title":"用NGINX实现WSS"},{"content":"用NGINX反向代理实现WSS后，创建连接时报错：\nError during WebSocket handshake: \u0026lsquo;Connection\u0026rsquo; header value must contain \u0026lsquo;Upgrade\u0026rsquo;\n根据官方文档，NGINX从1.3.13开始才支持这个特性，所以解决方法是升级到最新版。\n","permalink":"http://0x3f.org/posts/websocket-connection-header-value-must-contain-upgrade/","summary":"\u003cp\u003e用NGINX反向代理实现WSS后，创建连接时报错：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eError during WebSocket handshake: \u0026lsquo;Connection\u0026rsquo; header value must contain \u0026lsquo;Upgrade\u0026rsquo;\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e根据\u003ca href=\"http://nginx.org/en/docs/http/websocket.html\"\u003e官方文档\u003c/a\u003e，NGINX从1.3.13开始才支持这个特性，所以解决方法是升级到最新版。\u003c/p\u003e","title":"WebSocket: Connection Header Value Must Contain Upgrade"},{"content":"reset在提交层面，是将HEAD设定到指定的提交，通常用来舍弃最新的几个提交。在文件层面，是将指定的提交中的该文件保存到暂存区，工作区中的文件不变。\nreset有三个常用的参数：--mixed、--soft和--hard。\n在提交层面，--mixed是默认值，影响暂存区，不影响工作区；--soft将HEAD版本保存到暂存区，并将HEAD设定到指定的提交，用来合并提交历史；--hard既影响暂存区，也影响工作区。\n在文件层面，--soft和--hard均会报错，不支持这两个选项。\n在提交层面，执行过reset后如果需要撤销，使用reflog命令查看之前HEAD的hash，通过reset --hard恢复到该版本。\ncheckout在提交层面，用来切换分支或检出到指定的提交。对于后者，如果增加了新的提交，在切换到其它分支后，再切换回来时，这些提交将会丢失，如果希望保存这些提交，在切换到其它分支前，创建一个新的分支。\nrevert用来通过创建一个新的提交来回滚一个提交，因此，和reset不同，并不会改变提交的历史。\n对于回滚一次提交的场景，revert比reset安全，所以revert适用于公共分支，reset适用于私有分支。\n","permalink":"http://0x3f.org/posts/differences-among-reset-checkout-revert-of-git/","summary":"\u003cp\u003ereset在提交层面，是将HEAD设定到指定的提交，通常用来舍弃最新的几个提交。在文件层面，是将指定的提交中的该文件保存到暂存区，工作区中的文件不变。\u003c/p\u003e\n\u003cp\u003ereset有三个常用的参数：--mixed、--soft和--hard。\u003c/p\u003e\n\u003cp\u003e在提交层面，--mixed是默认值，影响暂存区，不影响工作区；--soft将HEAD版本保存到暂存区，并将HEAD设定到指定的提交，用来合并提交历史；--hard既影响暂存区，也影响工作区。\u003c/p\u003e\n\u003cp\u003e在文件层面，--soft和--hard均会报错，不支持这两个选项。\u003c/p\u003e\n\u003cp\u003e在提交层面，执行过reset后如果需要撤销，使用reflog命令查看之前HEAD的hash，通过reset --hard恢复到该版本。\u003c/p\u003e\n\u003cp\u003echeckout在提交层面，用来切换分支或检出到指定的提交。对于后者，如果增加了新的提交，在切换到其它分支后，再切换回来时，这些提交将会丢失，如果希望保存这些提交，在切换到其它分支前，创建一个新的分支。\u003c/p\u003e\n\u003cp\u003erevert用来通过创建一个新的提交来回滚一个提交，因此，和reset不同，并不会改变提交的历史。\u003c/p\u003e\n\u003cp\u003e对于回滚一次提交的场景，revert比reset安全，所以revert适用于公共分支，reset适用于私有分支。\u003c/p\u003e","title":"Git Reset、Revert和Checkout的区别"},{"content":"因为原来的主题没有针对中文优化，显示效果不太好，在搜索新主题的时候顺便了解了一下其它几个静态博客生成工具，发现Hexo比Octopress有很大的优势，就迁移了过来。\nHexo的优势：\n速度快：几百篇文章只需要几秒，而Octopress需要几十秒 易用：配置、部署简单，文章被修改后会立即更新浏览器中的预览页面 轻量：基于node.js，目录结构简明 迁移的过程不算顺利，先是遇到「MODULE_NOT_FOUND」的问题，搜到的方法都不起作用，原因大概是因为墙的问题导致dtrace模块安装出错，理论上用代理安装是可以解决的，结果在反复安装的过程中莫名其妙地就好了。\n再一个问题是选主题，喜欢极简的风格，但是极简又大气的主题很少，相对最喜欢的是kael，不过生成速度非常慢，而且生成的页面有大量乱码。于是退而求其次，选择了crisp。然而还是有不满意的地方，比如过于简单、没有搜索、不区分首页和归档等，还有待自己修改。\n","permalink":"http://0x3f.org/posts/migrate-octopress-to-hexo/","summary":"\u003cp\u003e因为原来的主题没有针对中文优化，显示效果不太好，在搜索新主题的时候顺便了解了一下其它几个静态博客生成工具，发现Hexo比Octopress有很大的优势，就迁移了过来。\u003c/p\u003e\n\u003cp\u003eHexo的优势：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e速度快：几百篇文章只需要几秒，而Octopress需要几十秒\u003c/li\u003e\n\u003cli\u003e易用：配置、部署简单，文章被修改后会立即更新浏览器中的预览页面\u003c/li\u003e\n\u003cli\u003e轻量：基于node.js，目录结构简明\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e迁移的过程不算顺利，先是遇到「MODULE_NOT_FOUND」的问题，搜到的方法都不起作用，原因大概是因为墙的问题导致dtrace模块安装出错，理论上用代理安装是可以解决的，结果在反复安装的过程中莫名其妙地就好了。\u003c/p\u003e\n\u003cp\u003e再一个问题是选主题，喜欢极简的风格，但是极简又大气的主题很少，相对最喜欢的是\u003ca href=\"https://github.com/yuche/hexo-theme-kael\"\u003ekael\u003c/a\u003e，不过生成速度非常慢，而且生成的页面有大量乱码。于是退而求其次，选择了\u003ca href=\"https://github.com/guolin/crisp-hexo-theme\"\u003ecrisp\u003c/a\u003e。然而还是有不满意的地方，比如过于简单、没有搜索、不区分首页和归档等，还有待自己修改。\u003c/p\u003e","title":"从 Octopress 迁移到 Hexo"},{"content":"虽然如今左Kindle、右iPad，但是再也没有在课堂上用文曲星看《此间的少年》的感觉。\n忘了前段时间看池建强还是和菜头的文章，说很讨厌中文排版中段落首行缩进的风格，深有同感。我一般在读前会先用Calibre修改一下书的格式，段落首行不缩进、用空白行分割段落、嵌入好看的字体，否则强迫症表示根本看不下去。\n本文分享几则平时积累的Calibre排版的最佳实践，顺带吐槽一下亚马逊电子书的排版质量，早已经被微信读书、多看这些APP吊打了。\n一、最佳排版 最小行高：140%。\n使用空白行分段，段落首行不缩进。\n要嵌入字体，必须转换成KF8格式的类型，例如azw3或者both类型的mobi：\n注意：KF8格式在点选文字时，默认选中一句，而不是单字，不方便查字典。要默认选中单字，须转换成old类型的mobi。\n二、最佳字体 索尼楷书\n方正北魏楷书\n方正宋三\n在微信读书iOS上显示效果很好，但是在Kindle里比较一般。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/best-practices-of-calibre-on-formatting/","summary":"\u003cp\u003e\u003cstrong\u003e虽然如今左Kindle、右iPad，但是再也没有在课堂上用文曲星看《此间的少年》的感觉。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e忘了前段时间看池建强还是和菜头的文章，说很讨厌中文排版中段落首行缩进的风格，深有同感。我一般在读前会先用Calibre修改一下书的格式，段落首行不缩进、用空白行分割段落、嵌入好看的字体，否则强迫症表示根本看不下去。\u003c/p\u003e\n\u003cp\u003e本文分享几则平时积累的Calibre排版的最佳实践，顺带吐槽一下亚马逊电子书的排版质量，早已经被微信读书、多看这些APP吊打了。\u003c/p\u003e\n\u003ch2 id=\"一最佳排版\"\u003e一、最佳排版\u003c/h2\u003e\n\u003cp\u003e最小行高：140%。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvx83ybpbj30az0a5t9f.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e使用空白行分段，段落首行不缩进。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx2.sinaimg.cn/large/006tNbRwly1fwvx8hwq08j30gc03lmxh.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e要嵌入字体，必须转换成KF8格式的类型，例如azw3或者both类型的mobi：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvx8znehdj30av06dmxo.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e注意：KF8格式在点选文字时，默认选中一句，而不是单字，不方便查字典。要默认选中单字，须转换成old类型的mobi。\u003c/p\u003e\n\u003ch2 id=\"二最佳字体\"\u003e二、最佳字体\u003c/h2\u003e\n\u003cp\u003e索尼楷书\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx4.sinaimg.cn/large/006tNbRwly1fwvx92ktu8j30ts148jys.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e方正北魏楷书\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvx9fm9nlj30ts148dn4.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e方正宋三\u003c/p\u003e\n\u003cp\u003e在微信读书iOS上显示效果很好，但是在Kindle里比较一般。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"Calibre排版的最佳实践"},{"content":"最近做访问统计解决的两个问题：\n根据日期分组 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 select ( case when visit_at \u0026gt;= 1485014400 then from_unixtime(visit_at, \u0026#39;%Y-%m-%d\u0026#39;) when visit_at \u0026gt;= 1484928000 and visit_at \u0026lt; 1485014400 then from_unixtime(visit_at, \u0026#39;%Y-%m-%d\u0026#39;) else 0 end ) col, count(*) as pv, count(distinct session_id) as uv from `statistics` where `visit_at` \u0026gt;= 1484496000 group by ( case when visit_at \u0026gt;= 1485014400 then from_unixtime(visit_at, \u0026#39;%Y-%m-%d\u0026#39;) when visit_at \u0026gt;= 1484928000 and visit_at \u0026lt; 1485014400 then from_unixtime(visit_at, \u0026#39;%Y-%m-%d\u0026#39;) else 0 end ) 选择每组数据的第一条 1 2 3 4 5 6 7 8 9 10 11 12 13 select a.session_id,a.created_at,a.province,a.referer,a.uri,a.ipv4, a.user_id,b.duration,b.num from statistics as a inner join ( select session_id, max(created_at) as latest_time, count(*) as num,sum(duration) as duration from statistics group by session_id ) as b on a.session_id=b.session_id and a.created_at=b.latest_time ORDER BY a.created_at desc ","permalink":"http://0x3f.org/posts/two-grouping-sql-statements/","summary":"\u003cp\u003e最近做访问统计解决的两个问题：\u003c/p\u003e\n\u003ch2 id=\"根据日期分组\"\u003e根据日期分组\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003ewhen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1485014400\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efrom_unixtime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%Y-%m-%d\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003ewhen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1484928000\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"k\"\u003eand\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1485014400\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efrom_unixtime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%Y-%m-%d\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"k\"\u003eend\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ecol\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003epv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003edistinct\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003esession_id\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003euv\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"k\"\u003estatistics\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ewhere\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1484496000\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003egroup\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eby\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003ewhen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1485014400\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efrom_unixtime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%Y-%m-%d\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003ewhen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1484928000\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"k\"\u003eand\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"mi\"\u003e1485014400\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003efrom_unixtime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evisit_at\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%Y-%m-%d\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"k\"\u003eend\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"选择每组数据的第一条\"\u003e选择每组数据的第一条\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esession_id\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreated_at\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprovince\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereferer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipv4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser_id\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eduration\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003estatistics\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003einner\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ejoin\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003esession_id\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e               \u003c/span\u003e\u003cspan class=\"k\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecreated_at\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003elatest_time\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e               \u003c/span\u003e\u003cspan class=\"k\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003esum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eduration\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eduration\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003estatistics\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003egroup\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eby\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003esession_id\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eon\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esession_id\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esession_id\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"k\"\u003eand\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreated_at\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elatest_time\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eORDER\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eBY\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreated_at\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003edesc\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"两条分组的SQL语句"},{"content":"PHP没有原生的转换silk格式音频到mp3的方案，所以考虑用NGINX+Lua调用命令行工具实现。\n思路 当访问以「.silk.mp3」为后缀的文件时，查找对应的mp3文件，存在则返回，否则，如果对应的silk文件存在，调用命令行工具转换文件格式，然后内部重定向到新生成的mp3。\n安装 OpenResty silk-v3-decoder ffmpeg NGINX配置 1 2 3 location ~* /.*\\.silk\\.mp3$ { content_by_lua_file \u0026#34;/opt/script/silk2mp3.lua\u0026#34;; } Lua脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 function file_exists(name) local f=io.open(name,\u0026#34;r\u0026#34;) if f~=nil then io.close(f) return true else return false end end local resource = ngx.var.request_filename; local realResource = resource:sub(1, #resource - 9)..\u0026#34;.mp3\u0026#34;; local realURI = ngx.var.uri:sub(1, #ngx.var.uri - 9)..\u0026#34;.mp3\u0026#34;; if file_exists(realResource) then return ngx.exec(realURI); end local silk = resource:sub(1, #resource - 4); if not file_exists(silk) then return ngx.exit(404); end os.execute(\u0026#34;/bin/sh /opt/silk-v3-decoder/converter.sh \\\u0026#34;\u0026#34;..silk..\u0026#34;\\\u0026#34; mp3 \u0026gt; /dev/null 2\u0026gt;\u0026amp;1\u0026#34;); if file_exists(realResource) then return ngx.exec(realURI); else return ngx.exit(404) end 遇到的问题 OpenResty调用命令转换失败，而手工可以 silk-v3-decoder的converter.sh把所有错误信息都屏蔽了，需要修改脚本查看。\n实际情况是OpenResty的运行用户没有音频文件所在目录的权限。\n编译的ffmpeg转换PCM到MP3时报错 silk-v3-decoder自己的decoder只是把silk转换成PCM，然后调用ffmpeg转换成mp3。系统中的ffmpeg是自己编译的，在这一步报错，大意是mp3的encoder不存在。\n原因是ffmpeg编译时默认不激活mp3编码器（猜测）或者没安装libmp3lame-dev，需要安装这个开发库并给configure指定参数「\u0026ndash;enable-libmp3lame」。\n","permalink":"http://0x3f.org/posts/convert-silk-to-mp3-with-openresty/","summary":"\u003cp\u003ePHP没有原生的转换silk格式音频到mp3的方案，所以考虑用NGINX+Lua调用命令行工具实现。\u003c/p\u003e\n\u003ch2 id=\"思路\"\u003e思路\u003c/h2\u003e\n\u003cp\u003e当访问以「.silk.mp3」为后缀的文件时，查找对应的mp3文件，存在则返回，否则，如果对应的silk文件存在，调用命令行工具转换文件格式，然后内部重定向到新生成的mp3。\u003c/p\u003e\n\u003ch2 id=\"安装\"\u003e安装\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://openresty.org/cn/download.html\"\u003eOpenResty\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/kn007/silk-v3-decoder\"\u003esilk-v3-decoder\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ffmpeg.org\"\u003effmpeg\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"nginx配置\"\u003eNGINX配置\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-nginx\" data-lang=\"nginx\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elocation\u003c/span\u003e \u003cspan class=\"p\"\u003e~\u003c/span\u003e\u003cspan class=\"sr\"\u003e*\u003c/span\u003e \u003cspan class=\"s\"\u003e/.*\\.silk\\.mp3\u003c/span\u003e$ \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kn\"\u003econtent_by_lua_file\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;/opt/script/silk2mp3.lua\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"lua脚本\"\u003eLua脚本\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-lua\" data-lang=\"lua\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003efile_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eio.open\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;r\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e~=\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e \u003cspan class=\"n\"\u003eio.close\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"kr\"\u003eelse\u003c/span\u003e \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e \u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003eresource\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003engx.var\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erequest_filename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003erealResource\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eresource\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003eresource\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;.mp3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003erealURI\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003engx.var\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003engx.var\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;.mp3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003efile_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erealResource\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003engx.exec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erealURI\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elocal\u003c/span\u003e \u003cspan class=\"n\"\u003esilk\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eresource\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003eresource\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003efile_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esilk\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003engx.exit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e404\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eos.execute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/bin/sh /opt/silk-v3-decoder/converter.sh \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"n\"\u003esilk\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e mp3 \u0026gt; /dev/null 2\u0026gt;\u0026amp;1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003efile_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erealResource\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003engx.exec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erealURI\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003engx.exit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e404\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"遇到的问题\"\u003e遇到的问题\u003c/h2\u003e\n\u003ch3 id=\"openresty调用命令转换失败而手工可以\"\u003eOpenResty调用命令转换失败，而手工可以\u003c/h3\u003e\n\u003cp\u003esilk-v3-decoder的converter.sh把所有错误信息都屏蔽了，需要修改脚本查看。\u003c/p\u003e","title":"用OpenResty自动转换silk到MP3"},{"content":"由于微软的名气，「微软识花」刚推出的时候就众所周知。很好用的App，我成功地用它识别出了母上的长春花：\n不过我养的主要是观叶植物，只能识别花对我来说意义不大。直到最近发现了「形色」。识别率还不错，对特征不明显的植物容易误报，比如我的空凤就被识别成了吊兰……\n这就是「微软识花」狡猾的地方。\n","permalink":"http://0x3f.org/posts/two-plant-identification-apps/","summary":"\u003cp\u003e由于微软的名气，「微软识花」刚推出的时候就众所周知。很好用的App，我成功地用它识别出了母上的长春花：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx3.sinaimg.cn/large/006tNbRwly1fwvwwr9lsgj30zk0qodhw.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e不过我养的主要是观叶植物，只能识别花对我来说意义不大。直到最近发现了「形色」。识别率还不错，对特征不明显的植物容易误报，比如我的空凤就被识别成了吊兰……\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://wx1.sinaimg.cn/large/006tNbRwly1fwvwwu1rsdj31kw1kw1kx.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这就是「微软识花」狡猾的地方。\u003c/p\u003e","title":"微软识花和形色"},{"content":"修改很长的命令是件痛苦的事，在Linux下，可以通过快捷键Ctrl+X Ctrl+E调用$EDITOR快速编辑当前命令行的内容，保存退出后，结果会呈现在光标下。\n不过在Mac OS的iTerm2下，似乎是因为Ctrl+X被占用而不能生效。误打误撞地发现了另外一个方法，使用oh-my-zsh并且开启了vi mode的话，先进入vi mode，然后输入v，同样可以实现这样的功能。\n","permalink":"http://0x3f.org/posts/edit-command-with-vim/","summary":"\u003cp\u003e修改很长的命令是件痛苦的事，在Linux下，可以通过快捷键\u003ccode\u003eCtrl+X Ctrl+E\u003c/code\u003e调用\u003ccode\u003e$EDITOR\u003c/code\u003e快速编辑当前命令行的内容，保存退出后，结果会呈现在光标下。\u003c/p\u003e\n\u003cp\u003e不过在Mac OS的iTerm2下，似乎是因为\u003ccode\u003eCtrl+X\u003c/code\u003e被占用而不能生效。误打误撞地发现了另外一个方法，使用oh-my-zsh并且开启了vi mode的话，先进入vi mode，然后输入\u003ccode\u003ev\u003c/code\u003e，同样可以实现这样的功能。\u003c/p\u003e","title":"小确幸，用Vim编辑当前命令行"},{"content":"各种VPS加速方案一般都是重复发包的原理，也就是用流量换速度。\n先尝试了kcptun，因为据说资源占用很低，不过部署后打不开网页。然后试了一下锐速，用一键脚本安装，很方便，而且不像kcptun，不需要客户端。部署前在Youtube只能看最低清晰度，现在在网络条件好的情况下，720p也不卡，效果很明显。\n不过锐速不支持OpenVZ，所以搬瓦工用不了，我用的 Vultr 东京机房的基础配置。\n参考 锐速破解版linux一键自动安装包 ","permalink":"http://0x3f.org/posts/accelerate-shadowsocks-with-serverspeeder/","summary":"\u003cp\u003e各种VPS加速方案一般都是重复发包的原理，也就是用流量换速度。\u003c/p\u003e\n\u003cp\u003e先尝试了kcptun，因为据说资源占用很低，不过部署后打不开网页。然后试了一下锐速，用一键脚本安装，很方便，而且不像kcptun，不需要客户端。部署前在Youtube只能看最低清晰度，现在在网络条件好的情况下，720p也不卡，效果很明显。\u003c/p\u003e\n\u003cp\u003e不过锐速不支持OpenVZ，所以搬瓦工用不了，我用的 \u003ca href=\"\"\u003eVultr\u003c/a\u003e 东京机房的基础配置。\u003c/p\u003e\n\u003ch2 id=\"参考\"\u003e参考\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.91yun.org/archives/683\"\u003e锐速破解版linux一键自动安装包\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"用锐速加速Shadowsocks"},{"content":"想在Vultr上部署Gitlab，但是官方文档上说最低要求1GB RAM + 3GB swap，而我的VPS是基础配置：768MB RAM。\n忐忑地试了一下，居然可以用，只是重启防火墙的时候CPU一直100%，最后reboot了事。\n环境 CentOS 7 x64 Gitlab CE 8.15 参考 Setup Swap File on Linux - Vultr.com Installation Guide of GitLab Community Edition | GitLab ","permalink":"http://0x3f.org/posts/setup-gitlab-on-vultr-basic-vps/","summary":"\u003cp\u003e想在Vultr上部署Gitlab，但是官方文档上说最低要求1GB RAM + 3GB swap，而我的VPS是基础配置：768MB RAM。\u003c/p\u003e\n\u003cp\u003e忐忑地试了一下，居然可以用，只是重启防火墙的时候CPU一直100%，最后reboot了事。\u003c/p\u003e\n\u003ch2 id=\"环境\"\u003e环境\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCentOS 7 x64\u003c/li\u003e\n\u003cli\u003eGitlab CE 8.15\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"参考\"\u003e参考\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.vultr.com/docs/setup-swap-file-on-linux\"\u003eSetup Swap File on Linux - Vultr.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://about.gitlab.com/downloads/#centos7\"\u003eInstallation Guide of GitLab Community Edition  | GitLab\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Vultr基配可以部署Gitlab"},{"content":"\n上次聊了李陵败降的细节。在此之后，还发生了几件有意思的事。\n第一个细节，是武帝并没有马上杀掉李陵全家，甚至在第二年，还派一支军队营救他。\n毕竟累世将门，李陵的军事才能武帝是很欣赏的，况且对于李广的死，武帝不能没有一点愧疚。五千步兵深入匈奴，仗打成这个样子已经是虽败尤胜了，这一点，武帝自己是知道的，之所以迁怒司马迁，主要是因为李陵没有死，而是降了。\n在这次战役中，武帝本来给李陵安排的任务是给李广利作后勤保障，是李陵自己不干，非要率五千步兵涉单于庭。按武帝的想法，李陵真要打赢也行，毕竟事关生死存亡，再不济也得战死沙场。领导给安排的活你不干，你自己吹那么大的牛又没做到，最后还投降了，这是武帝生气的主要原因。\n不过武帝还是惜才的，所以第二年就派了一支军队去救李陵。不过这支军队转了一圈没捞著匈奴人的影子，只带回来一个传闻——李陵在教匈奴人对付汉军的方法。武帝随即大怒，并处决了李陵一家。\n后来，汉朝有人出使匈奴，李陵趁机问汉使：「我自问战功不负朝廷，为什么杀我全家？」汉使就说出了这个传闻。李陵大恨，说这事是一个叫李绪的干的。李绪也是一个汉朝的降将，因为这件事，李陵痛恨李绪，就派人把他刺杀了。可能李绪是大阏氏的人，所以大阏氏就要杀李陵。因为匈奴有浓重的母系氏族的风俗残留，所以大阏氏的势力很大，连单于也要让三分。于是单于只能把李陵藏到很远的地方，直到后来大阏氏死了，才敢接回来。\n第二个细节，是霍光曾经试图策反李陵。\n李陵在汉朝的时候跟霍光私交不错，所以武帝死后，霍光辅政，就想著把李陵接回来，于是以出使的名义派人到匈奴和李陵接头。李陵沈吟良久，说了一句话：「大丈夫不能再次受辱。」最终拒绝了。\n李陵的决定是正确的，作为一个有污点的人，回到汉朝纵然有权臣罩著，一旦靠山倒了，覆巢之下也无完卵。何况至亲已死，在汉朝已无牵挂，哪比得上在那天高原阔的地方做一个部落王。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/more-about-li-ling/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-16-10-20161021001.png\" alt=\"2020-06-19-16-16-10-20161021001\"\u003e\u003c/p\u003e\n\u003cp\u003e上次聊了李陵败降的细节。在此之后，还发生了几件有意思的事。\u003c/p\u003e\n\u003cp\u003e第一个细节，是武帝并没有马上杀掉李陵全家，甚至在第二年，还派一支军队营救他。\u003c/p\u003e\n\u003cp\u003e毕竟累世将门，李陵的军事才能武帝是很欣赏的，况且对于李广的死，武帝不能没有一点愧疚。五千步兵深入匈奴，仗打成这个样子已经是虽败尤胜了，这一点，武帝自己是知道的，之所以迁怒司马迁，主要是因为李陵没有死，而是降了。\u003c/p\u003e\n\u003cp\u003e在这次战役中，武帝本来给李陵安排的任务是给李广利作后勤保障，是李陵自己不干，非要率五千步兵涉单于庭。按武帝的想法，李陵真要打赢也行，毕竟事关生死存亡，再不济也得战死沙场。领导给安排的活你不干，你自己吹那么大的牛又没做到，最后还投降了，这是武帝生气的主要原因。\u003c/p\u003e\n\u003cp\u003e不过武帝还是惜才的，所以第二年就派了一支军队去救李陵。不过这支军队转了一圈没捞著匈奴人的影子，只带回来一个传闻——李陵在教匈奴人对付汉军的方法。武帝随即大怒，并处决了李陵一家。\u003c/p\u003e\n\u003cp\u003e后来，汉朝有人出使匈奴，李陵趁机问汉使：「我自问战功不负朝廷，为什么杀我全家？」汉使就说出了这个传闻。李陵大恨，说这事是一个叫李绪的干的。李绪也是一个汉朝的降将，因为这件事，李陵痛恨李绪，就派人把他刺杀了。可能李绪是大阏氏的人，所以大阏氏就要杀李陵。因为匈奴有浓重的母系氏族的风俗残留，所以大阏氏的势力很大，连单于也要让三分。于是单于只能把李陵藏到很远的地方，直到后来大阏氏死了，才敢接回来。\u003c/p\u003e\n\u003cp\u003e第二个细节，是霍光曾经试图策反李陵。\u003c/p\u003e\n\u003cp\u003e李陵在汉朝的时候跟霍光私交不错，所以武帝死后，霍光辅政，就想著把李陵接回来，于是以出使的名义派人到匈奴和李陵接头。李陵沈吟良久，说了一句话：「大丈夫不能再次受辱。」最终拒绝了。\u003c/p\u003e\n\u003cp\u003e李陵的决定是正确的，作为一个有污点的人，回到汉朝纵然有权臣罩著，一旦靠山倒了，覆巢之下也无完卵。何况至亲已死，在汉朝已无牵挂，哪比得上在那天高原阔的地方做一个部落王。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"关于李陵的更多细节"},{"content":"\n汉书卷四十二：\n苍当斩，解衣伏质，身长大，肥白如瓠，时王陵见而怪其美士，乃言沛公，赦勿斩。\n高晓松特喜欢说一句话——这是个看脸的时代。其实哪个时代都看脸，所以张苍因为高胖白，捡了一条命。\n昨天读汉书司马相如传，讲到撩妹那段（以琴心挑之），后面紧接著就是：\n相如时从车骑，雍容闲雅，甚都。\n翻译成人话就是：相如经常开著跑车，逼格满满，很帅。所以你以为光琴弹得好就行了么，想想贝多芬的《献给爱丽丝》。\n看脸本无可厚非，有意思的是看脸的规律：因时而异，因境而异。\n先说后者。家世好的喜瘦，苦出身的喜肥。所以楚王好细腰，宫人多饿死。所以赵飞燕能作掌中舞，于是汉成帝死在赵合德的床上。所以屌丝出身的刘邦和王陵饶了张胖子一命。\n因时而异。乱世尚刚，治世尚柔。季世丧乱，生存是第一命题，社会的整体审美一定是趋于阳刚的，最好脸上再有道疤，活活美死。而由乱入治，公共审美一定趋于女性化。最典型的就是魏晋南北朝，这时期的男人，要剃须、薰香、涂胭脂，甚至头上还插花。\n有个南北互飚花美男的故事。大致的情节是这样的：南方派了一个花美男出使北方，结果都城万人空巷，北方朝廷一看，心说不能让人给比下去啊，就也挑了一个小鲜肉出使南方，于是南方都城里也万头攒动。\n这个故事我不记得出处了，不过《世说新语》的《容止》篇里随便挑一条，都不忍直视：\n王丞相见卫洗马曰：「居然有羸形，虽复终日调畅，若不堪罗绮。」\n不堪罗绮，羡杀韩国欧巴和国产小鲜肉们。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/judge-by-face/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-16-10-20161021001.png\" alt=\"2020-06-19-16-16-10-20161021001\"\u003e\u003c/p\u003e\n\u003cp\u003e汉书卷四十二：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e苍当斩，解衣伏质，身长大，肥白如瓠，时王陵见而怪其美士，乃言沛公，赦勿斩。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e高晓松特喜欢说一句话——这是个看脸的时代。其实哪个时代都看脸，所以张苍因为高胖白，捡了一条命。\u003c/p\u003e\n\u003cp\u003e昨天读汉书司马相如传，讲到撩妹那段（\u003cem\u003e以琴心挑之\u003c/em\u003e），后面紧接著就是：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e相如时从车骑，雍容闲雅，甚都。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e翻译成人话就是：相如经常开著跑车，逼格满满，很帅。所以你以为光琴弹得好就行了么，想想贝多芬的《献给爱丽丝》。\u003c/p\u003e\n\u003cp\u003e看脸本无可厚非，有意思的是看脸的规律：因时而异，因境而异。\u003c/p\u003e\n\u003cp\u003e先说后者。家世好的喜瘦，苦出身的喜肥。所以楚王好细腰，宫人多饿死。所以赵飞燕能作掌中舞，于是汉成帝死在赵合德的床上。所以屌丝出身的刘邦和王陵饶了张胖子一命。\u003c/p\u003e\n\u003cp\u003e因时而异。乱世尚刚，治世尚柔。季世丧乱，生存是第一命题，社会的整体审美一定是趋于阳刚的，最好脸上再有道疤，活活美死。而由乱入治，公共审美一定趋于女性化。最典型的就是魏晋南北朝，这时期的男人，要剃须、薰香、涂胭脂，甚至头上还插花。\u003c/p\u003e\n\u003cp\u003e有个南北互飚花美男的故事。大致的情节是这样的：南方派了一个花美男出使北方，结果都城万人空巷，北方朝廷一看，心说不能让人给比下去啊，就也挑了一个小鲜肉出使南方，于是南方都城里也万头攒动。\u003c/p\u003e\n\u003cp\u003e这个故事我不记得出处了，不过《世说新语》的《容止》篇里随便挑一条，都不忍直视：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e王丞相见卫洗马曰：「居然有羸形，虽复终日调畅，若不堪罗绮。」\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e不堪罗绮，羡杀韩国欧巴和国产小鲜肉们。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"哪个时代都看脸"},{"content":"\n汉书卷五十四：\n陵对：「无所事骑，臣愿以少击众，步兵五千人涉单于庭。」上壮而许之……\n关于李陵的遭遇，多数人从司马迁身上多少都是知道的：祖上是追杀燕太子丹的秦将李信，祖父是飞将军李广，出身将门世家的李陵自然骁武凭陵，以五千步兵力战十万匈奴精骑，最后矢尽援绝，不得已才投降。即便对于信仰「文死谏，武死战」的中国人，多数也是同情的。\n然而这个故事主要来自于史记，这就尴尬了。从某种意义上说，李陵是给史记定下基调的人。这就决定了它展示给读者的不会是故事的全貌。比如很多年前，我第一次看到这个故事的时候就想不明白一个问题：用五千步兵孤军远征游牧的匈奴，傻子都知道胜算很小，刘彻和李陵的智商同时下线了？\n最近读到汉书的李陵传，发现了更多有趣的细节。\n天汉二年，武帝命二师将军李广利出兵三万攻打在天山的匈奴右贤王，想让李陵监押辎重。**如果把武帝的军事史浓缩成一句话，那就是刘彻和他的小舅子们。**李广利就是因为裙带关系上位的，所以将门世家的李陵耻于为其搞后勤，就跟武帝说：「我本部的军队都是精锐，希望能单独出兵一路，这样可以迫使匈奴人分兵，二师将军那边的压力也会轻一些。」武帝多精啊，一眼就识破李陵的小九九，说：「这次我出兵很多，没有富余的骑兵给你。」\n于是李陵就开始作了，就有了本文开头的那句话。以少击众、步兵打骑兵、孤军深入，哪一条都是兵家大忌，估计李陵说这句话时头皮都是硬的。\n当然李陵也不是完全没有资本，**汉军的战斗力是超过匈奴人的。**硬碰硬的正规战争，匈奴人败多胜少。因为战争打的是综合实力，无论是经济实力、人口、技术，汉朝都远超匈奴，即使三岁骑马五岁弯弓的匈奴人的单兵素质超过汉朝的民兵。\n后来的战事就证明了这一点。首战浚稽山，匈奴人就损失数千人，汉军步兵还追著骑兵打。主要原因就是经济和技术水平的落差太大。匈奴人主要装备的是弓箭，箭头是用兽骨和石头磨成的片状，汉军装备的是连弩，箭头是金属质三棱状，无论在射速、穿透力还是精准度上，前者都远远落后于后者。所以转战上千里，坚持很多天，直到最后汉军的箭用完了，匈奴人才在距离边境五十公里的地方吃掉这支孤军。换句话说，如果箭量充足，十万匈奴骑兵都打不过五千汉军步兵，这个战力的对比，很明显吧。\n最后不服从领导安排的李陵还是败了，败在距离边境只有五十公里的地方。据说最后的日子里，他还单独出营一次，理由是想刺杀单于，搞个斩首行动，回来后就彻底丧失了战斗意志。我觉得这又是个疑点，是不是想溜啊。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/no-zuo-no-die/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-16-10-20161021001.png\" alt=\"2020-06-19-16-16-10-20161021001\"\u003e\u003c/p\u003e\n\u003cp\u003e汉书卷五十四：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e陵对：「无所事骑，臣愿以少击众，步兵五千人涉单于庭。」上壮而许之……\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e关于李陵的遭遇，多数人从司马迁身上多少都是知道的：祖上是追杀燕太子丹的秦将李信，祖父是飞将军李广，出身将门世家的李陵自然骁武凭陵，以五千步兵力战十万匈奴精骑，最后矢尽援绝，不得已才投降。即便对于信仰「文死谏，武死战」的中国人，多数也是同情的。\u003c/p\u003e\n\u003cp\u003e然而这个故事主要来自于史记，这就尴尬了。从某种意义上说，李陵是给史记定下基调的人。这就决定了它展示给读者的不会是故事的全貌。比如很多年前，我第一次看到这个故事的时候就想不明白一个问题：用五千步兵孤军远征游牧的匈奴，傻子都知道胜算很小，刘彻和李陵的智商同时下线了？\u003c/p\u003e\n\u003cp\u003e最近读到汉书的李陵传，发现了更多有趣的细节。\u003c/p\u003e\n\u003cp\u003e天汉二年，武帝命二师将军李广利出兵三万攻打在天山的匈奴右贤王，想让李陵监押辎重。**如果把武帝的军事史浓缩成一句话，那就是刘彻和他的小舅子们。**李广利就是因为裙带关系上位的，所以将门世家的李陵耻于为其搞后勤，就跟武帝说：「我本部的军队都是精锐，希望能单独出兵一路，这样可以迫使匈奴人分兵，二师将军那边的压力也会轻一些。」武帝多精啊，一眼就识破李陵的小九九，说：「这次我出兵很多，没有富余的骑兵给你。」\u003c/p\u003e\n\u003cp\u003e于是李陵就开始作了，就有了本文开头的那句话。以少击众、步兵打骑兵、孤军深入，哪一条都是兵家大忌，估计李陵说这句话时头皮都是硬的。\u003c/p\u003e\n\u003cp\u003e当然李陵也不是完全没有资本，**汉军的战斗力是超过匈奴人的。**硬碰硬的正规战争，匈奴人败多胜少。因为战争打的是综合实力，无论是经济实力、人口、技术，汉朝都远超匈奴，即使三岁骑马五岁弯弓的匈奴人的单兵素质超过汉朝的民兵。\u003c/p\u003e\n\u003cp\u003e后来的战事就证明了这一点。首战浚稽山，匈奴人就损失数千人，汉军步兵还追著骑兵打。主要原因就是经济和技术水平的落差太大。匈奴人主要装备的是弓箭，箭头是用兽骨和石头磨成的片状，汉军装备的是连弩，箭头是金属质三棱状，无论在射速、穿透力还是精准度上，前者都远远落后于后者。所以转战上千里，坚持很多天，直到最后汉军的箭用完了，匈奴人才在距离边境五十公里的地方吃掉这支孤军。换句话说，如果箭量充足，十万匈奴骑兵都打不过五千汉军步兵，这个战力的对比，很明显吧。\u003c/p\u003e\n\u003cp\u003e最后不服从领导安排的李陵还是败了，败在距离边境只有五十公里的地方。据说最后的日子里，他还单独出营一次，理由是想刺杀单于，搞个斩首行动，回来后就彻底丧失了战斗意志。我觉得这又是个疑点，是不是想溜啊。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"李陵是作死的"},{"content":"再次证明我是后知后觉的。\n曾经对印象笔记不屑一顾，因为对所见即所得的偏见和印象笔记对技术人员的不友好。所以这些年一直用DokuWiki。\nDW的编辑模式不是传统的所见即所得，自己的wiki标记简洁好用。能针对段落进行修改。可以列出大纲。插件和主题较多。使用文件存储数据，方便同步。平台无关，对Linux友好。\n不过DW自身也存在一些问题：\n需要搭建服务 自行处理同步 移动端访问不便 编辑和查看操作有割裂感 最近开始琢磨记笔记的最佳实践。考虑到用DW的痛点，感觉对于记笔记最重要的是是否方便记录和查看。在这点上，所见即所得的确有优势。所以我尝试转换到这类工具上。\n选择Bear而不是印象笔记的原因主要是：\n支持代码语法高亮 支持导出Markdown格式 极简风和多种主题 代码语法高亮是刚需，没什么可说的。导出Markdown格式可以方便写博客，这样就不需要Cmd Markdown了。极简的风格和包括Solarized在内的多种主题很毒我。\n不过Bear也有不少问题：\n没有大纲视图，不适合长笔记 标签只支持两级，大量标签不好管理 不支持扫描 对Linux不友好 用标签替代分类的方式我很喜欢，不过两级的限制让笔记分类很伤脑筋，而且容易造成标签太多、难以管理。扫描也是刚需，印象笔记的扫描就很好用，Bear目前没有这个功能，只能用扫描全能王暂补，割裂感很强，而且还增加了APP。\n希望Bear尽快变得更好用。\n","permalink":"http://0x3f.org/posts/switch-to-bear/","summary":"\u003cp\u003e再次证明我是后知后觉的。\u003c/p\u003e\n\u003cp\u003e曾经对印象笔记不屑一顾，因为对所见即所得的偏见和印象笔记对技术人员的不友好。所以这些年一直用DokuWiki。\u003c/p\u003e\n\u003cp\u003eDW的编辑模式不是传统的所见即所得，自己的wiki标记简洁好用。能针对段落进行修改。可以列出大纲。插件和主题较多。使用文件存储数据，方便同步。平台无关，对Linux友好。\u003c/p\u003e\n\u003cp\u003e不过DW自身也存在一些问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e需要搭建服务\u003c/li\u003e\n\u003cli\u003e自行处理同步\u003c/li\u003e\n\u003cli\u003e移动端访问不便\u003c/li\u003e\n\u003cli\u003e编辑和查看操作有割裂感\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e最近开始琢磨记笔记的最佳实践。考虑到用DW的痛点，感觉对于记笔记最重要的是是否方便记录和查看。在这点上，所见即所得的确有优势。所以我尝试转换到这类工具上。\u003c/p\u003e\n\u003cp\u003e选择Bear而不是印象笔记的原因主要是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e支持代码语法高亮\u003c/li\u003e\n\u003cli\u003e支持导出Markdown格式\u003c/li\u003e\n\u003cli\u003e极简风和多种主题\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e代码语法高亮是刚需，没什么可说的。导出Markdown格式可以方便写博客，这样就不需要Cmd Markdown了。极简的风格和包括Solarized在内的多种主题很毒我。\u003c/p\u003e\n\u003cp\u003e不过Bear也有不少问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e没有大纲视图，不适合长笔记\u003c/li\u003e\n\u003cli\u003e标签只支持两级，大量标签不好管理\u003c/li\u003e\n\u003cli\u003e不支持扫描\u003c/li\u003e\n\u003cli\u003e对Linux不友好\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e用标签替代分类的方式我很喜欢，不过两级的限制让笔记分类很伤脑筋，而且容易造成标签太多、难以管理。扫描也是刚需，印象笔记的扫描就很好用，Bear目前没有这个功能，只能用扫描全能王暂补，割裂感很强，而且还增加了APP。\u003c/p\u003e\n\u003cp\u003e希望Bear尽快变得更好用。\u003c/p\u003e","title":"改用Bear记笔记"},{"content":"前两天，一个前端跟我争论说JSON是对象。我在接口文档里的数据格式写的是JSON，结果对方真就传了个对象过来。\n要搞清楚JSON是什么，先得知道JSON是为了解决什么问题的。维基百科里的定义是：\nJSON（JavaScript Object Notation）是一种由道格拉斯·克罗克福特构想设计、轻量级的数据交换语言，以文字为基础，且易于让人阅读。尽管JSON是Javascript的一个子集，但JSON是独立于语言的文本格式，并且采用了类似于C语言家族的一些习惯。\n所以说，JSON是为了解决语言之间数据交换的一种文本格式，体现在数据上，JSON就是字符串类型。那么为什么需要为数据交换制订一种通用的文本格式呢？可以做一个简单的试验：\n用JavaScript建立一个到PHP的WebSocket并发送一个对象：\n1 2 var ws = new WebSocket(\u0026#39;ws://127.0.0.1:4759\u0026#39;); ws.send({name:\u0026#34;hello\u0026#34;}); PHP接收并打印对象：\n1 2 3 4 5 6 use Workerman\\Worker; $worker = new Worker(\u0026#39;websocket://0.0.0.0:4759\u0026#39;); $worker-\u0026gt;onMessage = function($connection, $data) { var_dump($data); } Worker::runAll(); 得到的结果是：\n[object Object]\n所以，一种语言的对象的实例以二进制形式直接传递给另一种语言是无法识别的，因此需要把对象数据用文本描述之后再行传递。\n此外，相对于XML等其它格式，JSON有可读性上的优势，如果是对象，二进制的数据哪来的可读性？\n","permalink":"http://0x3f.org/posts/what-is-json/","summary":"\u003cp\u003e前两天，一个前端跟我争论说JSON是对象。我在接口文档里的数据格式写的是JSON，结果对方真就传了个对象过来。\u003c/p\u003e\n\u003cp\u003e要搞清楚JSON是什么，先得知道JSON是为了解决什么问题的。维基百科里的定义是：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eJSON（JavaScript Object Notation）是一种由道格拉斯·克罗克福特构想设计、轻量级的数据交换语言，以文字为基础，且易于让人阅读。尽管JSON是Javascript的一个子集，但JSON是独立于语言的文本格式，并且采用了类似于C语言家族的一些习惯。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e所以说，JSON是为了解决语言之间数据交换的一种文本格式，体现在数据上，JSON就是字符串类型。那么为什么需要为数据交换制订一种通用的文本格式呢？可以做一个简单的试验：\u003c/p\u003e\n\u003cp\u003e用JavaScript建立一个到PHP的WebSocket并发送一个对象：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ews\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eWebSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ws://127.0.0.1:4759\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ews\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;hello\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ePHP接收并打印对象：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eWorkerman\\Worker\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$worker\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eWorker\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;websocket://0.0.0.0:4759\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$worker\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eonMessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$connection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003evar_dump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eWorker\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003erunAll\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e得到的结果是：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[object Object]\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e所以，一种语言的对象的实例以二进制形式直接传递给另一种语言是无法识别的，因此需要把对象数据用文本描述之后再行传递。\u003c/p\u003e\n\u003cp\u003e此外，相对于XML等其它格式，JSON有可读性上的优势，如果是对象，二进制的数据哪来的可读性？\u003c/p\u003e","title":"JSON是对象还是字符串？"},{"content":"同时处理多个项目时，在窗口标题中显示会话名，方便区分，需用session管理会话。\n1 2 3 4 5 6 7 8 9 10 11 \u0026#34; custom the window title fun! MyTitleString() let sessionName = xolox#session#find_current_session() let sessionStr = \u0026#39;\u0026#39; if len(sessionName)\u0026gt;0 let sessionStr = \u0026#39; [\u0026#39;.sessionName.\u0026#39;] \u0026#39; endif return \u0026#39;VIM\u0026#39;.sessionStr.\u0026#39;: %-25.55F %a%r%m\u0026#39; endfun au BufEnter * let \u0026amp;titlestring=MyTitleString() set titlelen=70 ","permalink":"http://0x3f.org/posts/show-session-name-in-vim-window-title/","summary":"\u003cp\u003e同时处理多个项目时，在窗口标题中显示会话名，方便区分，需用\u003ca href=\"https://github.com/xolox/vim-session\"\u003esession\u003c/a\u003e管理会话。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; custom the window title\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efun\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyTitleString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003esessionName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003exolox\u003c/span\u003e#\u003cspan class=\"nx\"\u003esession\u003c/span\u003e#\u003cspan class=\"nx\"\u003efind_current_session\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003esessionStr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esessionName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026gt;\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003esessionStr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39; [\u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003esessionName\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;] \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;VIM\u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003esessionStr\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;: %-25.55F %a%r%m\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eendfun\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eBufEnter\u003c/span\u003e * \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u0026amp;\u003cspan class=\"nx\"\u003etitlestring\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003eMyTitleString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003etitlelen\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e70\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"在Vim窗口标题中显示会话名"},{"content":"\n汉书卷四十一：「樊哙，沛人也，以屠狗为事。」\n颜师古注：「时人食狗亦与羊豕同。」\n狗对于中国古人的意义和西方人不同。西方人，确切的说是美国人，对狗的感情完全是因为发展的时间太晚。美国开国也就二百来年，从印地安人手里夺来的大量耕地和牧场保证了充足的食物来源，而狗为地广人稀的美国在开拓过程中提供了重要的陪伴和保护，所以美国人不吃狗。\n中国发展的时间远早于美国，而且没有大片的牧场提供稳定的肉食来源，大型牲畜作为农业主要替代劳力一般也不会用于食用，甚至历朝长期立法禁止宰杀大型牲畜。所以狗长期是作为一种重要的肉食来源。\n「失我祈连山，使我六畜不藩息」，「六畜」分别是猪、牛、羊、马、鸡、狗，这是最早被中国人驯化并作为肉食来源的牲畜，而且长期作为祭祀天地祖宗的高档祭品。《道德经》里说：「天地不仁，以万物为刍狗」。「刍狗」就是草扎的狗，是祭祀时当祭品用的，祭祀的时候高高在上、被人们顶礼膜拜，祭祀之后被弃之如敝履，所以说天地不仁。之所以用草狗做祭品，是生产力进步的表现，最初一定是用真狗的，只是后来更高档的肉食逐渐普及，狗肉上不了台面了，才逐渐被抽象成草偶。\n所以中国人是有吃狗的传统的，美国人不吃狗肉也并不表示更文明，至于「狗是人类的朋友」，更是道德绑架，谁也不能随便替别人认朋友，最多只能说你的狗是你的朋友，如果别人吃的不是你的朋友，即便自以为站在道德的高度，你也没有任何权力干涉别人的自由，有句话说的好：自由，就是我有不和你一样高尚的权利。\n我个人也不吃狗肉，但我不觉得别人吃来源合法的狗肉有什么问题。事实上，吃狗肉的问题并不在于吃不吃本身，而是在这个问题上表现出来的人性的恶，人总是自以为站在道德的高度就可以践踏别人的权利，每个暴政无不是利用人性的这个弱点。\n切记，儒以文乱法。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/thinkings-about-eating-dogs/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-16-10-20161021001.png\" alt=\"2020-06-19-16-16-10-20161021001\"\u003e\u003c/p\u003e\n\u003cp\u003e汉书卷四十一：「樊哙，沛人也，以屠狗为事。」\u003c/p\u003e\n\u003cp\u003e颜师古注：「时人食狗亦与羊豕同。」\u003c/p\u003e\n\u003cp\u003e狗对于中国古人的意义和西方人不同。西方人，确切的说是美国人，对狗的感情完全是因为发展的时间太晚。美国开国也就二百来年，从印地安人手里夺来的大量耕地和牧场保证了充足的食物来源，而狗为地广人稀的美国在开拓过程中提供了重要的陪伴和保护，所以美国人不吃狗。\u003c/p\u003e\n\u003cp\u003e中国发展的时间远早于美国，而且没有大片的牧场提供稳定的肉食来源，大型牲畜作为农业主要替代劳力一般也不会用于食用，甚至历朝长期立法禁止宰杀大型牲畜。所以狗长期是作为一种重要的肉食来源。\u003c/p\u003e\n\u003cp\u003e「失我祈连山，使我六畜不藩息」，「六畜」分别是猪、牛、羊、马、鸡、狗，这是最早被中国人驯化并作为肉食来源的牲畜，而且长期作为祭祀天地祖宗的高档祭品。《道德经》里说：「天地不仁，以万物为刍狗」。「刍狗」就是草扎的狗，是祭祀时当祭品用的，祭祀的时候高高在上、被人们顶礼膜拜，祭祀之后被弃之如敝履，所以说天地不仁。之所以用草狗做祭品，是生产力进步的表现，最初一定是用真狗的，只是后来更高档的肉食逐渐普及，狗肉上不了台面了，才逐渐被抽象成草偶。\u003c/p\u003e\n\u003cp\u003e所以中国人是有吃狗的传统的，美国人不吃狗肉也并不表示更文明，至于「狗是人类的朋友」，更是道德绑架，谁也不能随便替别人认朋友，最多只能说你的狗是你的朋友，如果别人吃的不是你的朋友，即便自以为站在道德的高度，你也没有任何权力干涉别人的自由，有句话说的好：自由，就是我有不和你一样高尚的权利。\u003c/p\u003e\n\u003cp\u003e我个人也不吃狗肉，但我不觉得别人吃来源合法的狗肉有什么问题。事实上，吃狗肉的问题并不在于吃不吃本身，而是在这个问题上表现出来的人性的恶，人总是自以为站在道德的高度就可以践踏别人的权利，每个暴政无不是利用人性的这个弱点。\u003c/p\u003e\n\u003cp\u003e切记，儒以文乱法。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"时人食狗亦与羊豕同"},{"content":"安装方案 Archboot是比官方镜像更友好的安装媒介，此外还有AUI和Arch Anywhere，没有试过。\n分区 Archboot使用parted处理分区任务。\n第一个分区不能从sector 0开始，否则安装完成后系统玩法启动，报如下错误：\nno operating system found\n正确的姿势：\n(parted) mkpart primary 2048s 512\n以上假设第一个分区用来挂载/boot，分配512M。\n还需要设置/boot所在的分区可启动：\n(parted) set 1 boot on\n启动引导器 GRUB的兼容性比较好。\n如果是syslinux，对于没有单独对/boot分区并且根分区使用ext4的情况，会无法启动，报如下错误：\nfailed to load ldlinux.c32\n此时，应对/boot单独分区并使用fat格式。\n图形界面 安装X不会连带安装显卡驱动，要单独安装，否则启动图形界面会黑屏。\n在VirtualBox中安装时，驱动在「virtualbox-guest-utils」。\n","permalink":"http://0x3f.org/posts/pits-of-archlinux/","summary":"\u003ch2 id=\"安装方案\"\u003e安装方案\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://mirrors.ustc.edu.cn/archlinux/iso/archboot/latest/\"\u003eArchboot\u003c/a\u003e是比官方镜像更友好的安装媒介，此外还有\u003ca href=\"https://github.com/helmuthdu/aui\"\u003eAUI\u003c/a\u003e和\u003ca href=\"https://arch-anywhere.org\"\u003eArch Anywhere\u003c/a\u003e，没有试过。\u003c/p\u003e\n\u003ch2 id=\"分区\"\u003e分区\u003c/h2\u003e\n\u003cp\u003eArchboot使用parted处理分区任务。\u003c/p\u003e\n\u003cp\u003e第一个分区不能从sector 0开始，否则安装完成后系统玩法启动，报如下错误：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eno operating system found\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e正确的姿势：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(parted) mkpart primary 2048s 512\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e以上假设第一个分区用来挂载/boot，分配512M。\u003c/p\u003e\n\u003cp\u003e还需要设置/boot所在的分区可启动：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(parted) set 1 boot on\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"启动引导器\"\u003e启动引导器\u003c/h2\u003e\n\u003cp\u003eGRUB的兼容性比较好。\u003c/p\u003e\n\u003cp\u003e如果是syslinux，对于没有单独对/boot分区并且根分区使用ext4的情况，会无法启动，报如下错误：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003efailed to load ldlinux.c32\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e此时，应对/boot单独分区并使用fat格式。\u003c/p\u003e\n\u003ch2 id=\"图形界面\"\u003e图形界面\u003c/h2\u003e\n\u003cp\u003e安装X不会连带安装显卡驱动，要单独安装，否则启动图形界面会黑屏。\u003c/p\u003e\n\u003cp\u003e在VirtualBox中安装时，驱动在「virtualbox-guest-utils」。\u003c/p\u003e","title":"Archlinux安装过程中的几个坑"},{"content":"把Alfred升级到3，就想著把切换中英输入状态的问题一块解决掉。\nAlfred可以设置默认使用英文输入状态，然后用Karabiner把Shift_L映射成Ctrl+Space。现在切换输入状态和用Alfred的效率都高多了。\n1 2 3 4 5 6 7 \u0026lt;item\u0026gt; \u0026lt;name\u0026gt;Shift_L to Shift_L\u0026lt;/name\u0026gt; \u0026lt;appendix\u0026gt; + When you type Shift_L only,change to previous system input method\u0026lt;/appendix\u0026gt; \u0026lt;appendix\u0026gt;Shift_L == (Ctrl-Space)\u0026lt;/appendix\u0026gt; \u0026lt;identifier\u0026gt;private.change_input_source_to_squirrel.Rime\u0026lt;/identifier\u0026gt; \u0026lt;autogen\u0026gt;__KeyOverlaidModifier__ KeyCode::SHIFT_L, ModifierFlag::SHIFT_L | ModifierFlag::NONE, KeyCode::SHIFT_L, KeyCode::SPACE,ModifierFlag::CONTROL_L\u0026lt;/autogen\u0026gt; \u0026lt;/item\u0026gt; ","permalink":"http://0x3f.org/posts/little-happiness-from-replacing-ctrl-space-with-shift/","summary":"\u003cp\u003e把Alfred升级到3，就想著把切换中英输入状态的问题一块解决掉。\u003c/p\u003e\n\u003cp\u003eAlfred可以设置默认使用英文输入状态，然后用Karabiner把Shift_L映射成Ctrl+Space。现在切换输入状态和用Alfred的效率都高多了。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;name\u0026gt;\u003c/span\u003eShift_L to Shift_L\u003cspan class=\"nt\"\u003e\u0026lt;/name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;appendix\u0026gt;\u003c/span\u003e + When you type Shift_L only,change to previous system input method\u003cspan class=\"nt\"\u003e\u0026lt;/appendix\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;appendix\u0026gt;\u003c/span\u003eShift_L == (Ctrl-Space)\u003cspan class=\"nt\"\u003e\u0026lt;/appendix\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;identifier\u0026gt;\u003c/span\u003eprivate.change_input_source_to_squirrel.Rime\u003cspan class=\"nt\"\u003e\u0026lt;/identifier\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;autogen\u0026gt;\u003c/span\u003e__KeyOverlaidModifier__ KeyCode::SHIFT_L, ModifierFlag::SHIFT_L | ModifierFlag::NONE, KeyCode::SHIFT_L, KeyCode::SPACE,ModifierFlag::CONTROL_L\u003cspan class=\"nt\"\u003e\u0026lt;/autogen\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"小确幸，用shift切换输入法"},{"content":"\n用了四天时间，读完了这本书。之所以叫「这本书」，是因为这是本在豆瓣里都找不到记录的书，去年上市不久即被下架，通常意义上，叫禁书。\n一般走狗君读的书，作者不是死了两千年，至少也有八百年，连渣渣都不剩的那种。所以如果不是禁书，我还真不一定知道它，更不会读。不过既然是禁书，又是历史方面的，那就好玩儿了，他们不想让我知道的，一定是我应该了解的，他越恐惧，我越好奇。\n读完的感觉嘛，确实是本好书，每个人都应该读一下，如果你能找到的话。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/after-reading-walking-out-of-the-imperial/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-18-58-20160630001.jpg\" alt=\"2020-06-19-16-18-58-20160630001\"\u003e\u003c/p\u003e\n\u003cp\u003e用了四天时间，读完了这本书。之所以叫「这本书」，是因为这是本在豆瓣里都找不到记录的书，去年上市不久即被下架，通常意义上，叫禁书。\u003c/p\u003e\n\u003cp\u003e一般走狗君读的书，作者不是死了两千年，至少也有八百年，连渣渣都不剩的那种。所以如果不是禁书，我还真不一定知道它，更不会读。不过既然是禁书，又是历史方面的，那就好玩儿了，他们不想让我知道的，一定是我应该了解的，他越恐惧，我越好奇。\u003c/p\u003e\n\u003cp\u003e读完的感觉嘛，确实是本好书，每个人都应该读一下，如果你能找到的话。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"读完《走出帝制》"},{"content":"\n如果说2代相对于1代的改进微乎其微，3代在屏幕和配置上的升级是效果显著的。\n从原来的212 PPI升级到300PPI，屏幕像素增加了一倍，加上对比度的提升，显示效果相对1代的变化还是相当明显的，文字更加犀利。内存从256M增加到512M，操作流畅度也有较大的提升，尤其是在用输入法的时候，已经可以基本流畅的输入了。\n然而3代刚推出的时候我还是没有换。一方面以上所说的提升和价格的增量并不匹配。另一面，前代在外观和材质上有很大的问题。\n首先是颜色，黑色稍微粘上点灰就很明显，对于像我这样的强迫症患者，擦灰的时间几乎和阅读一样多。另外，前代的背面采用的是磨砂处理，在干净的前提下手感是不错，不过很容易粘灰，而且粘灰后手感很差，最要命的是，磨砂加上黑色就是指纹收集器！\n所以白色版的出现简直就是一次救赎。白色粘灰后并不明显，背板采用颗粒较大、质感较硬的做工，手感比前代好很多。加上前面所说的在阅读体验上的提升，可以升级了。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/compare-kindle-paperwhite-v1-and-v3-white/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-19-55-20160613002.jpg\" alt=\"2020-06-19-16-19-55-20160613002\"\u003e\u003c/p\u003e\n\u003cp\u003e如果说2代相对于1代的改进微乎其微，3代在屏幕和配置上的升级是效果显著的。\u003c/p\u003e\n\u003cp\u003e从原来的212 PPI升级到300PPI，屏幕像素增加了一倍，加上对比度的提升，显示效果相对1代的变化还是相当明显的，文字更加犀利。内存从256M增加到512M，操作流畅度也有较大的提升，尤其是在用输入法的时候，已经可以基本流畅的输入了。\u003c/p\u003e\n\u003cp\u003e然而3代刚推出的时候我还是没有换。一方面以上所说的提升和价格的增量并不匹配。另一面，前代在外观和材质上有很大的问题。\u003c/p\u003e\n\u003cp\u003e首先是颜色，黑色稍微粘上点灰就很明显，对于像我这样的强迫症患者，擦灰的时间几乎和阅读一样多。另外，前代的背面采用的是磨砂处理，在干净的前提下手感是不错，不过很容易粘灰，而且粘灰后手感很差，最要命的是，磨砂加上黑色就是指纹收集器！\u003c/p\u003e\n\u003cp\u003e所以白色版的出现简直就是一次救赎。白色粘灰后并不明显，背板采用颗粒较大、质感较硬的做工，手感比前代好很多。加上前面所说的在阅读体验上的提升，可以升级了。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"Kindle Paperwhite 1代与3代白色版对比"},{"content":"\n之前读通鉴，用了四年，这次用了七个月。终于是名正言顺的两司马门下走狗了，哦耶。\n史记这本书，说到底还是个人修史，主观性是很大的。因为坐李陵案，司马迁是有悲愤的情结的，所以他特别喜欢悲剧英雄，很多名篇都是写这种人的抒情散文，比如《屈原贾谊列传》、《项羽本纪》。主观的爱憎过多，一定会失之客观。所以项羽以一暴君成垓下悲歌，刘邦以一英主成千古屌丝。褒贬无需作假，有所取舍足矣。\n另外，史料的真实性是值得商榷的。因为秦始皇的焚书坑儒，六国史书尽毁，司马迁的史料来源驳杂，有些事情甚至不同章节互相矛盾。比如黄池之会，左传就只说「遂长吴国」，史记也是照抄这句，究竟晋吴谁做了盟主，还是有争议的。\n史记的成功，在于司马迁的文采和宏观的大体真实。鲁迅说它是无韵之离骚，因为司马迁用了大量小说家的笔法写文章。比如讲齐威王的一生，说此人继位后，好为淫乐长夜之饮，诸侯交侵，相声演员淳于髡看不下去了，跟威王说，我听说国中飞来一只大鸟，三年不飞，三年不鸣，你说这是肿么了？威王说，这只鸟啊，三年不飞，一飞冲天，三年不鸣，一鸣惊人。于是罢饮宴，召集大臣，杀一人，赏一人，全国肃然。然后发兵四境，夺回失地，齐国大振。了了几十字，摇人心旌。\n然而史实肯定不是这么简单，戏剧之所以好看，就在于它将所有出场的人物脸谱化、剧情简单化。比如讲到冒顿单于，主要讲了两件事。\n第一件是鸣镝弑父。依次射野兽、爱马、爱妾、单于坐骑，确保鸣镝已有足够的威信，然后完成致命一击。\n第二件是击灭东胡。东胡利用冒顿刚继位的时机，来索要千里马。冒顿召集臣属商量，都说马是游牧民族的命，不能给。冒顿说，不能因为一匹马让大家冒生命的危险，妥协了。然后东胡又来要冒顿的媳妇儿，冒顿如法炮制。最后东胡说，有块废地也给我们吧。当大家都说反正是废地给就给了的时候，冒顿拍案而起，说土地是国家根本，虽废地寸土必争，然后发兵突袭东胡，一举成功。\n把历史戏剧化，这就是史记好看的地方。马未都先生说，历史没有真相，只残存一个道理。对于大部分人来说，历史细节的真相并不重要，大框架对就可以了，宏观层面的东西足以让人受益匪浅，追本溯源的事留给专业做学问的就好。\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/after-reading-records-of-the-grand-historian/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-14-59-20160613001.jpg\" alt=\"2020-06-19-16-14-59-20160613001\"\u003e\u003c/p\u003e\n\u003cp\u003e之前读通鉴，用了四年，这次用了七个月。终于是名正言顺的两司马门下走狗了，哦耶。\u003c/p\u003e\n\u003cp\u003e史记这本书，说到底还是个人修史，主观性是很大的。因为坐李陵案，司马迁是有悲愤的情结的，所以他特别喜欢悲剧英雄，很多名篇都是写这种人的抒情散文，比如《屈原贾谊列传》、《项羽本纪》。主观的爱憎过多，一定会失之客观。所以项羽以一暴君成垓下悲歌，刘邦以一英主成千古屌丝。褒贬无需作假，有所取舍足矣。\u003c/p\u003e\n\u003cp\u003e另外，史料的真实性是值得商榷的。因为秦始皇的焚书坑儒，六国史书尽毁，司马迁的史料来源驳杂，有些事情甚至不同章节互相矛盾。比如黄池之会，左传就只说「遂长吴国」，史记也是照抄这句，究竟晋吴谁做了盟主，还是有争议的。\u003c/p\u003e\n\u003cp\u003e史记的成功，在于司马迁的文采和宏观的大体真实。鲁迅说它是无韵之离骚，因为司马迁用了大量小说家的笔法写文章。比如讲齐威王的一生，说此人继位后，好为淫乐长夜之饮，诸侯交侵，相声演员淳于髡看不下去了，跟威王说，我听说国中飞来一只大鸟，三年不飞，三年不鸣，你说这是肿么了？威王说，这只鸟啊，三年不飞，一飞冲天，三年不鸣，一鸣惊人。于是罢饮宴，召集大臣，杀一人，赏一人，全国肃然。然后发兵四境，夺回失地，齐国大振。了了几十字，摇人心旌。\u003c/p\u003e\n\u003cp\u003e然而史实肯定不是这么简单，戏剧之所以好看，就在于它将所有出场的人物脸谱化、剧情简单化。比如讲到冒顿单于，主要讲了两件事。\u003c/p\u003e\n\u003cp\u003e第一件是鸣镝弑父。依次射野兽、爱马、爱妾、单于坐骑，确保鸣镝已有足够的威信，然后完成致命一击。\u003c/p\u003e\n\u003cp\u003e第二件是击灭东胡。东胡利用冒顿刚继位的时机，来索要千里马。冒顿召集臣属商量，都说马是游牧民族的命，不能给。冒顿说，不能因为一匹马让大家冒生命的危险，妥协了。然后东胡又来要冒顿的媳妇儿，冒顿如法炮制。最后东胡说，有块废地也给我们吧。当大家都说反正是废地给就给了的时候，冒顿拍案而起，说土地是国家根本，虽废地寸土必争，然后发兵突袭东胡，一举成功。\u003c/p\u003e\n\u003cp\u003e把历史戏剧化，这就是史记好看的地方。马未都先生说，历史没有真相，只残存一个道理。对于大部分人来说，历史细节的真相并不重要，大框架对就可以了，宏观层面的东西足以让人受益匪浅，追本溯源的事留给专业做学问的就好。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"读完《史记》"},{"content":"\n「食其」音「异基」，人名。\n读汉初的历史，有三个人都叫这个名字：郦食其、审食其和赵食其。这似乎在当时是个很流行的名字，俨然就是汉代的丽丽、芳芳啊。\n这两个字为什么念这个音？又是什么意思？\n《康熙字典》里只是明确了两个字的读音，并没有解释和考证出处。\n《史记索隐》说：「食音异。郦、审、赵三人同名，其音合并同，以六国时卫有司马食其，并慕其名。」意即出自战国时卫国司马食其，后人因为仰慕此人，就取他的名字来用。此外比如司马相如因为仰慕蔺相如而改名也是一例，宋人王楙在《野客丛书》里也持这个观点。\n也有人说出自子路所说「食其食者不避其难」。子路做卫国贵族孔悝的家宰时，卫国发生政变，孔悝被劫持，子路听说后只身赴难，在打斗过程中帽子被打掉，说「君子死，冠不免」，在丢下兵器扶帽子的时候被杀。子路去救孔悝时说的这句话，简单说就是吃人嘴短。然而食字在发yi音时并没有吃的意思，所以这种说法当是附会。\n比较来看，《史记索隐》的说法最靠谱，但是也没有从根本上解释清楚这个名字的意思。不过考虑到先秦人名普遍比较朴拙和文、言异路的因素，这个名字应该出自当时的口语或方言，只是写到书上时拿「食其」两个字做假借。\n本期封面：我的贝克利要🌼了\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/what-is-yi-ji/","summary":"\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/xbot/image-hosting/master/blog/2020-06-19-16-07-23-20160606001.jpg\" alt=\"2020-06-19-16-07-23-20160606001\"\u003e\u003c/p\u003e\n\u003cp\u003e「食其」音「异基」，人名。\u003c/p\u003e\n\u003cp\u003e读汉初的历史，有三个人都叫这个名字：郦食其、审食其和赵食其。这似乎在当时是个很流行的名字，俨然就是汉代的丽丽、芳芳啊。\u003c/p\u003e\n\u003cp\u003e这两个字为什么念这个音？又是什么意思？\u003c/p\u003e\n\u003cp\u003e《康熙字典》里只是明确了两个字的读音，并没有解释和考证出处。\u003c/p\u003e\n\u003cp\u003e《史记索隐》说：「食音异。郦、审、赵三人同名，其音合并同，以六国时卫有司马食其，并慕其名。」意即出自战国时卫国司马食其，后人因为仰慕此人，就取他的名字来用。此外比如司马相如因为仰慕蔺相如而改名也是一例，宋人王楙在《野客丛书》里也持这个观点。\u003c/p\u003e\n\u003cp\u003e也有人说出自子路所说「食其食者不避其难」。子路做卫国贵族孔悝的家宰时，卫国发生政变，孔悝被劫持，子路听说后只身赴难，在打斗过程中帽子被打掉，说「君子死，冠不免」，在丢下兵器扶帽子的时候被杀。子路去救孔悝时说的这句话，简单说就是吃人嘴短。然而食字在发yi音时并没有吃的意思，所以这种说法当是附会。\u003c/p\u003e\n\u003cp\u003e比较来看，《史记索隐》的说法最靠谱，但是也没有从根本上解释清楚这个名字的意思。不过考虑到先秦人名普遍比较朴拙和文、言异路的因素，这个名字应该出自当时的口语或方言，只是写到书上时拿「食其」两个字做假借。\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cstrong\u003e本期封面\u003c/strong\u003e：我的贝克利要🌼了\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"「食其」是什么？"},{"content":"算是开始玩自媒体了么？\n如果从写博客算起，十年前就算了。从一开始和大多数人一样，把博客当成公开日记写，到后来很快明白博客的定位，我的自媒体时代很快从0.1升级到1.0。\n后来，因为博客托管网站的所见即所得编辑器生成的HTML代码格式太死板，自己定义了一套简单的标记，然后写了个转换程序，然而没过多久就发现，已经有了类似的东西\u0026ndash;轻量型标记语言。\n很快，托管的服务已经不能满足个性化要求。自然而然地，就有了独立博客。这算是我的自媒体2.0时代吧。\n就这样一直持续了很多年。内容基本上是日常的总结和笔记，总之是给自己看的成分居多。\n公众号怎么定位呢？首先应该是写给别人看的，所以不能过于自由，想什么时候写什么时候写，有时候一月一次，有时候一月几次，有时候几个月不来一次（😱）。其次应该是个专栏，所以主题应该集中，不能想写什么写什么。\n那么写点啥呢？在一个理工宅少得可怜的爱好里，翻翻故纸堆是唯一比较能算得上文艺的东西了。其实在接触电脑之前，我一直是想学考古的（💀），现在看来其实人还是最好不要忘了初心（😳）。\n好了，都闪开，我要进（kai）入（shi）3.0时（zhuang）代（bi）了！\n本文最早发布在公众号：两司马门下走狗\n","permalink":"http://0x3f.org/posts/the-first-post-of-running-dog/","summary":"\u003cp\u003e算是开始玩自媒体了么？\u003c/p\u003e\n\u003cp\u003e如果从写博客算起，十年前就算了。从一开始和大多数人一样，把博客当成公开日记写，到后来很快明白博客的定位，我的自媒体时代很快从0.1升级到1.0。\u003c/p\u003e\n\u003cp\u003e后来，因为博客托管网站的所见即所得编辑器生成的HTML代码格式太死板，自己定义了一套简单的标记，然后写了个转换程序，然而没过多久就发现，已经有了类似的东西\u0026ndash;轻量型标记语言。\u003c/p\u003e\n\u003cp\u003e很快，托管的服务已经不能满足个性化要求。自然而然地，就有了独立博客。这算是我的自媒体2.0时代吧。\u003c/p\u003e\n\u003cp\u003e就这样一直持续了很多年。内容基本上是日常的总结和笔记，总之是给自己看的成分居多。\u003c/p\u003e\n\u003cp\u003e公众号怎么定位呢？首先应该是写给别人看的，所以不能过于自由，想什么时候写什么时候写，有时候一月一次，有时候一月几次，有时候几个月不来一次（😱）。其次应该是个专栏，所以主题应该集中，不能想写什么写什么。\u003c/p\u003e\n\u003cp\u003e那么写点啥呢？在一个理工宅少得可怜的爱好里，翻翻故纸堆是唯一比较能算得上文艺的东西了。其实在接触电脑之前，我一直是想学考古的（💀），现在看来其实人还是最好不要忘了初心（😳）。\u003c/p\u003e\n\u003cp\u003e好了，都闪开，我要进（kai）入（shi）3.0时（zhuang）代（bi）了！\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003e本文最早发布在公众号：\u003cstrong\u003e两司马门下走狗\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/qrcode_zougou.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"两司马门下走狗创刊号"},{"content":"Kindle Lazybones .-. _ ( `. .' ) `\\ ` .' | | | | | 66|_ | ,__) |(,_| | | | \\_, | | | | .' \\ ( , ) '--' '-' Remote controlling utilities for Kindle.\nFeature Flip over Kindle with your smartphone. Issues Currently only Kindle PaperWhite is supported, PW2/PW3 are not yet. Kindle still goes to sleep after 10 minutes, a temporary solution is running the searchbox command ~ds to disable screensaver, but only a restart can resume it. The other way is changing 10 minutes to longer by modifying /etc/kdb/system/daemon/powerd/t1_timeout, but it\u0026rsquo;s readonly although I\u0026rsquo;ve run mntroot rw. Button sizes won\u0026rsquo;t be adjusted correctly when the orientation of Android smartphones changes (from landscape to portrait or vice versa), a temporary solution is refreshing the page. iOS devices don\u0026rsquo;t have this problem. Project Architechture kindle/ Server-side files for Kindle. User Guide Jailbreak Kindle Jailbreaking Kindle allows you to access its operating system.\nFor how to do that, refer to Kindle 5.6.5 越狱教程：支持所有 5.6.5 固件 in chinese or 5.6.5 Jailbreak (closed-kindle) \u0026ndash; released! in english.\nInstall KUAL, MRPI and USBNetwork KUAL is an application launcher for Kindle, MRPI is a package installer plugin for KUAL and USBNetwork is a package which provides SSH service for Kindle.\nFor how to do that, refer to Kindle 5.6.5 越狱插件资源下载及详细安装步骤 in chinese or the following in english:\nKUAL: Kindle Unified Application Launcher (v 2.6) MobileRead Package Installer Kindle Touch/PW1/PW2 5.0.x - 5.4.4.2 JailBreak. Plus FW 5.x USBNetwork. Install Python As this project is mainly written in Python, so refer to FW 5.x ScreenSavers Hack.\nOpen Access to Port 8080 Lazybones communicates with remote controllers on port 8080, so add the following line to /etc/sysconfig/iptables:\n-A INPUT -p TCP \u0026ndash;dport 8080 -j ACCEPT\nInstall Lazybones Put kindle/ under /opt/ and rename it to lazybones.\nAs Kindle uses Upstart to handle system startup jobs, run the following command to make Lazybones run automatically on OS startup:\n1 cp /opt/lazybones/etc/upstart/lazybones.conf /etc/init/ Usage Restart Kindle, enable WIFI and it should works.\nType ;711 in the search box in Kindle and press Enter, this shows its WIFI infomation, find the IP address (assuming that\u0026rsquo;s 192.168.1.103) and visit http://192.168.1.103:8080 on your smartphone.\n","permalink":"http://0x3f.org/posts/kindle-lazybones/","summary":"\u003ch1 id=\"kindle-lazybones\"\u003eKindle Lazybones\u003c/h1\u003e\n\u003cpre\u003e\u003ccode\u003e .-.     _\n(   `. .' )\n `\\  `  .'\n   |   |\n   |   |\n   | 66|_\n   |  ,__)\n   |(,_|\n   | | \n   | \\_,\n   |   |\n   |   |\n .'     \\\n(    ,   )\n '--' '-'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRemote controlling utilities for Kindle.\u003c/p\u003e\n\u003ch2 id=\"feature\"\u003eFeature\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eFlip over Kindle with your smartphone.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"issues\"\u003eIssues\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCurrently only Kindle PaperWhite is supported, PW2/PW3 are not yet.\u003c/li\u003e\n\u003cli\u003eKindle still goes to sleep after 10 minutes, a temporary solution is running the searchbox command \u003ccode\u003e~ds\u003c/code\u003e to disable screensaver, but only a restart can resume it. The other way is changing 10 minutes to longer by modifying \u003ccode\u003e/etc/kdb/system/daemon/powerd/t1_timeout\u003c/code\u003e, but it\u0026rsquo;s readonly although I\u0026rsquo;ve run \u003ccode\u003emntroot rw\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eButton sizes won\u0026rsquo;t be adjusted correctly when the orientation of Android smartphones changes (\u003cem\u003efrom landscape to portrait or vice versa\u003c/em\u003e), a temporary solution is refreshing the page. iOS devices don\u0026rsquo;t have this problem.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"project-architechture\"\u003eProject Architechture\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ekindle/  Server-side files for Kindle.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"user-guide\"\u003eUser Guide\u003c/h2\u003e\n\u003ch3 id=\"jailbreak-kindle\"\u003eJailbreak Kindle\u003c/h3\u003e\n\u003cp\u003eJailbreaking Kindle allows you to access its operating system.\u003c/p\u003e","title":"Kindle Lazybones: Control Kindle From Your Phone"},{"content":"前两天读史记王翦列传，觉得秦楚的决战很奇怪。\n王翦果代李信击荆。荆闻王翦益军而来，乃悉国中兵以拒秦。王翦至，坚壁而守之，不肯战。荆兵数出挑战，终不出。王翦日休士洗沐，而善饮食抚循之，亲与士卒同食。久之，王翦使人问军中戏乎？对曰：「方投石超距。」于是王翦曰：「士卒可用矣。」荆数挑战而秦不出，乃引而东。翦因举兵追之，令壮士击，大破荆军。至蕲南，杀其将军项燕，荆兵遂败走。秦因乘胜略定荆地城邑。岁余，虏荆王负刍，竟平荆地为郡县。\n稍微有点军事常识就知道，防守方最好的办法是坚守不战，在自己的地盘上，对方的后勤补给要比自己困难得多，一旦补给不继，军心必乱，势必撤兵，这时候再追上去打，胜算很大，也就是所谓以逸待劳。比如秦赵长平之战，一开始，廉颇先用小股部队跟秦军接触，一看打不赢，马上收缩防线，避免决战，搞得秦军进也不是、退也不是，军力损耗极大，不得以只好用反间换掉廉颇。\n所以战争中的进攻方是处于劣势的，要扭转不利的态势，就要把主动权握在自己手里，所以一般会用反客为主的办法。虽然我是进攻方，但我不著急进攻你，让你自己沈不住气来打我，这时候攻守易形，我成了防守方，你成了进攻方，形势就对我有利了。\n所以王翦反客为主是正常的，项燕急著打就很奇怪了。老项家累世将门，项燕沙场宿将，不可能连常识都不懂。\n也许唯一合理的解释是楚国国力衰败，撑不下去了。\n以前秦国伐楚很困难，因为楚国西有江汉之险，北有诸夏扞蔽。不过自白起破鄢郢，江汉天险尽失；自三晋覆灭，中原逐鹿之势已成。秦国伐楚，后勤补给已经不是问题。\n另外，让秦国拥有支持百万级灭国战役能力的，还有伐蜀的决策。自商君变法，秦国势平地起飞，此后相当长的一段时间，秦国虽说是战国首强，但也不能占据压倒性的优势，直到秦灭六国前的三十年，还有信陵君收天下之兵扣关攻秦的事。战争不是战斗，决定成败的主要还是国力。李信的二十万大军覆灭后，秦国可以马上再把六十万人送上前线，这个国力，不赢没有天理。所以司马错论伐蜀，同时拥有关中、蜀中两块天府之国，是秦国国力质变的关键。\n这个时候的楚国，已经是冢中枯骨。在秦国连年的攻势下，大片国土沦丧，鄢郢破而迁陈，三晋亡而迁寿春，几十年间，颠沛流离，没有喘息的机会，靠吃战略纵深的老本苟延残喘。所以在这次决战之前，可能国力已经难以为继了，但是楚国自己也知道八百年国运系于这一战，所以不得不起倾国之兵应战。空虚的国力和浩大的战争消耗最终迫使项燕选择速战速决，战还有一线生机，不战只能坐以待毙。\n","permalink":"http://0x3f.org/posts/a-strange-decisive-battle/","summary":"\u003cp\u003e前两天读史记王翦列传，觉得秦楚的决战很奇怪。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e王翦果代李信击荆。荆闻王翦益军而来，乃悉国中兵以拒秦。王翦至，坚壁而守之，不肯战。荆兵数出挑战，终不出。王翦日休士洗沐，而善饮食抚循之，亲与士卒同食。久之，王翦使人问军中戏乎？对曰：「方投石超距。」于是王翦曰：「士卒可用矣。」荆数挑战而秦不出，乃引而东。翦因举兵追之，令壮士击，大破荆军。至蕲南，杀其将军项燕，荆兵遂败走。秦因乘胜略定荆地城邑。岁余，虏荆王负刍，竟平荆地为郡县。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e稍微有点军事常识就知道，防守方最好的办法是坚守不战，在自己的地盘上，对方的后勤补给要比自己困难得多，一旦补给不继，军心必乱，势必撤兵，这时候再追上去打，胜算很大，也就是所谓以逸待劳。比如秦赵长平之战，一开始，廉颇先用小股部队跟秦军接触，一看打不赢，马上收缩防线，避免决战，搞得秦军进也不是、退也不是，军力损耗极大，不得以只好用反间换掉廉颇。\u003c/p\u003e\n\u003cp\u003e所以战争中的进攻方是处于劣势的，要扭转不利的态势，就要把主动权握在自己手里，所以一般会用反客为主的办法。虽然我是进攻方，但我不著急进攻你，让你自己沈不住气来打我，这时候攻守易形，我成了防守方，你成了进攻方，形势就对我有利了。\u003c/p\u003e\n\u003cp\u003e所以王翦反客为主是正常的，项燕急著打就很奇怪了。老项家累世将门，项燕沙场宿将，不可能连常识都不懂。\u003c/p\u003e\n\u003cp\u003e也许唯一合理的解释是楚国国力衰败，撑不下去了。\u003c/p\u003e\n\u003cp\u003e以前秦国伐楚很困难，因为楚国西有江汉之险，北有诸夏扞蔽。不过自白起破鄢郢，江汉天险尽失；自三晋覆灭，中原逐鹿之势已成。秦国伐楚，后勤补给已经不是问题。\u003c/p\u003e\n\u003cp\u003e另外，让秦国拥有支持百万级灭国战役能力的，还有伐蜀的决策。自商君变法，秦国势平地起飞，此后相当长的一段时间，秦国虽说是战国首强，但也不能占据压倒性的优势，直到秦灭六国前的三十年，还有信陵君收天下之兵扣关攻秦的事。战争不是战斗，决定成败的主要还是国力。李信的二十万大军覆灭后，秦国可以马上再把六十万人送上前线，这个国力，不赢没有天理。所以司马错论伐蜀，同时拥有关中、蜀中两块天府之国，是秦国国力质变的关键。\u003c/p\u003e\n\u003cp\u003e这个时候的楚国，已经是冢中枯骨。在秦国连年的攻势下，大片国土沦丧，鄢郢破而迁陈，三晋亡而迁寿春，几十年间，颠沛流离，没有喘息的机会，靠吃战略纵深的老本苟延残喘。所以在这次决战之前，可能国力已经难以为继了，但是楚国自己也知道八百年国运系于这一战，所以不得不起倾国之兵应战。空虚的国力和浩大的战争消耗最终迫使项燕选择速战速决，战还有一线生机，不战只能坐以待毙。\u003c/p\u003e","title":"奇怪的决战"},{"content":"Pushbullet workflow for Alfred.\nFeatures Push a text to another device. Installation Download the latest release and rename it to pushbullet.alfredworkflow. Double click it to import it into Alfred. Double click the \u0026ldquo;Run Script\u0026rdquo; button and replace \u0026ldquo;ACCESS_TOKEN\u0026rdquo; and \u0026ldquo;DEVICE_NAME\u0026rdquo; according to your pushbullet settings. Activate alfred and input \u0026ldquo;push blablabla\u0026rdquo;, then press enter. Author base64decode IkRvbmllIExlaWdoIiA8ZG9uaWUubGVpZ2hAZ21haWwuY29tPgo=\nDownload https://github.com/xbot/alfred-pushbullet/\n","permalink":"http://0x3f.org/posts/alfred-pushbullet/","summary":"\u003cp\u003ePushbullet workflow for Alfred.\u003c/p\u003e\n\u003ch2 id=\"features\"\u003eFeatures\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePush a text to another device.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"installation\"\u003eInstallation\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eDownload the latest release and rename it to pushbullet.alfredworkflow.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eDouble click it to import it into Alfred.\u003c/li\u003e\n\u003cli\u003eDouble click the \u0026ldquo;Run Script\u0026rdquo; button and replace \u0026ldquo;ACCESS_TOKEN\u0026rdquo; and \u0026ldquo;DEVICE_NAME\u0026rdquo; according to your pushbullet settings.\u003c/li\u003e\n\u003cli\u003eActivate alfred and input \u0026ldquo;push blablabla\u0026rdquo;, then press enter.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"author\"\u003eAuthor\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ebase64decode IkRvbmllIExlaWdoIiA8ZG9uaWUubGVpZ2hAZ21haWwuY29tPgo=\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"download\"\u003eDownload\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/alfred-pushbullet/\"\u003ehttps://github.com/xbot/alfred-pushbullet/\u003c/a\u003e\u003c/p\u003e","title":"Alfred-pushbullet: Push a text to your phone"},{"content":"假设U盘对应/dev/sdb1、OSX安装包是osx.dmg。整个过程就是提取出一系列文件，然后复制到U盘里。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # 格式化U盘为hfs+文件系统 sudo mkfs.hfsplus -v EICaptianInstall /dev/sdb1 # 提取和挂载第一个光盘镜像 dmg2img -p 5 osx.dmg osx.img mkdir raw \u0026amp;\u0026amp; sudo mount -o loop osx.img raw # 提取和挂载第二个光盘镜像 dmg2img -p 5 raw/Install\\ OS\\ X\\ El\\ Capitan.app/Contents/SharedSupport/InstallESD.dmg InstallESD.img mkdir esd \u0026amp;\u0026amp; sudo mount -o loop InstallESD.img esd # 提取和挂载第三个光盘镜像 dmg2img -p 4 esd/BaseSystem.dmg BaseSystem.img mkdir base \u0026amp;\u0026amp; sudo mount -o loop BaseSystem.img base # 挂载U盘 mkdir usb \u0026amp;\u0026amp; sudo mount /dev/sdb1 usb # 复制一系列文件 sudo cp -r base/* usb/ sudo rm usb/System/Installation/Packages sudo cp -r esd/Packages usb/System/Installation/ sudo cp esd/BaseSystem.* usb/ 注意dmg2img的参数-p表示提取dmg的第几个分区，似乎不同的OSX版本提取哪个分区也不一样，判断方法就是先执行dmg2img osx.dmg，看哪个分区提取得最慢就选哪个。\n","permalink":"http://0x3f.org/posts/create-mac-bootable-usb-stick-on-linux/","summary":"\u003cp\u003e假设U盘对应/dev/sdb1、OSX安装包是osx.dmg。整个过程就是提取出一系列文件，然后复制到U盘里。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 格式化U盘为hfs+文件系统\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo mkfs.hfsplus -v EICaptianInstall /dev/sdb1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 提取和挂载第一个光盘镜像\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edmg2img -p \u003cspan class=\"m\"\u003e5\u003c/span\u003e osx.dmg osx.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir raw \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo mount -o loop osx.img raw\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 提取和挂载第二个光盘镜像\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edmg2img -p \u003cspan class=\"m\"\u003e5\u003c/span\u003e raw/Install\u003cspan class=\"se\"\u003e\\ \u003c/span\u003eOS\u003cspan class=\"se\"\u003e\\ \u003c/span\u003eX\u003cspan class=\"se\"\u003e\\ \u003c/span\u003eEl\u003cspan class=\"se\"\u003e\\ \u003c/span\u003eCapitan.app/Contents/SharedSupport/InstallESD.dmg InstallESD.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir esd \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo mount -o loop InstallESD.img esd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 提取和挂载第三个光盘镜像\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edmg2img -p \u003cspan class=\"m\"\u003e4\u003c/span\u003e esd/BaseSystem.dmg BaseSystem.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir base \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo mount -o loop BaseSystem.img base\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 挂载U盘\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir usb \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo mount /dev/sdb1 usb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 复制一系列文件\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo cp -r base/* usb/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo rm usb/System/Installation/Packages\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo cp -r esd/Packages usb/System/Installation/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo cp esd/BaseSystem.* usb/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e注意dmg2img的参数-p表示提取dmg的第几个分区，似乎不同的OSX版本提取哪个分区也不一样，判断方法就是先执行\u003ccode\u003edmg2img osx.dmg\u003c/code\u003e，看哪个分区提取得最慢就选哪个。\u003c/p\u003e","title":"Linux下做Mac OSX安装U盘的步骤"},{"content":"设置Vim的折叠规则为syntax存在两个问题。一是如果源码中有大量折叠区域，在插入模式中输入会变得很卡。二是刚输入一个折叠区域的起始符号，后面所有的折叠都会被打开。\n第一个问题是因为Vim的syntax折叠规则处理过于低效。而后一个问题对于所有自动折叠规则都会存在，原因是Vim对折叠的更新过早。\n传统的解决办法是将折叠规则置为manual，并在合适的时机重置为syntax或其它相应规则。但是工作繁复而且往往问题很多。\nFastFold是遵循上面所说的方法解决这些问题的插件，不过默认会在所有与折叠相关的时机更新折叠，会导致相关的操作变慢，例如zc和zo时都会有明显的卡顿。鉴于其它时机对折叠的更新已经足够及时，可以通过配置取消受在到明显影响的时机更新折叠：\n1 2 \u0026#34; FastFold只在za/zA/zx/zX时更新折叠信息 let g:fastfold_fold_command_suffixes = [\u0026#39;x\u0026#39;,\u0026#39;X\u0026#39;,\u0026#39;a\u0026#39;,\u0026#39;A\u0026#39;] ","permalink":"http://0x3f.org/posts/fastfold-for-vim/","summary":"\u003cp\u003e设置Vim的折叠规则为syntax存在两个问题。一是如果源码中有大量折叠区域，在插入模式中输入会变得很卡。二是刚输入一个折叠区域的起始符号，后面所有的折叠都会被打开。\u003c/p\u003e\n\u003cp\u003e第一个问题是因为Vim的syntax折叠规则处理过于低效。而后一个问题对于所有自动折叠规则都会存在，原因是Vim对折叠的更新过早。\u003c/p\u003e\n\u003cp\u003e传统的解决办法是将折叠规则置为manual，并在合适的时机重置为syntax或其它相应规则。但是工作繁复而且往往问题很多。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/Konfekt/FastFold\"\u003eFastFold\u003c/a\u003e是遵循上面所说的方法解决这些问题的插件，不过默认会在所有与折叠相关的时机更新折叠，会导致相关的操作变慢，例如zc和zo时都会有明显的卡顿。鉴于其它时机对折叠的更新已经足够及时，可以通过配置取消受在到明显影响的时机更新折叠：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; FastFold只在za/zA/zx/zX时更新折叠信息\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003efastfold_fold_command_suffixes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e  [\u003cspan class=\"s1\"\u003e\u0026#39;x\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;X\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"FastFold：Vim折叠功能的救赎"},{"content":"fzf是个独立的命令行工具，索引速度很快，可以通过fzf-vim配合使用。\n特性 功能支持还是比较全的：\nCommand List Files [PATH] Files (similar to :FZF ) GitFiles Git files Buffers Open buffers Colors Color schemes Ag [PATTERN] {ag}{5} search result (ALT-A to select all, ALT-D to deselect all) Lines Lines in loaded buffers BLines Lines in the current buffer Tags Tags in the project ( ctags -R ) BTags Tags in the current buffer Marks Marks Windows Windows Locate PATTERN locate command output History v:oldfiles and open buffers History: Command history History/ Search history Snippets Snippets ({UltiSnips}{6}) Commits Git commits (requires {fugitive.vim}{7}) BCommits Git commits for the current buffer Commands Commands Maps Normal mode mappings Helptags Help tags [1] 结论 fzf需要在终端中执行，在vim中使用时需要另外启动一个xterm实例，UI的割裂感很强，而且xterm本身的操性你懂的。另外Tags模式需要两次回车。所以暂不会用它取代ctrlp和unite。\n","permalink":"http://0x3f.org/posts/fzf-yet-another-fuzzy-finder/","summary":"\u003cp\u003e\u003ca href=\"https://github.com/junegunn/fzf\"\u003efzf\u003c/a\u003e是个独立的命令行工具，索引速度很快，可以通过\u003ca href=\"https://github.com/junegunn/fzf.vim\"\u003efzf-vim\u003c/a\u003e配合使用。\u003c/p\u003e\n\u003ch2 id=\"特性\"\u003e特性\u003c/h2\u003e\n\u003cp\u003e功能支持还是比较全的：\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eCommand\u003c/th\u003e\n          \u003cth\u003eList\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFiles [PATH]\u003c/td\u003e\n          \u003ctd\u003eFiles (similar to  \u003ccode\u003e:FZF\u003c/code\u003e )\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eGitFiles\u003c/td\u003e\n          \u003ctd\u003eGit files\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eBuffers\u003c/td\u003e\n          \u003ctd\u003eOpen buffers\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eColors\u003c/td\u003e\n          \u003ctd\u003eColor schemes\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAg [PATTERN]\u003c/td\u003e\n          \u003ctd\u003e{ag}{5} search result (ALT-A to select all, ALT-D to deselect all)\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eLines\u003c/td\u003e\n          \u003ctd\u003eLines in loaded buffers\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eBLines\u003c/td\u003e\n          \u003ctd\u003eLines in the current buffer\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eTags\u003c/td\u003e\n          \u003ctd\u003eTags in the project ( \u003ccode\u003ectags -R\u003c/code\u003e )\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eBTags\u003c/td\u003e\n          \u003ctd\u003eTags in the current buffer\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eMarks\u003c/td\u003e\n          \u003ctd\u003eMarks\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eWindows\u003c/td\u003e\n          \u003ctd\u003eWindows\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eLocate PATTERN\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003elocate\u003c/code\u003e  command output\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eHistory\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003ev:oldfiles\u003c/code\u003e  and open buffers\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eHistory:\u003c/td\u003e\n          \u003ctd\u003eCommand history\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eHistory/\u003c/td\u003e\n          \u003ctd\u003eSearch history\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eSnippets\u003c/td\u003e\n          \u003ctd\u003eSnippets ({UltiSnips}{6})\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCommits\u003c/td\u003e\n          \u003ctd\u003eGit commits (requires {fugitive.vim}{7})\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eBCommits\u003c/td\u003e\n          \u003ctd\u003eGit commits for the current buffer\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCommands\u003c/td\u003e\n          \u003ctd\u003eCommands\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eMaps\u003c/td\u003e\n          \u003ctd\u003eNormal mode mappings\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eHelptags\u003c/td\u003e\n          \u003ctd\u003eHelp tags [1]\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"结论\"\u003e结论\u003c/h2\u003e\n\u003cp\u003efzf需要在终端中执行，在vim中使用时需要另外启动一个xterm实例，UI的割裂感很强，而且xterm本身的操性你懂的。另外Tags模式需要两次回车。所以暂不会用它取代ctrlp和unite。\u003c/p\u003e","title":"FZF: 又一个文件模糊查询工具"},{"content":"这两天把源码分析工具从ctags向gtags迁移，另外尝试了一下phpctags。\n之前用ctags有两个问题，一个是如果同一tag有多个定义，按Ctrl+]只能跳转到第一处。另一个是用cscope查询tag的调用记录时，有些tag查不到结果。\n几年前接触过gtags，因为当时还不支持宇宙最好语言，所以没用。这次测试了一下，前面两个ctags的问题都可以解决。\n安装后需要手工拷贝gtags.vim和gtags-cscope.vim到vim的plugin目录，然后配置如下：\n1 2 3 4 5 6 7 let Gtags_Close_When_Single = 1 let Gtags_Auto_Update = 0 let g:cscope_silent = 1 au FileType php,python,c,cpp,javascript,go map \u0026lt;C-]\u0026gt; :Gtags\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt; au FileType php,python,c,cpp,javascript,go map \u0026lt;C-[\u0026gt; :Gtags -r\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt; nnoremap \u0026lt;leader\u0026gt;\u0026lt;C-]\u0026gt; :execute \u0026#39;Unite gtags/def:\u0026#39;.expand(\u0026#39;\u0026lt;cword\u0026gt;\u0026#39;)\u0026lt;CR\u0026gt; nnoremap \u0026lt;leader\u0026gt;\u0026lt;C-[\u0026gt; :execute \u0026#39;Unite gtags/ref:\u0026#39;.expand(\u0026#39;\u0026lt;cword\u0026gt;\u0026#39;)\u0026lt;CR\u0026gt; 其它选项参见前面两个文件里的注释。\n另外尝试了一下phpctags，据说和ctags兼容并对php做了优化。实际使用效果和ctags没发现有什么区别，不过tagbar-phpctags倒是比tagbar用ctags时效果更好。\n","permalink":"http://0x3f.org/posts/ctags-vs-gtags-vs-phpctags/","summary":"\u003cp\u003e这两天把源码分析工具从ctags向gtags迁移，另外尝试了一下phpctags。\u003c/p\u003e\n\u003cp\u003e之前用ctags有两个问题，一个是如果同一tag有多个定义，按Ctrl+]只能跳转到第一处。另一个是用cscope查询tag的调用记录时，有些tag查不到结果。\u003c/p\u003e\n\u003cp\u003e几年前接触过gtags，因为当时还不支持宇宙最好语言，所以没用。这次测试了一下，前面两个ctags的问题都可以解决。\u003c/p\u003e\n\u003cp\u003e安装后需要手工拷贝gtags.vim和gtags-cscope.vim到vim的plugin目录，然后配置如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eGtags_Close_When_Single\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eGtags_Auto_Update\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003ecscope_silent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003epython\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ecpp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ejavascript\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ego\u003c/span\u003e \u003cspan class=\"k\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e]\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e :\u003cspan class=\"nx\"\u003eGtags\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003epython\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ecpp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ejavascript\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ego\u003c/span\u003e \u003cspan class=\"k\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e[\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e :\u003cspan class=\"nx\"\u003eGtags\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e]\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e :\u003cspan class=\"k\"\u003eexecute\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Unite gtags/def:\u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;cword\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e[\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e :\u003cspan class=\"k\"\u003eexecute\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Unite gtags/ref:\u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;cword\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e其它选项参见前面两个文件里的注释。\u003c/p\u003e\n\u003cp\u003e另外尝试了一下phpctags，据说和ctags兼容并对php做了优化。实际使用效果和ctags没发现有什么区别，不过tagbar-phpctags倒是比tagbar用ctags时效果更好。\u003c/p\u003e","title":"ctags vs gtags vs phpctags"},{"content":"简述 Sublime在文件打开速度上的表现很惊艳，Vim有几个扩展可以实现类似功能，本文对这些扩展做个对比。\n虽然每个扩展都或多或少地实现了一些功能，我个人用得最多的也就文件、Tag、Buffer Tag的模糊查找这三个，像MRU、buffer之类的查找不觉得有多大用处，所以提高工作效率的工具一定是在热度环节有很好表现，其余偏门功能可以交给插件实现，在这点上CtrlP和Unite做得很好。所以下面针对最常用的这三个功能做下对比，更多功能的对比见下表：\n文件模糊查找 Command-T的文件索引速度最快，各方面在这几个扩展中的表现都是最好的。\nCtrlP默认使用VIM自建的globpath()，需要手工配置使用ag以获取更快的速度，据说使用find命令效率更高，实际感觉和ag差别不大。\nUnite也需要手工设置使用ag，而且可以实现异步索引，在这一点的体验上好于前两个，但是在模糊匹配的排序上表现不好，比如输入“php”，当然希望“/etc/php.ini”这样的结果排在“/home/peter/host/tmp.txt”前面，实际往往不是这样，Unite的几个sorter里，数rank的排序结果最接近于这个要求，但是表现仍然不如前两个。\nTag模糊查找 三个扩展都是通过ctags实现，虽然Unite的排序问题仍然存在，对于Tag这么简短的东西，问题不大。\nBuffer Tag模糊查找 CtrlP的表现是最好的。\nUnite需要通过unite-outline这个source实现，但是只能列出类和方法，无法定制列举类型。而且默认选中排在第一位的类名，查询方法时很不方便。\nCommand-T不支持此功能。\n我的选择 FuzzyFinder是该类扩展里的老前辈，不过早已不维护，功能上不比其它几个出彩。Command-T虽然在文件索引速度上表现最好，但是优势并不很明显，而且支持功能最少。所以排除这两个。\n在最常用的三个功能上，CtrlP的综合表现是最均衡的，所以留下它。Unite本身是一种统一的交互方式和界面，很多扩展（source）可以实现五花八门的功能，像unite-outline虽然在Buffer Tag上表现不佳，对于Markdown和Vim文档还是很有用的。\nUpdate: 2016-02-01 FZF: 又一个文件模糊查询工具\n","permalink":"http://0x3f.org/posts/ctrlp-vs-unite-vs-command-t-vs-fuzzyfinder/","summary":"\u003ch2 id=\"简述\"\u003e简述\u003c/h2\u003e\n\u003cp\u003eSublime在文件打开速度上的表现很惊艳，Vim有几个扩展可以实现类似功能，本文对这些扩展做个对比。\u003c/p\u003e\n\u003cp\u003e虽然每个扩展都或多或少地实现了一些功能，我个人用得最多的也就文件、Tag、Buffer Tag的模糊查找这三个，像MRU、buffer之类的查找不觉得有多大用处，所以提高工作效率的工具一定是在热度环节有很好表现，其余偏门功能可以交给插件实现，在这点上CtrlP和Unite做得很好。所以下面针对最常用的这三个功能做下对比，更多功能的对比见下表：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/FhDLWLYr/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"文件模糊查找\"\u003e文件模糊查找\u003c/h2\u003e\n\u003cp\u003eCommand-T的文件索引速度最快，各方面在这几个扩展中的表现都是最好的。\u003c/p\u003e\n\u003cp\u003eCtrlP默认使用VIM自建的globpath()，需要手工配置使用\u003ca href=\"https://github.com/ggreer/the_silver_searcher\"\u003eag\u003c/a\u003e以获取更快的速度，据说使用find命令效率更高，实际感觉和ag差别不大。\u003c/p\u003e\n\u003cp\u003eUnite也需要手工设置使用ag，而且可以实现异步索引，在这一点的体验上好于前两个，但是在模糊匹配的排序上表现不好，比如输入“php”，当然希望“/etc/php.ini”这样的结果排在“/home/peter/host/tmp.txt”前面，实际往往不是这样，Unite的几个sorter里，数rank的排序结果最接近于这个要求，但是表现仍然不如前两个。\u003c/p\u003e\n\u003ch2 id=\"tag模糊查找\"\u003eTag模糊查找\u003c/h2\u003e\n\u003cp\u003e三个扩展都是通过ctags实现，虽然Unite的排序问题仍然存在，对于Tag这么简短的东西，问题不大。\u003c/p\u003e\n\u003ch2 id=\"buffer-tag模糊查找\"\u003eBuffer Tag模糊查找\u003c/h2\u003e\n\u003cp\u003eCtrlP的表现是最好的。\u003c/p\u003e\n\u003cp\u003eUnite需要通过unite-outline这个source实现，但是只能列出类和方法，无法定制列举类型。而且默认选中排在第一位的类名，查询方法时很不方便。\u003c/p\u003e\n\u003cp\u003eCommand-T不支持此功能。\u003c/p\u003e\n\u003ch2 id=\"我的选择\"\u003e我的选择\u003c/h2\u003e\n\u003cp\u003eFuzzyFinder是该类扩展里的老前辈，不过早已不维护，功能上不比其它几个出彩。Command-T虽然在文件索引速度上表现最好，但是优势并不很明显，而且支持功能最少。所以排除这两个。\u003c/p\u003e\n\u003cp\u003e在最常用的三个功能上，CtrlP的综合表现是最均衡的，所以留下它。Unite本身是一种统一的交互方式和界面，很多扩展（source）可以实现五花八门的功能，像unite-outline虽然在Buffer Tag上表现不佳，对于Markdown和Vim文档还是很有用的。\u003c/p\u003e\n\u003ch2 id=\"update-2016-02-01\"\u003eUpdate: 2016-02-01\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"/post/fzf-yet-another-fuzzy-finder/\"\u003eFZF: 又一个文件模糊查询工具\u003c/a\u003e\u003c/p\u003e","title":"CtrlP vs Unite vs Command-T vs FuzzyFinder"},{"content":"相对Sublime的Package Control，VAM安装和卸载扩展的操作很烦琐。以下脚本在安装完扩展后自动注册，无须手工添加到vimrc，另外增加命令:UninstallAddons，从注册表中删除扩展。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 set runtimepath+=~/.vim/addons/vim-addon-manager let active_addons = [] let s:vamRegistryFile = expand(\u0026#39;~\u0026#39;).\u0026#39;/.vim/vam_registry\u0026#39; if filereadable(s:vamRegistryFile) let active_addons += readfile(s:vamRegistryFile) endif call vam#ActivateAddons(active_addons) \u0026#34; Addon post-install hook. fun! MyAddonPostActivateHook(info, repository, pluginDir, opts) if filereadable(s:vamRegistryFile) let regLines = readfile(s:vamRegistryFile) call add(regLines, a:repository.name) call sort(regLines) call uniq(regLines) else let regLines = [a:repository.name] endif call writefile(regLines, s:vamRegistryFile) endfun let g:vim_addon_manager.post_install_hook_functions = [\u0026#39;MyAddonPostActivateHook\u0026#39;] \u0026#34; Complete the addon name. fun! MyDoActivatedAddonsCompete(...) let fullList = keys(g:vim_addon_manager.activated_plugins) call filter(fullList, \u0026#39;v:val =~ \u0026#34;.*\u0026#39;.a:1.\u0026#39;.*\u0026#34;\u0026#39;) return fullList endfun \u0026#34; Remove records of addons from the registry. fun! MyUninstallAddons(...) if filereadable(s:vamRegistryFile) let regLines = readfile(s:vamRegistryFile) else echo \u0026#34;Registry is empty.\u0026#34; return endif for addonName in a:000 let idx = index(regLines, addonName) if idx \u0026gt;= 0 call remove(regLines, idx) echo addonName.\u0026#39; is removed from the registry.\u0026#39; else echo addonName.\u0026#39; cannot be found in the registry.\u0026#39; endif endfor call writefile(regLines, s:vamRegistryFile) endfun command! -complete=customlist,MyDoActivatedAddonsCompete -nargs=* UninstallAddons :call MyUninstallAddons(\u0026lt;f-args\u0026gt;) ","permalink":"http://0x3f.org/posts/simplify-vim-addon-installation-issues/","summary":"\u003cp\u003e相对Sublime的Package Control，VAM安装和卸载扩展的操作很烦琐。以下脚本在安装完扩展后自动注册，无须手工添加到vimrc，另外增加命令:UninstallAddons，从注册表中删除扩展。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003eruntimepath\u003c/span\u003e\u003cspan class=\"p\"\u003e+=~\u003c/span\u003e\u003cspan class=\"sr\"\u003e/.vim/\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddons\u003c/span\u003e/\u003cspan class=\"nx\"\u003evim\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddon\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003emanager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eactive_addons\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;~\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;/.vim/vam_registry\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003efilereadable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eactive_addons\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"nx\"\u003ereadfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003evam\u003c/span\u003e#\u003cspan class=\"nx\"\u003eActivateAddons\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eactive_addons\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; Addon post-install hook.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efun\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyAddonPostActivateHook\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erepository\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epluginDir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003efilereadable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ereadfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003erepository\u003c/span\u003e.\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003esort\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003euniq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e [\u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003erepository\u003c/span\u003e.\u003cspan class=\"nx\"\u003ename\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003ewritefile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eendfun\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003evim_addon_manager\u003c/span\u003e.\u003cspan class=\"nx\"\u003epost_install_hook_functions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e [\u003cspan class=\"s1\"\u003e\u0026#39;MyAddonPostActivateHook\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; Complete the addon name.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efun\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyDoActivatedAddonsCompete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e...\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003efullList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ekeys\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003evim_addon_manager\u003c/span\u003e.\u003cspan class=\"nx\"\u003eactivated_plugins\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efullList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;v:val =~ \u0026#34;.*\u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"m\"\u003e1\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;.*\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003efullList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eendfun\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; Remove records of addons from the registry.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efun\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyUninstallAddons\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e...\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003efilereadable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ereadfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Registry is empty.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddonName\u003c/span\u003e \u003cspan class=\"nx\"\u003ein\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"m\"\u003e000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eidx\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddonName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eidx\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eremove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eecho\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddonName\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39; is removed from the registry.\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eecho\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddonName\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39; cannot be found in the registry.\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eendfor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003ewritefile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eregLines\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e:\u003cspan class=\"nx\"\u003evamRegistryFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eendfun\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003ecustomlist\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003eMyDoActivatedAddonsCompete\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003enargs\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e* \u003cspan class=\"nx\"\u003eUninstallAddons\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyUninstallAddons\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"简化Vim Addons Manager安装扩展的操作"},{"content":"BiuBiu BiuBiu is an extension for Google Chrome Browser which intends to make life easier for debugging and profiling.\nFor now, it only blocks AJAX requests made by JQuery, more features may be added in the future.\nFeatures Toggle to enable or disable BiuBiu. Block requests made by JQuery by URL. Author Donie Leigh \u0026lt;donie.leigh at gmail.com\u0026gt; Links Project: https://github.com/xbot/chrome-biubiu FAQ \u0026ndash; \u0026ndash; Change Log version 1.0.1 (2015-12-31)\nFix the complaining when there is no jQuery or jQuery.cookie.js loaded in the injected page. version 1.0.0 (2015-12-30)\nInitial release. ","permalink":"http://0x3f.org/posts/chrome-extension-biubiu/","summary":"\u003ch1 id=\"biubiu\"\u003eBiuBiu\u003c/h1\u003e\n\u003cp\u003e\u003cstrong\u003eBiuBiu\u003c/strong\u003e is an extension for Google Chrome Browser which intends to make life easier for debugging and profiling.\u003c/p\u003e\n\u003cp\u003eFor now, it only blocks AJAX requests made by JQuery, more features may be added in the future.\u003c/p\u003e\n\u003ch2 id=\"features\"\u003eFeatures\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eToggle to enable or disable BiuBiu.\u003c/li\u003e\n\u003cli\u003eBlock requests made by JQuery by URL.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"author\"\u003eAuthor\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eDonie Leigh \u0026lt;donie.leigh at gmail.com\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"links\"\u003eLinks\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eProject:      \u003ca href=\"https://github.com/xbot/chrome-biubiu\"\u003ehttps://github.com/xbot/chrome-biubiu\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"faq\"\u003eFAQ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u0026ndash;\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u0026ndash;\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"change-log\"\u003eChange Log\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eversion 1.0.1 (2015-12-31)\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFix the complaining when there is no jQuery or jQuery.cookie.js loaded in the injected page.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eversion 1.0.0 (2015-12-30)\u003c/strong\u003e\u003c/p\u003e","title":"BiuBiu: A Chrome Extension Blocking AJAX Requests"},{"content":"\n读这本书，用了一年时间。前面读《通鉴》，用了四年，平均一年五本书的节奏，读尽相斫书的伟大理想不知道这辈子能不能实现了。汉以后的书都好读，也不一定。\n总结一下，主要有两个心得吧。一个是梳理了一下春秋的脉络，把以前知道的片断都连了起来，抓住“蛮夷与戎狄交，中国不绝若线”的大背景，整个春秋时代大家都忙啥呢就清楚了，然后分成三段看，齐桓始霸、晋楚争霸、吴越争霸，比从五巨头切入清晰。第二个是加深了对礼乐文化的认识，贵族时代干啥都跟闹著玩似的，反映出我们屌丝的世界太低俗，整本《诗经》就是贵族圈的黑话，搞得我老想叉开去读《诗经原始》，剁手剁手，不然更看不完了。\n读《通鉴》算是用通史贯穿一下脉络，《左传》是第一本读完的断代史，本来想接著读《战国策》，看了一眼，文章写得太烂，又是纵横家的书，所以直接读《史记》，司马迁的小说写得还是不错的，迁儿哥，我来了！\n","permalink":"http://0x3f.org/posts/after-reading-zuo-zhuan/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/F6y8YsUg/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e读这本书，用了一年时间。前面读《通鉴》，用了四年，平均一年五本书的节奏，读尽相斫书的伟大理想不知道这辈子能不能实现了。汉以后的书都好读，也不一定。\u003c/p\u003e\n\u003cp\u003e总结一下，主要有两个心得吧。一个是梳理了一下春秋的脉络，把以前知道的片断都连了起来，抓住“蛮夷与戎狄交，中国不绝若线”的大背景，整个春秋时代大家都忙啥呢就清楚了，然后分成三段看，齐桓始霸、晋楚争霸、吴越争霸，比从五巨头切入清晰。第二个是加深了对礼乐文化的认识，贵族时代干啥都跟闹著玩似的，反映出我们屌丝的世界太低俗，整本《诗经》就是贵族圈的黑话，搞得我老想叉开去读《诗经原始》，剁手剁手，不然更看不完了。\u003c/p\u003e\n\u003cp\u003e读《通鉴》算是用通史贯穿一下脉络，《左传》是第一本读完的断代史，本来想接著读《战国策》，看了一眼，文章写得太烂，又是纵横家的书，所以直接读《史记》，司马迁的小说写得还是不错的，迁儿哥，我来了！\u003c/p\u003e","title":"读完《春秋左传注》"},{"content":"行程 D1.AM 失落的匈奴 匈奴是中国统一后的第一个大敌，极盛时号称控弦四十万，以至于汉武帝穷高、文、景三代积蓄，鏖战数十年，延及元帝，郅支授首，才终于换来一句“犯强汉者，虽远必诛”。\n东汉招引外族入居内地，想同化并加以利用，至于魏晋，欺压各族，又不加防备。\n西晋初年，由封建制的复兴导致的八王之乱，纷纭十六年，耗尽了皇族势力。被压制已久的民族矛盾于是爆发，匈奴、鲜卑、羯、氐、羌五族先后建立十六个国家，混战一百三十多年，史称五胡十六国。\n其中，匈奴铁弗部赫连勃勃建立大夏国，横行秦晋，役民十万蒸土筑城，号统万城。蒸土就是在土中混入生石灰，然后浇水夯筑，所以城墙是白色的，当地人至今都叫白城子。筑城要求极为严格，工程验收人以铁锥刺墙，刺入一寸杀筑者，尸体填入城墙，所以城墙极为坚固，是夯土建筑的巅峰之作。后来北魏太武帝拓跋焘灭夏入城，说“统驭万邦，在德不在险”。\n统万城遗址在陕西靖边。我喜欢去这种没有被过度商业化开发的地方，再过几年，也许就再也见不到这种荒草孤城的景象了。\n早上四点火车到站，车站门口有很多黑车，会漫天要价，事先做好功课就不会被宰，议定一百五，要说明白包往返，到地方等两个小时。\n路上停车吃洋芋擦擦，就是炒土豆丝……\n火车站到统万城大概三十公里，所以不会用太长时间，五点多到的时候，天还没有亮，这个时候没人收费，可以直接开进去。\n天色微亮，从停车场走向统万城还是条土路。\n遗址正在进行小规模的修复。\n城墩填充的外表被刻画成砖的样子，而夯土建筑的轮廓应该是一层一层的。\n像这样：\n走在质地坚硬的城墙上，可以想象当年它曾是怎样的坚不可摧。\n凸出的城墩和城墙形成有纵深的防御体系，可以分割敌人的阵形，将攻城者置于被三面夹击的死地。残存的城墙尚且这么高，不知道当年是如何雄伟的一座城！\n荒原晨露，日出统万。\n沿着小路走向城中的高台，沙深露重，很不好走。\n土墩离外城城门不远，可能是内城的一部分。高处的洞里，栖满了野鸽子。\n城的中部，据说是宫殿遗址。\n城北一处正在发掘的现场。\n北角的城墩，淹没在一望无际的荒草中。\n我在这里休息，读完了《晋书·赫连勃勃载记》。\n东角的城墩已经破坏得快消失了。\n回望城内。\n东南城墙已经快消失在荒草中了。\n南角墩曾被挖做窑洞。\n只有西角残存的遗迹最完整。\n因为去得早，而且遗址少有人去，所以整个早上只有我一个人，不紧不慢地走遍全城，用了三个小时，好在司机没有催我，如果能带着帐篷来这里扎营，重读通鉴永嘉南渡后三百年的烽火狼烟，一定很刺激，不过可能再也没有机会了。\nD1.PM 龙洲丹霞（波浪谷） 从统万城出来，时间还很早，上车直奔龙洲丹霞，车上议价，往返加等待，100￥。\n路上还有一段长城的遗迹，只剩下垄起的一条痕迹，可能是汉长城。\n景区已经修了观景台和公路，不过还没有收费。\n看这个就知道为什么叫波浪谷了。\n下面是深沟，岩石表面是风化的沙土，走在上面很惊险。\n靖边有石油，能看到远方油井喷出的火。\n其它地方见到的丹霞都是在地上的，这里是在地下，要从公路边的野路下去，所以找个知道路口在哪的司机很重要。\n有的小路不好走，只能手脚屁股并用。\n下到谷底。\n很美，真的很美。\n中间有一段很窄，一只脚都插不下。\n像什么，我当时自然地想到了大地的菊花……\n下面这一段更难走，顺着沟再往前是悬崖，只能从左手边的崖壁上绕过去。\n这段很危险，旁边就是悬崖，石头风化严重，我爬得很慢、很纠结。\n过了这段就好了，前面谷底别有洞天。\n谷里的水是从这个谷口里流出来的，水源是人工的，源头有只死猫，恶心死我了，因为溯源前用溪水洗了手，还挺凉。\n前面这个山包就是传说中的土匪窝，山体已经被挖空了，在前朝是土匪的藏身之地。\n谷底再多些草和野花就好了。\n水流经过的地方倒是水草丰茂。\n土匪窝下的人工湖可以坐船。\n从土匪窝旁的土路上到公路路口就很容易了，在路口吃了碗荞麦凉粉，挺好吃的。\n波浪谷不大，不过确实很漂亮，据说雨后初晴时来更好看，丹霞会呈现通红的颜色。由于野路不好走，而且我慢慢玩儿、拍照多，用了大概三个小时。\n大概下午两三点的样子，时间还早，所以让司机把我拉到县城里的电影院，看了场《猩球崛起2》，小县城因为有石油，居然就可以看3D，而且是眼镜夹片，真是我大四眼党的福音，比3D眼镜舒服多了。只是小县城的影院不打折，于是看了自《阿凡达》以来最贵的电影。\n看完电影，步行去之前司机推荐的“乔沟湾老婆风干羊肉剁荞面”馆吃剁荞面（23￥），离电影院不远。然后就酱紫了：\n没想到吃面可以这么铺张，不知道从哪开始发动，恬着脸问了服务员，吃得好爽，也很撑。\n出门边散步边打车，时间还早，慢慢讲价，这小县城的出租车死贵，到火车站没多远，要价20￥，后来终于找到一个15￥的。\nD2.AM 晋祠 一夜火车，早上4点到太原，在车站门口等804路公交到晋祠，大概七点多到的。\n相机没电了，只拍了这一张。\n剩下的只能用手机拍了，效果很差。\n李世民和其功臣塑像。李唐以国号始自周成王弟叔虞所封的唐国，所以大修晋祠。\n难老泉，就是奔它来的。\n从晋祠出来大概十一点，吃完饭坐公交到山西博物馆。\nD2.PM 山西省博物馆 博物馆最能看出一个地方的底蕴。山西省博在国内算是一流的，不可不看。\n山西省博东西很多，走马观花也没看完，到闭馆时还有一个展厅没看。\n出门打车奔火车站，差一点没赶上高铁。\n费用 火车：北京到靖边215￥，靖边到太原114.5￥，太原到北京197￥\n包车：靖边250￥\n打车：靖边县城到火车站15￥，山西省博到火车南站35￥\n公交：太原火车站到晋祠2.5￥，晋祠到山西省博2.5￥\n门票：晋祠75￥\n导游：山西省博自动讲解器10￥\n旅游保险：3￥\n","permalink":"http://0x3f.org/posts/a-trip-to-tongwan-city/","summary":"\u003ch2 id=\"行程\"\u003e行程\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvkFOn/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"d1am-失落的匈奴\"\u003eD1.AM 失落的匈奴\u003c/h2\u003e\n\u003cp\u003e匈奴是中国统一后的第一个大敌，极盛时号称控弦四十万，以至于汉武帝穷高、文、景三代积蓄，鏖战数十年，延及元帝，郅支授首，才终于换来一句“犯强汉者，虽远必诛”。\u003c/p\u003e\n\u003cp\u003e东汉招引外族入居内地，想同化并加以利用，至于魏晋，欺压各族，又不加防备。\u003c/p\u003e\n\u003cp\u003e西晋初年，由封建制的复兴导致的八王之乱，纷纭十六年，耗尽了皇族势力。被压制已久的民族矛盾于是爆发，匈奴、鲜卑、羯、氐、羌五族先后建立十六个国家，混战一百三十多年，史称五胡十六国。\u003c/p\u003e\n\u003cp\u003e其中，匈奴铁弗部赫连勃勃建立大夏国，横行秦晋，役民十万蒸土筑城，号统万城。蒸土就是在土中混入生石灰，然后浇水夯筑，所以城墙是白色的，当地人至今都叫白城子。筑城要求极为严格，工程验收人以铁锥刺墙，刺入一寸杀筑者，尸体填入城墙，所以城墙极为坚固，是夯土建筑的巅峰之作。后来北魏太武帝拓跋焘灭夏入城，说“统驭万邦，在德不在险”。\u003c/p\u003e\n\u003cp\u003e统万城遗址在陕西靖边。我喜欢去这种没有被过度商业化开发的地方，再过几年，也许就再也见不到这种荒草孤城的景象了。\u003c/p\u003e\n\u003cp\u003e早上四点火车到站，车站门口有很多黑车，会漫天要价，事先做好功课就不会被宰，议定一百五，要说明白包往返，到地方等两个小时。\u003c/p\u003e\n\u003cp\u003e路上停车吃洋芋擦擦，就是炒土豆丝……\u003c/p\u003e\n\u003cp\u003e火车站到统万城大概三十公里，所以不会用太长时间，五点多到的时候，天还没有亮，这个时候没人收费，可以直接开进去。\u003c/p\u003e\n\u003cp\u003e天色微亮，从停车场走向统万城还是条土路。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvl0fd/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e遗址正在进行小规模的修复。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvllZw/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城墩填充的外表被刻画成砖的样子，而夯土建筑的轮廓应该是一层一层的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvm6r1/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e像这样：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvldId/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e走在质地坚硬的城墙上，可以想象当年它曾是怎样的坚不可摧。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvkzhJ/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e凸出的城墩和城墙形成有纵深的防御体系，可以分割敌人的阵形，将攻城者置于被三面夹击的死地。残存的城墙尚且这么高，不知道当年是如何雄伟的一座城！\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvlIDl/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e荒原晨露，日出统万。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvlUtR/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e沿着小路走向城中的高台，沙深露重，很不好走。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvmi41/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e土墩离外城城门不远，可能是内城的一部分。高处的洞里，栖满了野鸽子。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvnx9o/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城的中部，据说是宫殿遗址。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvmz3v/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城北一处正在发掘的现场。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvn3QQ/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvneNw/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e北角的城墩，淹没在一望无际的荒草中。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvmaU4/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e我在这里休息，读完了《晋书·赫连勃勃载记》。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvmzWn/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e东角的城墩已经破坏得快消失了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvnUug/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e回望城内。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvnwvY/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e东南城墙已经快消失在荒草中了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvoha5/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e南角墩曾被挖做窑洞。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvo0as/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e只有西角残存的遗迹最完整。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvokDG/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e因为去得早，而且遗址少有人去，所以整个早上只有我一个人，不紧不慢地走遍全城，用了三个小时，好在司机没有催我，如果能带着帐篷来这里扎营，重读通鉴永嘉南渡后三百年的烽火狼烟，一定很刺激，不过可能再也没有机会了。\u003c/p\u003e\n\u003ch2 id=\"d1pm-龙洲丹霞波浪谷\"\u003eD1.PM 龙洲丹霞（波浪谷）\u003c/h2\u003e\n\u003cp\u003e从统万城出来，时间还很早，上车直奔龙洲丹霞，车上议价，往返加等待，100￥。\u003c/p\u003e\n\u003cp\u003e路上还有一段长城的遗迹，只剩下垄起的一条痕迹，可能是汉长城。\u003c/p\u003e\n\u003cp\u003e景区已经修了观景台和公路，不过还没有收费。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvowH1/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e看这个就知道为什么叫波浪谷了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvp1kO/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e下面是深沟，岩石表面是风化的沙土，走在上面很惊险。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvoS6y/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e靖边有石油，能看到远方油井喷出的火。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvqhys/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e其它地方见到的丹霞都是在地上的，这里是在地下，要从公路边的野路下去，所以找个知道路口在哪的司机很重要。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvq1Sq/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e有的小路不好走，只能手脚屁股并用。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvpYcF/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e下到谷底。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvqTNE/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e很美，真的很美。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ETlvqwT5/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"寻找失落的匈奴（201409）"},{"content":"行程 D1：上午，北京到怀来，土木之变战场遗址和鸡鸣驿；下午，宣化，清远楼、镇朔楼、时恩寺、辽代古墓壁画群。\nD2：草沿天路，张北野狐岭入，崇礼桦皮岭出。\nD1.AM 土木堡、鸡鸣驿 虽然起得很早，上京藏线也七点多了，赶上草原音乐节，出城的车巨多，在居庸关前面一段堵了半小时。\n到土木堡的时候已经十点多了，唯一的标志物就是这个路边的牌楼。\n里面是一片荒地，可能是土木之变的战场遗址。当年一战，二十万大军覆没，大明精锐尽丧，英宗北狩，瓦剌围城。可惜于谦，打赢了北京保卫战，却输掉了夺门之变。所以老子说：“持而盈之，不若其已。揣而群之，不可长保也。金玉盈室，莫能守也。富贵而骄，自遗咎也。功遂身退，天之道也。”，实在是金玉良言，不过知进易，知退难，几千年来，有几个张良？\n数百年的烽火狼烟，劫波度尽，谁能想到土木堡真正的被毁发生在本朝。路的另一边就是土木村，据说还有土木堡残存的遗迹，时间关系，没有去看。\n事实证明，沿G110奔鸡鸣驿不是个好选择，路况不太好，大货车很多，应该走高速的。\n城门被修成这样也是醉了，我头回见城门口横着一影壁墙的。\n反而从城内看城门，才有点儿意思。\n城门口的塑像，后面是驿城博物馆，主要介绍一下驿城的历史。\n城门要远看才有意境。\n城中主干道旁的戏台，其它地方还有两个，小小的驿城，修那么多戏台干嘛，规划有问题。\n多久没见这种风格的房子了。\n驿城署，现在是一家人的住处，可以进去参观，有人剪票，不过里面什么都没有。\n文昌宫，当年是驿城的学校。\n晴耕雨读，用的残体字……\n龙神庙里也有个戏台，得是多喜欢看戏！\n范家大院，庚子国变慈禧逃跑时曾在这住了一宿，现在也就剩这么一进。敢向全世界宣战的只有两个人，一个是天朝圣母皇太后，一个是巴格达迪。\n伏瞰驿城，怀疑原来真有这么大么，似乎和西夏黑水城和统万城差不多。\n坐在城头等日落。\n我怀疑这城墙是做旧，明朝以后，大多数城墙已经换用砖石结构，应该不会用这种过时的夯土建筑了吧。\n城外的鸡鸣山形态突兀，很显眼，如果是下雨的天气，真有“风雨如晦，鸡鸣不已”的感觉。\n城外不知道为什么弄了几截绿皮火车，很不搭。\nD1.PM 宣化古城、辽代古墓壁画 从鸡鸣驿出来奔宣化，三点多到，吃莜面窝窝，又叫栲姥姥，据说是当地特色，在电视上见过。蘸着羊肉臊子，味道很不错。\n清远楼和镇朔楼是宣化古城的标志性建筑，始建于明朝，气势恢宏，不可不看。\n清远楼是钟楼，在维修。\n镇朔楼是鼓楼，门票5￥，我包场。\n一层是个展厅，居然是介绍宣化当代发展的。\n二楼很空，只有一面大鼓。\n楼外就是时恩寺。\n殿里正在做法事，很多人，顺时针转圈，口宣佛号，净土宗的路子。\n就是奔这块匾来的。\n从寺里出来，开始下雨，赶紧钻到车里，奔辽代古墓壁画群，路经大新门，这是一排新修的城墙，今天已经逛够城墙了，时间也不够，于是继续赶路。\n穿过又窄又烂的土路，深入下八里村，就是辽代古墓壁画群，如果不是导航，谁能找到这鬼地方。时间已经是5点后，售票处没有人，墓道锁门了，只能看看园子，看售票处的标价，票价要50￥，比满城汉墓黑多了。不过这种地方游人很少，即便白天来，一个人逛古墓是一种什么样的体验？或者如何优雅的和古人神交？这是知乎看多了。\nD2 草沿天路 第二天，早五点起床，奔天路东线，从张北野狐岭入，崇礼桦皮岭出。\n现在这条路知名度越来越高，来的人很多，七点多到的时候，野狐岭入口的一段路，车就已经一辆接一辆了。路的两边越来越多地被开发旅游项目，中国旅游模式正在再次被复制，草原旅游就那么几项，烧烤、骑马、射箭、沙滩摩托，毫无新意，而且同质化严重。使天路出名的原生态自然风光，正在慢慢消退。\n费用 北京到宣化过路费：65￥\n鸡鸣驿门票：35￥\n镇朔楼门票：5￥\n宣化经天路回北京过路费：120￥\n加油：416￥\n","permalink":"http://0x3f.org/posts/a-drive-to-jimingyi-and-caoyantianlu/","summary":"\u003ch2 id=\"行程\"\u003e行程\u003c/h2\u003e\n\u003cp\u003eD1：上午，北京到怀来，土木之变战场遗址和鸡鸣驿；下午，宣化，清远楼、镇朔楼、时恩寺、辽代古墓壁画群。\u003c/p\u003e\n\u003cp\u003eD2：草沿天路，张北野狐岭入，崇礼桦皮岭出。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gAVZI/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"d1am-土木堡鸡鸣驿\"\u003eD1.AM 土木堡、鸡鸣驿\u003c/h2\u003e\n\u003cp\u003e虽然起得很早，上京藏线也七点多了，赶上草原音乐节，出城的车巨多，在居庸关前面一段堵了半小时。\u003c/p\u003e\n\u003cp\u003e到土木堡的时候已经十点多了，唯一的标志物就是这个路边的牌楼。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79NHiK/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e里面是一片荒地，可能是土木之变的战场遗址。当年一战，二十万大军覆没，大明精锐尽丧，英宗北狩，瓦剌围城。可惜于谦，打赢了北京保卫战，却输掉了夺门之变。所以老子说：“持而盈之，不若其已。揣而群之，不可长保也。金玉盈室，莫能守也。富贵而骄，自遗咎也。功遂身退，天之道也。”，实在是金玉良言，不过知进易，知退难，几千年来，有几个张良？\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79OfPX/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e数百年的烽火狼烟，劫波度尽，谁能想到土木堡真正的被毁发生在本朝。路的另一边就是土木村，据说还有土木堡残存的遗迹，时间关系，没有去看。\u003c/p\u003e\n\u003cp\u003e事实证明，沿G110奔鸡鸣驿不是个好选择，路况不太好，大货车很多，应该走高速的。\u003c/p\u003e\n\u003cp\u003e城门被修成这样也是醉了，我头回见城门口横着一影壁墙的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79OrNs/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e反而从城内看城门，才有点儿意思。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79RCp8/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城门口的塑像，后面是驿城博物馆，主要介绍一下驿城的历史。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79R7Ys/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城门要远看才有意境。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79Pjev/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城中主干道旁的戏台，其它地方还有两个，小小的驿城，修那么多戏台干嘛，规划有问题。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gBfya/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e多久没见这种风格的房子了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79PQg2/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e驿城署，现在是一家人的住处，可以进去参观，有人剪票，不过里面什么都没有。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79PEKD/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e文昌宫，当年是驿城的学校。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gBzkj/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gCefk/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gCA3P/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e晴耕雨读，用的残体字……\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79QVTE/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e龙神庙里也有个戏台，得是多喜欢看戏！\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gCYi2/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gCPGw/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gDp9U/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gDFPM/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gDWvv/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e范家大院，庚子国变慈禧逃跑时曾在这住了一宿，现在也就剩这么一进。敢向全世界宣战的只有两个人，一个是天朝圣母皇太后，一个是巴格达迪。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79Rc4U/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79WPrE/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79X088/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79Y5Dx/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e伏瞰驿城，怀疑原来真有这么大么，似乎和西夏黑水城和统万城差不多。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79RmQX/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e坐在城头等日落。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79VLis/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e我怀疑这城墙是做旧，明朝以后，大多数城墙已经换用砖石结构，应该不会用这种过时的夯土建筑了吧。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gER7v/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79VdOs/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城外的鸡鸣山形态突兀，很显眼，如果是下雨的天气，真有“风雨如晦，鸡鸣不已”的感觉。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79UKXP/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城外不知道为什么弄了几截绿皮火车，很不搭。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gEvHp/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gEU73/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"d1pm-宣化古城辽代古墓壁画\"\u003eD1.PM 宣化古城、辽代古墓壁画\u003c/h2\u003e\n\u003cp\u003e从鸡鸣驿出来奔宣化，三点多到，吃莜面窝窝，又叫栲姥姥，据说是当地特色，在电视上见过。蘸着羊肉臊子，味道很不错。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79W3Md/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e清远楼和镇朔楼是宣化古城的标志性建筑，始建于明朝，气势恢宏，不可不看。\u003c/p\u003e\n\u003cp\u003e清远楼是钟楼，在维修。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7gFvcj/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e镇朔楼是鼓楼，门票5￥，我包场。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79Yayj/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES7r6M4C/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79YOt6/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e一层是个展厅，居然是介绍宣化当代发展的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ES79YHMf/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e二楼很空，只有一面大鼓。\u003c/p\u003e","title":"自驾鸡鸣驿、草沿天路（201507）"},{"content":"当电影2那堆玩具已经成为神物，入个4的L级大黄蜂也未尝不是一种自我安慰。\n电影4的L级BB是3的同模异涂，但是阉割了武器背包，也就是说，这货没有声光效果！虽然3的背包很鸡肋，但是本著先看有没有，再看好不好的原则，4的玩具再一次见证了大缩水时代，我不敢想下一代会做成什么样。多么怀念那个连D级玩具都远超现在L级的时代。\n虽然电影2的U级和战刃是公认最经典的BB模具，退而求其次，3的模具也不错。人形很有层次感和曲线感。涂装较3有改进的地方，黑色部件的引入增强了色彩对比，比3的非灰即黄要好很多；最大的亮点是脸和触角的银柒涂装，3的灰脸看著像骷髅头，很恐怖。不过退步和进步一样明显，首先面具改成了V形描边，远不如之前的面部横描好看，现在一点都不想把面具拉下来了；此外，脚尖没有涂色也是个败笔。\n头雕的细节刻画不错，还是BB一贯的嗪奶嘴的骷髅头，面具的涂装也很差，银柒涂装是唯一能挽回点儿颜面的地方。\n手臂采用非对称设计，右手手炮，左手是个半假手，只有大拇指可动，什么都握不住，只是个摆设，看看当年电影2的D级的战刃，完全不能比啊。\n脚的设计很漂亮，不过虽然看起来支撑面很大，但由于踝关节不可左右摆动，导致接地性不好。\n所有BB模具都不能解决的大背包，现在似乎已经成为BB的特征了，好吧，即便接受这一点，这一整块棺材板好意思跟战刃的两级背板比么？\n关节的松紧度没有问题，可动性也不错，不过腰部不能转，头部只能左右转，不能抬头、低头。\n武器就是右手手炮，这货没有任何配件，如果说噱头的话，也就是手炮可以拉长和缩短，这点连D级玩具都不如啊。\n载具形态也不错，滚动性良好，可以摆出3的武装爆甲的形态，但是武装呢？！\n底部隐藏度一般，似乎电影系所有BB都有头无法隐藏的问题。\n最后放一张3的武装爆甲照，缅怀BB入宫前的峥嵘岁月。\n","permalink":"http://0x3f.org/posts/tf-m4-leader-class-bumble-bee/","summary":"\u003cp\u003e当电影2那堆玩具已经成为神物，入个4的L级大黄蜂也未尝不是一种自我安慰。\u003c/p\u003e\n\u003cp\u003e电影4的L级BB是3的同模异涂，但是阉割了武器背包，也就是说，这货没有声光效果！虽然3的背包很鸡肋，但是本著先看有没有，再看好不好的原则，4的玩具再一次见证了大缩水时代，我不敢想下一代会做成什么样。多么怀念那个连D级玩具都远超现在L级的时代。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ER427t8F/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e虽然电影2的U级和战刃是公认最经典的BB模具，退而求其次，3的模具也不错。人形很有层次感和曲线感。涂装较3有改进的地方，黑色部件的引入增强了色彩对比，比3的非灰即黄要好很多；最大的亮点是脸和触角的银柒涂装，3的灰脸看著像骷髅头，很恐怖。不过退步和进步一样明显，首先面具改成了V形描边，远不如之前的面部横描好看，现在一点都不想把面具拉下来了；此外，脚尖没有涂色也是个败笔。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ER428In6/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e头雕的细节刻画不错，还是BB一贯的嗪奶嘴的骷髅头，面具的涂装也很差，银柒涂装是唯一能挽回点儿颜面的地方。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ER428Z3G/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ER429Aqn/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e手臂采用非对称设计，右手手炮，左手是个半假手，只有大拇指可动，什么都握不住，只是个摆设，看看当年电影2的D级的战刃，完全不能比啊。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ER428D01/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e脚的设计很漂亮，不过虽然看起来支撑面很大，但由于踝关节不可左右摆动，导致接地性不好。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ER429gLn/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e所有BB模具都不能解决的大背包，现在似乎已经成为BB的特征了，好吧，即便接受这一点，这一整块棺材板好意思跟战刃的两级背板比么？\u003c/p\u003e\n\u003cp\u003e关节的松紧度没有问题，可动性也不错，不过腰部不能转，头部只能左右转，不能抬头、低头。\u003c/p\u003e\n\u003cp\u003e武器就是右手手炮，这货没有任何配件，如果说噱头的话，也就是手炮可以拉长和缩短，这点连D级玩具都不如啊。\u003c/p\u003e\n\u003cp\u003e载具形态也不错，滚动性良好，可以摆出3的武装爆甲的形态，但是武装呢？！\u003c/p\u003e\n\u003cp\u003e底部隐藏度一般，似乎电影系所有BB都有头无法隐藏的问题。\u003c/p\u003e\n\u003cp\u003e最后放一张3的武装爆甲照，缅怀BB入宫前的峥嵘岁月。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ER44HJDK/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"变形金刚：电影4领袖级大黄蜂"},{"content":"行程 D1：北京到白石山，爬山，到满城住宿。\nD2：看满城汉墓，回京。\nD1 白石山 原计划早上6点出发，该死的拖延症，收拾东西花了点时间，七点多才走。\n途径南六环、京石高速、廊涿高速、张石高速。易县以后进入山区，隧道又多又长，本着不超速、不随意变道、做中国好司机的原则，走得比较慢，十点多才到涞源。涞源出口很窄，堵了二十分钟。出高速到景区已经不远了，在东门停车场停好车。\n来前天气预报说有小雨，心说很好啊，我就喜欢下着小雨爬山，所以没带速干帽，结果是个闷热天儿，我去。\n十点四十，出发。我的艺名叫不逃票不舒服斯基，因为走正门太low了。不过逃票要早上四五点走野路，时间紧，任务重，还是low吧。头一天同程订的门票，比现买便宜十块，据说发表评价再退十块。坐摆渡车到祥云门，也可以坐索道。然后顺时针走环线。\n山里大部分路口都是局部路标，带张完整的路线图还是有必要的。\n我对所有以“传说”开头介绍的东西不感冒，总之这个塑像是环线的起点和终点。\n一开始就走下坡，沿着峡壁的栈道下到飞狐峡，这一线主要是峡谷半山的栈道，是全环线最好的一段，我喜欢峡谷。\n飞狐峡走的人少，多数时间太阳不直晒，风吹着，凉快。\n我喜欢峡谷。\n每个山谷都应该有一条河，可惜。\n逆风如解意，容易莫摧残。\n仙人晒靴。不喜欢这种附会的东西。\n太行之神。这货跟神有一毛钱关系么。\n好吧，这才是重点，玻璃栈道。一点儿都不吓银，而且很短，而且收费，看我的斯卡帕美不美。\n回望走过的栈道，敢问路在何方。\n过了玻璃栈道就是双雄石，好内涵的名字，剩下的路已经不多了，而且都是平路。\n猪八戒背媳妇儿。虽然附会，确实比较像，就是这媳妇儿砢碜了点儿。\n走一圈环线用了4个小时。刚下山，到停车场，毫无征兆的一场暴雨，这酸爽，山里的天气真是孩子脸。\n驱车奔满城，走高速要绕很远，于是奔S332，看地图只有一百多公里。结果又干了三个多小时，天落黑才到酒店。\n刚开始的一段路还可以。小公路在太行山里蜿蜒，重山夹路，车少，路况也不错，偶尔掠过几个石筑的村落，甚至有牧人和羊群镶嵌在陡峭的青山上，恍如隔世。\n中间一段路况很差，再往下走，人烟逐渐增多，更多的是成群结队的重卡，很耽误时间，有时候走着走着停了，还以为前面堵车了，哪知道这孙子站路中间嘘嘘呢，知道燕赵民风骠悍，没想到这么骠悍。省道真练技术。\nD2 满城汉墓 我喜欢破破烂烂的地方，满城汉墓早在我的怨念单里。汉墓十墓九空，唯独这个是极少没被盗过的之一，光这个墓的陪葬，撑起了整个河北省博物馆。另外墓主人很有名，中山靖王，汉景帝庶子，汉武帝异母兄，刘备号称的祖宗。平生三大爱好，喝酒、吃肉、叮叮当当造小人儿。《史记》载其有子百二十人，按照正态分布，女儿也得有百二十人，刘营长辛苦。\n景区大门，我喜欢人少的地方。头一天在同程上订好的园区门票、窦绾墓、刘胜墓的联票，比现买便宜十块，一个景点分段收费，旅游业非常黑。\n石像生和翁仲应该不是汉墓的原物。\n有索道，不过山不高，没必要。\n夫人窦绾墓在靖王墓北一百多米处，容积比靖王墓大，大概是靖王死在先，窦绾墓多施工了几年。\n墓门用砖砌墙，然后注入熔铁封死。倒这样的斗确实不容易。\n窦绾墓平面图。仿宫殿式布局，两个耳室一存车马，一存饮食。中室是客厅。侧室是带浴室的主卧。\n墓道里非常凉快，和外面完全两个世界。两千年前的人，先用火灼烧石壁，再用水激，最后用铁器凿掉碎石，这样的工艺也算是巧夺天工了。\n南耳室是车库。\n北耳室存放饮食。\n中室灰常大。\n渗水井和室内排水沟相连，组成很完善的排水系统。\n金缕玉衣，仿品。\n侧室，窦绾的金缕玉衣和传说中的长信宫灯原本停放在这里。\n靖王墓的容积虽然比窦绾墓小，不过规制似乎更大。中室有木瓦结构的建筑，卧室在中室正后方，卧室后甚至有回廊。\n中室内的木瓦建筑，象征宴会厅。\n南耳室，车库。\n北耳室，仓库。\n中室，宴会厅。\n后室回廊。\n后室，刘胜的金缕玉衣和传说中的错金博山炉原本停放在这里。\n费用 北京到白石山高速过路费：95￥\n白石山门票：140￥\n白石山停车费：20￥\n白石山摆渡车票：20￥×2\n满城汉墓门票：65￥\n满城汉墓停车费：10￥\n加油：233￥\n保定到北京高速过路费：75￥\n","permalink":"http://0x3f.org/posts/a-drive-to-baishi-mountain-and-a-kings-tomb-of-han/","summary":"\u003ch2 id=\"行程\"\u003e行程\u003c/h2\u003e\n\u003cp\u003eD1：北京到白石山，爬山，到满城住宿。\u003cbr\u003e\nD2：看满城汉墓，回京。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaPbLj/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"d1-白石山\"\u003eD1 白石山\u003c/h2\u003e\n\u003cp\u003e原计划早上6点出发，该死的拖延症，收拾东西花了点时间，七点多才走。\u003c/p\u003e\n\u003cp\u003e途径南六环、京石高速、廊涿高速、张石高速。易县以后进入山区，隧道又多又长，本着不超速、不随意变道、做中国好司机的原则，走得比较慢，十点多才到涞源。涞源出口很窄，堵了二十分钟。出高速到景区已经不远了，在东门停车场停好车。\u003c/p\u003e\n\u003cp\u003e来前天气预报说有小雨，心说很好啊，我就喜欢下着小雨爬山，所以没带速干帽，结果是个闷热天儿，我去。\u003c/p\u003e\n\u003cp\u003e十点四十，出发。我的艺名叫不逃票不舒服斯基，因为走正门太low了。不过逃票要早上四五点走野路，时间紧，任务重，还是low吧。头一天同程订的门票，比现买便宜十块，据说发表评价再退十块。坐摆渡车到祥云门，也可以坐索道。然后顺时针走环线。\u003c/p\u003e\n\u003cp\u003e山里大部分路口都是局部路标，带张完整的路线图还是有必要的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaP9T6/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e我对所有以“传说”开头介绍的东西不感冒，总之这个塑像是环线的起点和终点。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaPQq7/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e一开始就走下坡，沿着峡壁的栈道下到飞狐峡，这一线主要是峡谷半山的栈道，是全环线最好的一段，我喜欢峡谷。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaQQZj/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e飞狐峡走的人少，多数时间太阳不直晒，风吹着，凉快。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaRttP/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e我喜欢峡谷。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaRYSZ/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e每个山谷都应该有一条河，可惜。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaSCeW/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e逆风如解意，容易莫摧残。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaT6Td/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e仙人晒靴。不喜欢这种附会的东西。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaTCqU/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e太行之神。这货跟神有一毛钱关系么。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaULWh/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e好吧，这才是重点，玻璃栈道。一点儿都不吓银，而且很短，而且收费，看我的斯卡帕美不美。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaV9pl/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e回望走过的栈道，敢问路在何方。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaVIyf/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e过了玻璃栈道就是双雄石，好内涵的名字，剩下的路已经不多了，而且都是平路。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaW6zQ/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e猪八戒背媳妇儿。虽然附会，确实比较像，就是这媳妇儿砢碜了点儿。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaWrFX/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e走一圈环线用了4个小时。刚下山，到停车场，毫无征兆的一场暴雨，这酸爽，山里的天气真是孩子脸。\u003c/p\u003e\n\u003cp\u003e驱车奔满城，走高速要绕很远，于是奔S332，看地图只有一百多公里。结果又干了三个多小时，天落黑才到酒店。\u003c/p\u003e\n\u003cp\u003e刚开始的一段路还可以。小公路在太行山里蜿蜒，重山夹路，车少，路况也不错，偶尔掠过几个石筑的村落，甚至有牧人和羊群镶嵌在陡峭的青山上，恍如隔世。\u003c/p\u003e\n\u003cp\u003e中间一段路况很差，再往下走，人烟逐渐增多，更多的是成群结队的重卡，很耽误时间，有时候走着走着停了，还以为前面堵车了，哪知道这孙子站路中间嘘嘘呢，知道燕赵民风骠悍，没想到这么骠悍。省道真练技术。\u003c/p\u003e\n\u003ch2 id=\"d2-满城汉墓\"\u003eD2 满城汉墓\u003c/h2\u003e\n\u003cp\u003e我喜欢破破烂烂的地方，满城汉墓早在我的怨念单里。汉墓十墓九空，唯独这个是极少没被盗过的之一，光这个墓的陪葬，撑起了整个河北省博物馆。另外墓主人很有名，中山靖王，汉景帝庶子，汉武帝异母兄，刘备号称的祖宗。平生三大爱好，喝酒、吃肉、叮叮当当造小人儿。《史记》载其有子百二十人，按照正态分布，女儿也得有百二十人，刘营长辛苦。\u003c/p\u003e\n\u003cp\u003e景区大门，我喜欢人少的地方。头一天在同程上订好的园区门票、窦绾墓、刘胜墓的联票，比现买便宜十块，一个景点分段收费，旅游业非常黑。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaXBGL/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e石像生和翁仲应该不是汉墓的原物。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaYlwl/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaZDpx/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e有索道，不过山不高，没必要。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZaZRzF/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e夫人窦绾墓在靖王墓北一百多米处，容积比靖王墓大，大概是靖王死在先，窦绾墓多施工了几年。\u003c/p\u003e\n\u003cp\u003e墓门用砖砌墙，然后注入熔铁封死。倒这样的斗确实不容易。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb03TW/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e窦绾墓平面图。仿宫殿式布局，两个耳室一存车马，一存饮食。中室是客厅。侧室是带浴室的主卧。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb1g5N/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e墓道里非常凉快，和外面完全两个世界。两千年前的人，先用火灼烧石壁，再用水激，最后用铁器凿掉碎石，这样的工艺也算是巧夺天工了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb0yci/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb1xhm/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e南耳室是车库。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb1hLc/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e北耳室存放饮食。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb1D6u/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e中室灰常大。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb2wJB/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e渗水井和室内排水沟相连，组成很完善的排水系统。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb2QMD/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e金缕玉衣，仿品。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb2Xv0/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e侧室，窦绾的金缕玉衣和传说中的长信宫灯原本停放在这里。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EPZb4Cio/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"自驾白石山、满城汉墓（201507）"},{"content":"测试环境：\nCPU: Intel(R) Core(TM) i5-3470 CPU @ 3.20GHz MEM: 4G OS: Archlinux 64bit 测试命令：\n1 ab -c 200 -n 200000 -k http://127.0.0.1/test NGINX + PHP-FPM Requests per second: 16240.50 [#/sec] (mean)\nTime per request: 12.315 [ms] (mean)\nNGINX + Swoole Requests per second: 31284.57 [#/sec] (mean)\nTime per request: 6.393 [ms] (mean)\nSwoole Requests per second: 99926.55 [#/sec] (mean)\nTime per request: 2.001 [ms] (mean)\n结论 对一个最简单的PHP脚本做测试，排除业务逻辑的消耗的影响。Swoole威武。\n","permalink":"http://0x3f.org/posts/swoole-vs-php-fpm/","summary":"\u003cp\u003e测试环境：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCPU: Intel(R) Core(TM) i5-3470 CPU @ 3.20GHz\u003c/li\u003e\n\u003cli\u003eMEM: 4G\u003c/li\u003e\n\u003cli\u003eOS:  Archlinux 64bit\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e测试命令：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eab -c \u003cspan class=\"m\"\u003e200\u003c/span\u003e -n \u003cspan class=\"m\"\u003e200000\u003c/span\u003e -k http://127.0.0.1/test\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"nginx--php-fpm\"\u003eNGINX + PHP-FPM\u003c/h2\u003e\n\u003cp\u003eRequests per second:    16240.50 [#/sec] (mean)\u003cbr\u003e\nTime per request:       12.315 [ms] (mean)\u003c/p\u003e\n\u003ch2 id=\"nginx--swoole\"\u003eNGINX + Swoole\u003c/h2\u003e\n\u003cp\u003eRequests per second:    31284.57 [#/sec] (mean)\u003cbr\u003e\nTime per request:       6.393 [ms] (mean)\u003c/p\u003e\n\u003ch2 id=\"swoole\"\u003eSwoole\u003c/h2\u003e\n\u003cp\u003eRequests per second:    99926.55 [#/sec] (mean)\u003cbr\u003e\nTime per request:       2.001 [ms] (mean)\u003c/p\u003e\n\u003ch2 id=\"结论\"\u003e结论\u003c/h2\u003e\n\u003cp\u003e对一个最简单的PHP脚本做测试，排除业务逻辑的消耗的影响。Swoole威武。\u003c/p\u003e","title":"Swoole与PHP-FPM性能对比"},{"content":"嘴炮OP这个模具应该是电影系列十年来最好的模具，经典到一再复刻和改模，和原色双刀、DA28一起都属同模或改模版本。相比之下，这款模具在涂装上胜过同模其它版本，电镀件和银柒使人形、车形在色彩上对比鲜明，和银色飞翼搭配很自然。\n人形正面比例协调，领袖级的大小更显霸气。腰部和小腿部的两对轮子太累赘，腰部的轮子完全可以设计成收纳到腰里。\n涂装上，除红蓝主色调外，其它位置主要填充银色金属柒，对比鲜明，很有质感。\n上下肢都采用齿轮关节，关节的松紧度方面表现很好。除了腰部不能转动，四肢和头部的转动辐度都很大。\n作为一款经典的L级模具，手居然是假手，很不可理解。\n踝关节可以左右摆动，所以脚的接地性没有问题，不过全身最大的两块电镀件居然踩在脚底板当鞋垫，真是无语了。\n这款模具之所以叫嘴炮OP，就是因为有嘴有炮。一般OP的模具的头雕都是带口罩的，而这款是露嘴的。其实我更喜欢带口罩的形象，机器人要嘴没什么用，尤其像大黄蜂那种嗪奶头的嘴，见一次吐一次。\n头雕很精细，细节的刻画和涂装都很到位，只是这长了鳃的OP是要配合天火马甲搞个海陆空三栖么。\n背包不算大，不过还是过于突兀，尤其是这交叉的造型个人觉得很难看。\n炮是由两个油箱组合变形而成，虽然炮形比较奇葩，但是构思确实很新颖。\n受G1动画的影响，我觉得朴实无华的平头卡车更能显现OP的威严，电影版的狗头卡车多少有点浮夸。不过从还原电影的角度来说，这款模具的载具形态还是很不错的。尤其是两部分电镀件，遮光板和进气面板，非常闪亮。白色描边的火焰纹的刻画也很到位。\n由于车轮没有卡扣固定，并且有的车轮不能著地，所以载具形态的滚动性不好。\nL级模具的噱头一般是声光效果。这款模具有三个，一是人形状态下，扳下腹部机关，胸甲耸起的同时，胸部和眼睛会亮，OP喊：“I am Optimus Prime !”（其实不如喊那句最经典的：“Autobots, transform and roll out !”，向G1致敬会让很多人丧失抵抗力……）；第二个是人形变车形时，上半身和下半身分离时，发出叽叽咔叽的变形音效；第三个是在车形状态下，扳动车头背部的开关，发出机枪扫射的声音。平心而论，这款模具的声光效果设计得还是不错的，人形、变形、车形三种状态都有照顾，不像变3的L级大黄蜂，所有声光效果都在那个巨大无比的鸡肋背包上。\n把玩性方面，由于体形较大，变形复杂度高，把玩起来流畅度并不高，不过这是L级模具的通病。\n此外，KO版的普遍问题都有，像左遮光板卡不紧、胸甲滑动不流畅。\n总之，这款KO双刀电镀嘴炮OP在模具、涂装、做工、用料等各方面的表现都不错，非神物而神物，压箱底还是可以胜任的。\n","permalink":"http://0x3f.org/posts/transformers-optimus-prime-ko-edition/","summary":"\u003cp\u003e嘴炮OP这个模具应该是电影系列十年来最好的模具，经典到一再复刻和改模，和原色双刀、DA28一起都属同模或改模版本。相比之下，这款模具在涂装上胜过同模其它版本，电镀件和银柒使人形、车形在色彩上对比鲜明，和银色飞翼搭配很自然。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EKm5Xn5y/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e人形正面比例协调，领袖级的大小更显霸气。腰部和小腿部的两对轮子太累赘，腰部的轮子完全可以设计成收纳到腰里。\u003c/p\u003e\n\u003cp\u003e涂装上，除红蓝主色调外，其它位置主要填充银色金属柒，对比鲜明，很有质感。\u003c/p\u003e\n\u003cp\u003e上下肢都采用齿轮关节，关节的松紧度方面表现很好。除了腰部不能转动，四肢和头部的转动辐度都很大。\u003c/p\u003e\n\u003cp\u003e作为一款经典的L级模具，手居然是假手，很不可理解。\u003c/p\u003e\n\u003cp\u003e踝关节可以左右摆动，所以脚的接地性没有问题，不过全身最大的两块电镀件居然踩在脚底板当鞋垫，真是无语了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EKmcV5LK/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这款模具之所以叫嘴炮OP，就是因为有嘴有炮。一般OP的模具的头雕都是带口罩的，而这款是露嘴的。其实我更喜欢带口罩的形象，机器人要嘴没什么用，尤其像大黄蜂那种嗪奶头的嘴，见一次吐一次。\u003c/p\u003e\n\u003cp\u003e头雕很精细，细节的刻画和涂装都很到位，只是这长了鳃的OP是要配合天火马甲搞个海陆空三栖么。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EKmdnv02/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e背包不算大，不过还是过于突兀，尤其是这交叉的造型个人觉得很难看。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EKmd8JC8/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e炮是由两个油箱组合变形而成，虽然炮形比较奇葩，但是构思确实很新颖。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EKm4Xluq/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e受G1动画的影响，我觉得朴实无华的平头卡车更能显现OP的威严，电影版的狗头卡车多少有点浮夸。不过从还原电影的角度来说，这款模具的载具形态还是很不错的。尤其是两部分电镀件，遮光板和进气面板，非常闪亮。白色描边的火焰纹的刻画也很到位。\u003c/p\u003e\n\u003cp\u003e由于车轮没有卡扣固定，并且有的车轮不能著地，所以载具形态的滚动性不好。\u003c/p\u003e\n\u003cp\u003eL级模具的噱头一般是声光效果。这款模具有三个，一是人形状态下，扳下腹部机关，胸甲耸起的同时，胸部和眼睛会亮，OP喊：“I am Optimus Prime !”（\u003cstrong\u003e其实不如喊那句最经典的：“Autobots, transform and roll out !”，向G1致敬会让很多人丧失抵抗力……\u003c/strong\u003e）；第二个是人形变车形时，上半身和下半身分离时，发出叽叽咔叽的变形音效；第三个是在车形状态下，扳动车头背部的开关，发出机枪扫射的声音。平心而论，这款模具的声光效果设计得还是不错的，人形、变形、车形三种状态都有照顾，不像变3的L级大黄蜂，所有声光效果都在那个巨大无比的鸡肋背包上。\u003c/p\u003e\n\u003cp\u003e把玩性方面，由于体形较大，变形复杂度高，把玩起来流畅度并不高，不过这是L级模具的通病。\u003c/p\u003e\n\u003cp\u003e此外，KO版的普遍问题都有，像左遮光板卡不紧、胸甲滑动不流畅。\u003c/p\u003e\n\u003cp\u003e总之，这款KO双刀电镀嘴炮OP在模具、涂装、做工、用料等各方面的表现都不错，非神物而神物，压箱底还是可以胜任的。\u003c/p\u003e","title":"变形金刚：KO电镀嘴炮OP"},{"content":"创建项目 在PHP源码目录下的ext目录下执行：\n1 ./ext_skel --extname=foobar 修改foobar/config.m4，移除以下三行前的dnl：\ndnl PHP_ARG_WITH(foobar, for foobar support,\ndnl Make sure that the comment is aligned:\ndnl [ \u0026ndash;with-foobar Include foobar support])\n编译与安装 在foobar目录下执行以下命令，生成configure脚本：\n1 /usr/bin/phpize 执行configure：\n1 ./configure --with-php-config=/usr/bin/php-config 编译安装：\n1 sudo make install 修改php.ini，启用扩展：\n1 extension=foobar.so ","permalink":"http://0x3f.org/posts/create-php-extension-skeleton/","summary":"\u003ch2 id=\"创建项目\"\u003e创建项目\u003c/h2\u003e\n\u003cp\u003e在PHP源码目录下的ext目录下执行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eext_skel\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eextname\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003efoobar\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e修改foobar/config.m4，移除以下三行前的dnl：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ednl PHP_ARG_WITH(foobar, for foobar support,\u003cbr\u003e\ndnl Make sure that the comment is aligned:\u003cbr\u003e\ndnl [  \u0026ndash;with-foobar             Include foobar support])\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"编译与安装\"\u003e编译与安装\u003c/h2\u003e\n\u003cp\u003e在foobar目录下执行以下命令，生成configure脚本：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/bin/phpize\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e执行configure：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure --with-php-config\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/bin/php-config\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e编译安装：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo make install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e修改php.ini，启用扩展：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eextension\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003efoobar.so\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"PHP扩展框架的创建"},{"content":"上下文的实现和应用 上下文包含流的选项和流的参数两部分内容。\n1 php_stream_context *php_stream_context_alloc(void); 流的选项是一系列键值对。\n1 2 3 int php_stream_context_set_option(php_stream_context *context, const char *wrappername, const char *optionname, zval *optionvalue); int php_stream_context_get_option(php_stream_context *context, const char *wrappername, const char *optionname, zval ***optionvalue); 流的参数目前只实现对流的事件的回调，php_stream_context-\u0026gt;notifier存储如下结构：\n1 2 3 4 5 6 7 typedef struct { php_stream_notification_func func; void (*dtor)(php_stream_notifier *notifier); void *ptr; int mask; size_t progress, progress_max; } php_stream_notifier; 回调函数的原型为：\n1 2 3 4 5 typedef void (*php_stream_notification_func)(php_stream_context *context, int notifycode, int severity, char *xmsg, int xcode, size_t bytes_sofar, size_t bytes_max, void * ptr TSRMLS_DC); notifycode包含如下：\nPHP_STREAM_NOTIFY_RESOLVE：主机名解析完成 PHP_STREAM_NOTIFY_CONNECT：socket连接建立 PHP_STREAM_NOTIFY_AUTH_REQUIRED：需要验证 PHP_STREAM_NOTIFY_MIME_TYPE_IS：远程资源的MIME-Type可用 PHP_STREAM_NOTIFY_FILE_SIZE_IS：远程资源的大小可用 PHP_STREAM_NOTIFY_REDIRECTED：原始地址被跳转 PHP_STREAM_NOTIFY_PROGRESS：php_stream_notifier-\u0026gt;progress和progress_max（可能的）已更新 PHP_STREAM_NOTIFY_COMPLETED：流中已无可用数据 PHP_STREAM_NOTIFY_FAILURE：请求失败 PHP_STREAM_NOTIFY_AUTH_RESULT：远程验证已完成，并且可能是成功的 severity包含如下：\nPHP_STREAM_NOTIFY_SEVERITY_INFO PHP_STREAM_NOTIFY_SEVERITY_WARN PHP_STREAM_NOTIFY_SEVERITY_ERR php_stream_notifier-\u0026gt;ptr用于存储附加数据，如果该数据需要手工回收，需指定php_stream_notifier-\u0026gt;dtor。\nphp_stream_notifier-\u0026gt;mask如果被赋值severity，其它severity的事件将不会触发回调函数。\n过滤器的实现和应用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 #include \u0026#34;ext/standard/php_string.h\u0026#34; typedef struct { char is_persistent; char *from_chars; char *to_chars; int tr_len; } php_donie_filter_data; static php_stream_filter_status_t php_donie_stream_filter( php_stream *stream, php_stream_filter *thisfilter, php_stream_bucket_brigade *buckets_in, php_stream_bucket_brigade *buckets_out, size_t *bytes_consumed, int flags TSRMLS_DC ) { php_donie_filter_data *data = thisfilter-\u0026gt;abstract; php_stream_bucket *bucket; size_t consumed = 0; while(buckets_in-\u0026gt;head) { bucket = php_stream_bucket_make_writeable(buckets_in-\u0026gt;head TSRMLS_CC); php_strtr(bucket-\u0026gt;buf, bucket-\u0026gt;buflen, data-\u0026gt;from_chars, data-\u0026gt;to_chars, data-\u0026gt;tr_len); consumed += bucket-\u0026gt;buflen; php_stream_bucket_append(buckets_out, bucket TSRMLS_CC); } if (bytes_consumed) { *bytes_consumed = consumed; } return PSFS_PASS_ON; } static void php_donie_stream_filter_dtor( php_stream_filter *thisfilter TSRMLS_DC ) { php_donie_filter_data *data = thisfilter-\u0026gt;abstract; pefree(data, data-\u0026gt;is_persistent); } static php_stream_filter_ops php_donie_stream_filter_ops = { php_donie_stream_filter, php_donie_stream_filter_dtor, \u0026#34;donie.to_upper_case\u0026#34; }; static php_stream_filter *php_donie_stream_filter_create( const char *name, zval *param, int persistent TSRMLS_DC ) { php_donie_filter_data *data; data = pemalloc(sizeof(php_donie_filter_data), persistent); if (!data) { return NULL; } data-\u0026gt;is_persistent = persistent; data-\u0026gt;from_chars = \u0026#34;abcdefghijklmnopqrstuvwxyz\u0026#34;; data-\u0026gt;to_chars = \u0026#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34;; data-\u0026gt;tr_len = strlen(data-\u0026gt;from_chars); return php_stream_filter_alloc(\u0026amp;php_donie_stream_filter_ops, data, persistent); } static php_stream_filter_factory php_donie_stream_uppercase_factory = { php_donie_stream_filter_create }; PHP_MINIT_FUNCTION(donie) { /* register a filter */ php_stream_filter_register_factory(\u0026#34;donie.to_upper_case\u0026#34;, \u0026amp;php_donie_stream_uppercase_factory TSRMLS_CC); return SUCCESS; } PHP_MSHUTDOWN_FUNCTION(donie) { /* unregister the filter */ php_stream_filter_unregister_factory(\u0026#34;donie.to_upper_case\u0026#34; TSRMLS_CC); return SUCCESS; } 注册和注销 分别在MINIT和MSHUTDOWN函数中调用php_stream_filter_register_factory()和php_stream_filter_unregister_factory()注册和注销过滤器。\n过滤器的执行过程 当过滤器被调用时，调用方将使用php_donie_stream_filter_create()函数创建过滤器的实例。该函数在被执行时初始化过滤器的相关数据，并指定过滤器的相关操作。\n调用方然后将过滤器实例添加到对应的流的读过滤器链或写过滤器链中，当流中发生读或写的操作时，过滤器链将数据放到一或多个php_stream_bucket结构中，并传递给过滤器处理。\n业务逻辑 结构体php_donie_stream_filter_ops指定了过滤器的名称和相关业务逻辑。php_donie_stream_filter_ops-\u0026gt;php_donie_stream_filter_dtor是过滤器的析构函数。php_donie_stream_filter_ops-\u0026gt;php_donie_stream_filter是过滤器的主要业务逻辑。\n在php_donie_stream_filter()中，函数接收一个php_stream_bucket链表buckets_in，并将处理后的php_stream_bucket追加到链表buckets_out中输出。\nphp_stream_bucket_make_writeable()将一个bucket从链表中移除，如果必要，复制其内部缓冲数据，以获得对内容的写权限。此外，对bucket的相关操作还有：\n1 2 3 4 5 6 7 8 9 10 11 php_stream_bucket *php_stream_bucket_new(php_stream *stream, char *buf, size_t buflen, int own_buf, int buf_persistent TSRMLS_DC); int php_stream_bucket_split(php_stream_bucket *in, php_stream_bucket **left, php_stream_bucket **right, size_t length TSRMLS_DC); void php_stream_bucket_delref(php_stream_bucket *bucket TSRMLS_DC); void php_stream_bucket_addref(php_stream_bucket *bucket); void php_stream_bucket_prepend(php_stream_bucket_brigade *brigade, php_stream_bucket *bucket TSRMLS_DC); void php_stream_bucket_append(php_stream_bucket_brigade *brigade, php_stream_bucket *bucket TSRMLS_DC); void php_stream_bucket_unlink(php_stream_bucket *bucket TSRMLS_DC); 若过滤器已准备好输出的数据，返回PSFS_PASS_ON；若还需要更多数据才能结束过滤操作，返回PSFS_FEED_ME；若遇到严重问题，返回PSFS_ERR_FATAL。\n","permalink":"http://0x3f.org/posts/contexts-and-filters-implementation-of-php/","summary":"\u003ch2 id=\"上下文的实现和应用\"\u003e上下文的实现和应用\u003c/h2\u003e\n\u003cp\u003e上下文包含流的选项和流的参数两部分内容。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ephp_stream_context\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nf\"\u003ephp_stream_context_alloc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e流的选项是一系列键值对。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_stream_context_set_option\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream_context\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewrappername\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eoptionname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eoptionvalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_stream_context_get_option\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream_context\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewrappername\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eoptionname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e***\u003c/span\u003e\u003cspan class=\"n\"\u003eoptionvalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e流的参数目前只实现对流的事件的回调，php_stream_context-\u0026gt;notifier存储如下结构：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ephp_stream_notification_func\u003c/span\u003e \u003cspan class=\"n\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edtor\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream_notifier\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enotifier\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eprogress\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprogress_max\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_stream_notifier\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e回调函数的原型为：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"nf\"\u003evoid\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream_notification_func\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream_context\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enotifycode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eseverity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003exmsg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003excode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes_sofar\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes_max\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003enotifycode包含如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_RESOLVE：主机名解析完成\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_CONNECT：socket连接建立\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_AUTH_REQUIRED：需要验证\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_MIME_TYPE_IS：远程资源的MIME-Type可用\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_FILE_SIZE_IS：远程资源的大小可用\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_REDIRECTED：原始地址被跳转\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_PROGRESS：php_stream_notifier-\u0026gt;progress和progress_max（可能的）已更新\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_COMPLETED：流中已无可用数据\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_FAILURE：请求失败\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_AUTH_RESULT：远程验证已完成，并且可能是成功的\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eseverity包含如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_SEVERITY_INFO\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_SEVERITY_WARN\u003c/li\u003e\n\u003cli\u003ePHP_STREAM_NOTIFY_SEVERITY_ERR\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ephp_stream_notifier-\u0026gt;ptr用于存储附加数据，如果该数据需要手工回收，需指定php_stream_notifier-\u0026gt;dtor。\u003c/p\u003e\n\u003cp\u003ephp_stream_notifier-\u0026gt;mask如果被赋值severity，其它severity的事件将不会触发回调函数。\u003c/p\u003e\n\u003ch2 id=\"过滤器的实现和应用\"\u003e过滤器的实现和应用\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e82\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026#34;ext/standard/php_string.h\u0026#34;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003eis_persistent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_chars\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eto_chars\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etr_len\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_donie_filter_data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ephp_stream_filter_status_t\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_donie_stream_filter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_stream_filter\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ethisfilter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_bucket_brigade\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebuckets_in\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_bucket_brigade\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebuckets_out\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebytes_consumed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_donie_filter_data\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ethisfilter\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eabstract\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_bucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebucket\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003econsumed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuckets_in\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003ebucket\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_stream_bucket_make_writeable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuckets_in\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003ephp_strtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebucket\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebuflen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_chars\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eto_chars\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr_len\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003econsumed\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebuflen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003ephp_stream_bucket_append\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuckets_out\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebytes_consumed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebytes_consumed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ePSFS_PASS_ON\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_donie_stream_filter_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_filter\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ethisfilter\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_donie_filter_data\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ethisfilter\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eabstract\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003epefree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eis_persistent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_stream_filter_ops\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_donie_stream_filter_ops\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_donie_stream_filter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_donie_stream_filter_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;donie.to_upper_case\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_stream_filter\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nf\"\u003ephp_donie_stream_filter_create\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003epersistent\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_donie_filter_data\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003epemalloc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_donie_filter_data\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003epersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eis_persistent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_chars\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;abcdefghijklmnopqrstuvwxyz\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eto_chars\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr_len\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_chars\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_stream_filter_alloc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_donie_stream_filter_ops\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_stream_filter_factory\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_donie_stream_uppercase_factory\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_donie_stream_filter_create\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_MINIT_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* register a filter */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ephp_stream_filter_register_factory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;donie.to_upper_case\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_donie_stream_uppercase_factory\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_MSHUTDOWN_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* unregister the filter */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ephp_stream_filter_unregister_factory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;donie.to_upper_case\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"注册和注销\"\u003e注册和注销\u003c/h3\u003e\n\u003cp\u003e分别在MINIT和MSHUTDOWN函数中调用php_stream_filter_register_factory()和php_stream_filter_unregister_factory()注册和注销过滤器。\u003c/p\u003e","title":"PHP流的上下文和过滤器的实现"},{"content":"gn是Vim 7.4新增的一个操作（motion），作用是跳到并选中下一个搜索匹配项。\n具体说，Vim里执行搜索后，执行n操作只会跳转到下一个匹配项，而不选中它。但是我们往往需要对匹配项执行一些修改操作，例如替换、删除或修改大小写等，如果先跳转再执行对应操作，会比较繁琐。gn可以和相应的操作结合，简化这些过程。\n举个栗子。如果要把所有的win、linux替换成大写，可以先用正则搜索“\\(win|linux\\)\\C”，然后执行“gUgn”，此时下一个匹配的结果就会被替换成大写，然后直接执行“.”重复上次操作即可。\n此外，常用的组合有：\ncgn: 删除下一个匹配项，并进入插入模式。 dgn: 删除下一个匹配项，并保持常规模式。 和操作“N”相同，执行“gN”是逆向操作。\n","permalink":"http://0x3f.org/posts/enhance-search-with-gn-in-vim/","summary":"\u003cp\u003egn是Vim 7.4新增的一个操作（motion），作用是跳到并选中下一个搜索匹配项。\u003c/p\u003e\n\u003cp\u003e具体说，Vim里执行搜索后，执行n操作只会跳转到下一个匹配项，而不选中它。但是我们往往需要对匹配项执行一些修改操作，例如替换、删除或修改大小写等，如果先跳转再执行对应操作，会比较繁琐。gn可以和相应的操作结合，简化这些过程。\u003c/p\u003e\n\u003cp\u003e举个栗子。如果要把所有的win、linux替换成大写，可以先用正则搜索“\u003cstrong\u003e\\(win|linux\\)\\C\u003c/strong\u003e”，然后执行“\u003cstrong\u003egUgn\u003c/strong\u003e”，此时下一个匹配的结果就会被替换成大写，然后直接执行“\u003cstrong\u003e.\u003c/strong\u003e”重复上次操作即可。\u003c/p\u003e\n\u003cp\u003e此外，常用的组合有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecgn: 删除下一个匹配项，并进入插入模式。\u003c/li\u003e\n\u003cli\u003edgn: 删除下一个匹配项，并保持常规模式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e和操作“\u003cstrong\u003eN\u003c/strong\u003e”相同，执行“\u003cstrong\u003egN\u003c/strong\u003e”是逆向操作。\u003c/p\u003e","title":"使用gn操作增强Vim的搜索"},{"content":"效果如图：\n创建脚本，并赋可执行权限：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/sh # shell script to prepend i3status with more stuff STOCK_SCRIPT=`realpath \u0026#34;$0\u0026#34;|xargs dirname`/stock.php i3status | while : do stock_info=\u0026#34;\u0026#34; if [[ -x \u0026#34;$STOCK_SCRIPT\u0026#34; ]]; then stock_info=`$STOCK_SCRIPT` fi read line # if output_format = i3bar in i3status.conf stock_info=\u0026#34;[{ \\\u0026#34;full_text\\\u0026#34;: \\\u0026#34;${stock_info}\\\u0026#34; },\u0026#34; echo \u0026#34;${line/[/$stock_info}\u0026#34; || exit 1 # # if not output_format = i3bar in i3status.conf # echo \u0026#34;$stock_info | $line\u0026#34; || exit 1 done 如果i3status.conf中启用了JSON格式输出（支持颜色），应启用上面脚本中第一块的代码，否则使用后面的。启动JSON格式输出的内容具体如下：\n1 2 3 4 general { colors = true output_format = i3bar } 在i3wm的配置文件中用以上脚本替换i3status：\n1 2 3 4 5 6 7 8 9 10 bar { # ... # status_command i3status status_command ~/.i3/myi3status.sh # ... } 在和上面脚本同路径下创建脚本：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 #!/bin/env php \u0026lt;?php class PinYin { public static function utf8To($ss, $isfirst = false) { return self::convert(self::utf8ToGB2312($ss), $isfirst); } public static function utf8ToGB2312($ss) { return iconv(\u0026#39;UTF-8\u0026#39;, \u0026#39;GB2312//IGNORE\u0026#39;, $ss); } // 字符串必须为GB2312编码 public static function convert($ss, $isfirst = false) { $res = \u0026#39;\u0026#39;; $len = strlen($ss); $pinyinArr = self::get_pinyin_array(); for ($i=0; $i\u0026lt;$len; $i++) { $ascii = ord($ss[$i]); if ($ascii \u0026gt; 0x80) { $asciiB = ord($ss[++$i]); $ascii = $ascii * 256 + $asciiB - 65536; } if ($ascii \u0026lt; 255 \u0026amp;\u0026amp; $ascii \u0026gt; 0) { if (($ascii \u0026gt;= 48 \u0026amp;\u0026amp; $ascii \u0026lt;= 57) || ($ascii \u0026gt;= 97 \u0026amp;\u0026amp; $ascii \u0026lt;= 122)) { $res .= $ss[$i]; // 0-9 a-z } elseif ($ascii \u0026gt;= 65 \u0026amp;\u0026amp; $ascii \u0026lt;= 90) { $res .= strtolower($ss[$i]); // A-Z } else { $res .= \u0026#39;_\u0026#39;; } } elseif ($ascii \u0026lt; -20319 || $ascii \u0026gt; -10247) { $res .= \u0026#39;_\u0026#39;; } else { foreach ($pinyinArr as $py=\u0026gt;$asc) { if ($asc \u0026lt;= $ascii) { $res .= $isfirst ? $py[0] : $py; break; } } } } return $res; } public static function toFirst($ss) { $ascii = ord($ss[0]); if ($ascii \u0026gt; 0xE0) { $ss = self::utf8ToGB2312($ss[0].$ss[1].$ss[2]); } elseif ($ascii \u0026lt; 0x80) { if ($ascii \u0026gt;= 65 \u0026amp;\u0026amp; $ascii \u0026lt;= 90) { return strtolower($ss[0]); } elseif ($ascii \u0026gt;= 97 \u0026amp;\u0026amp; $ascii \u0026lt;= 122) { return $ss[0]; } else { return false; } } if (strlen($ss) \u0026lt; 2) { return false; } $asc = ord($ss[0]) * 256 + ord($ss[1]) - 65536; if($asc\u0026gt;=-20319 \u0026amp;\u0026amp; $asc\u0026lt;=-20284) return \u0026#39;a\u0026#39;; if($asc\u0026gt;=-20283 \u0026amp;\u0026amp; $asc\u0026lt;=-19776) return \u0026#39;b\u0026#39;; if($asc\u0026gt;=-19775 \u0026amp;\u0026amp; $asc\u0026lt;=-19219) return \u0026#39;c\u0026#39;; if($asc\u0026gt;=-19218 \u0026amp;\u0026amp; $asc\u0026lt;=-18711) return \u0026#39;d\u0026#39;; if($asc\u0026gt;=-18710 \u0026amp;\u0026amp; $asc\u0026lt;=-18527) return \u0026#39;e\u0026#39;; if($asc\u0026gt;=-18526 \u0026amp;\u0026amp; $asc\u0026lt;=-18240) return \u0026#39;f\u0026#39;; if($asc\u0026gt;=-18239 \u0026amp;\u0026amp; $asc\u0026lt;=-17923) return \u0026#39;g\u0026#39;; if($asc\u0026gt;=-17922 \u0026amp;\u0026amp; $asc\u0026lt;=-17418) return \u0026#39;h\u0026#39;; if($asc\u0026gt;=-17417 \u0026amp;\u0026amp; $asc\u0026lt;=-16475) return \u0026#39;j\u0026#39;; if($asc\u0026gt;=-16474 \u0026amp;\u0026amp; $asc\u0026lt;=-16213) return \u0026#39;k\u0026#39;; if($asc\u0026gt;=-16212 \u0026amp;\u0026amp; $asc\u0026lt;=-15641) return \u0026#39;l\u0026#39;; if($asc\u0026gt;=-15640 \u0026amp;\u0026amp; $asc\u0026lt;=-15166) return \u0026#39;m\u0026#39;; if($asc\u0026gt;=-15165 \u0026amp;\u0026amp; $asc\u0026lt;=-14923) return \u0026#39;n\u0026#39;; if($asc\u0026gt;=-14922 \u0026amp;\u0026amp; $asc\u0026lt;=-14915) return \u0026#39;o\u0026#39;; if($asc\u0026gt;=-14914 \u0026amp;\u0026amp; $asc\u0026lt;=-14631) return \u0026#39;p\u0026#39;; if($asc\u0026gt;=-14630 \u0026amp;\u0026amp; $asc\u0026lt;=-14150) return \u0026#39;q\u0026#39;; if($asc\u0026gt;=-14149 \u0026amp;\u0026amp; $asc\u0026lt;=-14091) return \u0026#39;r\u0026#39;; if($asc\u0026gt;=-14090 \u0026amp;\u0026amp; $asc\u0026lt;=-13319) return \u0026#39;s\u0026#39;; if($asc\u0026gt;=-13318 \u0026amp;\u0026amp; $asc\u0026lt;=-12839) return \u0026#39;t\u0026#39;; if($asc\u0026gt;=-12838 \u0026amp;\u0026amp; $asc\u0026lt;=-12557) return \u0026#39;w\u0026#39;; if($asc\u0026gt;=-12556 \u0026amp;\u0026amp; $asc\u0026lt;=-11848) return \u0026#39;x\u0026#39;; if($asc\u0026gt;=-11847 \u0026amp;\u0026amp; $asc\u0026lt;=-11056) return \u0026#39;y\u0026#39;; if($asc\u0026gt;=-11055 \u0026amp;\u0026amp; $asc\u0026lt;=-10247) return \u0026#39;z\u0026#39;; return false; } public static function get_pinyin_array() { static $pyArr; if(isset($pyArr)) return $pyArr; $kk = \u0026#39;a|ai|an|ang|ao|ba|bai|ban|bang|bao|bei|ben|beng|bi|bian|biao|bie|bin|bing|bo|bu|ca|cai|can|cang|cao|ce|ceng|cha|chai|chan|chang|chao|che|chen|cheng|chi|chong|chou|chu|chuai|chuan|chuang|chui|chun|chuo|ci|cong|cou|cu|cuan|cui|cun|cuo|da|dai|dan|dang|dao|de|deng|di|dian|diao|die|ding|diu|dong|dou|du|duan|dui|dun|duo|e|en|er|fa|fan|fang|fei|fen|feng|fo|fou|fu|ga|gai|gan|gang|gao|ge|gei|gen|geng|gong|gou|gu|gua|guai|guan|guang|gui|gun|guo|ha|hai|han|hang|hao|he|hei|hen|heng|hong|hou|hu|hua|huai|huan|huang|hui|hun|huo|ji|jia|jian|jiang|jiao|jie|jin|jing|jiong|jiu|ju|juan|jue|jun|ka|kai|kan|kang|kao|ke|ken|keng|kong|kou|ku|kua|kuai|kuan|kuang|kui|kun|kuo|la|lai|lan|lang|lao|le|lei|leng|li|lia|lian|liang|liao|lie|lin|ling|liu|long|lou|lu|lv|luan|lue|lun|luo|ma|mai|man|mang|mao|me|mei|men|meng|mi|mian|miao|mie|min|ming|miu|mo|mou|mu|na|nai|nan|nang|nao|ne|nei|nen|neng|ni|nian|niang|niao|nie|nin|ning|niu|nong|nu|nv|nuan|nue|nuo|o|ou|pa|pai|pan|pang|pao|pei|pen|peng|pi|pian|piao|pie|pin|ping|po|pu|qi|qia|qian|qiang|qiao|qie|qin|qing|qiong|qiu|qu|quan|que|qun|ran|rang|rao|re|ren|reng|ri|rong|rou|ru|ruan|rui|run|ruo|sa|sai|san|sang|sao|se|sen|seng|sha|shai|shan|shang|shao|she|shen|sheng|shi|shou|shu|shua|shuai|shuan|shuang|shui|shun|shuo|si|song|sou|su|suan|sui|sun|suo|ta|tai|tan|tang|tao|te|teng|ti|tian|tiao|tie|ting|tong|tou|tu|tuan|tui|tun|tuo|wa|wai|wan|wang|wei|wen|weng|wo|wu|xi|xia|xian|xiang|xiao|xie|xin|xing|xiong|xiu|xu|xuan|xue|xun|ya|yan|yang|yao|ye|yi|yin|ying|yo|yong|you|yu|yuan|yue|yun|za|zai|zan|zang|zao|ze|zei|zen|zeng|zha|zhai|zhan|zhang|zhao|zhe|zhen|zheng|zhi|zhong|zhou|zhu|zhua|zhuai|zhuan|zhuang|zhui|zhun|zhuo|zi|zong|zou|zu|zuan|zui|zun|zuo\u0026#39;; $vv = \u0026#39;-20319|-20317|-20304|-20295|-20292|-20283|-20265|-20257|-20242|-20230|-20051|-20036|-20032|-20026|-20002|-19990|-19986|-19982|-19976|-19805|-19784|-19775|-19774|-19763|-19756|-19751|-19746|-19741|-19739|-19728|-19725|-19715|-19540|-19531|-19525|-19515|-19500|-19484|-19479|-19467|-19289|-19288|-19281|-19275|-19270|-19263|-19261|-19249|-19243|-19242|-19238|-19235|-19227|-19224|-19218|-19212|-19038|-19023|-19018|-19006|-19003|-18996|-18977|-18961|-18952|-18783|-18774|-18773|-18763|-18756|-18741|-18735|-18731|-18722|-18710|-18697|-18696|-18526|-18518|-18501|-18490|-18478|-18463|-18448|-18447|-18446|-18239|-18237|-18231|-18220|-18211|-18201|-18184|-18183|-18181|-18012|-17997|-17988|-17970|-17964|-17961|-17950|-17947|-17931|-17928|-17922|-17759|-17752|-17733|-17730|-17721|-17703|-17701|-17697|-17692|-17683|-17676|-17496|-17487|-17482|-17468|-17454|-17433|-17427|-17417|-17202|-17185|-16983|-16970|-16942|-16915|-16733|-16708|-16706|-16689|-16664|-16657|-16647|-16474|-16470|-16465|-16459|-16452|-16448|-16433|-16429|-16427|-16423|-16419|-16412|-16407|-16403|-16401|-16393|-16220|-16216|-16212|-16205|-16202|-16187|-16180|-16171|-16169|-16158|-16155|-15959|-15958|-15944|-15933|-15920|-15915|-15903|-15889|-15878|-15707|-15701|-15681|-15667|-15661|-15659|-15652|-15640|-15631|-15625|-15454|-15448|-15436|-15435|-15419|-15416|-15408|-15394|-15385|-15377|-15375|-15369|-15363|-15362|-15183|-15180|-15165|-15158|-15153|-15150|-15149|-15144|-15143|-15141|-15140|-15139|-15128|-15121|-15119|-15117|-15110|-15109|-14941|-14937|-14933|-14930|-14929|-14928|-14926|-14922|-14921|-14914|-14908|-14902|-14894|-14889|-14882|-14873|-14871|-14857|-14678|-14674|-14670|-14668|-14663|-14654|-14645|-14630|-14594|-14429|-14407|-14399|-14384|-14379|-14368|-14355|-14353|-14345|-14170|-14159|-14151|-14149|-14145|-14140|-14137|-14135|-14125|-14123|-14122|-14112|-14109|-14099|-14097|-14094|-14092|-14090|-14087|-14083|-13917|-13914|-13910|-13907|-13906|-13905|-13896|-13894|-13878|-13870|-13859|-13847|-13831|-13658|-13611|-13601|-13406|-13404|-13400|-13398|-13395|-13391|-13387|-13383|-13367|-13359|-13356|-13343|-13340|-13329|-13326|-13318|-13147|-13138|-13120|-13107|-13096|-13095|-13091|-13076|-13068|-13063|-13060|-12888|-12875|-12871|-12860|-12858|-12852|-12849|-12838|-12831|-12829|-12812|-12802|-12607|-12597|-12594|-12585|-12556|-12359|-12346|-12320|-12300|-12120|-12099|-12089|-12074|-12067|-12058|-12039|-11867|-11861|-11847|-11831|-11798|-11781|-11604|-11589|-11536|-11358|-11340|-11339|-11324|-11303|-11097|-11077|-11067|-11055|-11052|-11045|-11041|-11038|-11024|-11020|-11019|-11018|-11014|-10838|-10832|-10815|-10800|-10790|-10780|-10764|-10587|-10544|-10533|-10519|-10331|-10329|-10328|-10322|-10315|-10309|-10307|-10296|-10281|-10274|-10270|-10262|-10260|-10256|-10254\u0026#39;; $key = explode(\u0026#39;|\u0026#39;, $kk); $val = explode(\u0026#39;|\u0026#39;, $vv); $pyArr = array_combine($key, $val); arsort($pyArr); return $pyArr; } } define(\u0026#39;STOCKS_FILE\u0026#39;, $_SERVER[\u0026#39;HOME\u0026#39;].\u0026#39;/.stocks\u0026#39;); if (!file_exists(STOCKS_FILE)) { exit(\u0026#39;File not found: \u0026#39;.STOCKS_FILE); } $stockCodeArr = explode(\u0026#34;\\n\u0026#34;, trim(file_get_contents(STOCKS_FILE))); if (empty($stockCodeArr)) { exit(\u0026#39;No stock code found.\u0026#39;); } $context = stream_context_create( [ \u0026#39;http\u0026#39;=\u0026gt;[ \u0026#39;method\u0026#39;=\u0026gt;\u0026#34;GET\u0026#34;, \u0026#39;timeout\u0026#39; =\u0026gt; 3 ] ] ); $response = file_get_contents(\u0026#34;http://hq.sinajs.cn/list=\u0026#34;.implode(\u0026#39;,\u0026#39;, $stockCodeArr), false, $context); if (empty($response)) { exit(\u0026#39;Failed fetching stock info with API.\u0026#39;); } $result = []; $lines = explode(\u0026#34;\\n\u0026#34;, trim(iconv(\u0026#39;gbk\u0026#39;, \u0026#39;utf-8\u0026#39;, $response))); foreach ($lines as $line) { $matches = []; preg_match(\u0026#39;/\u0026#34;.*\u0026#34;/\u0026#39;, $line, $matches); if (!empty($matches)) { $stock = explode(\u0026#39;,\u0026#39;, trim($matches[0], \u0026#39;\u0026#34;\u0026#39;)); if (!empty($stock)) { $result[] = strtoupper(PinYin::utf8To($stock[0], true)).\u0026#34;: {$stock[3]}, {$stock[4]}, {$stock[5]}\u0026#34;; } } } echo implode(\u0026#39;; \u0026#39;, $result); 脚本从~/.stocks中读取股票代码：\n1 2 sh601985 sz002024 ","permalink":"http://0x3f.org/posts/show-stocks-in-i3status/","summary":"\u003cp\u003e效果如图：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EIOXvoh8/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e创建脚本，并赋可执行权限：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# shell script to prepend i3status with more stuff\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eSTOCK_SCRIPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003erealpath \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003exargs dirname\u003cspan class=\"sb\"\u003e`\u003c/span\u003e/stock.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ei3status \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e :\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003estock_info\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[[\u003c/span\u003e -x \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$STOCK_SCRIPT\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003estock_info\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"nv\"\u003e$STOCK_SCRIPT\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eread\u003c/span\u003e line\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# if output_format = i3bar in i3status.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003estock_info\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;[{ \\\u0026#34;full_text\\\u0026#34;: \\\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003estock_info\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\\\u0026#34; },\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e/[/\u003c/span\u003e\u003cspan class=\"nv\"\u003e$stock_info\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# # if not output_format = i3bar in i3status.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# echo \u0026#34;$stock_info | $line\u0026#34; || exit 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e如果i3status.conf中启用了JSON格式输出（支持颜色），应启用上面脚本中第一块的代码，否则使用后面的。启动JSON格式输出的内容具体如下：\u003c/p\u003e","title":"在i3wm状态栏显示股票信息"},{"content":"实现 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /* reimplement fopen using stream */ ZEND_FUNCTION(donie_stream_fopen) { php_stream *stream; char *path, *mode; int path_len, mode_len; int options = ENFORCE_SAFE_MODE|REPORT_ERRORS; if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \u0026#34;ss\u0026#34;, \u0026amp;path, \u0026amp;path_len, \u0026amp;mode, \u0026amp;mode_len) == FAILURE) { return; } stream = php_stream_open_wrapper(path, mode, options, NULL); if (!stream) { RETURN_FALSE; } php_stream_to_zval(stream, return_value); } php_stream_open_wrapper()是对文件类型资源创建流的方法，此外还有基于socket的流、目录流和特殊流三种。php_stream_to_zval()用于把流实例转换成zval结构。\n创建文件类型的流 1 2 #define php_stream_open_wrapper(path, mode, options, opened)\t_php_stream_open_wrapper_ex((path), (mode), (options), (opened), NULL STREAMS_CC TSRMLS_CC) #define php_stream_open_wrapper_ex(path, mode, options, opened, context)\t_php_stream_open_wrapper_ex((path), (mode), (options), (opened), (context) STREAMS_CC TSRMLS_CC) 参数path是文件名或URL，mode是模式字符串，options是选项组合。php_stream_open_wrapper_ex()允许指定一个流的上下文。\noptions包含以下选项：\nUSE_PATH：应用ini中的include_path到相对路径。内建的fopen()的第三个参数置True时使用此选项。 STREAM_USE_URL：只有远程URL才允许打开，%%file://, php://, compress.zlib://%%这样的本地URL会报错。 ENFORCE_SAFE_MODE：只有设置了此选项且ini中的safe_mode开启时，才会使safe_mode生效，不设置此选项，则不论ini中是否开启都不会生效。 REPORT_ERRORS：若开启流出错，生成错误信息。 STREAM_MUST_SEEK：不是所有流都允许seek，若置此选项，且流不允许seek，则包装器不会开启流。 STREAM_WILL_CAST：置此参数将要求流可被转换成posix或stdio类型的文件描述符，若流不可转换，可在IO开始前失败。 STREAM_ONLY_GET_HEADERS：http包装器使用此参数，只获取资源的元数据，不获取内容。 STREAM_DISABLE_OPEN_BASEDIR：当ini中的open_basedir开启时，置此参数跳过open_basedir检查。 STREAM_OPEN_PERSISTENT：要求流和相关资源都创建为持久数据。 IGNORE_PATH：不从include_path中搜索。 IGNORE_URL：只有本地文件才可以被打开。 创建传输类型的流 1 php_stream *_php_stream_xport_create(const char *name, size_t namelen, int options, int flags, const char *persistent_id, struct timeval *timeout, php_stream_context *context, char **error_string, int *error_code) 参数：\nname：URL。 options：参数，与php_stream_open_wrapper()的相同。 flags：STREAM_XPORT_CLIENT或STREAM_XPORT_SERVER与其它STREAM_XPORT_*常量的组合。 persistent_id：键值，置此参数将使流在多次请求间持久存在。 timeout：置NULL将使用ini中设置的值。 errstr：用于向外传递错误信息，初始应置为NULL，若有错误信息传出，调用方有责任释放错误信息占用的内存。 errcode：错误码。 flags：\nSTREAM_XPORT_CLIENT：工作为客户端，向远程发起连接。 STREAM_XPORT_SERVER：工作为服务器，接受连接。 STREAM_XPORT_CONNECT：传输建立的同时发起对远程的连接，否则，需手动调用php_stream_xport_connect()。 STREAM_XPORT_CONNECT_ASYNC：发起异步远程连接。 STREAM_XPORT_BIND：将传输流绑定到本地资源. 用在服务端传输流时,这将使得accept连接的传输流准备端口, 路径或特定的端点标识符等信息。 STREAM_XPORT_LISTEN：%%Listen for inbound connections on the bound transport endpoint. This is typically used with stream-based transports such as tcp://, ssl://, and unix://%%. 创建目录类型的流 1 php_stream php_stream_opendir(const char *path, int options, php_stream_context *context) 创建特殊类型的流 1 2 3 4 5 php_stream *php_stream_fopen_tmpfile(void); php_stream *php_stream_fopen_temporary_file(const char *dir, const char *pfx, char **opened_path); php_stream *php_stream_fopen_from_fd(int fd, const char *mode, const char *persistent_id); php_stream *php_stream_fopen_from_file(FILE *file, const char *mode); php_stream *php_stream_fopen_from_pipe(FILE *file, const char *mode); 读流 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // 读一个字符 int php_stream_getc(php_stream *stream); // 读取指定数量的字符 size_t php_stream_read(php_stream *stream, char *buf, size_t count); // 读取直到行末、或流末、或最多maxlen个字符 char *php_stream_get_line(php_stream *stream, char *buf, size_t maxlen, size_t *returned_len); char *php_stream_gets(php_stream *stream, char *buf, size_t maxlen); // 与php_stream_get_line相同，可指定截止标记 char *php_stream_get_record(php_stream *stream, size_t maxlen, size_t *returned_len, char *delim, size_t delim_len TSRMLS_DC); // 读取一个目录项 php_stream_dirent *php_stream_readdir(php_stream *dirstream, php_stream_dirent *entry); 写流 1 2 3 4 5 6 7 8 9 // 写非阻塞流可能写入的数据比传入的短；_string要求传入的字符串以NULL结尾 size_t php_stream_write(php_stream *stream, char *buf, size_t count); size_t php_stream_write_string(php_stream *stream, char *stf); int php_stream_putc(php_stream *stream, int c); // 与_string不同的是会自动追加一个换行符到字符串末尾 int php_stream_puts(php_string *stream, char *buf); size_t php_stream_printf(php_stream *stream TSRMLS_DC, const char *format, ...); 1 int php_stream_flush(php_stream *stream); 在关闭流的时候，flush会被自动调用，并且大部分无过滤的流因无内部缓冲而不需flush，所以单独flush一般是不需要的。\n寻址 1 2 3 4 int php_stream_seek(php_stream *stream, off_t offset, int whence); int php_stream_rewind(php_stream *stream); int php_stream_rewinddir(php_stream *dirstream); off_t php_stream_tell(php_stream *stream); offset是相对于whence的位移量，whence包含：\nSEEK_SET：文件开头。置offet为负值被认为是个错误并导致不可预料的行为。offset超出文件范围会导致一个错误，或文件被增大。 SEEK_CUR：当前位置。 SEEK_END：文件末尾。offset一般为负，正值的行为因流的实现而异。 获取额外信息 1 int php_stream_stat(php_stream *stream, php_stream_statbuf *ssb); 关闭流 1 2 #define php_stream_close(stream) php_stream_free((stream), PHP_STREAM_FREE_CLOSE) #define php_stream_pclose(stream) php_stream_free((stream), PHP_STREAM_FREE_CLOSE_PERSISTENT) 包含以下选项：\nPHP_STREAM_FREE_CALL_DTOR：销毁流时调用php_stream-\u0026gt;ops-\u0026gt;close PHP_STREAM_FREE_RELEASE_STREAM：销毁流时调用php_stream_wrapper-\u0026gt;ops-\u0026gt;stream_close PHP_STREAM_FREE_PRESERVE_HANDLE：php_stream-\u0026gt;ops-\u0026gt;close不销毁句柄 PHP_STREAM_FREE_RSRC_DTOR：用于流内部资源列表垃圾回收 PHP_STREAM_FREE_PERSISTENT：用于持久流，所有操作的结果在多次请求间持久有效 PHP_STREAM_FREE_CLOSE：CALL_DTOR和RELEASE_STREAM的组合，用于非持久流的常规选项 PHP_STREAM_FREE_CLOSE_CASTED：CLOSE和PRESERVE_HANDLE的组合 PHP_STREAM_FREE_CLOSE_PERSISTENT：CLOSE和PERSISTENT的组合，用于持久流的常规选项 ","permalink":"http://0x3f.org/posts/stream-operations-of-php/","summary":"\u003ch2 id=\"实现\"\u003e实现\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* reimplement fopen using stream */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003eZEND_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_stream_fopen\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003epath_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emode_len\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eENFORCE_SAFE_MODE\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eREPORT_ERRORS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eZEND_NUM_ARGS\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ss\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epath_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emode_len\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_stream_open_wrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003eRETURN_FALSE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ephp_stream_to_zval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ereturn_value\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ephp_stream_open_wrapper()是对文件类型资源创建流的方法，此外还有基于socket的流、目录流和特殊流三种。php_stream_to_zval()用于把流实例转换成zval结构。\u003c/p\u003e\n\u003ch2 id=\"创建文件类型的流\"\u003e创建文件类型的流\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define php_stream_open_wrapper(path, mode, options, opened)\t_php_stream_open_wrapper_ex((path), (mode), (options), (opened), NULL STREAMS_CC TSRMLS_CC)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define php_stream_open_wrapper_ex(path, mode, options, opened, context)\t_php_stream_open_wrapper_ex((path), (mode), (options), (opened), (context) STREAMS_CC TSRMLS_CC)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e参数path是文件名或URL，mode是模式字符串，options是选项组合。php_stream_open_wrapper_ex()允许指定一个流的上下文。\u003c/p\u003e","title":"PHP流的操作"},{"content":"探长可以和平头OP并列变四最好的模具，人形和车形俱佳。但是官版的V级神物实在鸡肋，所以祖国版准L级模具实在是拯救巨大控的好物。除了放大，探长的整个车头都是合金件，既有质感又有份量。涂装较官版也有改进，胸甲和轮轱上了银柒，枪管上了金柒，车形后部增加了火焰纹，不像官版那么素。最重要的是祖国版的做工很好，关节松紧适度，车形闭合得很好。\n祖国版的探长目前有三个版本，普通版、叼烟版和蓝色版。普通版和官版是一致的。叼烟版的头雕是叼著烟的。蓝色版的外形和普通版一样，但是涂成了深蓝色，而且附送两个塑料小人。我最喜欢的叼烟版，不知道帝都禁烟后还能不能买到……\n虽然祖国版整体而言是很好的东东，不过厂家的品控做得很不好，我玩儿过几个实体才挑到合适的，有的车头背部塑料板开盒就是烂的，有的轮轱个别没有涂银柒，比较普遍的现象是大枪插不进背部凹槽，还有个别关节比较松。所以买祖国版还是蛮拼人品的。\n人形体格匀称，没有背包，除了门板手外，没有累赘部件，虽然门板可以卸掉，但并没有地方收纳。\n头雕精细度一般，不过雪茄的加入是个大大的加分项。\n涂装方面，用军绿色作为基色，银灰搭配，很不错。\n虽然没有用到齿轮关节，不过松紧度都很好。腿部向前可以平抬，不能后踢。由于膝关节较高，做不了跪姿。腰部可以360度旋转。手臂大风车没有问题。头部可以左右转动很小的角度，不能抬头、低头。\n前脚掌可以左右摆动，提供了一定的接地性。\n一般比较用心的模具都会在可玩性上加一个噱头，比如平头OP的枪是可以发射子弹的。探长的噱头就是组合武器，拼装后的大枪还是很霸气的，只是一只手举不起来，必须双手托枪。武器的收纳方面做得很好，无论是人形还是载具形态，都可以完美收纳所有武器。\n拆开挂满身，不愧是个武器库。\n车形的原型是奥什科什防务军用战术装甲车，也非常帅。有两个轮子不能著地，不过整体滚动性不错。\n武器的偷胶有点过头，胯部的两把枪和大枪都有很大程度的偷胶，这是个很大的扣分项。\n玩具变形流畅，把玩性的表现非常好。\n","permalink":"http://0x3f.org/posts/hound-of-transformers-4/","summary":"\u003cp\u003e探长可以和平头OP并列变四最好的模具，人形和车形俱佳。但是官版的V级神物实在鸡肋，所以祖国版准L级模具实在是拯救巨大控的好物。除了放大，探长的整个车头都是合金件，既有质感又有份量。涂装较官版也有改进，胸甲和轮轱上了银柒，枪管上了金柒，车形后部增加了火焰纹，不像官版那么素。最重要的是祖国版的做工很好，关节松紧适度，车形闭合得很好。\u003c/p\u003e\n\u003cp\u003e祖国版的探长目前有三个版本，普通版、叼烟版和蓝色版。普通版和官版是一致的。叼烟版的头雕是叼著烟的。蓝色版的外形和普通版一样，但是涂成了深蓝色，而且附送两个塑料小人。我最喜欢的叼烟版，不知道帝都禁烟后还能不能买到……\u003c/p\u003e\n\u003cp\u003e虽然祖国版整体而言是很好的东东，不过厂家的品控做得很不好，我玩儿过几个实体才挑到合适的，有的车头背部塑料板开盒就是烂的，有的轮轱个别没有涂银柒，比较普遍的现象是大枪插不进背部凹槽，还有个别关节比较松。所以买祖国版还是蛮拼人品的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EGZsq1TR/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e人形体格匀称，没有背包，除了门板手外，没有累赘部件，虽然门板可以卸掉，但并没有地方收纳。\u003c/p\u003e\n\u003cp\u003e头雕精细度一般，不过雪茄的加入是个大大的加分项。\u003c/p\u003e\n\u003cp\u003e涂装方面，用军绿色作为基色，银灰搭配，很不错。\u003c/p\u003e\n\u003cp\u003e虽然没有用到齿轮关节，不过松紧度都很好。腿部向前可以平抬，不能后踢。由于膝关节较高，做不了跪姿。腰部可以360度旋转。手臂大风车没有问题。头部可以左右转动很小的角度，不能抬头、低头。\u003c/p\u003e\n\u003cp\u003e前脚掌可以左右摆动，提供了一定的接地性。\u003c/p\u003e\n\u003cp\u003e一般比较用心的模具都会在可玩性上加一个噱头，比如平头OP的枪是可以发射子弹的。探长的噱头就是组合武器，拼装后的大枪还是很霸气的，只是一只手举不起来，必须双手托枪。武器的收纳方面做得很好，无论是人形还是载具形态，都可以完美收纳所有武器。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EGZrLORA/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e拆开挂满身，不愧是个武器库。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EGZrLe2y/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e车形的原型是奥什科什防务军用战术装甲车，也非常帅。有两个轮子不能著地，不过整体滚动性不错。\u003c/p\u003e\n\u003cp\u003e武器的偷胶有点过头，胯部的两把枪和大枪都有很大程度的偷胶，这是个很大的扣分项。\u003c/p\u003e\n\u003cp\u003e玩具变形流畅，把玩性的表现非常好。\u003c/p\u003e","title":"变形金刚：祖国合金放大版探长"},{"content":"流的概念 流是一系列概念的集合，包括流包装器、流资源、流操作、上下文等内容。流是对不同资源进行操作的抽象，允许线性地从指定位置读取或写入数据，通过一套统一的API简化对资源操作的实现。\n流由scheme://target指代，scheme是包装器（Wrapper）的名字，target是流的目标地址。\nPHP的流的实现较Java简单，后者可以通过嵌套实现更灵活的应用。\n流的实现 存储结构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 struct _php_stream { php_stream_ops *ops; void *abstract;\t/* convenience pointer for abstraction */ php_stream_filter_chain readfilters, writefilters; php_stream_wrapper *wrapper; /* which wrapper was used to open the stream */ void *wrapperthis;\t/* convenience pointer for a instance of a wrapper */ zval *wrapperdata;\t/* fgetwrapperdata retrieves this */ int fgetss_state;\t/* for fgetss to handle multiline tags */ int is_persistent; char mode[16];\t/* \u0026#34;rwb\u0026#34; etc. ala stdio */ int rsrc_id;\t/* used for auto-cleanup */ int in_free;\t/* to prevent recursion during free */ /* so we know how to clean it up correctly. This should be set to * PHP_STREAM_FCLOSE_XXX as appropriate */ int fclose_stdiocast; FILE *stdiocast; /* cache this, otherwise we might leak! */ #if ZEND_DEBUG int __exposed;\t/* non-zero if exposed as a zval somewhere */ #endif char *orig_path; php_stream_context *context; int flags;\t/* PHP_STREAM_FLAG_XXX */ /* buffer */ off_t position; /* of underlying stream */ unsigned char *readbuf; size_t readbuflen; off_t readpos; off_t writepos; /* how much data to read when filling buffer */ size_t chunk_size; int eof; #if ZEND_DEBUG const char *open_filename; uint open_lineno; #endif struct _php_stream *enclosing_stream; /* this is a private stream owned by enclosing_stream */ }; /* php_stream */ typedef struct _php_stream_ops { /* stdio like functions - these are mandatory! */ size_t (*write)(php_stream *stream, const char *buf, size_t count TSRMLS_DC); size_t (*read)(php_stream *stream, char *buf, size_t count TSRMLS_DC); int (*close)(php_stream *stream, int close_handle TSRMLS_DC); int (*flush)(php_stream *stream TSRMLS_DC); const char *label; /* label for this ops structure */ /* these are optional */ int (*seek)(php_stream *stream, off_t offset, int whence, off_t *newoffset TSRMLS_DC); int (*cast)(php_stream *stream, int castas, void **ret TSRMLS_DC); int (*stat)(php_stream *stream, php_stream_statbuf *ssb TSRMLS_DC); int (*set_option)(php_stream *stream, int option, int value, void *ptrparam TSRMLS_DC); } php_stream_ops; php_stream结构体最重要的成员是ops和abstract。ops包含了流实例的所有操作逻辑，特别地，php_stream_ops-\u0026gt;close在php_stream结构被回收前提供了回收与该流实例相关的资源的机会。abstract用来存储一个自定义结构的数据，在流的操作逻辑里可以方便的访问。\n实现 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 #define PHP_DONIESTREAM_STREAMTYPE \u0026#34;doniestream\u0026#34; static size_t php_doniestream_write(php_stream *stream, const char *buf, size_t count TSRMLS_DC) { donie_stream_data *data = stream-\u0026gt;abstract; php_printf(\u0026#34;Write to stream: %s\\n\u0026#34;, buf); return count; } static size_t php_doniestream_read(php_stream *stream, char *buf, size_t count TSRMLS_DC) { donie_stream_data *data = stream-\u0026gt;abstract; zval **val; size_t read_size = count; php_printf(\u0026#34;Read from stream: %s\\n\u0026#34;, data-\u0026gt;key); return read_size; } static int php_doniestream_close(php_stream *stream, int close_handle TSRMLS_DC) { donie_stream_data *data = stream-\u0026gt;abstract; efree(data-\u0026gt;key); efree(data); return 0; } static php_stream_ops php_doniestream_ops = { php_doniestream_write, php_doniestream_read, php_doniestream_close, NULL, /* flush */ PHP_DONIESTREAM_STREAMTYPE, NULL, /* seek */ NULL, /* cast */ NULL, /* stat */ NULL, /* set_option */ }; 主要是流的操作逻辑的实现，最后构建的php_stream_ops结构用于后面流包装器中初始化流实例时赋给php_stream-\u0026gt;ops。\n包装器的实现 Wrapper是对某一协议的封装，主要包含对该类型的流的一系列操作逻辑的实现。\n存储结构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 struct _php_stream_wrapper\t{ php_stream_wrapper_ops *wops;\t/* operations the wrapper can perform */ void *abstract;\t/* context for the wrapper */ int is_url;\t/* so that PG(allow_url_fopen) can be respected */ }; typedef struct _php_stream_wrapper_ops { /* open/create a wrapped stream */ php_stream *(*stream_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode, int options, char **opened_path, php_stream_context *context STREAMS_DC TSRMLS_DC); /* close/destroy a wrapped stream */ int (*stream_closer)(php_stream_wrapper *wrapper, php_stream *stream TSRMLS_DC); /* stat a wrapped stream */ int (*stream_stat)(php_stream_wrapper *wrapper, php_stream *stream, php_stream_statbuf *ssb TSRMLS_DC); /* stat a URL */ int (*url_stat)(php_stream_wrapper *wrapper, const char *url, int flags, php_stream_statbuf *ssb, php_stream_context *context TSRMLS_DC); /* open a \u0026#34;directory\u0026#34; stream */ php_stream *(*dir_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode, int options, char **opened_path, php_stream_context *context STREAMS_DC TSRMLS_DC); const char *label; /* delete a file */ int (*unlink)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context TSRMLS_DC); /* rename a file */ int (*rename)(php_stream_wrapper *wrapper, const char *url_from, const char *url_to, int options, php_stream_context *context TSRMLS_DC); /* Create/Remove directory */ int (*stream_mkdir)(php_stream_wrapper *wrapper, const char *url, int mode, int options, php_stream_context *context TSRMLS_DC); int (*stream_rmdir)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context TSRMLS_DC); /* Metadata handling */ int (*stream_metadata)(php_stream_wrapper *wrapper, const char *url, int options, void *value, php_stream_context *context TSRMLS_DC); } php_stream_wrapper_ops; php_stream_wrapper中最重要的是ops成员，它包含了所有该类型的流的操作逻辑的实现。其中最重要的是stream_opener和stream_closer，前者是流的实例化逻辑，后者是流的析构逻辑。特别的，stream_closer主要是用来销毁php_stream结构，而php_stream_ops-\u0026gt;close是用来回收所有和该流实例相关的资源。\n实现 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 #define PHP_DONIESTREAM_WRAPPER \u0026#34;donie\u0026#34; typedef struct _donie_stream_data { off_t position; char *key; int key_len; } donie_stream_data; static php_stream *php_doniestream_wrapper_open( php_stream_wrapper *wrapper, const char *filename, const char *mode, int options, char **opened_path, php_stream_context *context STREAMS_DC TSRMLS_DC) { donie_stream_data *data; php_url *url; if (options \u0026amp; STREAM_OPEN_PERSISTENT) { php_stream_wrapper_log_error(wrapper, options TSRMLS_CC, \u0026#34;Unable to open %s persistently.\u0026#34;, filename); return NULL; } url = php_url_parse(filename); if (!url) { php_stream_wrapper_log_error(wrapper, options TSRMLS_CC, \u0026#34;Unable to parse url %s.\u0026#34;, filename); return NULL; } data = emalloc(sizeof(donie_stream_data)); data-\u0026gt;position = 0; data-\u0026gt;key_len = strlen(url-\u0026gt;host); data-\u0026gt;key = estrndup(url-\u0026gt;host, data-\u0026gt;key_len+1); php_url_free(url); return php_stream_alloc(\u0026amp;php_doniestream_ops, data, 0, mode); } static php_stream_wrapper_ops php_doniestream_wrapper_ops = { php_doniestream_wrapper_open, NULL, /* stream_closer */ NULL, /* stream_stat */ NULL, /* url_stat */ NULL, /* dir_opener */ PHP_DONIESTREAM_WRAPPER, NULL, /* unlink */ NULL, /* rename */ NULL, /* mkdir */ NULL, /* rmdir */ NULL /* stream_metadata */ }; static php_stream_wrapper php_doniestream_wrapper = { \u0026amp;php_doniestream_wrapper_ops, NULL, /* abstract */ 0, /* is_url */ }; PHP_MINIT_FUNCTION(donie) { /* register stream wrapper */ if (php_register_url_stream_wrapper(PHP_DONIESTREAM_WRAPPER, \u0026amp;php_doniestream_wrapper TSRMLS_CC) == FAILURE) { return FAILURE; } return SUCCESS; } PHP_MSHUTDOWN_FUNCTION(donie) { /* unregister stream wrapper */ if (php_unregister_url_stream_wrapper(PHP_DONIESTREAM_WRAPPER TSRMLS_CC) == FAILURE) { return FAILURE; } return SUCCESS; } PHP_DONIESTREAM_WRAPPER定义了协议名“donie”，所有对格式为“donie://XXX”地址的操作将由这个流实现。\ndonie_stream_data是一个自定义的结构体，在创建流实例的时候初始化并赋给php_stream-\u0026gt;abstract，为以后对流的操作提供方便。\n这里只实现了最关键的stream_opener函数，其中，用php_stream_alloc()创建新的流实例。\n最后在模块的MINIT中用php_register_url_stream_wrapper()注册包装器，并在MSHUTDOWN中用php_unregister_url_stream_wrapper()注销。\n","permalink":"http://0x3f.org/posts/stream-implementation-in-php/","summary":"\u003ch2 id=\"流的概念\"\u003e流的概念\u003c/h2\u003e\n\u003cp\u003e流是一系列概念的集合，包括流包装器、流资源、流操作、上下文等内容。流是对不同资源进行操作的抽象，允许线性地从指定位置读取或写入数据，通过一套统一的API简化对资源操作的实现。\u003c/p\u003e\n\u003cp\u003e流由scheme://target指代，scheme是包装器（Wrapper）的名字，target是流的目标地址。\u003c/p\u003e\n\u003cp\u003ePHP的流的实现较Java简单，后者可以通过嵌套实现更灵活的应用。\u003c/p\u003e\n\u003ch2 id=\"流的实现\"\u003e流的实现\u003c/h2\u003e\n\u003ch3 id=\"存储结构\"\u003e存储结构\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_php_stream\u003c/span\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_ops\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eops\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eabstract\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\t\t\u003cspan class=\"cm\"\u003e/* convenience pointer for abstraction */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_filter_chain\u003c/span\u003e \u003cspan class=\"n\"\u003ereadfilters\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewritefilters\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_wrapper\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* which wrapper was used to open the stream */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewrapperthis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\t\u003cspan class=\"cm\"\u003e/* convenience pointer for a instance of a wrapper */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewrapperdata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\t\u003cspan class=\"cm\"\u003e/* fgetwrapperdata retrieves this */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003efgetss_state\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\t\u003cspan class=\"cm\"\u003e/* for fgetss to handle multiline tags */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eis_persistent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\t\t\t\u003cspan class=\"cm\"\u003e/* \u0026#34;rwb\u0026#34; etc. ala stdio */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ersrc_id\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\t\t\u003cspan class=\"cm\"\u003e/* used for auto-cleanup */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ein_free\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\t\t\u003cspan class=\"cm\"\u003e/* to prevent recursion during free */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* so we know how to clean it up correctly.  This should be set to\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * PHP_STREAM_FCLOSE_XXX as appropriate */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003efclose_stdiocast\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eFILE\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estdiocast\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"cm\"\u003e/* cache this, otherwise we might leak! */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#if ZEND_DEBUG\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003e__exposed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\u003cspan class=\"cm\"\u003e/* non-zero if exposed as a zval somewhere */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eorig_path\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ephp_stream_context\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\t\u003cspan class=\"cm\"\u003e/* PHP_STREAM_FLAG_XXX */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* buffer */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eoff_t\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* of underlying stream */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ereadbuf\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ereadbuflen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eoff_t\u003c/span\u003e \u003cspan class=\"n\"\u003ereadpos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eoff_t\u003c/span\u003e \u003cspan class=\"n\"\u003ewritepos\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* how much data to read when filling buffer */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003echunk_size\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eeof\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#if ZEND_DEBUG\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eopen_filename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eopen_lineno\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_php_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eenclosing_stream\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* this is a private stream owned by enclosing_stream */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* php_stream */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_php_stream_ops\u003c/span\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* stdio like functions - these are mandatory! */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eclose_handle\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eflush\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* label for this ops structure */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* these are optional */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eseek\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eoff_t\u003c/span\u003e \u003cspan class=\"n\"\u003eoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewhence\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eoff_t\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enewoffset\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecast\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecastas\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estat\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_stream_statbuf\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003essb\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eset_option\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003ephp_stream\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eptrparam\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_stream_ops\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ephp_stream结构体最重要的成员是ops和abstract。ops包含了流实例的所有操作逻辑，特别地，php_stream_ops-\u0026gt;close在php_stream结构被回收前提供了回收与该流实例相关的资源的机会。abstract用来存储一个自定义结构的数据，在流的操作逻辑里可以方便的访问。\u003c/p\u003e","title":"PHP流的实现"},{"content":"线路图：\n修改/boot/config.txt，启用w1内核模块。配置文件中有两部分关于w1的内容，一个只使用一个GPIO引脚，需要自行添加上拉电阻，另一个使用一个额外的GPIO引脚作上拉。\n使用Python模块w1thermsensor读数，用法见这里。\n","permalink":"http://0x3f.org/posts/setup-ds18b20-on-archlinux/","summary":"\u003cp\u003e线路图：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EG46yU99/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e修改/boot/config.txt，启用w1内核模块。配置文件中有两部分关于w1的内容，一个只使用一个GPIO引脚，需要自行添加上拉电阻，另一个使用一个额外的GPIO引脚作上拉。\u003c/p\u003e\n\u003cp\u003e使用Python模块w1thermsensor读数，用法见\u003ca href=\"https://github.com/timofurrer/w1thermsensor\"\u003e这里\u003c/a\u003e。\u003c/p\u003e","title":"在Archlinux ARM上使用DS18B20温度传感器"},{"content":"一开始我不太喜欢电影版变形金刚，因为太像人就缺少科技感，我至今都认为G1是不可逾越的经典。不过变4的这款V级平头OP确实是个经典的模具，一个好的变形金刚玩具应有标准几乎都符合。\n人形身材匀称、没有冗余部件，关键是无背包，很少有能做到这一点的模具，几乎所有大黄蜂最大的败笔都是有个巨大的背包。涂装鲜艳、视觉效果强烈，作为一个Prime，搞得满身火焰纹、花里胡哨的真的好么？\n关节的松紧度方面，四肢主关节采用齿轮关节，表现不错，不过肘关节是圆形关节，转动次数多了不知道会不会松。\n由于人形没有太多的累赘，所以可动性方面没有问题，腰部也是可以360度旋转的。\n手脚方面，一个V级的玩具，用假手也就不说什么了。不过由于踝关节不能左右摆动，所以脚的接地性不好。\n头雕不够精细，眼睛是可以透光的。\n车形也是个亮点。我一直不喜欢电影版里那种狗头车，太张扬，反而G1里那种平头车更显内敛，才有大哥气质。\n做工和用料很不错。我不是孩控，做工和价格都很重要，祖国版用料很扎实，而且有合金部件，做工也不弱于孩版，再加上这白菜价，孩版就呵呵哒了。\n滚动性不好，有的车轮不能著地，而且部分车轮本身转动不畅。\n枪是可以发射子弹的，可玩性有加分。另买的审判之剑真的很帅，否则堂堂Prime单持一把大手枪显得太素了。\n变形的复杂度恰到好处，只是手臂收纳到车头时很紧，流畅度上有扣分。\n这是款很经典的模具，很期待放大的祖国合金版。\n","permalink":"http://0x3f.org/posts/transformers-optimus-prime/","summary":"\u003cp\u003e一开始我不太喜欢电影版变形金刚，因为太像人就缺少科技感，我至今都认为G1是不可逾越的经典。不过变4的这款V级平头OP确实是个经典的模具，一个好的变形金刚玩具应有标准几乎都符合。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EDFWGrQR/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e人形身材匀称、没有冗余部件，关键是无背包，很少有能做到这一点的模具，几乎所有大黄蜂最大的败笔都是有个巨大的背包。涂装鲜艳、视觉效果强烈，作为一个Prime，搞得满身火焰纹、花里胡哨的真的好么？\u003c/p\u003e\n\u003cp\u003e关节的松紧度方面，四肢主关节采用齿轮关节，表现不错，不过肘关节是圆形关节，转动次数多了不知道会不会松。\u003c/p\u003e\n\u003cp\u003e由于人形没有太多的累赘，所以可动性方面没有问题，腰部也是可以360度旋转的。\u003c/p\u003e\n\u003cp\u003e手脚方面，一个V级的玩具，用假手也就不说什么了。不过由于踝关节不能左右摆动，所以脚的接地性不好。\u003c/p\u003e\n\u003cp\u003e头雕不够精细，眼睛是可以透光的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EDFU2oxD/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e车形也是个亮点。我一直不喜欢电影版里那种狗头车，太张扬，反而G1里那种平头车更显内敛，才有大哥气质。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EDFU1X5C/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e做工和用料很不错。我不是孩控，做工和价格都很重要，祖国版用料很扎实，而且有合金部件，做工也不弱于孩版，再加上这白菜价，孩版就呵呵哒了。\u003c/p\u003e\n\u003cp\u003e滚动性不好，有的车轮不能著地，而且部分车轮本身转动不畅。\u003c/p\u003e\n\u003cp\u003e枪是可以发射子弹的，可玩性有加分。另买的审判之剑真的很帅，否则堂堂Prime单持一把大手枪显得太素了。\u003c/p\u003e\n\u003cp\u003e变形的复杂度恰到好处，只是手臂收纳到车头时很紧，流畅度上有扣分。\u003c/p\u003e\n\u003cp\u003e这是款很经典的模具，很期待放大的祖国合金版。\u003c/p\u003e","title":"变形金刚：原大祖国合金版平头OP"},{"content":"扩展内部的全局变量 1 2 3 4 ZEND_BEGIN_MODULE_GLOBALS(donie) unsigned long global_long; char *global_string; ZEND_END_MODULE_GLOBALS(donie) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 ZEND_DECLARE_MODULE_GLOBALS(donie); static void php_donie_init_globals(zend_donie_globals *donie_globals) { donie_globals-\u0026gt;global_long = 2015; donie_globals-\u0026gt;global_string = \u0026#34;Long live Donie Leigh !\u0026#34;; } static void php_donie_globals_dtor(zend_donie_globals *donie_globals) { php_printf(\u0026#34;php_donie_globals_dtor triggered.\u0026#34;); } PHP_MINIT_FUNCTION(donie) { /* init extension globals */ ZEND_INIT_MODULE_GLOBALS(donie, php_donie_init_globals, php_donie_globals_dtor); return SUCCESS; } PHP_RSHUTDOWN_FUNCTION(donie) { #ifndef ZTS php_donie_globals_dtor(\u0026amp;donie_globals); #endif return SUCCESS; } ZEND_FUNCTION(donie_test_ext_globals) { php_printf(\u0026#34;%s\u0026#34;, DONIE_G(global_string)); } 声明 ZEND_BEGIN_MODULE_GLOBALS和ZEND_END_MODULE_GLOBALS及其间的内容实际上声明了一个结构体zend_donie_globals。\n根据是否开启线程安全的情况，ZEND_DECLARE_MODULE_GLOBALS做不同的事：未开启线程安全，直接声明zend_donie_globals类型的变量；已开启线程安全，声明一个整形变量donie_globals_id。\n初始化 在未开启线程安全时，ZEND_INIT_MODULE_GLOBALS调用第二个参数指定的函数初始化全局变量；已开启线程安全时，调用ts_allocate_id()分配一个资源ID，并调用第二个参数代表的函数。\n访问 DONIE_G在扩展的头文件里，生成扩展框架时默认就有。\n销毁 开启线程安全时，ZEND_INIT_MODULE_GLOBALS的第三个参数指定的析构函数会自动被调用。未开启线程安全时，由于该宏只调用第二个参数初始化全局变量，第三个参数没有用，所以需要在MSHUTDOWN中手工调用析构函数。\n用户空间的超级全局变量 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 static zend_bool php_donie_autoglobal_callback(const char *name, uint name_len TSRMLS_DC) { zval *donie_val; MAKE_STD_ZVAL(donie_val); array_init(donie_val); add_next_index_string(donie_val, \u0026#34;Hello autoglobals !\u0026#34;, 1); ZEND_SET_SYMBOL(\u0026amp;EG(symbol_table), \u0026#34;_DONIE\u0026#34;, donie_val); return 0; } PHP_MINIT_FUNCTION(donie) { /* declare userspace super globals */ zend_register_auto_global(\u0026#34;_DONIE\u0026#34;, sizeof(\u0026#34;_DONIE\u0026#34;)-1, 0, php_donie_autoglobal_callback TSRMLS_CC); return SUCCESS; } zend_register_auto_global()注册了$_DONIE这样一个全局变量。在代码的编译时，如果PHP内核发现代码中没有使用这个全局变量，不会进行初始化；若有使用，会调用php_donie_autoglobal_callback进行初始化。PHP4中没有php_donie_autoglobal_callback这个参数。\nphp_donie_autoglobal_callback做的事就是初始化一个zval并加入符号表。如果此函数返回0，则只会被调用一次，如果返回非0，在代码编译时，每发现一次该全局变量，就调用一次这个函数。\n","permalink":"http://0x3f.org/posts/globals-implementation-in-php/","summary":"\u003ch2 id=\"扩展内部的全局变量\"\u003e扩展内部的全局变量\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003eZEND_BEGIN_MODULE_GLOBALS\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003eglobal_long\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eglobal_string\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003eZEND_END_MODULE_GLOBALS\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003eZEND_DECLARE_MODULE_GLOBALS\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_donie_init_globals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezend_donie_globals\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_globals\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003edonie_globals\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eglobal_long\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2015\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003edonie_globals\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eglobal_string\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Long live Donie Leigh !\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_donie_globals_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezend_donie_globals\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_globals\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ephp_printf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;php_donie_globals_dtor triggered.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_MINIT_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* init extension globals */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eZEND_INIT_MODULE_GLOBALS\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_donie_init_globals\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_donie_globals_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_RSHUTDOWN_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef ZTS\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"nf\"\u003ephp_donie_globals_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_globals\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003eZEND_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_test_ext_globals\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ephp_printf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;%s\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003eDONIE_G\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eglobal_string\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"声明\"\u003e声明\u003c/h3\u003e\n\u003cp\u003eZEND_BEGIN_MODULE_GLOBALS和ZEND_END_MODULE_GLOBALS及其间的内容实际上声明了一个结构体zend_donie_globals。\u003c/p\u003e","title":"PHP全局变量的实现和操作"},{"content":"存储结构 常量存储在哈希表EG(zend_constants)中。\n常量的结构定义为：\n1 2 3 4 5 6 7 typedef struct _zend_constant { zval value; int flags; char *name; uint name_len; int module_number; } zend_constant; value是常量的值，是一个zval。name是常量名。module_number是模块被加载时，PHP内核在MINIT和RINIT方法的原型里默认传递的一个值，作为模块清理时的线索，在注册常量的接口里直接传递即可。\nflags是常量的标识或标识组合：\nCONST_CS CONST_PERSISTENT CONST_CT_SUBST CONST_CS表示常量名对大小写敏感，对应PHP函数define()的第三个参数，TRUE、FALSE、NULL这些常量名对大小写是不敏感的。CONST_PERSISTENT表示常量在请求结束后被保存，只在PHP进程结束时才销毁，一般在MINIT中定义的常量应该指定此参数，RINIT中定义的不指定。CONST_CT_SUBST表示在编译时可替换，TRUE、FALSE、NULL、ZEND_THREAD_SAFE、ZEND_DEBUG_BUILD属于此类。\n常量的声明 常量的声明方法有两种，简单的使用宏函数族REGISTER_*_CONSTANT()：\nREGISTER_NULL_CONSTANT(name, flags) REGISTER_BOOL_CONSTANT(name, bval, flags) REGISTER_LONG_CONSTANT(name, lval, flags) REGISTER_DOUBLE_CONSTANT(name, dval, flags) REGISTER_STRING_CONSTANT(name, str, flags) REGISTER_STRINGL_CONSTANT(name, str, len, flags)\n由于不需指定常量名长度，所以name参数应直接使用字符串，而不是char*。\n如需使用变量作为name参数，使用zend_register_*_constant()函数族，并指定变量名长度（sizeof(name)）。上面的宏函数其实是对这族函数的封装。\nvoid zend_register_long_constant(char *name, uint name_len, long lval, int flags, int module_number TSRMLS_DC) void zend_register_double_constant(char *name, uint name_len, double dval, int flags, int module_number TSRMLS_DC) void zend_register_bool_constant(const char *name, uint name_len, zend_bool bval, int flags, int module_number TSRMLS_DC) void zend_register_string_constant(char *name, uint name_len, char *strval, int flags, int module_number TSRMLS_DC) void zend_register_stringl_constant(char *name, uint name_len, char *strval, uint strlen, int flags, int module_number TSRMLS_DC)\n除此之外，还有REGISTER_MAIN_*_CONSTANT和REGISTER_NS_*_CONSTANT两组宏函数。前者用于定义像E_ERROR这样的PHP标准常量，后者定义有命令空间的常量。\ndefine()和const define()是函数，在运行时定义常量 不能定义类常量 可以在条件语句中使用 可以指定常量是否对大小写敏感 可以用表达式作为常量值 只定义全局常量，不支持命名空间 const是语句，在编译时定义常量 可以定义类常量 不能在条件语句中使用 定义的常量对大小写敏感 不支持表达式作为常量值 若脚本定义了命名空间，声明的常量属于该命名空间 魔术常量 __LINE__\n__FILE__\n__DIR__\n__FUNCTION__\n__CLASS__\n__METHOD__\n__NAMESPACE__\n魔术常量是在编译时（具体地说是词法分析时，见Zend/zend_language_scanner.l）被替换，确切地说，这些不是真正意义上的常量，只是个模板占位符。\n","permalink":"http://0x3f.org/posts/constant-implementation-in-php/","summary":"\u003ch2 id=\"存储结构\"\u003e存储结构\u003c/h2\u003e\n\u003cp\u003e常量存储在哈希表EG(zend_constants)中。\u003c/p\u003e\n\u003cp\u003e常量的结构定义为：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_zend_constant\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ename_len\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emodule_number\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_constant\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003evalue是常量的值，是一个zval。name是常量名。module_number是模块被加载时，PHP内核在MINIT和RINIT方法的原型里默认传递的一个值，作为模块清理时的线索，在注册常量的接口里直接传递即可。\u003c/p\u003e\n\u003cp\u003eflags是常量的标识或标识组合：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCONST_CS\u003c/li\u003e\n\u003cli\u003eCONST_PERSISTENT\u003c/li\u003e\n\u003cli\u003eCONST_CT_SUBST\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCONST_CS表示常量名对大小写敏感，对应PHP函数define()的第三个参数，TRUE、FALSE、NULL这些常量名对大小写是不敏感的。CONST_PERSISTENT表示常量在请求结束后被保存，只在PHP进程结束时才销毁，一般在MINIT中定义的常量应该指定此参数，RINIT中定义的不指定。CONST_CT_SUBST表示在编译时可替换，TRUE、FALSE、NULL、ZEND_THREAD_SAFE、ZEND_DEBUG_BUILD属于此类。\u003c/p\u003e\n\u003ch2 id=\"常量的声明\"\u003e常量的声明\u003c/h2\u003e\n\u003cp\u003e常量的声明方法有两种，简单的使用宏函数族REGISTER_*_CONSTANT()：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eREGISTER_NULL_CONSTANT(name, flags)\nREGISTER_BOOL_CONSTANT(name, bval, flags)\nREGISTER_LONG_CONSTANT(name, lval, flags)\nREGISTER_DOUBLE_CONSTANT(name, dval, flags)\nREGISTER_STRING_CONSTANT(name, str, flags)\nREGISTER_STRINGL_CONSTANT(name, str, len, flags)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e由于不需指定常量名长度，所以name参数应直接使用字符串，而不是char*。\u003c/p\u003e\n\u003cp\u003e如需使用变量作为name参数，使用zend_register_*_constant()函数族，并指定变量名长度（sizeof(name)）。上面的宏函数其实是对这族函数的封装。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003evoid zend_register_long_constant(char *name, uint name_len, long lval, int flags, int module_number TSRMLS_DC)\nvoid zend_register_double_constant(char *name, uint name_len, double dval, int flags, int module_number TSRMLS_DC)\nvoid zend_register_bool_constant(const char *name, uint name_len, zend_bool bval, int flags, int module_number TSRMLS_DC)\nvoid zend_register_string_constant(char *name, uint name_len, char *strval, int flags, int module_number TSRMLS_DC)\nvoid zend_register_stringl_constant(char *name, uint name_len, char *strval, uint strlen, int flags, int module_number TSRMLS_DC)\u003c/p\u003e","title":"PHP常量的实现和操作"},{"content":"存储结构 资源变量也是一个zval结构，zval-\u0026gt;type == IS_RESOURCE，zval-\u0026gt;value-\u0026gt;lval存储一个整数，此整数为资源数据在存储资源的哈希表中的索引。\n资源数据的结构为：\n1 2 3 4 5 6 typedef struct _zend_rsrc_list_entry { void *ptr; int type; int refcount; }zend_rsrc_list_entry; 常规资源与持久资源 有两个存储资源数据的哈希表。EG(regular_list)存储常规资源，EG(persistent_list)存储持久资源。\n常规资源对应的变量在作用域结束后会被内核回收，对应的资源数据也会被销毁。持久资源可以保持并被多次请求使用。持久资源的自动析构发生在PHP进程退出时。\n实现 重新实现基本的文件句柄和相关操作。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 // 资源名称 #define PHP_DONIE_RES_NAME_FILE \u0026#34;Donie\u0026#39;s File Descriptor\u0026#34; // 资源类型 static int le_donie_file_descriptor; static int le_donie_file_descriptor_persist; // 资源析构函数 static void php_donie_file_descriptor_dtor(zend_rsrc_list_entry *rsrc TSRMLS_CC) { FILE *fp = (FILE*)rsrc-\u0026gt;ptr; fclose(fp); } // 在扩展的MINIT方法里创建资源类型 PHP_MINIT_FUNCTION(donie) { /* create a new resource type */ le_donie_file_descriptor = zend_register_list_destructors_ex( php_donie_file_descriptor_dtor, NULL, PHP_DONIE_RES_NAME_FILE, module_number ); /* create a persistent resource type */ le_donie_file_descriptor_persist = zend_register_list_destructors_ex( NULL, php_donie_file_descriptor_dtor, PHP_DONIE_RES_NAME_FILE, module_number ); return SUCCESS; } // 文件打开操作 PHP_FUNCTION(donie_fopen) { FILE *fp; char *filename, *mode; int filename_len, mode_len; zend_bool persist = 0; char *hash_key; int hash_key_len; list_entry *persist_file; if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \u0026#34;ss|b\u0026#34;, \u0026amp;filename, \u0026amp;filename_len, \u0026amp;mode, \u0026amp;mode_len, \u0026amp;persist) == FAILURE) { RETURN_NULL(); } if (!filename_len || !mode_len) { php_error_docref(NULL TSRMLS_CC, E_WARNING, \u0026#34;Invalid file name or mode.\u0026#34;); RETURN_FALSE; } /* reuse persistent resource if exists */ hash_key_len = spprintf(\u0026amp;hash_key, 0, \u0026#34;php_donie_file_descriptor:%s-%s\u0026#34;, filename, mode); if (zend_hash_find(\u0026amp;EG(persistent_list), hash_key, hash_key_len+1, (void **)\u0026amp;persist_file) == SUCCESS) { ZEND_REGISTER_RESOURCE(return_value, persist_file-\u0026gt;ptr, le_donie_file_descriptor_persist); efree(hash_key); return; } fp = fopen(filename, mode); if (!fp) { php_error_docref(NULL TSRMLS_CC, E_WARNING, \u0026#34;Failed opening %s with mode %s.\u0026#34;, filename, mode); RETURN_FALSE; } /* this is the key point for registering resources */ if (persist) { ZEND_REGISTER_RESOURCE(return_value, fp, le_donie_file_descriptor_persist); list_entry le; le.type = le_donie_file_descriptor_persist; le.ptr = fp; zend_hash_update(\u0026amp;EG(persistent_list), hash_key, hash_key_len+1, (void*)\u0026amp;le, sizeof(list_entry), NULL); } else { ZEND_REGISTER_RESOURCE(return_value, fp, le_donie_file_descriptor); } efree(hash_key); } // 文件写操作 PHP_FUNCTION(donie_fwrite) { FILE *fp; zval *file_resource; char *data; int data_len; if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \u0026#34;rs\u0026#34;, \u0026amp;file_resource, \u0026amp;data, \u0026amp;data_len) == FAILURE) { RETURN_NULL(); } ZEND_FETCH_RESOURCE2(fp, FILE*, \u0026amp;file_resource, -1, PHP_DONIE_RES_NAME_FILE, le_donie_file_descriptor, le_donie_file_descriptor_persist); RETURN_LONG(fwrite(data, 1, data_len, fp)); } // 文件关闭操作 PHP_FUNCTION(donie_fclose) { FILE *fp; zval *file_resource; if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \u0026#34;r\u0026#34;, \u0026amp;file_resource) == FAILURE) { RETURN_NULL(); } ZEND_FETCH_RESOURCE2(fp, FILE*, \u0026amp;file_resource, -1, PHP_DONIE_RES_NAME_FILE, le_donie_file_descriptor, le_donie_file_descriptor_persist); zend_hash_index_del(\u0026amp;EG(regular_list), Z_RESVAL_P(file_resource)); RETURN_TRUE; } 创建新资源类型 zend_register_list_destructors_ex()创建新资源类型，并注册该资源类型的析构函数、资源名称。第一个参数是常规资源的析构函数，第二个是持久资源的析构函数，此处创建的是常规资源类型，故第二个参数不指定。\n注册资源 宏函数ZEND_REGISTER_RESOURCE()注册新生成的资源到EG(regular_list)，并保存资源的索引到zval-\u0026gt;value-\u0026gt;lval中。\n双重引用计数 资源变量zval中存在一个引用计数，资源数据zend_rsrc_list_entry中也存在一个。前者遵循与其它变量一致的计数原则，后者取决于资源数据被几个资源变量zval引用。\n例如对于以下场景：\n1 2 3 4 5 \u0026lt;?php $a = donie_fopen(\u0026#39;/tmp/donie.txt\u0026#39;, \u0026#39;r\u0026#39;); $b = $a; $c = \u0026amp;$a; ?\u0026gt; a赋值给b时，zval的引用计数加一。a的引用赋值给c时，发生zval的拆分，b获得新的zval，引用计数是1，a和c共用一个zval，引用计数是2。此时，资源数据的引用计数加一。\n获取资源 ZEND_FETCH_RESOURCE()根据资源变量zval取出资源数据的ptr并验证资源类型。ZEND_FETCH_RESOURCE2()可以同时指定两个资源类型，任一类型匹配成功都可以。\n销毁资源 根据上述二重计数原则，只有当资源数据的引用计数为0时，资源的析构函数才会被调用，而销毁资源变量不一定能销毁资源，所以需要手工强制销毁资源。\nzend_hash_index_del()从EG(regular_list)中删除资源时，该资源类型注册的dtor会被自动调用，从而析构资源。\n持久资源 存储 EG(persistent_list)是个用字符串索引的哈希表。需要自行定义键的命名规则，做到全局唯一。\n创建持久资源类型 zend_register_list_destructors_ex()注册资源类型时，将析构函数指定为第二个参数，第一个参数为NULL。析构持久资源时，会自动调用该函数。\n注册持久资源 EG(persistent_list)中的资源数据并不被直接使用，对资源的操作仍然使用EG(regular_list)。故在注册持久资源时，两个哈希表中都需要保存一份。\n往EG(persistent_list)中存资源数据：\n1 2 3 4 5 6 7 char *hash_key; int hash_key_len; zend_rsrc_list_entry le; le.type = le_donie_file_descriptor_persist; le.ptr = fp; hash_key_len = spprintf(\u0026amp;hash_key, 0, \u0026#34;php_donie_file_descriptor:%s-%s\u0026#34;, filename, mode); zend_hash_update(\u0026amp;EG(persistent_list), hash_key, hash_key_len+1, (void*)\u0026amp;le, sizeof(list_entry), NULL); 获取持久资源 对持久资源的常规操作和操作常规资源一样，仍使用EG(regular_list)，因为变量zval中存储的是EG(regular_list)中的索引。所以需要先在EG(persistent_list)中查询，若资源存在，先注册到EG(regular_list)中，再进行后续操作。\n手动析构持久资源 用zend_hash_del()从EG(persistent_list)中删除资源数据即可自动触发析构函数。\n","permalink":"http://0x3f.org/posts/resource-implementation-in-php/","summary":"\u003ch2 id=\"存储结构\"\u003e存储结构\u003c/h2\u003e\n\u003cp\u003e资源变量也是一个zval结构，zval-\u0026gt;type == IS_RESOURCE，zval-\u0026gt;value-\u0026gt;lval存储一个整数，此整数为资源数据在存储资源的哈希表中的索引。\u003c/p\u003e\n\u003cp\u003e资源数据的结构为：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_zend_rsrc_list_entry\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erefcount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"n\"\u003ezend_rsrc_list_entry\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"常规资源与持久资源\"\u003e常规资源与持久资源\u003c/h3\u003e\n\u003cp\u003e有两个存储资源数据的哈希表。EG(regular_list)存储常规资源，EG(persistent_list)存储持久资源。\u003c/p\u003e\n\u003cp\u003e常规资源对应的变量在作用域结束后会被内核回收，对应的资源数据也会被销毁。持久资源可以保持并被多次请求使用。持久资源的自动析构发生在PHP进程退出时。\u003c/p\u003e\n\u003ch2 id=\"实现\"\u003e实现\u003c/h2\u003e\n\u003cp\u003e重新实现基本的文件句柄和相关操作。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e  1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 93\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 94\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 95\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 96\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 97\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 98\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 99\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e100\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e101\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e102\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e103\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e104\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e105\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e106\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e107\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e108\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e109\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e110\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e111\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e112\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e113\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e114\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e115\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 资源名称\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e#define PHP_DONIE_RES_NAME_FILE \u0026#34;Donie\u0026#39;s File Descriptor\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 资源类型\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor_persist\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 资源析构函数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ephp_donie_file_descriptor_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezend_rsrc_list_entry\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ersrc\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eFILE\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFILE\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ersrc\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003efclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 在扩展的MINIT方法里创建资源类型\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003ePHP_MINIT_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* create a new resource type */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ele_donie_file_descriptor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_register_list_destructors_ex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003ephp_donie_file_descriptor_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePHP_DONIE_RES_NAME_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emodule_number\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* create a persistent resource type */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ele_donie_file_descriptor_persist\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_register_list_destructors_ex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ephp_donie_file_descriptor_dtor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePHP_DONIE_RES_NAME_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emodule_number\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 文件打开操作\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003ePHP_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_fopen\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eFILE\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003efilename_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emode_len\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezend_bool\u003c/span\u003e \u003cspan class=\"n\"\u003epersist\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehash_key\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ehash_key_len\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003elist_entry\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epersist_file\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eZEND_NUM_ARGS\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ss|b\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003efilename_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emode_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epersist\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eRETURN_NULL\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efilename_len\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003emode_len\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003ephp_error_docref\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eE_WARNING\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Invalid file name or mode.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003eRETURN_FALSE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* reuse persistent resource if exists */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ehash_key_len\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003espprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ehash_key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;php_donie_file_descriptor:%s-%s\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_hash_find\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nf\"\u003eEG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epersistent_list\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ehash_key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehash_key_len\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epersist_file\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eSUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eZEND_REGISTER_RESOURCE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn_value\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epersist_file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor_persist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eefree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehash_key\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003efp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003efopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003ephp_error_docref\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eE_WARNING\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Failed opening %s with mode %s.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003eRETURN_FALSE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* this is the key point for registering resources */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epersist\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eZEND_REGISTER_RESOURCE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn_value\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor_persist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003elist_entry\u003c/span\u003e \u003cspan class=\"n\"\u003ele\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003ele\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor_persist\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003ele\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003ezend_hash_update\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nf\"\u003eEG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epersistent_list\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ehash_key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehash_key_len\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ele\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elist_entry\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eZEND_REGISTER_RESOURCE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn_value\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eefree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehash_key\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 文件写操作\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003ePHP_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_fwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eFILE\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efile_resource\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edata_len\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eZEND_NUM_ARGS\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;rs\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003efile_resource\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata_len\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eRETURN_NULL\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eZEND_FETCH_RESOURCE2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFILE\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003efile_resource\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePHP_DONIE_RES_NAME_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor_persist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eRETURN_LONG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003efwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 文件关闭操作\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003ePHP_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie_fclose\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eFILE\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003efile_resource\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eZEND_NUM_ARGS\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;r\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003efile_resource\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eRETURN_NULL\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eZEND_FETCH_RESOURCE2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFILE\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003efile_resource\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePHP_DONIE_RES_NAME_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ele_donie_file_descriptor_persist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ezend_hash_index_del\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nf\"\u003eEG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eregular_list\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nf\"\u003eZ_RESVAL_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile_resource\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eRETURN_TRUE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"创建新资源类型\"\u003e创建新资源类型\u003c/h3\u003e\n\u003cp\u003ezend_register_list_destructors_ex()创建新资源类型，并注册该资源类型的析构函数、资源名称。第一个参数是常规资源的析构函数，第二个是持久资源的析构函数，此处创建的是常规资源类型，故第二个参数不指定。\u003c/p\u003e","title":"PHP资源的实现和操作"},{"content":"Object的存储结构 对象实例用zval存储。zval-\u0026gt;type == IS_OBJECT，zval-\u0026gt;value-\u0026gt;obj存储zend_object_value类型的结构体变量。\n1 2 3 4 typedef struct _zend_object_value { zend_object_handle handle; const zend_object_handlers *handlers; } zend_object_value; zend_object_handle是一个unsigned int，是对象的ID。zend_object_handlers存储对象所有的行为。\nObject的实例化过程 Object的初始化用以下几个宏函数：\nobject_init(zval *arg) object_init_ex(zval *arg, zend_class_entry *class_type) object_and_properties_init(zval *arg, zend_class_entry *class_type, HashTable *properties) 底层都是调用_object_and_properties_init(zval *arg, zend_class_entry *class_type, HashTable *properties)实现。这个函数做以下几件事：\n检查类是否可实例化（例如接口、抽象类等不允许初始化） 处理类常量 检查类是否存在自定义实例化逻辑 若存在，调用自定义实例化逻辑 若不存在，调用缺省的函数zend_objects_new(zend_object **object, zend_class_entry *class_type) 把实例化的zend_object类型的数据存入zval中 zend_objects_new()做这些事：\n分配一个zend_object类型的内存空间 初始化zend_object类型数据 把zend_object类型数据存入对象仓库（Objects Store） zend_objects_store_put(void *object, zend_objects_store_dtor_t dtor, zend_objects_free_object_storage_t free_storage, zend_objects_store_clone_t clone） zend_object的存储结构 1 2 3 4 5 6 typedef struct _zend_object { zend_class_entry *ce; HashTable *properties; zval **properties_table; HashTable *guards; /* protects from __get/__set ... recursion */ } zend_object; ce是类的定义。properties_table存储类里预定义的属性。properties存储非预定义属性。\nguards存储属性名到zend_guard结构的映射关系。\n1 2 3 4 5 6 7 typedef struct _zend_guard { zend_bool in_get; zend_bool in_set; zend_bool in_unset; zend_bool in_isset; zend_bool dummy; /* sizeof(zend_guard) must not be equal to sizeof(void*) */ } zend_guard; 此结构用于在操作属性时，防止递归调用。例如给对象一个新属性赋值时，__set()函数理论上会递归调用自己，所以此结构用于判断该属性是否已在__set()中。\n属性的存储结构 在zend_object的存储结构里，哈希表properties存储类的非预定义属性的名称和值。\n对于预定义的属性，由于PHP的哈希表的存储开销很大，所以把属性信息（即下面的zend_property_info结构体）存储在zend_class_entry里，对象里用C的数组存储所有预定义属性的zval的指针，并把偏移量记录在属性信息里，这就是properties_table。\n1 2 3 4 5 6 7 8 9 10 typedef struct _zend_property_info { zend_uint flags; const char *name; int name_length; ulong h; /* hash of name */ int offset; /* storage offset */ const char *doc_comment; int doc_comment_len; zend_class_entry *ce; /* CE of declaring class */ } zend_property_info; 属性名的编码 在类的继承关系中，同名不同类型（public，private等）的属性各自单独存储，所以属性名在底层是经过编码的，规则如下：\nclass Foo { private $prop; } =\u0026gt; \u0026ldquo;\\0Foo\\0prop\u0026rdquo;\nclass Bar { private $prop; } =\u0026gt; \u0026ldquo;\\0Bar\\0prop\u0026rdquo;\nclass Rab { protected $prop; } =\u0026gt; \u0026ldquo;\\0*\\0prop\u0026rdquo;\nclass Oof { public $prop; } =\u0026gt; \u0026ldquo;prop\u0026rdquo;\n大部分情况下，对属性操作的API自动处理属性名的编码。只有当需要直接访问property_info-\u0026gt;name或zobj-\u0026gt;properties时才需要自行处理，此时使用zend_(un)mangle_property_name()函数。\nObjects Store的存储结构 对象仓库是一个可变数组，存储多个zend_object_store_bucket结构。\n1 2 3 4 5 6 typedef struct _zend_objects_store { zend_object_store_bucket *object_buckets; zend_uint top; zend_uint size; int free_list_head; } zend_objects_store; size是对象仓库的容量。top是下一个可用的对象句柄，对象句柄从1开始，以保证所有句柄都为真。对象仓库通过每个Bucket的free_list结构维护一个可用的Bucket链表，free_list_head记录链表的头部。\nzend_object_store_bucket的存储结构 每个对象的信息存储在一个bucket里。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 typedef struct _zend_object_store_bucket { zend_bool destructor_called; zend_bool valid; union _store_bucket { struct _store_object { void *object; zend_objects_store_dtor_t dtor; zend_objects_free_object_storage_t free_storage; zend_objects_store_clone_t clone; const zend_object_handlers *handlers; zend_uint refcount; gc_root_buffer *buffered; } obj; struct { int next; } free_list; } bucket; } zend_object_store_bucket; 桶被占用的时候，valid为1，否则为0。\n对象被销毁时，dtor被调用后，destructor_called被置为1，防止在被free时重复调用dtor，具体见Object的二阶销毁逻辑。\n_store_object里存储对象的主要信息。zend_objects_store_put()传入的zend_object结构体存储在object里。dtor和free_storage见Object的二阶销毁逻辑。clone是对象的克隆函数。handlers存储对象的一系列操作函数，缺省为std_object_handlers。refcount是对象的引用计数。buffered是垃圾回收需要用到的数据。\nfree_list记录对象仓库中可用的Bucket链表中下一个可用的Bucket。\nObject Store的操作 zend_objects_store_put()：注册对象到仓库 zend_object_store_get_object_by_handle()：通过对象句柄取对象 zend_object_store_get_object()：通过zval取对象，返回void* zend_objects_get_address()：和zend_object_store_get_object()一样，但返回zend_object* Object的二阶销毁逻辑 对象的销毁分两个步骤，一是对象的析构，一是内存的释放。前者调用对象的dtor，后者调用free_storage。一般先析构，再释放内存，但两者可各自分开执行。\ndtor中可以执行用户空间的PHP代码，主要是PHP类的__destruct()。PHP脚本执行完成后销毁对象并结束进程（executor shutdown），在这个过程进行到一半的时候执行用户空间代码可能会出问题，所以这么区别主要是为了在进程结束过程中不会调用用户空间代码。\n此外，dtor并不是必须执行的，如果一个对象的dtor调用的用户空间代码里执行了die()，后续对象的dtor不会被执行。所以大部分情况下，开发者可以自定义free_storage函数，而使用缺省的zend_objects_destroy_object作为dtor。\n","permalink":"http://0x3f.org/posts/object-implementation-in-php/","summary":"\u003ch2 id=\"object的存储结构\"\u003eObject的存储结构\u003c/h2\u003e\n\u003cp\u003e对象实例用zval存储。zval-\u0026gt;type == IS_OBJECT，zval-\u0026gt;value-\u0026gt;obj存储zend_object_value类型的结构体变量。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_zend_object_value\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ezend_object_handle\u003c/span\u003e \u003cspan class=\"n\"\u003ehandle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_object_handlers\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_object_value\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ezend_object_handle是一个unsigned int，是对象的ID。zend_object_handlers存储对象所有的行为。\u003c/p\u003e\n\u003ch2 id=\"object的实例化过程\"\u003eObject的实例化过程\u003c/h2\u003e\n\u003cp\u003eObject的初始化用以下几个宏函数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eobject_init(zval *arg)\u003c/li\u003e\n\u003cli\u003eobject_init_ex(zval *arg, zend_class_entry *class_type)\u003c/li\u003e\n\u003cli\u003eobject_and_properties_init(zval *arg, zend_class_entry *class_type, HashTable *properties)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e底层都是调用_object_and_properties_init(zval *arg, zend_class_entry *class_type, HashTable *properties)实现。这个函数做以下几件事：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e检查类是否可实例化（例如接口、抽象类等不允许初始化）\u003c/li\u003e\n\u003cli\u003e处理类常量\u003c/li\u003e\n\u003cli\u003e检查类是否存在自定义实例化逻辑\n\u003cul\u003e\n\u003cli\u003e若存在，调用自定义实例化逻辑\u003c/li\u003e\n\u003cli\u003e若不存在，调用缺省的函数zend_objects_new(zend_object **object, zend_class_entry *class_type)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e把实例化的zend_object类型的数据存入zval中\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ezend_objects_new()做这些事：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e分配一个zend_object类型的内存空间\u003c/li\u003e\n\u003cli\u003e初始化zend_object类型数据\u003c/li\u003e\n\u003cli\u003e把zend_object类型数据存入对象仓库（Objects Store）\n\u003cul\u003e\n\u003cli\u003ezend_objects_store_put(void *object, zend_objects_store_dtor_t dtor, zend_objects_free_object_storage_t free_storage, zend_objects_store_clone_t clone）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"zend_object的存储结构\"\u003ezend_object的存储结构\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_zend_object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ezend_class_entry\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ece\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003eproperties_table\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eguards\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* protects from __get/__set ... recursion */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_object\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ece是类的定义。properties_table存储类里预定义的属性。properties存储非预定义属性。\u003c/p\u003e","title":"PHP对象的实现和操作"},{"content":"Class的实现 类的注册是在扩展的MINIT方法里。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 /* * this pointer should be put into the header file, * so other modules can access this class. */ zend_class_entry *c_leigh; /* just a simple method. */ PHP_METHOD(Leigh, helloWorld) { if (zend_parse_parameters_none() == FAILURE) { return; } php_printf(\u0026#34;Hello World !\\n\u0026#34;); } /* getting handle of this object. */ PHP_METHOD(Leigh, getObjectHandle) { zval *obj; if (zend_parse_parameters_none() == FAILURE) { return; } obj = getThis(); RETURN_LONG(Z_OBJ_HANDLE_P(obj)); } /* get value of the property \u0026#39;bloodType\u0026#39; */ PHP_METHOD(Leigh, getBloodType) { zval *obj, *blood_type; if (zend_parse_parameters_none() == FAILURE) { return; } obj = getThis(); blood_type = zend_read_property(c_leigh, obj, \u0026#34;bloodType\u0026#34;, sizeof(\u0026#34;bloodType\u0026#34;) - 1, 1 TSRMLS_CC); RETURN_ZVAL(blood_type, 1, 0); } /* set value of the property \u0026#39;bloodType\u0026#39; */ PHP_METHOD(Leigh, setBloodType) { zval *obj, *new_value; if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \u0026#34;z\u0026#34;, \u0026amp;new_value) == FAILURE) { return; } obj = getThis(); zend_update_property(c_leigh, obj, \u0026#34;bloodType\u0026#34;, sizeof(\u0026#34;bloodType\u0026#34;)-1, new_value TSRMLS_CC); } const zend_function_entry leigh_functions[] = { PHP_ME(Leigh, helloWorld, NULL, ZEND_ACC_PUBLIC) PHP_ME(Leigh, getObjectHandle, NULL, ZEND_ACC_PUBLIC) PHP_ME(Leigh, getBloodType, NULL, ZEND_ACC_PUBLIC) PHP_ME(Leigh, setBloodType, NULL, ZEND_ACC_PUBLIC) /* PHP_ABSTRACT_ME(Leigh, abstractMethod, NULL) // abstract method */ PHP_FE_END }; /* * create a new class inheriting Leigh */ zend_class_entry *c_hero; /* * create an interface */ zend_class_entry *i_superman; const zend_function_entry superman_functions[] = { PHP_ABSTRACT_ME(ISuperman, saveEarth, NULL) PHP_FE_END }; /* PHP_MINIT_FUNCTION */ PHP_MINIT_FUNCTION(donie) { /* If you have INI entries, uncomment these lines REGISTER_INI_ENTRIES(); */ time_of_minit = time(NULL); /* register a class */ zend_class_entry tmp_leigh; INIT_CLASS_ENTRY(tmp_leigh, \u0026#34;Leigh\u0026#34;, leigh_functions); c_leigh = zend_register_internal_class(\u0026amp;tmp_leigh TSRMLS_CC); /* declare a property initialized as null */ zend_declare_property_null(c_leigh, \u0026#34;bloodType\u0026#34;, sizeof(\u0026#34;bloodType\u0026#34;)-1, ZEND_ACC_PUBLIC TSRMLS_CC); /* declare a class constant */ zend_declare_class_constant_double(c_leigh, \u0026#34;PI\u0026#34;, sizeof(\u0026#34;PI\u0026#34;)-1, 3.1415926 TSRMLS_CC); /* declare an interface */ zend_class_entry tmp_superman; INIT_CLASS_ENTRY(tmp_superman, \u0026#34;ISuperman\u0026#34;, superman_functions); i_superman = zend_register_internal_interface(\u0026amp;tmp_superman TSRMLS_CC); /* inherit a class and implement an interface*/ zend_class_entry tmp_hero; INIT_CLASS_ENTRY(tmp_hero, \u0026#34;Hero\u0026#34;, NULL); c_hero = zend_register_internal_class_ex(\u0026amp;tmp_hero, c_leigh, NULL TSRMLS_CC); zend_class_implements(c_hero TSRMLS_CC, 1, i_superman); return SUCCESS; } 方法修饰符 ZEND_ACC_PUBLIC\nZEND_ACC_PROTECTED\nZEND_ACC_PRIVATE\nZEND_ACC_STATIC\nZEND_ACC_FINAL\nZEND_ACC_ABSTRACT\n不直接在PHP_ME里使用ZEND_ACC_ABSTRACT定义抽象方法，用PHP_ABSTRACT_ME()。\n取对象句柄 在方法的定义里使用getThis()拿当前对象的句柄。\n属性的声明和存取 zend_declare_property_null(\u0026hellip; TSRMLS_DC)\nzend_declare_property_bool(\u0026hellip;, long value TSRMLS_DC)\nzend_declare_property_long(\u0026hellip;, long value TSRMLS_DC)\nzend_declare_property_double(\u0026hellip;, double value TSRMLS_DC)\nzend_declare_property_string(\u0026hellip;, const char *value TSRMLS_DC)\nzend_declare_property_stringl(\u0026hellip;, const char *value, int value_len TSRMLS_DC)\n属性的修饰符和方法相同。\n属性的获取使用zend_read_property_*()这组函数。\n属性的更新使用zend_update_property_*()这组函数。\n静态属性的获取和更新分别使用zend_read_static_property_*()函数组和zend_update_static_property_*()函数组。与以上不同的是，参数中不需要对象句柄。\n类常量的声明使用zend_declare_class_constant_*()函数组，参数与声明属性相同，只是不需要修饰符。\n继承类 用zend_register_internal_class_ex()。\n声明接口 和声明类一样，先声明一组抽象方法，然后用zend_register_internal_interface()注册。\n实现接口 用zend_class_implements()。\n","permalink":"http://0x3f.org/posts/class-interface-implementation-in-php/","summary":"\u003ch2 id=\"class的实现\"\u003eClass的实现\u003c/h2\u003e\n\u003cp\u003e类的注册是在扩展的MINIT方法里。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e  1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 93\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 94\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 95\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 96\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 97\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 98\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 99\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e100\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e101\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e102\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e103\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e104\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e105\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e106\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e107\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e108\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e109\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e110\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e111\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e112\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e113\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e114\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e115\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e116\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e117\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e118\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e119\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * this pointer should be put into the header file,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * so other modules can access this class.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ezend_class_entry\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ec_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* just a simple method. */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_METHOD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehelloWorld\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters_none\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nf\"\u003ephp_printf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Hello World !\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* getting handle of this object. */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_METHOD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egetObjectHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters_none\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003egetThis\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eRETURN_LONG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eZ_OBJ_HANDLE_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* get value of the property \u0026#39;bloodType\u0026#39; */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_METHOD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egetBloodType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eblood_type\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters_none\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003egetThis\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eblood_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_read_property\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;bloodType\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;bloodType\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nf\"\u003eRETURN_ZVAL\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eblood_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* set value of the property \u0026#39;bloodType\u0026#39; */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_METHOD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esetBloodType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enew_value\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ezend_parse_parameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eZEND_NUM_ARGS\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;z\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003enew_value\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eFAILURE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003egetThis\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ezend_update_property\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;bloodType\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;bloodType\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enew_value\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_function_entry\u003c/span\u003e \u003cspan class=\"n\"\u003eleigh_functions\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ePHP_ME\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehelloWorld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZEND_ACC_PUBLIC\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ePHP_ME\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egetObjectHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZEND_ACC_PUBLIC\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ePHP_ME\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egetBloodType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZEND_ACC_PUBLIC\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ePHP_ME\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLeigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esetBloodType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZEND_ACC_PUBLIC\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* PHP_ABSTRACT_ME(Leigh, abstractMethod, NULL)      // abstract method */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ePHP_FE_END\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * create a new class inheriting Leigh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ezend_class_entry\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ec_hero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * create an interface\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ezend_class_entry\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei_superman\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_function_entry\u003c/span\u003e \u003cspan class=\"n\"\u003esuperman_functions\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ePHP_ABSTRACT_ME\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eISuperman\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esaveEarth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ePHP_FE_END\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*  PHP_MINIT_FUNCTION\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ePHP_MINIT_FUNCTION\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edonie\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* If you have INI entries, uncomment these lines\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\tREGISTER_INI_ENTRIES();\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003etime_of_minit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* register a class */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezend_class_entry\u003c/span\u003e \u003cspan class=\"n\"\u003etmp_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eINIT_CLASS_ENTRY\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmp_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Leigh\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eleigh_functions\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ec_leigh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_register_internal_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003etmp_leigh\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* declare a property initialized as null */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ezend_declare_property_null\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;bloodType\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;bloodType\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eZEND_ACC_PUBLIC\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* declare a class constant */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ezend_declare_class_constant_double\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;PI\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;PI\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e3.1415926\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* declare an interface */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezend_class_entry\u003c/span\u003e \u003cspan class=\"n\"\u003etmp_superman\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eINIT_CLASS_ENTRY\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmp_superman\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ISuperman\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esuperman_functions\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ei_superman\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_register_internal_interface\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003etmp_superman\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/* inherit a class and implement an interface*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ezend_class_entry\u003c/span\u003e \u003cspan class=\"n\"\u003etmp_hero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eINIT_CLASS_ENTRY\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmp_hero\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Hero\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ec_hero\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_register_internal_class_ex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003etmp_hero\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec_leigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ezend_class_implements\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec_hero\u003c/span\u003e \u003cspan class=\"n\"\u003eTSRMLS_CC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei_superman\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch4 id=\"方法修饰符\"\u003e方法修饰符\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003eZEND_ACC_PUBLIC\u003cbr\u003e\nZEND_ACC_PROTECTED\u003cbr\u003e\nZEND_ACC_PRIVATE\u003cbr\u003e\nZEND_ACC_STATIC\u003cbr\u003e\nZEND_ACC_FINAL\u003cbr\u003e\nZEND_ACC_ABSTRACT\u003c/p\u003e","title":"PHP类和接口的实现"},{"content":"变形金刚是工业艺术的巅峰之作。不仅仅是怀旧和补童年。理工宅两大图腾，恐龙和机器人。从没有一个东西像汽车人恐龙部队一样，把这两样完美地融为一体。\n孩之宝的东西很多时候不尽如人意，价格又太贵。有一些第三方的仿品，不乏精品。像威将的这个钢锁，是孩之宝V级的放大版，几乎与L级等身，头部和大腿根部是合金部件，很有质感。有美版和黑暗两个涂装，结合放大后的形象，黑暗涂装更显霸气。\n美版L级人形。整体精致，但是太瘦，两条腿细得跟小儿麻痺似的，盈盈一掬的小蛮腰，这是要走长腿欧巴路线啊。这个比例，如果放大一号效果会更好，不过钢锁老大比其它L级大一号不是理所当然的么。最讨厌的是电镀，又俗又易脱落。\n美版L级龙形。非常失败。身体比例失调，趴耳朵，塌脊梁，短尾巴。不忍直视。\n祖国版V级人形。V级钢锁是不以人形见长的，不过放大后观感尚可。\n祖国版V级龙形。V级钢锁的龙形完爆L级，体形霸气，立耳，隆背，翘尾。孩版V级最大的遗憾就是体形太小，祖国版龙形堪称完美。\n不知道是不是我中奖了，祖国版人形的大腿根部虽然是球齿关节，但是球齿无效，关节比较松，容易劈叉。不过这个做工、用料，只要几十软妹币，相对几倍价格的孩版来说，威将良心之作啊。\n","permalink":"http://0x3f.org/posts/transformers-grim-lock/","summary":"\u003cp\u003e变形金刚是工业艺术的巅峰之作。不仅仅是怀旧和补童年。\u003cstrong\u003e理工宅两大图腾，恐龙和机器人。从没有一个东西像汽车人恐龙部队一样，把这两样完美地融为一体。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e孩之宝的东西很多时候不尽如人意，价格又太贵。有一些第三方的仿品，不乏精品。像威将的这个钢锁，是孩之宝V级的放大版，几乎与L级等身，头部和大腿根部是合金部件，很有质感。有美版和黑暗两个涂装，结合放大后的形象，黑暗涂装更显霸气。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EBG8vXei/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e美版L级人形。整体精致，但是太瘦，两条腿细得跟小儿麻痺似的，盈盈一掬的小蛮腰，这是要走长腿欧巴路线啊。这个比例，如果放大一号效果会更好，不过钢锁老大比其它L级大一号不是理所当然的么。最讨厌的是电镀，又俗又易脱落。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EBG8wf4l/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e美版L级龙形。非常失败。身体比例失调，趴耳朵，塌脊梁，短尾巴。不忍直视。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EBG8wIB3/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e祖国版V级人形。V级钢锁是不以人形见长的，不过放大后观感尚可。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EBG8x7KX/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e祖国版V级龙形。V级钢锁的龙形完爆L级，体形霸气，立耳，隆背，翘尾。孩版V级最大的遗憾就是体形太小，祖国版龙形堪称完美。\u003c/p\u003e\n\u003cp\u003e不知道是不是我中奖了，祖国版人形的大腿根部虽然是球齿关节，但是球齿无效，关节比较松，容易劈叉。不过这个做工、用料，只要几十软妹币，相对几倍价格的孩版来说，威将良心之作啊。\u003c/p\u003e","title":"变形金刚：俺钢锁才是老大"},{"content":"存储结构 和其它变量一样，PHP的数组也是一个zval。存储数据的哈希表存放在zval-\u0026gt;value-\u0026gt;ht中。\n符号表操作 为实现可转换成整数的字符串键与整数键指向同一个元素，在哈希表操作的基础上封装了一层，对可转换成整数的字符串键转换成整数，然后调用zend_hash_index_*操作，否则调用zend_hash_*操作。这就是符号表操作。\n用ZEND_HANDLE_NUMERIC处理整数字符串键：\n1 2 3 4 5 6 static inline int zend_symtable_find( HashTable *ht, const char *arKey, uint nKeyLength, void **pData ) { ZEND_HANDLE_NUMERIC(arKey, nKeyLength, zend_hash_index_find(ht, idx, pData)); return zend_hash_find(ht, arKey, nKeyLength, pData); } 其它符号表操作函数：\n1 2 3 4 5 6 7 8 static inline int zend_symtable_exists(HashTable *ht, const char *arKey, uint nKeyLength); static inline int zend_symtable_del(HashTable *ht, const char *arKey, uint nKeyLength); static inline int zend_symtable_update( HashTable *ht, const char *arKey, uint nKeyLength, void *pData, uint nDataSize, void **pDest ); static inline int zend_symtable_update_current_key_ex( HashTable *ht, const char *arKey, uint nKeyLength, int mode, HashPosition *pos ); 数组操作 初始化 1 2 3 4 5 6 7 8 9 // 初始化数组 zval *zv1; array_init(zv1); // 初始化数组并指定哈希表nTableSize的值 array_init_size(zv1, 100); // 在函数中返回数组：把返回值初始化为数组 array_init(return_value); 插入和更新 1 2 3 4 5 6 7 8 /* Insert at next index */ int add_next_index_*(zval *arg, ...); /* Insert at specific index */ int add_index_*(zval *arg, ulong idx, ...); /* Insert at specific key */ int add_assoc_*(zval *arg, const char *key, ...); /* Insert at specific key of length key_len (for binary safety) */ int add_assoc_*_ex(zval *arg, const char *key, uint key_len, ...); 星号表示类型名，可用类型名如下：\nType Additional arguments null none bool int b long long n double double d string const char *str, int duplicate stringl const char *str, uint length, int duplicate resource int r zval zval *value 字符串长度的处理 上述操作对字符串键和字符串值的长度的要求不同。_ex函数要求传入字符串键的长度，此长度包含NUL字节。_stringl函数要求传入字符串值的长度，此长度不包含NUL字节。\n栗子 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 PHP_FUNCTION(donie_get_arr) { array_init(return_value); // add an integer to the given position add_index_long(return_value, 1, 2015); // append a string to the array add_next_index_string(return_value, \u0026#34;dummy string\u0026#34;, 1); // add a boolean value to the given key add_assoc_bool(return_value, \u0026#34;rightOrWrong\u0026#34;, 0); // take care of string lengths add_assoc_stringl_ex(return_value, \u0026#34;keyStringL\\0\u0026#34;, sizeof(\u0026#34;keyStringL\\0\u0026#34;)-1, \u0026#34;valueEx\\0\u0026#34;, sizeof(\u0026#34;valueEx\\0\u0026#34;), 1); // store an object in the array zval *obj; MAKE_STD_ZVAL(obj); object_init(obj); add_next_index_zval(return_value, obj); } ","permalink":"http://0x3f.org/posts/array-implementation-in-php/","summary":"\u003ch2 id=\"存储结构\"\u003e存储结构\u003c/h2\u003e\n\u003cp\u003e和其它变量一样，PHP的数组也是一个zval。存储数据的哈希表存放在zval-\u0026gt;value-\u0026gt;ht中。\u003c/p\u003e\n\u003ch2 id=\"符号表操作\"\u003e符号表操作\u003c/h2\u003e\n\u003cp\u003e为实现可转换成整数的字符串键与整数键指向同一个元素，在哈希表操作的基础上封装了一层，对可转换成整数的字符串键转换成整数，然后调用zend_hash_index_*操作，否则调用zend_hash_*操作。这就是符号表操作。\u003c/p\u003e\n\u003cp\u003e用ZEND_HANDLE_NUMERIC处理整数字符串键：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_symtable_find\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003epData\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nf\"\u003eZEND_HANDLE_NUMERIC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_hash_index_find\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epData\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_hash_find\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epData\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e其它符号表操作函数：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_symtable_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_symtable_del\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_symtable_update\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enDataSize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003epDest\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ezend_symtable_update_current_key_ex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eHashPosition\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"数组操作\"\u003e数组操作\u003c/h2\u003e\n\u003ch3 id=\"初始化\"\u003e初始化\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e9\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 初始化数组\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ezv1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003earray_init\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezv1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 初始化数组并指定哈希表nTableSize的值\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003earray_init_size\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezv1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 在函数中返回数组：把返回值初始化为数组\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003earray_init\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereturn_value\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"插入和更新\"\u003e插入和更新\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* Insert at next index */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_next_index_\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* Insert at specific index */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_index_\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eulong\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* Insert at specific key */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_assoc_\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* Insert at specific key of length key_len (for binary safety) */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_assoc_\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nf\"\u003e_ex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003ekey_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e星号表示类型名，可用类型名如下：\u003c/p\u003e","title":"PHP数组的实现与操作"},{"content":"结构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // 哈希表结构 typedef struct _hashtable { uint nTableSize; uint nTableMask; uint nNumOfElements; // 全部元素数 ulong nNextFreeElement; // 下一个可用的整数键 Bucket *pInternalPointer; // 枚举操作时使用，指向当前Bucket Bucket *pListHead; Bucket *pListTail; Bucket **arBuckets; dtor_func_t pDestructor; // 元素的析构函数 zend_bool persistent; // 是否在本次请求结束后保留哈希表 unsigned char nApplyCount; // 循环级别，防止循环引用导致遍历哈希表时死循环 zend_bool bApplyProtection; // 是否防止死循环 #if ZEND_DEBUG int inconsistent; #endif } HashTable; // Bucket结构 typedef struct bucket { ulong h; uint nKeyLength; void *pData; void *pDataPtr; struct bucket *pListNext; struct bucket *pListLast; struct bucket *pNext; struct bucket *pLast; char *arKey; } Bucket; 哈希冲突处理 哈希表通过计算键值的哈希值，将对应的数据映射到对应的槽上。理论上会存在不同的键的哈希值相同的情况。\n处理哈希冲突的方法一般有两种：开放寻址和链表。开放寻址法是将冲突的元素顺序放到下一个空槽，理论上会导致冲突越来越多，性能快速下降。链表法是将冲突的元素插入对应的槽，与前一个元素组成一个链表。PHP使用链表法。\nPHP的哈希表中的Buckets组成两种双向链表。一种由每个槽中的所有Bucket分别组成，一种是整个哈希表中的Bucket组成一个。Bucket结构里，pNext指向该槽的链表中的下一个Bucket，pLast指向上一个；pListNext指向整个哈希表链表的下一个Bucket，pListLast指向上一个。\npData与pDataPtr 赋值到Bucket时，数据会被复制一份，pData中保存指向该数据拷贝的指针。特别地，如果保存一个指针到Bucket，会先将该指针保存到pDataPtr，然后将pData指向pDataPtr，即pData中保存的是指向pDataPtr中保存的指针的指针。这样可以避免一次拷贝数据时分配内存的操作，提高效率。\nnTableSize与nTableMask nTableSize保存的是arBuckets的Bucket个数。它的值永远是个大于等于8的、2的n次方的整数。当现有容量不满足需要时，arBuckets会重新分配一个大小是原来两倍的空间，nTableSize相应地被更新为新的数值。\nnTableMask = nTableSize - 1\n哈希值h一般比nTableSize大，所以要用哈希值对nTableSize取模，以确定对应的Bucket。由于取模操作运算量大，且nTableSize永远是2的n次幂，所以用“h \u0026amp; (nTableSize - 1)”替代。\n初始化与销毁 1 2 3 4 5 6 7 8 9 10 11 12 13 // init hashtable HashTable *myht; ALLOC_HASHTABLE(myht); if (zend_hash_init(myht, 100, NULL, NULL, 0) == FAILURE) { FREE_HASHTABLE(myht); return FAILURE; } // destroy hashtable zend_hash_destroy(myht); FREE_HASHTABLE(myht); return SUCCESS; 初始化哈希表 ALLOC_HASHTABLE就是用emalloc()分配内存。\nzend_hash_init() zend_hash_init(HashTable *ht, uint nSize, dtor_func_t pDestructor, zend_bool persistent ZEND_FILE_LINE_DC)\nnSize是哈希表的初始长度，实际分配为最接近指定值的2的n次方，最小为8。\npDestructor是被存储数据的析构函数，默认为ZVAL_PTR_DTOR，对于一般情况（Bucket中存储的是zval）适用。\npersistent，1表示本次请求结束后保留哈希表，0反之。\n销毁哈希表 zend_hash_clean()对HT所有Bucket调用析构函数，并重置HT的所有指针。\nzend_hash_destroy()除了销毁所有Bucket存储的数据，连arBuckets的空间也释放掉。\nFREE_HASHTABLE宏其实就是efree()。\n操作数字键 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 // add a string with an integer key 2 to myht zval *zv1; MAKE_STD_ZVAL(zv1); ZVAL_STRING(zv1, \u0026#34;Hello HT !\u0026#34;, 1); zend_hash_index_update(myht, 2, \u0026amp;zv1, sizeof(zval *), NULL); // get the next free key php_printf(\u0026#34;The next free key will be %ld.\\n\u0026#34;, zend_hash_next_free_element(myht)); // append an integer to myht zval *zv2; MAKE_STD_ZVAL(zv2); ZVAL_LONG(zv2, 2015); if (zend_hash_next_index_insert(myht, \u0026amp;zv2, sizeof(zval *), NULL) == FAILURE) { php_printf(\u0026#34;HashTable appendation failed.\\n\u0026#34;); } else { php_printf(\u0026#34;HashTable appendation succeeded.\\n\u0026#34;); } // get the size php_printf(\u0026#34;HashTable has a size of %d.\\n\u0026#34;, zend_hash_num_elements(myht)); // check if an integer key exists int idx = 3; if (zend_hash_index_exists(myht, idx)) { php_printf(\u0026#34;HashTable has an index of the value %ld.\\n\u0026#34;, idx); } else { php_printf(\u0026#34;HashTable does not have an index of the value %ld.\\n\u0026#34;, idx); } // get a value by its key zval **zval_dest; if (zend_hash_index_find(myht, idx, (void **) \u0026amp;zval_dest) == SUCCESS) { php_printf(\u0026#34;The value indexed by %ld is %Z.\\n\u0026#34;, idx, *zval_dest); } else { php_printf(\u0026#34;The value indexed by %ld does not exist.\\n\u0026#34;, idx); } // delete the specified value from myht if (zend_hash_index_del(myht, idx) == FAILURE) { php_printf(\u0026#34;The value indexed by %ld failed to be deleted.\\n\u0026#34;, idx); } else { php_printf(\u0026#34;The value indexed by %ld is deleted.\\n\u0026#34;, idx); } 操作字符串键 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 // add an integer indexed by a string key, using zend_hash_update() zval *zv3; MAKE_STD_ZVAL(zv3); ZVAL_LONG(zv3, 1985); zend_hash_update(myht, \u0026#34;year\u0026#34;, sizeof(\u0026#34;year\u0026#34;), \u0026amp;zv3, sizeof(zval *), NULL); php_printf(\u0026#34;An integer is updated to the hash-table indexed by a string key.\\n\u0026#34;); // add a string indexed by a string key, using zend_hash_add() zval *zv4; MAKE_STD_ZVAL(zv4); ZVAL_STRING(zv4, \u0026#34;Great Donie !\u0026#34;, 1); if (zend_hash_add(myht, \u0026#34;motto\u0026#34;, sizeof(\u0026#34;motto\u0026#34;), \u0026amp;zv4, sizeof(zval *), NULL) == FAILURE) { php_printf(\u0026#34;Cannot add a string indexed by a string key to the hash-table, may be the index already exists.\\n\u0026#34;); } else { php_printf(\u0026#34;A string is added to the hash-table indexed by a string key.\\n\u0026#34;); } // get the next free key php_printf(\u0026#34;The next free key will be %ld.\\n\u0026#34;, zend_hash_next_free_element(myht)); // check if a string key exists char *key1 = \u0026#34;year\u0026#34;; if (zend_hash_exists(myht, key1, strlen(key1)+1)) { php_printf(\u0026#34;The key %s exists.\\n\u0026#34;, key1); } else { php_printf(\u0026#34;The key %s does not exist.\\n\u0026#34;, key1); } // get the value indexed by a string key zval **zv_dest2; if (zend_hash_find(myht, key1, strlen(key1)+1, (void **) \u0026amp;zv_dest2) == SUCCESS) { php_printf(\u0026#34;The value indexed by %s is %Z.\\n\u0026#34;, key1, *zv_dest2); } else { php_printf(\u0026#34;Failed fetching the value indexed by %s.\\n\u0026#34;, key1); } // delete the value indexed by a string key if (zend_hash_del(myht, key1, strlen(key1)+1) == SUCCESS) { php_printf(\u0026#34;The value indexed by %s is deleted.\\n\u0026#34;, key1); } else { php_printf(\u0026#34;The value indexed by %s failed to be deleted.\\n\u0026#34;, key1); } 键的长度 键长包括键字符串末尾的NUL字节。如果直接指定，应是sizeof(\u0026ldquo;key1\u0026rdquo;)；如果是char*类型变量，应是strlen(key1)+1。\n快速操作 适用于频繁操作特定键的场景，只计算一次哈希值，加速操作。\n对应的，有一组名带“quick”的函数。\n1 2 3 4 5 6 7 8 9 // quick operations leveraging a one-time hashed value zval *zv5; MAKE_STD_ZVAL(zv5); ZVAL_STRING(zv5, \u0026#34;Great Donie Leigh !\u0026#34;, 1); ulong h; h = zend_get_hash_value(\u0026#34;motto\u0026#34;, sizeof(\u0026#34;motto\u0026#34;)); zend_hash_quick_update(myht, \u0026#34;motto\u0026#34;, sizeof(\u0026#34;motto\u0026#34;), h, \u0026amp;zv5, sizeof(zval *), NULL); php_printf(\u0026#34;The value indexed by motto is updated with the quick operation.\\n\u0026#34;); 遍历 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 static int hashtable_traverse_callback(void *pDest TSRMLS_DC, int num_args, va_list args, zend_hash_key *hash_key) { zval **zv = (zval **) pDest; char *arg1 = va_arg(args, char*); php_printf(\u0026#34;The first argument is %s.\\n\u0026#34;, arg1); if (hash_key-\u0026gt;nKeyLength == 0) { php_printf(\u0026#34;K-V: %d=\u0026gt;%Z\\n\u0026#34;, hash_key-\u0026gt;h, *zv); } else { php_printf(\u0026#34;K-V: %s=\u0026gt;%Z\\n\u0026#34;, hash_key-\u0026gt;arKey, *zv); } return ZEND_HASH_APPLY_KEEP; } // traverse the hash table. zend_hash_apply_with_arguments(myht, hashtable_traverse_callback, 1, \u0026#34;nonsense\u0026#34;); 三个函数 遍历哈希表的三个函数：\n1 2 3 4 5 6 7 void zend_hash_apply(HashTable *ht, apply_func_t apply_func TSRMLS_DC); void zend_hash_apply_with_argument( HashTable *ht, apply_func_arg_t apply_func, void *argument TSRMLS_DC ); void zend_hash_apply_with_arguments( HashTable *ht TSRMLS_DC, apply_func_args_t apply_func, int num_args, ... ); 三个函数接受的回调函数的类型：\n1 2 3 4 5 typedef int (*apply_func_t)(void *pDest TSRMLS_DC); typedef int (*apply_func_arg_t)(void *pDest, void *argument TSRMLS_DC); typedef int (*apply_func_args_t)( void *pDest TSRMLS_DC, int num_args, va_list args, zend_hash_key *hash_key ); zend_hash_key的定义为：\n1 2 3 4 5 typedef struct _zend_hash_key { const char *arKey; uint nKeyLength; ulong h; } zend_hash_key; nKeyLength为0表示索引是整数，值为h；否则是字符串，值为arKey。\n回调函数的返回值：\nZEND_HASH_APPLY_KEEP：继续遍历。 ZEND_HASH_APPLY_REMOVE：遍历后删除遍历过的元素。 ZEND_HASH_APPLY_STOP：遍历当前元素后停止。 ZEND_HASH_APPLY_REMOVE | ZEND_HASH_APPLY_STOP：遍历当前元素后，删除该元素并停止。 枚举 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // iterating the hash table php_printf(\u0026#34;Begin iterating the hash table:\\n\u0026#34;); HashPosition pos; zval **data; char *str_idx; uint str_len; ulong num_idx; for (zend_hash_internal_pointer_reset_ex(myht, \u0026amp;pos); zend_hash_get_current_data_ex(myht, (void **) \u0026amp;data, \u0026amp;pos) == SUCCESS; zend_hash_move_forward_ex(myht, \u0026amp;pos) ) { switch (zend_hash_get_current_key_ex(myht, \u0026amp;str_idx, \u0026amp;str_len, \u0026amp;num_idx, 0, \u0026amp;pos)) { case HASH_KEY_IS_LONG: php_printf(\u0026#34;K-V: %d=\u0026gt;%Z\\n\u0026#34;, num_idx, *data); break; case HASH_KEY_IS_STRING: php_printf(\u0026#34;K-V: %s=\u0026gt;%Z\\n\u0026#34;, str_idx, *data); break; } } 三个函数 三个函数均带“_ex”后缀，使用外部指针。不带此后缀的函数使用哈希表内部指针，此时嵌套地遍历哈希表可能导致指针修改错误。\n取键的新方式 PHP 5.5以上版本新增函数，直接取键值到zval：\n1 2 3 zval *key; MAKE_STD_ZVAL(key); zend_hash_get_current_key_zval_ex(myht, key, \u0026amp;pos); 复制与合并 1 zend_hash_copy(ht_target, ht_source, (copy_ctor_func_t) zval_add_ref, NULL, sizeof(zval *)); zval_add_ref是适用于zval的回调函数，直接引用原数据。\n当目标哈希表已存在对应键值的数据时，目标元素会被源元素覆盖。使用zend_hash_merge()可通过最后一个参数指定是否用源数据覆盖目标数据。\n函数zend_hash_merge_ex()可指定一个回调函数，用于过滤要合并的元素：\n1 2 3 4 zend_hash_merge_ex( Z_ARRVAL_P(return_value), Z_ARRVAL_P(array2), (copy_ctor_func_t) zval_add_ref, sizeof(zval *), (merge_checker_func_t) merge_greater, NULL ); 回调函数的格式为：\n1 2 3 typedef zend_bool (*merge_checker_func_t)( HashTable *target_ht, void *source_data, zend_hash_key *hash_key, void *pParam ); 比较、排序和极值 比较函数：\n1 2 3 4 5 6 int zend_hash_compare( HashTable *ht1, HashTable *ht2, compare_func_t compar, zend_bool ordered TSRMLS_DC ); // 回调函数： typedef int (*compare_func_t)(const void *left, const void *right TSRMLS_DC); 排序函数：\n1 2 3 4 5 6 7 int zend_hash_sort(HashTable *ht, sort_func_t sort_func, compare_func_t compar, int renumber TSRMLS_DC); // 回调函数 typedef void (*sort_func_t)( void *buckets, size_t num_of_buckets, register size_t size_of_bucket, compare_func_t compare_func TSRMLS_DC ); 极值函数：\n1 2 3 int zend_hash_minmax( const HashTable *ht, compare_func_t compar, int flag, void **pData TSRMLS_DC ); flag=0，极小值写入pData；flag=1，极大值写入pData。\n","permalink":"http://0x3f.org/posts/hashtable-implementation-of-php/","summary":"\u003ch2 id=\"结构\"\u003e结构\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 哈希表结构\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_hashtable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enTableSize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enTableMask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enNumOfElements\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e           \u003cspan class=\"c1\"\u003e// 全部元素数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003eulong\u003c/span\u003e \u003cspan class=\"n\"\u003enNextFreeElement\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e        \u003cspan class=\"c1\"\u003e// 下一个可用的整数键\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003eBucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epInternalPointer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// 枚举操作时使用，指向当前Bucket\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003eBucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epListHead\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eBucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epListTail\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eBucket\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003earBuckets\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003edtor_func_t\u003c/span\u003e \u003cspan class=\"n\"\u003epDestructor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e       \u003cspan class=\"c1\"\u003e// 元素的析构函数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003ezend_bool\u003c/span\u003e \u003cspan class=\"n\"\u003epersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e          \u003cspan class=\"c1\"\u003e// 是否在本次请求结束后保留哈希表\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003enApplyCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e// 循环级别，防止循环引用导致遍历哈希表时死循环\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003ezend_bool\u003c/span\u003e \u003cspan class=\"n\"\u003ebApplyProtection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// 是否防止死循环\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e#if ZEND_DEBUG\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003einconsistent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Bucket结构\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eulong\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003enKeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epDataPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epListNext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epListLast\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epNext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003ebucket\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epLast\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003earKey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003eBucket\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"哈希冲突处理\"\u003e哈希冲突处理\u003c/h3\u003e\n\u003cp\u003e哈希表通过计算键值的哈希值，将对应的数据映射到对应的槽上。理论上会存在不同的键的哈希值相同的情况。\u003c/p\u003e","title":"PHP哈希表的实现与操作"},{"content":"每次键盘拔出再插入时，键盘映射都会失效，要重新执行映射，而且要对不同的键盘应用不同的映射方案。试过直接添加udev规则，即使指定X Display和Xauthority也不成功。所以用pyudev写个脚本（最新版本）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 #!/usr/bin/env python2 # encoding: utf-8 \u0026#34;\u0026#34;\u0026#34; File: udev.py Description: udev monitor script. Author: Donie Leigh Email: donie.leigh at gmail.com \u0026#34;\u0026#34;\u0026#34; import glib, os, time from pyudev import Context, Monitor PID_FILE = \u0026#34;/tmp/udev_monitor.pid\u0026#34; def remap_pokerii(device): \u0026#34;\u0026#34;\u0026#34; Do keyboard remapping when PokerII is plugged in. \u0026#34;\u0026#34;\u0026#34; if device.get(\u0026#39;ID_VENDOR_ID\u0026#39;) == \u0026#39;0f39\u0026#39; \\ and device.action == \u0026#39;add\u0026#39;: time.sleep(1) os.system(\u0026#39;setxkbmap\u0026#39;) os.system(\u0026#39;xmodmap ~/.Xmodmap\u0026#39;) def remap_filco(device): \u0026#34;\u0026#34;\u0026#34; Do keyboard remapping when Filco is plugged in. \u0026#34;\u0026#34;\u0026#34; if device.get(\u0026#39;ID_VENDOR_ID\u0026#39;) == \u0026#39;04d9\u0026#39; \\ and device.action == \u0026#39;add\u0026#39;: time.sleep(1) os.system(\u0026#39;setxkbmap\u0026#39;) os.system(\u0026#39;xmodmap ~/.Xmodmap\u0026#39;) def is_pid_running(pid): \u0026#34;\u0026#34;\u0026#34; Check if the given pid is running. :pid: int :returns: bool \u0026#34;\u0026#34;\u0026#34; try: os.kill(pid, 0) except OSError: return False return True def write_pid_or_die(): \u0026#34;\u0026#34;\u0026#34; Write the current pid into pid file or exists if there is already a instance running. :returns: void \u0026#34;\u0026#34;\u0026#34; if os.path.isfile(PID_FILE): pid = int(open(PID_FILE).read()) if is_pid_running(pid): print(\u0026#34;Process {0} is still running.\u0026#34;.format(pid)) raise SystemExit else: os.remove(PID_FILE) open(PID_FILE, \u0026#39;w\u0026#39;).write(str(os.getpid())) def main(): try: from pyudev.glib import MonitorObserver def device_event(observer, device): remap_pokerii(device) remap_filco(device) except: from pyudev.glib import GUDevMonitorObserver as MonitorObserver def device_event(observer, action, device): remap_pokerii(device) remap_filco(device) context = Context() monitor = Monitor.from_netlink(context) monitor.filter_by(subsystem=\u0026#39;usb\u0026#39;) observer = MonitorObserver(monitor) observer.connect(\u0026#39;device-event\u0026#39;, device_event) monitor.start() glib.MainLoop().run() if __name__ == \u0026#39;__main__\u0026#39;: write_pid_or_die() try: main() except KeyboardInterrupt: print(\u0026#34;Game over.\u0026#34;) 有个坑，监测到键盘插入事件后要等一秒再应用映射，否则不成功。\n这里只用了设备的Vendor ID，可以直接用lsusb看。看更多的设备属性的命令如下：\n1 2 3 4 5 6 7 8 # 监视设备变动 udevadm monitor --environment --udev # 查看设备属性 udevadm info -a -n [device name] # 查看文件所属设备的属性 udevadm info -a -p [file name] ","permalink":"http://0x3f.org/posts/auto-remap-keyboard/","summary":"\u003cp\u003e每次键盘拔出再插入时，键盘映射都会失效，要重新执行映射，而且要对不同的键盘应用不同的映射方案。试过直接添加udev规则，即使指定X Display和Xauthority也不成功。所以用pyudev写个脚本（\u003ca href=\"https://github.com/xbot/shell/blob/master/udev.py\"\u003e最新版本\u003c/a\u003e）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e87\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/env python2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# encoding: utf-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eFile:        udev.py\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eDescription: udev monitor script.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eAuthor:      Donie Leigh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eEmail:       donie.leigh at gmail.com\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eglib\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nn\"\u003etime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003epyudev\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eContext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMonitor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ePID_FILE\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/tmp/udev_monitor.pid\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eremap_pokerii\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34; Do keyboard remapping when PokerII is plugged in.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ID_VENDOR_ID\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;0f39\u0026#39;\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;add\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esystem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;setxkbmap\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esystem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;xmodmap ~/.Xmodmap\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eremap_filco\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34; Do keyboard remapping when Filco is plugged in.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ID_VENDOR_ID\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;04d9\u0026#39;\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;add\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esystem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;setxkbmap\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esystem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;xmodmap ~/.Xmodmap\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eis_pid_running\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epid\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34; Check if the given pid is running.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    :pid: int\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    :returns: bool\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ekill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"ne\"\u003eOSError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ewrite_pid_or_die\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34; Write the current pid into pid file or exists if there is already a instance running.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    :returns: void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePID_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003epid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePID_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eis_pid_running\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epid\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Process \u003c/span\u003e\u003cspan class=\"si\"\u003e{0}\u003c/span\u003e\u003cspan class=\"s2\"\u003e is still running.\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epid\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"ne\"\u003eSystemExit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eremove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePID_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePID_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetpid\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003epyudev.glib\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eMonitorObserver\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003edevice_event\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eremap_pokerii\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eremap_filco\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003epyudev.glib\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eGUDevMonitorObserver\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eMonitorObserver\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003edevice_event\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eremap_pokerii\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eremap_filco\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003econtext\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eContext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003emonitor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMonitor\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_netlink\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003emonitor\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efilter_by\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubsystem\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;usb\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMonitorObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emonitor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eobserver\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;device-event\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edevice_event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003emonitor\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eglib\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMainLoop\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vm\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;__main__\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ewrite_pid_or_die\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"ne\"\u003eKeyboardInterrupt\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Game over.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e有个坑，监测到键盘插入事件后要等一秒再应用映射，否则不成功。\u003c/p\u003e","title":"自动重映射键盘"},{"content":"用树苺派做视频监控，当视野内有物体移动时，自动拍照、录视频、同步到远程主机，并提醒到远程电脑和手机。\n用Motion做视频监控 安装Motion，修改几项必要的配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 照片和视频存储路径 target_dir = /media/sda1/cam # 允许局域网内其它主机访问视频 webcam_localhost off # 监测到移动物体时，创建作为标识的临时文件 on_event_start \u0026#34;echo 1 \u0026gt; /tmp/invasion_detected\u0026#34; # 移动物体消失时，移除临时文件 on_event_end \u0026#34;rm /tmp/invasion_detected\u0026#34; # 监测到移动物体并在保存第一张照片时，发送提醒到电脑和手机 on_picture_save [ -f /tmp/invasion_detected ] \u0026amp;\u0026amp; [ `cat /tmp/invasion_detected` -gt 0 ] \u0026amp;\u0026amp; echo 0 \u0026gt; /tmp/invasion_detected \u0026amp;\u0026amp; proxychains /root/SmartHome/script/alert.py -f %f 用Lsyncd同步到VPS 安装lsyncd并配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 settings{ pidfile = \u0026#34;/var/log/lsyncd/lsyncd.pid\u0026#34;, logfile = \u0026#34;/var/log/lsyncd/lsyncd.log\u0026#34;, statusFile = \u0026#34;/var/log/lsyncd/lsyncd-status.log\u0026#34;, statusInterval = 1, maxDelays = 1, -- nodaemon = true, } sync{ default.rsyncssh, source = \u0026#34;/media/sda1/cam\u0026#34;, host = \u0026#34;myvps.com\u0026#34;, targetdir = \u0026#34;/opt/cam\u0026#34;, exclude={ \u0026#34;.*\u0026#34;, \u0026#34;*.tmp\u0026#34; }, rsync = { compress = false, _extra = {\u0026#34;--bwlimit=50000\u0026#34;}, } } 用PushBullet通知电脑和手机 Python有几个封装好PushBullet API的模块，pushbullet.py在被Motion执行的时候报IOError，pushybullet的文件上传有问题，所以程序里用yapbl。\n1 git clone https://github.com/xbot/SmartHome.git 修改alert.py，填上自己的PushBullet API Key。\n访问PushBullet的API需要科学上网，在Motion的on_picture_save里用proxychains执行PushBullet脚本。\n","permalink":"http://0x3f.org/posts/monitor-home-with-raspberry-pi/","summary":"\u003cp\u003e用树苺派做视频监控，当视野内有物体移动时，自动拍照、录视频、同步到远程主机，并提醒到远程电脑和手机。\u003c/p\u003e\n\u003ch2 id=\"用motion做视频监控\"\u003e用Motion做视频监控\u003c/h2\u003e\n\u003cp\u003e安装Motion，修改几项必要的配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 照片和视频存储路径\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etarget_dir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e/media/sda1/cam\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 允许局域网内其它主机访问视频\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewebcam_localhost off\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 监测到移动物体时，创建作为标识的临时文件\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eon_event_start \u0026#34;echo 1 \u0026gt; /tmp/invasion_detected\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 移动物体消失时，移除临时文件\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eon_event_end \u0026#34;rm /tmp/invasion_detected\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 监测到移动物体并在保存第一张照片时，发送提醒到电脑和手机\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eon_picture_save [ -f /tmp/invasion_detected ] \u0026amp;\u0026amp; [ `cat /tmp/invasion_detected` -gt 0 ] \u0026amp;\u0026amp; echo 0 \u0026gt; /tmp/invasion_detected \u0026amp;\u0026amp; proxychains /root/SmartHome/script/alert.py -f %f\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"用lsyncd同步到vps\"\u003e用Lsyncd同步到VPS\u003c/h2\u003e\n\u003cp\u003e安装lsyncd并配置：\u003c/p\u003e","title":"用树苺派做家庭监控"},{"content":"为了让盒子能直接播放远程下载的电影，继续在树苺派上搭NAS。\n安装samba，然后配置：\n1 2 3 4 5 6 7 [nas] path = /media/sda1 valid users = @users force group = users create mask = 0660 directory mask = 0771 read only = no 把Linux用户添加到samba并设置密码：\n1 smbpasswd -a pi 盒子上的Kodi硬解有问题，用ES+MX Player替代。电脑上用Kodi。\n","permalink":"http://0x3f.org/posts/make-nas-with-raspberry-pi/","summary":"\u003cp\u003e为了让盒子能直接播放\u003ca href=\"/post/remote-downloading-with-raspberry-pi/\"\u003e远程下载\u003c/a\u003e的电影，继续在树苺派上搭NAS。\u003c/p\u003e\n\u003cp\u003e安装samba，然后配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[nas]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e/media/sda1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evalid users\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@users\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eforce group\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003eusers\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecreate mask\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0660\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edirectory mask\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0771\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eread only\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003eno\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e把Linux用户添加到samba并设置密码：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esmbpasswd -a pi\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e盒子上的Kodi硬解有问题，用ES+MX Player替代。电脑上用Kodi。\u003c/p\u003e","title":"用树苺派搭NAS"},{"content":"自从上次调整磁盘分区，一直把根目录和主目录分别挂在一个物理分区下，即使系统挂了或者换发行版也不影响主目录。最近根分区很紧张，干脆把两个分区合并了。\n先用UNetBootin安装Puppy Linux到U盘，需要手工修改U盘里的syslinux.cfg，把“pmedia=cd”改成“pmedia=usbflash”，然后用U盘启动。\n把主目录的内容完整复制到移动硬盘：\n1 2 3 4 5 6 7 8 9 10 11 12 13 # 挂载主目录 mkdir /mnt/oldhome mount -t ext4 /dev/sda2 /mnt/oldhome # 挂载移动硬盘 mkdir /mnt/bakdisk mount -t ext4 /dev/sdc1 /mnt/bakdisk # 复制主目录 cp -a /mnt/oldhome /mnt/bakdisk/ # 取消挂载主目录 umount /mnt/oldhome 用gparted删除主目录分区，合并到根分区。然后恢复主目录：\n1 2 3 4 5 6 7 8 9 10 11 12 13 # 挂载根分区 mkdir /mnt/newroot mount -t ext4 /dev/sda1 /mnt/newroot # 恢复主目录 cp -a /mnt/bakdisk/* /mnt/newroot/ # 修改fstab，取消主目录的挂载 vim /mnt/newroot/etc/fstab # 取消挂载 umount /mnt/bakdisk umount /mnt/newroot ","permalink":"http://0x3f.org/posts/adjust-disk-partitions-again/","summary":"\u003cp\u003e自从\u003ca href=\"/post/adjust-disk-partitions-in-archlinux/\"\u003e上次\u003c/a\u003e调整磁盘分区，一直把根目录和主目录分别挂在一个物理分区下，即使系统挂了或者换发行版也不影响主目录。最近根分区很紧张，干脆把两个分区合并了。\u003c/p\u003e\n\u003cp\u003e先用UNetBootin安装Puppy Linux到U盘，需要手工修改U盘里的syslinux.cfg，把“pmedia=\u003cstrong\u003ecd\u003c/strong\u003e”改成“pmedia=\u003cstrong\u003eusbflash\u003c/strong\u003e”，然后用U盘启动。\u003c/p\u003e\n\u003cp\u003e把主目录的内容完整复制到移动硬盘：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 挂载主目录\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /mnt/oldhome\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount -t ext4 /dev/sda2 /mnt/oldhome\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 挂载移动硬盘\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /mnt/bakdisk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount -t ext4 /dev/sdc1 /mnt/bakdisk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 复制主目录\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp -a /mnt/oldhome /mnt/bakdisk/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 取消挂载主目录\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eumount /mnt/oldhome\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e用gparted删除主目录分区，合并到根分区。然后恢复主目录：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 挂载根分区\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /mnt/newroot\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount -t ext4 /dev/sda1 /mnt/newroot\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 恢复主目录\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp -a /mnt/bakdisk/* /mnt/newroot/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 修改fstab，取消主目录的挂载\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evim /mnt/newroot/etc/fstab\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 取消挂载\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eumount /mnt/bakdisk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eumount /mnt/newroot\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"再次调整磁盘分区"},{"content":"\n每个危楼听雨的暮年都有过软红十丈的青春。文字凄艳，明清小品里的上乘之作。后两记文风模仿前文，意境远逊，应是伪作，可以不读。\n上部是政治史，下部是文化史。文化史部分很好，涨知识，应该买本经常翻翻。\n大部分是讲稿，内容不系统，不适合入门。畅销书不可信啊。\n科普书，不知道豆瓣上那么高的评分哪儿来的。\n","permalink":"http://0x3f.org/posts/books-i-read-these-days/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ExoJe1q2/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e每个危楼听雨的暮年都有过软红十丈的青春。文字凄艳，明清小品里的上乘之作。后两记文风模仿前文，意境远逊，应是伪作，可以不读。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ExoJbmLN/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e上部是政治史，下部是文化史。文化史部分很好，涨知识，应该买本经常翻翻。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ExoJdozU/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e大部分是讲稿，内容不系统，不适合入门。畅销书不可信啊。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/ExoJdmOb/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e科普书，不知道豆瓣上那么高的评分哪儿来的。\u003c/p\u003e","title":"这段时间读的几本书"},{"content":"远程用树苺派利用空闲时间下载大文件，需要百度云、aria2和VPS。因为网络运营商给的IP不是真的公网IP，而且免费的动态域名服务不稳定，所以用VPS把树苺派上的端口转发到外网。\n树苺派 在树苺派上部署aria2下载服务，并发布到VPS。\n安装aria2，创建以下配置文件，修改/media/sda1为实际下载目录：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 dir=/media/sda1 file-allocation=prealloc continue=true log-level=info #log-level=debug max-connection-per-server=10 summary-interval=120 daemon=true enable-rpc=true rpc-listen-port=6800 rpc-listen-all=true max-concurrent-downloads=3 save-session=/etc/aria2/save-session.list input-file=/etc/aria2/save-session.list log=/media/sda1/aria.log disable-ipv6=true disk-cache=25M timeout=600 retry-wait=30 max-tries=0 user-agent=netdisk;4.4.0.6;PC;PC-Windows;6.2.9200;WindowsBaiduYunGuanJia 我的树苺派用Archlinux，创建systemd的服务配置文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 [Unit] Description=aria2c -- file download manager After=network.target [Service] Type=forking User=%i WorkingDirectory=%h Environment=VAR=/var/%i ExecStart=/usr/bin/aria2c --daemon --enable-rpc --rpc-listen-all --rpc-allow-origin-all -c -D --conf-path=/etc/aria2/aria2.conf [Install] WantedBy=multi-user.target 激活并启动aria2服务。\n在NGINX的WWW目录下安装aria2的Web界面：\n1 git clone https://github.com/binux/yaaw.git 发布本地服务到VPS：\n1 2 3 4 5 # 发布NGINX autossh -M 5122 -R 80:localhost:80 myvps.com # 发布aria2 autossh -M 5124 -R 6800:localhost:6800 myvps.com autossh用于保持SSH连接，需要VPS上启动TCP Echo服务。\nVPS 在VPS上启用TCP Echo服务，安装xinetd并修改配置文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 service echo { disable = no id = echo-stream type = INTERNAL wait = no socket_type = stream user = root server = /usr/bin/cat log_on_failure += USERID flags = REUSE only_from = 127.0.0.1 } 远程主机 在远程主机上配置浏览器的代理规则，对http://localhost/yaaw和http://localhost:6800/jsonrpc两个URL使用VPS上的VPN或Shadowsocks代理。\n安装Chrome扩展，然后到百度云盘里设置aria2的RPC地址为“http://localhost:6800/jsonrpc”即可。\n","permalink":"http://0x3f.org/posts/remote-downloading-with-raspberry-pi/","summary":"\u003cp\u003e远程用树苺派利用空闲时间下载大文件，需要百度云、aria2和VPS。因为网络运营商给的IP不是真的公网IP，而且免费的动态域名服务不稳定，所以用VPS把树苺派上的端口转发到外网。\u003c/p\u003e\n\u003ch2 id=\"树苺派\"\u003e树苺派\u003c/h2\u003e\n\u003cp\u003e在树苺派上部署aria2下载服务，并发布到VPS。\u003c/p\u003e\n\u003cp\u003e安装aria2，创建以下配置文件，修改/media/sda1为实际下载目录：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/media/sda1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efile-allocation\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eprealloc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003econtinue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elog-level\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003einfo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#log-level=debug\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emax-connection-per-server\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esummary-interval\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e120\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edaemon\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eenable-rpc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erpc-listen-port\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e6800\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erpc-listen-all\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emax-concurrent-downloads\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esave-session\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/etc/aria2/save-session.list\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003einput-file\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/etc/aria2/save-session.list\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/media/sda1/aria.log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edisable-ipv6\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edisk-cache\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e25M\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e600\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eretry-wait\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e30\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emax-tries\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003euser-agent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003enetdisk;4.4.0.6;PC;PC-Windows;6.2.9200;WindowsBaiduYunGuanJia\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e我的树苺派用Archlinux，创建systemd的服务配置文件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[Unit]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eDescription\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003earia2c -- file download manager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eAfter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003enetwork.target\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[Service]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eType\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eforking\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e%i\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eWorkingDirectory\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e%h\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eVAR=/var/%i\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eExecStart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/usr/bin/aria2c --daemon --enable-rpc --rpc-listen-all --rpc-allow-origin-all -c -D --conf-path=/etc/aria2/aria2.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[Install]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eWantedBy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003emulti-user.target\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e激活并启动aria2服务。\u003c/p\u003e","title":"用树苺派实现远程下载"},{"content":"PHP的Trait可以实现加载时（load time）的混入（mixin）。作为元编程的一部分，运行时（run time）的混入拥有更大的灵活性。下面利用PHP的魔术方法实现运行时的混入。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 \u0026lt;?php /** * 支持混入的类 */ class Component { // ... // 所有混入的实例 private $_behaviors = []; /** * 魔术方法 * @param string $name 方法名 * @param array $arguments 参数数组 * @return mixed * @throws MethodNotFoundException */ public function __call($name, $arguments) { foreach ($this-\u0026gt;_behaviors as $behavior) { if (method_exists($behavior, $name)) { return call_user_func_array([$behavior, $name], $arguments); } } throw new MethodNotFoundException(get_class($this), $name); } /** * 魔术方法，从混入对象实例中取属性值 * @param string $attrName 属性名 * @return mixed * @throws AttrNotFoundException */ public function __get($attrName) { foreach ($this-\u0026gt;_behaviors as $behavior) { if (property_exists($behavior, $attrName)) { return $behavior-\u0026gt;$attrName; } } throw new AttributeNotFoundException(get_class($this), $attrName); } /** * 附加混入对象实例 * @param object $behavior 混入对象实例 * @param string $name 混入对象实例名称 * @return void */ public function attachBehavior($behavior, $name=\u0026#39;\u0026#39;) { if (empty($name)) $this-\u0026gt;_behaviors[] = $behavior; else $this-\u0026gt;_behaviors[$name] = $behavior; } /** * 卸载混入对象实例 * @param string $name 混入对象实例名称 * @return void */ public function detachBehavior($name) { unset($this-\u0026gt;_behaviors[$name]); } // ... } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;?php /** * 混入类 */ class Behavior { // ... /** * 将本实例混入指定对象 * @param object $object 支持混入的实例 * @param string $name 目标对象存储本混入对象实例的键值 * @return void * @throws BehaviorNotAttachableException */ public function mixin($object, $name=\u0026#39;\u0026#39;) { if (method_exists($object, \u0026#39;attachBehavior\u0026#39;)) { return call_user_func_array([$object, \u0026#39;attachBehavior\u0026#39;], [$this, $name]); } throw new BehaviorNotAttachableException(get_class($object)); } // ... } 使用示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;?php include_once \u0026#39;component.php\u0026#39;; include_once \u0026#39;behavior.php\u0026#39;; class TestBehavior extends Behavior { public function test($what) { echo \u0026#34;say $what\u0026#34;; } } $c = new Component(); $b = new TestBehavior(); $c-\u0026gt;attachBehavior($b, \u0026#39;test\u0026#39;); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; var_dump($c); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; $c-\u0026gt;detachBehavior(\u0026#39;test\u0026#39;); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; var_dump($c); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; $b-\u0026gt;mixin($c, \u0026#39;test\u0026#39;); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; var_dump($c); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; $c-\u0026gt;detachBehavior(\u0026#39;test\u0026#39;); $b-\u0026gt;mixin($c); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; var_dump($c); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; $c-\u0026gt;test(\u0026#39;hello world\u0026#39;); ","permalink":"http://0x3f.org/posts/php-implementation-of-runtime-mixin/","summary":"\u003cp\u003ePHP的Trait可以实现加载时（load time）的混入（mixin）。作为元编程的一部分，运行时（run time）的混入拥有更大的灵活性。下面利用PHP的魔术方法实现运行时的混入。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e67\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * 支持混入的类\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eComponent\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// 所有混入的实例\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_behaviors\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * 魔术方法\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $name 方法名\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param array $arguments 参数数组\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return mixed\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @throws MethodNotFoundException\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__call\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$arguments\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_behaviors\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emethod_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ecall_user_func_array\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nv\"\u003e$arguments\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eMethodNotFoundException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eget_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * 魔术方法，从混入对象实例中取属性值\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $attrName 属性名\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return mixed\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @throws AttrNotFoundException\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__get\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attrName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_behaviors\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eproperty_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$attrName\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attrName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eAttributeNotFoundException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eget_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nv\"\u003e$attrName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * 附加混入对象实例\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param object $behavior 混入对象实例\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $name 混入对象实例名称\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eattachBehavior\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_behaviors\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_behaviors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$behavior\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * 卸载混入对象实例\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $name 混入对象实例名称\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003edetachBehavior\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eunset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_behaviors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * 混入类\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBehavior\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * 将本实例混入指定对象\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param object $object 支持混入的实例\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $name 目标对象存储本混入对象实例的键值\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @throws BehaviorNotAttachableException\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003emixin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$object\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emethod_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$object\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;attachBehavior\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ecall_user_func_array\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$object\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;attachBehavior\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eBehaviorNotAttachableException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eget_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$object\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e使用示例：\u003c/p\u003e","title":"运行时可装卸的Mixin的PHP实现"},{"content":"\n能让我这个不喜欢读散文的人坚持读完的，是枕著一叶扁舟、听著潺潺流水、忖著多年后的自己——身在何方、心念何人、情系何物……\n","permalink":"http://0x3f.org/posts/after-reading-sketches-of-the-travel-to-hunan/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/EfaDoeOo/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e能让我这个不喜欢读散文的人坚持读完的，是枕著一叶扁舟、听著潺潺流水、忖著多年后的自己——身在何方、心念何人、情系何物……\u003c/p\u003e","title":"读完《湘行散记》"},{"content":"参考官方文档，稍作修改。\n在项目下创建目录 unittests ，进入目录执行：\n1 composer require phpunit/phpunit 创建 tests 目录并在其中创建文件 Bootstrap.php ：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 \u0026lt;?php use Phalcon\\DI, Phalcon\\DI\\FactoryDefault; ini_set(\u0026#39;display_errors\u0026#39;,1); error_reporting(E_ALL); define(\u0026#39;ROOT_PATH\u0026#39;, __DIR__); define(\u0026#39;PROJECT_DIR\u0026#39;, \u0026#39;/home/taoqi/workspace\u0026#39;); set_include_path( ROOT_PATH . PATH_SEPARATOR . get_include_path() ); // required for phalcon/incubator include __DIR__ . \u0026#34;/../vendor/autoload.php\u0026#34;; // 加载项目文件 $config = require_once PROJECT_DIR.\u0026#39;/web/config/config.php\u0026#39;; require_once PROJECT_DIR.\u0026#39;/web/config/loader.php\u0026#39;; $loader-\u0026gt;registerDirs(array( ROOT_PATH ), true); // $di = new FactoryDefault(); DI::reset(); // add any needed services to the DI here require_once PROJECT_DIR.\u0026#39;/web/config/services.php\u0026#39;; DI::setDefault($di); 安装 phalcon 的 phpunit 辅助库：\n1 composer require phalcon/incubator 创建 phpunit.xml ：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;phpunit bootstrap=\u0026#34;./Bootstrap.php\u0026#34; backupGlobals=\u0026#34;false\u0026#34; backupStaticAttributes=\u0026#34;false\u0026#34; verbose=\u0026#34;true\u0026#34; colors=\u0026#34;false\u0026#34; convertErrorsToExceptions=\u0026#34;true\u0026#34; convertNoticesToExceptions=\u0026#34;true\u0026#34; convertWarningsToExceptions=\u0026#34;true\u0026#34; processIsolation=\u0026#34;false\u0026#34; stopOnFailure=\u0026#34;false\u0026#34; syntaxCheck=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;testsuite name=\u0026#34;Phalcon - Testsuite\u0026#34;\u0026gt; \u0026lt;directory\u0026gt;./\u0026lt;/directory\u0026gt; \u0026lt;/testsuite\u0026gt; \u0026lt;/phpunit\u0026gt; 创建单元测试基类 UnitTestCase.php ：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 \u0026lt;?php use Phalcon\\DI, \\Phalcon\\Test\\UnitTestCase as PhalconTestCase; abstract class UnitTestCase extends PhalconTestCase { /** * @var \\Voice\\Cache */ protected $_cache; /** * @var \\Phalcon\\Config */ protected $_config; /** * @var bool */ private $_loaded = false; public function setUp(Phalcon\\DiInterface $di = NULL, Phalcon\\Config $config = NULL) { // Load any additional services that might be required during testing $di = DI::getDefault(); // get any DI components here. If you have a config, be sure to pass it to the parent parent::setUp($di); $this-\u0026gt;_loaded = true; } /** * Check if the test case is setup properly * @throws \\PHPUnit_Framework_IncompleteTestError; */ public function __destruct() { if(!$this-\u0026gt;_loaded) { throw new \\PHPUnit_Framework_IncompleteTestError(\u0026#39;Please run parent::setUp().\u0026#39;); } } } 创建单元测试类 testsTestUnitTest.php ：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php namespace Test; /** * Class UnitTest */ class UnitTests extends \\UnitTestCase { public function testTestCase() { $post = \\Post::find(33); $this-\u0026gt;assertObjectHasAttribute(\u0026#39;title\u0026#39;, $post, \u0026#39;where is title ?\u0026#39;); } } 在 tests 目录下建立 phpunit 的软连接并执行测试：\n1 2 ln -sf ../vendor/bin/phpunit run ./run 另：发现个诡异的问题，如果 Model 中不覆盖 getSource() 方法，单元测试中会自动找用下划线分隔的表名，即假如 Model 名为 FooBar ，会去找 foo_bar 的表名，但正常执行程序时找的是 foobar 。在官方论坛问的问题还木有解决。phalcon 坑挺多的。\n","permalink":"http://0x3f.org/posts/testing-with-phpunit-in-phalcon/","summary":"\u003cp\u003e参考\u003ca href=\"http://docs.phalconphp.com/zh/latest/reference/unit-testing.html\"\u003e官方文档\u003c/a\u003e，稍作修改。\u003c/p\u003e\n\u003cp\u003e在项目下创建目录 unittests ，进入目录执行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecomposer require phpunit/phpunit\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e创建 tests 目录并在其中创建文件 Bootstrap.php ：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003ePhalcon\\DI\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ePhalcon\\DI\\FactoryDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eini_set\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;display_errors\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eerror_reporting\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eE_ALL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003edefine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ROOT_PATH\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003e__DIR__\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003edefine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;PROJECT_DIR\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;/home/taoqi/workspace\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eset_include_path\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eROOT_PATH\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003ePATH_SEPARATOR\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003eget_include_path\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// required for phalcon/incubator\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003einclude\u003c/span\u003e \u003cspan class=\"no\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/../vendor/autoload.php\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// 加载项目文件\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003erequire_once\u003c/span\u003e \u003cspan class=\"nx\"\u003ePROJECT_DIR\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/web/config/config.php\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003erequire_once\u003c/span\u003e \u003cspan class=\"nx\"\u003ePROJECT_DIR\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/web/config/loader.php\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$loader\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eregisterDirs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eROOT_PATH\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// $di = new FactoryDefault();\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003eDI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003ereset\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// add any needed services to the DI here\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003erequire_once\u003c/span\u003e \u003cspan class=\"nx\"\u003ePROJECT_DIR\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/web/config/services.php\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eDI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003esetDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$di\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e安装 phalcon 的 phpunit 辅助库：\u003c/p\u003e","title":"Phalcon项目中PHPUnit的初始化"},{"content":"今天看了篇文章，讲几种常见的、糟糕的注释用法。其中之一是把废弃的代码注释起来，而不是直接删掉，原因是担心以后可能会用。\n这个其实就是版本控制系统（VCS）要解决的问题之一。包括对于团队协作的项目，经常需要看某段代码是谁改的、什么时间、什么原因。都是可以用VCS很方便地解决的问题。\n我以前是用二分法在提交列表里找的。其实有更好的解决方法，思路是列出源码在历次提交中修改的内容，然后在其中查找要找的东西就行了。\ngit的解决方法：\n1 git log -p abc.php svn的解决方法：\n1 svn log --diff --internal-diff abc.php vim的辅助函数：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026#34; Show commit history of the current file under the given VCS in a new window function! ShowCommitHistory(vcs) \u0026#34; Check parameter if a:vcs != \u0026#39;svn\u0026#39; \u0026amp;\u0026amp; a:vcs != \u0026#39;git\u0026#39; echoerr \u0026#39;Unknow VCS: \u0026#39;.a:vcs return endif \u0026#34; Do the dirty work let fileName = expand(\u0026#39;%\u0026#39;) if !empty(fileName) exe \u0026#39;new\u0026#39; if a:vcs == \u0026#39;svn\u0026#39; exe \u0026#39;r !svn log --diff --internal-diff \u0026#39;.fileName elseif a:vcs == \u0026#39;git\u0026#39; exe \u0026#39;r !git log -p \u0026#39;.fileName endif else echo \u0026#39;File not found.\u0026#39; endif endfunction nnoremap \u0026lt;leader\u0026gt;ssch :call ShowCommitHistory(\u0026#39;svn\u0026#39;)\u0026lt;CR\u0026gt; nnoremap \u0026lt;leader\u0026gt;gsch :call ShowCommitHistory(\u0026#39;git\u0026#39;)\u0026lt;CR\u0026gt; ","permalink":"http://0x3f.org/posts/leverage-code-time-machine/","summary":"\u003cp\u003e今天看了篇文章，讲几种常见的、糟糕的注释用法。其中之一是把废弃的代码注释起来，而不是直接删掉，原因是担心以后可能会用。\u003c/p\u003e\n\u003cp\u003e这个其实就是版本控制系统（VCS）要解决的问题之一。包括对于团队协作的项目，经常需要看某段代码是谁改的、什么时间、什么原因。都是可以用VCS很方便地解决的问题。\u003c/p\u003e\n\u003cp\u003e我以前是用二分法在提交列表里找的。其实有更好的解决方法，思路是列出源码在历次提交中修改的内容，然后在其中查找要找的东西就行了。\u003c/p\u003e\n\u003cp\u003egit的解决方法：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit log -p abc.php\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003esvn的解决方法：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esvn log --diff --internal-diff abc.php\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003evim的辅助函数：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; Show commit history of the current file under the given VCS in a new window\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eShowCommitHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evcs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e    \u0026#34; Check parameter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003evcs\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;svn\u0026#39;\u003c/span\u003e \u0026amp;\u0026amp; \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003evcs\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eechoerr\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Unknow VCS: \u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003evcs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e    \u0026#34; Do the dirty work\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003efileName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efileName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eexe\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;new\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003evcs\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;svn\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eexe\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;r !svn log --diff --internal-diff \u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003efileName\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelseif\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003evcs\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eexe\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;r !git log -p \u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003efileName\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;File not found.\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003essch\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eShowCommitHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;svn\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003egsch\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eShowCommitHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;git\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"用好代码时光机"},{"content":"开始用支持VIM模式的在线Markdown编辑器记笔记。既非鼠辈（鼠标依赖症不治者），始终忍受不了其它WYSIWYG（所见即所得）的在线笔记。\n大部分在线笔记最傻X的一点是，必须点一下编辑按钮才能开始写东西。支持VIM模式的笔记就不用说了，丝般顺滑，不是我大Vimer就不会懂个中骚柔。\n组织上一向后知后觉。智能手机刚开始的时候，组织上很不感冒，理由是屏幕易碎、电池难支、冯唐易老、李广难封。而今现在眼目下，一日不搞机，如隔三秋。在线Markdown编辑器出现也有段时间了，一直觉得这货无非就是给Markdown加了个可笑的准WYSIWYG，现在看来，真是做笔记的不二神器，罪过罪过。\n说说组织上跟Markdown的故事。很久很久以前，博客刚开始流行的时候，组织上开始写博客，和大部分人一样，注册个账号写公开日记，很快就忍受不了WYSIWYG编辑器失控的格式，于是开始手写HTML代码，很快就发现这货真TM反人类，从此恨乌及乌至今最讨厌的数据交换格式还是XML，于是自定几种格式或标记，用Java写了个解析工具，把文章源码翻译成HTML。突然有天发现这个星球上居然有种叫轻量型标记语言的东西，干的就是这么个事，只不过我的那些标记和解析工具又丑又烂而已。试了几种之后，最终选了Markdown，从此举案齐眉云云。\n","permalink":"http://0x3f.org/posts/start-taking-note-in-online-markdown-editor/","summary":"\u003cp\u003e开始用支持VIM模式的在线Markdown编辑器记笔记。既非鼠辈（\u003cem\u003e鼠标依赖症不治者\u003c/em\u003e），始终忍受不了其它WYSIWYG（所见即所得）的在线笔记。\u003c/p\u003e\n\u003cp\u003e大部分在线笔记最傻X的一点是，必须点一下编辑按钮才能开始写东西。支持VIM模式的笔记就不用说了，丝般顺滑，不是我大Vimer就不会懂个中骚柔。\u003c/p\u003e\n\u003cp\u003e组织上一向后知后觉。智能手机刚开始的时候，组织上很不感冒，理由是屏幕易碎、电池难支\u003cdel\u003e、冯唐易老、李广难封\u003c/del\u003e。而今现在眼目下，一日不搞机，如隔三秋。在线Markdown编辑器出现也有段时间了，一直觉得这货无非就是给Markdown加了个可笑的准WYSIWYG，现在看来，真是做笔记的不二神器，罪过罪过。\u003c/p\u003e\n\u003cp\u003e说说组织上跟Markdown的故事。很久很久以前，博客刚开始流行的时候，组织上开始写博客，和大部分人一样，注册个账号写公开日记，很快就忍受不了WYSIWYG编辑器失控的格式，于是开始手写HTML代码，很快就发现这货真TM反人类，从此恨乌及乌至今最讨厌的数据交换格式还是XML，于是自定几种格式或标记，用Java写了个解析工具，把文章源码翻译成HTML。突然有天发现这个星球上居然有种叫轻量型标记语言的东西，干的就是这么个事，只不过我的那些标记和解析工具又丑又烂而已。试了几种之后，最终选了Markdown，从此举案齐眉云云。\u003c/p\u003e","title":"开始用在线Markdown编辑器记笔记"},{"content":"对PHP页面模板中的HTML做注释，NERDCommenter是根据文件类型处理的，所以必须临时转换文件类型：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026#34; 强制使用HTML的注释 function! ForceHTMLComment(mode, type) range set ft=html if a:mode == \u0026#34;x\u0026#34; execute a:firstline.\u0026#34;,\u0026#34;.a:lastline.\u0026#34;call NERDComment(\\\u0026#34;x\\\u0026#34;, \\\u0026#34;\u0026#34;.a:type.\u0026#34;\\\u0026#34;)\u0026#34; else if a:type == \u0026#34;Sexy\u0026#34; normal ,cs else normal ,cc endif endif set ft=php endfunction au FileType php nmap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;fhcc :call ForceHTMLComment(\u0026#34;n\u0026#34;, \u0026#34;Comment\u0026#34;)\u0026lt;CR\u0026gt; au FileType php vmap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;fhcc :call ForceHTMLComment(\u0026#34;x\u0026#34;, \u0026#34;Comment\u0026#34;)\u0026lt;CR\u0026gt; au FileType php nmap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;fhcs :call ForceHTMLComment(\u0026#34;n\u0026#34;, \u0026#34;Sexy\u0026#34;)\u0026lt;CR\u0026gt; au FileType php vmap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;fhcs :call ForceHTMLComment(\u0026#34;x\u0026#34;, \u0026#34;Sexy\u0026#34;)\u0026lt;CR\u0026gt; au FileType php nmap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;fhcu :call ForceHTMLComment(\u0026#34;n\u0026#34;, \u0026#34;Uncomment\u0026#34;)\u0026lt;CR\u0026gt; au FileType php vmap \u0026lt;buffer\u0026gt; \u0026lt;leader\u0026gt;fhcu :call ForceHTMLComment(\u0026#34;x\u0026#34;, \u0026#34;Uncomment\u0026#34;)\u0026lt;CR\u0026gt; 有日子没写vimscript了，手都生了。\n","permalink":"http://0x3f.org/posts/force-commenting-html-in-php-files-in-vim/","summary":"\u003cp\u003e对PHP页面模板中的HTML做注释，NERDCommenter是根据文件类型处理的，所以必须临时转换文件类型：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; 强制使用HTML的注释\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eForceHTMLComment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003erange\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003eft\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003emode\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;x\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eexecute\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003efirstline\u003c/span\u003e.\u003cspan class=\"s2\"\u003e\u0026#34;,\u0026#34;\u003c/span\u003e.\u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003elastline\u003c/span\u003e.\u003cspan class=\"s2\"\u003e\u0026#34;call NERDComment(\\\u0026#34;x\\\u0026#34;, \\\u0026#34;\u0026#34;\u003c/span\u003e.\u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003etype\u003c/span\u003e.\u003cspan class=\"s2\"\u003e\u0026#34;\\\u0026#34;)\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Sexy\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003enormal\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ecs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003enormal\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ecc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003eft\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003enmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003efhcc\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eForceHTMLComment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Comment\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003evmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003efhcc\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eForceHTMLComment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;x\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Comment\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003enmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003efhcs\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eForceHTMLComment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Sexy\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003evmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003efhcs\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eForceHTMLComment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;x\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Sexy\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003enmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003efhcu\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eForceHTMLComment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Uncomment\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003evmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003efhcu\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eForceHTMLComment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;x\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Uncomment\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e有日子没写vimscript了，手都生了。\u003c/p\u003e","title":"Vim强制在PHP中使用HTML注释的方法"},{"content":"Zsh默认开启了对PATH变量的缓存，这是导致新安装的程序无法立即使用自动补全的原因。\n其实只要PATH变量不太复杂，安装的程序不太多，完全没必要开启缓存，实际上我把缓存关掉后完全没有感觉到补全的速度有什么变化。\n方法如下，在.zshrc中增加一行：\n1 zstyle \u0026#39;:completion:*\u0026#39; rehash true 也可以在必要的时间手工执行命令rehash，也是个临时解决方法。\n","permalink":"http://0x3f.org/posts/how-to-auto-complete-newly-installed-command-in-zsh/","summary":"\u003cp\u003eZsh默认开启了对PATH变量的缓存，这是导致新安装的程序无法立即使用自动补全的原因。\u003c/p\u003e\n\u003cp\u003e其实只要PATH变量不太复杂，安装的程序不太多，完全没必要开启缓存，实际上我把缓存关掉后完全没有感觉到补全的速度有什么变化。\u003c/p\u003e\n\u003cp\u003e方法如下，在.zshrc中增加一行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ezstyle \u003cspan class=\"s1\"\u003e\u0026#39;:completion:*\u0026#39;\u003c/span\u003e rehash \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e也可以在必要的时间手工执行命令\u003cstrong\u003erehash\u003c/strong\u003e，也是个临时解决方法。\u003c/p\u003e","title":"ZSH下新安装的程序无法自动补全的解决方法"},{"content":"Yii 2.0引入了一项新特性，可以接管PHP的致命错误。在此之前，如果PHP源码有语法错误，框架本身是不会处理的。\n实现的思路如下：\n禁止显示错误 注册自定义的shutdown回调函数 在回调函数中获取最近的错误 若错误是致命错误，调用相应的处理逻辑 代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;?php // ... ini_set(\u0026#39;display_errors\u0026#39;, false); register_shutdown_function(function(){ $error = error_get_last(); if (isset($error[\u0026#39;type\u0026#39;]) \u0026amp;\u0026amp; in_array($error[\u0026#39;type\u0026#39;], [E_ERROR, E_PARSE, E_CORE_ERROR, E_CORE_WARNING, E_COMPILE_ERROR, E_COMPILE_WARNING])) { ob_clean(); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; var_dump($error); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; exit(1); } }); // ... ?\u0026gt; ","permalink":"http://0x3f.org/posts/how-to-take-over-php-fatal-error-handling/","summary":"\u003cp\u003eYii 2.0引入了一项新特性，可以接管PHP的致命错误。在此之前，如果PHP源码有语法错误，框架本身是不会处理的。\u003c/p\u003e\n\u003cp\u003e实现的思路如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e禁止显示错误\u003c/li\u003e\n\u003cli\u003e注册自定义的shutdown回调函数\u003c/li\u003e\n\u003cli\u003e在回调函数中获取最近的错误\u003c/li\u003e\n\u003cli\u003e若错误是致命错误，调用相应的处理逻辑\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e代码如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eini_set\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;display_errors\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eregister_shutdown_function\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$error\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror_get_last\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$error\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ein_array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$error\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003eE_ERROR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eE_PARSE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eE_CORE_ERROR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eE_CORE_WARNING\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eE_COMPILE_ERROR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eE_COMPILE_WARNING\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eob_clean\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;pre\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003evar_dump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$error\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"接管PHP致命错误的方法"},{"content":"\n身兼技术牛人和创业成功者两个身份，自然有资格指点江山，有些观点很自负，有些观点对人有启发。作者很推崇Lisp，很不屑Java。\n","permalink":"http://0x3f.org/posts/after-reading-hackers-and-painters/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E9VYTLb7/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e身兼技术牛人和创业成功者两个身份，自然有资格指点江山，有些观点很自负，有些观点对人有启发。作者很推崇Lisp，很不屑Java。\u003c/p\u003e","title":"读完《黑客与画家》"},{"content":"\n第二版比第一版补充了很多内容，介绍得很详细，是学习mongodb的好书。\n但是翻译版有很多印刷错误，个别译句也有问题。\n","permalink":"http://0x3f.org/posts/after-reading-mongodb-the-definitive-guide/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E9VWUjut/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e第二版比第一版补充了很多内容，介绍得很详细，是学习mongodb的好书。\u003c/p\u003e\n\u003cp\u003e但是翻译版有很多印刷错误，个别译句也有问题。\u003c/p\u003e","title":"读完《MongoDB权威指南》第二版"},{"content":"\n读了一部分，还是不怎么喜欢西方中世纪文化，最后改看电视剧，拍得也很一般。\n","permalink":"http://0x3f.org/posts/after-reading-a-song-of-ice-and-fire-v1/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E9VUK2P1/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e读了一部分，还是不怎么喜欢西方中世纪文化，最后改看电视剧，拍得也很一般。\u003c/p\u003e","title":"读完《冰与火之歌》卷一"},{"content":"\n描写民国时北京南城市民生活很生动，但是以儿童的视角叙事显得揣着明白装糊涂。\n","permalink":"http://0x3f.org/posts/after-reading-my-memories-of-old-beijing/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E9VO58ag/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e描写民国时北京南城市民生活很生动，但是以儿童的视角叙事显得揣着明白装糊涂。\u003c/p\u003e","title":"读完《城南旧事》"},{"content":"\n文章写得很美，本打算十一去茶峒，看看顺顺吊脚楼，坐坐白塔下的拉拉渡，临时改了行程，只能以后有空再去了。\n","permalink":"http://0x3f.org/posts/after-reading-border-town/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E9VMRoII/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e文章写得很美，本打算十一去茶峒，看看顺顺吊脚楼，坐坐白塔下的拉拉渡，临时改了行程，只能以后有空再去了。\u003c/p\u003e","title":"读完《边城》"},{"content":"\n现在不喜欢这种书了。\n内心不够强大，再看下去我就疯了。\n","permalink":"http://0x3f.org/posts/give-up-the-ideal-city-and-genius-and-madman/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E9VPP5J0/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e现在不喜欢这种书了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E9VOUOtx/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e内心不够强大，再看下去我就疯了。\u003c/p\u003e","title":"放弃《一座城池》和《天才在左疯子在右》"},{"content":"\n偏学术，比较抽象，不如《万历十五年》好看。\n","permalink":"http://0x3f.org/posts/after-reading-big-history-of-china/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E3k8bFJc/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e偏学术，比较抽象，不如《万历十五年》好看。\u003c/p\u003e","title":"读完《中国大历史》"},{"content":"\n钱穆有文侠风，读这本书，能看到这样一个影子，上马击狂胡，下马草军书。他也是个民族主义者，提到元清，几乎没一句好话。所以要贯通国史，还得多读读别的书。总体来说，读这本书时常感醍醐灌顶，为习国史者必读。\n","permalink":"http://0x3f.org/posts/after-reading-political-gain-and-loss-of-china/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/E1v1Ohh6/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e钱穆有文侠风，读这本书，能看到这样一个影子，上马击狂胡，下马草军书。他也是个民族主义者，提到元清，几乎没一句好话。所以要贯通国史，还得多读读别的书。总体来说，读这本书时常感醍醐灌顶，为习国史者必读。\u003c/p\u003e","title":"读完《中国历代政治得失》"},{"content":"\n自序中对治史的方法论让我受益匪浅，本书语气平和、娓娓道来，像讲故事一样讲历史，但又严谨、广博、不肤浅，风格和其它史书大不一样，我一直理想中的史书就是这样，不要给历史背太重的包袱，不要带著一定要学点什么的目的读历史。\n本书的缺点是详略失当。有些地方太简略，比如匈奴的衰落，五单于争立一笔带过。有些地方太详细，鸿门宴几乎是史记的译文。作为一部通史，应该有大历史观，能站在较高的层面上把历史的脉络梳理清楚。\n","permalink":"http://0x3f.org/posts/after-reading-brief-history-of-china/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DZOYRqbR/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e自序中对治史的方法论让我受益匪浅，本书语气平和、娓娓道来，像讲故事一样讲历史，但又严谨、广博、不肤浅，风格和其它史书大不一样，我一直理想中的史书就是这样，不要给历史背太重的包袱，不要带著一定要学点什么的目的读历史。\u003c/p\u003e\n\u003cp\u003e本书的缺点是详略失当。有些地方太简略，比如匈奴的衰落，五单于争立一笔带过。有些地方太详细，鸿门宴几乎是史记的译文。作为一部通史，应该有大历史观，能站在较高的层面上把历史的脉络梳理清楚。\u003c/p\u003e","title":"读完《中国史纲》"},{"content":"\n很好的注本，有些字句的翻译有点儿晦涩。庄子的思想超越了老子，想把庄子的思想理解透彻很难。\n","permalink":"http://0x3f.org/posts/after-reading-zhuangzi-jin-zhu-jin-yi/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DZl9Hgeh/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e很好的注本，有些字句的翻译有点儿晦涩。庄子的思想超越了老子，想把庄子的思想理解透彻很难。\u003c/p\u003e","title":"读完《庄子今注今译》"},{"content":"1000-digit Fibonacci number The Fibonacci sequence is defined by the recurrence relation:\nFn = Fn−1 + Fn−2, where F1 = 1 and F2 = 1.\nHence the first 12 terms will be:\nF1 = 1\nF2 = 1\nF3 = 2\nF4 = 3\nF5 = 5\nF6 = 8\nF7 = 13\nF8 = 21\nF9 = 34\nF10 = 55\nF11 = 89\nF12 = 144\nThe 12th term, F12, is the first term to contain three digits.\nWhat is the first term in the Fibonacci sequence to contain 1000 digits?\nSolution To be progmatic, take the brute-force approach.\nFurthermore, here gives a formula which solves this problem, but it\u0026rsquo;s too mathematical.\n","permalink":"http://0x3f.org/posts/project-euler-25-solved/","summary":"\u003ch2 id=\"1000-digit-fibonacci-number\"\u003e1000-digit Fibonacci number\u003c/h2\u003e\n\u003cp\u003eThe Fibonacci sequence is defined by the recurrence relation:\u003c/p\u003e\n\u003cp\u003eFn = Fn−1 + Fn−2, where F1 = 1 and F2 = 1.\u003c/p\u003e\n\u003cp\u003eHence the first 12 terms will be:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eF1 = 1\u003cbr\u003e\nF2 = 1\u003cbr\u003e\nF3 = 2\u003cbr\u003e\nF4 = 3\u003cbr\u003e\nF5 = 5\u003cbr\u003e\nF6 = 8\u003cbr\u003e\nF7 = 13\u003cbr\u003e\nF8 = 21\u003cbr\u003e\nF9 = 34\u003cbr\u003e\nF10 = 55\u003cbr\u003e\nF11 = 89\u003cbr\u003e\nF12 = 144\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThe 12th term, F12, is the first term to contain three digits.\u003c/p\u003e","title":"Project Euler Problem 25 Solved"},{"content":"\n钱穆先生主张以诚敬心审视国史和传统文化，一生为故国招魂。抗战流亡，笔耕不辍，虽然这本书只是一本历史教科书，但是高屋建瓴的大历史观让我受益匪浅，很多东西是读史料不能学到的。《国史大纲》所思所言，堪称国史良心。\n","permalink":"http://0x3f.org/posts/after-reading-outline-history/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DYBkUo68/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e钱穆先生主张以诚敬心审视国史和传统文化，一生为故国招魂。抗战流亡，笔耕不辍，虽然这本书只是一本历史教科书，但是高屋建瓴的大历史观让我受益匪浅，很多东西是读史料不能学到的。《国史大纲》所思所言，堪称国史良心。\u003c/p\u003e","title":"读完《国史大纲》"},{"content":"lsyncd全称“Live Syncing Daemon”，是Linux下的文件自动同步工具，同时支持SSH、rsync的实现方式。相对于rsync+inotify，它速度更快，也更稳定。\n对于SSH的方式，需要目标机器中已启动SSHD，并把源机器上的公钥加到目标机器root用户的authorized_keys中，私钥应放在源机器上运行lsyncd的用户的.ssh目录中，密钥放错了用户，会导致无法同步。\n然后就是在源机器上创建配置文件，lsyncd的配置文件是个lua脚本：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 settings{ pidfile = \u0026#34;/var/log/lsyncd/lsyncd.pid\u0026#34;, logfile = \u0026#34;/var/log/lsyncd/lsyncd.log\u0026#34;, statusFile = \u0026#34;/var/log/lsyncd/lsyncd-status.log\u0026#34;, statusInterval = 1, maxDelays = 1, -- nodaemon = true, } sync{ default.rsyncssh, source = \u0026#34;/home/monk/workspace\u0026#34;, host = \u0026#34;192.168.1.3\u0026#34;, targetdir = \u0026#34;/var/www/workspace\u0026#34;, exclude={ \u0026#34;.*\u0026#34;, \u0026#34;*.tmp\u0026#34; }, rsync = { compress = false, _extra = {\u0026#34;--bwlimit=50000\u0026#34;}, } } 然后启动lsyncd：\n1 sudo lsyncd /etc/lsyncd.conf ","permalink":"http://0x3f.org/posts/live-syncing-daemon/","summary":"\u003cp\u003elsyncd全称“Live Syncing Daemon”，是Linux下的文件自动同步工具，同时支持SSH、rsync的实现方式。相对于rsync+inotify，它速度更快，也更稳定。\u003c/p\u003e\n\u003cp\u003e对于SSH的方式，需要目标机器中已启动SSHD，并把源机器上的公钥加到目标机器root用户的authorized_keys中，私钥应放在源机器上运行lsyncd的用户的.ssh目录中，密钥放错了用户，会导致无法同步。\u003c/p\u003e\n\u003cp\u003e然后就是在源机器上创建配置文件，lsyncd的配置文件是个lua脚本：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-lua\" data-lang=\"lua\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003epidfile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/var/log/lsyncd/lsyncd.pid\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003elogfile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/var/log/lsyncd/lsyncd.log\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estatusFile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/var/log/lsyncd/lsyncd-status.log\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estatusInterval\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003emaxDelays\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e-- nodaemon = true,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esync\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003edefault.rsyncssh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003esource\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/home/monk/workspace\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etargetdir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/var/www/workspace\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eexclude\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;.*\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;*.tmp\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ersync\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ecompress\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003e_extra\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;--bwlimit=50000\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后启动lsyncd：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo lsyncd /etc/lsyncd.conf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"使用lsyncd同步文件"},{"content":"Lexicographic permutations A permutation is an ordered arrangement of objects. For example, 3124 is one possible permutation of the digits 1, 2, 3 and 4. If all of the permutations are listed numerically or alphabetically, we call it lexicographic order. The lexicographic permutations of 0, 1 and 2 are:\n012 021 102 120 201 210\nWhat is the millionth lexicographic permutation of the digits 0, 1, 2, 3, 4, 5, 6, 7, 8 and 9?\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/usr/bin/python2 # -*- coding: utf-8 -*- from math import factorial def get_perm(digits, number): if len(digits) == 0: return \u0026#39;\u0026#39; (perm, counter) = (\u0026#39;\u0026#39;, factorial(len(digits) - 1)) for digit in digits: if counter \u0026gt;= number: digits.remove(digit) perm += str(digit) + get_perm(digits, number) break number -= counter return perm if __name__ == \u0026#39;__main__\u0026#39;: import time startTime = time.time() perm = get_perm([d for d in range(10)], 1000000) print perm, \u0026#39;%sms\u0026#39; % ((time.time() - startTime) * 1000) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;?php function factorial($n) { $result = 1; for ($i = 2;$i \u0026lt;= $n;$i++) $result*= $i; return $result; } function get_perm($digits, $number) { $perm = \u0026#34;\u0026#34;; $length = count($digits); $counter = factorial($length - 1); for ($i = 0;$i \u0026lt; $length;$i++) { if ($counter \u0026gt;= $number) { $segment = array_splice($digits, $i, 1); $perm = $segment[0] . get_perm($digits, $number); break; } $number-= $counter; } return $perm; } $startTime = microtime(true); $digits = array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9); $perm = get_perm($digits, 1000000); $costs = (microtime(true) - $startTime) * 1000; echo \u0026#34;$perm ${costs}ms\\n\u0026#34;; ?\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;time\u0026#34; ) func factorial(n int) int { result := 1 for i := 2; i \u0026lt;= n; i++ { result *= i } return result } func get_perm(digits []int, number int) string { perm, length := \u0026#34;\u0026#34;, len(digits) counter := factorial(length - 1) for i := 0; i \u0026lt; length; i++ { if counter \u0026gt;= number { digit := digits[i] digits = append(digits[:i], digits[i+1:]...) perm += strconv.Itoa(digit) + get_perm(digits, number) break } number -= counter } return perm } func main() { startTime := time.Now() digits := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9} perm := get_perm(digits, 1000000) fmt.Println(perm, time.Now().Sub(startTime)) } I\u0026rsquo;m the 57181st person to have solved this problem.\nI\u0026rsquo;ve just advanced to Level 1. 61264 members (15.9%) have made it this far.\nI have earned 1 new award:\nThe Journey Begins: Progress to Level 1 by solving twenty-five problems\n","permalink":"http://0x3f.org/posts/project-euler-24/","summary":"\u003ch2 id=\"lexicographic-permutations\"\u003eLexicographic permutations\u003c/h2\u003e\n\u003cp\u003eA permutation is an ordered arrangement of objects. For example, 3124 is one possible permutation of the digits 1, 2, 3 and 4. If all of the permutations are listed numerically or alphabetically, we call it lexicographic order. The lexicographic permutations of 0, 1 and 2 are:\u003c/p\u003e\n\u003cp\u003e012   021   102   120   201   210\u003c/p\u003e\n\u003cp\u003eWhat is the millionth lexicographic permutation of the digits 0, 1, 2, 3, 4, 5, 6, 7, 8 and 9?\u003c/p\u003e","title":"Project Euler Problem 24 Solved"},{"content":"Non-abundant sums A perfect number is a number for which the sum of its proper divisors is exactly equal to the number. For example, the sum of the proper divisors of 28 would be 1 + 2 + 4 + 7 + 14 = 28, which means that 28 is a perfect number.\nA number n is called deficient if the sum of its proper divisors is less than n and it is called abundant if this sum exceeds n.\nAs 12 is the smallest abundant number, 1 + 2 + 3 + 4 + 6 = 16, the smallest number that can be written as the sum of two abundant numbers is 24. By mathematical analysis, it can be shown that all integers greater than 28123 can be written as the sum of two abundant numbers. However, this upper limit cannot be reduced any further by analysis even though it is known that the greatest number that cannot be expressed as the sum of two abundant numbers is less than this limit.\nFind the sum of all the positive integers which cannot be written as the sum of two abundant numbers.\nSolution Using sets instead of lists greatly improves performance in Python:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #!/usr/bin/python # -*- coding: utf-8 -*- def sum_proper_factors(n): (result, sqrt) = (1, n ** 0.5) (start, step) = n % 2 == 1 and (3, 2) or (2, 1) for i in range(start, int(sqrt) + 1, step): if n % i == 0: result += i + n / i if sqrt == int(sqrt): result -= sqrt return result def main(): (result, limit, abundants) = (0, 28124, set()) for n in range(1, limit): if sum_proper_factors(n) \u0026gt; n: abundants.add(n) if not any(n - a in abundants for a in abundants): result += n print result if __name__ == \u0026#39;__main__\u0026#39;: import time startTime = time.time() main() print time.time() - startTime Simulate sets using maps in Go:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;math\u0026#34; \u0026#34;time\u0026#34; ) func sum_proper_factors(n int) int { result, sqrt := 1, math.Sqrt(float64(n)) start, step := 2, 1 if n%2 == 1 { start, step = 3, 2 } for i := start; i \u0026lt;= int(sqrt); i += step { if n%i == 0 { result += i + n/i } } if sqrt == float64(int(sqrt)) { result -= int(sqrt) } return result } func main() { result, limit, abundants, startTime := 0, 28124, make(map[int]bool), time.Now() for n := 1; n \u0026lt; limit; n++ { if sum_proper_factors(n) \u0026gt; n { abundants[n] = true } isSumOfTwoAbundants := false for k := range abundants { if abundants[n-k] == true { isSumOfTwoAbundants = true break } } if !isSumOfTwoAbundants { result += n } } fmt.Println(result, time.Now().Sub(startTime)) } I\u0026rsquo;m the 49489th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-23/","summary":"\u003ch2 id=\"non-abundant-sums\"\u003eNon-abundant sums\u003c/h2\u003e\n\u003cp\u003eA perfect number is a number for which the sum of its proper divisors is exactly equal to the number. For example, the sum of the proper divisors of 28 would be 1 + 2 + 4 + 7 + 14 = 28, which means that 28 is a perfect number.\u003c/p\u003e\n\u003cp\u003eA number n is called deficient if the sum of its proper divisors is less than n and it is called abundant if this sum exceeds n.\u003c/p\u003e","title":"Project Euler Problem 23 Solved"},{"content":"春节期间收到两个issue，一直拖到今天才有时间完成。\n增加了一个功能，在文章编辑视图的元数据中分类那行，使用热键\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;自动完成文章的分类。在配置数组ub_blog中增加键值对“categories”，默认使用这一项的值实现自动完成，如下：\n1 2 3 4 5 6 7 let ub_blog = {\u0026#39;login_name\u0026#39;:\u0026#39;admin\u0026#39;, \\\u0026#39;password\u0026#39;:\u0026#39;pass2011\u0026#39;, \\\u0026#39;url\u0026#39;:\u0026#39;http://www.sample.com/\u0026#39;, \\\u0026#39;xmlrpc_uri\u0026#39;:\u0026#39;xmlrpc.php\u0026#39;, \\\u0026#39;db\u0026#39;:\u0026#39;$VIM/UltraBlog.db\u0026#39;, \\\u0026#39;categories\u0026#39;: \u0026#39;News|Computer|Image\u0026#39; \\} 如果这一项不存在，将从博客中拉取分类数据。\n自从迁移到Octopress，有两年不用Wordpress了，没想到居然还有人在用UltraBlog.vim。\n","permalink":"http://0x3f.org/posts/ultrablog-v361-released/","summary":"\u003cp\u003e春节期间收到两个issue，一直拖到今天才有时间完成。\u003c/p\u003e\n\u003cp\u003e增加了一个功能，在文章编辑视图的元数据中分类那行，使用热键\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;自动完成文章的分类。在配置数组\u003cstrong\u003eub_blog\u003c/strong\u003e中增加键值对“categories”，默认使用这一项的值实现自动完成，如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eub_blog\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e {\u003cspan class=\"s1\"\u003e\u0026#39;login_name\u0026#39;\u003c/span\u003e:\u003cspan class=\"s1\"\u003e\u0026#39;admin\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \\\u003cspan class=\"s1\"\u003e\u0026#39;password\u0026#39;\u003c/span\u003e:\u003cspan class=\"s1\"\u003e\u0026#39;pass2011\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \\\u003cspan class=\"s1\"\u003e\u0026#39;url\u0026#39;\u003c/span\u003e:\u003cspan class=\"s1\"\u003e\u0026#39;http://www.sample.com/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \\\u003cspan class=\"s1\"\u003e\u0026#39;xmlrpc_uri\u0026#39;\u003c/span\u003e:\u003cspan class=\"s1\"\u003e\u0026#39;xmlrpc.php\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \\\u003cspan class=\"s1\"\u003e\u0026#39;db\u0026#39;\u003c/span\u003e:\u003cspan class=\"s1\"\u003e\u0026#39;$VIM/UltraBlog.db\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \\\u003cspan class=\"s1\"\u003e\u0026#39;categories\u0026#39;\u003c/span\u003e: \u003cspan class=\"s1\"\u003e\u0026#39;News|Computer|Image\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \\}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e如果这一项不存在，将从博客中拉取分类数据。\u003c/p\u003e\n\u003cp\u003e自从迁移到Octopress，有两年不用Wordpress了，没想到居然还有人在用\u003ca href=\"/post/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e。\u003c/p\u003e","title":"UltraBlog.vim v3.6.1: 文章分类自动补全"},{"content":"Names scores Using names.txt (right click and \u0026lsquo;Save Link/Target As\u0026hellip;\u0026rsquo;), a 46K text file containing over five-thousand first names, begin by sorting it into alphabetical order. Then working out the alphabetical value for each name, multiply this value by its alphabetical position in the list to obtain a name score.\nFor example, when the list is sorted into alphabetical order, COLIN, which is worth 3 + 15 + 12 + 9 + 14 = 53, is the 938th name in the list. So, COLIN would obtain a score of 938 × 53 = 49714.\nWhat is the total of all the name scores in the file?\nSolution Pretty code snippets are easily to be implemented in Python as always:\n1 2 3 4 5 6 7 8 9 10 #!/usr/bin/python # -*- coding: utf-8 -*- if __name__ == \u0026#39;__main__\u0026#39;: f = open(\u0026#39;names.txt\u0026#39;) names = sorted(f.readline().replace(\u0026#39;\u0026#34;\u0026#39;, \u0026#39;\u0026#39;).split(\u0026#39;,\u0026#39;)) f.close() print sum(map(lambda name: sum([ord(c) - 64 for c in name]) \\ * (names.index(name) + 1), names)) Easy as Python, ugly as shit, here is the PHP implementation:\n1 2 3 4 5 6 7 8 9 \u0026lt;?php $names = explode(\u0026#39;,\u0026#39;, str_replace(\u0026#39;\u0026#34;\u0026#39;, \u0026#39;\u0026#39;, file_get_contents(\u0026#39;names.txt\u0026#39;))); sort($names, SORT_STRING); $cal_alpha_value = function($name, $i) { $cal_alpha_index = function($char){return ord($char) - 64;}; return array_sum(array_map($cal_alpha_index, str_split($name, 1))) * $i; }; echo array_sum(array_map($cal_alpha_value, $names, range(1, count($names)))); ?\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 package main import ( \u0026#34;bufio\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;sort\u0026#34; \u0026#34;strings\u0026#34; ) func main() { f, err := os.Open(\u0026#34;names.txt\u0026#34;) if err != nil { fmt.Println(err) os.Exit(1) } defer f.Close() reader := bufio.NewReader(f) line, _ := reader.ReadString(\u0026#39;\\n\u0026#39;) names := strings.Split(strings.Replace(line, \u0026#34;\\\u0026#34;\u0026#34;, \u0026#34;\u0026#34;, -1), \u0026#34;,\u0026#34;) sort.Sort(sort.StringSlice(names)) val := 0 for i := 0; i \u0026lt; len(names); i++ { tmp := 0 for j := 0; j \u0026lt; len(names[i]); j++ { tmp += int(names[i][j]) - 64 } val += tmp * (i + 1) } fmt.Println(val) } I\u0026rsquo;m the 65646th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-22/","summary":"\u003ch2 id=\"names-scores\"\u003eNames scores\u003c/h2\u003e\n\u003cp\u003eUsing \u003ca href=\"http://projecteuler.net/project/names.txt\"\u003enames.txt\u003c/a\u003e (right click and \u0026lsquo;Save Link/Target As\u0026hellip;\u0026rsquo;), a 46K text file containing over five-thousand first names, begin by sorting it into alphabetical order. Then working out the alphabetical value for each name, multiply this value by its alphabetical position in the list to obtain a name score.\u003c/p\u003e\n\u003cp\u003eFor example, when the list is sorted into alphabetical order, COLIN, which is worth 3 + 15 + 12 + 9 + 14 = 53, is the 938th name in the list. So, COLIN would obtain a score of 938 × 53 = 49714.\u003c/p\u003e","title":"Project Euler Problem 22 Solved"},{"content":"暂时没有好路线，所以今天是保持性练习。上周发现顺时针绕道G109从军庄路放坡下来会很轻松，所以依旧从香岩寺出发，经黑山扈路、香山路、香山南路、八大处路、模式口大街、G109、军庄路、北清路，最后回到出发点。\n照例，先交作业：\n走香山路是因为不想重复上周的老路，但是很快就体会到了不长记性的后果，这条路似乎从来没有不堵过，天气这么差都挡不住这么多人，植物园门口一坨一坨的，我一直觉得香山之难看、植物园之无聊可著北京城都是数一数二的，要不说文人可恶呢，忽悠了多少人！\n传说中的模式口大街居然只是一条很窄的巷子，两边是很旧的居民区，时近中午，这么窄的路上居然挤满了一坨一坨的人。\n军庄路似乎一般是上午会有很多拉土方的卡车，上周我中午过后经过时车就不多，不幸今天中奖了，要不是贪图放坡的快感，打死也不走这条路。\n总之今天走的不是个好路线，不如上周卢沟桥那一圈，很大程度上是因为想到的路线都有坡，加上天气不好、准备不充分，有点儿怵。以往的经历，第一次走的路线，因为不知道前面会有什么，怀著对未知的好奇和无畏，不管多困难，总是可以坚持下来，但下次就不敢了，因为有痛苦的经历。所以骑行的乐趣在于对未知的好奇，或者是克服对已知的恐惧。前一种我还行，至于后者，无力吐槽，唯余呵呵。\n","permalink":"http://0x3f.org/posts/cycling-in-the-known-and-unknown/","summary":"\u003cp\u003e暂时没有好路线，所以今天是保持性练习。上周发现顺时针绕道G109从军庄路放坡下来会很轻松，所以依旧从香岩寺出发，经黑山扈路、香山路、香山南路、八大处路、模式口大街、G109、军庄路、北清路，最后回到出发点。\u003c/p\u003e\n\u003cp\u003e照例，先交作业：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DH6LbtQT/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DH6KVk28/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DH6KUt7T/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e走香山路是因为不想重复上周的老路，但是很快就体会到了不长记性的后果，这条路似乎从来没有不堵过，天气这么差都挡不住这么多人，植物园门口一坨一坨的，我一直觉得香山之难看、植物园之无聊可著北京城都是数一数二的，要不说文人可恶呢，忽悠了多少人！\u003c/p\u003e\n\u003cp\u003e传说中的模式口大街居然只是一条很窄的巷子，两边是很旧的居民区，时近中午，这么窄的路上居然挤满了一坨一坨的人。\u003c/p\u003e\n\u003cp\u003e军庄路似乎一般是上午会有很多拉土方的卡车，上周我中午过后经过时车就不多，不幸今天中奖了，要不是贪图放坡的快感，打死也不走这条路。\u003c/p\u003e\n\u003cp\u003e总之今天走的不是个好路线，不如上周卢沟桥那一圈，很大程度上是因为想到的路线都有坡，加上天气不好、准备不充分，有点儿怵。以往的经历，第一次走的路线，因为不知道前面会有什么，怀著对未知的好奇和无畏，不管多困难，总是可以坚持下来，但下次就不敢了，因为有痛苦的经历。所以骑行的乐趣在于对未知的好奇，或者是克服对已知的恐惧。前一种我还行，至于后者，无力吐槽，唯余呵呵。\u003c/p\u003e","title":"骑行的已知和未知"},{"content":"Amicable numbers Let d(n) be defined as the sum of proper divisors of n (numbers less than n which divide evenly into n).\nIf d(a) = b and d(b) = a, where a ≠ b, then a and b are an amicable pair and each of a and b are called amicable numbers.\nFor example, the proper divisors of 220 are 1, 2, 4, 5, 10, 11, 20, 22, 44, 55 and 110; therefore d(220) = 284. The proper divisors of 284 are 1, 2, 4, 71 and 142; so d(284) = 220.\nEvaluate the sum of all the amicable numbers under 10000.\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/usr/bin/python # -*- coding: utf-8 -*- def sum_proper_factors(n): (result, sqrt) = (1, n ** 0.5) (start, step) = n % 2 == 1 and (3, 2) or (2, 1) for i in range(start, int(sqrt) + 1, step): if n % i == 0: result += i + n / i if sqrt == int(sqrt): result -= sqrt return result def main(): result = 0 for i in range(1, 10000): sum1 = sum_proper_factors(i) if sum1 \u0026gt; i: if i == sum_proper_factors(sum1): result += i + sum1 print result if __name__ == \u0026#39;__main__\u0026#39;: import time startTime = time.time() main() print time.time() - startTime 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;math\u0026#34; \u0026#34;time\u0026#34; ) func sum_proper_factors(n int) int { sum, sqrt := 1, math.Sqrt(float64(n)) start, step := 2, 1 if n%2 == 1 { start, step = 3, 2 } for i := start; i \u0026lt;= int(sqrt); i += step { if n%i == 0 { sum += i + n/i } } if sqrt == float64(int(sqrt)) { sum -= int(sqrt) } return sum } func main() { result, startTime := 0, time.Now() for i := 1; i \u0026lt; 10000; i++ { iSum := sum_proper_factors(i) if iSum \u0026gt; i { if i == sum_proper_factors(iSum) { result += i + iSum } } } fmt.Println(result, time.Now().Sub(startTime)) } I\u0026rsquo;m the 70186th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-21/","summary":"\u003ch2 id=\"amicable-numbers\"\u003eAmicable numbers\u003c/h2\u003e\n\u003cp\u003eLet d(n) be defined as the sum of proper divisors of n (numbers less than n which divide evenly into n).\u003cbr\u003e\nIf d(a) = b and d(b) = a, where a ≠ b, then a and b are an amicable pair and each of a and b are called amicable numbers.\u003c/p\u003e\n\u003cp\u003eFor example, the proper divisors of 220 are 1, 2, 4, 5, 10, 11, 20, 22, 44, 55 and 110; therefore d(220) = 284. The proper divisors of 284 are 1, 2, 4, 71 and 142; so d(284) = 220.\u003c/p\u003e","title":"Project Euler Problem 21 Solved"},{"content":"Factorial digit sum n! means n × (n − 1) × \u0026hellip; × 3 × 2 × 1\nFor example, 10! = 10 × 9 × \u0026hellip; × 3 × 2 × 1 = 3628800,\nand the sum of the digits in the number 10! is 3 + 6 + 2 + 8 + 8 + 0 + 0 = 27.\nFind the sum of the digits in the number 100!\nSolution 1 2 3 4 5 6 7 8 #!/usr/bin/python # -*- coding: utf-8 -*- if __name__ == \u0026#39;__main__\u0026#39;: product = 1 for i in range(2, 101): product *= i print sum([int(x) for x in str(product)]) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;math/big\u0026#34; \u0026#34;strconv\u0026#34; ) func main() { product := big.NewInt(1) for i := 1; i \u0026lt; 101; i++ { product.Mul(product, big.NewInt(int64(i))) } sum := 0 for idx := range product.String() { tmp, _ := strconv.Atoi(product.String()[idx : idx+1]) sum += tmp } fmt.Println(sum) } I\u0026rsquo;m the 100089th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-20/","summary":"\u003ch2 id=\"factorial-digit-sum\"\u003eFactorial digit sum\u003c/h2\u003e\n\u003cp\u003en! means n × (n − 1) × \u0026hellip; × 3 × 2 × 1\u003c/p\u003e\n\u003cp\u003eFor example, 10! = 10 × 9 × \u0026hellip; × 3 × 2 × 1 = 3628800,\u003cbr\u003e\nand the sum of the digits in the number 10! is 3 + 6 + 2 + 8 + 8 + 0 + 0 = 27.\u003c/p\u003e\n\u003cp\u003eFind the sum of the digits in the number 100!\u003c/p\u003e","title":"Project Euler Problem 20 Solved"},{"content":"更始元年三月癸丑，孤亲提铁骑南下卢沟，为甲午一百二十年祭。\n以前一直以为很远，后来发现单程只有三十多公里，而且基本都是平地，自从去年推上妙峰山后，一般难度就不怕不怕啦。\n先交作业：\n不知道为什么，记录到了北安河就结束了，最后十公里木有了。\n在网上见有人说从桥西进去不查门票，遂先过永定河，从西边进去，路上捡了个迷路的小盆友，说刚刚用手机导航直接上了高速！聊 后得知是北科大的学生，曾国藩的老乡，骑了辆不知道什么牌子的旧车，怯生生的，不禁遥想老夫当年，去矽谷吃顿七块钱的土豆牛肉饭都美得不行不行的。\n骑到桥西入口，一个大妈模样的头从售票处小窗口里伸出来：“二十！”，要不说我没有大妈缘呢，走到哪都被拦，去年苦逼哈哈地推到七王坟，大妈说封山防火，片板不得入山。老老实实地买了票，才见著真神，爱个国容易么。桥是金章宗的时候建的，乾隆五十多年重修。桥下就是永定河，左宗棠任直隶总督时在此治水，旧称无定河，不过不是“可怜无定河边骨，犹是春闺梦里人”里的那条。\n请小盆友拍了张孤王的戎装照：\n果然每个狮子都不一样，小学课本不余欺也：\n卢沟晓月，所谓的燕京八景之一，我一般不尿这种虚无缥缈、滥竽充数的东西，鲁迅在《再论雷峰塔的倒掉》里说：\n我们中国的许多人，——我在此特别正重声明：并不包括四万万同胞全部！——大抵患有一种“十景病”，至少是“八景病”，沉重起来的时候大概在清朝。凡看一部县志，这一县往往有十景或八景，如“远村明月”、“萧寺清钟”、“古池好水”之类。\n我虽然不喜欢鲁迅，因为此人文风过于惼狭和左倾，虽然老先生一再声明不针对所有国人，但还是随处可见断章取义、不懂装懂的人扯大旗作虎皮，动辄就中国人的劣根性怎么怎么样。但在这一点上我跟老先生意见一致，就某些小县城都有所谓“七台八景”，台好歹还有个土堆，景就开始胡扯了。\n摆一堆仿明清的大炮干什么，跟七七世变不搭调，更容易联想到两甲子前的那场战争，此日漫挥天下泪，有公足庄海军威。\n小盆友的高中历史是体育老师教的，居然不知道宛平城。这座长宽只有几百米的小城是崇祯为抵御闯贼建的桥头堡。不要门票。\n这么小的一座城居然还有瓮城：\n城里有个抗日纪念馆，免费参观，因为没处存车，没有进去，不过受党国栽培多年，用脚趾头也能想到里面都是什么，不去也罢。城里没啥可吃的，小盆友说要回校再吃饭，我心说您是直接奔学院路了，我还有几十公里路要绕，不补充热量怎么行，请小盆友吃了顿热干面。这兄弟明显没有方向感，好容易才让他找著北，在手机上找好回学院路的路线，最后送出东门，然后告诉他怎么走之后，老夫才起驾回宫。\n之后的路基本比较轻松，大体沿永定河一直走，河边的永定楼气势恢宏，懒得拍照了，再上G109，从军庄路一路放坡下来，很爽。\n","permalink":"http://0x3f.org/posts/a-ride-to-lugou-bridge/","summary":"\u003cp\u003e更始元年三月癸丑，孤亲提铁骑南下卢沟，为甲午一百二十年祭。\u003c/p\u003e\n\u003cp\u003e以前一直以为很远，后来发现单程只有三十多公里，而且基本都是平地，自从去年推上妙峰山后，一般难度就不怕不怕啦。\u003c/p\u003e\n\u003cp\u003e先交作业：\u003c/p\u003e\n\u003cp\u003e不知道为什么，记录到了北安河就结束了，最后十公里木有了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGaYw0Qi/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGaZP1XR/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGbqdTkZ/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e在网上见有人说从桥西进去不查门票，遂先过永定河，从西边进去，路上捡了个迷路的小盆友，说刚刚用手机导航直接上了高速！聊 后得知是北科大的学生，曾国藩的老乡，骑了辆不知道什么牌子的旧车，怯生生的，不禁遥想老夫当年，去矽谷吃顿七块钱的土豆牛肉饭都美得不行不行的。\u003c/p\u003e\n\u003cp\u003e骑到桥西入口，一个大妈模样的头从售票处小窗口里伸出来：“二十！”，要不说我没有大妈缘呢，走到哪都被拦，去年苦逼哈哈地推到七王坟，大妈说封山防火，片板不得入山。老老实实地买了票，才见著真神，爱个国容易么。桥是金章宗的时候建的，乾隆五十多年重修。桥下就是永定河，左宗棠任直隶总督时在此治水，旧称无定河，不过不是“可怜无定河边骨，犹是春闺梦里人”里的那条。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGbmWZvZ/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e请小盆友拍了张孤王的戎装照：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGbmX91K/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e果然每个狮子都不一样，小学课本不余欺也：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGbmYClu/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e卢沟晓月，所谓的燕京八景之一，我一般不尿这种虚无缥缈、滥竽充数的东西，鲁迅在《再论雷峰塔的倒掉》里说：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e我们中国的许多人，——我在此特别正重声明：并不包括四万万同胞全部！——大抵患有一种“十景病”，至少是“八景病”，沉重起来的时候大概在清朝。凡看一部县志，这一县往往有十景或八景，如“远村明月”、“萧寺清钟”、“古池好水”之类。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我虽然不喜欢鲁迅，因为此人文风过于惼狭和左倾，虽然老先生一再声明不针对所有国人，但还是随处可见断章取义、不懂装懂的人扯大旗作虎皮，动辄就中国人的劣根性怎么怎么样。但在这一点上我跟老先生意见一致，就某些小县城都有所谓“七台八景”，台好歹还有个土堆，景就开始胡扯了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGbmY2fr/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e摆一堆仿明清的大炮干什么，跟七七世变不搭调，更容易联想到两甲子前的那场战争，此日漫挥天下泪，有公足庄海军威。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGcan9YW/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e小盆友的高中历史是体育老师教的，居然不知道宛平城。这座长宽只有几百米的小城是崇祯为抵御闯贼建的桥头堡。不要门票。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGbmXnSE/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这么小的一座城居然还有瓮城：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DGbmZQTg/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e城里有个抗日纪念馆，免费参观，因为没处存车，没有进去，不过受党国栽培多年，用脚趾头也能想到里面都是什么，不去也罢。城里没啥可吃的，小盆友说要回校再吃饭，我心说您是直接奔学院路了，我还有几十公里路要绕，不补充热量怎么行，请小盆友吃了顿热干面。这兄弟明显没有方向感，好容易才让他找著北，在手机上找好回学院路的路线，最后送出东门，然后告诉他怎么走之后，老夫才起驾回宫。\u003c/p\u003e\n\u003cp\u003e之后的路基本比较轻松，大体沿永定河一直走，河边的永定楼气势恢宏，懒得拍照了，再上G109，从军庄路一路放坡下来，很爽。\u003c/p\u003e","title":"骑行卢沟桥"},{"content":"Counting Sundays You are given the following information, but you may prefer to do some research for yourself.\n1 Jan 1900 was a Monday. Thirty days has September, April, June and November.\nAll the rest have thirty-one,\nSaving February alone,\nWhich has twenty-eight, rain or shine.\nAnd on leap years, twenty-nine. A leap year occurs on any year evenly divisible by 4, but not on a century unless it is divisible by 400. How many Sundays fell on the first of the month during the twentieth century (1 Jan 1901 to 31 Dec 2000)?\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #!/usr/bin/python # -*- coding: utf-8 -*- def is_leap(year): return year % 400 == 0 or year % 100 != 0 and year % 4 == 0 def count_days(year, month, day): days = 0 for y in range(1900, year): days += is_leap(y) and 366 or 365 thirties = [4, 6, 9, 11] for m in range(1, month): if m == 2: days += is_leap(year) and 29 or 28 else: days += m in thirties and 30 or 31 return days + day def main(): count = 0 for year in range(1901, 2001): for month in range(1, 13): if count_days(year, month, 1) % 7 == 0: count += 1 print count if __name__ == \u0026#39;__main__\u0026#39;: main() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;math\u0026#34; ) func is_leap(year int) bool { return math.Mod(float64(year), 400) == 0 || math.Mod(float64(year), 100) != 0 \u0026amp;\u0026amp; math.Mod(float64(year), 4) == 0 } func count_days(year, month, day int) int { days := 0 for y := 1900; y \u0026lt; year; y++ { if is_leap(y) { days += 366 } else { days += 365 } } for m := 1; m \u0026lt; month; m++ { if m == 2 { if is_leap(year) { days += 29 } else { days += 28 } } else { if m == 4 || m == 6 || m == 9 || m == 11 { days += 30 } else { days += 31 } } } return days + day } func main() { count := 0 for year := 1901; year \u0026lt; 2001; year++ { for month := 1; month \u0026lt; 13; month++ { if math.Mod(float64(count_days(year, month, 1)), 7) == 0 { count++ } } } fmt.Println(count) } I\u0026rsquo;m the 65183rd person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-19/","summary":"\u003ch2 id=\"counting-sundays\"\u003eCounting Sundays\u003c/h2\u003e\n\u003cp\u003eYou are given the following information, but you may prefer to do some research for yourself.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1 Jan 1900 was a Monday.\u003c/li\u003e\n\u003cli\u003eThirty days has September,\nApril, June and November.\u003cbr\u003e\nAll the rest have thirty-one,\u003cbr\u003e\nSaving February alone,\u003cbr\u003e\nWhich has twenty-eight, rain or shine.\u003cbr\u003e\nAnd on leap years, twenty-nine.\u003c/li\u003e\n\u003cli\u003eA leap year occurs on any year evenly divisible by 4, but not on a century unless it is divisible by 400.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHow many Sundays fell on the first of the month during the twentieth century (1 Jan 1901 to 31 Dec 2000)?\u003c/p\u003e","title":"Project Euler Problem 19 Solved"},{"content":"Maximum path sum I By starting at the top of the triangle below and moving to adjacent numbers on the row below, the maximum total from top to bottom is 23.\n3\n7 4\n2 4 6\n8 5 9 3\nThat is, 3 + 7 + 4 + 9 = 23.\nFind the maximum total from top to bottom of the triangle below:\n75\n95 64\n17 47 82\n18 35 87 10\n20 04 82 47 65\n19 01 23 75 03 34\n88 02 77 73 07 63 67\n99 65 04 28 06 16 70 92\n41 41 26 56 83 40 80 70 33\n41 48 72 33 47 32 37 16 94 29\n53 71 44 65 25 43 91 52 97 51 14\n70 11 33 28 77 73 17 78 39 68 17 57\n91 71 52 38 17 14 91 43 58 50 27 29 48\n63 66 04 68 89 53 67 30 73 16 69 87 40 31\n04 62 98 27 23 09 70 98 73 93 38 53 60 04 23\nNOTE: As there are only 16384 routes, it is possible to solve this problem by trying every route. However, Problem 67, is the same challenge with a triangle containing one-hundred rows; it cannot be solved by brute force, and requires a clever method! ;o)\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #!/usr/bin/python # -*- coding: utf-8 -*- def main(): matrix = [] file = open(\u0026#39;data_p18.txt\u0026#39;) for line in file.readlines(): matrix.append(map(int, line.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\u0026#39;).split(\u0026#39; \u0026#39;))) (x, y) = (0, 0) for y in range(len(matrix)): for x in range(len(matrix[y])): if y \u0026gt; 0: greaterParentPathValue = 0 if x \u0026gt; 0: greaterParentPathValue = matrix[y - 1][x - 1] if x \u0026lt; len(matrix[y - 1]) and matrix[y - 1][x] \\ \u0026gt; greaterParentPathValue: greaterParentPathValue = matrix[y - 1][x] matrix[y][x] += greaterParentPathValue print max(matrix[-1]) if __name__ == \u0026#39;__main__\u0026#39;: main() I\u0026rsquo;m the 70471st person to have solved this problem.\nMaximum path sum II By starting at the top of the triangle below and moving to adjacent numbers on the row below, the maximum total from top to bottom is 23.\n3\n7 4\n2 4 6\n8 5 9 3\nThat is, 3 + 7 + 4 + 9 = 23.\nFind the maximum total from top to bottom in triangle.txt (right click and \u0026lsquo;Save Link/Target As\u0026hellip;\u0026rsquo;), a 15K text file containing a triangle with one-hundred rows.\nNOTE: This is a much more difficult version of Problem 18. It is not possible to try every route to solve this problem, as there are 2^99 altogether! If you could check one trillion (10^12) routes every second it would take over twenty billion years to check them all. There is an efficient algorithm to solve it. ;o)\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 package main import ( \u0026#34;bufio\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;sort\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; ) func main() { f, err := os.Open(\u0026#34;data_p67.txt\u0026#34;) if nil != err { fmt.Println(err) os.Exit(1) } defer f.Close() matrix := make([][]int, 0) reader := bufio.NewReader(f) for { line, err := reader.ReadString(\u0026#39;\\n\u0026#39;) if nil != err || io.EOF == err { break } row := make([]int, 0) numbers := strings.Split(strings.Replace(line, \u0026#34;\\n\u0026#34;, \u0026#34;\u0026#34;, -1), \u0026#34; \u0026#34;) for i := range numbers { number, _ := strconv.Atoi(numbers[i]) row = append(row, number) } matrix = append(matrix, row) } for y := 0; y \u0026lt; len(matrix); y++ { for x := 0; x \u0026lt; len(matrix[y]); x++ { if y \u0026gt; 0 { greaterParentPathValue := 0 if x \u0026gt; 0 { greaterParentPathValue = matrix[y-1][x-1] } if x \u0026lt; len(matrix[y-1]) \u0026amp;\u0026amp; matrix[y-1][x] \u0026gt; greaterParentPathValue { greaterParentPathValue = matrix[y-1][x] } matrix[y][x] += greaterParentPathValue } } } sort.Sort(sort.Reverse(sort.IntSlice(matrix[len(matrix)-1]))) fmt.Println(matrix[len(matrix)-1][0]) } I\u0026rsquo;m the 50650th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-18-and-67/","summary":"\u003ch2 id=\"maximum-path-sum-i\"\u003eMaximum path sum I\u003c/h2\u003e\n\u003cp\u003eBy starting at the top of the triangle below and moving to adjacent numbers on the row below, the maximum total from top to bottom is 23.\u003c/p\u003e\n\u003cp\u003e3\u003cbr\u003e\n7 4\u003cbr\u003e\n2 4 6\u003cbr\u003e\n8 5 9 3\u003c/p\u003e\n\u003cp\u003eThat is, 3 + 7 + 4 + 9 = 23.\u003c/p\u003e\n\u003cp\u003eFind the maximum total from top to bottom of the triangle below:\u003c/p\u003e\n\u003cp\u003e75\u003cbr\u003e\n95 64\u003cbr\u003e\n17 47 82\u003cbr\u003e\n18 35 87 10\u003cbr\u003e\n20 04 82 47 65\u003cbr\u003e\n19 01 23 75 03 34\u003cbr\u003e\n88 02 77 73 07 63 67\u003cbr\u003e\n99 65 04 28 06 16 70 92\u003cbr\u003e\n41 41 26 56 83 40 80 70 33\u003cbr\u003e\n41 48 72 33 47 32 37 16 94 29\u003cbr\u003e\n53 71 44 65 25 43 91 52 97 51 14\u003cbr\u003e\n70 11 33 28 77 73 17 78 39 68 17 57\u003cbr\u003e\n91 71 52 38 17 14 91 43 58 50 27 29 48\u003cbr\u003e\n63 66 04 68 89 53 67 30 73 16 69 87 40 31\u003cbr\u003e\n04 62 98 27 23 09 70 98 73 93 38 53 60 04 23\u003c/p\u003e","title":"Project Euler Problem 18\u002667 Solved"},{"content":"Number letter counts If the numbers 1 to 5 are written out in words: one, two, three, four, five, then there are 3 + 3 + 5 + 4 + 4 = 19 letters used in total.\nIf all the numbers from 1 to 1000 (one thousand) inclusive were written out in words, how many letters would be used?\nNOTE: Do not count spaces or hyphens. For example, 342 (three hundred and forty-two) contains 23 letters and 115 (one hundred and fifteen) contains 20 letters. The use of \u0026ldquo;and\u0026rdquo; when writing out numbers is in compliance with British usage.\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 #!/usr/bin/python # -*- coding: utf-8 -*- def translate_number(num): words = { 0: \u0026#39;\u0026#39;, 1: \u0026#39;one\u0026#39;, 2: \u0026#39;two\u0026#39;, 3: \u0026#39;three\u0026#39;, 4: \u0026#39;four\u0026#39;, 5: \u0026#39;five\u0026#39;, 6: \u0026#39;six\u0026#39;, 7: \u0026#39;seven\u0026#39;, 8: \u0026#39;eight\u0026#39;, 9: \u0026#39;nine\u0026#39;, 10: \u0026#39;ten\u0026#39;, 11: \u0026#39;eleven\u0026#39;, 12: \u0026#39;twelve\u0026#39;, 13: \u0026#39;thirteen\u0026#39;, 14: \u0026#39;fourteen\u0026#39;, 15: \u0026#39;fifteen\u0026#39;, 16: \u0026#39;sixteen\u0026#39;, 17: \u0026#39;seventeen\u0026#39;, 18: \u0026#39;eighteen\u0026#39;, 19: \u0026#39;nineteen\u0026#39;, 20: \u0026#39;twenty\u0026#39;, 30: \u0026#39;thirty\u0026#39;, 40: \u0026#39;forty\u0026#39;, 50: \u0026#39;fifty\u0026#39;, 60: \u0026#39;sixty\u0026#39;, 70: \u0026#39;seventy\u0026#39;, 80: \u0026#39;eighty\u0026#39;, 90: \u0026#39;ninety\u0026#39;, } english = \u0026#39;\u0026#39; if num / 1000 \u0026gt; 0: english += translate_number(num / 1000) + \u0026#39; thousand\u0026#39; tmp = translate_number(num % 1000) english += ((tmp.strip() == \u0026#39;\u0026#39; or tmp.find(\u0026#39;hundred\u0026#39;) \u0026gt; -1) and \u0026#39; \u0026#39; or \u0026#39; and \u0026#39;) + tmp elif num / 100 \u0026gt; 0: english += translate_number(num / 100) + \u0026#39; hundred\u0026#39; tmp = translate_number(num % 100) if tmp.strip() != \u0026#39;\u0026#39;: english += \u0026#39; and \u0026#39; + tmp else: if words.has_key(num): english += words[num] else: english += words[num / 10 * 10] + \u0026#39;-\u0026#39; + words[num % 10] return english if __name__ == \u0026#39;__main__\u0026#39;: count = 0 for i in range(1, 1001): count += len(translate_number(i).replace(\u0026#39; \u0026#39;, \u0026#39;\u0026#39;).replace(\u0026#39;-\u0026#39;, \u0026#39;\u0026#39;)) print count I\u0026rsquo;m the 71762nd person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-17/","summary":"\u003ch2 id=\"number-letter-counts\"\u003eNumber letter counts\u003c/h2\u003e\n\u003cp\u003eIf the numbers 1 to 5 are written out in words: one, two, three, four, five, then there are 3 + 3 + 5 + 4 + 4 = 19 letters used in total.\u003c/p\u003e\n\u003cp\u003eIf all the numbers from 1 to 1000 (one thousand) inclusive were written out in words, how many letters would be used?\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNOTE\u003c/strong\u003e: Do not count spaces or hyphens. For example, 342 (three hundred and forty-two) contains 23 letters and 115 (one hundred and fifteen) contains 20 letters. The use of \u0026ldquo;and\u0026rdquo; when writing out numbers is in compliance with British usage.\u003c/p\u003e","title":"Project Euler Problem 17 Solved"},{"content":"Power digit sum 2^15 = 32768 and the sum of its digits is 3 + 2 + 7 + 6 + 8 = 26.\nWhat is the sum of the digits of the number 2^1000?\nSolution 1 2 3 4 5 6 7 8 9 10 11 #!/usr/bin/python # -*- coding: utf-8 -*- import math if __name__ == \u0026#39;__main__\u0026#39;: str = format(math.pow(2, 1000), \u0026#39;f\u0026#39;) sum = 0 for c in str[:str.index(\u0026#39;.\u0026#39;)]: sum += int(c) print sum 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;math/big\u0026#34; \u0026#34;strconv\u0026#34; ) func main() { num, base := big.NewInt(1), big.NewInt(2) for power := 0; power \u0026lt; 1000; power++ { num.Mul(num, base) } result := 0 for i := 0; i \u0026lt; len(num.String()); i++ { bit, _ := strconv.Atoi(num.String()[i : i+1]) result += bit } fmt.Println(num.String(), result) } I\u0026rsquo;m the 109044th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-16/","summary":"\u003ch2 id=\"power-digit-sum\"\u003ePower digit sum\u003c/h2\u003e\n\u003cp\u003e2^15 = 32768 and the sum of its digits is 3 + 2 + 7 + 6 + 8 = 26.\u003c/p\u003e\n\u003cp\u003eWhat is the sum of the digits of the number 2^1000?\u003c/p\u003e\n\u003ch2 id=\"solution\"\u003eSolution\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/python\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# -*- coding: utf-8 -*-\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003emath\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vm\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;__main__\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003estr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;f\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003esum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)]:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003esum\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e \u003cspan class=\"nb\"\u003esum\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s\"\u003e\u0026#34;math/big\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s\"\u003e\u0026#34;strconv\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ebase\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003ebig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003epower\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003epower\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003epower\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMul\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ebit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003estrconv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAtoi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e()[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eI\u0026rsquo;m the 109044th person to have solved this problem.\u003c/p\u003e","title":"Project Euler Problem 16 Solved"},{"content":"Lattice paths Starting in the top left corner of a 2×2 grid, and only being able to move to the right and down, there are exactly 6 routes to the bottom right corner.\nHow many such routes are there through a 20×20 grid?\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #!/usr/bin/python # -*- coding: utf-8 -*- if __name__ == \u0026#39;__main__\u0026#39;: (steps, a, b) = (20, 1, 1) i = steps * 2 while i \u0026gt; steps: a *= i i -= 1 while steps \u0026gt; 1: b *= steps steps -= 1 print a / b I\u0026rsquo;m the 86747th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-15/","summary":"\u003ch2 id=\"lattice-paths\"\u003eLattice paths\u003c/h2\u003e\n\u003cp\u003eStarting in the top left corner of a 2×2 grid, and only being able to move to the right and down, there are exactly 6 routes to the bottom right corner.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DEwoQ7qc/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eHow many such routes are there through a 20×20 grid?\u003c/p\u003e\n\u003ch2 id=\"solution\"\u003eSolution\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/python\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# -*- coding: utf-8 -*-\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vm\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;__main__\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esteps\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esteps\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esteps\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e*=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"n\"\u003esteps\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e*=\u003c/span\u003e \u003cspan class=\"n\"\u003esteps\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003esteps\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eI\u0026rsquo;m the 86747th person to have solved this problem.\u003c/p\u003e","title":"Project Euler Problem 15 Solved"},{"content":"Longest Collatz sequence The following iterative sequence is defined for the set of positive integers:\nn → n/2 (n is even)\nn → 3n + 1 (n is odd)\nUsing the rule above and starting with 13, we generate the following sequence:\n13 → 40 → 20 → 10 → 5 → 16 → 8 → 4 → 2 → 1\nIt can be seen that this sequence (starting at 13 and finishing at 1) contains 10 terms. Although it has not been proved yet (Collatz Problem), it is thought that all starting numbers finish at 1.\nWhich starting number, under one million, produces the longest chain?\nNOTE: Once the chain starts the terms are allowed to go above one million.\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;math\u0026#34; \u0026#34;time\u0026#34; ) func collatz(n int) int { if n == 1 { return 1 } if math.Mod(float64(n), 2) == 0 { return collatz(n/2) + 1 } else { return collatz(n*3+1) + 1 } } func main() { start := time.Now() i, iLen, count, max := 1000000, 0, 0, 0 for i \u0026gt; 1 { iLen = collatz(i) if iLen \u0026gt; count { count = iLen max = i } i-- } end := time.Now() fmt.Println(end.Sub(start), max, count) } I\u0026rsquo;m the 104188th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-14/","summary":"\u003ch2 id=\"longest-collatz-sequence\"\u003eLongest Collatz sequence\u003c/h2\u003e\n\u003cp\u003eThe following iterative sequence is defined for the set of positive integers:\u003c/p\u003e\n\u003cp\u003en → n/2 (n is even)\u003cbr\u003e\nn → 3n + 1 (n is odd)\u003c/p\u003e\n\u003cp\u003eUsing the rule above and starting with 13, we generate the following sequence:\u003c/p\u003e\n\u003cp\u003e13 → 40 → 20 → 10 → 5 → 16 → 8 → 4 → 2 → 1\u003c/p\u003e\n\u003cp\u003eIt can be seen that this sequence (starting at 13 and finishing at 1) contains 10 terms. Although it has not been proved yet (Collatz Problem), it is thought that all starting numbers finish at 1.\u003c/p\u003e","title":"Project Euler Problem 14 Solved"},{"content":"简述 依赖注入是个很好的解耦方法，也可以优雅的实现懒加载。\n以数据库连接为例，当一个组件用到数据库时，最简单粗暴的办法是在使用前创建连接：\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;?php class Component { public function doSth() { // ... $db = new DatabaseConnection($schema, $host, $port, $login, $password); // ... } } ?\u0026gt; 这样做的缺点是代码一旦执行，Component行为将不可更改，有时我们需要在程序执行的过程中决定其行为。很直接地，可以想到给Component添加一个Setter方法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;?php class Component { private $__db; public function doSth() { // ... if ($this-\u0026gt;__db !== null) { // do something ... } // ... } public function setConnection($db) { $this-\u0026gt;__db = $db; } } ?\u0026gt; 这样就把Component和数据库连接解耦了。这时又有一个问题，怎样管理数据库连接？最简单粗暴的办法是在每次使用前创建，如果在程序中多处需要改变数据库连接，这就把代码写死了。\n一种解决问题的方法是使用一个全局变量保存连接，对于简单场景，这没问题，但是这种做法会污染全局命名空间，尤其是在依赖较多的情况下，这种做法就不可取了。另一种方法就是用一个注册表持有所有依赖，这就是依赖注入要做的事。\n我曾经处理过一个问题，生产环境中即使在无请求的情况下也会在短时间内生成大量会话文件，直接原因是使用了keepalived检查系统可用性。由于程序在一开始就打开了会话，并且keepalived不能保持会话，导致每次访问都会生成一个新的会话文件。这就是没有使用懒加载导致的错误。\n懒加载可以让每个组件只有在需要的情况下才被初始化，一方面简化了代码、提高了可读性，另一方面也能提高程序效率、降低资源消耗。如果组件很多，而每次请求实际用到的很少，初始化所有组件产生的资源消耗将会很可观。\n实现 用单例模式实现，以键值对的形式注册依赖。同时支持以变量和callable的形式注入，前者用以注册简单类型或已实例化的依赖，后者可以用匿名函数的方式更灵活地管理依赖。同时，注入依赖时可以指定该依赖是否为单例模式，如果是，callable类型的依赖将会在第一次被调用后保持下来。此外，使用__call()魔术方法实现直接以getter方法的方式获取依赖。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 \u0026lt;?php namespace org\\x3f\\flamework\\base; use org\\x3f\\flamework\\exceptions\\FlameException; /** * Dependency Injection Class * * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @link http://0x3f.org * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh * @license BSD (3-terms) * @since 1.0 */ class DI { /** * @var object Singleton instance * @since 1.0 */ public static $_instance; /** * @var array Services * @since 1.0 */ private $_services = array(); /** * Singleton constructor * @return void * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @since 1.0 */ private function __construct() { } /** * Return the singleton instance * @return object Singleton instance * @since 1.0 **/ public static function getInstance() { if (! self::$_instance instanceof self) { self::$_instance = new self(); } return self::$_instance; } /** * Add a service to the register * @param string $key Service name * @param mixed $service Callable to create a service instance or exactly an instance * @param bool $isSingleton Set true to treat this service as singleton * @return void * @since 1.0 **/ public function set($key, $service, $isSingleton=false) { $this-\u0026gt;_services[strtolower($key)] = array( \u0026#39;service\u0026#39; =\u0026gt; $service, \u0026#39;isSingleton\u0026#39; =\u0026gt; $isSingleton, \u0026#39;instance\u0026#39; =\u0026gt; null ); } /** * Get a service instance * @return mixed Service instance * @since 1.0 */ public function get($key) { $key = strtolower($key); if (isset($this-\u0026gt;_services[$key])) { $info = \u0026amp;$this-\u0026gt;_services[$key]; if ($info[\u0026#39;instance\u0026#39;] !== null) return $info[\u0026#39;instance\u0026#39;]; if (is_callable($info[\u0026#39;service\u0026#39;])) { $instance = call_user_func($info[\u0026#39;service\u0026#39;]); if ($info[\u0026#39;isSingleton\u0026#39;] === true) $info[\u0026#39;instance\u0026#39;] = $instance; return $instance; } else { return $info[\u0026#39;service\u0026#39;]; } } return null; } /** * Get service with magic method * @param string $method get{ServiceName} * @param array $parameters Parameters, currently useless * @return mixed Service instance * @since 1.0 */ public function __call($method, $parameters) { if (strpos(strtolower($method), \u0026#39;get\u0026#39;) === 0) { $serviceName = substr($method, 3); return $this-\u0026gt;get($serviceName); } throw new FlameException(\u0026#39;Call to undefined method: \u0026#39;.$method); } } // END class DI ?\u0026gt; 使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 \u0026lt;?php $di = DI::getInstance(); // 简单类型 $di-\u0026gt;set(\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;); // 每次调用生成不同的依赖 $di-\u0026gt;set(\u0026#39;newPassword\u0026#39;, function(){ $pwd = ”; $pwdLen = 10; for ($i = 0; $i \u0026lt; $pwdLen; $i++) { $pwd .= chr(mt_rand(33, 126)); } return $pwd; }); // 注入对象实例 $di-\u0026gt;set(\u0026#39;simpleSession\u0026#39;, new SimpleSession()); // 依赖在第一次被获取时动态创建，然后保持为单例 $di-\u0026gt;set(\u0026#39;complicatedSession\u0026#39;, function(){ $session = new ComplicatedSession(); $session-\u0026gt;setFirstVisitTime(time()); return $session; }, true); // 获取依赖 echo $di-\u0026gt;get(\u0026#39;foo\u0026#39;); // 以getter的形式获取依赖 echo $di-\u0026gt;getFoo(); ?\u0026gt; 总结 之前的版本中，org\\x3f\\flamework\\base\\WebApplication中保存了数据库连接和日志级别，现在就可以把它们从这个类中解耦了。使用依赖注入，可以使框架核心保持尽可能的精简，最大程度地保证任何一个组件都是可拆卸和更换的，也是防止过度设计的一个很好的机制。\n","permalink":"http://0x3f.org/posts/flamework-dependency-injection/","summary":"\u003ch2 id=\"简述\"\u003e简述\u003c/h2\u003e\n\u003cp\u003e依赖注入是个很好的解耦方法，也可以优雅的实现懒加载。\u003c/p\u003e\n\u003cp\u003e以数据库连接为例，当一个组件用到数据库时，最简单粗暴的办法是在使用前创建连接：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eComponent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003edoSth\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$db\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eDatabaseConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$schema\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$host\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$port\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$login\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$password\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这样做的缺点是代码一旦执行，Component行为将不可更改，有时我们需要在程序执行的过程中决定其行为。很直接地，可以想到给Component添加一个Setter方法：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eComponent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$__db\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003edoSth\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e__db\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"c1\"\u003e// do something ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$db\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e__db\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$db\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这样就把Component和数据库连接解耦了。这时又有一个问题，怎样管理数据库连接？最简单粗暴的办法是在每次使用前创建，如果在程序中多处需要改变数据库连接，这就把代码写死了。\u003c/p\u003e","title":"PHP框架实战（六）：依赖注入"},{"content":"Large sum Work out the first ten digits of the sum of the following one-hundred 50-digit numbers.\n37107287533902102798797998220837590246510135740250 46376937677490009712648124896970078050417018260538 74324986199524741059474233309513058123726617309629 91942213363574161572522430563301811072406154908250 23067588207539346171171980310421047513778063246676 89261670696623633820136378418383684178734361726757 28112879812849979408065481931592621691275889832738 44274228917432520321923589422876796487670272189318 47451445736001306439091167216856844588711603153276 70386486105843025439939619828917593665686757934951 62176457141856560629502157223196586755079324193331 64906352462741904929101432445813822663347944758178 92575867718337217661963751590579239728245598838407 58203565325359399008402633568948830189458628227828 80181199384826282014278194139940567587151170094390 35398664372827112653829987240784473053190104293586 86515506006295864861532075273371959191420517255829 71693888707715466499115593487603532921714970056938 54370070576826684624621495650076471787294438377604 53282654108756828443191190634694037855217779295145 36123272525000296071075082563815656710885258350721 45876576172410976447339110607218265236877223636045 17423706905851860660448207621209813287860733969412 81142660418086830619328460811191061556940512689692 51934325451728388641918047049293215058642563049483 62467221648435076201727918039944693004732956340691 15732444386908125794514089057706229429197107928209 55037687525678773091862540744969844508330393682126 18336384825330154686196124348767681297534375946515 80386287592878490201521685554828717201219257766954 78182833757993103614740356856449095527097864797581 16726320100436897842553539920931837441497806860984 48403098129077791799088218795327364475675590848030 87086987551392711854517078544161852424320693150332 59959406895756536782107074926966537676326235447210 69793950679652694742597709739166693763042633987085 41052684708299085211399427365734116182760315001271 65378607361501080857009149939512557028198746004375 35829035317434717326932123578154982629742552737307 94953759765105305946966067683156574377167401875275 88902802571733229619176668713819931811048770190271 25267680276078003013678680992525463401061632866526 36270218540497705585629946580636237993140746255962 24074486908231174977792365466257246923322810917141 91430288197103288597806669760892938638285025333403 34413065578016127815921815005561868836468420090470 23053081172816430487623791969842487255036638784583 11487696932154902810424020138335124462181441773470 63783299490636259666498587618221225225512486764533 67720186971698544312419572409913959008952310058822 95548255300263520781532296796249481641953868218774 76085327132285723110424803456124867697064507995236 37774242535411291684276865538926205024910326572967 23701913275725675285653248258265463092207058596522 29798860272258331913126375147341994889534765745501 18495701454879288984856827726077713721403798879715 38298203783031473527721580348144513491373226651381 34829543829199918180278916522431027392251122869539 40957953066405232632538044100059654939159879593635 29746152185502371307642255121183693803580388584903 41698116222072977186158236678424689157993532961922 62467957194401269043877107275048102390895523597457 23189706772547915061505504953922979530901129967519 86188088225875314529584099251203829009407770775672 11306739708304724483816533873502340845647058077308 82959174767140363198008187129011875491310547126581 97623331044818386269515456334926366572897563400500 42846280183517070527831839425882145521227251250327 55121603546981200581762165212827652751691296897789 32238195734329339946437501907836945765883352399886 75506164965184775180738168837861091527357929701337 62177842752192623401942399639168044983993173312731 32924185707147349566916674687634660915035914677504 99518671430235219628894890102423325116913619626622 73267460800591547471830798392868535206946944540724 76841822524674417161514036427982273348055556214818 97142617910342598647204516893989422179826088076852 87783646182799346313767754307809363333018982642090 10848802521674670883215120185883543223812876952786 71329612474782464538636993009049310363619763878039 62184073572399794223406235393808339651327408011116 66627891981488087797941876876144230030984490851411 60661826293682836764744779239180335110989069790714 85786944089552990653640447425576083659976645795096 66024396409905389607120198219976047599490197230297 64913982680032973156037120041377903785566085089252 16730939319872750275468906903707539413042652315011 94809377245048795150954100921645863754710598436791 78639167021187492431995700641917969777599028300699 15368713711936614952811305876380278410754449733078 40789923115535562561142322423255033685442488917353 44889911501440648020369068063960672322193204149535 41503128880339536053299340368006977710650566631954 81234880673210146739058568557934581403627822703280 82616570773948327592232845941706525094512325230608 22918802058777319719839450180888072429661980811197 77158542502016545090413245809786882778948721859617 72107838435069186155435662884062257473692284509516 20849603980134001723930671666823555245252804609722 53503534226472524250874054075591789781264330331690\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \u0026#34;bufio\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;math/big\u0026#34; \u0026#34;os\u0026#34; ) func main() { f, err := os.Open(\u0026#34;data.txt\u0026#34;) if nil != err { fmt.Println(err) os.Exit(1) } defer f.Close() reader := bufio.NewReader(f) sum, tmp := big.NewInt(0), big.NewInt(0) for { line, err := reader.ReadString(\u0026#39;\\n\u0026#39;) if nil != err || io.EOF == err { break } tmp.SetString(line, 10) sum = sum.Add(sum, tmp) } fmt.Println(sum.String()[:10]) } I\u0026rsquo;m the 106168th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-13/","summary":"\u003ch2 id=\"large-sum\"\u003eLarge sum\u003c/h2\u003e\n\u003cp\u003eWork out the first ten digits of the sum of the following one-hundred 50-digit numbers.\u003c/p\u003e\n\u003cp\u003e37107287533902102798797998220837590246510135740250\n46376937677490009712648124896970078050417018260538\n74324986199524741059474233309513058123726617309629\n91942213363574161572522430563301811072406154908250\n23067588207539346171171980310421047513778063246676\n89261670696623633820136378418383684178734361726757\n28112879812849979408065481931592621691275889832738\n44274228917432520321923589422876796487670272189318\n47451445736001306439091167216856844588711603153276\n70386486105843025439939619828917593665686757934951\n62176457141856560629502157223196586755079324193331\n64906352462741904929101432445813822663347944758178\n92575867718337217661963751590579239728245598838407\n58203565325359399008402633568948830189458628227828\n80181199384826282014278194139940567587151170094390\n35398664372827112653829987240784473053190104293586\n86515506006295864861532075273371959191420517255829\n71693888707715466499115593487603532921714970056938\n54370070576826684624621495650076471787294438377604\n53282654108756828443191190634694037855217779295145\n36123272525000296071075082563815656710885258350721\n45876576172410976447339110607218265236877223636045\n17423706905851860660448207621209813287860733969412\n81142660418086830619328460811191061556940512689692\n51934325451728388641918047049293215058642563049483\n62467221648435076201727918039944693004732956340691\n15732444386908125794514089057706229429197107928209\n55037687525678773091862540744969844508330393682126\n18336384825330154686196124348767681297534375946515\n80386287592878490201521685554828717201219257766954\n78182833757993103614740356856449095527097864797581\n16726320100436897842553539920931837441497806860984\n48403098129077791799088218795327364475675590848030\n87086987551392711854517078544161852424320693150332\n59959406895756536782107074926966537676326235447210\n69793950679652694742597709739166693763042633987085\n41052684708299085211399427365734116182760315001271\n65378607361501080857009149939512557028198746004375\n35829035317434717326932123578154982629742552737307\n94953759765105305946966067683156574377167401875275\n88902802571733229619176668713819931811048770190271\n25267680276078003013678680992525463401061632866526\n36270218540497705585629946580636237993140746255962\n24074486908231174977792365466257246923322810917141\n91430288197103288597806669760892938638285025333403\n34413065578016127815921815005561868836468420090470\n23053081172816430487623791969842487255036638784583\n11487696932154902810424020138335124462181441773470\n63783299490636259666498587618221225225512486764533\n67720186971698544312419572409913959008952310058822\n95548255300263520781532296796249481641953868218774\n76085327132285723110424803456124867697064507995236\n37774242535411291684276865538926205024910326572967\n23701913275725675285653248258265463092207058596522\n29798860272258331913126375147341994889534765745501\n18495701454879288984856827726077713721403798879715\n38298203783031473527721580348144513491373226651381\n34829543829199918180278916522431027392251122869539\n40957953066405232632538044100059654939159879593635\n29746152185502371307642255121183693803580388584903\n41698116222072977186158236678424689157993532961922\n62467957194401269043877107275048102390895523597457\n23189706772547915061505504953922979530901129967519\n86188088225875314529584099251203829009407770775672\n11306739708304724483816533873502340845647058077308\n82959174767140363198008187129011875491310547126581\n97623331044818386269515456334926366572897563400500\n42846280183517070527831839425882145521227251250327\n55121603546981200581762165212827652751691296897789\n32238195734329339946437501907836945765883352399886\n75506164965184775180738168837861091527357929701337\n62177842752192623401942399639168044983993173312731\n32924185707147349566916674687634660915035914677504\n99518671430235219628894890102423325116913619626622\n73267460800591547471830798392868535206946944540724\n76841822524674417161514036427982273348055556214818\n97142617910342598647204516893989422179826088076852\n87783646182799346313767754307809363333018982642090\n10848802521674670883215120185883543223812876952786\n71329612474782464538636993009049310363619763878039\n62184073572399794223406235393808339651327408011116\n66627891981488087797941876876144230030984490851411\n60661826293682836764744779239180335110989069790714\n85786944089552990653640447425576083659976645795096\n66024396409905389607120198219976047599490197230297\n64913982680032973156037120041377903785566085089252\n16730939319872750275468906903707539413042652315011\n94809377245048795150954100921645863754710598436791\n78639167021187492431995700641917969777599028300699\n15368713711936614952811305876380278410754449733078\n40789923115535562561142322423255033685442488917353\n44889911501440648020369068063960672322193204149535\n41503128880339536053299340368006977710650566631954\n81234880673210146739058568557934581403627822703280\n82616570773948327592232845941706525094512325230608\n22918802058777319719839450180888072429661980811197\n77158542502016545090413245809786882778948721859617\n72107838435069186155435662884062257473692284509516\n20849603980134001723930671666823555245252804609722\n53503534226472524250874054075591789781264330331690\u003c/p\u003e","title":"Project Euler Problem 13 Solved"},{"content":"桃花、迎春花开得很好，但没有秋天长满路边的花有气氛。早上去得晚了，阳坊镇的小笼包收摊了……\n交作业：\n这次一口气上了魔鬼六连弯，弯口溪水别样清啊：\n小蓝月湖，命名权是我的：\n","permalink":"http://0x3f.org/posts/2nd-ride-to-white-goat-valley/","summary":"\u003cp\u003e桃花、迎春花开得很好，但没有秋天长满路边的花有气氛。早上去得晚了，阳坊镇的小笼包收摊了……\u003c/p\u003e\n\u003cp\u003e交作业：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DDU0q8d7/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DDU0sey9/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DDU0s9ak/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这次一口气上了魔鬼六连弯，弯口溪水别样清啊：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DDU0s3cm/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e小蓝月湖，命名权是我的：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DDU2DREG/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"二骑白羊沟"},{"content":"Highly divisible triangular number The sequence of triangle numbers is generated by adding the natural numbers. So the 7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms would be:\n1, 3, 6, 10, 15, 21, 28, 36, 45, 55, \u0026hellip;\nLet us list the factors of the first seven triangle numbers:\n1: 1\n3: 1,3\n6: 1,2,3,6\n10: 1,2,5,10\n15: 1,3,5,15\n21: 1,3,7,21\n28: 1,2,4,7,14,28\nWe can see that 28 is the first triangle number to have over five divisors.\nWhat is the value of the first triangle number to have over five hundred divisors?\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;math\u0026#34; ) func count_divisor(num int64) int64 { var count, factor, lastFactor, exponent int64 = 1, 2, 0, 1 for factor \u0026lt;= num { if math.Mod(float64(num), float64(factor)) == 0 { if factor == lastFactor { exponent++ } else { count *= (exponent + 1) exponent = 1 lastFactor = factor } num /= factor } else { factor++ } } return count } func main() { var count, n int64 = 0, 1 for count \u0026lt; 500 { n++ count = count_divisor(n * (n + 1) / 2) } fmt.Println(n*(n+1)/2, count) } I\u0026rsquo;m the 99509th person to have solved this problem.\n","permalink":"http://0x3f.org/posts/project-euler-12/","summary":"\u003ch2 id=\"highly-divisible-triangular-number\"\u003eHighly divisible triangular number\u003c/h2\u003e\n\u003cp\u003eThe sequence of triangle numbers is generated by adding the natural numbers. So the 7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms would be:\u003c/p\u003e\n\u003cp\u003e1, 3, 6, 10, 15, 21, 28, 36, 45, 55, \u0026hellip;\u003c/p\u003e\n\u003cp\u003eLet us list the factors of the first seven triangle numbers:\u003c/p\u003e\n\u003cp\u003e1: 1\u003cbr\u003e\n3: 1,3\u003cbr\u003e\n6: 1,2,3,6\u003cbr\u003e\n10: 1,2,5,10\u003cbr\u003e\n15: 1,3,5,15\u003cbr\u003e\n21: 1,3,7,21\u003cbr\u003e\n28: 1,2,4,7,14,28\u003c/p\u003e","title":"Project Euler Problem 12 Solved"},{"content":"我用Dropbox在两台电脑间同步个人维基数据，将数据目录从Web Server下软连接到Dropbox里，而对Dropbox目录的备份实际上只包含那个软连接，没有内容，结果当把备份拷贝到另一台电脑上并打开Dropbox后，维基数据被清空了！我积累多年的笔记差一点儿完蛋，幸亏单独备份过维基。然后改将维基数据放到Dropbox里，然后软连接到Web Server下，新问题出现了，Web Server是以http身份运行的，对用户主目录没有权限，当然也不能访问主目录下的Dropbox目录。\n最简单的办法是将主目录、Dropbox、维基目录的权限全部设成777，显然，这样做太不安全。另一种方法是把Dropbox用NFS输出，然后挂载到Web Server下，这么做太蛋疼。最合适的解决方案是Access Control List（存取控制表），它可以为文件和目录设置具体到单个用户或用户组的存取权限，实现像Windows下的文件（目录）共享权限设置那样的效果，而且比后者更强大、灵活。\n使用ACL首先需要目录的挂载选项中包含acl，不过一般缺省都包含这一项。\nACL包含两个命令：getfacl和setfacl，前者用来查看目录或文件的存取控制表，后者用来操作它。\n首先，把维基目录的所有者改成http，并设置目录权限为770：\n1 2 chown -R http:http ~/Dropbox/wiki chmod -R 770 ~/Dropbox/wiki 这时Web Server还是不能访问维基目录，使用getfacl查看用户主目录的ACL：\n1 getfacl ~ 显示结果如下：\ngetfacl: Removing leading \u0026lsquo;/\u0026rsquo; from absolute path names\n# file: home/taoqi\n# owner: taoqi\n# group: users\nuser::rwx\nuser:root:\u0026ndash;x\ngroup::\u0026mdash;\nmask::\u0026ndash;x\nother::\u0026mdash;\n显然，要给http用户访问该目录的权限：\n1 setfacl -m u:http:x ~ 再查看ACL，发现增加了一条：\nuser:http:\u0026ndash;x\n同理，给Dropbox目录也加上这一条规则之后，Web Server就可以访问维基数据目录了。\n","permalink":"http://0x3f.org/posts/share-file-using-access-control-lists/","summary":"\u003cp\u003e我用Dropbox在两台电脑间同步个人维基数据，将数据目录从Web Server下软连接到Dropbox里，而对Dropbox目录的备份实际上只包含那个软连接，没有内容，结果当把备份拷贝到另一台电脑上并打开Dropbox后，维基数据被清空了！我积累多年的笔记差一点儿完蛋，幸亏单独备份过维基。然后改将维基数据放到Dropbox里，然后软连接到Web Server下，新问题出现了，Web Server是以http身份运行的，对用户主目录没有权限，当然也不能访问主目录下的Dropbox目录。\u003c/p\u003e\n\u003cp\u003e最简单的办法是将主目录、Dropbox、维基目录的权限全部设成777，显然，这样做太不安全。另一种方法是把Dropbox用NFS输出，然后挂载到Web Server下，这么做太蛋疼。最合适的解决方案是Access Control List（存取控制表），它可以为文件和目录设置具体到单个用户或用户组的存取权限，实现像Windows下的文件（目录）共享权限设置那样的效果，而且比后者更强大、灵活。\u003c/p\u003e\n\u003cp\u003e使用ACL首先需要目录的挂载选项中包含acl，不过一般缺省都包含这一项。\u003c/p\u003e\n\u003cp\u003eACL包含两个命令：getfacl和setfacl，前者用来查看目录或文件的存取控制表，后者用来操作它。\u003c/p\u003e\n\u003cp\u003e首先，把维基目录的所有者改成http，并设置目录权限为770：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echown -R http:http ~/Dropbox/wiki\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod -R \u003cspan class=\"m\"\u003e770\u003c/span\u003e ~/Dropbox/wiki\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这时Web Server还是不能访问维基目录，使用getfacl查看用户主目录的ACL：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egetfacl ~\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e显示结果如下：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003egetfacl: Removing leading \u0026lsquo;/\u0026rsquo; from absolute path names\u003cbr\u003e\n# file: home/taoqi\u003cbr\u003e\n# owner: taoqi\u003cbr\u003e\n# group: users\u003cbr\u003e\nuser::rwx\u003cbr\u003e\nuser:root:\u0026ndash;x\u003cbr\u003e\ngroup::\u0026mdash;\u003cbr\u003e\nmask::\u0026ndash;x\u003cbr\u003e\nother::\u0026mdash;\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e显然，要给http用户访问该目录的权限：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esetfacl -m u:http:x ~\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e再查看ACL，发现增加了一条：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003euser:http:\u0026ndash;x\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e同理，给Dropbox目录也加上这一条规则之后，Web Server就可以访问维基数据目录了。\u003c/p\u003e","title":"使用存取控制表在Linux用户间共享文件"},{"content":"从大觉寺上，至凤凰岭南线下，全程十六公里，最高海拔一千多米，上升一千米，用时七个多小时，难度适中。全程用行者骑行软件记录，挺好用，GPS定位准，耗电不大，魅族MX3大概用了60%的电。\n记录数据：\n山上的公路很好，在这里骑行挺好的，只是不知道从哪上来：\n在山上接了壶泉水，陆羽《茶经·煮》里说：“其水，用山水上，江水中，井水下”，上水烹茶，不言其中：\n","permalink":"http://0x3f.org/posts/a-walk-through-the-west-mountain/","summary":"\u003cp\u003e从大觉寺上，至凤凰岭南线下，全程十六公里，最高海拔一千多米，上升一千米，用时七个多小时，难度适中。全程用行者骑行软件记录，挺好用，GPS定位准，耗电不大，魅族MX3大概用了60%的电。\u003c/p\u003e\n\u003cp\u003e记录数据：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBVrawlL/medish.jpg\" alt=\"\"\u003e\n\u003cimg src=\"http://pic.yupoo.com/leninlee/DBVraDFN/medish.jpg\" alt=\"\"\u003e\n\u003cimg src=\"http://pic.yupoo.com/leninlee/DBVqWKLy/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e山上的公路很好，在这里骑行挺好的，只是不知道从哪上来：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBVrlHDT/medish.jpg\" alt=\"\"\u003e\n\u003cimg src=\"http://pic.yupoo.com/leninlee/DBVr8MUb/medish.jpg\" alt=\"\"\u003e\n\u003cimg src=\"http://pic.yupoo.com/leninlee/DBVr9DBD/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e在山上接了壶泉水，陆羽《茶经·煮》里说：“其水，用山水上，江水中，井水下”，上水烹茶，不言其中：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBVrbnSf/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"西山徒步——大觉寺至凤凰岭南线"},{"content":"\n谭书可能因为面向学生而显得啰嗦，这本书比谭书精炼。\n","permalink":"http://0x3f.org/posts/after-reading-the-c-programming-language/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DASqD5IQ/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e谭书可能因为面向学生而显得啰嗦，这本书比谭书精炼。\u003c/p\u003e","title":"读完《The C Programming Language》"},{"content":"客居多年，不久前才知道附近有如此底蕴的一个去处，于是赶在开始一段新行程前探访了这里。\n永泰庄东岳庙，始建于明代，经清代纳兰明珠遗言修缮，供奉明珠牌位，所以又叫纳兰家庙，据说纳兰性德也葬在附近，不过已经难觅词踪。\n前殿已经残破不堪，横生凄凉：\n钟鼓楼已经只剩下西面一座：\n虽然没有重簷，正殿仍然显得很有气势：\n宋以后中国知识界思想僵化，明清两代能拿得出手的只有小品和小说，纳兰词是一个异数，有清一代的诗词里，一定少不了那句“人生若只如初见”。\n","permalink":"http://0x3f.org/posts/a-visit-to-the-family-temple-of-nalans/","summary":"\u003cp\u003e客居多年，不久前才知道附近有如此底蕴的一个去处，于是赶在开始一段新行程前探访了这里。\u003c/p\u003e\n\u003cp\u003e永泰庄东岳庙，始建于明代，经清代纳兰明珠遗言修缮，供奉明珠牌位，所以又叫纳兰家庙，据说纳兰性德也葬在附近，不过已经难觅词踪。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBUVKtAr/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBUVLKQF/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e前殿已经残破不堪，横生凄凉：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBUVMdTB/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e钟鼓楼已经只剩下西面一座：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBUWy7Xf/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBUVOlJB/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e虽然没有重簷，正殿仍然显得很有气势：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBUVPpcm/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DBUVQinI/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e宋以后中国知识界思想僵化，明清两代能拿得出手的只有小品和小说，纳兰词是一个异数，有清一代的诗词里，一定少不了那句“人生若只如初见”。\u003c/p\u003e","title":"探访纳兰家庙"},{"content":"\n中国的历史教育培养了一群读了二十年书还分不清五胡十六国和五代十国的人，看看人家是怎么教历史的，提纲挈领比死记签了哪些条约有用多了。\n","permalink":"http://0x3f.org/posts/after-reading-the-shortest-history-of-europe/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DyJGJDhw/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e中国的历史教育培养了一群读了二十年书还分不清五胡十六国和五代十国的人，看看人家是怎么教历史的，提纲挈领比死记签了哪些条约有用多了。\u003c/p\u003e","title":"读完《你一定爱读的极简欧洲史》"},{"content":"\n读完，我首先感到的不是大数据有多可爱，而是有多可怕。\n","permalink":"http://0x3f.org/posts/after-reading-big-data-era/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DwnY4bqO/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e读完，我首先感到的不是大数据有多可爱，而是有多可怕。\u003c/p\u003e","title":"读完《大数据时代》"},{"content":"\n国史奇书，一本书读懂三百年大明。\n","permalink":"http://0x3f.org/posts/after-reading-a-year-of-no-significance/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DvE1PYrK/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e国史奇书，一本书读懂三百年大明。\u003c/p\u003e","title":"读完《万历十五年》"},{"content":"\n用较少的篇幅介绍了golang的语法，然后从实现的角度讲了一些Web应用的概念，最后介绍了beego框架。程序员思维，很实用，讲Web应用基础概念的实现的部分很有用，这方面的书不多。语言表达和示例代码有提升的空间。是Go语言很好的入门教材。\n","permalink":"http://0x3f.org/posts/after-reading-build-web-application-with-golang/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DvvA9fkE/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e用较少的篇幅介绍了golang的语法，然后从实现的角度讲了一些Web应用的概念，最后介绍了beego框架。程序员思维，很实用，讲Web应用基础概念的实现的部分很有用，这方面的书不多。语言表达和示例代码有提升的空间。是Go语言很好的入门教材。\u003c/p\u003e","title":"读完《Go Web编程》"},{"content":"\n还旧账，多年前读的时候这本书还没有写完，趁读完《通鉴》把最后两本解决了。下面计划读的是《万历十五年》，今年是我的明矾年么？\n","permalink":"http://0x3f.org/posts/after-reading-ming-chao-na-xie-shi/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DuSsCV8B/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e还旧账，多年前读的时候这本书还没有写完，趁读完《通鉴》把最后两本解决了。下面计划读的是《万历十五年》，今年是我的明矾年么？\u003c/p\u003e","title":"读完《明朝那些事儿》"},{"content":"\n一部书，二百九十四卷，三百万字，一千三百六十二年，从中华书局20册胡三省注本，到Kindle DXG，再到Kindle Paperwhite，读了四年。\n读史应该先读通史，再读断代史，然后是野史。因为读懂历史必须站在大时代背景上，比如不了解两周封建拓殖史，就不懂什么是“南夷与北狄交，中国不绝若线。”，更不会明白“尊王攘夷”区区四个字有多大的份量。所以十年前我《世说新语》刚读了个开头就读不下去了。\n《通鉴》关注的是兴衰更替，所以很多有意思的历史故事没有记录，尤其是先秦时期，我最喜欢的传奇时代，结果看得索然无味。汉纪部分又包含了太多的上书和诏书。我一度觉得选择读《通鉴》是个错误。\n所幸坚持了下来，鉴于自小说作家司马迁开始，我国历代史家保持著添油加醋的优良传统，越生动的历史往往越不可信，去叶存枝方见国史之骨。如果说两司马有什么区别，前者是用故事讲历史，后者是用历史讲历史，单就史学而言，谁更牛X，一目了然。\n","permalink":"http://0x3f.org/posts/after-reading-tong-jian/","summary":"\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DuMqtc1v/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e一部书，二百九十四卷，三百万字，一千三百六十二年，从中华书局20册胡三省注本，到Kindle DXG，再到Kindle Paperwhite，读了四年。\u003c/p\u003e\n\u003cp\u003e读史应该先读通史，再读断代史，然后是野史。因为读懂历史必须站在大时代背景上，比如不了解两周封建拓殖史，就不懂什么是“南夷与北狄交，中国不绝若线。”，更不会明白“尊王攘夷”区区四个字有多大的份量。所以十年前我《世说新语》刚读了个开头就读不下去了。\u003c/p\u003e\n\u003cp\u003e《通鉴》关注的是兴衰更替，所以很多有意思的历史故事没有记录，尤其是先秦时期，我最喜欢的传奇时代，结果看得索然无味。汉纪部分又包含了太多的上书和诏书。我一度觉得选择读《通鉴》是个错误。\u003c/p\u003e\n\u003cp\u003e所幸坚持了下来，鉴于自小说作家司马迁开始，我国历代史家保持著添油加醋的优良传统，越生动的历史往往越不可信，去叶存枝方见国史之骨。如果说两司马有什么区别，前者是用故事讲历史，后者是用历史讲历史，单就史学而言，谁更牛X，一目了然。\u003c/p\u003e","title":"读完《资治通鉴》"},{"content":"写“烈焰”（Flame）用了一周的业余时间，主要是对平时一些想法的总结和验证。实现了比较完整的控制器层和视图层，对模型层的ActiveRecord实现思路做了一下梳理。\n当然，一个可实用的框架需要包含的东西远不止这些。比如框架中用到代码动态调用的地方，一定要做好语言安全子集的过滤，否则就是很大的安全漏洞。再比如需要支持依赖反转的缓存机制，实现对多种缓存方式的平滑支持。此外，像URI路由、可扩展、多模板方案支持也都是现代框架的标配。这些留待以后有时间再讨论。然而在这次练习的过程中，我突然想到一个问题——PHP是不是适合实现一个完备的框架。\n曾见过一句话，说PHP本身就是一个框架，后来明白，这才是微言大义。PHP有很多高级选项、高级函数和扩展，用得好事半功倍，用不好就是魔鬼。\nPHP本身有很多问题，协议不统一、函数命名混乱、命名空间语法怪异而且鸡肋等等都是老生常谈。在运行模式上，无论是Apache+PHP模块，还是NGINX+FastCGI，都只能实现在纵向层面上对一次请求的处理，由于缺乏在内存中持续运行程序的机制，凡是对程序全局共享并持续占有的东西都不能实现，比如数据库连接池等，以至于很多初始化的工作对于每次请求都要重新执行一次，这意味著面向对象越彻底、封装越多，系统资源的重复消耗越厉害，所以PHP的程序在性能和内存占用上与Java相比有一定缺陷。因此PHP更适合短平快的应用场景，不适合实现复杂的业务逻辑。\n基于这个观点，我认同混合编程。没有哪种语言是完美的，用对的工具做对的事是最理想的。用PHP实现一个完备的框架也许不是个明智的选择，从短平快的角度出发，它更适合用来实现微框架。\n现在微框架是个比较热门的话题，我最早接触的是Python的Bottle和Flask，短小精悍，非常容易上手。微框架主要实现控制器层和视图层，一般不包括模型层。为了以最快的速度将请求路由到处理逻辑，一般以最直接的方式建立URI模板和回调物件之间的映射，控制器层可以以极简的方式实现，例如只做一个像本文后面例子中那样简单的约定。微框架应该尽可能少地包含配置，大部分时候并不需要像Java的S.S.H那样滥用配置，CoC原则就持这样的观点，约定可以解决的问题就不要用配置去做。\n下面只使用两个函数和五条约定实现一个微框架：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 \u0026lt;?php /** * 路由定义与应用 * @param string $route 用作定义路由规则时，此参数为模板字符串， * 使用冒号加参数名作为参数占位符，例如： * on(\u0026#39;/post/edit/:id\u0026#39;, function($id){}); * 用做应用路由规则时，此参数为URI，例如： * on($_SERVER[\u0026#39;REQUEST_URI\u0026#39;]); * @param callable $callback 路由规则的回调逻辑，如果路由规则中 * 含有参数占位符，回调中需存在同名的参数；当函数作为应用路 * 由规则使用时，此参数不指定 * @return void * @since 1.0 */ function on($route, $callback) { static $routes = array(); $regex = \u0026#39;#\u0026#39;.preg_replace(\u0026#39;#:[^\\/]+#\u0026#39;, \u0026#39;.*\u0026#39;, $route).\u0026#39;#\u0026#39;; $routes[$route] = array($regex, $callback); if (is_null($callback)) { foreach ($routes as $r=\u0026gt;$cfg){ if (preg_match($cfg[0], $route)) { $params = array(); $idx = strpos($r, \u0026#39;:\u0026#39;); if (is_int($idx)) { $keys = explode(\u0026#39;/\u0026#39;, substr($r, $idx)); $keys = array_map(function($v){ return trim($v, \u0026#39;:\u0026#39;); }, $keys); $values = explode(\u0026#39;/\u0026#39;, substr($route, $idx)); $params = array_combine($keys, $values); } call_user_func_array($callback, $params); break; } } echo \u0026#39;404\u0026#39;; } } /** * 视图渲染函数 * @param string $view 视图名称 * @param array $params 关联数组，包含需要填到视图模板中的参数键值对 * @return void * @since 1.0 */ function render($view, $params=array()) { extract($data, EXTR_PREFIX_SAME, \u0026#39;tpl_\u0026#39;); $viewFile = dirname(realpath(__FILE__)).DIRECTORY_SEPARATOR.\u0026#39;view\u0026#39; .DIRECTORY_SEPARATOR.$view.\u0026#39;.php\u0026#39;; if (is_readable($viewFile)) { require($viewFile); } else { throw new Exception(\u0026#34;View template $view does not exist or cannot be readable.\u0026#34;); } } ?\u0026gt; on()身兼两用，一是定义路由规则和对应的响应逻辑，一是对指定URI应用路由规则。render()的作用是渲染视图模板。用法如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;?php include \u0026#39;micro.php\u0026#39;; on(\u0026#39;/post/save\u0026#39;, function(){ echo \u0026#34;Post saved.\\n\u0026#34;; }); on(\u0026#39;/mail/send/:address/:title\u0026#39;, function($address, $title){ echo \u0026#34;write letter to $address with title $title\\n\u0026#34;; }); on($_SERVER[\u0026#39;REQUEST_URI\u0026#39;]); ?\u0026gt; 约定如下：\n每个Controller作为一个文件放在项目根目录下的controller目录中，名称即文件名，后缀是“.php”；Action对应于Controller中的各个函数（注意过滤语言安全子集）； 使用php.ini的配置项“auto_prepend_file”和“auto_append_file”实现过滤器； 使用“set_error_handler()”和“set_exception_handler()”自动处理异常和错误； 使用PDO实现数据库抽象层； 视图模板用PHP脚本实现，模板文件放在当前目录下的view目录里，模板文件名即模板名，后缀为“.php”； 当然这离实际可用还差得远，这里只是说明一下微框架的基本理念：第一，打狗不需要金箍棒；第二，大部分项目都是在打狗。结合混合编程，这一点会更明显。\n","permalink":"http://0x3f.org/posts/flamework-summary/","summary":"\u003cp\u003e写“烈焰”（Flame）用了一周的业余时间，主要是对平时一些想法的总结和验证。实现了比较完整的控制器层和视图层，对模型层的ActiveRecord实现思路做了一下梳理。\u003c/p\u003e\n\u003cp\u003e当然，一个可实用的框架需要包含的东西远不止这些。比如框架中用到代码动态调用的地方，一定要做好语言安全子集的过滤，否则就是很大的安全漏洞。再比如需要支持依赖反转的缓存机制，实现对多种缓存方式的平滑支持。此外，像URI路由、可扩展、多模板方案支持也都是现代框架的标配。这些留待以后有时间再讨论。然而在这次练习的过程中，我突然想到一个问题——PHP是不是适合实现一个完备的框架。\u003c/p\u003e\n\u003cp\u003e曾见过一句话，说PHP本身就是一个框架，后来明白，这才是微言大义。PHP有很多高级选项、高级函数和扩展，用得好事半功倍，用不好就是魔鬼。\u003c/p\u003e\n\u003cp\u003ePHP本身有很多问题，协议不统一、函数命名混乱、命名空间语法怪异而且鸡肋等等都是老生常谈。在运行模式上，无论是Apache+PHP模块，还是NGINX+FastCGI，都只能实现在纵向层面上对一次请求的处理，由于缺乏在内存中持续运行程序的机制，凡是对程序全局共享并持续占有的东西都不能实现，比如数据库连接池等，以至于很多初始化的工作对于每次请求都要重新执行一次，这意味著面向对象越彻底、封装越多，系统资源的重复消耗越厉害，所以PHP的程序在性能和内存占用上与Java相比有一定缺陷。因此PHP更适合短平快的应用场景，不适合实现复杂的业务逻辑。\u003c/p\u003e\n\u003cp\u003e基于这个观点，我认同混合编程。没有哪种语言是完美的，用对的工具做对的事是最理想的。用PHP实现一个完备的框架也许不是个明智的选择，从短平快的角度出发，它更适合用来实现微框架。\u003c/p\u003e\n\u003cp\u003e现在微框架是个比较热门的话题，我最早接触的是Python的Bottle和Flask，短小精悍，非常容易上手。微框架主要实现控制器层和视图层，一般不包括模型层。为了以最快的速度将请求路由到处理逻辑，一般以最直接的方式建立URI模板和回调物件之间的映射，控制器层可以以极简的方式实现，例如只做一个像本文后面例子中那样简单的约定。微框架应该尽可能少地包含配置，大部分时候并不需要像Java的S.S.H那样滥用配置，\u003ca href=\"http://en.wikipedia.org/wiki/Convention_over_configuration\"\u003eCoC原则\u003c/a\u003e就持这样的观点，约定可以解决的问题就不要用配置去做。\u003c/p\u003e\n\u003cp\u003e下面只使用两个函数和五条约定实现一个微框架：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * 路由定义与应用\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @param string $route 用作定义路由规则时，此参数为模板字符串，\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *     使用冒号加参数名作为参数占位符，例如：\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *         on(\u0026#39;/post/edit/:id\u0026#39;, function($id){});\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *     用做应用路由规则时，此参数为URI，例如：\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *         on($_SERVER[\u0026#39;REQUEST_URI\u0026#39;]);\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @param callable $callback 路由规则的回调逻辑，如果路由规则中\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *     含有参数占位符，回调中需存在同名的参数；当函数作为应用路\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *     由规则使用时，此参数不指定\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$route\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$callback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$routes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$regex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;#\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreg_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;#:[^\\/]+#\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;.*\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$route\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;#\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$routes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$route\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$regex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$callback\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eis_null\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$callback\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$routes\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$r\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$cfg\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epreg_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$cfg\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nv\"\u003e$route\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$idx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estrpos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$r\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eis_int\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$idx\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$keys\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eexplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esubstr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$r\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$idx\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$keys\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003earray_map\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$v\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003etrim\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$v\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"nv\"\u003e$keys\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$values\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eexplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esubstr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$route\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$idx\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003earray_combine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$keys\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$values\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nx\"\u003ecall_user_func_array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$callback\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;404\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * 视图渲染函数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @param string $view 视图名称\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @param array $params 关联数组，包含需要填到视图模板中的参数键值对\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$view\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eextract\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eEXTR_PREFIX_SAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;tpl_\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$viewFile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edirname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erealpath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003e__FILE__\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDIRECTORY_SEPARATOR\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;view\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDIRECTORY_SEPARATOR\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$view\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.php\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eis_readable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$viewFile\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$viewFile\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;View template \u003c/span\u003e\u003cspan class=\"si\"\u003e$view\u003c/span\u003e\u003cspan class=\"s2\"\u003e does not exist or cannot be readable.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eon()身兼两用，一是定义路由规则和对应的响应逻辑，一是对指定URI应用路由规则。render()的作用是渲染视图模板。用法如下：\u003c/p\u003e","title":"PHP框架实战（∝）：烈焰之终章"},{"content":"简述 Model是MVC框架中最复杂的部分，它要提供与业务逻辑相关的数据及数据处理方法的封装，一般要提供数据对象、数据库连接、事务管理、SQL语句构造、数据CRUD、高级通用业务逻辑等一系列功能。由于Model与Controller和View是解耦的，并且本身具备很高的通用性和复杂性，所以有很多独立的实现。本文希望能通过开发一个简单的ActiveRecord，验证这种Model实现方案的原理和过程。\nORM：对象关系映射 ORM的全称是Object Relational Mapping，即对象关系映射。它是为了解决关系数据库的数学模型和编程语言的对象模型之间的阻抗不匹配问题而提出的解决方案。\n阻抗不匹配是个逼格很高的词。\n阻抗是指电路中的电容、电感、电阻对交流电的障碍作用，就像电阻对直流电的障碍作用。两个系统传递信号可以形象地看成电压的传递，公式为：\nU(out) * Z(in)\nU(in) = \u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;\nZ(in) + Z(out)\n即输入电压等于输出电压与输入阻抗的积除以输入阻抗与输出阻抗的和。\n理想情况肯定是输入电压等于输出电压，这时信号是没有失真的，也就是要求Z(in)与Z(in)+Z(out)之商无限逼近1，这个过程就叫阻抗匹配。关系型数据库是建立在数学模型的基础上，而编程语言中的对象是建立在人对客观世界认知的具象模型上。说白了，阻抗不匹配问题就是说因这两种模型不一致而导致的问题。\nORM通过建立表与对象、列与属性（这只是一般情况）之间的映射关系而解决问题，这可以实现像操作对象一样对数据库中的数据进行增删改查，简化了开发过程。不过ORM的缺点是不能很好地处理复杂数据关系，会出现效率低下的问题，因此必要时仍然需要直接使用SQL。\nActiveRecord ActiveRecord是Ruby on Rails提出的一个概念，其实就是ORM的一种实现，它是对象类型、数据、CRUD方法的合体，使对数据的操作以更具象化的方式实现。下面介绍在Flamework中实现一个简单的ActiveRecord的过程。\n首先实现数据库的接口，提供数据库连接、查询、执行SQL语句、事务管理等基本功能。这里使用PDO实现：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 \u0026lt;?php namespace org\\x3f\\flamework\\base; /** * Database connection above PDO * * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @link http://0x3f.org * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh * @license BSD (3-terms) * @since 1.0 */ class DBConnection { /** * @var PDO Database connection * @since 1.0 */ private $_c; /** * @var array PDO options * @since 1.0 */ private $_options = array( \u0026#39;connection_string\u0026#39; =\u0026gt; \u0026#39;sqlite::memory:\u0026#39;, \u0026#39;username\u0026#39; =\u0026gt; null, \u0026#39;password\u0026#39; =\u0026gt; null, \u0026#39;pdo_options\u0026#39; =\u0026gt; null, ); /** * @var PDOStatement Last PDO statement * @since 1.0 */ private $_lastStmt; public function __construct($options) { $this-\u0026gt;_options = array_merge($this-\u0026gt;_options, $options); } /** * Init DB connection * @param string $dsn DB connection string * @param string $user DB user name * @param string $password DB password * @param array $options PDO options * @return void * @since 1.0 */ private function _connectDB($dsn, $user=\u0026#39;\u0026#39;, $password=\u0026#39;\u0026#39;, $options=array()) { if ($this-\u0026gt;_c == null) { $this-\u0026gt;_c = new \\PDO($dsn, $user, $password, $options); } } /** * Execute sql statement * @param mixed $sql SQL statement or template * @param array $params Parameters for SQL template * @return bool * @since 1.0 */ public function execute($sql, $params=array()) { $this-\u0026gt;_connectDB( $this-\u0026gt;_options[\u0026#39;connection_string\u0026#39;], $this-\u0026gt;_options[\u0026#39;username\u0026#39;], $this-\u0026gt;_options[\u0026#39;password\u0026#39;], $this-\u0026gt;_options[\u0026#39;driver_options\u0026#39;] ); $stmt = $this-\u0026gt;_c-\u0026gt;prepare($sql); $this-\u0026gt;_lastStmt = $stmt; return $stmt-\u0026gt;execute($params); } /** * Fetch rows * @return array Associative array holding data rows * @since 1.0 */ public function rows($sql, $params=array()) { $this-\u0026gt;execute($sql, $params); $stmt = $this-\u0026gt;getLastStmt(); $rows = array(); while ($row = $stmt-\u0026gt;fetch(\\PDO::FETCH_ASSOC)) { $rows[] = $row; } return $rows; } /** * Return the last PDO statement * @return PDOStatement * @since 1.0 */ public function getLastStmt() { return $this-\u0026gt;_lastStmt; } /** * Begin transaction * @return void * @since 1.0 */ public function beginTransaction() { $this-\u0026gt;_c-\u0026gt;beginTransaction(); } /** * Commit the current transaction * @return void * @since 1.0 */ public function commit() { $this-\u0026gt;_c-\u0026gt;commit(); } /** * Rollback the current transaction * @return void * @since 1.0 */ public function rollback() { $this-\u0026gt;_c-\u0026gt;rollBack(); } } ?\u0026gt; 然后实现ActiveRecord类：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 \u0026lt;?php namespace org\\x3f\\flamework\\base; use org\\x3f\\flamework\\Flame; /** * Ancestor class for active records * * @abstract * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @link http://0x3f.org * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh * @license BSD (3-terms) * @since 1.0 */ abstract class ActiveRecord { /** * @var array Models * @since 1.0 */ private static $_models = array(); /** * @var array Attributes and values * @since 1.0 */ private $_data = array(); /** * @var array Attributes and values which are changed * @since 1.0 */ private $_dirtyData = array(); /** * @var bool Whether this record is a new one * @since 1.0 */ private $_isNew = true; /** * Get model instance * @param string $className * @return ActiveRecord * @since 1.0 */ public static function getModel($className = __CLASS__) { if (isset(self::$_models[$className])) { return self::$_models[$className]; } else { $model = self::$_models[$className] = new $className; return $model; } } /** * Get table name of this ActiveRecord * @return string Table name * @since 1.0 */ abstract public function getTableName(); /** * Get the name of the primary key column * @return string Column name * @since 1.0 */ abstract public function getPrimaryKey(); /** * Magic method for accessing model attributes * @param string $attr Attribute name * @return mixed Attribute value * @since 1.0 */ public function __get($attr) { if (isset($this-\u0026gt;_data[$attr])) { return $this-\u0026gt;_data[$attr]; } return null; } /** * Magic method for setting attribute value * @param string $attr Attribute name * @param mixed $val Attribute value * @return void * @since 1.0 */ public function __set($attr, $val) { $this-\u0026gt;_data[$attr] = $val; if (!$this-\u0026gt;getIsNew()) { $this-\u0026gt;_dirtyData[$attr] = $val; } } /** * Magic method for checking if an attribute is set * @param string $attr Attribute name * @return bool * @since 1.0 */ public function __isset($attr) { return isset($this-\u0026gt;_data[$attr]); } /** * Magic method for unsetting an attribute * @param string $attr Attribute name * @return void * @since 1.0 */ public function __unset($attr) { unset($this-\u0026gt;_data[$attr]); } /** * Set this record to be $isNew * @param bool $isNew * @return void * @since 1.0 */ public function setIsNew($isNew) { $this-\u0026gt;_isNew = $isNew; } /** * Whether this record is new * @return bool * @since 1.0 */ public function getIsNew() { return $this-\u0026gt;_isNew; } /** * Find a record by primary key * @param mixed $val Primary key value * @return ActiveRecord * @since 1.0 */ public function findByPk($val) { $sql = \u0026#34;select * from \u0026#34;.$this-\u0026gt;getTableName().\u0026#34; where \u0026#34;.$this-\u0026gt;getPrimaryKey().\u0026#34;=?\u0026#34;; $rows = Flame::app()-\u0026gt;getDBConnection()-\u0026gt;rows($sql, array($val)); if (count($rows) \u0026gt; 0) { return $this-\u0026gt;createInstance($rows[0]); } return null; } /** * Create an instance with given data * @param array $row Associative array * @return ActiveRecord * @since 1.0 */ public function createInstance($row) { $className = get_class($this); $instance = new $className; foreach ($row as $col=\u0026gt;$val){ $instance-\u0026gt;$col = $val; } $instance-\u0026gt;setIsNew(false); return $instance; } /** * Save this record * @return void * @since 1.0 */ public function save() { if ($this-\u0026gt;getIsNew()) { $this-\u0026gt;_insert(); } else { $this-\u0026gt;_update(); } } /** * Save this record into the database as a new row * @return void * @since 1.0 */ private function _insert() { if (count($this-\u0026gt;_data) \u0026gt; 0) { $cols = implode(\u0026#39;, \u0026#39;, array_keys($this-\u0026gt;_data)); $placeHolders = implode(\u0026#39;, \u0026#39;, array_fill(0, count($this-\u0026gt;_data), \u0026#39;?\u0026#39;)); $sql = \u0026#34;insert into \u0026#34;.$this-\u0026gt;getTableName(). \u0026#34; ($cols) values ($placeHolders)\u0026#34;; Flame::app()-\u0026gt;getDBConnection()-\u0026gt;execute($sql, array_values($this-\u0026gt;_data)); } } /** * Save this record * @return void * @since 1.0 */ private function _update() { if (count($this-\u0026gt;_dirtyData) \u0026gt; 0) { $pairs = implode(\u0026#39;=?, \u0026#39;, array_keys($this-\u0026gt;_dirtyData)).\u0026#39;=?\u0026#39;; $sql = \u0026#39;update \u0026#39;.$this-\u0026gt;getTableName().\u0026#34; set $pairs where \u0026#34;.$this-\u0026gt;getPrimaryKey().\u0026#39;=?\u0026#39;; $pk = $this-\u0026gt;getPrimaryKey(); Flame::app()-\u0026gt;getDBConnection()-\u0026gt;execute($sql, array_merge(array_values($this-\u0026gt;_dirtyData), array($this-\u0026gt;$pk))); } } /** * Delete this record * @return void * @since 1.0 */ public function delete() { if (!$this-\u0026gt;getIsNew()) { $pk = $this-\u0026gt;getPrimaryKey(); $sql = \u0026#39;delete from \u0026#39;.$this-\u0026gt;getTableName().\u0026#34; where $pk=?\u0026#34;; Flame::app()-\u0026gt;getDBConnection()-\u0026gt;execute($sql, array($this-\u0026gt;$pk)); } } } ?\u0026gt; 约定，所有子类都必须覆盖和实现getModel()、getTableName()、getPrimaryKey()这三个方法。getModel()返回不包含具体数据的ActiveRecord实例，用于执行对象类型范畴的操作，例如查询符合特定条件的对象。在包含具体数据的ActiveRecord实例中执行针对该具体对象的操作，例如保存和删除。\n为了更好地区分ActiveRecord的属性和对象数据，这里将对象数据存放在关联数组ActiveRecord::$_data里，然后使用__get()、__set()等魔术方法实现像使用ActiveRecord自身属性一样使用对象数据。\n在更新对象时，出于性能考虑，应该只更新被修改过的列。这里借助魔术方法__set()，实现向对象属性赋值时将被修改的属性和值添加到关联数组ActiveRecord::$_dirtyData中。最后构造update语句时，从该数组中取值即可。\nActiveRecord的使用 在Demo项目中实现一个对象，继承ActiveRecord：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;?php namespace org\\x3f\\flamedemo\\model; use org\\x3f\\flamework\\base\\ActiveRecord; class Post extends ActiveRecord { public static function getModel($className=__CLASS__) { return parent::getModel($className); } public function getTableName() { return \u0026#39;post\u0026#39;; } public function getPrimaryKey() { return \u0026#39;id\u0026#39;; } } ?\u0026gt; 用法如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;?php // 根据ID查询对象 $p = Post::getModel()-\u0026gt;findByPk(1); var_dump($p); // 更新对象 $p = new Post(); $p-\u0026gt;setIsNew(false); $p-\u0026gt;id = 3; $p-\u0026gt;title = \u0026#39;bad name 2\u0026#39;; $p-\u0026gt;save(); // 删除对象 $p = new Post(); $p-\u0026gt;setIsNew(false); $p-\u0026gt;id = 3; $p-\u0026gt;delete(); ?\u0026gt; 总结 ORM的根本任务是解决关系模型与对象模型的阻抗不匹配问题。而ActiveRecord是时下很流行的一种ORM的实现方式。在对ActiveRecord的实现中使用了PDO，这是PHP 5.1开始引入的一个轻量的数据访问抽象层，相比以前针对每种数据库使用不同的函数集的方式，它使PHP的数据库操作变得更简单。此外，魔术方法的使用简化了代码，使数据操作变得更灵活。\n本文只实现了一个最基本的ActiveRecord，实际使用时，还要包含SQL语句构造等复杂的逻辑，不过只要弄清楚了核心原理和实现方式，其它也就水到渠成了。\n","permalink":"http://0x3f.org/posts/flamework-active-record/","summary":"\u003ch2 id=\"简述\"\u003e简述\u003c/h2\u003e\n\u003cp\u003eModel是MVC框架中最复杂的部分，它要提供与业务逻辑相关的数据及数据处理方法的封装，一般要提供数据对象、数据库连接、事务管理、SQL语句构造、数据CRUD、高级通用业务逻辑等一系列功能。由于Model与Controller和View是解耦的，并且本身具备很高的通用性和复杂性，所以有很多独立的实现。本文希望能通过开发一个简单的ActiveRecord，验证这种Model实现方案的原理和过程。\u003c/p\u003e\n\u003ch2 id=\"orm对象关系映射\"\u003eORM：对象关系映射\u003c/h2\u003e\n\u003cp\u003eORM的全称是Object Relational Mapping，即对象关系映射。它是为了解决关系数据库的数学模型和编程语言的对象模型之间的阻抗不匹配问题而提出的解决方案。\u003c/p\u003e\n\u003cp\u003e阻抗不匹配是个逼格很高的词。\u003c/p\u003e\n\u003cp\u003e阻抗是指电路中的电容、电感、电阻对交流电的障碍作用，就像电阻对直流电的障碍作用。两个系统传递信号可以形象地看成电压的传递，公式为：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e                \u003cstrong\u003eU\u003c/strong\u003e(out) * \u003cstrong\u003eZ\u003c/strong\u003e(in)\u003cbr\u003e\n\u003cstrong\u003eU\u003c/strong\u003e(in) =  \u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;\u003cbr\u003e\n                \u003cstrong\u003eZ\u003c/strong\u003e(in) + \u003cstrong\u003eZ\u003c/strong\u003e(out)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e即输入电压等于输出电压与输入阻抗的积除以输入阻抗与输出阻抗的和。\u003c/p\u003e\n\u003cp\u003e理想情况肯定是输入电压等于输出电压，这时信号是没有失真的，也就是要求Z(in)与Z(in)+Z(out)之商无限逼近1，这个过程就叫阻抗匹配。关系型数据库是建立在数学模型的基础上，而编程语言中的对象是建立在人对客观世界认知的具象模型上。说白了，阻抗不匹配问题就是说因这两种模型不一致而导致的问题。\u003c/p\u003e\n\u003cp\u003eORM通过建立表与对象、列与属性（\u003cem\u003e这只是一般情况\u003c/em\u003e）之间的映射关系而解决问题，这可以实现像操作对象一样对数据库中的数据进行增删改查，简化了开发过程。不过ORM的缺点是不能很好地处理复杂数据关系，会出现效率低下的问题，因此必要时仍然需要直接使用SQL。\u003c/p\u003e\n\u003ch2 id=\"activerecord\"\u003eActiveRecord\u003c/h2\u003e\n\u003cp\u003eActiveRecord是Ruby on Rails提出的一个概念，其实就是ORM的一种实现，它是对象类型、数据、CRUD方法的合体，使对数据的操作以更具象化的方式实现。下面介绍在Flamework中实现一个简单的ActiveRecord的过程。\u003c/p\u003e\n\u003cp\u003e首先实现数据库的接口，提供数据库连接、查询、执行SQL语句、事务管理等基本功能。这里使用PDO实现：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e  1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 93\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 94\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 95\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 96\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 97\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 98\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 99\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e100\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e101\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e102\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e103\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e104\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e105\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e106\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e107\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e108\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e109\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e110\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e111\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e112\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e113\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e114\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e115\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e116\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e117\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e118\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e119\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e120\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e121\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e122\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e123\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e124\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e125\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e126\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e127\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e128\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e129\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e130\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e131\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e132\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e133\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e134\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nx\"\u003eorg\\x3f\\flamework\\base\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * Database connection above PDO\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @link http://0x3f.org\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @license BSD (3-terms)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDBConnection\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var PDO Database connection \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_c\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var array PDO options \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_options\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s1\"\u003e\u0026#39;connection_string\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;sqlite::memory:\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s1\"\u003e\u0026#39;username\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s1\"\u003e\u0026#39;password\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s1\"\u003e\u0026#39;pdo_options\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var PDOStatement Last PDO statement \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_lastStmt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__construct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$options\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_options\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003earray_merge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_options\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$options\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Init DB connection\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $dsn DB connection string\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $user DB user name\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $password DB password\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param array $options PDO options\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003e_connectDB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$dsn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$user\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$password\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$options\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_c\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_c\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003e\\PDO\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$dsn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$user\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$password\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$options\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Execute sql statement\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param mixed $sql SQL statement or template\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param array $params Parameters for SQL template\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return bool\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$sql\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_connectDB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_options\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;connection_string\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_options\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;username\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_options\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;password\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_options\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;driver_options\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$stmt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_c\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eprepare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$sql\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_lastStmt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$stmt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$stmt\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$params\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Fetch rows\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return array Associative array holding data rows\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$sql\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$sql\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$params\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$stmt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetLastStmt\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$rows\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$row\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$stmt\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e\\PDO\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eFETCH_ASSOC\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$rows\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$row\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$rows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Return the last PDO statement\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return PDOStatement\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetLastStmt\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_lastStmt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Begin transaction\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003ebeginTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_c\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ebeginTransaction\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Commit the current transaction\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003ecommit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_c\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ecommit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Rollback the current transaction\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003erollback\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_c\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003erollBack\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后实现ActiveRecord类：\u003c/p\u003e","title":"PHP框架实战（五）：ORM与ActiveRecord"},{"content":"目标 实现MVC模型的View层，Controller的Action中应可以将从Model层获取的数据填充到View模板中，并将渲染结果返回给访问者。本文并不志在实现一个完备的模板框架，相应的需求可借助Smarty这样现有的实现。\n获取代码 1 git checkout v0.4 设计与实现 View的模板是最好实现的，因为PHP本身就是一个模板语言，所以这里实现的模板主要是指几条约定：\n模板文件本身是一个普通PHP文件，文件名后缀是“.php”； 模板文件应存储在项目指定的模板基础目录中； 模板名称指模板文件相对于项目的模板基础目录的路径，并且去掉文件后缀； 模板本身的实际效果等同于在Controller的Action中执行的代码，故可以调用Controller的所有方法以及Flame对象的方法等内容； 所有要填充到模板中的数据以键值对的形式存储在一个关联数组中，并传递给渲染模板的方法，在模板中使用与键名相同的变量调用数据； View的渲染方法\n添加Controller::render()方法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;?php // ... /** * Render the view template with data * @param string $view View template relative path to base path of the templates * For example, \u0026#39;post/list\u0026#39; point to file /srv/http/mysite/protected/view/post/list.php * @param array $data Associative array in which data is stored as key-value pairs * @return void * @since 1.0 */ public function render($view, $data) { extract($data, EXTR_PREFIX_SAME, \u0026#39;tpl_\u0026#39;); $viewFile = Flame::app()-\u0026gt;getViewPath().DIRECTORY_SEPARATOR.$view.\u0026#39;.php\u0026#39;; if (is_readable($viewFile)) { require($viewFile); } else { throw new FlameException(\u0026#34;View template $view does not exist or cannot be readable.\u0026#34;); } } // ... ?\u0026gt; $view是模板名称，$data是要填充到模板中的数据。\n验证Demo 在Demo项目的protected下新增文件“view/post/list.php”，并创建不存在的这两个上级目录“view”和“post”。内容如下：\n1 2 3 4 5 6 7 8 9 10 \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-type\u0026#34; content=\u0026#34;text/html; charset=utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Post\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;?php echo $name; ?\u0026gt;\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;\u0026lt;?php echo $age; ?\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 将DefaultController::index()方法修改为：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php // ... public function index() { $this-\u0026gt;render(\u0026#39;post/list\u0026#39;, array( \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;leigh\u0026#39;, \u0026#39;age\u0026#39; =\u0026gt; 23, )); } // ... ?\u0026gt; 访问Demo项目，页面将显示预期的内容和样式。\n总结 PHP本身的特点使得View这一层很容易实现。不过，随著富客户端的流行，MVC模型的View这一层正在被逐渐弱化，现在主流的开发方式是前端通过AJAX与服务器端交换数据，而不是把数据填充到模板中再返回给客户端。\n","permalink":"http://0x3f.org/posts/flamework-view-rendering/","summary":"\u003ch2 id=\"目标\"\u003e目标\u003c/h2\u003e\n\u003cp\u003e实现MVC模型的\u003cstrong\u003eV\u003c/strong\u003eiew层，Controller的Action中应可以将从Model层获取的数据填充到View模板中，并将渲染结果返回给访问者。本文并不志在实现一个完备的模板框架，相应的需求可借助Smarty这样现有的实现。\u003c/p\u003e\n\u003ch2 id=\"获取代码\"\u003e获取代码\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit checkout v0.4\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"设计与实现\"\u003e设计与实现\u003c/h2\u003e\n\u003cp\u003eView的模板是最好实现的，因为PHP本身就是一个模板语言，所以这里实现的模板主要是指几条约定：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e模板文件本身是一个普通PHP文件，文件名后缀是“.php”；\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e模板文件应存储在项目指定的模板基础目录中；\u003c/li\u003e\n\u003cli\u003e模板名称指模板文件相对于项目的模板基础目录的路径，并且去掉文件后缀；\u003c/li\u003e\n\u003cli\u003e模板本身的实际效果等同于在Controller的Action中执行的代码，故可以调用Controller的所有方法以及Flame对象的方法等内容；\u003c/li\u003e\n\u003cli\u003e所有要填充到模板中的数据以键值对的形式存储在一个关联数组中，并传递给渲染模板的方法，在模板中使用与键名相同的变量调用数据；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eView的渲染方法\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e添加Controller::render()方法：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Render the view template with data\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $view View template relative path to base path of the templates\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *                     For example, \u0026#39;post/list\u0026#39; point to file /srv/http/mysite/protected/view/post/list.php\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param array $data Associative array in which data is stored as key-value pairs\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$view\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eextract\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eEXTR_PREFIX_SAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;tpl_\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$viewFile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlame\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetViewPath\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDIRECTORY_SEPARATOR\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$view\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.php\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eis_readable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$viewFile\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$viewFile\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlameException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;View template \u003c/span\u003e\u003cspan class=\"si\"\u003e$view\u003c/span\u003e\u003cspan class=\"s2\"\u003e does not exist or cannot be readable.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e$view是模板名称，$data是要填充到模板中的数据。\u003c/p\u003e","title":"PHP框架实战（四）：View的模板与渲染"},{"content":"目标 实现Controller和Filter，程序可以从HTTP请求中解析Controller和Action，并在这两个切面级别实现Filter链。此外，在Controller中，可以使用Action的参数直接访问HTTP请求中的同名参数。\n获取代码 项目目录结构做了调整，framework目录存放Flamework框架源码，demo目录存放示例项目。\n1 git checkout v0.3 设计与实现 Controller的实现\n要求请求URL的格式如下：\nhttp://www.mydomain.com/index.php?r=post/save\nr表示Route，斜杠前面的post表示Controller的名称，后面的save表示Action的名称。对HTTP请求的各种处理逻辑封装在新对象HttpRequest中：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 \u0026lt;?php namespace org\\x3f\\flamework\\base; use org\\x3f\\flamework\\Flame as Flame; /** * HTTP request wrapper * * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @link http://0x3f.org * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh * @license BSD (3-terms) * @since 1.0 */ class HttpRequest { /** * @var HttpRequest Singleton instance * @since 1.0 */ private static $_instance; /** * @var string Controller name, null if no one is given * @since 1.0 */ private $_controller; /** * @var string Action name, null if no one is given * @since 1.0 */ private $_action; /** * Singleton constructor * @return void * @since 1.0 */ private function __construct() { $this-\u0026gt;parseRoute(); } /** * Disable the cloning * @return void * @since 1.0 */ public function __clone() { trigger_error(\u0026#39;Clone is not allow!\u0026#39;, E_USER_ERROR); } /** * Get the singleton instance * @return HttpRequest * @since 1.0 */ public static function getInstance() { if (!(self::$_instance instanceof self)) self::$_instance = new self; return self::$_instance; } /** * Parse request route, set controller and action names * * @return void * @since 1.0 */ public function parseRoute() { if (isset($_GET[\u0026#39;r\u0026#39;])) { $arr = explode(\u0026#39;/\u0026#39;, $_GET[\u0026#39;r\u0026#39;]); $this-\u0026gt;_controller = $arr[0]; if (count($arr)\u0026gt;1) $this-\u0026gt;_action = $arr[1]; } else { $this-\u0026gt;_controller = Flame::app()-\u0026gt;getDefaultController(); } } /** * Get controller name * * @return string null if no controller is present * @since 1.0 */ public function getController() { return $this-\u0026gt;_controller; } /** * Get action name * * @return string null if no action is found * @since 1.0 */ public function getAction() { return $this-\u0026gt;_action; } /** * Get parameter value * * @param string $param Parameter name * @return mixed Parameter value * @since 1.0 */ public function getParam($param) { if (isset($_REQUEST[$param])) return $_REQUEST[$param]; return null; } } ?\u0026gt; 考虑到HttpRequest可能在多个地方被调用，所以用单例模式实现。\nWebApplication中添加如下内容：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 \u0026lt;?php class WebApplication { // ... /** * @var string The default controller name * @since 1.0 */ public $defaultController = \u0026#39;default\u0026#39;; // ... /** * Get the default controller name * @return string Controller name * @since 1.0 */ public function getDefaultController() { return $this-\u0026gt;defaultController; } /** * Get controller path * @return string The controller path * @since 1.0 */ public function getControllerPath() { return $this-\u0026gt;getProtectedPath().DIRECTORY_SEPARATOR.\u0026#39;controller\u0026#39;; } /** * Create an instance of the controller * @param string $controllerName * @return Controller Controller instance * @since 1.0 */ public function createController($controllerName) { $className = ucfirst($controllerName).\u0026#39;Controller\u0026#39;; $classFile = $this-\u0026gt;getControllerPath().DIRECTORY_SEPARATOR.\u0026#34;$className.php\u0026#34;; if (file_exists($classFile)) { $ns = include_once($classFile); $fullClassName = \u0026#34;$ns\\\\$className\u0026#34;; if (class_exists($fullClassName)) { return new $fullClassName(); } else { throw new HttpException(404, \u0026#34;Request to $controllerName is unresolvable.\u0026#34;); } } else { throw new HttpException(404, \u0026#34;Request to $controllerName is unresolvable.\u0026#34;); } } } ?\u0026gt; 程序应指定一个缺省的Controller，覆盖$defaultController属性即可，默认为“default”。Controller的类名应在名称后面加“Controller”字样的后缀。由于需要包含命名空间的完整类名来动态实例化Controller，故Controller的源码中都应在最后返回其命名空间（return __NAMESPACE__;）。\n增加Controller类，作为所有Controller的父类：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 \u0026lt;?php namespace org\\x3f\\flamework\\base; use org\\x3f\\flamework\\exceptions\\HttpException; /** * Ancestor class for all controllers * * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @link http://0x3f.org * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh * @license BSD (3-terms) * @since 1.0 */ class Controller { /** * @var string The default action * @since 1.0 */ protected $defaultAction = \u0026#39;index\u0026#39;; /** * @var array Filter classnames and rules. * This is an associative array, in which keys are classnames of filters, * and values are regular expressions. * For example: * array( * \u0026#39;org\\\\x3f\\\\flamedemo\\filter\\\\PerformanceFilter\u0026#39; =\u0026gt; \u0026#39;/^(save|update|delete)$/\u0026#39;, * ); * @since 1.0 */ protected $filters = array(); /** * Process http request * @param HttpRequest $request * @return void * @since 1.0 */ public function process(HttpRequest $request) { $action = $request-\u0026gt;getAction() === null ? $this-\u0026gt;defaultAction : $request-\u0026gt;getAction(); if (method_exists($this, $action)) { // do parameter bindings $method = new \\ReflectionMethod(get_class($this), $action); $params = array(); foreach ($method-\u0026gt;getParameters() as $param){ if (isset($_REQUEST[$param-\u0026gt;getName()])) { $params[] = $_REQUEST[$param-\u0026gt;getName()]; } else if ($param-\u0026gt;isDefaultValueAvailable()) { $params[] = $param-\u0026gt;getDefaultValue(); } else { throw new HttpException(400, \u0026#34;Parameter \u0026#34;.$param-\u0026gt;getName().\u0026#34; is missing.\u0026#34;); } } // create filter chain and run it $filters = $this-\u0026gt;getActionFilters($action); $chain = new FilterChain($this, $action, $params, $filters); $chain-\u0026gt;run(); } else { $msg = \u0026#39;Request to \u0026#39;.$request-\u0026gt;getController().\u0026#39;/\u0026#39;.$action.\u0026#39; cannot be resolved, action does not exist.\u0026#39;; throw new HttpException(404, $msg); } } /** * Get filters for the given action * @param string $action * @return array Filter names * @since 1.0 */ public function getActionFilters($action) { $filters = array(); foreach ($this-\u0026gt;filters as $filterClass=\u0026gt;$regex){ if (preg_match($regex, $action)) $filters[] = $filterClass; } return $filters; } } ?\u0026gt; Controller::process()是入口方法，它会通过反射机制实现HTTP参数与Action参数的绑定，并指定Action。\nFilter与Filter链的实现\nFilter中实现before()和after()方法，Filter链通过对Filter按顺序递归调用，实现所有Filter::before()方法在切面之前顺序执行，并且所有Filter::after()方法在切面之后逆序执行。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 \u0026lt;?php namespace org\\x3f\\flamework\\base; /** * Ancestor class for all filters * * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @link http://0x3f.org * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh * @license BSD (3-terms) * @since 1.0 */ class Filter { /** * Run this filter and the filter chain * @param FilterChain $chain * @return void * @since 1.0 */ public function filter(FilterChain $chain) { if ($this-\u0026gt;before($chain)) { $chain-\u0026gt;run(); $this-\u0026gt;after($chain); } } /** * The logic to be executed before the aspect point * @param FilterChain $chain * @return boolean Return true to continue the filter chain, return false to break the chain * @since 1.0 */ protected function before(FilterChain $chain) { return true; } /** * The logic to be executed after the aspect point * @param FilterChain $chain * @return void * @since 1.0 */ protected function after(FilterChain $chain) { } } ?\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 \u0026lt;?php namespace org\\x3f\\flamework\\base; /** * Filter chain * * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt; * @link http://0x3f.org * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh * @license BSD (3-terms) * @since 1.0 */ class FilterChain { /** * @var object Object to be filtered * @since 1.0 */ public $obj; /** * @var string Method of the object to be filtered * @since 1.0 */ public $method; /** * @var array Parameters to be passed to the method * @since 1.0 */ public $params; /** * @var array Filters * @since 1.0 */ public $filters; /** * @var int The offset of filters array * @since 1.0 */ private $_offset = 0; public function __construct($obj, $method, $params, $filters) { $this-\u0026gt;obj = $obj; $this-\u0026gt;method = $method; $this-\u0026gt;params = $params; $this-\u0026gt;filters = $filters; } /** * Run this filter and the filter chain * @return void * @since 1.0 */ public function run() { $filter = $this-\u0026gt;nextFilter(); if ($filter instanceof Filter) { $filter-\u0026gt;filter($this); } else { call_user_func_array(array($this-\u0026gt;obj, $this-\u0026gt;method), $this-\u0026gt;params); } } /** * Get next filter * @return Filter Filter instance * @since 1.0 */ private function nextFilter() { if ($this-\u0026gt;_offset \u0026lt; count($this-\u0026gt;filters)) { $filter = $this-\u0026gt;filters[$this-\u0026gt;_offset]; $this-\u0026gt;_offset++; return new $filter; } } } ?\u0026gt; 对FilterChain和Filter的使用方法在前面的WebApplication::run()和Controller::process()中均有包含。Controller级的Filter在配置文件中设置，内容如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;?php return array( // ... // app namespace and its path \u0026#39;namespaces\u0026#39; =\u0026gt; array(\u0026#39;org\\\\x3f\\\\flamedemo\u0026#39; =\u0026gt; \u0026#39;/srv/http/flamework/demo/protected\u0026#39;), // filter classes \u0026#39;filters\u0026#39; =\u0026gt; array( \u0026#39;org\\\\x3f\\\\flamedemo\\\\filter\\\\GlobalFilterA\u0026#39;, \u0026#39;org\\\\x3f\\\\flamedemo\\\\filter\\\\GlobalFilterB\u0026#39;, ), ); ?\u0026gt; Action级的Filter在Controller里覆盖$filters属性：\n1 2 3 4 5 6 7 8 9 \u0026lt;?php // ... protected $filters = array( \u0026#39;org\\\\x3f\\\\flamedemo\\\\filter\\\\ActionFilterC\u0026#39; =\u0026gt; \u0026#39;/^(index|noindex)$/\u0026#39;, ); // ... ?\u0026gt; Action级别的Filter通过$filters数组中的正则表达式选择适用的Action。\nDemo验证 Demo中实现了两个Controller级别的Filter（GlobalFilterA和GlobalFilterB），一个Action级别的Filter（ActionFilterC），访问demo项目，页面打印如下结果：\norg\\x3f\\flamedemo\\filter\\GlobalFilterA::before org\\x3f\\flamedemo\\filter\\GlobalFilterB::before org\\x3f\\flamedemo\\filter\\ActionFilterC::before org\\x3f\\flamedemo\\controller\\Defaultcontroller::index org\\x3f\\flamedemo\\filter\\ActionFilterC::after org\\x3f\\flamedemo\\filter\\GlobalFilterB::after org\\x3f\\flamedemo\\filter\\GlobalFilterA::after\n总结 WebApplication作为程序的统一入口，通过对HTTP请求的解析动态创建Controller，并借此实现了Controller级别的Filter链。Controller通过反射机制实现了HTTP参数与Action参数的绑定，以及Action级别的Filter链。而通过对Filter的递归执行，Filter链实现了面向切面编程。\n","permalink":"http://0x3f.org/posts/flamework-controller-and-filter/","summary":"\u003ch2 id=\"目标\"\u003e目标\u003c/h2\u003e\n\u003cp\u003e实现Controller和Filter，程序可以从HTTP请求中解析Controller和Action，并在这两个切面级别实现Filter链。此外，在Controller中，可以使用Action的参数直接访问HTTP请求中的同名参数。\u003c/p\u003e\n\u003ch2 id=\"获取代码\"\u003e获取代码\u003c/h2\u003e\n\u003cp\u003e项目目录结构做了调整，framework目录存放Flamework框架源码，demo目录存放示例项目。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit checkout v0.3\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"设计与实现\"\u003e设计与实现\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eController的实现\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e要求请求URL的格式如下：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://www.mydomain.com/index.php?r=post/save\"\u003ehttp://www.mydomain.com/index.php?r=post/save\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003er\u003c/strong\u003e表示Route，斜杠前面的\u003cstrong\u003epost\u003c/strong\u003e表示Controller的名称，后面的\u003cstrong\u003esave\u003c/strong\u003e表示Action的名称。对HTTP请求的各种处理逻辑封装在新对象HttpRequest中：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e  1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 93\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 94\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 95\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 96\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 97\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 98\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 99\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e100\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e101\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e102\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e103\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e104\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e105\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e106\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e107\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e108\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e109\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e110\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e111\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e112\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e113\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e114\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e115\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e116\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e117\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e118\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e119\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nx\"\u003eorg\\x3f\\flamework\\base\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nx\"\u003eorg\\x3f\\flamework\\Flame\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlame\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * HTTP request wrapper\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @author Donie Leigh \u0026lt;donie.leigh@gmail.com\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @link http://0x3f.org\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @copyright Copyright \u0026amp;copy; 2013-2014 Donie Leigh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @license BSD (3-terms)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHttpRequest\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var HttpRequest Singleton instance \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_instance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var string Controller name, null if no one is given \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_controller\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var string Action name, null if no one is given \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_action\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Singleton constructor\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__construct\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eparseRoute\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Disable the cloning\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__clone\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003etrigger_error\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Clone is not allow!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eE_USER_ERROR\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Get the singleton instance\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return HttpRequest\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_instance\u003c/span\u003e \u003cspan class=\"nx\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_instance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_instance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Parse request route, set controller and action names\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eparseRoute\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;r\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$arr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eexplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;r\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_controller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$arr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$arr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_action\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$arr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_controller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlame\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetDefaultController\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Get controller name\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return string null if no controller is present\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetController\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_controller\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Get action name\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return string null if no action is found\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetAction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003e_action\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Get parameter value\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $param Parameter name\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return mixed Parameter value\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetParam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$param\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_REQUEST\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$param\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_REQUEST\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$param\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e考虑到HttpRequest可能在多个地方被调用，所以用单例模式实现。\u003c/p\u003e","title":"PHP框架实战（三）：实现Controller和Filter"},{"content":"目标 实现错误和异常的自动捕获和处理。\n获取代码 1 git checkout v0.2 设计与实现 使用set_error_handler()和set_exception_handler()两个函数注册错误和异常的处理方法，并在两个处理方法中先调用用户自定义的错误和异常处理逻辑，如果自定义逻辑不存在或者返回false，继续调用框架缺省的处理逻辑，输出错误信息到页面。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 \u0026lt;?php class WebApplication { // ... /** * @var boolean Whether to enable error auto-handling, default to true * @since 1.0 */ public $enableErrorHandling = true; /** * @var boolean Whether to enable exception auto-handling, default to true * @since 1.0 */ public $enableExceptionHandling = true; /** * @var callable Error handler * @since 1.0 */ public $errorHandler; /** * @var callable Exception handler * @since 1.0 */ public $exceptionHandler; /** * @var boolean Whether to enable debug mode, default to false * @since 1.0 */ public $debug = false; /** * @param string $config */ public function __construct($config) { // ... $this-\u0026gt;initErrorHandlers(); } /** * Initialize auto-handling for errors and exceptions * @return void * @since 1.0 */ public function initErrorHandlers() { if ($this-\u0026gt;enableErrorHandling == true) set_error_handler(array($this, \u0026#39;handleError\u0026#39;), error_reporting()); if ($this-\u0026gt;enableExceptionHandling == true) set_exception_handler(array($this, \u0026#39;handleException\u0026#39;)); } /** * Handle errors * @param int $code * @param string $message * @param string $file * @param int $line * @return void * @since 1.0 */ public function handleError($code, $message, $file, $line) { // prevent recursive errors restore_error_handler(); restore_exception_handler(); $msg = \u0026#34;Error $code: $message ($file:$line)\u0026#34;; Flame::error($msg); // let errorHandler() return true to prevent displayError() if (is_callable($this-\u0026gt;errorHandler) \u0026amp;\u0026amp; call_user_func($this-\u0026gt;errorHandler, $code, $message, $file, $line) !== true) $this-\u0026gt;displayError($code, $message, $file, $line); exit(1); } /** * Handle exceptions * @param Exception $exception * @return void * @since 1.0 */ public function handleException($exception) { // prevent recursive errors restore_error_handler(); restore_exception_handler(); $msg = get_class($exception).\u0026#39;: \u0026#39;.$exception-\u0026gt;getMessage().\u0026#39; (\u0026#39;.$exception-\u0026gt;getFile().\u0026#39;:\u0026#39;.$exception-\u0026gt;getLine().\u0026#34;\\n\u0026#34;.$exception-\u0026gt;getTraceAsString(); Flame::error($msg); // let exceptionHandler() return true to prevent displayException() if (is_callable($this-\u0026gt;exceptionHandler) \u0026amp;\u0026amp; call_user_func($this-\u0026gt;exceptionHandler, $exception) !== true) $this-\u0026gt;displayException($exception); exit(1); } /** * Display error information * @param int $code * @param string $message * @param string $file * @param int $line * @return void * @since 1.0 */ public function displayError($code, $message, $file, $line) { if ($this-\u0026gt;debug == true) { echo \u0026#34;\u0026lt;h1\u0026gt;Error $code\u0026lt;/h1\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;p\u0026gt;$message in ($file:$line)\u0026lt;/p\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; debug_print_backtrace(); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; } else { echo \u0026#34;\u0026lt;h1\u0026gt;Error $code\u0026lt;/h1\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;p\u0026gt;$message\u0026lt;/p\u0026gt;\u0026#34;; } } /** * Display exception information * @param Exception $exception * @return void * @since 1.0 */ public function displayException($exception) { if ($this-\u0026gt;debug == true) { echo \u0026#39;\u0026lt;h1\u0026gt;\u0026#39;.get_class($exception).\u0026#39;\u0026lt;/h1\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;p\u0026gt;\u0026#39;.$exception-\u0026gt;getMessage().\u0026#39; (\u0026#39;.$exception-\u0026gt;getFile().\u0026#39;:\u0026#39;.$exception-\u0026gt;getLine().\u0026#39;)\u0026lt;/p\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;.$exception-\u0026gt;getTraceAsString().\u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; } else { echo \u0026#39;\u0026lt;h1\u0026gt;\u0026#39;.get_class($exception).\u0026#39;\u0026lt;/h1\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;p\u0026gt;\u0026#39;.$exception-\u0026gt;getMessage().\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;; } } // ... } ?\u0026gt; “handleError()”和“handleException()”中先调用了“restore_error_handler()”和“restore_exception_handler()”，用于防止递归处理。\n开发者可以在配置数组中指定自定义的错误和异常处理逻辑：\n1 2 3 4 5 6 7 8 9 10 \u0026lt;?php return array( // ... \u0026#39;exceptionHandler\u0026#39; =\u0026gt; function($exception) { var_dump($exception); return true; }, \u0026#39;errorHandler\u0026#39; =\u0026gt; array(\u0026#39;MyClass\u0026#39;, \u0026#39;handleError\u0026#39;), ); ?\u0026gt; “errorHandler”和“exceptionHandler”的值必须是一个callable类型，在这个callable结束时，如果不希望后续逻辑（例如框架自己的错误、异常处理逻辑）继续处理，就返回true，此时程序将会终止执行并退出。\nDemo验证 在WebApplication::run()中抛出一个异常或使用trigger_error()触发一个错误，可以看到均被拦截和处理。\n总结 引入错误和异常的自动处理可以极大地简化代码。我们经常需要在AJAX请求出错时返回一个JSON字符串，并由客户端决定如何处理，这时就可以使用自定义的处理逻辑处理错误和异常，而Controller里只实现正常的逻辑即可，无需再有大量难看的try\u0026hellip;catch块。\n","permalink":"http://0x3f.org/posts/flamework-error-auto-handling/","summary":"\u003ch2 id=\"目标\"\u003e目标\u003c/h2\u003e\n\u003cp\u003e实现错误和异常的自动捕获和处理。\u003c/p\u003e\n\u003ch2 id=\"获取代码\"\u003e获取代码\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit checkout v0.2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"设计与实现\"\u003e设计与实现\u003c/h2\u003e\n\u003cp\u003e使用set_error_handler()和set_exception_handler()两个函数注册错误和异常的处理方法，并在两个处理方法中先调用用户自定义的错误和异常处理逻辑，如果自定义逻辑不存在或者返回false，继续调用框架缺省的处理逻辑，输出错误信息到页面。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e  1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 93\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 94\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 95\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 96\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 97\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 98\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 99\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e100\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e101\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e102\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e103\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e104\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e105\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e106\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e107\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e108\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e109\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e110\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e111\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e112\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e113\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e114\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e115\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e116\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e117\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e118\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e119\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e120\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e121\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e122\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e123\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e124\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e125\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e126\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e127\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e128\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e129\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e130\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e131\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e132\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e133\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e134\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e135\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e136\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e137\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e138\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e139\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e140\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e141\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e142\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e143\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e144\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eWebApplication\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var boolean Whether to enable error auto-handling, default to true \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$enableErrorHandling\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var boolean Whether to enable exception auto-handling, default to true \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$enableExceptionHandling\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var callable Error handler \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$errorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var callable Exception handler \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$exceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @var boolean Whether to enable debug mode, default to false \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nv\"\u003e$debug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $config\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"fm\"\u003e__construct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003einitErrorHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Initialize auto-handling for errors and exceptions\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003einitErrorHandlers\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eenableErrorHandling\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eset_error_handler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;handleError\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror_reporting\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eenableExceptionHandling\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eset_exception_handler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;handleException\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Handle errors\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param int $code\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $message\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $file\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param int $line\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$code\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$message\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// prevent recursive errors\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"nx\"\u003erestore_error_handler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003erestore_exception_handler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$msg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Error \u003c/span\u003e\u003cspan class=\"si\"\u003e$code\u003c/span\u003e\u003cspan class=\"s2\"\u003e: \u003c/span\u003e\u003cspan class=\"si\"\u003e$message\u003c/span\u003e\u003cspan class=\"s2\"\u003e (\u003c/span\u003e\u003cspan class=\"si\"\u003e$file\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\u003c/span\u003e\u003cspan class=\"si\"\u003e$line\u003c/span\u003e\u003cspan class=\"s2\"\u003e)\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eFlame\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$msg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// let errorHandler() return true to prevent displayError()\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eis_callable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eerrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ecall_user_func\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eerrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$code\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$message\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003edisplayError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$code\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$message\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Handle exceptions\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param Exception $exception\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// prevent recursive errors\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"nx\"\u003erestore_error_handler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003erestore_exception_handler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$msg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eget_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;: \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; (\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetFile\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetLine\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetTraceAsString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eFlame\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$msg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// let exceptionHandler() return true to prevent displayException()\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eis_callable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eexceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ecall_user_func\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eexceptionHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003edisplayException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Display error information\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param int $code\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $message\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param string $file\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param int $line\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003edisplayError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$code\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$message\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$line\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003edebug\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;h1\u0026gt;Error \u003c/span\u003e\u003cspan class=\"si\"\u003e$code\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026lt;/h1\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;p\u0026gt;\u003c/span\u003e\u003cspan class=\"si\"\u003e$message\u003c/span\u003e\u003cspan class=\"s2\"\u003e in (\u003c/span\u003e\u003cspan class=\"si\"\u003e$file\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\u003c/span\u003e\u003cspan class=\"si\"\u003e$line\u003c/span\u003e\u003cspan class=\"s2\"\u003e)\u0026lt;/p\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;pre\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003edebug_print_backtrace\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;h1\u0026gt;Error \u003c/span\u003e\u003cspan class=\"si\"\u003e$code\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026lt;/h1\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;p\u0026gt;\u003c/span\u003e\u003cspan class=\"si\"\u003e$message\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026lt;/p\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"sd\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * Display exception information\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @param Exception $exception\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @return void\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     * @since 1.0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003edisplayException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003edebug\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;h1\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;/h1\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;p\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; (\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetFile\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetLine\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;)\u0026lt;/p\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;pre\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetTraceAsString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;h1\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget_class\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;/h1\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;p\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$exception\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e“handleError()”和“handleException()”中先调用了“restore_error_handler()”和“restore_exception_handler()”，用于防止递归处理。\u003c/p\u003e","title":"PHP框架实战（二）：错误和异常的自动处理"},{"content":"目标 实现框架入口和类的自动加载。\n获取代码 1 git checkout v0.1 设计与实现 通过两个类实现本次目标。\n静态类Flame作为整个框架的入口，实现一系列框架级公用静态方法（例如创建应用实例和自动加载类）。\nWebApplication是应用的抽象层，实现应用的入口和其它应用级（即运行时）公用方法（例如读取配置文件）。\n程序入口\n1 2 3 4 \u0026lt;?php // ... Flame::createApplication($config)-\u0026gt;run(); ?\u0026gt; 此处传入的$config是应用配置文件的路径，该配置文件内容格式如下：\n1 2 3 4 5 6 \u0026lt;?php return array( \u0026#39;opt1\u0026#39; =\u0026gt; \u0026#39;val1\u0026#39;, // ... ); ?\u0026gt; 在文件中直接return一个关联数组的好处是，加载该文件时，include()函数的返回值就是该数组，代码更简洁，效率比解析其它格式配置文件高。\n类的自动加载\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;?php // ... class Flame { // ... public static function autoload($className) { if (!isset(self::$_namespaces[__NAMESPACE__])) self::$_namespaces[__NAMESPACE__] = dirname(__FILE__); foreach (self::$_namespaces as $ns=\u0026gt;$path){ if (strpos($className, $ns) === 0) { $classFile = $path.str_replace(\u0026#39;\\\\\u0026#39;, DIRECTORY_SEPARATOR, substr($className, strlen($ns))).\u0026#39;.php\u0026#39;; include($classFile); return class_exists($className); } } return false; } // ... } spl_autoload_register(__NAMESPACE__.\u0026#39;\\\\Flame::autoload\u0026#39;); ?\u0026gt; 通过函数spl_autoload_register()注册Flame::autoload()方法。当用到一个类时，PHP会先检查该类是否已加载，如果没有，就把包括命名空间在内的完整的类名传递给autoload()，最终完成类的加载。\n当不填参数调用spl_autoload_register()时，PHP使用默认的spl_autoload()函数加载类文件，如果命名空间与目录结构完全对应，也可以实现自动加载，而且效率比指定的自定义加载方法更高。但是spl_autoload()有个历久弥新的Bug，它总是试图加载文件名是小写字母的文件，例如，假如类名是MyClass，spl_autoload()就去找文件名为myclass.php的文件，然而一般情况是文件名与类名相同，即MyClass.php，这在大小写敏感的系统中就找不到了。这个函数的开发者得有多恨Linux啊。\n验证Demo 整个Demo程序的index.php只需包含以下代码即可：\n1 2 3 4 5 6 7 8 \u0026lt;?php require_once \u0026#39;../flamework/Flame.php\u0026#39;; use org\\x3f\\flamework\\Flame as Flame; $_config = \u0026#39;protected/config.php\u0026#39;; Flame::createApplication($_config)-\u0026gt;run(); ?\u0026gt; 总结 这样一个最简单的框架就实现了。\n通过这两个类，将框架级静态逻辑与运行时的动态逻辑分开。对应用高度的抽象和OOP封装使框架和应用的代码更易读。单一的应用入口也方便实现一些横向逻辑（例如过滤器）。\n此外，利用include()会将它所加载的脚本中return的值作为自身返回值的特性实现配置文件的读取，简化了代码，提高了效率。类的自动加载使开发者不必再关心类文件的引入和移除，避免因多余的include或require而导致效率下降和资源浪费。\n","permalink":"http://0x3f.org/posts/flamework-entry/","summary":"\u003ch2 id=\"目标\"\u003e目标\u003c/h2\u003e\n\u003cp\u003e实现框架入口和类的自动加载。\u003c/p\u003e\n\u003ch2 id=\"获取代码\"\u003e获取代码\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit checkout v0.1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"设计与实现\"\u003e设计与实现\u003c/h2\u003e\n\u003cp\u003e通过两个类实现本次目标。\u003c/p\u003e\n\u003cp\u003e静态类Flame作为整个框架的入口，实现一系列框架级公用静态方法（\u003cem\u003e例如创建应用实例和自动加载类\u003c/em\u003e）。\u003c/p\u003e\n\u003cp\u003eWebApplication是应用的抽象层，实现应用的入口和其它应用级（\u003cstrong\u003e即运行时\u003c/strong\u003e）公用方法（\u003cem\u003e例如读取配置文件\u003c/em\u003e）。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e程序入口\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003eFlame\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003ecreateApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e此处传入的$config是应用配置文件的路径，该配置文件内容格式如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s1\"\u003e\u0026#39;opt1\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;val1\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e在文件中直接return一个关联数组的好处是，加载该文件时，include()函数的返回值就是该数组，代码更简洁，效率比解析其它格式配置文件高。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e类的自动加载\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFlame\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eautoload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$className\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_namespaces\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003e__NAMESPACE__\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_namespaces\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003e__NAMESPACE__\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edirname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003e__FILE__\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_namespaces\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estrpos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$className\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ns\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$classFile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estr_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\\\\\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eDIRECTORY_SEPARATOR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esubstr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$className\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ns\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.php\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003einclude\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$classFile\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eclass_exists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$className\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003espl_autoload_register\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003e__NAMESPACE__\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\\\\Flame::autoload\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e通过函数spl_autoload_register()注册Flame::autoload()方法。当用到一个类时，PHP会先检查该类是否已加载，如果没有，就把包括命名空间在内的完整的类名传递给autoload()，最终完成类的加载。\u003c/p\u003e","title":"PHP框架实战（一）：框架入口与类的自动加载"},{"content":"类C语言语法风格最大的问题就是用花括号区分代码块，这导致源码排版容易混乱，对于我这种有代码洁癖的人来说非常痛苦，所以我最喜欢的语法风格是Python的，用缩进区分代码块，排版不规范直接判处语法错误。\n命名规范 所有命名使用驼峰风格。\n源码开头定义命名空间，Flamework框架入口类的命名空间为“org\\x3f\\flamework”，其余类的命名空间应在此基础上追加与所在目录路径匹配的内容。例如，框架源码目录下一级子目录“base”中的类文件的命名空间均为“org\\x3f\\flamework\\base”。\n类名必须是名词，不允许添加任何无意义的前缀或后缀，只允许使用大小写英文字母且首字母大写。\n方法名必须是“动词+名词”的形式（如果动词意义明确且不需要宾语，可省略后者），只允许使用大小写英文字母及阿拉伯数字和下划线，首字母小写。\n属性名分两种情况，对于存储普通数据的属性，名称必须是名词；对于布尔型属性，名称必须是“动词+名词”的形式。只允许使用大小写英文字母及阿拉伯数字和下划线，首字母小写。\n源码文件名必须与类名相同，后缀统一使用“.php”。\n注释规范 统一使用phpDocumenter的注释规范。\n类注释必须注明@author、@since。\n属性和方法的作者如果和类的创建者不同，必须注明@author，此外必须注明@since。\n文件格式 所有文本文件统一使用UNIX格式和UTF-8编码。\n严禁使用制表符缩进代码，必须使用4个空格替代制表符。\n类、属性、方法、方法内部代码块都必须严格按照层级缩进。\n","permalink":"http://0x3f.org/posts/flamework-code-spec/","summary":"\u003cp\u003e类C语言语法风格最大的问题就是用花括号区分代码块，这导致源码排版容易混乱，对于我这种有代码洁癖的人来说非常痛苦，所以我最喜欢的语法风格是Python的，用缩进区分代码块，排版不规范直接判处语法错误。\u003c/p\u003e\n\u003ch2 id=\"命名规范\"\u003e命名规范\u003c/h2\u003e\n\u003cp\u003e所有命名使用驼峰风格。\u003c/p\u003e\n\u003cp\u003e源码开头定义命名空间，Flamework框架入口类的命名空间为“\u003cstrong\u003eorg\\x3f\\flamework\u003c/strong\u003e”，其余类的命名空间应在此基础上追加与所在目录路径匹配的内容。例如，框架源码目录下一级子目录“base”中的类文件的命名空间均为“org\\x3f\\flamework\\base”。\u003c/p\u003e\n\u003cp\u003e类名必须是名词，不允许添加任何无意义的前缀或后缀，只允许使用大小写英文字母且首字母大写。\u003c/p\u003e\n\u003cp\u003e方法名必须是“动词+名词”的形式（\u003cem\u003e如果动词意义明确且不需要宾语，可省略后者\u003c/em\u003e），只允许使用大小写英文字母及阿拉伯数字和下划线，首字母小写。\u003c/p\u003e\n\u003cp\u003e属性名分两种情况，对于存储普通数据的属性，名称必须是名词；对于布尔型属性，名称必须是“动词+名词”的形式。只允许使用大小写英文字母及阿拉伯数字和下划线，首字母小写。\u003c/p\u003e\n\u003cp\u003e源码文件名必须与类名相同，后缀统一使用“.php”。\u003c/p\u003e\n\u003ch2 id=\"注释规范\"\u003e注释规范\u003c/h2\u003e\n\u003cp\u003e统一使用\u003ca href=\"http://www.phpdoc.org/\"\u003ephpDocumenter\u003c/a\u003e的注释规范。\u003c/p\u003e\n\u003cp\u003e类注释必须注明@author、@since。\u003c/p\u003e\n\u003cp\u003e属性和方法的作者如果和类的创建者不同，必须注明@author，此外必须注明@since。\u003c/p\u003e\n\u003ch2 id=\"文件格式\"\u003e文件格式\u003c/h2\u003e\n\u003cp\u003e所有文本文件统一使用UNIX格式和UTF-8编码。\u003c/p\u003e\n\u003cp\u003e严禁使用制表符缩进代码，必须使用4个空格替代制表符。\u003c/p\u003e\n\u003cp\u003e类、属性、方法、方法内部代码块都必须严格按照层级缩进。\u003c/p\u003e","title":"PHP框架实战（零）：代码规范"},{"content":"从今天开始，逐步实现一个PHP的MVC框架，以践行平时对这方面的一些想法。\n项目信息 名称：Flamework (Flame Framework) 源码：https://github.com/xbot/flamework 框架特性 激进\n用PHP高版本引入的新特性，不考虑向前兼容问题，没有历史包袱。\n命名空间\nPHP 5.3引入的命名空间可以有效避免类命名冲突，这样可以使类名看起来更自然，不用再在类名前面加难看的前缀了。\n类的自动加载\n手动include会增加维护的难度，因为经常会出现一个类被从源码中移除而它的include行还在的问题，这会拖慢程序执行速度、增加内存占用。\n实现类的自动加载可以在类被引用时自动include相应的源码。\n异常的自动处理\n在设计程序时，一般应该把用户级的错误返回给页面显示，或者对一些HTTP错误显示个性化的页面（例如人民群众喜闻乐见的404页面），所以在业务逻辑、数据操作这些层一般应该逐级向上抛异常，然后在Controller里捕获并加工成页面可识别的格式（例如JSON）。这样做的缺点是Controller里每个Action都包含重复的try\u0026hellip;catch块。\n异常的自动处理允许开发者指定自定义的异常处理逻辑，将异常处理与普通逻辑解耦，这样每个Action只需实现它所关注的功能即可。\n过滤器\n过滤器允许面向切面编程，是将横向逻辑与纵向逻辑解耦的重要工具。Flamework要实现针对Controller和Action两个级别的过滤器链，过滤器可在该级别逻辑前后执行，并能停止该级别逻辑及后续过滤器的执行。\n懒加载\n对尽可能多的资源实现懒加载，例如数据库连接、类、组件等，目的是提高效率、节约资源。\n参数绑定\n自动将请求中的参数与Action方法的参数绑定，从而避免在Action里出现通过$_POST、$_GET这些数组取参数的脏代码，也可以自动实现参数的校验和错误处理。\nActiveRecord\nORM是对关系模型和对象模型的阻抗不匹配问题的解决方案，ActiveRecord是目前最流行的一种ORM的实现方式。通过AR，可以以更对象化的方式操作关系数据库的数据。\n依赖注入\n依赖注入是个很好的解耦方法，也可以很优雅地实现懒加载。\n目录 零：代码规范 一：框架入口与类的自动加载 二：错误和异常的自动处理 三：实现Controller和Filter 四：视图的模板与渲染 五：ORM与ActiveRecord 六：依赖注入 ∝：烈焰之终章 ","permalink":"http://0x3f.org/posts/flamework/","summary":"\u003cp\u003e从今天开始，逐步实现一个PHP的MVC框架，以践行平时对这方面的一些想法。\u003c/p\u003e\n\u003ch2 id=\"项目信息\"\u003e项目信息\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e名称：Flamework (\u003cem\u003eFlame Framework\u003c/em\u003e)\u003c/li\u003e\n\u003cli\u003e源码：https://github.com/xbot/flamework\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"框架特性\"\u003e框架特性\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e激进\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e用PHP高版本引入的新特性，不考虑向前兼容问题，没有历史包袱。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e命名空间\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePHP 5.3引入的命名空间可以有效避免类命名冲突，这样可以使类名看起来更自然，不用再在类名前面加难看的前缀了。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e类的自动加载\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e手动include会增加维护的难度，因为经常会出现一个类被从源码中移除而它的include行还在的问题，这会拖慢程序执行速度、增加内存占用。\u003c/p\u003e\n\u003cp\u003e实现类的自动加载可以在类被引用时自动include相应的源码。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e异常的自动处理\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e在设计程序时，一般应该把用户级的错误返回给页面显示，或者对一些HTTP错误显示个性化的页面（\u003cem\u003e例如人民群众喜闻乐见的404页面\u003c/em\u003e），所以在业务逻辑、数据操作这些层一般应该逐级向上抛异常，然后在Controller里捕获并加工成页面可识别的格式（\u003cem\u003e例如JSON\u003c/em\u003e）。这样做的缺点是Controller里每个Action都包含重复的try\u0026hellip;catch块。\u003c/p\u003e\n\u003cp\u003e异常的自动处理允许开发者指定自定义的异常处理逻辑，将异常处理与普通逻辑解耦，这样每个Action只需实现它所关注的功能即可。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e过滤器\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e过滤器允许面向切面编程，是将横向逻辑与纵向逻辑解耦的重要工具。Flamework要实现针对Controller和Action两个级别的过滤器链，过滤器可在该级别逻辑前后执行，并能停止该级别逻辑及后续过滤器的执行。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e懒加载\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e对尽可能多的资源实现懒加载，例如数据库连接、类、组件等，目的是提高效率、节约资源。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e参数绑定\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e自动将请求中的参数与Action方法的参数绑定，从而避免在Action里出现通过$_POST、$_GET这些数组取参数的脏代码，也可以自动实现参数的校验和错误处理。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eActiveRecord\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eORM是对关系模型和对象模型的阻抗不匹配问题的解决方案，ActiveRecord是目前最流行的一种ORM的实现方式。通过AR，可以以更对象化的方式操作关系数据库的数据。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e依赖注入\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e依赖注入是个很好的解耦方法，也可以很优雅地实现懒加载。\u003c/p\u003e\n\u003ch2 id=\"目录\"\u003e目录\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-code-spec\"\u003e零：代码规范\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-entry\"\u003e一：框架入口与类的自动加载\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-error-auto-handling\"\u003e二：错误和异常的自动处理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-controller-and-filter\"\u003e三：实现Controller和Filter\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-view-rendering\"\u003e四：视图的模板与渲染\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-active-record\"\u003e五：ORM与ActiveRecord\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-dependency-injection\"\u003e六：依赖注入\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/flamework-summary\"\u003e∝：烈焰之终章\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"PHP框架实战：Flamework"},{"content":"微博一度使我更新博客的频率一降再降，现在我决定回归。已经写了七年，依然乐此不疲。\n这半年去过一些地方，读过一些书，顿悟了一些东西，我是个有一身毛病的动物，但我享受debug的过程。\n现在读书的动力很大程度上来自于使用PaperWhite的愉悦感，虽然最初买电子书阅读器的目的是读盗版，不过现在宁愿为了更好的排版而买正版，而且觉得更过瘾。现在我在买一本书前都要先看有没有电子版，没有的话就去找盗版，连盗版都没有才去买印刷版。\n小通鉴 虽然《通鉴》读了三年还没有读完，这本小书却很快就过了一遍。它从通鉴里抽出了几个故事，展开评论了一下。读了原史再看别人的解读，经常会会心一笑，或心有戚戚，或醍醐灌顶。读史最大的好处有两个，一是学做事，一是学做人，我注六经，六经注我。\n诛仙 纯粹是为了了结旧账，这书在我还在学校的时候还没写完，隔了多年，画一个圈圈，终结它。书本身的故事不错，本来可以再深挖一些，可惜被文笔糟蹋了，整本书缩写为原来的一百分之一波形不会有失真。\n我所认识的蒋介石 这本书只读了开头就读不下去了，对于历史和历史人物，全面肯定和全面否定都是不可信的。\n大漠苍狼：绝密飞行 悬疑设定得不错。不过现在越来越不喜欢有恐怖色彩的东西，所以这可能是我最后看的一本这种题材的书。\nJavascript权威指南 传说中的犀牛书，Javascript最权威的资料之一。第一部分“语言核心”是要细读的，第二部分“客户端的JS”对有几年经验的人，从13到18章浏览一遍，之后的用康圣人读书法。读完这本书就知道什么叫生命不息挖坑不止。\n精通CSS 本想查漏补缺，所以没选《CSS禅意花园》，结果这书还是偏设计。难道这个星球上就没有一本给非前端开发看的CSS书么？\nSpring in Action 重新寻找丢掉的青春，撂下五年再拾起来容易么。这书是本不错的Spring初级教材。\n板桥杂记 明末清初大才子余怀的招嫖回忆录，从对江南名妓的记述中映射物是人非之慨，文笔绝佳。秋风团扇，一觉扬州，于字字雕琢中见山河离碎、愁绪盈怀。每个危楼听雨的暮年都有著软红十丈的青春。\nNoSQL精粹 NoSQL绝佳的一本入门教材，对NoSQL的概念、应用场景、各类实现的优缺点等等都有适度的介绍。对于一直使用传统技术的人而言，这本书有醍醐灌顶使人捶胸顿足怒相见恨晚叹青春易逝之副作用。\n","permalink":"http://0x3f.org/posts/books-read-in-the-second-half-of-2013/","summary":"\u003cp\u003e微博一度使我更新博客的频率一降再降，现在我决定回归。已经写了七年，依然乐此不疲。\u003c/p\u003e\n\u003cp\u003e这半年去过一些地方，读过一些书，顿悟了一些东西，我是个有一身毛病的动物，但我享受debug的过程。\u003c/p\u003e\n\u003cp\u003e现在读书的动力很大程度上来自于使用PaperWhite的愉悦感，虽然最初买电子书阅读器的目的是读盗版，不过现在宁愿为了更好的排版而买正版，而且觉得更过瘾。现在我在买一本书前都要先看有没有电子版，没有的话就去找盗版，连盗版都没有才去买印刷版。\u003c/p\u003e\n\u003ch2 id=\"小通鉴\"\u003e小通鉴\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpCW6kFR/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e虽然《通鉴》读了三年还没有读完，这本小书却很快就过了一遍。它从通鉴里抽出了几个故事，展开评论了一下。读了原史再看别人的解读，经常会会心一笑，或心有戚戚，或醍醐灌顶。读史最大的好处有两个，一是学做事，一是学做人，我注六经，六经注我。\u003c/p\u003e\n\u003ch2 id=\"诛仙\"\u003e诛仙\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpD1kbUK/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e纯粹是为了了结旧账，这书在我还在学校的时候还没写完，隔了多年，画一个圈圈，终结它。书本身的故事不错，本来可以再深挖一些，可惜被文笔糟蹋了，整本书缩写为原来的一百分之一波形不会有失真。\u003c/p\u003e\n\u003ch2 id=\"我所认识的蒋介石\"\u003e我所认识的蒋介石\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpD2nJlC/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e这本书只读了开头就读不下去了，对于历史和历史人物，全面肯定和全面否定都是不可信的。\u003c/p\u003e\n\u003ch2 id=\"大漠苍狼绝密飞行\"\u003e大漠苍狼：绝密飞行\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpD5NoG1/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e悬疑设定得不错。不过现在越来越不喜欢有恐怖色彩的东西，所以这可能是我最后看的一本这种题材的书。\u003c/p\u003e\n\u003ch2 id=\"javascript权威指南\"\u003eJavascript权威指南\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpD6JS7c/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e传说中的犀牛书，Javascript最权威的资料之一。第一部分“语言核心”是要细读的，第二部分“客户端的JS”对有几年经验的人，从13到18章浏览一遍，之后的用康圣人读书法。读完这本书就知道什么叫生命不息挖坑不止。\u003c/p\u003e\n\u003ch2 id=\"精通css\"\u003e精通CSS\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpD860nd/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e本想查漏补缺，所以没选《CSS禅意花园》，结果这书还是偏设计。难道这个星球上就没有一本给非前端开发看的CSS书么？\u003c/p\u003e\n\u003ch2 id=\"spring-in-action\"\u003eSpring in Action\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpD9xCFY/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e重新寻找丢掉的青春，撂下五年再拾起来容易么。这书是本不错的Spring初级教材。\u003c/p\u003e\n\u003ch2 id=\"板桥杂记\"\u003e板桥杂记\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpDblJwq/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e明末清初大才子余怀的招嫖回忆录，从对江南名妓的记述中映射物是人非之慨，文笔绝佳。秋风团扇，一觉扬州，于字字雕琢中见山河离碎、愁绪盈怀。每个危楼听雨的暮年都有著软红十丈的青春。\u003c/p\u003e\n\u003ch2 id=\"nosql精粹\"\u003eNoSQL精粹\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/DpDdM5l4/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eNoSQL绝佳的一本入门教材，对NoSQL的概念、应用场景、各类实现的优缺点等等都有适度的介绍。对于一直使用传统技术的人而言，这本书有醍醐灌顶使人捶胸顿足怒相见恨晚叹青春易逝之副作用。\u003c/p\u003e","title":"这半年读过的几本书"},{"content":"在研究 Dojo 实现拖放操作时，我花了很多时间处理一些细节问题，比如创建自定义样式的拖拽物件以及将光标放置在拖拽开始位置等。这些细节在实现个性化的拖放操作时非常重要，但是我几乎没有找到直接相关的资料可供参考。\n创建自定义样式的拖拽物件 Dojo 缺省的拖拽物件样式很丑，通过覆盖官方文档里列出的几个 CSS 的 class 可以有限地调整部分样式，如果需要更多个性化，就需要使用自定义的物件模板。\n通过重载 Source 对象的 creator 方法可以实现这一点。这个方法会在创建拖拽物件的时候被调用，如果 hint 参数的值为“avatar”就表示将被创建的是被拖拽物件，此时可以使用预先定义好的模板 avatarTmpl 创建物件的 node 。\n1 2 3 4 5 6 7 8 9 10 11 this.dndSrc = new Source(this.itemList.domNode, { copyOnly:true, selfAccept:true, creator: function(item, hint) { var n; if (hint == \u0026#39;avatar\u0026#39;) { n = domConstruct.toDom(lang.replace(avatarTmpl, item)); } return {node:n, data:item, type:[\u0026#39;text\u0026#39;]}; } }); 置光标位置于拖拽起始处 在拖拽开始后，Dojo 默认将光标置于被拖拽物件的左上角，而一般把光标置于拖拽开始时相对于物件的位置处显得比较自然。\n实现方式是先记录拖拽开始时光标的位置，然后设置 dojo.dnd.Manager 的两个位移属性。\n1 2 3 4 5 6 7 8 9 10 on(this.domNode, \u0026#39;mousedown\u0026#39;, lang.hitch(this, this._setDndOffset)) _setDndOffset: function(evt){ // summary: 鼠标按下时将光标相对于组件的位移设置为dojo.dnd.Manager的位移 // 即使光标在拖动开始后位于拖动开始时的位置 var cPos = Functions.getCursorPosition(evt); var nPos = domGeometry.position(this.domNode); Manager.manager().OFFSET_X = nPos.x - cPos.x; Manager.manager().OFFSET_Y = nPos.y - cPos.y; }, 使鼠标事件穿透被拖拽物件 将光标置于物件开始被拖拽时的位置后，物件本身会挡住 mouseover 事件，导致 Target 不能获知物件被拖拽到自己上方，以致能拖不能放。\n解决方法是通过 CSS 使鼠标事件穿透被拖拽物件。\n1 2 3 4 .dojoDndAvatar { pointer-events: none; /*Chrome, FF下使鼠标事件穿透*/ background:transparent; /*IE下使鼠标事件穿透*/ } ","permalink":"http://0x3f.org/posts/practical-drag-and-drop-implementation-with-dojo/","summary":"\u003cp\u003e在研究 Dojo 实现拖放操作时，我花了很多时间处理一些细节问题，比如创建自定义样式的拖拽物件以及将光标放置在拖拽开始位置等。这些细节在实现个性化的拖放操作时非常重要，但是我几乎没有找到直接相关的资料可供参考。\u003c/p\u003e\n\u003ch2 id=\"创建自定义样式的拖拽物件\"\u003e创建自定义样式的拖拽物件\u003c/h2\u003e\n\u003cp\u003eDojo 缺省的拖拽物件样式很丑，通过覆盖官方文档里列出的几个 CSS 的 class 可以有限地调整部分样式，如果需要更多个性化，就需要使用自定义的物件模板。\u003c/p\u003e\n\u003cp\u003e通过重载 Source 对象的 creator 方法可以实现这一点。这个方法会在创建拖拽物件的时候被调用，如果 hint 参数的值为“avatar”就表示将被创建的是被拖拽物件，此时可以使用预先定义好的模板 avatarTmpl 创建物件的 node 。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edndSrc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eSource\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eitemList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edomNode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecopyOnly\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eselfAccept\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecreator\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ehint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ehint\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;avatar\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edomConstruct\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoDom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elang\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eavatarTmpl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"置光标位置于拖拽起始处\"\u003e置光标位置于拖拽起始处\u003c/h2\u003e\n\u003cp\u003e在拖拽开始后，Dojo 默认将光标置于被拖拽物件的左上角，而一般把光标置于拖拽开始时相对于物件的位置处显得比较自然。\u003c/p\u003e\n\u003cp\u003e实现方式是先记录拖拽开始时光标的位置，然后设置 dojo.dnd.Manager 的两个位移属性。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edomNode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;mousedown\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003elang\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehitch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e_setDndOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003e_setDndOffset\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevt\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e// summary: 鼠标按下时将光标相对于组件的位移设置为dojo.dnd.Manager的位移\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"c1\"\u003e//          即使光标在拖动开始后位于拖动开始时的位置\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ecPos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eFunctions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetCursorPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevt\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003enPos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edomGeometry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edomNode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003eOFFSET_X\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003ecPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003eOFFSET_Y\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003ecPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"使鼠标事件穿透被拖拽物件\"\u003e使鼠标事件穿透被拖拽物件\u003c/h2\u003e\n\u003cp\u003e将光标置于物件开始被拖拽时的位置后，物件本身会挡住 mouseover 事件，导致 Target 不能获知物件被拖拽到自己上方，以致能拖不能放。\u003c/p\u003e","title":"用 Dojo 实现拖放操作的最佳实践"},{"content":"场景为：\n点击一个图标，打开文件选择对话框，选择好文件后即时上传。\n之前的实现方式是在一个隐藏表单中放一个file类型的input元素，通过调用input.click()打开对话框，同时监听input.onchange，最后通过dojo/request/iframe上传文件。\n这个实现方式在Chrome和Firefox里都没问题，但是在IE里报错：“TypeError:拒绝访问”。原因是IE要求必须通过点击file类型的input的按钮打开选择对话框，否则就报这个错误。\n解决办法是修改input元素的样式，或者直接用dojox.form.Uploader替代。\n因为这个破问题又血战到半夜，只支持IE9+的世界你们好吗，还支持IE7+的屌丝伤不起……不起……起……啊。IE不死，吾难未已！！！\n","permalink":"http://0x3f.org/posts/typeerror-access-denied/","summary":"\u003cp\u003e场景为：\u003c/p\u003e\n\u003cp\u003e点击一个图标，打开文件选择对话框，选择好文件后即时上传。\u003c/p\u003e\n\u003cp\u003e之前的实现方式是在一个隐藏表单中放一个file类型的input元素，通过调用input.click()打开对话框，同时监听input.onchange，最后通过dojo/request/iframe上传文件。\u003c/p\u003e\n\u003cp\u003e这个实现方式在Chrome和Firefox里都没问题，但是在IE里报错：“\u003cstrong\u003eTypeError:拒绝访问\u003c/strong\u003e”。原因是IE要求必须通过点击file类型的input的按钮打开选择对话框，否则就报这个错误。\u003c/p\u003e\n\u003cp\u003e解决办法是修改input元素的样式，或者直接用dojox.form.Uploader替代。\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e因为这个破问题又血战到半夜，只支持IE9+的世界你们好吗，还支持IE7+的屌丝伤不起……不起……起……啊。\u003cstrong\u003eIE不死，吾难未已！！！\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e","title":"IE中使用IFrame上传文件报错——TypeError:拒绝访问"},{"content":"场景如下：\n假设有两个Widget：ItemListWidget和ItemWidget，后者要被创建多份并追加到前者内部，同时ItemListWidget要作为dojo/dnd/Source，每个ItemWidget作为一个单元可被拖拽到另外一个dojo/dnd/Target容器中。\n问题是，当Source被创建后，再添加到ItemListWidget的ItemWidget实例在被拖拽时会报如下错误：\nUncaught TypeError: Cannot read property \u0026rsquo;type\u0026rsquo; of undefined\n在Chrome开发工具中点开这个错误，显示以下内容：\n从方法的注释或API中可以看到，checkAcceptance()是用来判断当前拖拽对象是否在这个target接受的范围之内，接受规则用Source和Target的构造参数中的“accept”定义。在这个方法里通过Source.getItem()方法拿到的对象是null，上述错误就是从这儿报出来的。\n接合API和Reference Guide发现，每个Source中的可拖拽项目在Source中都要有一个对应的对象，这个对象至少包括两个属性：“data”和“type”。在Reference Guide中，对这两个属性有详细说明，简言之，data是向Target传递的数据，type是被Target用来判断拖拽个体是否属于接受范围的依据。\n当Source实例被创建时，已经存在于ItemListWidget中的ItemWidget实例会被自动创建对应的上述对象，但之后加入的不会。解决的办法是调用Source.setItem()方法为每一个新加入的ItemWidget关联相应的对象，或在ItemWidget中添加一个构造参数，用于指定Source，并在postCreate()方法中为当前ItemWidget实例关联相应的对象:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 define([ \u0026#34;dojo/_base/declare\u0026#34;, \u0026#34;dijit/_WidgetBase\u0026#34;, ], function(declare, _WidgetBase){ return declare(\u0026#34;ItemWidget\u0026#34;, [_WidgetBase], { // 本Widget实例所属的Source实例 dndSrc: null, postCreate: function() { this.inherited(arguments); // 不需要传递数据时，可忽略data参数 if (this.dndSrc !== null) this.dndSrc.setItem(this.id, {type:[\u0026#34;text\u0026#34;]}); } }); }); ","permalink":"http://0x3f.org/posts/dojo-dnd-cannot-read-property-type-of-undefined/","summary":"\u003cp\u003e场景如下：\u003c/p\u003e\n\u003cp\u003e假设有两个Widget：ItemListWidget和ItemWidget，后者要被创建多份并追加到前者内部，同时ItemListWidget要作为dojo/dnd/Source，每个ItemWidget作为一个单元可被拖拽到另外一个dojo/dnd/Target容器中。\u003c/p\u003e\n\u003cp\u003e问题是，当Source被创建后，再添加到ItemListWidget的ItemWidget实例在被拖拽时会报如下错误：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eUncaught TypeError: Cannot read property \u0026rsquo;type\u0026rsquo; of undefined\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在Chrome开发工具中点开这个错误，显示以下内容：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/D0dD4euT/cULuA.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e从方法的注释或API中可以看到，checkAcceptance()是用来判断当前拖拽对象是否在这个target接受的范围之内，接受规则用Source和Target的构造参数中的“accept”定义。在这个方法里通过Source.getItem()方法拿到的对象是null，上述错误就是从这儿报出来的。\u003c/p\u003e\n\u003cp\u003e接合API和Reference Guide发现，每个Source中的可拖拽项目在Source中都要有一个对应的对象，这个对象至少包括两个属性：“data”和“type”。在\u003ca href=\"http://dojotoolkit.org/reference-guide/1.9/dojo/dnd.html\"\u003eReference Guide\u003c/a\u003e中，对这两个属性有详细说明，简言之，data是向Target传递的数据，type是被Target用来判断拖拽个体是否属于接受范围的依据。\u003c/p\u003e\n\u003cp\u003e当Source实例被创建时，已经存在于ItemListWidget中的ItemWidget实例会被自动创建对应的上述对象，但之后加入的不会。解决的办法是调用Source.setItem()方法为每一个新加入的ItemWidget关联相应的对象，或在ItemWidget中添加一个构造参数，用于指定Source，并在postCreate()方法中为当前ItemWidget实例关联相应的对象:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003edefine\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;dojo/_base/declare\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;dijit/_WidgetBase\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_WidgetBase\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003edeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ItemWidget\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003e_WidgetBase\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e// 本Widget实例所属的Source实例\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"nx\"\u003edndSrc\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003epostCreate\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einherited\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"c1\"\u003e// 不需要传递数据时，可忽略data参数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edndSrc\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edndSrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetItem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Dojo DnD: Cannot read property 'type' of undefined"},{"content":"It\u0026rsquo;s a long time since I came across rxvt-unicode.\nAbout seven years ago, when I switched from Windows XP to Ubuntu mainly for performance issues, I never be bored with searching for everything with a higher speed. To me, gnome-terminal is too much slow as a terminal being frequently opened and closed. Then, rxvt-unicode came through.\nAt first glance, rxvt-unicode was so ugly that I put it behind without the slightest bit of hesitation. Not until I once saw a screenshot did I realize this ugly thing can actually be pretty like that. So I started to take it as my primary terminal since then, for it was the fastest terminal I can find at that time.\nTime flies, rxvt-unicode has proved to be a very good friend within these years, only until yesterday. I descided to change my Zsh theme to agnoster, which is a very pretty and git-friendly theme. Although I did everything according to the official manual, the right and left arrow signs were still displayed as boxes, then I tried almost all the methods I could find from Google, it still didn\u0026rsquo;t work.\nSo I reluctantly descided to part from rxvt-unicode. A number of terminals came out through these years, some of them also show a good performance, like sakura, terminator, etc. Now I take sakura as my primary terminal, it runs as fast as rxvt-unicode while working normally with agnoster or powerline.\nHere is the final effect:\nUpdate (2013-07-07 23:34:53):\nThanks to Star Brilliant, he mentioned LilyTerm in his comment. I discovered that it is even faster than Sakura while supplying plenty of functions, so now I descide to switch to LilyTerm.\n","permalink":"http://0x3f.org/posts/take-sakura-as-my-primary-terminal/","summary":"\u003cp\u003eIt\u0026rsquo;s a long time since I came across rxvt-unicode.\u003c/p\u003e\n\u003cp\u003eAbout seven years ago, when I switched from Windows XP to Ubuntu mainly for performance issues, I never be bored with searching for everything with a higher speed. To me, gnome-terminal is too much slow as a terminal being frequently opened and closed. Then, rxvt-unicode came through.\u003c/p\u003e\n\u003cp\u003eAt first glance, rxvt-unicode was so ugly that I put it behind without the slightest bit of hesitation. Not until I once saw a screenshot did I realize this ugly thing can actually be pretty like that. So I started to take it as my primary terminal since then, for it was the fastest terminal I can find at that time.\u003c/p\u003e","title":"Take Sakura as My Primary Terminal"},{"content":"我要这天，再遮不住我眼；要这地，再埋不了我心；要这众生，都明白我意；要那诸佛，都烟消云散！\n这是本适合少年读、青年悟、中年回味的书，很遗憾没有在我最好的几年里读过它。到了没有激情和理想的年龄，已经不能耐著性子读这种需要花时间和动脑子的书，这次在Kindle PaperWhite上匆匆翻完，我知道可能需要很多年去慢慢的品。\n","permalink":"http://0x3f.org/posts/after-reading-wukongs-biography/","summary":"\u003cp\u003e\u003cstrong\u003e我要这天，再遮不住我眼；要这地，再埋不了我心；要这众生，都明白我意；要那诸佛，都烟消云散！\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e这是本适合少年读、青年悟、中年回味的书，很遗憾没有在我最好的几年里读过它。到了没有激情和理想的年龄，已经不能耐著性子读这种需要花时间和动脑子的书，这次在Kindle PaperWhite上匆匆翻完，我知道可能需要很多年去慢慢的品。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CZj8ATdH/medish.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"读完《悟空传》"},{"content":"Assume we have created an instance of QTableWidget, in which cells are filled with widgets like QComboBox, QCheckBox, etc. When values are changed, we need to get the row and column indexes of the cells. But the QTableWidget.cellChanged() and QTableWidget.itemChanged() signals are only effective for cells containing QTableWidgetItem instances, for those in which widgets are filled in with QTableWidget.setCellWidget(), this doesn\u0026rsquo;t work.\nThis problem nearly made me crazy last weekend. So how can I make it ?\nHere is the solution, by leveraging QSignalMapper, we can send other data to the slots instead of the default value. As the following code snippet shows, I put the row and column indexes into a string, then mapped it with the QComboBox.currentIndexChanged() slot. Notice that this slot has two generics, one accept an int type as the parameter and the other accept a string, so a QString key should be used to select the second generic.\n1 2 3 4 signalMapper = QtCore.QSignalMapper(self.ui) signalMapper.setMapping(comboWidget, \u0026#39;%d,%d\u0026#39; % (rowIdx, colIdx)) comboWidget.currentIndexChanged[\u0026#39;QString\u0026#39;].connect(signalMapper.map) signalMapper.mapped[\u0026#39;QString\u0026#39;].connect(self.__onCellWidgetChanged) The only downside of this solution is, we should call QTableWidget.cellWidget() seperately to get the new value. Which I think it\u0026rsquo;s not to much trouble.\n","permalink":"http://0x3f.org/posts/get-position-in-qtablewidget-for-changed-cellwidgets/","summary":"\u003cp\u003eAssume we have created an instance of QTableWidget, in which cells are filled with widgets like QComboBox, QCheckBox, etc. When values are changed, we need to get the row and column indexes of the cells. But the QTableWidget.cellChanged() and QTableWidget.itemChanged() signals are only effective for cells containing QTableWidgetItem instances, for those in which widgets are filled in with QTableWidget.setCellWidget(), this doesn\u0026rsquo;t work.\u003c/p\u003e\n\u003cp\u003eThis problem nearly made me crazy last weekend. So how can I make it ?\u003c/p\u003e","title":"PySide: How to Get the Position of a Widget-Value-Changed Cell in QTableWidget"},{"content":"第四款，罗技M185，卖相不错，无光，一节五号电池驱动，据说很省电，握感不错，正在用。\n第三款，惠普百灵，卖相不错，大小适中，左侧两个快捷按键在浏览网页时前进后退很方便。两节七号电池驱动，不太省电。先后买过两个，都是滚轮失灵，似乎这款的滚轮有问题，伤心了。\n第二款，雷柏7100，形状较大，握感还可以，用一节五号电池，省电。最后按键失灵，壮烈牺牲。\n第一款，Thinkpad 31P7410，先后买过两三个，比较小巧，按键易坏，不推荐。\n","permalink":"http://0x3f.org/posts/my-mouses-of-all-those-years/","summary":"\u003cp\u003e第四款，罗技M185，卖相不错，无光，一节五号电池驱动，据说很省电，握感不错，正在用。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CYn6F5gI/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e第三款，惠普百灵，卖相不错，大小适中，左侧两个快捷按键在浏览网页时前进后退很方便。两节七号电池驱动，不太省电。先后买过两个，都是滚轮失灵，似乎这款的滚轮有问题，伤心了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CYn6Fr6q/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e第二款，雷柏7100，形状较大，握感还可以，用一节五号电池，省电。最后按键失灵，壮烈牺牲。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CYn6G96i/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e第一款，Thinkpad 31P7410，先后买过两三个，比较小巧，按键易坏，不推荐。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CYn6Fkha/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"那些年我用过的鼠标"},{"content":"年龄越大，越有种对失去自由的恐惧。“老牛自知夕阳晚，不用扬鞭自奋蹄”，于是越来越想走得远点儿，然后就看到了这本书。这是我第一次正经买电子书，花了3￥，用了五天的时间。\n这是本游记，主要讲的是作者十年旅行的见闻和心路历程，从自然平实的词句中可以看出作者心态很平和，能体会这种心态，已经很好。\nPS: 有点淡淡的忧桑，今天，我高考十年……\n","permalink":"http://0x3f.org/posts/after-reading-ten-years-of-traveling/","summary":"\u003cp\u003e年龄越大，越有种对失去自由的恐惧。“老牛自知夕阳晚，不用扬鞭自奋蹄”，于是越来越想走得远点儿，然后就看到了这本书。这是我第一次正经买电子书，花了3￥，用了五天的时间。\u003c/p\u003e\n\u003cp\u003e这是本游记，主要讲的是作者十年旅行的见闻和心路历程，从自然平实的词句中可以看出作者心态很平和，能体会这种心态，已经很好。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CUTfChw6/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePS: 有点淡淡的忧桑，今天，我高考十年……\u003c/strong\u003e\u003c/p\u003e","title":"读完《背包十年》"},{"content":"I replaced NeoComplCache with YouCompleteMe today. The main reason is for the auto-complete feature and the fast speed. Besides, it seems that YCM provides more features than NCC.\nAlthough NCC can also do auto-completions, it was so slow that I had to turn it off. For a long time, I have been doing completions by triggering the TAB key manually. YCM is much faster in most conditions, but I found it is also slow for C source files. Moreover, with the power of jedi, YCM makes completions of python sources much wiser, which is very convenient.\nThen a problem raised again. It\u0026rsquo;s the confiliction of mappings for Tab key between YCM and UltiSnips. Many people changed the default mapping of either YCM or UltiSnips, but I cannot tolerate that. I insist that the most convenient way is UltiSnips having a higher priority above YCM, which means, when Tab is triggered, UltiSnips expands the snippet, if there is not a valid snippet, YCM will take over the job.\nFortunately, there is a solution. The idea is the same with my former post about NCC. I made it by the help of SuperTab.\nI have to say that UltiSnips is a well-written script, it passes Tab key through if there is not a snippet. Then SuperTab will be triggered. Since the default action of SuperTab is customizable, so I can set it to the key-binding of YCM. That is the whole trick.\nFirst, change the default key-binding of YCM to \u0026lt;C-TAB\u0026gt; and \u0026lt;C-S-TAB\u0026gt;:\nlet g:ycm_key_list_select_completion = [\u0026rsquo;\u0026lt;C-TAB\u0026gt;\u0026rsquo;, \u0026lsquo;\u0026lt;Down\u0026gt;\u0026rsquo;]\nlet g:ycm_key_list_previous_completion = [\u0026rsquo;\u0026lt;C-S-TAB\u0026gt;\u0026rsquo;, \u0026lsquo;\u0026lt;Up\u0026gt;\u0026rsquo;]\nThen set the default action of SuperTab to triggering \u0026lt;C-TAB\u0026gt;:\nlet g:SuperTabDefaultCompletionType = \u0026lsquo;\u0026lt;C-Tab\u0026gt;\u0026rsquo;\nOK, job done.\n相关阅读： 用neocomplete换掉了YouCompleteMe Vim的终极自动补全插件：NeoComplCache ","permalink":"http://0x3f.org/posts/make-youcompleteme-ultisnips-compatible/","summary":"\u003cp\u003eI replaced \u003ca href=\"https://github.com/Shougo/neocomplcache\"\u003eNeoComplCache\u003c/a\u003e with \u003ca href=\"https://github.com/Valloric/YouCompleteMe\"\u003eYouCompleteMe\u003c/a\u003e today. The main reason is for the auto-complete feature and the fast speed. Besides, it seems that YCM provides more features than NCC.\u003c/p\u003e\n\u003cp\u003eAlthough NCC can also do auto-completions, it was so slow that I had to turn it off. For a long time, I have been doing completions by triggering the TAB key manually. YCM is much faster in most conditions, but I found it is also slow for C source files. Moreover, with the power of \u003ca href=\"https://github.com/davidhalter/jedi\"\u003ejedi\u003c/a\u003e, YCM makes completions of python sources much wiser, which is very convenient.\u003c/p\u003e","title":"How to Make YouCompleteMe Compatible with UltiSnips"},{"content":"I have been using Pathogen for a long time and I am happy with it. But it seems that more and more Vim scripts are recommending to use Vundle in their install references. So I made a study today, the conclusion is, although almost all the articles I found from Google have a positive attitude on Vundle, I still prefer Pathogen.\nMost supporters of Vundle praise it for one reason, that is, it can install and update scripts automatically, which is lacked by Pathogen. Yes, since Vundle leverages the vim-scripts repository on GitHub, it is really easier to do so than Pathogen. But the disadvantage is as good as the advantage. I found that the vim-scripts repo is not updated in time, the latest activity was carried out a month ago ! As an OCD patient of updating, I cannot tolerate old versions of vim scripts. Although that Vundle supports using scripts\u0026rsquo; git repos of their own (either on GitHub or other places), there is still a problem, what if authors commit broken code to the master brunch ?\nMoreover, not all scripts are deposited in public git repos. How can I organize those scripts in ~/.vim/bundle/ and prevent :BundleClean from deleting them at the same time ?\nPathogen only handles the organization job that puts scripts in individual folders under ~/.vim/bundle/, so there is without the above problem. For updating issues, GetLatestVimScripts.vim is a good choice, it fetches the latest stable updates from vim.org, so I don\u0026rsquo;t have to worry about careless commits. The only problem is, when GetLatestVimScripts.vim downloads all packages, I should install them manually. But since most scripts rarely update, I think this is not a hard work to do.\nKISS things are always good.\n","permalink":"http://0x3f.org/posts/vundle-vs-pathogen/","summary":"\u003cp\u003eI have been using Pathogen for a long time and I am happy with it. But it seems that more and more Vim scripts are recommending to use Vundle in their install references. So I made a study today, the conclusion is, although almost all the articles I found from Google have a positive attitude on Vundle, I still prefer Pathogen.\u003c/p\u003e\n\u003cp\u003eMost supporters of Vundle praise it for one reason, that is, it can install and update scripts automatically, which is lacked by Pathogen. Yes, since Vundle leverages the vim-scripts repository on GitHub, it is really easier to do so than Pathogen. But the disadvantage is as good as the advantage. I found that the vim-scripts repo is not updated in time, the latest activity was carried out a month ago ! As an OCD patient of updating, I cannot tolerate old versions of vim scripts. Although that Vundle supports using scripts\u0026rsquo; git repos of their own (either on GitHub or other places), there is still a problem, what if authors commit broken code to the master brunch ?\u003c/p\u003e","title":"Vundle vs Pathogen"},{"content":"13年5月，骑行京西古道。\n从水峪嘴下去，进京西古道风景区，通过牛角岭关城，到落坡马志远故居，然后经韭园桥沿永定河谷至担礼大桥进入G109。\n京西古道风景区收20￥，里面有博物馆、军事酒吧、古道和牛角岭关城。博物馆其实就是个村史展馆，很小，没什么内容，就一间屋子，一览无余。古道是乱石砌成的，非常不平，推车上去很累，好在只有一千米长：\n牛角岭关城，看著像个砖窑，地上的石头沟沟坎坎：\n马志远故居，看著像重建的，刻意营造成“小桥流水人家”的样子，里面就一四合院，收费10￥，没进去。附近有一山泉，想老马也算过了一把农妇山泉有点儿田的瘾，夫复何求。\n永定河谷一线的景色非常好，可惜没有拍照。\n","permalink":"http://0x3f.org/posts/riding-to-ancient-west-peking-path/","summary":"\u003cp\u003e13年5月，骑行京西古道。\u003c/p\u003e\n\u003cp\u003e从水峪嘴下去，进京西古道风景区，通过牛角岭关城，到落坡马志远故居，然后经韭园桥沿永定河谷至担礼大桥进入G109。\u003c/p\u003e\n\u003cp\u003e京西古道风景区收20￥，里面有博物馆、军事酒吧、古道和牛角岭关城。博物馆其实就是个村史展馆，很小，没什么内容，就一间屋子，一览无余。古道是乱石砌成的，非常不平，推车上去很累，好在只有一千米长：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CS026ew0/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e牛角岭关城，看著像个砖窑，地上的石头沟沟坎坎：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CS024QNx/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e马志远故居，看著像重建的，刻意营造成“小桥流水人家”的样子，里面就一四合院，收费10￥，没进去。附近有一山泉，想老马也算过了一把农妇山泉有点儿田的瘾，夫复何求。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CS024f86/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e永定河谷一线的景色非常好，可惜没有拍照。\u003c/p\u003e","title":"骑行京西古道"},{"content":"默认情况下，ROX-Filer会将“*.docx”、“*.xlsx”、“*.pptx”文档识别为zip压缩包。由于ROX中与文件关联的行为实际上都是和文档类型挂钩的，所以对这些文档的操作会遇到很大麻烦，而且没有变通方法。\n实际上，Linux对文件类型的识别比Windows灵活。Windows只能通过文件名的后缀判断文件类型，随便创建一个文本文件，然后将后缀“.txt”改成“.exe”，Win就会傻乎乎地认为这是个二进制的可执行程序。这种做法很傻，而且很不安全，试想，如果将一个病毒程序的后缀改成“.jpg”，就可以骗过大多数用户，然后通过某种手段执行它，后果会怎样？更傻的是，XP以上版本默认是隐藏后缀的，那攻击者连改后缀都可以省了。颤抖吧，神一样的Win！\nLinux不但可以通过后缀识别文件类型，更重要的，还可以通过文件开头的几个字节实现这一点，这就比前一种方式精确、安全很多。当然，Linux还支持更多的文件类型识别方法。\n前面说过，在ROX-Filer下，所有行为都绑定到文件类型上，也就是MIME Types，ROX通过这种方式实现了将可灵活自由定制的文件操作与自身解耦，从而在确保自身稳定的同时实现对高度灵活的自由定制的支持，这是一个很值得学习的实现方式。因此，既然文件的后缀没有问题，ROX仍将它们识别为ZIP格式，原因是什么？显然，最大的嫌疑集中在第二种识别方式上。\n一个公开的秘密是，Office文档本身其实就是一个ZIP压缩包，里面包含了描述文档的XML、多媒体文件等成分，只不过MS贱贱地把压缩包的后缀改成了docx之类的东东，加上Windows只能通过后缀识别文件类型，所以很多人不知道这一点。了解了这个，问题的原因就跃然纸上了，既然都是ZIP压缩包，那第二种文件类型识别方式也就区分不出Office文件类型与ZIP压缩包了。\n能号出病因，就有方子治病。\n既然ROX使用多种文件类型识别方式，那必然有一个优先级的关系，否则就会乱套。打开ROX的MIME Editor：\n找到MIME类型“application/zip”：\n打开zip的属性对话框：\n可以看到“Contents matching”这一块里，通过检查文件头部的几个字节是否为“PK\\003\\004”来判断，并且此项判断标准的优先级是40。下面所要做的，就是找到相应文件类型，添加一项条件相同的“Contents matching”，并把优先级设得大于40。\n","permalink":"http://0x3f.org/posts/fix-ms-office-mime-types-in-rox-filer/","summary":"\u003cp\u003e默认情况下，ROX-Filer会将“*.docx”、“*.xlsx”、“*.pptx”文档识别为zip压缩包。由于ROX中与文件关联的行为实际上都是和文档类型挂钩的，所以对这些文档的操作会遇到很大麻烦，而且没有变通方法。\u003c/p\u003e\n\u003cp\u003e实际上，Linux对文件类型的识别比Windows灵活。Windows只能通过文件名的后缀判断文件类型，随便创建一个文本文件，然后将后缀“.txt”改成“.exe”，Win就会傻乎乎地认为这是个二进制的可执行程序。这种做法很傻，而且很不安全，试想，如果将一个病毒程序的后缀改成“.jpg”，就可以骗过大多数用户，然后通过某种手段执行它，后果会怎样？更傻的是，XP以上版本默认是隐藏后缀的，那攻击者连改后缀都可以省了。颤抖吧，神一样的Win！\u003c/p\u003e\n\u003cp\u003eLinux不但可以通过后缀识别文件类型，更重要的，还可以通过文件开头的几个字节实现这一点，这就比前一种方式精确、安全很多。当然，Linux还支持更多的文件类型识别方法。\u003c/p\u003e\n\u003cp\u003e前面说过，在ROX-Filer下，所有行为都绑定到文件类型上，也就是MIME Types，ROX通过这种方式实现了将可灵活自由定制的文件操作与自身解耦，从而在确保自身稳定的同时实现对高度灵活的自由定制的支持，这是一个很值得学习的实现方式。因此，既然文件的后缀没有问题，ROX仍将它们识别为ZIP格式，原因是什么？显然，最大的嫌疑集中在第二种识别方式上。\u003c/p\u003e\n\u003cp\u003e一个公开的秘密是，Office文档本身其实就是一个ZIP压缩包，里面包含了描述文档的XML、多媒体文件等成分，只不过MS贱贱地把压缩包的后缀改成了docx之类的东东，加上Windows只能通过后缀识别文件类型，所以很多人不知道这一点。了解了这个，问题的原因就跃然纸上了，既然都是ZIP压缩包，那第二种文件类型识别方式也就区分不出Office文件类型与ZIP压缩包了。\u003c/p\u003e\n\u003cp\u003e能号出病因，就有方子治病。\u003c/p\u003e\n\u003cp\u003e既然ROX使用多种文件类型识别方式，那必然有一个优先级的关系，否则就会乱套。打开ROX的MIME Editor：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRNkfq0g/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e找到MIME类型“application/zip”：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRNkgaEK/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e打开zip的属性对话框：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRNkfOsQ/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到“Contents matching”这一块里，通过检查文件头部的几个字节是否为“PK\\003\\004”来判断，并且此项判断标准的优先级是40。下面所要做的，就是找到相应文件类型，添加一项条件相同的“Contents matching”，并把优先级设得大于40。\u003c/p\u003e","title":"解决ROX-Filer文件类型识别问题"},{"content":"12年8月，去乐山、峨嵋玩儿了两天。\n乐山大佛真的很大：\n据说佛爷头上的便便越多，表示智慧越大、级别越高：\n峨嵋金顶的十面普贤菩萨，美轮美奂，从没有见过这样一尊佛像，能让人在看第一眼的时候就感受到震撼：\n云开日出时的十面普贤，那一瞬间，场面无以言表，极为震撼人心：\n刚到乐山时看到路边的条幅，才恍然想起这是祖师爷的老家，没时间拜谒，罪过罪过。这次旅行最大的收获就是看到了云开日出时的十面普贤，是我迄今见过的最摄人心魄的景观。\n","permalink":"http://0x3f.org/posts/tour-to-leshan-and-emei/","summary":"\u003cp\u003e12年8月，去乐山、峨嵋玩儿了两天。\u003c/p\u003e\n\u003cp\u003e乐山大佛真的很大：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRHkdf2T/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e据说佛爷头上的便便越多，表示智慧越大、级别越高：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRHkdm6f/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e峨嵋金顶的十面普贤菩萨，美轮美奂，从没有见过这样一尊佛像，能让人在看第一眼的时候就感受到震撼：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRHkdPGq/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e云开日出时的十面普贤，那一瞬间，场面无以言表，极为震撼人心：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRHkexyO/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e刚到乐山时看到路边的条幅，才恍然想起这是祖师爷的老家，没时间拜谒，罪过罪过。这次旅行最大的收获就是看到了云开日出时的十面普贤，是我迄今见过的最摄人心魄的景观。\u003c/p\u003e","title":"乐山大佛与十面普贤"},{"content":"今晚参加了绿野夜爬百望山的活动。主要为了认一下路，以前逃票都是从公路旁栅栏的缺口钻进去的，后来封了就没再去。\n站在望京楼上俯瞰夜色中的帝都：\n活动强度很低，适合下班后锻炼一下。百望山很矮，但是叉路很多，有的爬了。\n","permalink":"http://0x3f.org/posts/nightly-climbing-baiwang-mountain/","summary":"\u003cp\u003e今晚参加了绿野夜爬百望山的活动。主要为了认一下路，以前逃票都是从公路旁栅栏的缺口钻进去的，后来封了就没再去。\u003c/p\u003e\n\u003cp\u003e站在望京楼上俯瞰夜色中的帝都：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRxZLvnf/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e活动强度很低，适合下班后锻炼一下。百望山很矮，但是叉路很多，有的爬了。\u003c/p\u003e","title":"夜爬百望山"},{"content":"绿野的活动。\n头天晚上的汽车，第二天早上三四点到恒山后山，五点出发。很冷，除了T恤，就穿了一件冲锋衣，冻得直哆嗦，不过一开始爬就好多了。上山的地方不知名，不是传说中的后山山门附近。爬上第一个山顶，转过去就是修好的登山道，放眼可见莽原与群山：\n底下就是我们当晚要宿营的恒山湖：\n朕与江山：\n再往上没多远就是山顶，恒山海拔虽高，实际爬起来难度很低。\n都说前山景色一般、精华在后山，没感觉，也许跟我们走的路线有关，倒觉得前山附崖而建的寺庙耐看：\n逢山必看摩崖石刻：\n前山处处隐没在山林中的寺庙，很有意境：\n边下边逛，中午就下了山，不明白这么一座平平无奇的山怎么称得上北岳恒宗：\n然后坐车去悬空寺，寺小、人多、票贵，没上去，远远地拍上几张交作业：\n不宿营的人坐车去浑源县城住宿，我们徒步走回恒山湖扎营。湖并不好看，水也不怎么干净，有人钓鱼，空手而归，好在湖边有小饭馆，好吃就别想了，聊胜于无。扎营地是山脚一个凹口，是片干了的湖底，没草，所以帐蓬容易进灰而且硌得慌，远不像想像中青山绿水草地上伴著明月篝火清风入睡那样享受。\n虽然没有鱼，篝火还是要有的：\n除了被冻醒一次，一夜无话。第二天早上坐车去浑源县城吃传说中的小媳妇凉粉，这个地方的凉粉配料有特色，主要有三样东西：不辣的辣椒油、豆干和炸蚕豆，而作为主料的凉粉本身却并不比其它地方的特别，我想像中好的凉粉应该是入口即化的。不管怎样，有这样的经历也是好的：\n然后坐车去云冈石窟，首先进去是灵严寺：\n灵严寺的塔和佛像都很有特色，不著重彩，呈乳白色或米黄色，观感素雅：\n双层建筑在我到过的寺庙里是第一次见到：\n大雄宝殿门口的黄金树很耀眼：\n寺后就是云冈石窟，风化的石壁很有沧桑感，与前面金碧辉煌的灵严寺对比鲜明。最近越来越不喜欢破败的事物，所以在前面寺庙的兴致至此稍挫：\n大窟中的巨佛，依稀可见鲜卑帝国时代的盛况：\n石窟的外部原本都是有附崖建筑的：\n下午四点，坐车返京，晚上九点左右抵西直门散伙。\n活动贴在这里：http://bbs.lvye.cn/thread-780144-1-1.html\n最后是恒顶合影：\n","permalink":"http://0x3f.org/posts/tour-to-hengshan-and-yungang/","summary":"\u003cp\u003e绿野的活动。\u003c/p\u003e\n\u003cp\u003e头天晚上的汽车，第二天早上三四点到恒山后山，五点出发。很冷，除了T恤，就穿了一件冲锋衣，冻得直哆嗦，不过一开始爬就好多了。上山的地方不知名，不是传说中的后山山门附近。爬上第一个山顶，转过去就是修好的登山道，放眼可见莽原与群山：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYJnD5/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e底下就是我们当晚要宿营的恒山湖：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoY6mqe/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e朕与江山：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYL2y8/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e再往上没多远就是山顶，恒山海拔虽高，实际爬起来难度很低。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoY7nK3/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e都说前山景色一般、精华在后山，没感觉，也许跟我们走的路线有关，倒觉得前山附崖而建的寺庙耐看：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYLtQX/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e逢山必看摩崖石刻：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYLZh3/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e前山处处隐没在山林中的寺庙，很有意境：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYN4k9/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e边下边逛，中午就下了山，不明白这么一座平平无奇的山怎么称得上北岳恒宗：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYNuyE/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e然后坐车去悬空寺，寺小、人多、票贵，没上去，远远地拍上几张交作业：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYNRPW/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e不宿营的人坐车去浑源县城住宿，我们徒步走回恒山湖扎营。湖并不好看，水也不怎么干净，有人钓鱼，空手而归，好在湖边有小饭馆，好吃就别想了，聊胜于无。扎营地是山脚一个凹口，是片干了的湖底，没草，所以帐蓬容易进灰而且硌得慌，远不像想像中青山绿水草地上伴著明月篝火清风入睡那样享受。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYbD6g/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYQ2bn/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e虽然没有鱼，篝火还是要有的：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRfxM4Tt/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e除了被冻醒一次，一夜无话。第二天早上坐车去浑源县城吃传说中的小媳妇凉粉，这个地方的凉粉配料有特色，主要有三样东西：不辣的辣椒油、豆干和炸蚕豆，而作为主料的凉粉本身却并不比其它地方的特别，我想像中好的凉粉应该是入口即化的。不管怎样，有这样的经历也是好的：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYPP7x/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e然后坐车去云冈石窟，首先进去是灵严寺：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYQvF7/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e灵严寺的塔和佛像都很有特色，不著重彩，呈乳白色或米黄色，观感素雅：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYQYOZ/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYTaPo/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e双层建筑在我到过的寺庙里是第一次见到：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYejCS/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e大雄宝殿门口的黄金树很耀眼：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYSJjP/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYTxWt/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e寺后就是云冈石窟，风化的石壁很有沧桑感，与前面金碧辉煌的灵严寺对比鲜明。最近越来越不喜欢破败的事物，所以在前面寺庙的兴致至此稍挫：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYU1AP/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e大窟中的巨佛，依稀可见鲜卑帝国时代的盛况：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYUUrh/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYW8Is/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e石窟的外部原本都是有附崖建筑的：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CPoYVmSI/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e下午四点，坐车返京，晚上九点左右抵西直门散伙。\u003c/p\u003e\n\u003cp\u003e活动贴在这里：http://bbs.lvye.cn/thread-780144-1-1.html\u003c/p\u003e\n\u003cp\u003e最后是恒顶合影：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CRyeLPEh/medium.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"五一徒步恒山、云冈石窟"},{"content":"博主者，故陳國人也，起於閭左，姓名不可考。\n少有痴名，喜讀書，涉獵頗雜，不求甚解。弱冠之年，游學淮左，無所成。及長，愈癲痴無知、憊懶無賴。時有西域番國進貢算籌之機，以雷公電母之力驅使，天朝善之，百業咸用，遂渾跡帝都，以操機佐餌。幸天資未泯，頗悉C、PHP、Java、Javascript、Python、Lua、Bash等西域奇技淫巧，尤善Linux、Vim等奇門遁甲之術。以文明之興，皆由主義，遂奉李查德·斯托曼及李納斯·托瓦茲為二聖，厲行KISS、DRY諸原則。\n於他事皆甚愚鈍。雖標榜中右政治傾向，然實不聞國事。裹腹之余，唯以晴耕雨讀寄意，喜山水，樂遊歷，以太白「五嶽尋仙不辭遠，一生好入名山游」自命。\n偶一日，南柯一夢，為大司馬，大將軍，燕國公，領幽州牧，行驃騎大將軍事，冊拜太師、太傅、太保，假節鉞，受九錫，入朝不拜，過廷不趨，劍履上殿，贊拜不名，使持節、開府、儀同三司，都督冀、青、幽、並、兗、豫、梁、廣、揚九州諸軍事。大悅，為食斗粟。\n","permalink":"http://0x3f.org/about/","summary":"\u003cp\u003e博主者，故陳國人也，起於閭左，姓名不可考。\u003c/p\u003e\n\u003cp\u003e少有痴名，喜讀書，涉獵頗雜，不求甚解。弱冠之年，游學淮左，無所成。及長，愈癲痴無知、憊懶無賴。時有西域番國進貢算籌之機，以雷公電母之力驅使，天朝善之，百業咸用，遂渾跡帝都，以操機佐餌。幸天資未泯，頗悉C、PHP、Java、Javascript、Python、Lua、Bash等西域奇技淫巧，尤善Linux、Vim等奇門遁甲之術。以文明之興，皆由主義，遂奉李查德·斯托曼及李納斯·托瓦茲為二聖，厲行KISS、DRY諸原則。\u003c/p\u003e\n\u003cp\u003e於他事皆甚愚鈍。雖標榜中右政治傾向，然實不聞國事。裹腹之余，唯以晴耕雨讀寄意，喜山水，樂遊歷，以太白「五嶽尋仙不辭遠，一生好入名山游」自命。\u003c/p\u003e\n\u003cp\u003e偶一日，南柯一夢，為大司馬，大將軍，燕國公，領幽州牧，行驃騎大將軍事，冊拜太師、太傅、太保，假節鉞，受九錫，入朝不拜，過廷不趨，劍履上殿，贊拜不名，使持節、開府、儀同三司，都督冀、青、幽、並、兗、豫、梁、廣、揚九州諸軍事。大悅，為食斗粟。\u003c/p\u003e","title":"博主本紀"},{"content":"春节前花了一周时间读完了这本书。\n是本不错的Android入门教材，能让人快速地搭出开发环境，了解Android应用的运作机制，对于移动应用开发的初学者尤其有用。当然，这种书一般不会讲得很全面，更深的东西还是要看官方文档，只是Android的官方指南写得比较散，并且过于简单，不适合初学者。\n","permalink":"http://0x3f.org/posts/after-reading-hello-android/","summary":"\u003cp\u003e春节前花了一周时间读完了这本书。\u003c/p\u003e\n\u003cp\u003e是本不错的Android入门教材，能让人快速地搭出开发环境，了解Android应用的运作机制，对于移动应用开发的初学者尤其有用。当然，这种书一般不会讲得很全面，更深的东西还是要看官方文档，只是Android的官方指南写得比较散，并且过于简单，不适合初学者。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/CEUw95b5/gewxz.jpg\" alt=\"\"\u003e\u003c/p\u003e","title":"读过Hello Android"},{"content":"DualHead Watchdog is a Linux desktop app which runs commands or scripts after display settings are changed.\nIt is especially usefull for users who prefer window managers to those huge desktop environments. For these people, wallpapers often cannot be ajusted automatically when the screen size is changed or dual-head display is started. With this app, people can run custom commands to reset the background image when the display settings are changed.\nFor example, I use i3wm in my daily life and I use dual-head display, my laptop has a screen resolution as 1366x768 and my outer display is 1920x1080. So when I start the dual-head display, the background image in the outer display is tiled with 1366x768 images. So I put the following commandline into this app:\nfeh --bg-scale ~/.wallpaper \u0026ldquo;~/.wallpaper\u0026rdquo; is a soft link to my wallpaper. So when dual-head display is started, this command will be called and my wallpaper will be reset to fit the new screen size.\nMore than that, users can make this app do everything when display settings are changed. At the moment, there will be a \u0026lsquo;monitors-changed\u0026rsquo; and a \u0026lsquo;size-changed\u0026rsquo; event, users can specify which event to listen to for each command.\nFeatures A KISSy app which does custom jobs on display changes. Event-driven, which is resource-saving. Can support as many commands as you can set. Each command can be enabled or disabled alone. Each command can listen to either the monitors-changed event or the size-changed event, or both. Links Project: https://github.com/xbot/DualHead-Watchdog FAQ How to modify settings ? Right click the tray icon and select \u0026lsquo;Settings\u0026rsquo;. How to add an entry to the command list ? Right click the command list and select \u0026lsquo;Add new entry\u0026rsquo;. How to delete an entry in the command list ? Right click the entry and select \u0026lsquo;Delete\u0026rsquo;. Why doesn\u0026rsquo;t the command take effect ? Make sure that you have selected the right event to listen and the command is enabled. Change Log version 1.0.0 (2013-02-06 Wednesday 15:14:24)\nInitial release. ","permalink":"http://0x3f.org/posts/dualhead-watchdog-v1-released/","summary":"\u003cp\u003e\u003cstrong\u003eDualHead Watchdog\u003c/strong\u003e is a Linux desktop app which runs commands or scripts after display settings are changed.\u003c/p\u003e\n\u003cp\u003eIt is especially usefull for users who prefer window managers to those huge desktop environments. For these people, wallpapers often cannot be ajusted automatically when the screen size is changed or dual-head display is started. With this app, people can run custom commands to reset the background image when the display settings are changed.\u003c/p\u003e","title":"DualHead Watchdog v1.0 Released"},{"content":"关于迁移 前段时间，用了五年的虚拟主机突然限制了PHP内存上限，导致Wordpress只能启用有限的几个插件，根本不能满足需要。\n所以毅然决定迁移到JeckyII+GitHub，在摸索的过程中发现octopress比JeckyII易用，于是导出所有文章，开始迁移。因为我这几年博客写得比较乱，无论是内容上，还是发表方式上，结果用了几个导出脚本，效果都不甚理想，还是有很多地方需要手工修改。六百篇文章，正好趁这个机会挑拣一下，较早的文章质量低的比较多。断断续续地迁移了一些，剩下的工作量还是很大的，留著以后慢慢来吧。另外这次把URL也改成永久格式了，这一来真的伤筋动骨了，连永久重定向都没的做。\n至于Feed输出，以前订阅Feedburner烧录的两个地址的读者不受影响，直接订阅Wordpress输出的地址的就丢了，这里再公布一下：\n本博客聚合输出：http://feeds.feedburner.com/sinolog 我的全部资讯聚合：http://feeds.feedburner.com/leninlee 迁移那点事 Python 版本的问题 Archlinux很激进，早已把Python的缺省版本进化到了3.x，octopress会用到2.x，结果在生成全站的时候，会报如下错误：\nFile \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 1 import sys; print sys.executable ^ SyntaxError: invalid syntax 在这里找到解决方法。在octopress的plugins目录里创建文件：\n1 2 3 4 5 require \u0026#39;pygments\u0026#39; if !!RUBY_PLATFORM[\u0026#39;linux\u0026#39;] RubyPython.configure :python_exe =\u0026gt; \u0026#39;/usr/bin/python2\u0026#39; end 不足 用了这段时间octopress，感觉缺点也不小，每次修改后都要重新生成全站，占用系统资源不小，而且理论上以后会越来越慢。\n","permalink":"http://0x3f.org/posts/migrate-blog-to-octopress/","summary":"\u003ch2 id=\"关于迁移\"\u003e关于迁移\u003c/h2\u003e\n\u003cp\u003e前段时间，用了五年的虚拟主机突然限制了PHP内存上限，导致Wordpress只能启用有限的几个插件，根本不能满足需要。\u003c/p\u003e\n\u003cp\u003e所以毅然决定迁移到JeckyII+GitHub，在摸索的过程中发现octopress比JeckyII易用，于是导出所有文章，开始迁移。因为我这几年博客写得比较乱，无论是内容上，还是发表方式上，结果用了几个导出脚本，效果都不甚理想，还是有很多地方需要手工修改。六百篇文章，正好趁这个机会挑拣一下，较早的文章质量低的比较多。断断续续地迁移了一些，剩下的工作量还是很大的，留著以后慢慢来吧。另外这次把URL也改成永久格式了，这一来真的伤筋动骨了，连永久重定向都没的做。\u003c/p\u003e\n\u003cp\u003e至于Feed输出，以前订阅Feedburner烧录的两个地址的读者不受影响，直接订阅Wordpress输出的地址的就丢了，这里再公布一下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e本博客聚合输出：http://feeds.feedburner.com/sinolog\u003c/li\u003e\n\u003cli\u003e我的全部资讯聚合：http://feeds.feedburner.com/leninlee\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"迁移那点事\"\u003e迁移那点事\u003c/h2\u003e\n\u003ch3 id=\"python-版本的问题\"\u003ePython 版本的问题\u003c/h3\u003e\n\u003cp\u003eArchlinux很激进，早已把Python的缺省版本进化到了3.x，octopress会用到2.x，结果在生成全站的时候，会报如下错误：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e  File \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 1\n    import sys; print sys.executable\n                        ^\nSyntaxError: invalid syntax\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在\u003ca href=\"http://blog.dayanjia.com/2012/04/fix-rubypython-bug-in-arch-linux/\"\u003e这里\u003c/a\u003e找到解决方法。在octopress的plugins目录里创建文件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ruby\" data-lang=\"ruby\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;pygments\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e!!\u003c/span\u003e\u003cspan class=\"no\"\u003eRUBY_PLATFORM\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;linux\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"no\"\u003eRubyPython\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfigure\u003c/span\u003e \u003cspan class=\"ss\"\u003e:python_exe\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;/usr/bin/python2\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"不足\"\u003e不足\u003c/h3\u003e\n\u003cp\u003e用了这段时间octopress，感觉缺点也不小，每次修改后都要重新生成全站，占用系统资源不小，而且理论上以后会越来越慢。\u003c/p\u003e","title":"迁移到 Octopress"},{"content":"前段时间，某天凌晨无故醒来，读完了这本书。\n虽然是ZK框架的开发者写的书，不过实在不敢恭维。开发环境搭建的一章已经过时，其余内容也显得蜻蜓点水，加上全书结构显得不是很合理，总之看完对ZK的感觉仍是朦朦胧胧的，更别说上手做东西了。\n","permalink":"http://0x3f.org/posts/after-reading-zk-ajax-without-the-javascript-framework/","summary":"\u003cp\u003e前段时间，某天凌晨无故醒来，读完了这本书。\u003c/p\u003e\n\u003cp\u003e虽然是ZK框架的开发者写的书，不过实在不敢恭维。开发环境搭建的一章已经过时，其余内容也显得蜻蜓点水，加上全书结构显得不是很合理，总之看完对ZK的感觉仍是朦朦胧胧的，更别说上手做东西了。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.yupoo.com/photos/leninlee/85850069/\" title=\"ZK: AJAX without the JavaScript Framework\"\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/C3luCjSG/medium.jpg\" alt=\"ZK: AJAX without the JavaScript Framework\" width=\"405\" height=\"500\" border=\"0\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"读过\"ZK: AJAX without the JavaScript Framework\""},{"content":"##阅读说明\n阅读本文要求有基本的Linux系统使用经验和Bash脚本编程能力。\n本文所述的内容适用于RHEL、CentOS等红帽系Linux发行版。\n##系统服务简介\n###常用命令\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 启动MySQL service mysqld start # 关闭MySQL service mysqld stop # 重启MySQL service mysqld restart # 查看MySQL服务运行状态 service mysqld status # 查看MySQL服务是否开机自动运行 chkconfig --list mysqld # 设置MySQL服务开机自动运行 chkconfig --level 345 mysqld on # 取消MySQL服务开机自动运行 chkconfig --level 345 mysqld off ###运行级别\n泛UNIX派系操作系统使用运行级别标识使用何种模式初始化。理论上，不同的发行版各级别代表的意义不同。红帽系发行版使用以下七个运行级别：\n0：关机 1：单用户模式 2：多用户模式，无网络服务 3：多用户模式，有网络服务 4：未使用/用户自定义 5：带图形界面的多用户模式 6：重启 最常用的是0、3、5、6四种模式。其中，0和6表示关闭和重启操作系统，所以，执行命令init 0和shutdown是一个效果，同样，执行命令init 6和reboot是一个效果。模式3即普通的命令行用户界面，模式5即普通的图形界面用户界面。\n模式1在个别情景下会用到，例如忘记root用户的密码时，需要进入模式1修改密码。\n##系统服务脚本格式\n###示例\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/bin/bash # chkconfig: 345 99 12 # description: This is a sample service script case \u0026#34;$1\u0026#34; in start) # Start something. touch /var/lock/subsys/sample ;; stop) # Stop something. /bin/rm -f /var/lock/subsys/sample ;; restart|reload) # Restart something. ;; status) # Report the running status of something. ;; *) # Invalid command, complain an error. ;; esac exit 0 ###解释\n假设本服务脚本文件的文件名为sample。\n整个服务脚本是一个普通的Bash脚本。主体是一个case语句，定义了四个命令start、stop、restart或reload、status，顾名思义，四个命令分别用来启动、停止、重启该服务，以及获取服务的运行状态。\n红帽系发行版使用chkconfig命令设置服务自动在哪个运行级别被自动执行。要使服务脚本支持chkconfig命令，需要加入注释行：\n1 # chkconfig: 345 99 12 其中，345表示缺省的运行级别，使用如下命令添加服务时：\n1 chkconfig --add sample 将和使用如下命令一个效果：\n1 chkconfig --level 345 sample on 99表示启动序号，例如若希望服务B在服务A启动后启动，且服务A的启动序号是98，则服务B的启动序号应设为大于98的一个整数。\n12表示停止序号，作用与启动序号相同。\n此外，若希望在操作系统关闭前先自动执行服务的关闭命令，需要在**/var/lock/subsys/目录中存在与服务名同名的空文件，因此，应在start命令中创建一个这样的文件，并在stop**命令中删除之。\n","permalink":"http://0x3f.org/posts/how-to-write-service-scripts-for-redhat-distros/","summary":"\u003cp\u003e##阅读说明\u003c/p\u003e\n\u003cp\u003e阅读本文要求有基本的Linux系统使用经验和Bash脚本编程能力。\u003c/p\u003e\n\u003cp\u003e本文所述的内容适用于RHEL、CentOS等红帽系Linux发行版。\u003c/p\u003e\n\u003cp\u003e##系统服务简介\u003c/p\u003e\n\u003cp\u003e###常用命令\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 启动MySQL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice mysqld start\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 关闭MySQL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice mysqld stop\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 重启MySQL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice mysqld restart\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 查看MySQL服务运行状态\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice mysqld status\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 查看MySQL服务是否开机自动运行\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echkconfig --list mysqld\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 设置MySQL服务开机自动运行\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echkconfig --level \u003cspan class=\"m\"\u003e345\u003c/span\u003e mysqld on\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 取消MySQL服务开机自动运行\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echkconfig --level \u003cspan class=\"m\"\u003e345\u003c/span\u003e mysqld off\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e###运行级别\u003c/p\u003e","title":"怎样为红帽系Linux发行版写系统服务脚本"},{"content":"前天夜里读完了《三体》的第三部。\n这三部一部比一部成熟。第一部只能算是整个故事的开端；第二部的亮点在最后揭示黑暗森林，前面的部分废话太多；第三部开始出现情节的跌宕，是三部中最像小说的一部。\n诚如所闻，刘慈欣真的把地球写毁灭了。但是站在宇宙众生的角度冷眼旁观要好过以人类自我为中心的意淫，边泡妞边救地球的好莱坞套路也就是过过眼瘾而已。\n","permalink":"http://0x3f.org/posts/after-reading-three-body-long-live-the-king-of-terrors/","summary":"\u003cp\u003e前天夜里读完了《三体》的第三部。\u003c/p\u003e\n\u003cp\u003e这三部一部比一部成熟。第一部只能算是整个故事的开端；第二部的亮点在最后揭示黑暗森林，前面的部分废话太多；第三部开始出现情节的跌宕，是三部中最像小说的一部。\u003c/p\u003e\n\u003cp\u003e诚如所闻，刘慈欣真的把地球写毁灭了。但是站在宇宙众生的角度冷眼旁观要好过以人类自我为中心的意淫，边泡妞边救地球的好莱坞套路也就是过过眼瘾而已。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.yupoo.com/photos/leninlee/85808819/\" title=\"三体3死神永生\"\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/C2AFUunY/medium.jpg\" alt=\"三体3死神永生\" width=\"340\" height=\"500\" border=\"0\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"读完《三体——死神永生》"},{"content":"凌晨三点，读完了《三体》的第二部。\n咒语，这个东西的确很有意思。第二部比第一部好看，故事情节上完全展开，成功地制造了悬念。如果一部小说，删掉很多文字仍不影响故事情节，那这部分就是多余的，可惜在这部书里这是个很大的问题，所以直到最后三分之一才真正出彩。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/after-reading-three-body-the-dark-forests/","summary":"\u003cp\u003e凌晨三点，读完了《三体》的第二部。\u003c/p\u003e\n\u003cp\u003e咒语，这个东西的确很有意思。第二部比第一部好看，故事情节上完全展开，成功地制造了悬念。如果一部小说，删掉很多文字仍不影响故事情节，那这部分就是多余的，可惜在这部书里这是个很大的问题，所以直到最后三分之一才真正出彩。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/tt1qOjDU6_6tnnQgdfYtw9MTjNZETYmyPJy0liipFm0?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/-OcSgdVvYZD8/T57gVJYqtyI/AAAAAAAAB4E/C6tOtnZPX28/s800/s4700425.jpg\" height=\"426\" width=\"312\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"读完《三体——黑暗森林》"},{"content":"此前预览文章是通过调用系统默认的网络浏览器实现的，缺点是这些功能完备的浏览器启动速度不甚理想，尤其是火狐，谁用谁知道。\n前两天看了TuxRadar的一个Podcast，几分钟内就可以用pywebkitgtk拼装出一个五脏俱全的网络浏览器，pywebkitgtk这个东西实在是非常的好用。不过我实测后发现这东西加载页面的速度比较慢，而且貌似是单线程的，因为图片都是放在最后才加载，不知道是这个绑定本身的问题，还是有API可以实现的。于是突然想到拿这个东西实现一个简单的浏览器，很适合在UB里预览文章。\n增加了一个选项“ub_use_ubviewer”，默认值是1，即默认使用这个内建的浏览器预览文章。当这个选项的值被设为0时，仍然使用系统的默认浏览器，并且在Vim启动时不会加载内建的浏览器。这样做一是为了多一种选择，再一个也可以避开烦人的GTK警告：\n** (gvim:13629): WARNING **: Trying to register gtype 'GMountMountFlags' as enum when in fact it is of type 'GFlags'\n** (gvim:13629): WARNING **: Trying to register gtype 'GDriveStartFlags' as enum when in fact it is of type 'GFlags'\n** (gvim:13629): WARNING **: Trying to register gtype 'GSocketMsgFlags' as enum when in fact it is of type 'GFlags'\n这些警告是GTK或其它一些程序库的Bug造成的，虽然只在虚拟终端中启动Vim时会显示并且不影响使用，但总会有警告恐惧症患者会觉得这种东西很闹心。如果这样，就把这个选项的值设成0，用回巨型浏览器好了。\n本次更新的全部内容如下：\nFeature: Add a tiny web browser to do previewing, which starts much faster than full-functional browsers like firefox and chromium. The later ones are still supported. The matter that whether or not to use the new previewer is controlled by a new option ub_use_ubviewer. Bugfix: Issue 7: Keywords highlighting is disabled in item lists, even if searches are made manually. 关于UB的详细信息在这里。\n这是那个Podcast：\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-v350-released/","summary":"\u003cp\u003e此前预览文章是通过调用系统默认的网络浏览器实现的，缺点是这些功能完备的浏览器启动速度不甚理想，尤其是火狐，谁用谁知道。\u003c/p\u003e\n\u003cp\u003e前两天看了TuxRadar的一个Podcast，几分钟内就可以用pywebkitgtk拼装出一个五脏俱全的网络浏览器，pywebkitgtk这个东西实在是非常的好用。不过我实测后发现这东西加载页面的速度比较慢，而且貌似是单线程的，因为图片都是放在最后才加载，不知道是这个绑定本身的问题，还是有API可以实现的。于是突然想到拿这个东西实现一个简单的浏览器，很适合在UB里预览文章。\u003c/p\u003e\n\u003cp\u003e增加了一个选项\u003cstrong\u003e“ub_use_ubviewer”\u003c/strong\u003e，默认值是1，即默认使用这个内建的浏览器预览文章。当这个选项的值被设为0时，仍然使用系统的默认浏览器，并且在Vim启动时不会加载内建的浏览器。这样做一是为了多一种选择，再一个也可以避开烦人的GTK警告：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e** (gvim:13629): WARNING **: Trying to register gtype 'GMountMountFlags' as enum when in fact it is of type 'GFlags'\u003c/p\u003e\n\u003cp\u003e** (gvim:13629): WARNING **: Trying to register gtype 'GDriveStartFlags' as enum when in fact it is of type 'GFlags'\u003c/p\u003e\n\u003cp\u003e** (gvim:13629): WARNING **: Trying to register gtype 'GSocketMsgFlags' as enum when in fact it is of type 'GFlags'\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这些警告是GTK或其它一些程序库的Bug造成的，虽然只在虚拟终端中启动Vim时会显示并且不影响使用，但总会有警告恐惧症患者会觉得这种东西很闹心。如果这样，就把这个选项的值设成0，用回巨型浏览器好了。\u003c/p\u003e\n\u003cp\u003e本次更新的全部内容如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFeature: Add a tiny web browser to do previewing, which starts much faster than full-functional browsers like firefox and chromium. The later ones are still supported. The matter that whether or not to use the new previewer is controlled by a new option \u003cstrong\u003eub_use_ubviewer\u003c/strong\u003e.\u003c/li\u003e\n\u003cli\u003eBugfix: Issue 7: Keywords highlighting is disabled in item lists, even if searches are made manually.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e关于UB的详细信息在\u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003e这里\u003c/a\u003e。\u003c/p\u003e","title":"UltraBlog.vim v3.5.0: 内建浏览器"},{"content":"这次的更新主要引入了支持正则表达式的全文检索、批量替换和调试模式。\n正则表达式 我一直觉得原来的全文检索有一个遗憾，虽然可以通过多个关键词实现较为精确的查询，但还是不如正则表达式灵活和精确。\n这是个蓄谋已久的需求，但直到真正做起来，才发现很多有意思的东西。虽然SQLite3提供支持正则表达式查询的“REGEX”关键词，但并没有实际实现这个功能，而是需要写程序实现并在数据库接口中注册这个函数：\n```python import sqlite3 conn = sqlite3.connect('/tmp/your-database-file.db') # 使用正则表达式匹配给定内容的函数，返回布尔类型 def regexp_search(expr, item): \"\"\"Check if the item has a sub-string which matches the expr\"\"\" reg = re.compile(expr) return reg.search(item) is not None # 在数据库中注册这个函数 conn.create_function('REGEXP', 2, regexp_search) cur = conn.execute('select id,title from post where content REGEXP ?', '\\babc\\b') row = cur.fetchone() print row conn.close() ``` 在SQLAlchemy中具体的实现方式是：\n```python # 注册函数 dbe = sqlalchemy.create_engine(\"sqlite:///tmp/your-database-file.db\") conn = dbe.connect() conn.connection.create_function('REGEXP', 2, regexp_search) # 在SQL Expression Language中创建查询条件 tbl = Post.__table__ cond_1 = tbl.c.title.op('regexp')(r'\\babc\\b') cond_2 = tbl.c.content.op('regexp')(r'\\babc\\b') ``` 和普通的全文检索一样，正则表达式的全文检索也支持使用多个表达式作为查询条件，多个条件之间是与的关系。现在可以这样查询所有包含“UltraBlog.vim”但不把推广代码算在内的文章了：\n```vim :UBRegexSearch [^\\[]UltraBlog\\.vim[^\\]] ``` 批量替换 在我换过新域名后，我就觉得这个功能很有必要了：\n```vim :UBReplace https://sinolog.it https://0x3f.org ``` 包含第一个参数内容并被替换的文章数目会显示在Vim的命令输出缓冲区中。\n有了前面实现全文检索支持正则表达式的尝试，再实现支持正则表达式的批量替换就容易多了：\n```python # 转换字符串成raw格式的函数 def raw(text): \"\"\"Returns a raw string representation of text\"\"\" escape_dict={'\\a':r'\\a', '\\b':r'\\b', '\\c':r'\\c', '\\f':r'\\f', '\\n':r'\\n', '\\r':r'\\r', '\\t':r'\\t', '\\v':r'\\v', '\\'':r'\\'', '\\\"':r'\\\"', '\\0':r'\\0', '\\1':r'\\1', '\\2':r'\\2', '\\3':r'\\3', '\\4':r'\\4', '\\5':r'\\5', '\\6':r'\\6', '\\7':r'\\7', '\\8':r'\\8', '\\9':r'\\9'} return \"\".join([escape_dict.get(char,char) for char in text]) # 使用正则表达式替换字符串的函数 def regex_replace(string, expr, repl): \"\"\"Do substitutions on the string for repls matching the expr\"\"\" r = re.compile(raw(expr)) return r.sub(repl, string) # 在数据库中注册这个函数 conn.connection.create_function('regex_replace', 3, regex_replace) # 在SQL语句中使用这个函数 sql_replace = \"update post set title=regex_replace(title,:needle,:replacement),content=regex_replace(content,:needle,:replacement)\" conn.execute(sql_replace, {'needle':r'\\babc\\b', 'replacement':'xyz'}) ``` 最终，这个命令是这样的：\n```vim :UBRegexReplace \\babc\\b xyz ``` 实现批量替换容易，但要解决由此引出的一个问题就费周折了，就是批量替换过文章内容后怎样和博客同步的问题，现在我还没有好的想法，留作以后实现。\n调试模式 开启调试模式可以将所有被执行的SQL语句显示在Vim的命令输出缓冲区中，在有异常抛出时，也可以显示堆栈信息。由于开启调试模式既不需要修改代码，也不需要重启Vim，这可以极大地方便开发时对UltraBlog.vim的调试，也能使用户提交问题时能反馈更多更详细的信息。\n以下三个命令用于控制调试模式的开启状态：\n:UBEnableDebug :UBDisableDebug :UBToggleDebug 其它内容 本次更新的内容如下：\nFeature: Add the command :UBRegexSearch, doing full-text searches with regular expressions ! Feature: Add the command :UBReplace, doing full-text substitutions. Feature: Add the command :UBRegexReplace, doing full-text substitutions with regular expressions. Feature: Add commands :UBEnableDebug, :UBDisableDebug, :UBToggleDebug and an option ub_debug. In debug mode, SQL statements and stack traces of exceptions will be displayed. Change: Undo keywords highlighting after executing :UBList. Bugfix: Exceptions raised when opening the current item under cursor in item lists if the option ub_hotkey_save_current_item has not been set. Now this options comes with a default value. 关于UB的详细信息在这里。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-v340-released/","summary":"\u003cp\u003e这次的更新主要引入了支持正则表达式的全文检索、批量替换和调试模式。\u003c/p\u003e\n\u003ch2\u003e正则表达式\u003c/h2\u003e\n\u003cp\u003e我一直觉得原来的全文检索有一个遗憾，虽然可以通过多个关键词实现较为精确的查询，但还是不如正则表达式灵活和精确。\u003c/p\u003e\n\u003cp\u003e这是个蓄谋已久的需求，但直到真正做起来，才发现很多有意思的东西。虽然SQLite3提供支持正则表达式查询的\u003cstrong\u003e“REGEX”\u003c/strong\u003e关键词，但并没有实际实现这个功能，而是需要写程序实现并在数据库接口中注册这个函数：\u003c/p\u003e\n```python\nimport sqlite3\n\nconn = sqlite3.connect('/tmp/your-database-file.db')\n\n# 使用正则表达式匹配给定内容的函数，返回布尔类型\ndef regexp_search(expr, item):\n    \"\"\"Check if the item has a sub-string which matches the expr\"\"\"\n    reg = re.compile(expr)\n    return reg.search(item) is not None\n\n# 在数据库中注册这个函数\nconn.create_function('REGEXP', 2, regexp_search)\n\ncur = conn.execute('select id,title from post where content REGEXP ?', '\\babc\\b')\nrow = cur.fetchone()\nprint row\n\nconn.close()\n```\n\n\u003cp\u003e在SQLAlchemy中具体的实现方式是：\u003c/p\u003e\n```python\n# 注册函数\ndbe = sqlalchemy.create_engine(\"sqlite:///tmp/your-database-file.db\")\nconn = dbe.connect()\nconn.connection.create_function('REGEXP', 2, regexp_search)\n\n# 在SQL Expression Language中创建查询条件\ntbl = Post.__table__\ncond_1 = tbl.c.title.op('regexp')(r'\\babc\\b')\ncond_2 = tbl.c.content.op('regexp')(r'\\babc\\b')\n```\n\n\u003cp\u003e和普通的全文检索一样，正则表达式的全文检索也支持使用多个表达式作为查询条件，多个条件之间是与的关系。现在可以这样查询所有包含“UltraBlog.vim”但不把推广代码算在内的文章了：\u003c/p\u003e","title":"UltraBlog.vim v3.4.0: 正则表达式、批量替换和调试模式"},{"content":"用xdebug跟踪程序性能时，发现一个定义了约七百个常量的文件，include_once()时消耗约六十毫秒的时间。事实上define()的效率比较低，如果需要定义大量常量，使用APC扩展提供的apc_define_constants()效果会好得多。\n下面是对这个文件改造前后效率跟踪结果的对比：\ndefine()方案（ms） apc_define_constants()方案（ms） 启动Web服务和PHP，第一次运行 58 4 不重启Web服务和PHP，第二次运行 65 1 不重启Web服务和PHP，第三次运行 66 1 由此可见，apc_define_constants()不但在初次调用时效能就超过define()，而且由于APC自身的缓存功能，在后续调用时效率会有进一步的提高，而define()基本没有变化。\n以下是apc_define_constants()的代码示例：\n```php \u003c?php if(!apc_load_constants('my_constants')) { $constants = array( 'ONE' =\u003e 1, 'TWO' =\u003e 2, 'THREE' =\u003e 3, ); apc_define_constants('my_constants', $constants); } ?\u003e ``` Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/define-massive-constants-using-apc/","summary":"\u003cp\u003e用xdebug跟踪程序性能时，发现一个定义了约七百个常量的文件，include_once()时消耗约六十毫秒的时间。事实上define()的效率比较低，如果需要定义大量常量，使用APC扩展提供的apc_define_constants()效果会好得多。\u003c/p\u003e\n\n\u003cp\u003e下面是对这个文件改造前后效率跟踪结果的对比：\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth\u003e\u003c/th\u003e\n        \u003cth\u003edefine()方案（ms）\u003c/th\u003e\n        \u003cth\u003eapc_define_constants()方案（ms）\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd\u003e启动Web服务和PHP，第一次运行\u003c/td\u003e\n        \u003ctd\u003e58\u003c/td\u003e\n        \u003ctd\u003e4\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd\u003e不重启Web服务和PHP，第二次运行\u003c/td\u003e\n        \u003ctd\u003e65\u003c/td\u003e\n        \u003ctd\u003e1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd\u003e不重启Web服务和PHP，第三次运行\u003c/td\u003e\n        \u003ctd\u003e66\u003c/td\u003e\n        \u003ctd\u003e1\u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\n\u003cp\u003e由此可见，apc_define_constants()不但在初次调用时效能就超过define()，而且由于APC自身的缓存功能，在后续调用时效率会有进一步的提高，而define()基本没有变化。\u003c/p\u003e\n\n\u003cp\u003e以下是apc_define_constants()的代码示例：\u003c/p\u003e\n\n```php\n\u003c?php\nif(!apc_load_constants('my_constants')) {\n    $constants = array(\n        'ONE'   =\u003e 1,\n        'TWO'   =\u003e 2,\n        'THREE' =\u003e 3,\n    );\n    apc_define_constants('my_constants', $constants);\n}\n?\u003e\n```\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"PHP大量常量应集中使用APC定义"},{"content":"使用xdebug跟踪程序性能时发现fsockopen()函数耗时一秒，单步调试发现实际在这里超时了，而超时时间设置的就是一秒。\n如果把目标地址由原来的“localhost”换成“127.0.0.1”，马上就可以连上。在PHP的Bug跟踪系统中找到这个问题：\nhttps://bugs.php.net/bug.php?id=50953\n看起来像是在5.2.12以后已修改，但我发现在5.2.17中仍存在这个问题。另有说法在5.3中不存在这个问题，我没有测试。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/fsockopen-fails-connecting-localhost/","summary":"\u003cp\u003e使用xdebug跟踪程序性能时发现fsockopen()函数耗时一秒，单步调试发现实际在这里超时了，而超时时间设置的就是一秒。\u003c/p\u003e\n\n\u003cp\u003e如果把目标地址由原来的“localhost”换成“127.0.0.1”，马上就可以连上。在PHP的Bug跟踪系统中找到这个问题：\u003c/p\u003e\n\n\u003cp\u003ehttps://bugs.php.net/bug.php?id=50953\u003c/p\u003e\n\n\u003cp\u003e看起来像是在5.2.12以后已修改，但我发现在5.2.17中仍存在这个问题。另有说法在5.3中不存在这个问题，我没有测试。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"慎用PHP的fsockopen()连接localhost"},{"content":"UB一岁了，这算是个周年纪念版吧。\n在这一年里，因为各种原因，博客写得没有以前多了，但每篇都是用这个插件写的，我觉得很好用。断断续续地做了一些修改，因为一切都是一个人在做，所以大的变化不多。这次这个版本里有些改动还是要感谢荒野无灯童鞋，他的建议很大程度上催生了这个新版本：比如加入保存命令的热键映射选项，这样可以使用保存普通文件的热键保存UB中的内容，我自己以前也经常习惯性地用错热键；还有socket超时时间的选项，最近我这里也经常性地在UB操作博客时报超时的异常，荒童鞋关于自定义socket超时时间的建议一语惊醒了梦中人。\n此外，似乎与近期Vim的一次升级有关，在Vim中调用Python接口打印任何内容到标准IO都会导致Vim崩溃，所以这次把所有的输出都改成了调用Vim的输出命令来做。\n本次修改的内容中，还有一项比较重要的内容就是实现了国际化，目前只提供英文和简体中文两种语言，由于Vimball不能处理二进制文件，所以从此以后UB改用zip格式压缩包打包。\n以下是本次更新的详细内容：\nFeature: Add i18n support ! Feature: Add a new option ub_hotkey_save_current_item, users can define their own hotkey for :UBSave. Feature: Add a new option ub_socket_timeout, users can customize the timeout period in seconds, useful for slow networks. Bugfix: Exception raised when one event is processed by more than one event handlers. Change: Echoing messages now uses the command :echoerr instead of python's sys.stderr, because Vim crashes on this due to an upgrade recently. Change: Change commands :UBSave, :UBSend, :UBUpload, :UBConv, :UBPreview to be available only in their effective views. Change: Lists are set nowrapped. Bugfix: Stop complaining '_pop from empty list_' while doing almost everything. 关于UB的详细信息在这里。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-v330-released/","summary":"\u003cp\u003eUB一岁了，这算是个周年纪念版吧。\u003c/p\u003e\n\n\u003cp\u003e在这一年里，因为各种原因，博客写得没有以前多了，但每篇都是用这个插件写的，我觉得很好用。断断续续地做了一些修改，因为一切都是一个人在做，所以大的变化不多。这次这个版本里有些改动还是要感谢\u003ca href=\"http://ihacklog.com/\"\u003e荒野无灯\u003c/a\u003e童鞋，他的\u003ca href=\"https://github.com/xbot/UltraBlog.vim/issues/3\"\u003e建议\u003c/a\u003e很大程度上催生了这个新版本：比如加入保存命令的热键映射选项，这样可以使用保存普通文件的热键保存UB中的内容，我自己以前也经常习惯性地用错热键；还有socket超时时间的选项，最近我这里也经常性地在UB操作博客时报超时的异常，荒童鞋关于自定义socket超时时间的建议一语惊醒了梦中人。\u003c/p\u003e\n\n\u003cp\u003e此外，似乎与近期Vim的一次升级\u003ca href=\"http://comments.gmane.org/gmane.editors.vim.devel/34092\"\u003e有关\u003c/a\u003e，在Vim中调用Python接口打印任何内容到标准IO都会导致Vim崩溃，所以这次把所有的输出都改成了调用Vim的输出命令来做。\u003c/p\u003e\n\n\u003cp\u003e本次修改的内容中，还有一项比较重要的内容就是实现了国际化，目前只提供英文和简体中文两种语言，由于Vimball不能处理二进制文件，所以从此以后UB改用zip格式压缩包打包。\u003c/p\u003e\n\n\u003cp\u003e以下是本次更新的详细内容：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFeature: Add i18n support !\u003c/li\u003e\n\u003cli\u003eFeature: Add a new option \u003cstrong\u003eub_hotkey_save_current_item\u003c/strong\u003e, users can define their own hotkey for \u003cstrong\u003e:UBSave\u003c/strong\u003e.\u003c/li\u003e\n\u003cli\u003eFeature: Add a new option \u003cstrong\u003eub_socket_timeout\u003c/strong\u003e, users can customize the timeout period in seconds, useful for slow networks.\u003c/li\u003e\n\u003cli\u003eBugfix:  Exception raised when one event is processed by more than one event handlers.\u003c/li\u003e\n\u003cli\u003eChange:  Echoing messages now uses the command :echoerr instead of python's sys.stderr, because Vim crashes on this due to an upgrade recently.\u003c/li\u003e\n\u003cli\u003eChange:  Change commands \u003cstrong\u003e:UBSave\u003c/strong\u003e, \u003cstrong\u003e:UBSend\u003c/strong\u003e, \u003cstrong\u003e:UBUpload\u003c/strong\u003e, \u003cstrong\u003e:UBConv\u003c/strong\u003e, \u003cstrong\u003e:UBPreview\u003c/strong\u003e to be available only in their effective views.\u003c/li\u003e\n\u003cli\u003eChange:  Lists are set nowrapped.\u003c/li\u003e\n\u003cli\u003eBugfix:  Stop complaining '\u003cstrong\u003e_pop from empty list_\u003c/strong\u003e' while doing almost everything.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e关于UB的详细信息在\u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003e这里\u003c/a\u003e。\u003c/p\u003e","title":"UltraBlog.vim v3.3.0：I18N、超时时间和其它"},{"content":"Archlinux目前对Thinkpad风扇的自动控制效果并不好，气温上升后很容易出现一直在三千多转一直跑的问题。thinkfan是目前用的比较多的自动控制风扇转速的程序，但Google到的配置thinkfan的文章大多语焉不详，可能是跟具体的发行版有关，因为貌似有些发行版中安装了thinkfan后会自动生成缺省的配置文件，但在目前的AUR中的包被安装后却没有生成任何配置文件。\n下面是我在Archlinux下配置的步骤，实际效果很好，现在只要不看视频、不编译程序、不启动Chromium，一般是两千九百转的速度，安静多了。\nlm_sensors 安装lm_sensors并执行命令初始化：\n```bash # 一路回车 sudo sensors-detect ``` 将sensors加入rc.conf中DAEMONS中，开机启动。\n启动sensors服务：\n```bash sudo rc.d start sensors ``` thinkpad_acpi 修改文件“/etc/modprobe.d/thinkpad_acpi.conf”：\n``` options thinkpad_acpi fan_control=1 ``` 我这里虽没有把thinkpad_acpi加到rc.conf的MODULES中，但lsmod也是可以看到它的，说明还是自动启用了。要使上面这项配置生效，必须重启电脑，我这里重启thinkpad_acpi模块时报错说该模块正在被使用。\nthinkfan 安装thinkfan并修改文件“/etc/default/thinkfan”：\n``` START=yes ``` 修改文件“/etc/thinkfan.conf”：\n``` sensor /sys/class/hwmon/hwmon0/temp1_input (0, 0, 55) (1, 48, 60) (2, 50, 61) (3, 52, 63) (4, 56, 65) (5, 59, 66) (7, 63, 32767) ``` 将thinkfan加入rc.conf的DAEMONS中，开机自动启动。\n启动thinkfan：\n```bash sudo thinkfan ``` 查看状态 ```bash # 看CPU温度和风扇转速 sensors # 看风扇详细信息 cat /proc/acpi/ibm/fan ``` Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/how-to-control-fan-speed-with-thinkfan/","summary":"\u003cp\u003eArchlinux目前对Thinkpad风扇的自动控制效果并不好，气温上升后很容易出现一直在三千多转一直跑的问题。thinkfan是目前用的比较多的自动控制风扇转速的程序，但Google到的配置thinkfan的文章大多语焉不详，可能是跟具体的发行版有关，因为貌似有些发行版中安装了thinkfan后会自动生成缺省的配置文件，但在目前的AUR中的包被安装后却没有生成任何配置文件。\u003c/p\u003e\n\n\u003cp\u003e下面是我在Archlinux下配置的步骤，实际效果很好，现在只要不看视频、不编译程序、不启动Chromium，一般是两千九百转的速度，安静多了。\u003c/p\u003e\n\n\u003ch2\u003elm_sensors\u003c/h2\u003e\n\n\u003cp\u003e安装lm_sensors并执行命令初始化：\u003c/p\u003e\n\n```bash\n# 一路回车\nsudo sensors-detect\n```\n\n\u003cp\u003e将sensors加入rc.conf中DAEMONS中，开机启动。\u003c/p\u003e\n\n\u003cp\u003e启动sensors服务：\u003c/p\u003e\n\n```bash\nsudo rc.d start sensors\n```\n\n\u003ch2\u003ethinkpad_acpi\u003c/h2\u003e\n\n\u003cp\u003e修改文件“\u003cstrong\u003e/etc/modprobe.d/thinkpad_acpi.conf\u003c/strong\u003e”：\u003c/p\u003e\n\n```\noptions thinkpad_acpi fan_control=1\n```\n\n\u003cp\u003e我这里虽没有把thinkpad_acpi加到rc.conf的MODULES中，但lsmod也是可以看到它的，说明还是自动启用了。要使上面这项配置生效，必须重启电脑，我这里重启thinkpad_acpi模块时报错说该模块正在被使用。\u003c/p\u003e\n\n\u003ch2\u003ethinkfan\u003c/h2\u003e\n\n\u003cp\u003e安装thinkfan并修改文件“\u003cstrong\u003e/etc/default/thinkfan\u003c/strong\u003e”：\u003c/p\u003e\n\n```\nSTART=yes\n```\n\n\u003cp\u003e修改文件“\u003cstrong\u003e/etc/thinkfan.conf\u003c/strong\u003e”：\u003c/p\u003e\n\n```\nsensor /sys/class/hwmon/hwmon0/temp1_input\n\n(0,  0, 55)\n(1, 48, 60)\n(2, 50, 61)\n(3, 52, 63)\n(4, 56, 65)\n(5, 59, 66)\n(7, 63, 32767)\n```\n\n\u003cp\u003e将thinkfan加入rc.conf的DAEMONS中，开机自动启动。\u003c/p\u003e\n\n\u003cp\u003e启动thinkfan：\u003c/p\u003e\n\n```bash\nsudo thinkfan\n```\n\n\u003ch2\u003e查看状态\u003c/h2\u003e\n\n```bash\n# 看CPU温度和风扇转速\nsensors\n\n# 看风扇详细信息\ncat /proc/acpi/ibm/fan\n```\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"在Archlinux下使用thinkfan控制Thinkpad x220的风扇转速"},{"content":"TurboCRM Cluster Express是TurboCRM的集群实施工具。\n去年我曾经写过一个配置集群的Bash脚本“cluster.sh”，TCE是对这个脚本的图形界面封装，通过可视化的操作简化集群的实施工作。\nTCE的最新版本和使用说明可以在这里找到。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/turbocrm-cluster-express-v1-released/","summary":"\u003cp\u003eTurboCRM Cluster Express是TurboCRM的集群实施工具。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"http://pic.yupoo.com/leninlee/BSfJUW1x/medium.jpg\" alt=\"illustration\" /\u003e\u003c/p\u003e\n\n\u003cp\u003e去年我曾经写过一个配置集群的Bash脚本“cluster.sh”，TCE是对这个脚本的图形界面封装，通过可视化的操作简化集群的实施工作。\u003c/p\u003e\n\n\u003cp\u003eTCE的最新版本和使用说明可以在\u003ca href=\"http://xbot.github.com/TurboCRM-Cluster-Express/\"\u003e这里\u003c/a\u003e找到。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"TurboCRM Cluster Express v1.0 释出"},{"content":"貌似Lose系统下看在线视频的时候不会超时自动关闭屏幕，但是我在Arch下就一直晃鼠标、按键盘来著，这严重违反了DRY原则。于是昨天终于写了这个脚本，当全屏播放视频的时候，关闭屏保和显示器的节能特性，否则则激活它们。由于是在X的级别实现，理论上应当适合所有桌面环境。\n```bash #!/bin/bash # Baby-sitter of the monitor's DPMS idle_period=60 ss_switch_off=0 ss_is_off=0 while true; do # Read DPMS state xset -q|grep \"DPMS is Disabled\" \u003e /dev/null \u0026\u0026 ss_is_off=1 || ss_is_off=0 # Get pid of the current window active_window_id=`xprop -root | grep \"_NET_ACTIVE_WINDOW(WINDOW)\" | cut -d\" \" -f5` decimal_id=`xprop -id $active_window_id | grep PID | cut -d\" \" -f3` # Traverse all libflashplayer.so for pid in `ps -ef|grep -v grep|grep libflashplayer.so|awk '{print $2}'`; do # If the current window is libflashplayer.so if [ \"$pid\" -eq \"$decimal_id\" ]; then ss_switch_off=1 break else ss_switch_off=0 fi done if [ $ss_switch_off -eq 1 ]; then # Turn off DPMS echo Turn off DPMS if [ $ss_is_off -eq 0 ]; then echo Action xset s off xset -dpms fi else # Turn on DPMS echo Turn on DPMS if [ $ss_is_off -eq 1 ]; then echo Action xset +dpms xset s on fi fi sleep $idle_period done ``` 似乎对非全屏播放的情况没有什么好方法。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/how-to-keep-monitor-active-while-watching-flv/","summary":"\u003cp\u003e貌似Lose系统下看在线视频的时候不会超时自动关闭屏幕，但是我在Arch下就一直晃鼠标、按键盘来著，这严重违反了DRY原则。于是昨天终于写了这个脚本，当全屏播放视频的时候，关闭屏保和显示器的节能特性，否则则激活它们。由于是在X的级别实现，理论上应当适合所有桌面环境。\u003c/p\u003e\n\n```bash\n#!/bin/bash\n# Baby-sitter of the monitor's DPMS\n\nidle_period=60\nss_switch_off=0\nss_is_off=0\n\nwhile true; do\n    # Read DPMS state\n    xset -q|grep \"DPMS is Disabled\" \u003e /dev/null \u0026\u0026 ss_is_off=1 || ss_is_off=0\n    # Get pid of the current window\n    active_window_id=`xprop -root | grep \"_NET_ACTIVE_WINDOW(WINDOW)\" | cut -d\" \" -f5`\n    decimal_id=`xprop -id $active_window_id | grep PID | cut -d\" \" -f3`\n    # Traverse all libflashplayer.so\n    for pid in `ps -ef|grep -v grep|grep libflashplayer.so|awk '{print $2}'`; do\n        # If the current window is libflashplayer.so\n        if [ \"$pid\" -eq \"$decimal_id\" ]; then\n            ss_switch_off=1\n            break\n        else\n            ss_switch_off=0\n        fi\n    done\n    if [ $ss_switch_off -eq 1 ]; then\n        # Turn off DPMS\n        echo Turn off DPMS\n        if [ $ss_is_off -eq 0 ]; then\n            echo Action\n            xset s off\n            xset -dpms\n        fi\n    else\n        # Turn on DPMS\n        echo Turn on DPMS\n        if [ $ss_is_off -eq 1 ]; then\n            echo Action\n            xset +dpms\n            xset s on\n        fi\n    fi\n    sleep $idle_period\ndone\n```\n\n\u003cp\u003e似乎对非全屏播放的情况没有什么好方法。\u003c/p\u003e","title":"禁止屏幕在播放视频时自动关闭"},{"content":"遇到这样一个问题：\n在pygtk.TreeView中，需要在一个Cell的值被修改后做一个校验，如果不合法，则重新聚焦该Cell并选中其中的内容。\n示意代码如下：\n```python # pygtk.CellRenderer的edited事件的回调方法 def onCellEdited(self, cell, path, newText, userData): store,colNum = userData # 使用事件驱动的设计理念，创建一个自定义的事件 evt = ServerTypeChangedEvent(self, cell, usrData) # 事件入队列 EventQueue.fireEvent(evt) # 处理事件队列，如果截获异常，提示并重新聚焦Cell try: EventQueue.processEvents() except Exception,e: self.alert(e.message) col = self.treeView.get_column(colNum-1) # 聚焦Cell，并选中Cell中的内容 self.treeView.set_cursor_on_cell(path, col, cell, True) ``` 关键的代码在最后一行，通过调用TreeView的set_cursor_on_cell方法聚焦Cell并选中其内容。但就是这一步出了问题，报如下警告：\nGtkWarning: _gtk_tree_view_column_start_editing: assertion `tree_column-\u003eeditable_widget == NULL' failed\n此后整个TreeView的行为表现不正常，表现为可直接修改其它Cell的内容，且原Cell一直处于聚焦状态。\n此问题的原因是：edited事件在Cell的输入控件被销毁前就发出了，这时在事件的回调方法中重新聚焦该Cell就导致了这个问题（详见这里）。\n解决方法是借助glib.idle_add函数，在PyGTK空闲的时候再调用set_cursor_on_cell方法，由于此时原控件已被销毁，所以不会有问题。\n修改后的代码如下：\n```python def onCellEdited(self, cell, path, newText, userData): store,colNum = userData evt = ServerTypeChangedEvent(self, cell, usrData) EventQueue.fireEvent(evt) try: EventQueue.processEvents() except Exception,e: self.alert(e.message) col = self.treeView.get_column(colNum-1) #self.treeView.set_cursor_on_cell(path, col, cell, True) import glib glib.idle_add(self.treeView.set_cursor_on_cell, path, col, cell, True) ``` Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/the-focus-issue-of-pygtk-cellrenderer/","summary":"\u003cp\u003e遇到这样一个问题：\u003c/p\u003e\n\n\u003cp\u003e在pygtk.TreeView中，需要在一个Cell的值被修改后做一个校验，如果不合法，则重新聚焦该Cell并选中其中的内容。\u003c/p\u003e\n\n\u003cp\u003e示意代码如下：\u003c/p\u003e\n\n```python\n# pygtk.CellRenderer的edited事件的回调方法\ndef onCellEdited(self, cell, path, newText, userData):\n    store,colNum = userData\n    # 使用事件驱动的设计理念，创建一个自定义的事件\n    evt = ServerTypeChangedEvent(self, cell, usrData)\n\n    # 事件入队列\n    EventQueue.fireEvent(evt)\n    # 处理事件队列，如果截获异常，提示并重新聚焦Cell\n    try:\n        EventQueue.processEvents()\n    except Exception,e:\n        self.alert(e.message)\n        col = self.treeView.get_column(colNum-1)\n        # 聚焦Cell，并选中Cell中的内容\n        self.treeView.set_cursor_on_cell(path, col, cell, True)\n```\n\n\u003cp\u003e关键的代码在最后一行，通过调用TreeView的set_cursor_on_cell方法聚焦Cell并选中其内容。但就是这一步出了问题，报如下警告：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eGtkWarning: _gtk_tree_view_column_start_editing: assertion `tree_column-\u003eeditable_widget == NULL' failed\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e此后整个TreeView的行为表现不正常，表现为可直接修改其它Cell的内容，且原Cell一直处于聚焦状态。\u003c/p\u003e\n\n\u003cp\u003e此问题的原因是：edited事件在Cell的输入控件被销毁前就发出了，这时在事件的回调方法中重新聚焦该Cell就导致了这个问题（\u003cem\u003e详见\u003ca href=\"http://www.gtkforums.com/viewtopic.php?t=4619\"\u003e这里\u003c/a\u003e\u003c/em\u003e）。\u003c/p\u003e\n\n\u003cp\u003e解决方法是借助glib.idle_add函数，在PyGTK空闲的时候再调用set_cursor_on_cell方法，由于此时原控件已被销毁，所以不会有问题。\u003c/p\u003e\n\n\u003cp\u003e修改后的代码如下：\u003c/p\u003e\n\n```python\ndef onCellEdited(self, cell, path, newText, userData):\n    store,colNum = userData\n    evt = ServerTypeChangedEvent(self, cell, usrData)\n\n    EventQueue.fireEvent(evt)\n    try:\n        EventQueue.processEvents()\n    except Exception,e:\n        self.alert(e.message)\n        col = self.treeView.get_column(colNum-1)\n        #self.treeView.set_cursor_on_cell(path, col, cell, True)\n        import glib\n        glib.idle_add(self.treeView.set_cursor_on_cell, path, col, cell, True)\n```\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"关于PyGTK.CellRenderer的回调方法中聚焦异常的问题"},{"content":"零八年底，我用半年的差补收了当时Thinkpad X200顶配的FN3。三年的时间，几乎每天都要用很久，竟然从没掉过链子。虽说是这样，但毕竟用的强度大、时间长，屏幕已经远不如当初清晰，亮度也差了，即使调到最高亮度都觉著暗。\n于是打算趁著还能发挥余热，趁早处理掉，省得将来砸手里。\n既然要换，不如玩儿得折腾一点儿，于是小手一抖，Mac到手。\n我对Mac的OS只是有点小好奇，主要是奔著Mac的外观和做工去的，还是打算回头装Arch。玩儿了四个月，平心而论，Mac OS X确实是个不错的OS，美观程度无与伦比，结合Mac硬件的外观和做工，真是天作之合；易用性之高，确实让我有点小惊讶，多点触摸得心应手，软件安装一拖而就，相比之下，Windows显得拙劣不堪。\n如果只是作为办公和娱乐的工具，Mac可挑剔的地方确实不多。但是易用性往往和灵活性成反比，灵活性高意味著你可以随心所欲地制定自己的游戏规则，而易用性高则往往意味著你只能接受它的方式、认可它的价值观，易用并不代表顺手。\n除此之外就是软件资源的问题，Mac的免费软件相对很少，而且和Windows一样，需要先下载，再安装。虽然也有MacPorts、Homebrew，和Linux的软件仓库比起来还是差得太远。\n做惯了Archer，是可忍，孰不可忍。\n还是要装Arch。但是在制作安装介质这一步就遇著麻烦了，USB启动安装盘死活都不认，试了几种方法，无果。此外还有不少未知的问题，比如驱动等等。\n如果在几年前，在学校，有大把的时间可以糟蹋，我就跟丫死掐了。现在不行了，伤不起了。果断入手Thinkpad X220 A45，上周六把Mac出手了。\n小黑和Arch不愧是天作之合，比起当初在X200上装的时候还容易。只是小黑的多点触摸板啊，东施效颦，我想不到更贴切的词形容了，太TMD坑爹了！\n鉴于X200上4G内存被Chromium吃光光的苦逼经历，这次果断入手两根4G的三星金条，都是党的政策好啊，最近内存白菜价，两根金条才300粮票。\n从宣和八年秋十月到宣和九年春王三月，我的短暂的小白史告一段落，MacBook Pro MC700CH/A，江湖再见！\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/bye-mac/","summary":"\u003cp\u003e零八年底，我用半年的差补收了当时Thinkpad X200顶配的FN3。三年的时间，几乎每天都要用很久，竟然从没掉过链子。虽说是这样，但毕竟用的强度大、时间长，屏幕已经远不如当初清晰，亮度也差了，即使调到最高亮度都觉著暗。\u003c/p\u003e\n\n\u003cp\u003e于是打算趁著还能发挥余热，趁早处理掉，省得将来砸手里。\u003c/p\u003e\n\n\u003cp\u003e既然要换，不如玩儿得折腾一点儿，于是小手一抖，Mac到手。\u003c/p\u003e\n\n\u003cp\u003e我对Mac的OS只是有点小好奇，主要是奔著Mac的外观和做工去的，还是打算回头装Arch。玩儿了四个月，平心而论，Mac OS X确实是个不错的OS，美观程度无与伦比，结合Mac硬件的外观和做工，真是天作之合；易用性之高，确实让我有点小惊讶，多点触摸得心应手，软件安装一拖而就，相比之下，Windows显得拙劣不堪。\u003c/p\u003e\n\n\u003cp\u003e如果只是作为办公和娱乐的工具，Mac可挑剔的地方确实不多。但是易用性往往和灵活性成反比，灵活性高意味著你可以随心所欲地制定自己的游戏规则，而易用性高则往往意味著你只能接受它的方式、认可它的价值观，易用并不代表顺手。\u003c/p\u003e\n\n\u003cp\u003e除此之外就是软件资源的问题，Mac的免费软件相对很少，而且和Windows一样，需要先下载，再安装。虽然也有MacPorts、Homebrew，和Linux的软件仓库比起来还是差得太远。\u003c/p\u003e\n\n\u003cp\u003e做惯了Archer，是可忍，孰不可忍。\u003c/p\u003e\n\n\u003cp\u003e还是要装Arch。但是在制作安装介质这一步就遇著麻烦了，USB启动安装盘死活都不认，试了几种方法，无果。此外还有不少未知的问题，比如驱动等等。\u003c/p\u003e\n\n\u003cp\u003e如果在几年前，在学校，有大把的时间可以糟蹋，我就跟丫死掐了。现在不行了，伤不起了。果断入手Thinkpad X220 A45，上周六把Mac出手了。\u003c/p\u003e\n\n\u003cp\u003e小黑和Arch不愧是天作之合，比起当初在X200上装的时候还容易。只是小黑的多点触摸板啊，东施效颦，我想不到更贴切的词形容了，太TMD坑爹了！\u003c/p\u003e\n\n\u003cp\u003e鉴于X200上4G内存被Chromium吃光光的苦逼经历，这次果断入手两根4G的三星金条，都是党的政策好啊，最近内存白菜价，两根金条才300粮票。\u003c/p\u003e\n\n\u003cp\u003e从宣和八年秋十月到宣和九年春王三月，我的短暂的小白史告一段落，MacBook Pro MC700CH/A，江湖再见！\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"Mac，江湖再见！"},{"content":"NGINX不允许向静态文件提交POST方式的请求，否则报405错误。测试方法为，使用curl向服务器上的静态文件提交POST请求：\n```bash curl -d 1=1 http://localhost/version.txt ``` 得到以下结果： ```html 405 Not Allowed 405 Not Allowed nginx/1.0.11 ``` 网上传抄的添加以下配置的解决办法不可用：\n```nginx error_page 405 =200 @405; location @405 { root /srv/http; } ``` 一种不完美但可用的方法为：\n```nginx upstream static_backend { server localhost:80; } server { listen 80; # ... error_page 405 =200 @405; location @405 { root /srv/http; proxy_method GET; proxy_pass http://static_backend; } } ``` 即转换静态文件接收的POST请求到GET方式。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/nginx-405-not-allowed/","summary":"\u003cp\u003eNGINX不允许向静态文件提交POST方式的请求，否则报405错误。测试方法为，使用curl向服务器上的静态文件提交POST请求：\u003c/p\u003e\n\n```bash\ncurl -d 1=1 http://localhost/version.txt\n```\n\n得到以下结果：\n\n```html\n\u003chtml\u003e\n\u003chead\u003e\u003ctitle\u003e405 Not Allowed\u003c/title\u003e\u003c/head\u003e\n\u003cbody bgcolor=\"white\"\u003e\n\u003ccenter\u003e\u003ch1\u003e405 Not Allowed\u003c/h1\u003e\u003c/center\u003e\n\u003chr\u003e\u003ccenter\u003enginx/1.0.11\u003c/center\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\n\u003cp\u003e网上传抄的添加以下配置的解决办法不可用：\u003c/p\u003e\n\n```nginx\nerror_page 405 =200 @405;\nlocation @405\n{\n    root /srv/http;\n}\n```\n\n\u003cp\u003e一种不完美但可用的方法为：\u003c/p\u003e\n\n```nginx\nupstream static_backend {\n    server localhost:80;\n}\n\nserver {\n    listen 80;\n\n    # ...\n\n    error_page 405 =200 @405;\n    location @405 {\n        root /srv/http;\n        proxy_method GET;\n        proxy_pass http://static_backend;\n    }\n}\n```\n\n\u003cp\u003e即转换静态文件接收的POST请求到GET方式。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"NGINX: 405 Not Allowed"},{"content":"Blueman不能记忆蓝牙的关闭状态，每次登入桌面都会自动打开蓝牙，既费电又不安全。\n一种方法是禁止bluetooth服务自动启动，缺点是使用蓝牙时不方便，还要手工启动bluetooth服务。\n另一种方法是登入桌面后自动关闭蓝牙，即使用如下命令：\n```bash sudo rfkill block bluetooth ``` 但XFCE不能定制自动启动程序的顺序，所以可以写下面这么个脚本，然后添加到自动启动程序列表中：\n```bash #!/bin/bash blueman-applet \u0026 sleep 5 sudo rfkill block bluetooth ``` 当然，还要取消自动启动程序列表中原来的Blueman。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/how-to-disable-bluetooth-after-login-to-xfce/","summary":"\u003cp\u003eBlueman不能记忆蓝牙的关闭状态，每次登入桌面都会自动打开蓝牙，既费电又不安全。\u003c/p\u003e\n\n\u003cp\u003e一种方法是禁止bluetooth服务自动启动，缺点是使用蓝牙时不方便，还要手工启动bluetooth服务。\u003c/p\u003e\n\n\u003cp\u003e另一种方法是登入桌面后自动关闭蓝牙，即使用如下命令：\u003c/p\u003e\n\n```bash\nsudo rfkill block bluetooth\n```\n\n\u003cp\u003e但XFCE不能定制自动启动程序的顺序，所以可以写下面这么个脚本，然后添加到自动启动程序列表中：\u003c/p\u003e\n\n```bash\n#!/bin/bash\n\nblueman-applet \u0026\nsleep 5\nsudo rfkill block bluetooth\n```\n\n\u003cp\u003e当然，还要取消自动启动程序列表中原来的Blueman。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"登入XFCE后自动关闭蓝牙的方法"},{"content":"元旦假期第三天，还是把域名给换了。\n原因主要是.it太贵，年费十几刀，而.org只有它的一半。另外，原来的sinolog.it有点儿长，也显老气，想换个更个性、更短的。\n可惜中意的0xff有主了，只好退而求0x3f。0x3f在ASCII里面代表问号，象征“保持好奇心”。\n按照上次的经验，对著数据库一通改，加上这两年四处沾花惹草，很多网站上的相关信息都得跟著改，长此以往，以后连域名都换不起了。\n好在RSS订阅早已经换成了FeedBurner烧录，只是对于直接用原域名订阅的需要改一下订阅地址了。\n用了几年国家域名，现在也用上国际域名了……\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/enable-the-new-domain-name-0x3f-org/","summary":"\u003cp\u003e元旦假期第三天，还是把域名给换了。\u003c/p\u003e\n\n\u003cp\u003e原因主要是.it太贵，年费十几刀，而.org只有它的一半。另外，原来的sinolog.it有点儿长，也显老气，想换个更个性、更短的。\u003c/p\u003e\n\n\u003cp\u003e可惜中意的0xff有主了，只好退而求0x3f。0x3f在ASCII里面代表问号，象征“\u003cstrong\u003e保持好奇心\u003c/strong\u003e”。\u003c/p\u003e\n\n\u003cp\u003e按照\u003ca href=\"http://0x3f.org/?p=1356\"\u003e上次\u003c/a\u003e的\u003ca href=\"http://0x3f.org/?p=1359\"\u003e经验\u003c/a\u003e，对著数据库一通改，加上这两年四处沾花惹草，很多网站上的相关信息都得跟著改，长此以往，以后连域名都换不起了。\u003c/p\u003e\n\n\u003cp\u003e好在RSS订阅早已经换成了FeedBurner烧录，只是对于直接用原域名订阅的需要改一下订阅地址了。\u003c/p\u003e\n\n\u003cp\u003e用了几年国家域名，现在也用上国际域名了……\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"启用新域名0x3f.org"},{"content":"几年没读过小说了，上次读刘慈欣的《球状闪电》还是在学校的时候，多年后再次读小说的感觉怪怪的，有点陌生，也没有激情。虽然早就知道这部书，一直没看，现在终于利用零散时间在Kindle上读完了它。\n我不是个科幻迷，但也觉得这部书写得挺好。有悬念，立意新颖，尤其是据说在后两部里干脆把地球给写毁灭了！我要接著往下看。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/after-reading-three-body/","summary":"\u003cp\u003e几年没读过小说了，上次读刘慈欣的《球状闪电》还是在学校的时候，多年后再次读小说的感觉怪怪的，有点陌生，也没有激情。虽然早就知道这部书，一直没看，现在终于利用零散时间在Kindle上读完了它。\u003c/p\u003e\n\n\u003cp\u003e我不是个科幻迷，但也觉得这部书写得挺好。有悬念，立意新颖，尤其是据说在后两部里干脆把地球给写毁灭了！我要接著往下看。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/EIq6agpaM9dZfrvj5rJ6JtMTjNZETYmyPJy0liipFm0?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh4.googleusercontent.com/-QJIQjYJ85sQ/Tu34YO-SubI/AAAAAAAAB2Y/AEZCJDQHzwA/s400/Threebody.jpg\" height=\"400\" width=\"277\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"读完《三体》"},{"content":"作者对Vim很有心得，分享了很多好的经验。这本书于新手可以用来入门，于老手也多有可取之处，是本学习Vim很不错的参考书。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/after-reading-hacking-vim72/","summary":"\u003cp\u003e作者对Vim很有心得，分享了很多好的经验。这本书于新手可以用来入门，于老手也多有可取之处，是本学习Vim很不错的参考书。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/EDVN2_nwQ4XWPoqe83VGpNMTjNZETYmyPJy0liipFm0?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/-ezfYjiMqrrs/TtJnWRhKHzI/AAAAAAAAB14/hCidRx_DLj4/s400/cover.jpg\" height=\"400\" width=\"309\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"读完《Hacking Vim7.2》"},{"content":"两年前我曾在Vim邮件列表里问怎样高亮配对的HTML标签，但没能解决。今天意外收到一封邮件，Linqq童鞋在StackOverflow上问了同样的问题，有人就写了这个插件。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/highlighting-paired-html-tags-using-matchtag-vim/","summary":"\u003cp\u003e两年前我曾在\u003ca href=\"http://vim.1045645.n5.nabble.com/How-can-Vim-highlight-the-matching-tag-when-I-put-the-cursor-on-the-other-one-in-a-pair-of-tags-td1177554.html\"\u003eVim邮件列表\u003c/a\u003e里问怎样高亮配对的HTML标签，但没能解决。今天意外收到一封邮件，Linqq童鞋在\u003ca href=\"http://stackoverflow.com/questions/8168320/can-vim-highlight-matching-html-tags-like-notepad\"\u003eStackOverflow\u003c/a\u003e上问了同样的问题，有人就写了这个\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=3818\"\u003e插件\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/wGB584-nLWrQRHCQ7qgADdMTjNZETYmyPJy0liipFm0?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/-ojoHK5ST944/Ts0QmwHOCXI/AAAAAAAAB1Q/ye0ko4Ob-gc/s800/2011-11-23.22%25253A40%25253A58.%2525E6%252593%2525B7%2525E5%25258F%252596%2525E9%252581%2525B8%2525E5%25258F%252596%2525E5%25258D%252580%2525E5%25259F%25259F.01.png\" height=\"103\" width=\"268\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"MatchTag.vim: 高亮配对的HTML标签"},{"content":"这是最好的时代，这是最坏的时代。现在还有像人人影视的BT种子FTP这样的站点，实在不容易。但是所有种子列在一块，想看看最近几天都更新了甚么都很困难，于是早想写个脚本省时省力。这周末终于实现了这个想法。\n主要功能 按关键词查询种子 限制查询范围为最近几天新增的 下载符合查询条件的种子，允许下载前编辑任务列表 使用说明 环境 Python 2.7，不支持Python3 Mac OS X Lion，Archlinux测试通过，理论上支持Windows 配置 如果需要编辑下载任务列表（即使用-s选项），应事先配置环境变量YYETS_EDITOR，将值设定为一个文本编辑器的路径，或者修改脚本的私有属性__editor__也一样。如果这两个位置都没有设置，则使用环境变量EDITOR。否则，将报“Command not found”的错误。\n有一点提示，如果使用GVim或MacVim，需要加上选项-f，以阻塞的方式启动它，否则会导致下载结果不能达到预期。例如对于MacVim，可配置YYETS_EDITOR为：\nmvim -f\n使用举例 ```bash # 列出所有种子 ./yyets.py # 搜索关键词 ./yyets.py 猩球崛起 1080p # 搜索最近三天新增的种子 ./yyets.py --past=3 # 搜索最近七天内新增的、满足关键词条件的种子 ./yyets.py --past=7 蓝精灵 # 下载满足查询条件的种子 ./yyets.py -d --past=30 1080p # 下载满足查询条件的种子，下载前编辑任务列表 ./yyets.py -d -p --past=30 1080p # 更多详细信息，参阅帮助 ./yyets.py -h ./yyets.py --help ``` 下载 移步GitHub获取最新版本：\nhttps://github.com/xbot/shell\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/yyets-torrents-download-script/","summary":"\u003cp\u003e这是最好的时代，这是最坏的时代。现在还有像\u003ca href=\"ftp://zhongzi.yyets.net\"\u003e人人影视的BT种子FTP\u003c/a\u003e这样的站点，实在不容易。但是所有种子列在一块，想看看最近几天都更新了甚么都很困难，于是早想写个脚本省时省力。这周末终于实现了这个想法。\u003c/p\u003e\n\n\u003ch2\u003e主要功能\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e按关键词查询种子\u003c/li\u003e\n\u003cli\u003e限制查询范围为最近几天新增的\u003c/li\u003e\n\u003cli\u003e下载符合查询条件的种子，允许下载前编辑任务列表\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e使用说明\u003c/h2\u003e\n\n\u003ch3\u003e环境\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003ePython 2.7，不支持Python3\u003c/li\u003e\n\u003cli\u003eMac OS X Lion，Archlinux测试通过，理论上支持Windows\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e配置\u003c/h3\u003e\n\n\u003cp\u003e如果需要编辑下载任务列表（\u003cem\u003e即使用-s选项\u003c/em\u003e），应事先配置环境变量\u003cstrong\u003eYYETS_EDITOR\u003c/strong\u003e，将值设定为一个文本编辑器的路径，或者修改脚本的私有属性\u003cstrong\u003e__editor__\u003c/strong\u003e也一样。如果这两个位置都没有设置，则使用环境变量\u003cstrong\u003eEDITOR\u003c/strong\u003e。否则，将报“\u003cstrong\u003eCommand not found\u003c/strong\u003e”的错误。\u003c/p\u003e\n\n\u003cp\u003e有一点提示，如果使用GVim或MacVim，需要加上选项\u003cstrong\u003e-f\u003c/strong\u003e，以阻塞的方式启动它，否则会导致下载结果不能达到预期。例如对于MacVim，可配置\u003cstrong\u003eYYETS_EDITOR\u003c/strong\u003e为：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003emvim -f\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch3\u003e使用举例\u003c/h3\u003e\n\n```bash\n# 列出所有种子\n./yyets.py\n\n# 搜索关键词\n./yyets.py 猩球崛起 1080p\n\n# 搜索最近三天新增的种子\n./yyets.py --past=3\n\n# 搜索最近七天内新增的、满足关键词条件的种子\n./yyets.py --past=7 蓝精灵\n\n# 下载满足查询条件的种子\n./yyets.py -d --past=30 1080p\n\n# 下载满足查询条件的种子，下载前编辑任务列表\n./yyets.py -d -p --past=30 1080p\n\n# 更多详细信息，参阅帮助\n./yyets.py -h\n./yyets.py --help\n```\n\n\u003ch3\u003e下载\u003c/h3\u003e\n\n\u003cp\u003e移步GitHub获取最新版本：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/xbot/shell\"\u003ehttps://github.com/xbot/shell\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"YYeTs.py：人人影视BT种子下载辅助脚本"},{"content":"花了大约一周的时间，周日晚上读完《Pro Git》的最后几页。\n高效、安全的分布式和强大的分枝合并是Git的杀手级特性，这本书在语言上浅显易懂、简明扼要，在章节安排上循序渐进，在内容讲解上有较深入的挖掘，当属眼下Git方面最好的教材。此外，这本书的中译水平也很高，必要的地方还有译注，能看出译者不是外行。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/after-reading-pro-git/","summary":"\u003cp\u003e花了大约一周的时间，周日晚上读完\u003ca href=\"http://progit.org\"\u003e《Pro Git》\u003c/a\u003e的最后几页。\u003c/p\u003e\n\n\u003cp\u003e高效、安全的分布式和强大的分枝合并是Git的杀手级特性，这本书在语言上浅显易懂、简明扼要，在章节安排上循序渐进，在内容讲解上有较深入的挖掘，当属眼下Git方面最好的教材。此外，这本书的中译水平也很高，必要的地方还有译注，能看出译者不是外行。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/RuILnzirn3HwuJzk5Wp2Zw?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh4.googleusercontent.com/-JaRvkCJzpFE/Tr_4ifkfXMI/AAAAAAAAB0w/K_4h24C2fis/s800/A9781430218333-3d_6.png\" height=\"350\" width=\"277\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"读完《Pro Git》"},{"content":"距离上一个版本的释出已经有三个月了，这次新版并没有增加多少功能性的内容，主要是代码的重构和对在MacVim下稳定性的改进。\n对依赖关系检查的不细致导致了一些麻烦，抛出的错误信息有时与实际原因相距甚远。由于开始时是以实现功能为主，所以都是直接用函数实现的，之后修修补补，代码冗余而且维护麻烦。于是著手重构主要功能的源码，面向对象，把所有检查逻辑放到父类中去实现，子类只关注自身逻辑，最后新版减少了二百多行的代码量。\n在重构的过程中偶然发现，在MacVim中，程序抛出任何异常，即便是有捕获逻辑，也会导致编辑器崩溃。在这里简略地提到：\nthe failure was actual a crash, through some strange combination of threading, matplotlib pyplot backend, and ssh X11 forwarding, sys.stderr had somehow been assigned to something which python complained wasn't a file-like object\n于是将所有标准输出与标准错误输出语句换成另一种形式：\n```python # 原形式 sys.stdout.write('xxx') sys.stderr.write('xxx') # 新形式 print \u003e\u003e sys.stdout, 'xxx' print \u003e\u003e sys.stderr, 'xxx' ``` 以上是新版主要变更的内容，此外，也顺便解决了开发过程中发现的个别Bug和做了其它一些改动：\nChange: The key \"xmlrpc\" of the settings list is dropped, a new one with the name \"url\" is added, you should set its value to the blog url. Change: Source code refactorings. Change: Solve the crash problem existing in MacVim only. Change: :UBConv can be used in any buffer. Change: :UBThis now has a third parameter, which enables convertions between syntaxes. Bugfix: The second parameter of :UBThis cannot take effect. 这也是将源码从Google Code迁移到GitHub后发布的第一个新版本，更详细的信息请移步插件主页或GitHub上的代码仓库。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-v310-released/","summary":"\u003cp\u003e距离上一个版本的释出已经有三个月了，这次新版并没有增加多少功能性的内容，主要是代码的重构和对在MacVim下稳定性的改进。\u003c/p\u003e\n\n\u003cp\u003e对依赖关系检查的不细致导致了一些麻烦，抛出的错误信息有时与实际原因相距甚远。由于开始时是以实现功能为主，所以都是直接用函数实现的，之后修修补补，代码冗余而且维护麻烦。于是著手重构主要功能的源码，面向对象，把所有检查逻辑放到父类中去实现，子类只关注自身逻辑，最后新版减少了二百多行的代码量。\u003c/p\u003e\n\n\u003cp\u003e在重构的过程中偶然发现，在MacVim中，程序抛出任何异常，即便是有捕获逻辑，也会导致编辑器崩溃。在\u003ca href=\"http://stackoverflow.com/questions/5574702/how-to-print-to-stderr-in-python\"\u003e这里\u003c/a\u003e简略地提到：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003ethe failure was actual a crash, through some strange combination of threading, matplotlib pyplot backend, and ssh X11 forwarding, sys.stderr had somehow been assigned to something which python complained wasn't a file-like object\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e于是将所有标准输出与标准错误输出语句换成另一种形式：\u003c/p\u003e\n\n```python\n# 原形式\nsys.stdout.write('xxx')\nsys.stderr.write('xxx')\n\n# 新形式\nprint \u003e\u003e sys.stdout, 'xxx'\nprint \u003e\u003e sys.stderr, 'xxx'\n```\n\n\u003cp\u003e以上是新版主要变更的内容，此外，也顺便解决了开发过程中发现的个别Bug和做了其它一些改动：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eChange:  The key \"xmlrpc\" of the settings list is dropped, a new one with the name \"url\" is added, you should set its value to the blog url.\u003c/li\u003e\n\u003cli\u003eChange:  Source code refactorings.\u003c/li\u003e\n\u003cli\u003eChange:  Solve the crash problem existing in MacVim only.\u003c/li\u003e\n\u003cli\u003eChange:  \u003cstrong\u003e:UBConv\u003c/strong\u003e can be used in any buffer.\u003c/li\u003e\n\u003cli\u003eChange:  \u003cstrong\u003e:UBThis\u003c/strong\u003e now has a third parameter, which enables convertions between syntaxes.\u003c/li\u003e\n\u003cli\u003eBugfix:  The second parameter of \u003cstrong\u003e:UBThis\u003c/strong\u003e cannot take effect.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e这也是将源码从Google Code迁移到GitHub后发布的第一个新版本，更详细的信息请移步\u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003e插件主页\u003c/a\u003e或GitHub上的\u003ca href=\"https://github.com/xbot/UltraBlog.vim\"\u003e代码仓库\u003c/a\u003e。\u003c/p\u003e","title":"UltraBlog.vim v3.1释出：代码重构与MacVim支持"},{"content":"由于Total Commander很贵，在Windows下又是必不可少的，我一直希望能找到一个TC的免费替代品。试用过很多免费的文件管理器，但都不理想。偶然看到Double Commander，才发现这几乎完全就是我想要的。\n特性 几乎完全模仿TC，甚至连插件的API都一致 界面布局、样式高度可定制 热键高度可定制 开源、免费、跨平台 局限 功能相对TC少很多 稳定性不是非常高 运行速度稍嫌慢 开发进度慢 小技巧 热键设置 每个内置命令可以设置多个热键，每个热键可以指定参数，参数中可以使用环境变量，如下图所示：\n针对命令cm_ChangeDir设置了两个热键，其中，给Ctrl+Home指定的参数是$HOME，给Ctrl+Shift+Home指定的参数是$HOME/Desktop，即分别切换到当前用户的主目录和桌面目录。\n自定义文件类型命令 可以为每种文件类型定义多个命令，这些自定义命令将显示为上下文菜单的“动作”菜单的子菜单项。如下图所示：\n定义了名称为“Archive”的文件类型，关联了一系列的文件后缀名。然后添加了一个名为“解压缩到当前目录”的动作，并指定所执行的命令为urxvt -e aunpack %f。其中，%f是一个占位符，代表当前文件的全名。DC预置了几个占位符，可以点击命令输入框右侧图标是加号的按钮选择。\n最终的效果如下：\n解决日期时间乱码的问题 截至版本0.5.0 beta，如果设置了使用日期时间字符串的格式为“yyyy-mm-dd hh:mm:ss”，在zh_CN.UTF-8的区域设置下，字符串中将出现乱码：\n临时解决办法是以英文区域设置启动doublecmd：\n```bash #!/bin/bash export LC_ALL=en_US.UTF-8 doublecmd \u0026 ``` Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/double-commander/","summary":"\u003cp\u003e由于Total Commander很贵，在Windows下又是必不可少的，我一直希望能找到一个TC的免费替代品。试用过很多免费的文件管理器，但都不理想。偶然看到\u003ca href=\"http://doublecmd.sourceforge.net/\"\u003eDouble Commander\u003c/a\u003e，才发现这几乎完全就是我想要的。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/ioR_w9MmX81q_5a8xjUPsA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh4.googleusercontent.com/-gkI4K4m5SSM/Tl31NceNNhI/AAAAAAAABzs/3AigwSN7whI/s640/doublecmd_screenshot.png\" height=\"360\" width=\"640\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e特性\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e几乎完全模仿TC，甚至连插件的API都一致\u003c/li\u003e\n\u003cli\u003e界面布局、样式高度可定制\u003c/li\u003e\n\u003cli\u003e热键高度可定制\u003c/li\u003e\n\u003cli\u003e开源、免费、跨平台\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e局限\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e功能相对TC少很多\u003c/li\u003e\n\u003cli\u003e稳定性不是非常高\u003c/li\u003e\n\u003cli\u003e运行速度稍嫌慢\u003c/li\u003e\n\u003cli\u003e开发进度慢\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e小技巧\u003c/h2\u003e\n\n\u003ch3\u003e热键设置\u003c/h3\u003e\n\n\u003cp\u003e每个内置命令可以设置多个热键，每个热键可以指定参数，参数中可以使用环境变量，如下图所示：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/Z3jLMCGkoAbs1XC6yOhElg?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/-lFMDaSny_gw/Tl31OKrfhMI/AAAAAAAABzs/2XX44Go-3zc/s640/doublecmd_hotkey.png\" height=\"417\" width=\"640\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e针对命令\u003ccode\u003ecm_ChangeDir\u003c/code\u003e设置了两个热键，其中，给\u003cstrong\u003eCtrl+Home\u003c/strong\u003e指定的参数是\u003cstrong\u003e$HOME\u003c/strong\u003e，给\u003cstrong\u003eCtrl+Shift+Home\u003c/strong\u003e指定的参数是\u003cstrong\u003e$HOME/Desktop\u003c/strong\u003e，即分别切换到当前用户的主目录和桌面目录。\u003c/p\u003e\n\n\u003ch3\u003e自定义文件类型命令\u003c/h3\u003e\n\n\u003cp\u003e可以为每种文件类型定义多个命令，这些自定义命令将显示为上下文菜单的“动作”菜单的子菜单项。如下图所示：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/m7mjk4g77XsMZw58ayJnEw?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/-4Z6LcQg9YIc/Tl31OqcRqKI/AAAAAAAABzs/wJjK8noUWM8/s400/doublecmd_filetype_command_01.png\" height=\"400\" width=\"376\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e定义了名称为“Archive”的文件类型，关联了一系列的文件后缀名。然后添加了一个名为“解压缩到当前目录”的动作，并指定所执行的命令为\u003ccode\u003eurxvt -e aunpack %f\u003c/code\u003e。其中，\u003cstrong\u003e%f\u003c/strong\u003e是一个占位符，代表当前文件的全名。DC预置了几个占位符，可以点击命令输入框右侧图标是加号的按钮选择。\u003c/p\u003e\n\n\u003cp\u003e最终的效果如下：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/mXYVL8uX1TNw0ENFur1PUQ?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/-smFkdYyLMHE/Tl31QAWMNXI/AAAAAAAABzs/hIBW-yVpBuQ/s400/doublecmd_filetype_command_02.png\" height=\"236\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e解决日期时间乱码的问题\u003c/h3\u003e\n\n\u003cp\u003e截至版本0.5.0 beta，如果设置了使用日期时间字符串的格式为“yyyy-mm-dd hh:mm:ss”，在\u003cstrong\u003ezh_CN.UTF-8\u003c/strong\u003e的区域设置下，字符串中将出现乱码：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/gMOlqF5DOQQ5otUEBon7lA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/-LfvO5yBH_F0/Tl3_d13FCNI/AAAAAAAAB0A/MHApuvTvkSg/s400/doublecmd_datetime_illegle_char.png\" height=\"400\" width=\"168\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e临时解决办法是以英文区域设置启动doublecmd：\u003c/p\u003e\n\n```bash\n#!/bin/bash\n\nexport LC_ALL=en_US.UTF-8\ndoublecmd \u0026\n```\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"Double Commander: 免费、跨平台的Total Commander"},{"content":"Templates make it possible for users previewing posts in custom formats in UltraBlog.vim. However, there is more you can do with our highly customizable templates. This article discusses how to highlight code snippets in posts by the use of some third-party open-source tools.\nBefore setting out to work, let me introduce the tools we are about to use:\nhighlight.js: A javascript library which highlights code blocks in web pages automatically. jquery: The famous RIA development javascript library. Download the upper two libraries and put them under any folder accessible to your webbrowser, in my case, it is /home/lenin/.vim/bundle/ultrablog/vendor/.\nThen open UltraBlog.vim and edit the template you are using, put the following lines in the \u0026lt;head\u0026gt;...\u0026lt;/head\u0026gt; area:\n```xml ``` If you are using the default template UltraBlog.vim supplies, change .title to .postTitle in the pre-defined \u0026lt;style\u0026gt;...\u0026lt;/style\u0026gt; area, and change the class name of the div element in the \u0026lt;body\u0026gt;...\u0026lt;/body\u0026gt; area from title to postTitle, that is because this class name is also used by highlight.js.\nAn important point, the jquery selector I used in the code snippet above selects every \u0026lt;pre\u0026gt;...\u0026lt;/pre\u0026gt; element and copies the value of its attribute lang to class. This is specified for the wordpress plugin wp-syntax I use. If you use another syntax highlighting tool which uses different markup for code blocks, you should modify the code above to make highlight.js find code blocks correctly.\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/enable-code-snippet-highlighting-for-ultrablog-vim-templates/","summary":"\u003cp\u003eTemplates make it possible for users previewing posts in custom formats in \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e. However, there is more you can do with our highly customizable templates. This article discusses how to highlight code snippets in posts by the use of some third-party open-source tools.\u003c/p\u003e\n\n\u003cp\u003eBefore setting out to work, let me introduce the tools we are about to use:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://softwaremaniacs.org/soft/highlight/en/\"\u003ehighlight.js\u003c/a\u003e: A javascript library which highlights code blocks in web pages automatically.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://jquery.com/\"\u003ejquery\u003c/a\u003e: The famous RIA development javascript library.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eDownload the upper two libraries and put them under any folder accessible to your webbrowser, in my case, it is \u003cstrong\u003e/home/lenin/.vim/bundle/ultrablog/vendor/\u003c/strong\u003e.\u003c/p\u003e","title":"Enable Code Snippet Highlighting For UltraBlog.vim Templates"},{"content":"RandR是对X11的一个扩展协议，允许在不重启X的情况下修改输出的一些参数并使之生效，xrandr是该协议的命令行界面，它的功能之一就是用来设置双屏显示。\n缺省情况下，外接显示器后启用的是屏幕复制模式，即两个屏幕显示完全相同的内容。使用命令xrandr -q查看当前的输出状态：\nScreen 0: minimum 320 x 200, current 1920 x 1080, maximum 8192 x 8192 LVDS1 connected 1280x800+0+0 (normal left inverted right x axis y axis) 261mm x 163mm 1280x800 60.0+ 60.0 50.0 1024x768 75.1 70.1 60.0 800x600 72.2 75.0 60.3 56.2 768x576 75.0 72.0 60.0 640x480 72.8 75.0 60.0 59.9 VGA1 connected 1920x1080+0+0 (normal left inverted right x axis y axis) 509mm x 286mm 1920x1080 60.0+ 1680x1050 60.0 1280x1024 75.0 60.0 1440x900 59.9 1280x960 60.0 1024x768 75.1 70.1 60.0 832x624 74.6 800x600 72.2 75.0 60.3 56.2 640x480 72.8 75.0 66.7 60.0 720x400 70.1 HDMI1 disconnected (normal left inverted right x axis y axis) DP1 disconnected (normal left inverted right x axis y axis) HDMI2 disconnected (normal left inverted right x axis y axis) DP2 disconnected (normal left inverted right x axis y axis) DP3 disconnected (normal left inverted right x axis y axis)\n可见，笔记本电脑的屏幕输出（LVDS1）的显示分辨率是1280x800，外接显示器的输出（VGA1）的分辨率是1920x1080。两个输出在整个虚拟屏幕（名称：Screen 0；当前大小：1920x1080；最大：8192x8192）上的坐标都是+0+0。所以在外接显示器中可以看到屏幕左上角有一个1280x800分辨率的小屏幕。\n屏幕复制模式最常用于外接投影仪，现在我需要两个屏幕分别显示在各自的显示器中，并在两个屏幕中显示不同的内容（也就是Windows下设置双屏显示时选择的扩展模式）。\n由于我将笔记本电脑放在外接显示器的左边，所以为了操作的自然，使用命令xrandr --output VGA1 --right-of LVDS1将外接显示器的输出在虚拟屏幕上的位置设置在笔记本电脑的输出的右边，示意图如下：\n这样，两个显示器中就可以显示不同的内容了。由于属于同一个虚拟屏幕，当然也可以将一个窗口跨过边界从一个显示器拖到另一个显示器中。再使用命令xrandr -q查看现在的输出状态：\nScreen 0: minimum 320 x 200, current 3200 x 1080, maximum 8192 x 8192 LVDS1 connected 1280x800+0+0 (normal left inverted right x axis y axis) 261mm x 163mm 1280x800 60.0+ 60.0 50.0 1024x768 75.1 70.1 60.0 800x600 72.2 75.0 60.3 56.2 768x576 75.0 72.0 60.0 640x480 72.8 75.0 60.0 59.9 VGA1 connected 1920x1080+1280+0 (normal left inverted right x axis y axis) 509mm x 286mm 1920x1080 60.0+ 1680x1050 60.0 1280x1024 75.0 60.0 1440x900 59.9 1280x960 60.0 1024x768 75.1 70.1 60.0 832x624 74.6 800x600 72.2 75.0 60.3 56.2 640x480 72.8 75.0 66.7 60.0 720x400 70.1 HDMI1 disconnected (normal left inverted right x axis y axis) DP1 disconnected (normal left inverted right x axis y axis) HDMI2 disconnected (normal left inverted right x axis y axis) DP2 disconnected (normal left inverted right x axis y axis) DP3 disconnected (normal left inverted right x axis y axis)\n使用xrandr做的设置只对当前的X会话有效，重启后恢复原样。使设置持久化的方法为修改xorg.conf或设置自动执行命令。据说有一些图形界面封装的xrandr的前端，完善的桌面环境如GNOME和KDE应该也是可以在图形界面中设置的，不过我所使用的XFCE目前似乎只能启用/禁用复制模式，而不支持在图形界面中设置扩展模式。\n下面的脚本用来简化双屏显示的设置：\n```bash #!/bin/bash # Restart trayer and cairo-dock which I use on my desktop restart_widget() { killall trayer killall cairo-dock # Another script which starts trayer and set some options mytrayer cairo-dock \u0026 } set_dualhead() { xrandr --output LVDS1 --auto xrandr --output VGA1 --auto xrandr --output VGA1 --right-of LVDS1 restart_widget } set_lvds() { xrandr --output VGA1 --off xrandr --output LVDS1 --auto restart_widget } set_vga() { xrandr --output LVDS1 --off xrandr --output VGA1 --auto restart_widget } if [ $# -eq 0 ]; then set_dualhead exit fi case \"$1x\" in \"lvdsx\") set_lvds;; \"vgax\") set_vga;; *) echo 'Unknown parameter !';; esac ``` Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/dualhead-display-on-linux/","summary":"\u003cp\u003eRandR是对X11的一个扩展协议，允许在不重启X的情况下修改输出的一些参数并使之生效，xrandr是该协议的命令行界面，它的功能之一就是用来设置双屏显示。\u003c/p\u003e\n\n\u003cp\u003e缺省情况下，外接显示器后启用的是屏幕复制模式，即两个屏幕显示完全相同的内容。使用命令\u003ccode\u003exrandr -q\u003c/code\u003e查看当前的输出状态：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eScreen 0: minimum 320 x 200, current 1920 x 1080, maximum 8192 x 8192\n  LVDS1 connected 1280x800+0+0 (normal left inverted right x axis y axis) 261mm x 163mm\n    1280x800       60.0\u003cem\u003e+   60.0     50.0 \u003cbr /\u003e\n    1024x768       75.1     70.1     60.0 \u003cbr /\u003e\n    800x600        72.2     75.0     60.3     56.2 \u003cbr /\u003e\n    768x576        75.0     72.0     60.0 \u003cbr /\u003e\n    640x480        72.8     75.0     60.0     59.9 \u003cbr /\u003e\n  VGA1 connected 1920x1080+0+0 (normal left inverted right x axis y axis) 509mm x 286mm\n    1920x1080      60.0\u003c/em\u003e+\n    1680x1050      60.0 \u003cbr /\u003e\n    1280x1024      75.0     60.0 \u003cbr /\u003e\n    1440x900       59.9 \u003cbr /\u003e\n    1280x960       60.0 \u003cbr /\u003e\n    1024x768       75.1     70.1     60.0 \u003cbr /\u003e\n    832x624        74.6 \u003cbr /\u003e\n    800x600        72.2     75.0     60.3     56.2 \u003cbr /\u003e\n    640x480        72.8     75.0     66.7     60.0 \u003cbr /\u003e\n    720x400        70.1 \u003cbr /\u003e\n  HDMI1 disconnected (normal left inverted right x axis y axis)\n  DP1 disconnected (normal left inverted right x axis y axis)\n  HDMI2 disconnected (normal left inverted right x axis y axis)\n  DP2 disconnected (normal left inverted right x axis y axis)\n  DP3 disconnected (normal left inverted right x axis y axis)\u003c/p\u003e","title":"Linux下双屏显示的设置"},{"content":"用了一周的业余时间，昨天我释出了UltraBlog.vim的3.0版。新版本主要加入了全文检索的功能，并引入事件驱动的模式。\n全文检索是我蓄谋已久的功能，一个不能搜索的博客客户端的管理功能是大打折扣的。得益于SQLite数据库和SQLAlchemy框架，全文检索的实现是很简单的，新增加的:UBFind命令将在所有文章和页面的标题与内容中查询，并将搜索结果显示在一个可分页的列表中。这个命令支持任意多个关键词，各关键词之间遵循与的关系。此外，检索结果中，所有的关键词将被自动标记为高亮。\n事件驱动模式的引入是我悍然将版本号跳跃到3.x的主要原因。\n在前几个版本中，我实现了对多窗口的支持，它使得用户可以在新窗口中打开列表中的文章。但UltraBlog.vim最初开发的时候并没有考虑到多窗口的问题，所有命令都只针对当前窗口进行操作。这就有了缓冲区内容同步的问题，假如在一个新的缓冲区中打开了和另一个缓冲区相同的文章，则一个缓冲区内容的改变不会同步到另外一个中，这多少是有些隐患的。\n最直接的做法是在所有可能改变缓冲区内容的功能中加入对其它缓冲区的处理，但这样做有不少问题：\n代码耦合度太高，违反K.I.S.S原则，不利于今后的开发和维护 函数体过长，我讨厌难看的代码 代码冗余，重复劳动 事件驱动模式可以很好的解决以上问题，一个函数只干一件事，做完后一个事件抛出去，至于连带著要做什么，谁监听这个事件谁去处理，代码的耦合度很低，复用度很高，易于维护和阅读。\nUltraBlog.vim引入事件驱动模式处理缓冲区同步的问题。不同的操作抛出不同的事件，所有的事件继承自父类UBEvent：\n```python class UBEvent: def __init__(self, srcObj): self.srcObj = srcObj class UBDebugEvent(UBEvent): pass class UBTmplDelEvent(UBEvent): pass class UBTmplSaveEvent(UBEvent): pass class UBLocalPostDelEvent(UBEvent): pass class UBRemotePostDelEvent(UBEvent): pass class UBPostSendEvent(UBEvent): pass class UBPostSaveEvent(UBEvent): pass ``` 一个可能改变缓冲区内容的操作执行完后，创建一个特定的事件并将其加入到事件队列中。事件队列类中存放两个列表，一是事件队列，二是事件监听器列表；提供三个方法，分别用来注册事件监听器、对事件执行入队列操作和处理队列中所有事件：\n```python class UBEventQueue: queue = [] listeners = [] @classmethod def fireEvent(cls, evt): cls.queue.append(evt) @classmethod def processEvents(cls): for evt in cls.queue: for listener in cls.listeners: if listener.isTarget(evt): cls.queue.remove(evt) listener.processEvent(evt) @classmethod def registerListener(cls, lsnr): cls.listeners.append(lsnr) ``` 事件队列对事件的处理是通过事件监听器进行的，每个事件监听器要实现两个功能：识别监听对象和处理监听对象。所有具体事件的监听类都是UBListener的子类：\n```python class UBListener(): ''' Parent class of all listeners ''' eventType = None @classmethod def isTarget(cls, evt): return isinstance(evt, cls.eventType) @staticmethod def processEvent(evt): pass class UBPostSaveListener(UBListener): ''' Listener for saving posts/pages 1. Refresh the current view if it is an edit/list view of this post 2. Mark all edit/list views of posts/pages outdated ''' eventType = UBPostSaveEvent @staticmethod def processEvent(evt): for nr in ub_get_buffers(['post_edit','page_edit']): if evt.srcObj==ub_get_meta('id', nr): if nr==ub_get_bufnr('%'): ub_refresh_current_view() else: ub_set_view_outdated(nr) for nr in ub_get_buffers(['post_list','page_list','search_result_list']): if nr == ub_get_bufnr('%'): ub_refresh_current_view() else: ub_set_view_outdated(nr) ``` 事件监听器遍历所有满足处理条件的缓冲区，对当前缓冲区，立即刷新，其余的标记为已过期。同时利用Vim自身的事件驱动特性，在进入已过期的缓冲区时，再更新之，也就是传说中的懒加载模式：\n```vim au BufEnter * py __ub_on_buffer_enter() ``` ```python @__ub_exception_handler def __ub_on_buffer_enter(): ''' Triggered by BufEnter event, check if the buffer is outdated ''' if ub_is_view_outdated('%'): ub_refresh_current_view() ub_set_view_outdated('%', False) ``` 此外，随著代码量的增加，原来把全部代码都放在一个文件中的做法不再适用，尤其是以Here Document形式存放在vim脚本文件中的Python代码不能被ctags识别，所以按类别分别存放到$VIMRUNTIME/plugin/ultrablog/下的几个Python源文件中。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-v300-released/","summary":"\u003cp\u003e用了一周的业余时间，昨天我释出了\u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e的3.0版。新版本主要加入了全文检索的功能，并引入事件驱动的模式。\u003c/p\u003e\n\n\u003cp\u003e全文检索是我蓄谋已久的功能，一个不能搜索的博客客户端的管理功能是大打折扣的。得益于SQLite数据库和SQLAlchemy框架，全文检索的实现是很简单的，新增加的\u003ccode\u003e:UBFind\u003c/code\u003e命令将在所有文章和页面的标题与内容中查询，并将搜索结果显示在一个可分页的列表中。这个命令支持任意多个关键词，各关键词之间遵循与的关系。此外，检索结果中，所有的关键词将被自动标记为高亮。\u003c/p\u003e\n\n\u003cp\u003e事件驱动模式的引入是我悍然将版本号跳跃到3.x的主要原因。\u003c/p\u003e\n\n\u003cp\u003e在前几个版本中，我实现了对多窗口的支持，它使得用户可以在新窗口中打开列表中的文章。但UltraBlog.vim最初开发的时候并没有考虑到多窗口的问题，所有命令都只针对当前窗口进行操作。这就有了缓冲区内容同步的问题，假如在一个新的缓冲区中打开了和另一个缓冲区相同的文章，则一个缓冲区内容的改变不会同步到另外一个中，这多少是有些隐患的。\u003c/p\u003e\n\n\u003cp\u003e最直接的做法是在所有可能改变缓冲区内容的功能中加入对其它缓冲区的处理，但这样做有不少问题：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e代码耦合度太高，违反K.I.S.S原则，不利于今后的开发和维护\u003c/li\u003e\n\u003cli\u003e函数体过长，我讨厌难看的代码\u003c/li\u003e\n\u003cli\u003e代码冗余，重复劳动\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e事件驱动模式可以很好的解决以上问题，一个函数只干一件事，做完后一个事件抛出去，至于连带著要做什么，谁监听这个事件谁去处理，代码的耦合度很低，复用度很高，易于维护和阅读。\u003c/p\u003e\n\n\u003cp\u003eUltraBlog.vim引入事件驱动模式处理缓冲区同步的问题。不同的操作抛出不同的事件，所有的事件继承自父类\u003cstrong\u003eUBEvent\u003c/strong\u003e：\u003c/p\u003e\n\n```python\nclass UBEvent:\n    def __init__(self, srcObj):\n        self.srcObj = srcObj\n\nclass UBDebugEvent(UBEvent): pass\nclass UBTmplDelEvent(UBEvent): pass\nclass UBTmplSaveEvent(UBEvent): pass\nclass UBLocalPostDelEvent(UBEvent): pass\nclass UBRemotePostDelEvent(UBEvent): pass\nclass UBPostSendEvent(UBEvent): pass\nclass UBPostSaveEvent(UBEvent): pass\n```\n\n\u003cp\u003e一个可能改变缓冲区内容的操作执行完后，创建一个特定的事件并将其加入到事件队列中。事件队列类中存放两个列表，一是事件队列，二是事件监听器列表；提供三个方法，分别用来注册事件监听器、对事件执行入队列操作和处理队列中所有事件：\u003c/p\u003e\n\n```python\nclass UBEventQueue:\n    queue = []\n    listeners = []\n\n    @classmethod\n    def fireEvent(cls, evt):\n        cls.queue.append(evt)\n\n    @classmethod\n    def processEvents(cls):\n        for evt in cls.queue:\n            for listener in cls.listeners:\n                if listener.isTarget(evt):\n                    cls.queue.remove(evt)\n                    listener.processEvent(evt)\n\n    @classmethod\n    def registerListener(cls, lsnr):\n        cls.listeners.append(lsnr)\n```\n\n\u003cp\u003e事件队列对事件的处理是通过事件监听器进行的，每个事件监听器要实现两个功能：识别监听对象和处理监听对象。所有具体事件的监听类都是\u003cstrong\u003eUBListener\u003c/strong\u003e的子类：\u003c/p\u003e","title":"UltraBlog.vim v3.0释出：全文检索与事件驱动"},{"content":"当初在深圳被公司的Dell Inspiron 1300吓怕了，所以不惜重金收入了高配的Thinkpad X200 FN3。最近越来越觉得12寸的屏幕看代码实在是太局促了。\n今天中午收到AOC E2343F，979￥，23寸屏里算是价位很低的了，不算是很好的屏，不过看看代码、电影足够了。外接到X200上，人品不错，完美屏，没坏点，桌面环境下可以使用最大1920x1080x32分辨率，但是不知道为什么，hwinfo --framebuffer列出的结果中没有这个最佳分辨率，KMS自动选用了1280x1024x32，可惜不能在fbterm下撒野了。\n下午复习了一下AVATAR，720P，有点儿冲动，Intel GMA X4500还是很坚挺的。打开Vim，分割窗口，豁然开朗，对于这个根本目的，结果相当冲动。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/got-aoc-e2343f/","summary":"\u003cp\u003e当初在深圳被公司的Dell Inspiron 1300吓怕了，所以不惜重金\u003ca href=\"http://0x3f.org/?p=819\"\u003e收入\u003c/a\u003e了高配的Thinkpad X200 FN3。最近越来越觉得12寸的屏幕看代码实在是太局促了。\u003c/p\u003e\n\n\u003cp\u003e今天中午收到AOC E2343F，979￥，23寸屏里算是价位很低的了，不算是很好的屏，不过看看代码、电影足够了。外接到X200上，人品不错，完美屏，没坏点，桌面环境下可以使用最大1920x1080x32分辨率，但是不知道为什么，\u003ccode\u003ehwinfo --framebuffer\u003c/code\u003e列出的结果中没有这个最佳分辨率，\u003ca href=\"http://0x3f.org/?p=1377\"\u003eKMS\u003c/a\u003e自动选用了1280x1024x32，可惜不能在\u003ca href=\"http://linuxtoy.org/archives/fbterm.html\"\u003efbterm\u003c/a\u003e下撒野了。\u003c/p\u003e\n\n\u003cp\u003e下午复习了一下\u003ca href=\"http://zh.wikipedia.org/wiki/阿凡达\"\u003eAVATAR\u003c/a\u003e，720P，有点儿冲动，\u003ca href=\"http://0x3f.org/?p=970\"\u003eIntel GMA X4500\u003c/a\u003e还是很坚挺的。打开Vim，分割窗口，豁然开朗，对于这个根本目的，结果相当冲动。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/4HIWgaUq4G0PV4MnMapZ1Q?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh4.googleusercontent.com/-jUv8m-8etm4/Tiqpqyp-LCI/AAAAAAAAByY/R8_PZiw3s_c/s400/C360_2011-07-23%25252018-38-10.jpg\" height=\"300\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"收入AOC E2343F"},{"content":" 本文发表在今年一月份的『Linuxpilot』上，已经过了半年，可以放到博客上了。本文基于PAC 2.x版，最近PAC发布了3.0版，界面和功能都有一定的变化。\n简介 PAC Manager（以下简称PAC）是一个使用Perl编程语言和GTK图形界面开发套件实现的SSH/Telnet/Serial连接管理工具，是同类的PuTTY、SecureCRT、SSHMenu的一个开源、免费的替代品。\n具备哪些特性 可创建本地端口转发、远程端口转发和动态端口转发，并支持X图形界面转发 对连接分组，方便管理较多连接 将指定的、已打开的连接加入集群，同一集群的所有终端共享键盘输入 虚拟终端窗口支持多标签 虚拟终端窗口的样式可定制，支持半透明 支持通过代理服务器建立连接 支持通过Expect表达式进行自动交互 支持使用本地和远程宏管理数量众多且复杂的常用指令 支持定制连接前和断开后自动执行的指令 为每个连接保存截图 针对重要特性的细解 创建SSH隧道 假如当我们在进行诸如收发电邮、使用即时通讯工具聊天或者使用网络银行等网络通讯行为时，也许有些重要的数据我们不希望被明文传递；亦或某些资源受限于网络结构和防火墙等因素而不能被我们直接访问，这时我们往往就可以通过SSH的端口转发功能来实现。\n所谓端口转发，即是指将原本使用其它TCP端口访问的数据经由SSH连接占用的端口发送，加之这一过程也伴随有数据的加密和解密，因此也往往被称作“隧道”。根据连接方向的不同，SSH的隧道一般分为三种，即正向隧道、反向隧道和动态隧道；同时，根据端口转发方式的不同，这三种隧道又分别被称为本地端口转发、远程端口转发与动态端口转发。\n那么这三种端口转发方式彼此之间有什么异同，分别又都有什么用途呢？这里举个例子来说明一下。\n假设我的公司有一个较大的内部网络，而只有一台服务器作为网关对公网提供服务。如果我需要在家里的个人电脑上访问公司的办公系统，而这套系统又部署在内部网络中的一台服务器上、不能被公网访问，该怎么办呢？\n第一种情况，假设网关服务器对外提供了SSH服务，那么我就可以在家庭电脑上使用如下指令建立一个隧道：\nssh -L 9999:192.168.1.128:80 111.111.111.111\n这条指令中，192.168.1.128是公司办公系统服务器在内网中的IP地址，111.111.111.111是公司网关服务器的公网IP地址。整条指令的意思是：我在家庭电脑中访问本机的9999端口，就如同我在IP地址为111.111.111.111的公司网关服务器上访问IP地址为192.168.1.128的主机的80端口一样。因此，当这条指令执行成功后，我就可以在家庭电脑中通过访问9999端口来打开公司内部办公系统了。\n第二种情况，假设网关服务器不对外提供SSH服务但安装了SSH客户端，而我的家庭电脑却安装了SSH服务，那么我就可以在公司网关服务器上执行如下指令建立一个隧道：\nssh -R 9999:192.168.1.128:80 222.222.222.222\n这条指令中，222.222.222.222是家庭电脑的公网IP地址。整条指令的意思是：我在公网IP地址为222.222.222.222的电脑上访问9999端口，就如同在本机（公司网关服务器）上访问IP地址为192.168.1.128的主机的80端口一样。当我回到家中，就可以和前面一样通过访问9999端口来打开办公系统了。\n事实上，第一种情况是将本地端口映射为远程主机所能访问的资源，故称为本地端口转发；而第二种情况是将远程主机的端口映射为本机所能访问的资源，故称为远程端口转发。\n但无论是本地端口转发还是远程端口转发，都只能将一个资源转发到一个端口上，假若我要访问很多资源，岂非要建立很多SSH隧道，不但操作麻烦，而且浪费本机资源。这时，我们就可以使用第三种端口转发方式--动态端口转发：\nssh -D 9999 111.111.111.111\n这条指令的意思是：我在本机访问9999端口，就像在IP地址为111.111.111.111的主机上访问它所能访问的某些资源一样。这个所谓的“某些资源”，需要由我在发起访问请求时通过SSH隧道告诉远程主机，事实上，SSH的动态端口转发就是创建了一个SOCKS代理服务器。\n在PAC Manager中，我们可以在每个SSH连接的配置界面创建隧道。对于上面的例子，创建本地端口转发时，应点击“Local Port Forwarding”区域的“Add”按钮，并将本地端口、远程资源IP地址和端口分别填写到“Local Port”、“Remote Address”和“Remote Port”中：\n截至当前最新的版本（2.4.1.3），PAC Manager尚未为远程端口转发提供像本地端口转发功能一样单独的配置界面，但可以使用高级选项功能实现。在“Advanced Options”输入框中填写如下内容：\n如果需要建立多个远程端口转发，可以在“Advanced Options”中填写多个类似上面内容的选项，彼此之间使用空格分隔即可。\n创建动态端口转发时，应选中“Dynamic Port Forwarding”区域前面的复选框，然后填写“Forwarded SOCKS Port”即可：\n连接前及断开后的自动指令 通过在PAC Manager中定义连接前和断开后的自动指令，我们可以指定一些在相应的SSH连接建立之前及断开之后通常要在本机执行的指令。\n例如假设我使用的是计时收费的网络服务，为了节省资费，我希望只在每次建立SSH连接时才激活网络服务，并且在完成工作后断开SSH连接时自动断开网络服务。那么就可以在“Pre Exec”中定义激活网络服务的指令，如下图所示：\n在“Post Exec”中定义断开网络服务的指令，如下图所示：\nPAC Manager会在每次建立SSH连接前和断开SSH连接后弹出对话框请求用户选择要在本机执行的指令。\nExpect正则表达式 Expect是一个用以实现终端中自动交互功能的软件套件，它允许用户通过编写脚本实现自动响应终端中的指令对用户输入的请求，从而将用户从日常重复的劳动中解脱出来。利用Expect，我们可以实现自动输入日常使用的指令中密码的输入；可以在安装程式要求确认时自动确认；甚至实现一个IRC聊天机器人，在你不在时自动回复你的朋友！\n那么在PAC Manager中，Expect是怎样使用的呢？我们用一个示例来说明。\n假设我是公司内部邮件系统的管理员，每天下班后回到家都要时常查看一下系统的日志记录，而邮件系统服务器位于公司内部网络，我只有公司网关的SSH访问权限。这样我每次查看日志都要做至少三件事：\n通过SSH登录到公司网关主机 使用SCP指令从内网邮件服务器上下载日志文件到公司网关主机（需要输入密码） 使用vi编辑器打开日志文件 如果经常这样做，会是件很烦琐的事。那么在PAC Manager中可以这样实现：\n首先创建一个到公司网关的SSH连接，然后添加Expect配置如下：\n第一个Expect配置项的意思是在到公司网关的SSH连接建立成功后马上从邮件服务器（IP是192.168.1.3）上下载日志文件（mail.log），然后使用vi编辑器打开该日志文件。由于SCP指令需要输入密码，故第二个Expect配置项会在SCP请求密码时自动输入。这样，在PAC Manager中每次连接到公司网关时就会自动下载并打开日志文件了。\n宏 对于经常要做远程管理的用户，通常会有一些常用的指令，有时指令太多或太长，记忆和输入都不方便，这时就可以使用PAC Manager的宏管理功能来管理这些常用指令。\n例如在下面的图中，我们定义了两个指令：\n然后在建立SSH连接后就可以在需要的时候通过右键菜单选择要执行的指令：\n如果在编辑宏时选中了输入框前面的“Confirm”，则表示在使用此指令前会弹出一个对话框要求用户确认，对于一些危险的指令，这会是防止自己犯下不可饶恕的错误的最后一道屏障。\n集群 如果您有多台远程主机需要管理，并且经常会对所有主机都执行一些相同的操作，那么PAC Manager的集群功能就可以免去在每台主机上都执行一遍相同指令的麻烦。\n首先我们打开三个SSH连接，假设现在需要在其中的两台主机中输入同样的指令，那么可以点击PAC Manager主窗口上的“Clusters”按钮，在弹出的对话框中的集群列表中新建或选择一个集群。\n在对话框左边的列表中列出的是当前所有打开的连接中没有被加入集群的连接，选中其中的两个，并点击“Add to Cluster”，这两个连接即被加入指定的集群中。如下图所示：\n同一集群中的所有终端窗口将共享用户的输入，例如在集群中的任一终端中输入“hostname”并点击Enter键，则集群中所有终端都会显示该连接对应主机的主机名。\n环境变量及用户自定义变量 PAC Manager允许用户在定义宏、Expect脚本和其它指令时使用系统环境变量和自定义的变量。对于某些需要用到会经常变化的特定值的指令，这个功能免去了每当这些值变化后都必须逐个修改相关指令的麻烦。\n以前面在“Expect正则表达式”节举的例子来说，假设我不但定义了连接后自动下载日志文件的Expect表达式，还定义了几个使用lftp指令下载远程主机其它文件的宏，那么每当远程主机的FTP账号密码发生变化，我都必须逐个修改所有使用了这个密码的宏，设想如果这种情况很多，那将会是怎样的噩梦！\n此时我就可以使用自定义变量的功能定义一个变量，以存储这个密码，如下图所示：\n然后在所有使用这个密码的位置使用这个变量作为替代值。查找已定义变量的方法是在指令输入框中点击右键，所有的用户自定义变量都显示在“User variables”菜单中：\n如果需要在指令中引入系统环境变量，则可以在与“User variables”平级的“Environment variables”菜单中选择。\n灵活的可定制性 PAC Manager提供一个简洁直观的全局定制界面，用户可在其中定义程式本身行为的参数、建立连接后的虚拟终端窗口的样式、连接的超时时间及建立连接时使用的代理服务器信息。\n它甚至为每个连接都提供了定制功能，用户可以针对个别连接进行个性化定制，单个连接中的配置信息将会覆盖全局配置中对应的信息。\n管理Telnet/Serial连接 PAC Manager不但支持SSH协议，也可以作为Telnet和Serial协议的连接管理工具，在此不作赘述。\n结束语 PAC Manager是一个年轻的项目，在用户体验和功能上还有很大的发展空间。但凭借出色的用户界面设计和实用细致的功能，即使与那些老牌的同类工具相比也不遑多让，从它华丽的现身我们高兴地看到在SSH/Telnet管理工具中又多出一个易用、强大、美观和免费的选择。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/manage-ssh-connections-using-pac-manager/","summary":"\u003cblockquote\u003e\n  \u003cp\u003e本文发表在今年一月份的『Linuxpilot』上，已经过了半年，可以放到博客上了。本文基于PAC 2.x版，最近PAC发布了3.0版，界面和功能都有一定的变化。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e简介\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://pacmanager.sourceforge.net\"\u003ePAC Manager\u003c/a\u003e（以下简称PAC）是一个使用Perl编程语言和GTK图形界面开发套件实现的SSH/Telnet/Serial连接管理工具，是同类的PuTTY、SecureCRT、SSHMenu的一个开源、免费的替代品。\u003c/p\u003e\n\n\u003ch2\u003e具备哪些特性\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e可创建本地端口转发、远程端口转发和动态端口转发，并支持X图形界面转发\u003c/li\u003e\n\u003cli\u003e对连接分组，方便管理较多连接\u003c/li\u003e\n\u003cli\u003e将指定的、已打开的连接加入集群，同一集群的所有终端共享键盘输入\u003c/li\u003e\n\u003cli\u003e虚拟终端窗口支持多标签\u003c/li\u003e\n\u003cli\u003e虚拟终端窗口的样式可定制，支持半透明\u003c/li\u003e\n\u003cli\u003e支持通过代理服务器建立连接\u003c/li\u003e\n\u003cli\u003e支持通过Expect表达式进行自动交互\u003c/li\u003e\n\u003cli\u003e支持使用本地和远程宏管理数量众多且复杂的常用指令\u003c/li\u003e\n\u003cli\u003e支持定制连接前和断开后自动执行的指令\u003c/li\u003e\n\u003cli\u003e为每个连接保存截图\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e针对重要特性的细解\u003c/h2\u003e\n\n\u003ch3\u003e创建SSH隧道\u003c/h3\u003e\n\n\u003cp\u003e假如当我们在进行诸如收发电邮、使用即时通讯工具聊天或者使用网络银行等网络通讯行为时，也许有些重要的数据我们不希望被明文传递；亦或某些资源受限于网络结构和防火墙等因素而不能被我们直接访问，这时我们往往就可以通过SSH的端口转发功能来实现。\u003c/p\u003e\n\n\u003cp\u003e所谓端口转发，即是指将原本使用其它TCP端口访问的数据经由SSH连接占用的端口发送，加之这一过程也伴随有数据的加密和解密，因此也往往被称作“隧道”。根据连接方向的不同，SSH的隧道一般分为三种，即正向隧道、反向隧道和动态隧道；同时，根据端口转发方式的不同，这三种隧道又分别被称为本地端口转发、远程端口转发与动态端口转发。\u003c/p\u003e\n\n\u003cp\u003e那么这三种端口转发方式彼此之间有什么异同，分别又都有什么用途呢？这里举个例子来说明一下。\u003c/p\u003e\n\n\u003cp\u003e假设我的公司有一个较大的内部网络，而只有一台服务器作为网关对公网提供服务。如果我需要在家里的个人电脑上访问公司的办公系统，而这套系统又部署在内部网络中的一台服务器上、不能被公网访问，该怎么办呢？\u003c/p\u003e\n\n\u003cp\u003e第一种情况，假设网关服务器对外提供了SSH服务，那么我就可以在家庭电脑上使用如下指令建立一个隧道：\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003essh -L 9999:192.168.1.128:80 111.111.111.111\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e这条指令中，192.168.1.128是公司办公系统服务器在内网中的IP地址，111.111.111.111是公司网关服务器的公网IP地址。整条指令的意思是：我在家庭电脑中访问本机的9999端口，就如同我在IP地址为111.111.111.111的公司网关服务器上访问IP地址为192.168.1.128的主机的80端口一样。因此，当这条指令执行成功后，我就可以在家庭电脑中通过访问9999端口来打开公司内部办公系统了。\u003c/p\u003e\n\n\u003cp\u003e第二种情况，假设网关服务器不对外提供SSH服务但安装了SSH客户端，而我的家庭电脑却安装了SSH服务，那么我就可以在公司网关服务器上执行如下指令建立一个隧道：\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003essh -R 9999:192.168.1.128:80 222.222.222.222\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e这条指令中，222.222.222.222是家庭电脑的公网IP地址。整条指令的意思是：我在公网IP地址为222.222.222.222的电脑上访问9999端口，就如同在本机（公司网关服务器）上访问IP地址为192.168.1.128的主机的80端口一样。当我回到家中，就可以和前面一样通过访问9999端口来打开办公系统了。\u003c/p\u003e\n\n\u003cp\u003e事实上，第一种情况是将本地端口映射为远程主机所能访问的资源，故称为本地端口转发；而第二种情况是将远程主机的端口映射为本机所能访问的资源，故称为远程端口转发。\u003c/p\u003e\n\n\u003cp\u003e但无论是本地端口转发还是远程端口转发，都只能将一个资源转发到一个端口上，假若我要访问很多资源，岂非要建立很多SSH隧道，不但操作麻烦，而且浪费本机资源。这时，我们就可以使用第三种端口转发方式--动态端口转发：\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003essh -D 9999 111.111.111.111\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e这条指令的意思是：我在本机访问9999端口，就像在IP地址为111.111.111.111的主机上访问它所能访问的某些资源一样。这个所谓的“某些资源”，需要由我在发起访问请求时通过SSH隧道告诉远程主机，事实上，SSH的动态端口转发就是创建了一个SOCKS代理服务器。\u003c/p\u003e\n\n\u003cp\u003e在PAC Manager中，我们可以在每个SSH连接的配置界面创建隧道。对于上面的例子，创建本地端口转发时，应点击“Local Port Forwarding”区域的“Add”按钮，并将本地端口、远程资源IP地址和端口分别填写到“Local Port”、“Remote Address”和“Remote Port”中：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/Gfzyo3h4hUrTUxA4YIlRuw?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/--l0NMNEs-Qs/Th70Q2lplvI/AAAAAAAABxo/EDBIPjRL0nY/s640/pac_manager_introduction-tunnel_01.png\" height=\"166\" width=\"640\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e截至当前最新的版本（2.4.1.3），PAC Manager尚未为远程端口转发提供像本地端口转发功能一样单独的配置界面，但可以使用高级选项功能实现。在“Advanced Options”输入框中填写如下内容：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/fru1uaGuVQ57mXRBiFRMeA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/-iFwTWK2ZL4M/Th70Q7NcE6I/AAAAAAAABxs/pTEh2LGkwV8/s640/pac_manager_introduction-tunnel_03.png\" height=\"31\" width=\"640\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e如果需要建立多个远程端口转发，可以在“Advanced Options”中填写多个类似上面内容的选项，彼此之间使用空格分隔即可。\u003c/p\u003e\n\n\u003cp\u003e创建动态端口转发时，应选中“Dynamic Port Forwarding”区域前面的复选框，然后填写“Forwarded SOCKS Port”即可：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/hnRb67QlipzpHb_IaeyYiw?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/-JHN7-EI7pjc/Th70QhAOCUI/AAAAAAAABxk/4D2e1SpcS-U/s640/pac_manager_introduction-tunnel_02.png\" height=\"55\" width=\"640\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e连接前及断开后的自动指令\u003c/h3\u003e\n\n\u003cp\u003e通过在PAC Manager中定义连接前和断开后的自动指令，我们可以指定一些在相应的SSH连接建立之前及断开之后通常要在本机执行的指令。\u003c/p\u003e\n\n\u003cp\u003e例如假设我使用的是计时收费的网络服务，为了节省资费，我希望只在每次建立SSH连接时才激活网络服务，并且在完成工作后断开SSH连接时自动断开网络服务。那么就可以在“Pre Exec”中定义激活网络服务的指令，如下图所示：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/_P1JaaI5sF8gDTMulaljVA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/-nPz5VHhK0vk/Th70MQLOVOI/AAAAAAAABxM/Q-mwNmyxzOo/s640/pac_manager_introduction-exec_01.png\" height=\"136\" width=\"640\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"使用PAC Manager管理SSH连接"},{"content":"对一个保存了100个对象实例的数组进行300次读写，该数组序列化后大小为232KB。\n测试环境 网络服务器 PHP版本 操作系统 硬件配置 NGINX v1.0.4 PHP-FPM v5.3.6\nAPC启用 Archlinux 32bit Intel(R) Core(TM)2 Duo CPU T9400 @ 2.53GHz\nMem: 3G DDR3\nDisk: 5400r/s 测试脚本 测试数据：\n```php \u003c?php /* * @file data.php */ class XTest { var $x0; var $x1; var $x2; var $x3; var $x4; var $x5; var $x6; var $x7; var $x8; var $x9; var $x10; var $x11; var $x12; var $x13; var $x14; var $x15; var $x16; var $x17; var $x18; var $x19; var $x20; var $x21; var $x22; var $x23; var $x24; var $x25; var $x26; var $x27; var $x28; var $x29; var $x30; var $x31; var $x32; var $x33; var $x34; var $x35; var $x36; var $x37; var $x38; var $x39; var $x40; var $x41; var $x42; var $x43; var $x44; var $x45; var $x46; var $x47; var $x48; var $x49; var $x50; var $x51; var $x52; var $x53; var $x54; var $x55; var $x56; var $x57; var $x58; var $x59; var $x60; var $x61; var $x62; var $x63; var $x64; var $x65; var $x66; var $x67; var $x68; var $x69; var $x70; var $x71; var $x72; var $x73; var $x74; var $x75; var $x76; var $x77; var $x78; var $x79; var $x80; var $x81; var $x82; var $x83; var $x84; var $x85; var $x86; var $x87; var $x88; var $x89; var $x90; var $x91; var $x92; var $x93; var $x94; var $x95; var $x96; var $x97; var $x98; var $x99; function __construct() { $this-\u003ex0 = 1234567890; $this-\u003ex1 = 1234567890; $this-\u003ex2 = 1234567890; $this-\u003ex3 = 1234567890; $this-\u003ex4 = 1234567890; $this-\u003ex5 = 1234567890; $this-\u003ex6 = 1234567890; $this-\u003ex7 = 1234567890; $this-\u003ex8 = 1234567890; $this-\u003ex9 = 1234567890; $this-\u003ex10 = 1234567890; $this-\u003ex11 = 1234567890; $this-\u003ex12 = 1234567890; $this-\u003ex13 = 1234567890; $this-\u003ex14 = 1234567890; $this-\u003ex15 = 1234567890; $this-\u003ex16 = 1234567890; $this-\u003ex17 = 1234567890; $this-\u003ex18 = 1234567890; $this-\u003ex19 = 1234567890; $this-\u003ex20 = 1234567890; $this-\u003ex21 = 1234567890; $this-\u003ex22 = 1234567890; $this-\u003ex23 = 1234567890; $this-\u003ex24 = 1234567890; $this-\u003ex25 = 1234567890; $this-\u003ex26 = 1234567890; $this-\u003ex27 = 1234567890; $this-\u003ex28 = 1234567890; $this-\u003ex29 = 1234567890; $this-\u003ex30 = 1234567890; $this-\u003ex31 = 1234567890; $this-\u003ex32 = 1234567890; $this-\u003ex33 = 1234567890; $this-\u003ex34 = 1234567890; $this-\u003ex35 = 1234567890; $this-\u003ex36 = 1234567890; $this-\u003ex37 = 1234567890; $this-\u003ex38 = 1234567890; $this-\u003ex39 = 1234567890; $this-\u003ex40 = 1234567890; $this-\u003ex41 = 1234567890; $this-\u003ex42 = 1234567890; $this-\u003ex43 = 1234567890; $this-\u003ex44 = 1234567890; $this-\u003ex45 = 1234567890; $this-\u003ex46 = 1234567890; $this-\u003ex47 = 1234567890; $this-\u003ex48 = 1234567890; $this-\u003ex49 = 1234567890; $this-\u003ex50 = 1234567890; $this-\u003ex51 = 1234567890; $this-\u003ex52 = 1234567890; $this-\u003ex53 = 1234567890; $this-\u003ex54 = 1234567890; $this-\u003ex55 = 1234567890; $this-\u003ex56 = 1234567890; $this-\u003ex57 = 1234567890; $this-\u003ex58 = 1234567890; $this-\u003ex59 = 1234567890; $this-\u003ex60 = 1234567890; $this-\u003ex61 = 1234567890; $this-\u003ex62 = 1234567890; $this-\u003ex63 = 1234567890; $this-\u003ex64 = 1234567890; $this-\u003ex65 = 1234567890; $this-\u003ex66 = 1234567890; $this-\u003ex67 = 1234567890; $this-\u003ex68 = 1234567890; $this-\u003ex69 = 1234567890; $this-\u003ex70 = 1234567890; $this-\u003ex71 = 1234567890; $this-\u003ex72 = 1234567890; $this-\u003ex73 = 1234567890; $this-\u003ex74 = 1234567890; $this-\u003ex75 = 1234567890; $this-\u003ex76 = 1234567890; $this-\u003ex77 = 1234567890; $this-\u003ex78 = 1234567890; $this-\u003ex79 = 1234567890; $this-\u003ex80 = 1234567890; $this-\u003ex81 = 1234567890; $this-\u003ex82 = 1234567890; $this-\u003ex83 = 1234567890; $this-\u003ex84 = 1234567890; $this-\u003ex85 = 1234567890; $this-\u003ex86 = 1234567890; $this-\u003ex87 = 1234567890; $this-\u003ex88 = 1234567890; $this-\u003ex89 = 1234567890; $this-\u003ex90 = 1234567890; $this-\u003ex91 = 1234567890; $this-\u003ex92 = 1234567890; $this-\u003ex93 = 1234567890; $this-\u003ex94 = 1234567890; $this-\u003ex95 = 1234567890; $this-\u003ex96 = 1234567890; $this-\u003ex97 = 1234567890; $this-\u003ex98 = 1234567890; $this-\u003ex99 = 1234567890; } } $repeat = 300; $arr = array(); for ($i = 0; $i \u003c 100; $i++) { $arr[] = new XTest; } ?\u003e ``` APC:\n```php \u003c?php /* * @file t1.php */ include_once 'data.php'; $stime = microtime(true); for ($i = 0; $i \u003c $repeat; $i++) { apc_store('key'.$i, $arr); apc_fetch('key'.$i); } $etime = microtime(true); echo $etime-$stime; ?\u003e ``` 文件：\n```php \u003c?php /* * @file t2.php */ include_once 'data.php'; $stime = microtime(true); for ($i = 0; $i \u003c $repeat; $i++) { file_put_contents('/tmp/xtest_key'.$i.'.srl', serialize($arr)); unserialize(file_get_contents('/tmp/xtest_key'.$i.'.srl')); } $etime = microtime(true); echo $etime-$stime; ?\u003e ``` Memcached:\n```php \u003c?php /* * @file t3.php */ include_once 'data.php'; $mem = new Memcached; $mem-\u003eaddServer(\"127.0.0.1\", 11211); $stime = microtime(true); for ($i = 0; $i \u003c $repeat; $i++) { $mem-\u003eset('key'.$i, $arr); $mem-\u003eget('key'.$i); } $etime = microtime(true); echo $etime-$stime; ?\u003e ``` 测试结果 APC 文件 Memcached 3.4926421642303 3.6572530269623 4.6224999427795 总结 APC效率最高，Memcached效率最低 APC和Memcached的测试结果很稳定，文件方式的耗时从开始时的4秒逐步降低并稳定在3.6秒 猜想： 在IO量较小的情况下，文件读写可能确实比通过TCP操作Memcached效率高，但是在IO量较大的情况下，文件方式会出现瓶颈，Memcached的优势会得到体现 对于集群应用，通过NFS共享文件缓存的效率会低于Memcached Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/comparison-of-efficiency-for-apc-file-memcached/","summary":"\u003cp\u003e对一个保存了100个对象实例的数组进行300次读写，该数组序列化后大小为232KB。\u003c/p\u003e\n\n\u003ch2\u003e测试环境\u003c/h2\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth\u003e网络服务器\u003c/th\u003e\n        \u003cth\u003ePHP版本\u003c/th\u003e\n        \u003cth\u003e操作系统\u003c/th\u003e\n        \u003cth\u003e硬件配置\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd\u003eNGINX v1.0.4\u003c/td\u003e\n        \u003ctd\u003ePHP-FPM v5.3.6\u003cbr\u003eAPC启用\u003c/td\u003e\n        \u003ctd\u003eArchlinux 32bit\u003c/td\u003e\n        \u003ctd\u003eIntel(R) Core(TM)2 Duo CPU T9400 @ 2.53GHz\u003cbr\u003eMem: 3G DDR3\u003cbr\u003eDisk: 5400r/s\u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e测试脚本\u003c/h2\u003e\n\n\u003cp\u003e测试数据：\u003c/p\u003e\n\n```php\n\u003c?php\n/*\n * @file data.php\n */\n\nclass XTest\n{\n    var $x0;\n    var $x1;\n    var $x2;\n    var $x3;\n    var $x4;\n    var $x5;\n    var $x6;\n    var $x7;\n    var $x8;\n    var $x9;\n    var $x10;\n    var $x11;\n    var $x12;\n    var $x13;\n    var $x14;\n    var $x15;\n    var $x16;\n    var $x17;\n    var $x18;\n    var $x19;\n    var $x20;\n    var $x21;\n    var $x22;\n    var $x23;\n    var $x24;\n    var $x25;\n    var $x26;\n    var $x27;\n    var $x28;\n    var $x29;\n    var $x30;\n    var $x31;\n    var $x32;\n    var $x33;\n    var $x34;\n    var $x35;\n    var $x36;\n    var $x37;\n    var $x38;\n    var $x39;\n    var $x40;\n    var $x41;\n    var $x42;\n    var $x43;\n    var $x44;\n    var $x45;\n    var $x46;\n    var $x47;\n    var $x48;\n    var $x49;\n    var $x50;\n    var $x51;\n    var $x52;\n    var $x53;\n    var $x54;\n    var $x55;\n    var $x56;\n    var $x57;\n    var $x58;\n    var $x59;\n    var $x60;\n    var $x61;\n    var $x62;\n    var $x63;\n    var $x64;\n    var $x65;\n    var $x66;\n    var $x67;\n    var $x68;\n    var $x69;\n    var $x70;\n    var $x71;\n    var $x72;\n    var $x73;\n    var $x74;\n    var $x75;\n    var $x76;\n    var $x77;\n    var $x78;\n    var $x79;\n    var $x80;\n    var $x81;\n    var $x82;\n    var $x83;\n    var $x84;\n    var $x85;\n    var $x86;\n    var $x87;\n    var $x88;\n    var $x89;\n    var $x90;\n    var $x91;\n    var $x92;\n    var $x93;\n    var $x94;\n    var $x95;\n    var $x96;\n    var $x97;\n    var $x98;\n    var $x99;\n\n    function __construct()\n    {\n        $this-\u003ex0 = 1234567890;\n        $this-\u003ex1 = 1234567890;\n        $this-\u003ex2 = 1234567890;\n        $this-\u003ex3 = 1234567890;\n        $this-\u003ex4 = 1234567890;\n        $this-\u003ex5 = 1234567890;\n        $this-\u003ex6 = 1234567890;\n        $this-\u003ex7 = 1234567890;\n        $this-\u003ex8 = 1234567890;\n        $this-\u003ex9 = 1234567890;\n        $this-\u003ex10 = 1234567890;\n        $this-\u003ex11 = 1234567890;\n        $this-\u003ex12 = 1234567890;\n        $this-\u003ex13 = 1234567890;\n        $this-\u003ex14 = 1234567890;\n        $this-\u003ex15 = 1234567890;\n        $this-\u003ex16 = 1234567890;\n        $this-\u003ex17 = 1234567890;\n        $this-\u003ex18 = 1234567890;\n        $this-\u003ex19 = 1234567890;\n        $this-\u003ex20 = 1234567890;\n        $this-\u003ex21 = 1234567890;\n        $this-\u003ex22 = 1234567890;\n        $this-\u003ex23 = 1234567890;\n        $this-\u003ex24 = 1234567890;\n        $this-\u003ex25 = 1234567890;\n        $this-\u003ex26 = 1234567890;\n        $this-\u003ex27 = 1234567890;\n        $this-\u003ex28 = 1234567890;\n        $this-\u003ex29 = 1234567890;\n        $this-\u003ex30 = 1234567890;\n        $this-\u003ex31 = 1234567890;\n        $this-\u003ex32 = 1234567890;\n        $this-\u003ex33 = 1234567890;\n        $this-\u003ex34 = 1234567890;\n        $this-\u003ex35 = 1234567890;\n        $this-\u003ex36 = 1234567890;\n        $this-\u003ex37 = 1234567890;\n        $this-\u003ex38 = 1234567890;\n        $this-\u003ex39 = 1234567890;\n        $this-\u003ex40 = 1234567890;\n        $this-\u003ex41 = 1234567890;\n        $this-\u003ex42 = 1234567890;\n        $this-\u003ex43 = 1234567890;\n        $this-\u003ex44 = 1234567890;\n        $this-\u003ex45 = 1234567890;\n        $this-\u003ex46 = 1234567890;\n        $this-\u003ex47 = 1234567890;\n        $this-\u003ex48 = 1234567890;\n        $this-\u003ex49 = 1234567890;\n        $this-\u003ex50 = 1234567890;\n        $this-\u003ex51 = 1234567890;\n        $this-\u003ex52 = 1234567890;\n        $this-\u003ex53 = 1234567890;\n        $this-\u003ex54 = 1234567890;\n        $this-\u003ex55 = 1234567890;\n        $this-\u003ex56 = 1234567890;\n        $this-\u003ex57 = 1234567890;\n        $this-\u003ex58 = 1234567890;\n        $this-\u003ex59 = 1234567890;\n        $this-\u003ex60 = 1234567890;\n        $this-\u003ex61 = 1234567890;\n        $this-\u003ex62 = 1234567890;\n        $this-\u003ex63 = 1234567890;\n        $this-\u003ex64 = 1234567890;\n        $this-\u003ex65 = 1234567890;\n        $this-\u003ex66 = 1234567890;\n        $this-\u003ex67 = 1234567890;\n        $this-\u003ex68 = 1234567890;\n        $this-\u003ex69 = 1234567890;\n        $this-\u003ex70 = 1234567890;\n        $this-\u003ex71 = 1234567890;\n        $this-\u003ex72 = 1234567890;\n        $this-\u003ex73 = 1234567890;\n        $this-\u003ex74 = 1234567890;\n        $this-\u003ex75 = 1234567890;\n        $this-\u003ex76 = 1234567890;\n        $this-\u003ex77 = 1234567890;\n        $this-\u003ex78 = 1234567890;\n        $this-\u003ex79 = 1234567890;\n        $this-\u003ex80 = 1234567890;\n        $this-\u003ex81 = 1234567890;\n        $this-\u003ex82 = 1234567890;\n        $this-\u003ex83 = 1234567890;\n        $this-\u003ex84 = 1234567890;\n        $this-\u003ex85 = 1234567890;\n        $this-\u003ex86 = 1234567890;\n        $this-\u003ex87 = 1234567890;\n        $this-\u003ex88 = 1234567890;\n        $this-\u003ex89 = 1234567890;\n        $this-\u003ex90 = 1234567890;\n        $this-\u003ex91 = 1234567890;\n        $this-\u003ex92 = 1234567890;\n        $this-\u003ex93 = 1234567890;\n        $this-\u003ex94 = 1234567890;\n        $this-\u003ex95 = 1234567890;\n        $this-\u003ex96 = 1234567890;\n        $this-\u003ex97 = 1234567890;\n        $this-\u003ex98 = 1234567890;\n        $this-\u003ex99 = 1234567890;\n    }\n}\n\n$repeat = 300;\n\n$arr = array();\nfor ($i = 0; $i \u003c 100; $i++) {\n    $arr[] = new XTest;\n}\n?\u003e\n```\n\n\u003cp\u003eAPC:\u003c/p\u003e","title":"APC、文件和Memcached效率对比"},{"content":"SQLServerSelectLogin对话框中如果选择Windows身份验证，在附加数据库时会因权限不够而失败，所以应该隐藏这个选项，从而要求用户只执行SQL身份验证。\n但是如果在定制对话框布局时直接删除两个单选框，会导致用户输入的用户名和密码不能被安装程序获取，并且InstallShield也没有提供隐藏这些控件的属性。解决方法是修改控件的定位属性，将其定位到对话框的大小范围之外：\n要达到的目标：\n修改Top属性，将指定的控件定位在对话框之外：\n最终效果：\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/how-to-hide-dialog-in-installshield/","summary":"\u003cp\u003eSQLServerSelectLogin对话框中如果选择Windows身份验证，在附加数据库时会因权限不够而失败，所以应该隐藏这个选项，从而要求用户只执行SQL身份验证。\u003c/p\u003e\n\n\u003cp\u003e但是如果在定制对话框布局时直接删除两个单选框，会导致用户输入的用户名和密码不能被安装程序获取，并且InstallShield也没有提供隐藏这些控件的属性。解决方法是修改控件的定位属性，将其定位到对话框的大小范围之外：\u003c/p\u003e\n\n\u003cp\u003e要达到的目标：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/pDxRP_-E5wL7hAoCGYhHXQ?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/-069F7ZsOWOo/TgHdXDlb7iI/AAAAAAAABv0/zd6y0KAlYWM/s400/SQLServerSelectLogin_Customization_01.png\" height=\"299\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e修改Top属性，将指定的控件定位在对话框之外：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/5NUaJ2Re61aWiUcJwDOHZg?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/-9xthNFn9b2U/TgHdXnU-TmI/AAAAAAAABv4/-pQdJWF3nM8/s400/SQLServerSelectLogin_Customization_02.png\" height=\"302\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e最终效果：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/PImOz5YLlQKHAS2KUfggyw?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/-o2S0V7IzHKg/TgHdWxwEWMI/AAAAAAAABvw/2q4M26A_O2s/s400/SQLServerSelectLogin_Customization_03.png\" height=\"299\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"隐藏InstallShield对话框控件的方法"},{"content":"这是本需要仔细读的书，对ExtJS的主要控件有比较详细的解说，有一定的原理性解释，并且对扩展ExtJS和ExtJS项目开发的模式有一些介绍。但不涉及底层特性，例如DOM、AJAX等。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/after-reading-extjs-in-action/","summary":"\u003cp\u003e这是本需要仔细读的书，对ExtJS的主要控件有比较详细的解说，有一定的原理性解释，并且对扩展ExtJS和ExtJS项目开发的模式有一些介绍。但不涉及底层特性，例如DOM、AJAX等。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/-SKr3JvnYwcLN0fb6sxCpw?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/-buAuqjZT0o4/Tf9kmGOt4vI/AAAAAAAABvQ/LezmUW7CJ74/s400/ExtJS_In_Action.jpg\" height=\"400\" width=\"319\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"读完『Ext JS IN Action』"},{"content":"I released the new version 2.3.0 of UltraBlog.vim last week. The main improvement in this version is that templates are introduced in.\nTemplates are simply HTML strings, they are used to preview posts/pages in the browser locally. This feature is a reparation for the remote previewing, due to the limit of the API, users cannot send a post to Wordpress as draft and preview it without affecting the post status if the post has been published. With templates, they do not have to send drafts to blogs to preview the final effect, but preview drafts directly in the browser in a pre-defined style. Templates can be created as many as users like and their looks can be customized with CSS, HTML and Javascript.\nThe following illustrations show the content and final effect of the default template:\nTemplates should be formatted as valid Python template strings, that is, use the following avaliable placeholders and escape any literal '%' with another '%':\n%(title)s The title of the current post/page.\n%(content)s The content of the current post/page.\n%% A literal '%'.\nUsers can take the default template whose name is 'default' as an example for writing their own templates. The default template can be changed to another one by setting the name of that template to the option ub_default_template.\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-v230-released/","summary":"\u003cp\u003eI released the new version 2.3.0 of \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e last week. The main improvement in this version is that templates are introduced in.\u003c/p\u003e\n\n\u003cp\u003eTemplates are simply HTML strings, they are used to preview posts/pages in the browser locally. This feature is a reparation for the remote previewing, due to the limit of the API, users cannot send a post to Wordpress as draft and preview it without affecting the post status if the post has been published. With templates, they do not have to send drafts to blogs to preview the final effect, but preview drafts directly in the browser in a pre-defined style. Templates can be created as many as users like and their looks can be customized with CSS, HTML and Javascript.\u003c/p\u003e","title":"UltraBlog.vim v2.3.0 Released With Templates"},{"content":"UltraBlog.vim起初的几个版本采用增加命令个数的方式减少每个命令的参数个数，目的是降低命令格式记忆的难度。从2.3.0版本起，开始采用Vim自定义命令的一些高级特性，精简命令个数，虽然参数个数增加了，但由于实现了参数补全，反而更加直观。\nVim对自定义命令提供了多种补全参数的方式，详见:h command-complete。其中，最常用的当属custom：\n```vim command! -nargs=? -complete=custom,StatusCmpl UBSend exec('py ub_send_item()') ``` 以上代码定义了一个自定义命令UBSend，它可以获得一个或零个参数（-nargs=?），如果指定参数，则补全方式采用custom，该方式调用一个名为StatusCmpl的函数并以其返回值作为补全的值域：\n```vim function! StatusCmpl(ArgLead, CmdLine, CursorPos) return \"draft\\npublish\\nprivate\\npending\\n\" endfunction ``` 从以上代码可以看出，该函数需要接受三个参数，返回值应该是一个用换行符“\\n”分割的字符串，在执行补全时，Vim自动使用正则表达式匹配备选项。对于只有一个参数的情况，这种实现方式简单高效。\n对于参数较多的情况，customlist补全方式最为适用：\n```vim command! -nargs=* -complete=customlist,UBNewCmpl UBNew exec('py ub_new_item()') ``` 以上代码定义了命令UBNew，customlist补全方式调用函数UBNewCmpl获取补全的值域：\n```vim function! UBNewCmpl(ArgLead, CmdLine, CursorPos) let lst = split(a:CmdLine) if len(a:ArgLead)\u003e0 let lst = lst[0:-2] endif let results = [] \" For the first argument, complete the object type if len(lst)==1 let objects = ['post','page','tmpl'] for obj in objects if stridx(obj,a:ArgLead)==0 call add(results,obj) endif endfor \" For the second argument, complete the syntax for :UBNew post or :UBNew \" page elseif len(lst)==2 \u0026\u0026 count(['post', 'page'], lst[1])==1 let syntaxes = ['markdown','html','rst','textile','latex'] for synx in syntaxes if stridx(synx,a:ArgLead)==0 call add(results,synx) endif endfor endif return results endfunction ``` 这时侯，前面提到的三个参数就派上用场了。ArgLead是进行补全时，已输入的参数部分，例如输入:UBNew p，然后按Tab键，则ArgLead的值就是“p”；CmdLine是已经输入的命令的全部，按上例，这个参数的值就是“UBNew p”；CursorPost是当前光标距离命令行开头的字符数。利用这三个参数，就可以判断正在补全命令的第几个参数，进而利用ArgLead筛选该参数的值域。\n与custom调用的函数不同，customlist调用的函数的返回值应该是一个list类型的值。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/how-to-define-auto-completion-for-vim-commands/","summary":"\u003cp\u003e\u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e起初的几个版本采用增加命令个数的方式减少每个命令的参数个数，目的是降低命令格式记忆的难度。从2.3.0版本起，开始采用Vim自定义命令的一些高级特性，精简命令个数，虽然参数个数增加了，但由于实现了参数补全，反而更加直观。\u003c/p\u003e\n\n\u003cp\u003eVim对自定义命令提供了多种补全参数的方式，详见\u003ccode\u003e:h command-complete\u003c/code\u003e。其中，最常用的当属\u003cstrong\u003ecustom\u003c/strong\u003e：\u003c/p\u003e\n\n```vim\ncommand! -nargs=? -complete=custom,StatusCmpl UBSend exec('py ub_send_item(\u003cf-args\u003e)')\n```\n\n\u003cp\u003e以上代码定义了一个自定义命令\u003cstrong\u003eUBSend\u003c/strong\u003e，它可以获得一个或零个参数（\u003cem\u003e-nargs=?\u003c/em\u003e），如果指定参数，则补全方式采用\u003cstrong\u003ecustom\u003c/strong\u003e，该方式调用一个名为\u003cstrong\u003eStatusCmpl\u003c/strong\u003e的函数并以其返回值作为补全的值域：\u003c/p\u003e\n\n```vim\nfunction! StatusCmpl(ArgLead, CmdLine, CursorPos)\n  return \"draft\\npublish\\nprivate\\npending\\n\"\nendfunction\n```\n\n\u003cp\u003e从以上代码可以看出，该函数需要接受三个参数，返回值应该是一个用换行符“\\n”分割的字符串，在执行补全时，Vim自动使用正则表达式匹配备选项。对于只有一个参数的情况，这种实现方式简单高效。\u003c/p\u003e\n\n\u003cp\u003e对于参数较多的情况，\u003cstrong\u003ecustomlist\u003c/strong\u003e补全方式最为适用：\u003c/p\u003e\n\n```vim\ncommand! -nargs=* -complete=customlist,UBNewCmpl UBNew exec('py ub_new_item(\u003cf-args\u003e)')\n```\n\n\u003cp\u003e以上代码定义了命令\u003cstrong\u003eUBNew\u003c/strong\u003e，\u003cstrong\u003ecustomlist\u003c/strong\u003e补全方式调用函数\u003cstrong\u003eUBNewCmpl\u003c/strong\u003e获取补全的值域：\u003c/p\u003e\n\n```vim\nfunction! UBNewCmpl(ArgLead, CmdLine, CursorPos)\n    let lst = split(a:CmdLine)\n    if len(a:ArgLead)\u003e0\n        let lst = lst[0:-2]\n    endif\n\n    let results = []\n    \" For the first argument, complete the object type\n    if len(lst)==1\n        let objects = ['post','page','tmpl']\n        for obj in objects\n            if stridx(obj,a:ArgLead)==0\n                call add(results,obj)\n            endif\n        endfor\n    \" For the second argument, complete the syntax for :UBNew post or :UBNew\n    \" page\n    elseif len(lst)==2 \u0026\u0026 count(['post', 'page'], lst[1])==1\n        let syntaxes = ['markdown','html','rst','textile','latex']\n        for synx in syntaxes\n            if stridx(synx,a:ArgLead)==0\n                call add(results,synx)\n            endif\n        endfor\n    endif\n    return results\nendfunction\n```\n\n\u003cp\u003e这时侯，前面提到的三个参数就派上用场了。\u003cstrong\u003eArgLead\u003c/strong\u003e是进行补全时，已输入的参数部分，例如输入\u003ccode\u003e:UBNew p\u003c/code\u003e，然后按Tab键，则ArgLead的值就是“p”；\u003cstrong\u003eCmdLine\u003c/strong\u003e是已经输入的命令的全部，按上例，这个参数的值就是“UBNew p”；\u003cstrong\u003eCursorPost\u003c/strong\u003e是当前光标距离命令行开头的字符数。利用这三个参数，就可以判断正在补全命令的第几个参数，进而利用ArgLead筛选该参数的值域。\u003c/p\u003e","title":"Vim自定义命令的参数自动补全"},{"content":"前段时间我把Twitter整合进博客之后，忽然觉得，既然微博已经很重要了，就应该加强它的地位，使其与博客分庭抗礼。于是开始用blueprint做CSS框架，对两三年没变过的iterse做一些调整。\n我对前端不太熟悉，这时候CSS框架的优越性就充分体现出来了，它让页面的布局变得相当容易，尤其是对前端设计最烦人的对多浏览器的兼容问题。现在的主题采用流行的950px宽度，比以前800px要宽裕了不少。其中，三分之一的宽度分给侧边栏，剩余部分留给博客文章列表，仍然采用两栏结构。\n我在页面顶部加了顶栏，将原来侧边栏中的分类、归档、页面、搜索框、RSS订阅全部扔到里面。同时提升Twitter和最新评论列表的位置，增加它们显示条目的数量，以加强这两个时效性和互动性比较强的栏目。\n然后我觉得资讯订阅中的内容也不应该再仅仅局限于博客文章了，应该把我在用的Twitter、豆瓣、Google Reader分享、PicasaWeb等服务中我的资讯也聚合进来。开始的时候打算用Yahoo! Pipes，后来突然发现FriendFeed就可以做这个事，而且更好用，于是将原来烧录的http://feeds.feedburner.com/leninlee指向FriendFeed。\n所以对于订阅原来的FeedBurner烧录的feed的读者，如果希望仍然只订阅博客文章，可以订阅http://feeds.feedburner.com/sinolog。这两个feed都放到了顶栏中，请以各种姿态翻墙订阅。\n2011-06-08 更新\n时隔一天，我认识到一个错误，FriendFeed毕竟还是一个微博，用它聚合个人资讯是不合适的，比如不能全文输出博客文章。最终还是使用Yahoo! Pipes，这货很强大、很好用。\n另外，twitter2rss是支持OAuth的Twitter烧录服务，非常好用。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/burn-personal-info-into-one-feed-using-yahoo-pipes/","summary":"\u003cp\u003e前段时间我把Twitter整合进博客之后，忽然觉得，既然微博已经很重要了，就应该加强它的地位，使其与博客分庭抗礼。于是开始用\u003ca href=\"http://www.blueprintcss.org/\"\u003eblueprint\u003c/a\u003e做CSS框架，对两三年没变过的\u003ca href=\"http://0x3f.org/?p=198\"\u003eiterse\u003c/a\u003e做一些调整。\u003c/p\u003e\n\n\u003cp\u003e我对前端不太熟悉，这时候CSS框架的优越性就充分体现出来了，它让页面的布局变得相当容易，尤其是对前端设计最烦人的对多浏览器的兼容问题。现在的主题采用流行的950px宽度，比以前800px要宽裕了不少。其中，三分之一的宽度分给侧边栏，剩余部分留给博客文章列表，仍然采用两栏结构。\u003c/p\u003e\n\n\u003cp\u003e我在页面顶部加了顶栏，将原来侧边栏中的分类、归档、页面、搜索框、RSS订阅全部扔到里面。同时提升Twitter和最新评论列表的位置，增加它们显示条目的数量，以加强这两个时效性和互动性比较强的栏目。\u003c/p\u003e\n\n\u003cp\u003e然后我觉得资讯订阅中的内容也不应该再仅仅局限于博客文章了，应该把我在用的Twitter、豆瓣、Google Reader分享、PicasaWeb等服务中我的资讯也聚合进来。\u003cdel\u003e开始的时候打算用\u003ca href=\"http://pipes.yahoo.com/\"\u003eYahoo! Pipes\u003c/a\u003e，后来突然发现\u003ca href=\"http://friendfeed.com\"\u003eFriendFeed\u003c/a\u003e就可以做这个事，而且更好用，于是将原来烧录的\u003ca href=\"http://feeds.feedburner.com/leninlee\"\u003ehttp://feeds.feedburner.com/leninlee\u003c/a\u003e指向FriendFeed。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e所以对于订阅原来的FeedBurner烧录的feed的读者，如果希望仍然只订阅博客文章，可以订阅\u003ca href=\"http://feeds.feedburner.com/sinolog\"\u003ehttp://feeds.feedburner.com/sinolog\u003c/a\u003e。这两个feed都放到了顶栏中，请以各种姿态翻墙订阅。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e2011-06-08 更新\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e时隔一天，我认识到一个错误，FriendFeed毕竟还是一个微博，用它聚合个人资讯是不合适的，比如不能全文输出博客文章。最终还是使用Yahoo! Pipes，这货很强大、很好用。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/A47YaQXgVCk4TjIny4MSZQ?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/-XeC4asNS_rU/Te-jeQU1jbI/AAAAAAAABs4/qMPXWNyciuA/s400/2011-06-09.00%25253A33%25253A19.%2525E6%252593%2525B7%2525E5%25258F%252596%2525E9%252581%2525B8%2525E5%25258F%252596%2525E5%25258D%252580%2525E5%25259F%25259F.01.png\" height=\"239\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e另外，\u003ca href=\"http://twitter2rss.com/\"\u003etwitter2rss\u003c/a\u003e是支持OAuth的Twitter烧录服务，非常好用。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"聚合个人资讯"},{"content":"Vim的预览窗口由 :ptag 等命令触发，可用于预览函数定义。但在缺省情况下，预览窗口的高度是固定的，对于注释信息较多的函数，往往不能完全显示注释，而对于注释较少的函数，又会有多余的行浪费屏幕空间。\n下面的函数用于解决这个问题：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 \u0026#34; 调用:ptag命令预览光标所在\u0026lt;word\u0026gt;的定义 \u0026#34; 对类C语言风格的函数/方法定义和注释有效，对其余情况仍沿用:ptag的原有效果 function! PTagIt() exec \u0026#34;ptag \u0026#34;.expand(\u0026#34;\u0026lt;cword\u0026gt;\u0026#34;) let cwin = winnr() silent! wincmd P let lnr = line(\u0026#39;.\u0026#39;) if lnr \u0026lt; 3 return endif if foldlevel(\u0026#39;.\u0026#39;)\u0026gt;0 normal zo endif let chead = 0 let linestr = getline(lnr-1) if linestr =~ \u0026#39;^\\s*\\*/\u0026#39; let ptr = lnr-2 while ptr\u0026gt;0 let linestr = getline(ptr) if linestr =~ \u0026#39;^\\s*/\\*\u0026#39; let chead = ptr break endif let ptr = ptr-1 endwhile endif if chead\u0026gt;0 exec \u0026#39;resize \u0026#39;.(lnr-chead+1) exec \u0026#39;normal \u0026#39;.chead.\u0026#34;z\\\u0026lt;CR\u0026gt;\u0026#34; exec \u0026#39;normal \u0026#39;.lnr.\u0026#39;G\u0026#39; endif exec cwin.\u0026#39;wincmd w\u0026#39; endfunction nmap \u0026lt;leader\u0026gt;pp :call PTagIt()\u0026lt;CR\u0026gt; nmap \u0026lt;leader\u0026gt;pc :pclose\u0026lt;CR\u0026gt; 例如对于如下的函数定义：\n1 2 3 4 5 6 7 /* * 我是一个测试函数 * @param int 我是整型形参 * @param string 我是字符串形参 * @param array 我是返回值 */ function foo($bar1, $bar2) {...} 实际效果为打开的预览窗口将完全显示并只显示以上内容。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/humanize-preview-window-in-vim/","summary":"\u003cp\u003eVim的预览窗口由 \u003ccode\u003e:ptag\u003c/code\u003e 等命令触发，可用于预览函数定义。但在缺省情况下，预览窗口的高度是固定的，对于注释信息较多的函数，往往不能完全显示注释，而对于注释较少的函数，又会有多余的行浪费屏幕空间。\u003c/p\u003e\n\u003cp\u003e下面的函数用于解决这个问题：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; 调用:ptag命令预览光标所在\u0026lt;word\u0026gt;的定义\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; 对类C语言风格的函数/方法定义和注释有效，对其余情况仍沿用:ptag的原有效果\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003ePTagIt\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eexec\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ptag \u0026#34;\u003c/span\u003e.\u003cspan class=\"nx\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;cword\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ecwin\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ewinnr\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003esilent\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003ewincmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eP\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003elnr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003elnr\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003efoldlevel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026gt;\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003enormal\u003c/span\u003e \u003cspan class=\"nx\"\u003ezo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003echead\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003elinestr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003egetline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elnr\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003elinestr\u003c/span\u003e \u003cspan class=\"p\"\u003e=~\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;^\\s*\\*/\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003elnr\u003c/span\u003e\u003cspan class=\"m\"\u003e-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ewhile\u003c/span\u003e \u003cspan class=\"nx\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003elinestr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003egetline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003elinestr\u003c/span\u003e \u003cspan class=\"p\"\u003e=~\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;^\\s*/\\*\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003echead\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eptr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nx\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eptr\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eendwhile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003echead\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eexec\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;resize \u0026#39;\u003c/span\u003e.\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elnr\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003echead\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eexec\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;normal \u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003echead\u003c/span\u003e.\u003cspan class=\"s2\"\u003e\u0026#34;z\\\u0026lt;CR\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eexec\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;normal \u0026#39;\u003c/span\u003e.\u003cspan class=\"nx\"\u003elnr\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;G\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eexec\u003c/span\u003e \u003cspan class=\"nx\"\u003ecwin\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;wincmd w\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003enmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003epp\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003ePTagIt\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003enmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003epc\u003c/span\u003e :\u003cspan class=\"nx\"\u003epclose\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e例如对于如下的函数定义：\u003c/p\u003e","title":"人性化Vim的预览窗口"},{"content":"ack是一个perl脚本，是grep的一个可选替换。\n有以下优势：\n为程序员设计，使用方便，输入较少 默认递归搜索 缺省提供多种文件类型供选，文件类型对应的后缀名可修改 使用perl的正则表达式，而grep只支持其一个子集 搜索结果高亮输出 很多人以讹传讹，使人容易对ack的搜索速度产生误解。ack的官方宣传中说比grep快，其前提是ack可方便地针对部分后缀的文件进行搜索，而grep默认对所有文件搜索。ack的官方文档中明确指出，在对大量文件进行搜索时，grep的速度还是最快的。\n~/.ackrc 使用此配置文件存储ack的常用选项。\n-i --type-add php=.lib\n如上所示，该文件中每一行应该是ack命令行参数中用空格分隔的一个部分。\n例子 如果搜索的关键词是正则表达式，在Linux下必须将其用双引号包围起来。\n如：\n```bash ack \"gbldb\\s*=\" ``` Windows下的安装 安装strawberryperl 保存ack.pl到C:\\bin ```dos @echo off perl.exe c:/bin/ack.pl %* ``` 将C:\\bin加入环境变量%PATH% 资源 ack.vim: Vim使用ack的辅助扩展 Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/use-ack-as-an-alternative-to-grep/","summary":"\u003cp\u003e\u003ca href=\"http://betterthangrep.com\"\u003eack\u003c/a\u003e是一个perl脚本，是grep的一个可选替换。\u003c/p\u003e\n\n\u003cp\u003e有以下优势：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e为程序员设计，使用方便，输入较少\n\u003cul\u003e\n\u003cli\u003e默认递归搜索\u003c/li\u003e\n\u003cli\u003e缺省提供多种文件类型供选，文件类型对应的后缀名可修改\u003c/li\u003e\n\u003c/ul\u003e\u003c/li\u003e\n\u003cli\u003e使用perl的正则表达式，而grep只支持其一个子集\u003c/li\u003e\n\u003cli\u003e搜索结果高亮输出\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e很多人以讹传讹，使人容易对ack的搜索速度产生误解。ack的官方宣传中说比grep快，其前提是ack可方便地针对部分后缀的文件进行搜索，而grep默认对所有文件搜索。ack的官方文档中明确指出，在对大量文件进行搜索时，grep的速度还是最快的。\u003c/p\u003e\n\n\u003ch2\u003e~/.ackrc\u003c/h2\u003e\n\n\u003cp\u003e使用此配置文件存储ack的常用选项。\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003e-i\n  --type-add\n  php=.lib\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e如上所示，该文件中每一行应该是ack命令行参数中用空格分隔的一个部分。\u003c/p\u003e\n\n\u003ch2\u003e例子\u003c/h2\u003e\n\n\u003cp\u003e如果搜索的关键词是正则表达式，在Linux下必须将其用双引号包围起来。\u003c/p\u003e\n\n\u003cp\u003e如：\u003c/p\u003e\n\n```bash\nack \"gbldb\\s*=\"\n```\n\n\u003ch2\u003eWindows下的安装\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e安装\u003ca href=\"http://strawberryperl.com\"\u003estrawberryperl\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e保存\u003ca href=\"http://betterthangrep.com/ack-standalone\"\u003eack.pl\u003c/a\u003e到\u003cem\u003eC:\\bin\u003c/em\u003e\u003c/li\u003e\n```dos\n@echo off\nperl.exe c:/bin/ack.pl %*\n```\n\u003cli\u003e将\u003cem\u003eC:\\bin\u003c/em\u003e加入环境变量\u003cstrong\u003e%PATH%\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e资源\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=2572\"\u003eack.vim\u003c/a\u003e: Vim使用ack的辅助扩展\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"ack: grep的同类替代品"},{"content":"昨天晚上在杭州飞北京的飞机上读完了这本书，用Kindle DXG。\n作者是江苏科技大学的一位外籍老师，所以这本书也很有教科书的风格，先用一章的篇幅介绍Linux的相关概念和日常操作，而后通过和Apache的对比讲述了Nginx的主要特性，并使用Wordpress、MediaWiki等作了实例讲解。面面俱到，简单易懂，但并不深入。\n目前介绍Nginx的书还不多，这本算得上是其中很好的一本。但是前六十页都是介绍Linux的基本概念，和后面的内容关系不大，显得很突兀，且很不KISS，对于一本只有三百多页的小书来说，这个篇幅很令人遐想。抛开这一点，这本书当属眼下入门Nginx的优秀指南。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/after-reading-nginx-http-server/","summary":"\u003cp\u003e昨天晚上在杭州飞北京的飞机上读完了这本书，用Kindle DXG。\u003c/p\u003e\n\n\u003cp\u003e作者是江苏科技大学的一位外籍老师，所以这本书也很有教科书的风格，先用一章的篇幅介绍Linux的相关概念和日常操作，而后通过和Apache的对比讲述了Nginx的主要特性，并使用Wordpress、MediaWiki等作了实例讲解。面面俱到，简单易懂，但并不深入。\u003c/p\u003e\n\n\u003cp\u003e目前介绍Nginx的书还不多，这本算得上是其中很好的一本。但是前六十页都是介绍Linux的基本概念，和后面的内容关系不大，显得很突兀，且很不KISS，对于一本只有三百多页的小书来说，这个篇幅很令人遐想。抛开这一点，这本书当属眼下入门Nginx的优秀指南。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/1wfTXx_Zpcr1BVlrh5KD_A?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/_ceUJ_lBTHzc/TbrPHzzLMJI/AAAAAAAABqY/2cOJEsushfU/s400/1.png\" height=\"400\" width=\"309\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"读完《Nginx HTTP Server》"},{"content":"同时对以下几种PHP的序列化方案进行了测试：\nserialize() and unserialize() json_encode() and json_decode() msgpack_serialize() and msgpack_unserialize() igbinary_serialize() and igbinary_unserialize() 测试环境：\nOS: Archlinux 32-bit CPU: CORE 2 DUO T9400, 2.53GHz Mem: DDR3, 3G Server: nginx v1.0.0 PHP: php v5.3.6 + php-fpm Profiler: xhprof v0.9.2 测试代码块：\n```php \u003c?php class Test{ function __construct(){ $this-\u003evalue = str_repeat('a', 1000); } } function produce($num) { $arr = array(); for ($i = 0; $i \u003c $num; $i++) { $arr[] = new Test(); } $data = serialize($arr); $arr = unserialize($data); $data = json_encode($arr); $arr = json_decode($data); $data = msgpack_serialize($arr); $arr = msgpack_unserialize($data); $data = igbinary_serialize($arr); $arr = igbinary_unserialize($data); } produce(10000); ?\u003e ``` 测试结果：\n序列化性能：serialize() 24.611ms \u0026gt; msgpack_serialize() 32.687ms \u0026gt; igbinary_serialize() 36.012ms \u0026gt; json_encode() 132.142ms 反序列化性能：igbinary_unserialize() 12.141ms \u0026gt; msgpack_unserialize() 17.185ms \u0026gt; unserialize() 28.723ms \u0026gt; json_decode() 183.141ms 综合性能：igbinary 48.153ms \u0026gt; msgpack 49.872ms \u0026gt; serialize 53.334ms \u0026gt; json 315.283ms 测试结果并没有像传说中的那样，官方的序列化和反序列化函数性能与msgpack和igbinary两个第三方的扩展相差不大，而JSON性能非常差。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/comparison-of-serialization-methods-of-php/","summary":"\u003cp\u003e同时对以下几种PHP的序列化方案进行了测试：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eserialize() and unserialize()\u003c/li\u003e\n\u003cli\u003ejson_encode() and json_decode()\u003c/li\u003e\n\u003cli\u003emsgpack_serialize() and msgpack_unserialize()\u003c/li\u003e\n\u003cli\u003eigbinary_serialize() and igbinary_unserialize()\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e测试环境：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eOS:        Archlinux 32-bit\u003c/li\u003e\n\u003cli\u003eCPU:       CORE 2 DUO T9400, 2.53GHz\u003c/li\u003e\n\u003cli\u003eMem:       DDR3, 3G\u003c/li\u003e\n\u003cli\u003eServer:    nginx v1.0.0\u003c/li\u003e\n\u003cli\u003ePHP:       php v5.3.6 + php-fpm\u003c/li\u003e\n\u003cli\u003eProfiler:  xhprof v0.9.2\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e测试代码块：\u003c/p\u003e\n\n```php\n\u003c?php\nclass Test{\n    function __construct(){\n        $this-\u003evalue = str_repeat('a', 1000);\n    }\n}\n\nfunction produce($num)\n{\n    $arr = array();\n    for ($i = 0; $i \u003c $num; $i++) {\n        $arr[] = new Test();\n    }\n\n    $data = serialize($arr);\n\n    $arr = unserialize($data);\n\n    $data = json_encode($arr);\n\n    $arr = json_decode($data);\n\n    $data = msgpack_serialize($arr);\n\n    $arr = msgpack_unserialize($data);\n\n    $data = igbinary_serialize($arr);\n\n    $arr = igbinary_unserialize($data);\n}\n\nproduce(10000);\n?\u003e\n```\n\n\u003cp\u003e测试结果：\u003c/p\u003e","title":"PHP序列化方案效率比较"},{"content":"对于博客已死的说法，我一点都不感到奇怪。早在几年前博客还比较火的时候我就表达过对博客泡沫的看法。\n经历了短暂的tumblog的风头，微博成为现在最火的媒介。说博客已死，无非就是说微博将成为个人信息传播的主流。好吧，现在我知道那时候我所说的不懂什么是博客的人都去干什么了。\n但是博客还是会继续发展，微博的兴起只会减少滥竽充数。因为微博突出的是时效性，最缺乏的是系统性和可重复更新的能力。微博的短处，正是博客的长处。这让我对博客有了一个新的、迟到了很久的认识──一个好的博客，它的文章不应该是写掉就忘的，而应该是不断地更新著的。\nUltraBlog.vim就是出于这个需要而写的。\n我对博客客户端的使用大概可以追溯到四五年前，那时候博客正火，在比较了几个BSP后选择了中国博客网，就是因为他们提供桌面客户端。后来独博之后也试用过几个通用的客户端，但都没坚持多久，最根本的原因是它们几乎无一例外地都是WYSIWYG。而WYSIWYG的编辑器生成的HTML源码几乎都使用inline的样式，这就导致文章的排版布局很难控制，我对WYSIWYG其实是很抵触的，至今都不怎么用Office这类东西。\n后来我意识到，我所需要的是样式与内容分离，于是准备自己写一个客户端，后来由于工作的原因不了了之。与此同时，我自定义了一套文章格式并用Java写了一个转换文章到HTML的工具，直到后来发现Markdown，我才知道我其实是需要一个轻量标记语言。\n使用Markdown之后，写博客开始变得轻松愉快。我一度用过一段时间SciTE，还用Lua写了个辅助脚本。但是我需要一个完整的客户端来管理文章，而这是一个编辑器所不能胜任的，所以就著手实现一个支持Markdown的客户端。这一次走得比较远，ForeverFantasy最终达到了可用的程度，我一度用它写过一段时间的博客。但是作为一个Vim重症患者，wxPython的编辑器部件是远远达不到我需要的水平的。虽然后来还实现了调用外部程序处理文章内容（当然也可以调用Vim），但总归觉得不舒服，至今已经一年没更新了。\n直到前段时间试用了一下VimRepress，在修改这个插件的时候突然受到启发，我这几年的需求原来是可以这么简单地解决的。\n其实在几年前vimpress刚刚发布的时候我就了解过这个东西，包括此后接连发布的几个Vim写博客的插件，它们和我原来写的SciTE的那个辅助脚本没有本质的区别，都是博客编辑器。与完整的客户端相比，编辑器缺少对本地文章源码的管理，而且它们不记录文章源码和发布的文章的关联关系，简单地说是无状态的。这不符合博客文章持续更新的观点。\nUltraBlog.vim使用SQLAlchemy做数据库抽象层，将所有文章的源码及其状态保存在本地的一个SQLite数据库中，并且以此为基础，通过XMLRPC接口实现对博客文章、页面的CRUD操作。同时利用Vim分模式的特点实现了可分页的文章列表和文章编辑视图。\nUltraBlog.vim目前支持Markdown和HTML两种格式的文章，它最大的特点是在Markdown格式的源码和发布到博客中的文章之间建立联系，你可以随时修改本地数据库中的Markdown源码并更新博客中对应的文章。\n新的功能还会不断地加入。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-development-note/","summary":"\u003cp\u003e对于\u003ca href=\"http://blog.sina.com.cn/s/blog_694377f90100rmko.html\"\u003e博客已死\u003c/a\u003e的说法，我一点都不感到奇怪。早在几年前博客还比较火的时候我就表达过对博客泡沫的\u003ca href=\"http://0x3f.org/?p=209\"\u003e看法\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e经历了短暂的\u003ca href=\"http://0x3f.org/?p=354\"\u003etumblog\u003c/a\u003e的风头，微博成为现在最火的媒介。说博客已死，无非就是说微博将成为个人信息传播的主流。好吧，现在我知道那时候我所说的不懂什么是博客的人都去干什么了。\u003c/p\u003e\n\n\u003cp\u003e但是博客还是会继续发展，微博的兴起只会减少滥竽充数。因为微博突出的是时效性，最缺乏的是系统性和可重复更新的能力。微博的短处，正是博客的长处。这让我对博客有了一个新的、迟到了很久的认识──一个好的博客，它的文章不应该是写掉就忘的，而应该是不断地更新著的。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e就是出于这个需要而写的。\u003c/p\u003e\n\n\u003cp\u003e我对博客客户端的使用大概可以追溯到四五年前，那时候博客正火，在比较了几个\u003ca href=\"http://en.wikipedia.org/wiki/Blog_service_provider\"\u003eBSP\u003c/a\u003e后选择了\u003ca href=\"http://www.blogcn.com/\"\u003e中国博客网\u003c/a\u003e，就是因为他们提供桌面客户端。后来独博之后也试用过几个通用的客户端，但都没坚持多久，最根本的原因是它们几乎无一例外地都是\u003ca href=\"http://zh.wikipedia.org/wiki/%E6%89%80%E8%A6%8B%E5%8D%B3%E6%89%80%E5%BE%97\"\u003eWYSIWYG\u003c/a\u003e。而WYSIWYG的编辑器生成的HTML源码几乎都使用inline的样式，这就导致文章的排版布局很难控制，我对WYSIWYG其实是很抵触的，至今都不怎么用Office这类东西。\u003c/p\u003e\n\n\u003cp\u003e后来我意识到，我所需要的是样式与内容分离，于是准备自己写一个\u003ca href=\"http://0x3f.org/?p=331\"\u003e客户端\u003c/a\u003e，后来由于工作的原因不了了之。与此同时，我自定义了一套文章格式并用Java写了一个转换文章到HTML的\u003ca href=\"http://0x3f.org/?p=342\"\u003e工具\u003c/a\u003e，直到后来发现\u003ca href=\"http://0x3f.org/?p=383\"\u003eMarkdown\u003c/a\u003e，我才知道我其实是需要一个轻量标记语言。\u003c/p\u003e\n\n\u003cp\u003e使用Markdown之后，写博客开始变得轻松愉快。我一度用过一段时间\u003ca href=\"http://www.scintilla.org/SciTE.html\"\u003eSciTE\u003c/a\u003e，还用\u003ca href=\"http://zh.wikipedia.org/wiki/Lua\"\u003eLua\u003c/a\u003e写了个\u003ca href=\"http://0x3f.org/?p=499\"\u003e辅助脚本\u003c/a\u003e。但是我需要一个完整的客户端来管理文章，而这是一个编辑器所不能胜任的，所以就著手实现一个支持Markdown的\u003ca href=\"http://0x3f.org/?p=812\"\u003e客户端\u003c/a\u003e。这一次走得比较远，\u003ca href=\"http://0x3f.org/?p=812\"\u003eForeverFantasy\u003c/a\u003e最终达到了可用的程度，我一度用它写过一段时间的博客。但是作为一个Vim重症患者，wxPython的编辑器部件是远远达不到我需要的水平的。虽然后来还\u003ca href=\"http://0x3f.org/?p=1409\"\u003e实现\u003c/a\u003e了调用外部程序处理文章内容（\u003cem\u003e当然也可以调用Vim\u003c/em\u003e），但总归觉得不舒服，至今已经一年没更新了。\u003c/p\u003e\n\n\u003cp\u003e直到前段时间试用了一下\u003ca href=\"http://0x3f.org/?p=1861\"\u003eVimRepress\u003c/a\u003e，在修改这个插件的时候突然受到启发，我这几年的需求原来是可以这么简单地解决的。\u003c/p\u003e\n\n\u003cp\u003e其实在几年前\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=1953\"\u003evimpress\u003c/a\u003e刚刚发布的时候我就了解过这个东西，包括此后接连发布的几个Vim写博客的插件，它们和我原来写的SciTE的那个辅助脚本没有本质的区别，都是博客编辑器。与完整的客户端相比，编辑器缺少对本地文章源码的管理，而且它们不记录文章源码和发布的文章的关联关系，简单地说是无状态的。这不符合博客文章持续更新的观点。\u003c/p\u003e\n\n\u003cp\u003eUltraBlog.vim使用\u003ca href=\"http://www.sqlalchemy.org/\"\u003eSQLAlchemy\u003c/a\u003e做数据库抽象层，将所有文章的源码及其状态保存在本地的一个SQLite数据库中，并且以此为基础，通过\u003ca href=\"http://en.wikipedia.org/wiki/XML-RPC\"\u003eXMLRPC\u003c/a\u003e接口实现对博客文章、页面的\u003ca href=\"http://en.wikipedia.org/wiki/Create,_read,_update_and_delete\"\u003eCRUD\u003c/a\u003e操作。同时利用Vim分模式的特点实现了可分页的文章列表和文章编辑视图。\u003c/p\u003e\n\n\u003cp\u003eUltraBlog.vim目前支持Markdown和HTML两种格式的文章，它最大的特点是在Markdown格式的源码和发布到博客中的文章之间建立联系，你可以随时修改本地数据库中的Markdown源码并更新博客中对应的文章。\u003c/p\u003e\n\n\u003cp\u003e新的功能还会不断地加入。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"UltraBlog.vim开发手记"},{"content":"在保福寺桥南下了车我就迷失了，作为一个G7er，问路太跌份，于是自信满满地祭出G7，结果Google导航很淡定地告诉我──您所在的区域不支持导航！有木有搞错，有木有，有木有，有木有啊！最后在3G、GPS、电子指南针全开的情况下，跟著Google地图上的小箭头在中关村南街、中关村三街流窜了半个小时，后来我才知道，我规则地绕中科院研究生院做了一次顺时针圆周运动。\n好吧，我最后还是人肉到目的地的，感谢给我指路的朋友，他让我终于找到了那条隐藏地很深的小路，你敢隐藏得再深一点吗？！\n有时侯这个世界真的很给力，当我比原定时间晚半个多钟头到达会场的时候，他们居然还没有开始！\n爱美丽宣布开会：\n程大龙介绍GNOME 3：\n这小哥儿原来是北航的，后生可畏啊，当初我开始玩儿Linux的时候他刚脱离李雷和韩梅梅吧。\n来一张火爆的：\n今天最意外的亮点就是这个什么××××协会的西班牙舞了，开始、中间和结束的时候各来了一段，俺们红小兵也看不懂，就是感觉很劲爆，反正只要是不规则的事物我都喜欢。\n其它的，两岸三地的视频会议很失败，搞个高速VPN不行吗？瞻仰了传说中的Vincent，小哥儿比我还胖，我很欣慰。在Twitter上看到了林健桑拍的热舞照片，感觉他坐得离我不远，把坐我前面的都遍历了一遍却没找到，谁知道居然在我后面。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/gnome3-launch-party/","summary":"\u003cp\u003e在保福寺桥南下了车我就迷失了，作为一个G7er，问路太跌份，于是自信满满地祭出G7，结果Google导航很淡定地告诉我──您所在的区域不支持导航！有木有搞错，有木有，有木有，有木有啊！最后在3G、GPS、电子指南针全开的情况下，跟著Google地图上的小箭头在中关村南街、中关村三街流窜了半个小时，后来我才知道，我规则地绕中科院研究生院做了一次顺时针圆周运动。\u003c/p\u003e\n\n\u003cp\u003e好吧，我最后还是人肉到目的地的，感谢给我指路的朋友，他让我终于找到了那条隐藏地很深的小路，你敢隐藏得再深一点吗？！\u003c/p\u003e\n\n\u003cp\u003e有时侯这个世界真的很给力，当我比原定时间晚半个多钟头到达会场的时候，他们居然还没有开始！\u003c/p\u003e\n\n\u003cp\u003e爱美丽宣布开会：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/MBRi_eVDmFJ4jzfOMIq-YQ?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/_ceUJ_lBTHzc/TaBbMJwy5MI/AAAAAAAABoo/lIaHTDG2iVA/s400/C360_2011-04-09%2014-24-03.jpg\" height=\"300\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e程大龙介绍GNOME 3：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/Hh7BSY-1iIYZoP-PyK_SbA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/_ceUJ_lBTHzc/TaBbNKxxCrI/AAAAAAAABoc/-gYdCmNOF8k/s400/C360_2011-04-09%2014-59-44.jpg\" height=\"300\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e这小哥儿原来是北航的，后生可畏啊，当初我开始玩儿Linux的时候他刚脱离李雷和韩梅梅吧。\u003c/p\u003e\n\n\u003cp\u003e来一张火爆的：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/8_v2QCOBajRfOlxI92AL3Q?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh4.googleusercontent.com/_ceUJ_lBTHzc/TaBbO4X4PcI/AAAAAAAABok/9mgCyktfICk/s400/C360_2011-04-09%2016-29-59.jpg\" height=\"300\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e今天最意外的亮点就是这个什么××××协会的西班牙舞了，开始、中间和结束的时候各来了一段，俺们红小兵也看不懂，就是感觉很劲爆，反正只要是不规则的事物我都喜欢。\u003c/p\u003e\n\n\u003cp\u003e其它的，两岸三地的视频会议很失败，搞个高速VPN不行吗？瞻仰了传说中的Vincent，小哥儿比我还胖，我很欣慰。在Twitter上看到了\u003ca href=\"http://blog.linjian.org/\"\u003e林健\u003c/a\u003e桑拍的热舞照片，感觉他坐得离我不远，把坐我前面的都遍历了一遍却没找到，谁知道居然在我后面。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"GNOME 3 Launch Party"},{"content":"Navicat是一套商业软件，但是它的免费版Navicat Lite已足够好用。作为一套数据库客户端，它具有以下特性：\n支持Microsoft SQL Server、Oracle、MySQL、PostgreSQL、SQLite五个最常见的关系数据库。 占用系统资源少，轻便快捷 功能较为全面，使用方便 跨平台 我使用Navicat完成一般的数据库操作，这样可以无须在多种数据库的官方客户端之间来回切换，而且对于速度不快的机器来说，Navicat轻量的优势是很明显的。\nNavicat另外一个为人所忽略的优点是对SQLite的支持，我曾花不少时间找一个好的SQLite的客户端，大部分搜索结果都介绍的是另外一个Sqliteman，但是我始终不能习惯它，感觉这个东西功能少而且不好用。直到发现Navicat，才算找到一个完善的SQLite客户端。\n对于跨平台的特性，Navicat对Linux平台的支持其实是通过wine实现的，好在其安装包对wine已做过定制，运行状况良好。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/navicat-a-light-weight-database-client/","summary":"\u003cp\u003e\u003ca href=\"http://www.navicat.com/en/\"\u003eNavicat\u003c/a\u003e是一套商业软件，但是它的免费版Navicat Lite已足够好用。作为一套数据库客户端，它具有以下特性：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e支持Microsoft SQL Server、Oracle、MySQL、PostgreSQL、SQLite五个最常见的关系数据库。\u003c/li\u003e\n\u003cli\u003e占用系统资源少，轻便快捷\u003c/li\u003e\n\u003cli\u003e功能较为全面，使用方便\u003c/li\u003e\n\u003cli\u003e跨平台\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e我使用Navicat完成一般的数据库操作，这样可以无须在多种数据库的官方客户端之间来回切换，而且对于速度不快的机器来说，Navicat轻量的优势是很明显的。\u003c/p\u003e\n\n\u003cp\u003eNavicat另外一个为人所忽略的优点是对SQLite的支持，我曾花不少时间找一个好的SQLite的客户端，大部分搜索结果都介绍的是另外一个\u003ca href=\"http://sqliteman.com/\"\u003eSqliteman\u003c/a\u003e，但是我始终不能习惯它，感觉这个东西功能少而且不好用。直到发现Navicat，才算找到一个完善的SQLite客户端。\u003c/p\u003e\n\n\u003cp\u003e对于跨平台的特性，Navicat对Linux平台的支持其实是通过wine实现的，好在其安装包对wine已做过定制，运行状况良好。\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"Navicat: 轻量的多数据库客户端"},{"content":"终于决定放弃使用了三年多的iG:Syntax Hiliter，将代码语法高亮插件换成WP-Syntax。\n原因是Vim的Markdown语法高亮插件有问题，会把iG的标签[LANG]当作Markdown的超链接处理，结果导致插入代码后，后面的内容被错误地著色，很难看。而Syntax使用\u0026lt;pre lang=\"LANG\"\u0026gt;格式的标签，不会有这个问题。\n其实很早就想过要换了，只是受累于使用iG进行高亮的文章太多，替换起来不方便。加上后来解决了由于iG停止更新导致的不支持更多的语法的问题，所以就一致拖到现在。今天晚上花了一个小时就完成了替换，比想象中的要容易地多。\n根据我使用过的语法的情况，使用以下语句在数据库中替换iG的标签到Syntax的标签：\n```sql update wp_posts set post_content=replace(post_content,'[bash]','\u0026lt;pre lang=\"bash\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/bash]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[python]','\u0026lt;pre lang=\"python\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/python]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[vim]','\u0026lt;pre lang=\"vim\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/vim]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[java]','\u0026lt;pre lang=\"java\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/java]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[lua]','\u0026lt;pre lang=\"lua\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/lua]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[sql]','\u0026lt;pre lang=\"sql\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/sql]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[plsql]','\u0026lt;pre lang=\"plsql\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/plsql]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[php]','\u0026lt;pre lang=\"php\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/php]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[cpp]','\u0026lt;pre lang=\"cpp\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/cpp]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[inno]','\u0026lt;pre lang=\"inno\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/inno]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[xml]','\u0026lt;pre lang=\"xml\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/xml]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[html]','\u0026lt;pre lang=\"html4strict\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/html]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[ini]','\u0026lt;pre lang=\"ini\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/ini]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[pascal]','\u0026lt;pre lang=\"pascal\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/pascal]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[javascript]','\u0026lt;pre lang=\"javascript\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/javascript]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[reg]','\u0026lt;pre lang=\"reg\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/reg]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'[css]','\u0026lt;pre lang=\"css\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'[/css]','\u0026lt;/pre\u0026gt;'); update wp_posts set post_content=replace(post_content,'\u0026lt;coolcode LANG=\"php\"\u0026gt;','\u0026lt;pre lang=\"php\" line=\"1\"\u0026gt;'); update wp_posts set post_content=replace(post_content,'\u0026lt;/coolcode\u0026gt;','\u0026lt;/pre\u0026gt;'); ``` 即便转换到Syntax，也不能避免Vim中Markdown语法高亮的问题，只要文字中出现成对的方括号，仍然会出问题，正确的做法是对HTML标签中的内容不进行Markdown语法的著色。\n在转换和写这篇文章的过程中，发现WP-Syntax还存在一些问题，例如启用行号后部分表格不能充满页面宽度的问题，还有上面这些SQL语句，必须将其中的尖括号替换成HTML实体才能正常显示。看来虽然历经两三年的发展，WP-Syntax还是不很成熟。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/migrate-from-igsyntax-hiliter-to-wp-syntax/","summary":"\u003cp\u003e终于决定放弃使用了\u003ca href=\"http://0x3f.org/?p=342\"\u003e三年多\u003c/a\u003e的iG:Syntax Hiliter，将代码语法高亮插件换成\u003ca href=\"http://wordpress.org/extend/plugins/wp-syntax/\"\u003eWP-Syntax\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e原因是Vim的Markdown语法高亮\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=2882\"\u003e插件\u003c/a\u003e有问题，会把iG的标签\u003ccode\u003e[LANG]\u003c/code\u003e当作Markdown的超链接处理，结果导致插入代码后，后面的内容被错误地著色，很难看。而Syntax使用\u003ccode\u003e\u0026lt;pre lang=\"LANG\"\u0026gt;\u003c/code\u003e格式的标签，不会有这个问题。\u003c/p\u003e\n\n\u003cp\u003e其实很早就想过要换了，只是受累于使用iG进行高亮的文章太多，替换起来不方便。加上后来\u003ca href=\"http://0x3f.org/?p=501\"\u003e解决\u003c/a\u003e了由于iG停止更新导致的不支持更多的语法的问题，所以就一致拖到现在。今天晚上花了一个小时就完成了替换，比想象中的要容易地多。\u003c/p\u003e\n\n\u003cp\u003e根据我使用过的语法的情况，使用以下语句在数据库中替换iG的标签到Syntax的标签：\u003c/p\u003e\n\n```sql\nupdate wp_posts set post_content=replace(post_content,'[bash]','\u0026lt;pre lang=\"bash\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/bash]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[python]','\u0026lt;pre lang=\"python\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/python]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[vim]','\u0026lt;pre lang=\"vim\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/vim]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[java]','\u0026lt;pre lang=\"java\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/java]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[lua]','\u0026lt;pre lang=\"lua\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/lua]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[sql]','\u0026lt;pre lang=\"sql\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/sql]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[plsql]','\u0026lt;pre lang=\"plsql\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/plsql]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[php]','\u0026lt;pre lang=\"php\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/php]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[cpp]','\u0026lt;pre lang=\"cpp\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/cpp]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[inno]','\u0026lt;pre lang=\"inno\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/inno]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[xml]','\u0026lt;pre lang=\"xml\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/xml]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[html]','\u0026lt;pre lang=\"html4strict\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/html]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[ini]','\u0026lt;pre lang=\"ini\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/ini]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[pascal]','\u0026lt;pre lang=\"pascal\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/pascal]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[javascript]','\u0026lt;pre lang=\"javascript\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/javascript]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[reg]','\u0026lt;pre lang=\"reg\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/reg]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[css]','\u0026lt;pre lang=\"css\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'[/css]','\u0026lt;/pre\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'\u0026lt;coolcode LANG=\"php\"\u0026gt;','\u0026lt;pre lang=\"php\" line=\"1\"\u0026gt;');\nupdate wp_posts set post_content=replace(post_content,'\u0026lt;/coolcode\u0026gt;','\u0026lt;/pre\u0026gt;');\n```\n\n\u003cp\u003e即便转换到Syntax，也不能避免Vim中Markdown语法高亮的问题，只要文字中出现成对的方括号，仍然会出问题，正确的做法是对HTML标签中的内容不进行Markdown语法的著色。\u003c/p\u003e","title":"从iG:Syntax Hiliter转换到WP-Syntax"},{"content":"如果说Orta最大的特点，就是凸凹有致。它的主要组件都突出了这个特点，加上对细节的表现很细致，整个主题给人以很舒服的感觉。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/orta-a-pretty-gtk-theme/","summary":"\u003cp\u003e如果说\u003ca href=\"http://skiesofazel.deviantart.com/art/Orta-184118297\"\u003eOrta\u003c/a\u003e最大的特点，就是凸凹有致。它的主要组件都突出了这个特点，加上对细节的表现很细致，整个主题给人以很舒服的感觉。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/wwLFAQ5QZ1dR1UrhYYdxZA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/_ceUJ_lBTHzc/TZk3aLmNBTI/AAAAAAAABno/dOle8elWvtA/s800/2011-04-04.11%3A20%3A09.Gtk%2B%202.0%20Change%20Theme.01.png\" height=\"474\" width=\"413\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"Orta: 凸凹有致的GTK主题"},{"content":"在非GNOME桌面环境中，运行TweetDeck会报如下错误：\nOoops, TweetDeck can't find your data TweetDeck is having trouble using some of your passwords that are stored securely on your machine. Clicking submit will clear this data so that you continue to use TweetDeck.\n原因是Adobe Air将密码保存在GNOME的Keyring里，而此时Air找不到GNOME的相关守护进程gnome-keyring-daemon。\n使用如下脚本启动之：\n```bash #!/bin/bash GNOME_KEYRING=`pidof gnome-keyring-daemon` GNOME_DESKTOP_SESSION_ID=$GNOME_KEYRING /usr/bin/tweetdeck \u0026 ``` Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/howto-use-tweetdeck-out-of-gnome/","summary":"\u003cp\u003e在非GNOME桌面环境中，运行TweetDeck会报如下错误：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eOoops, TweetDeck can't find your data\n  TweetDeck is having trouble using some of your passwords that are stored securely on your machine. Clicking submit will clear this data so that you continue to use TweetDeck.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e原因是Adobe Air将密码保存在GNOME的Keyring里，而此时Air找不到GNOME的相关守护进程\u003cstrong\u003egnome-keyring-daemon\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e使用如下脚本启动之：\u003c/p\u003e\n\n\u003cp\u003e\n```bash\n#!/bin/bash\nGNOME_KEYRING=`pidof gnome-keyring-daemon`\nGNOME_DESKTOP_SESSION_ID=$GNOME_KEYRING /usr/bin/tweetdeck \u0026\n```\n\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"在非GNOME环境中使用TweetDeck"},{"content":"Soothe给人的感觉是细致而且柔和，不易于产生视觉疲劳，这正对我的胃口。更完美的是，它支持虚线焦点框，对于喜欢使用键盘的Rox-filer重症患者来说很重要。\nPosted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/gtk-theme-soothe/","summary":"\u003cp\u003e\u003ca href=\"http://lassekongo83.deviantart.com/art/Soothe-199342656\"\u003eSoothe\u003c/a\u003e给人的感觉是细致而且柔和，不易于产生视觉疲劳，这正对我的胃口。更完美的是，它支持虚线焦点框，对于喜欢使用键盘的Rox-filer重症患者来说很重要。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/MvcanM-ssxnIsXgEMvfmaA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/_ceUJ_lBTHzc/TZk3aFUwttI/AAAAAAAABnk/ncEW0uYbqJM/s800/2011-04-04.11%3A17%3A30.Gtk%2B%202.0%20Change%20Theme.01.png\" height=\"474\" width=\"411\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePosted via \u003ca href=\"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/\"\u003eUltraBlog.vim\u003c/a\u003e.\u003c/p\u003e","title":"Soothe: 柔和细致的GTK主题"},{"content":"Introduction UltraBlog.vim is yet another Vim blogging script for Wordpress.\nThe biggest difference between UB and other similar scripts is that UB is an ultimate client, which stores posts locally in an SQLite database, while others just operate remotely. In this way, many things can be done easily by the advantage of local storage and many other utilities, for example, you can search for posts stored in the database with a few keywords by typing a simple command, also you can preview drafts with any of your favorite templates as soon as you want to.\nFor those who just needs a lightweight blog editor similar as other Vim blogging scripts, UB also comes with an Editor Mode, which doesn\u0026rsquo;t create a database and store data in it.\nIn addition, UB is tending to make life easier for writing posts with many kinds of lightweight markup languages, currently the following kinds are supported: Markdown, reStructuredText, LaTeX, Textile and of cause HTML.\nEnjoy Vim blogging !\nHere is a post written in Chinese describing the motion for which I wrote UltraBlog.vim.\nFeatures Multiple syntax support: Markdown, HTML, reStructuredText, LaTeX, Textile. Editor mode and client mode. Data is stored in a local SQLite database in client mode. Full-text search with keywords highlighted. Full-text search by using regular expressions. Full-text substitutions. Full-text substitutions using regular expressions. Templates for previewing posts. Built-in web browser, much faster to preview items. Event-driven system. I18N. Tutorial Requirement UltraBlog.vim takes advantages from the following techs:\nVim with python support SQLAlchemy v0.7 or newer python-markdown or python-markdown2 pandoc You must have these prerequisites met before using UltraBlog.vim. For more information, refer to UltraBlog_Prerequisites in the help file.\nInstallation Download UltraBlog.vim from Vim.org or retrieve the latest source from Github:\nhttps://github.com/xbot/UltraBlog.vim\nInstall UltraBlog.vim to your plugin folder and put the following lines in your vimrc file:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 let ub_blog = {\u0026#39;login_name\u0026#39;:\u0026#39;admin\u0026#39;, \\\u0026#39;password\u0026#39;:\u0026#39;pass2011\u0026#39;, \\\u0026#39;url\u0026#39;:\u0026#39;http://www.sample.com\u0026#39;, \\\u0026#39;xmlrpc_uri\u0026#39;:\u0026#39;xmlrpc.php\u0026#39;, \\\u0026#39;db\u0026#39;:\u0026#39;~/.vim/UltraBlog.db\u0026#39;, \\\u0026#39;categories\u0026#39;:\u0026#39;News|Computer|Image\u0026#39; \\} \u0026#34; Set this option to 1 if you want to enable debug mode, see :help ub_debug for more information let ub_debug = 0 \u0026#34; Set this option to 0 if you prefer using firefox or chromium to preview items. let ub_use_ubviewer = 1 \u0026#34; Default timeout period of xmlrpc operations, see :help ub_socket_timeout for more information let ub_socket_timeout = 10 \u0026#34; Default page size of local post list, see :help ub_local_pagesize for more information let ub_local_pagesize = 30 \u0026#34; Default page size of remote post list, see :help ub_remote_pagesize for more information let ub_remote_pagesize = 15 \u0026#34; Default page size of search result list, see :help ub_search_pagesize for more information let ub_search_pagesize = 30 \u0026#34; Proudly show your visitors that you are blogging with the world\u0026#39;s most powerful editor let ub_append_promotion_link = 1 \u0026#34; Set width of the local id column in post or page lists let ub_list_col1_width = 7 \u0026#34; Set width of the remote id column in post or page lists let ub_list_col2_width = 8 \u0026#34; Set width of the status column in post or page lists let ub_list_col3_width = 11 \u0026#34; Set this value to 1 if you want to use editor mode. let ub_editor_mode = 0 \u0026#34; Set this value to 1 if you want to save posts/pages immediately after they are fetched from the blog. let ub_save_after_opened = 0 \u0026#34; Set this value to 0 if you do not want to save posts/pages immediately after they are sent to the blog. let ub_save_after_sent = 1 \u0026#34; Set the following options to use a custom extenal command as the converter. let ub_converter_command = \u0026#39;pandoc\u0026#39; let ub_converter_options = [\u0026#39;--reference-links\u0026#39;] let ub_converter_option_from = \u0026#39;--from=%s\u0026#39; let ub_converter_option_to = \u0026#39;--to=%s\u0026#39; \u0026#34; Customize hotkeys let ub_hotkey_open_item_in_current_view=\u0026#39;\u0026lt;enter\u0026gt;\u0026#39; let ub_hotkey_open_item_in_splitted_view=\u0026#39;\u0026lt;s-enter\u0026gt;\u0026#39; let ub_hotkey_open_item_in_tabbed_view=\u0026#39;\u0026lt;c-enter\u0026gt;\u0026#39; let ub_hotkey_delete_item=\u0026#39;\u0026lt;del\u0026gt;\u0026#39; let ub_hotkey_save_current_item=\u0026#39;\u0026lt;C-S\u0026gt;\u0026#39; \u0026#34; Set the link template string for images uploaded by :UBUpload let ub_tmpl_img_url=\u0026#34;markdown###![$(file)s][]\\n[$(file)s]:%(url)s\u0026#34; \u0026#34; Set the default template to use when previewing posts/pages locally let ub_default_template=\u0026#34;default\u0026#34; Change values of the upper options to yours. Restart Vim and a database file will be created in the path you specified above.\nConcepts It is important to understand some basic concepts of UltraBlog.vim.\nModes UltraBlog.vim makes life easier while writing or updating blogs. It stores posts/pages in a local SQLite database. You can also set it to editor mode, in which UltraBlog.vim does not store data locally, just like other Vim blogging scripts.\nBy default, UltraBlog.vim is in client mode. You can set it to use editor mode by adding the fallowing line to the vimrc file:\n1 let ub_editor_mode = 1 Items Currently, UltraBlog.vim manages three items: post, page and tmpl. \u0026ldquo;tmpl\u0026rdquo; is the shorthand of \u0026ldquo;template\u0026rdquo;.\nTemplates are used to preview the current post/page in the browser locally. This feature is a reparation for the remote previewing, due to the limit of the API, users cannot send a post to Wordpress as draft and preview it without affecting the post status if the post has been published.\nWith templates, users can preview posts/pages directly in the browser in a pre-defined style. They can create as many templates as they like and customize the look with CSS and HTML, or even Javascript.\nTemplates should be formatted as a valid python template string, that is, use the following avaliable placeholders and escape any literal \u0026lsquo;%\u0026rsquo; with another \u0026lsquo;%\u0026rsquo;:\n%(title)s\nThe title of the current post/page. %(content)s\nThe content of the current post/page. %%\nA literal '%'. There is a default template in the database, whose name is \u0026lsquo;default\u0026rsquo;, which can be used as an example of template.\nUsers can specify the default template to use with the option ub_default_template.\nSyntaxes The syntaxes supported by UltraBlog.vim currently are:\nmarkdown, html, rst, textile, latex.\nStatuses The available statuses are:\npublish, private, draft, pending.\nScopes Scopes tells UltraBlog.vim to operate on items in which place, \u0026ldquo;local\u0026rdquo; stands for items stored in the database, and \u0026ldquo;remote\u0026rdquo; stands for the blog.\nUsage Create a new item :UBNew [item [syntax/template_name]]\nCreate a new item.\nFor the first parameter, refer to UltraBlog_Items. The default value is \u0026ldquo;post\u0026rdquo;.\nIf \u0026ldquo;item\u0026rdquo; is either \u0026ldquo;post\u0026rdquo; or \u0026ldquo;page\u0026rdquo;, the second parameter must be a syntax name, refer to UltraBlog_Syntaxes. The default value is \u0026ldquo;markdown\u0026rdquo;.\nIf \u0026ldquo;item\u0026rdquo; is \u0026ldquo;tmpl\u0026rdquo;, the second parameter should be the name of the new template.\nWhen the cursor is focused in the metadata line of categories, press to do auto-completion. This will use the data set by option ub_blog[\u0026lsquo;categories\u0026rsquo;], if it is not set, categories will be fetched from your blog.\nSave a modified post :UBSave\nAfter executing this command, the current buffer is saved into database.\nSend a post to blog :UBSend [status]\nPost an item.\nIf no parameter is given, UltraBlog.vim will send the item to blog and set it to be the value stored in the meta information area.\nRefer to UltraBlog_Statuses.\nList posts :UBList [item [scope [page_size [page_no]]]]\nList items.\nRefer to UltraBlog_Items for the first parameter. The default value of this parameter is \u0026ldquo;post\u0026rdquo;.\nThe second parameter \u0026ldquo;scope\u0026rdquo; is only available when \u0026ldquo;item\u0026rdquo; is either \u0026ldquo;post\u0026rdquo; or \u0026ldquo;page\u0026rdquo;. Refer to UltraBlog_Scopes.\n\u0026ldquo;page_size\u0026rdquo; and \u0026ldquo;page_no\u0026rdquo; are both for the situation when \u0026ldquo;item\u0026rdquo; is \u0026ldquo;post\u0026rdquo; and \u0026ldquo;scope\u0026rdquo; is \u0026ldquo;local\u0026rdquo;. The former stands for how many item will be listed a page. The latter stands for the page number.\nFor example:\n:UBList\nThis command lists the first page of local posts, by default, posts which have not been posted to blog are listed before the posted ones, and there are ub_local_pagesize posts a page.\n:UBList post local 20 3\nThis command lists the third page of local posts, 20 posts a page. As you see, you can use this command to scroll forward or back between pages. As a matter of fact, there are two key mappings within local post list:\nCTRL+PageDown CTRL+PageUp :UBList post remote 50\nThis command lists the latest 50 posts in the blog.\nPressing the ENTER key in a remote post list will open the post under cursor and save it to the local database if it is not in it, otherwise, the local copy will be opened instead of the remote one. This enables users to modify markdown source and update the remote post.\nThe remote post list doesn\u0026rsquo;t support paging.\nOpen a single post :UBOpen {item} {post_id/template_name} [scope]\nOpen an item.\nFor the first parameter, refer to UltraBlog_Items.\nIf \u0026ldquo;item\u0026rdquo; is either \u0026ldquo;post\u0026rdquo; or \u0026ldquo;page\u0026rdquo;, the second parameter should be value of its id. If it\u0026rsquo;s \u0026ldquo;tmpl\u0026rdquo;, the name.\nFor \u0026ldquo;scope\u0026rdquo;, refer to UltraBlog_Scopes. The default value is \u0026ldquo;local\u0026rdquo;.\nUpload a media :UBUpload {file_path}\nThis command can only be executed in a post edit view, and the URL of the uploaed file will be appended in that buffer.\nPreview the changes :UBPreview [status/template name]\nPreview the content of the current buffer.\nIf any of the UltraBlog_Statuses is given, the current buffer will be sent to the blog and then opened in the browser with a parameter \u0026ldquo;preview\u0026rdquo; appended to the URL.\nIf the given parameter is not a post status, a pre-defined template whose name is the same with the parameter will be used to preview the buffer locally.\nIf none is given, the default template is used.\nYou do not have to care for which syntax you use, markdown source will be translated into html automatically before a browser window is opened to display it.\nThe matter that whether to use the built-in web browser or the system default ones is controlled by the option ub_use_ubviewer.\nDelete a post/page :UBDel {item} {post_id/template_name} [scope]\nDelete an item.\nRefer to UBOpen for the usage of these options.\nYou can also delete items in the list by pressing the DELETE button on the target. In a local post list, if the post to be deleted has been posted to the blog, a confirmation will be prompted for you to decide whether to delete the remote copy cascadly.\nCreate a post/page using content of the current buffer :UBThis [item [to_syntax [from_syntax]]]\nCreate a new post or page which is filled with content in the current buffer.\nIf no parameter is specified, the first parameter will be default to \u0026ldquo;post\u0026rdquo;; for the second and the third one, the syntax of the current buffer is used.\nContent of the current buffer will be automatically converted from the from_syntax to the to_syntax.\nConvert a post/page buffer between the available syntaxes :UBConv {to_syntax} [from_syntax]\nConvert the current buffer from \u0026lsquo;from_syntax\u0026rsquo; to \u0026rsquo;to_syntax\u0026rsquo;.\nRefer to UltraBlog_Syntaxes.\nIf you only need to convert from Markdown to HTML, only python-markdown or python-markdown2 module is required. For other conversion scenarios, you must install pacdoc or use the options: ub_converter_command, ub_converter_options, ub_converter_option_from, ub_converter_option_to to specify a valid external command.\nRefresh the current buffer :UBRefresh\nFull-text search :UBFind keyword1 [keyword2 \u0026hellip;]\nDoing full-text searches for both posts and pages by keywords, all keywords will be highlighted. Page size of the search result list is controlled by option ub_search_pagesize.\n:UBRegexSearch regexp1 [regexp2 \u0026hellip;]\nDoing full-text searches for both posts and pages by regular expressions, all strings that match the regular expressions will be highlighted. Page size of the search result list is controlled by ub_search_pagesize.\nFull-text substitutions Attention: Full-text substitutions will change contents of all matched posts/pages immediately when executed. You may need to backup your database file first.\n:UBReplace needle replacement\nDo full-text substitutions.\n:UBRegexReplace regexp replacement\nDo full-text substitutions using regular expressions.\nDebug In debug mode, SQL statements being executed will be displayed and so are all stack traces of exceptions raised.\n:UBEnableDebug\nEnable debugging.\n:UBDisableDebug\nDisable debugging.\n:UBToggleDebug\nToggle debugging status.\nOptions For more detail information on tweaking UltraBlog.vim, refer to the documentation.\nTips Install syntax files for any light weight markup language you use to highlight the posts/pages. Enable Code Snippet Highlighting For UltraBlog.vim Templates News 2014-04-20 v3.6.1 released. Changes 2012-04-30 v3.5.0 released. Changes 2012-04-29 v3.4.0 released. Changes 2012-04-15 v3.3.0 released. Changes 2012-01-05 v3.2.0 released. Changes 2011-11-01 v3.1.0 released. Changes 2011-07-24 v3.0.0 released. Changes 2011-06-15 v2.3.1 released. Changes 2011-06-10 v2.3.0 released. Changes 2011-05-30 v2.2.0 released. Changes 2011-05-28 v2.1.0 released. Changes 2011-05-12 v2.0.1 released. Changes 2011-04-14 v2.0.0 released. Changes 2011-04-12 v1.4.0 released. Changes 2011-04-09 v1.3.0 released. Changes 2011-04-07 v1.2.0 released. Changes 2011-04-05 v1.1.0 released. Changes 2011-04-04 v1.0.5 released. Changes 2011-04-02 v1.0.4 released. Changes 2011-04-02 v1.0.3 released. Changes 2011-04-02 v1.0.2 released. Changes 2011-04-01 v1.0.1 released. Changes 2011-04-01 v1.0.0 released. Changes Posted via UltraBlog.vim.\n","permalink":"http://0x3f.org/posts/ultrablog-as-an-ultimate-vim-blogging-plugin/","summary":"\u003ch2\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eUltraBlog.vim is yet another Vim blogging script for Wordpress.\u003c/p\u003e\n\u003cp\u003eThe biggest difference between UB and other similar scripts is that UB is an ultimate client, which stores posts locally in an SQLite database, while others just operate remotely. In this way, many things can be done easily by the advantage of local storage and many other utilities, for example, you can search for posts stored in the database with a few keywords by typing a simple command, also you can preview drafts with any of your favorite templates as soon as you want to.\u003c/p\u003e","title":"UltraBlog.vim: Ultimate Vim Blogging Plugin"},{"content":"gVim的窗口大小与行数、列数、字体宽度等都有关系，并不像一般的图形界面一样可以完全地最大化或全屏，如果几个因素组合后与屏幕分辨率不符合，就会在屏幕的左边和底部出现灰色的白边。\n这是gVim非常著名的一个问题，它使最大化的gVim窗口显得非常难看。目前仅有一种变通的解决方法，就是把白边部分的颜色设置成和gVim主题背景色一致的颜色：\n```bash # 修改~/.gtkrc-2.0，加入如下内容： style \"vimfix\" { bg[NORMAL] = \"#DBDBD2\" # this matches my gvim theme 'Normal' bg color. } widget \"vim-main-window.*GtkForm\" style \"vimfix\" ``` 由于并非真正地去掉白边，所以只能算是个伪方法。\nWindows下的方法见这里。\n","permalink":"http://0x3f.org/posts/the-fake-way-to-fix-white-gap-of-gvim/","summary":"\u003cp\u003egVim的窗口大小与行数、列数、字体宽度等都有关系，并不像一般的图形界面一样可以完全地最大化或全屏，如果几个因素组合后与屏幕分辨率不符合，就会在屏幕的左边和底部出现灰色的白边。\u003c/p\u003e\n\n\u003cp\u003e这是gVim非常著名的一个问题，它使最大化的gVim窗口显得非常难看。目前仅有一种变通的解决方法，就是把白边部分的颜色设置成和gVim主题背景色一致的颜色：\u003c/p\u003e\n\n\u003cp\u003e\n```bash\n# 修改~/.gtkrc-2.0，加入如下内容：\nstyle \"vimfix\" {\n  bg[NORMAL] = \"#DBDBD2\" # this matches my gvim theme 'Normal' bg color.\n}\nwidget \"vim-main-window.*GtkForm\" style \"vimfix\"\n```\n\u003c/p\u003e\n\n\u003cp\u003e由于并非真正地去掉白边，所以只能算是个伪方法。\u003c/p\u003e\n\n\u003cp\u003eWindows下的方法见\u003ca href=\"../fullscreen-for-gvim-on-windows/\"\u003e这里\u003c/a\u003e。\u003c/p\u003e","title":"解决gVim白边问题的伪方法"},{"content":"\nChange Log 2011-03-20 Sunday Solve the compatibility problem under Wordpress 3.1, thanks to wongkediri. Check the plugin\u0026rsquo;s page for more information.\n","permalink":"http://0x3f.org/posts/batchcat-v03-released/","summary":"\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/bqYPszwt0P7OI9snKxv3WA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TIIMnE-09dI/AAAAAAAABdk/q_hDtyXJozo/s800/wp-batch-cat.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eChange Log\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cstrong\u003e2011-03-20 Sunday\u003c/strong\u003e\n\u003col\u003e\n\t\u003cli\u003eSolve the compatibility \u003ca href=\"http://wordpress.org/support/topic/plugin-batch-cat-doesnt-work-for-31\"\u003eproblem\u003c/a\u003e under Wordpress 3.1, thanks to \u003ca href=\"http://coliq.wongkediri.com/batch-cat-wordpress-plugin-not-working-fixed.html\"\u003ewongkediri\u003c/a\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCheck \u003ca href=\"http://0x3f.org/?p=1603\"\u003ethe plugin\u0026rsquo;s page\u003c/a\u003e for more information.\u003c/p\u003e","title":"Batch Cat v0.3 Released"},{"content":"VimRepress是Vim写博客的插件中较新的一个，是久未更新的Vimpress的一个衍生版。\n虽然不是所有此类插件中功能最多的一个，但VimRepress非常实用，除包含最常用的几个功能外，还支持Markdown。但是当前版本的VimRepress在转换Markdown格式的字符串到HTML时，是通过直接调用外部命令markdown来实现的，这显然只是针对Linux（及其它类UNIX）系统设计的。\n为了使VimRepress支持在Windows下使用Markdown写文章，可以对它做一些改进。\n修改VimRepress的源文件blog.vim，在if __name__ == \"__main__\":这一行的上方加入如下两个函数：\n```python def markdown_preview2(): import sys reload(sys) sys.setdefaultencoding('utf-8') import markdown2 as mkd global vimpress_temp_dir if vimpress_temp_dir == '': vimpress_temp_dir = tempfile.mkdtemp(suffix=\"vimpress\") temp_htm = os.path.join(vimpress_temp_dir, \"vimpress_temp.htm\") html_heads = \\ \"\"\"\u003c!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\u003e \"\"\" tmp_file = open(temp_htm, 'w') tmp_file.write(html_heads) txt = \"\\n\".join(vim.current.buffer[:]) #txt = unicode(txt,'cp936') tmp_file.write(mkd.markdown(txt)) #tmp_file.write(mkd.markdown(\"\\n\".join(vim.current.buffer[:]))) tmp_file.close() webbrowser.open(\"file://%s\" % temp_htm) def markdown_newpost2(): import sys reload(sys) sys.setdefaultencoding('utf-8') import markdown2 as mkd global vimpress_temp_dir if vimpress_temp_dir == '': vimpress_temp_dir = tempfile.mkdtemp(suffix=\"vimpress\") temp_htm = os.path.join(vimpress_temp_dir, \"vimpress_post.htm\") title = \"\" title_s = 0 try: while title_s \u003c 10: if vim.current.buffer[title_s].startswith(\"#\"): title = vim.current.buffer[title_s].strip('#') break title_s += 1 except IndexError: pass cur_file = vim.eval('expand(\"%:p\")') if cur_file is None: cur_file = os.path.join(vimpress_temp_dir, \"tmp_vimpress.mkd\") sys.stdout.write(\"\\n\\nCurrent buffer saved to %s\\n\\n\" % cur_file) vim.command(\":w! %s\" % cur_file) tmp_file = open(temp_htm, 'w') tmp_file.write(mkd.markdown(\"\\n\".join(vim.current.buffer[:]))) tmp_file.close() sys.stdout.write(\"Press ENTER to continue.\") vim.command(\":bdelete\") vim.command(\":r %s\" % temp_htm) blog_new_post(title = title) ``` 这两个函数修改自原有的markdownpreview()和markdownnewpost()，由调用外部的markdown命令改为调用Python的markdown2模块来实现格式转换。\n然后，修改blog.vim中的命令映射，使VimRepress的:MarkDownPreview和:MarkDownNewPost命令在Windows下自动调用上述两个函数：\n```vim if has(\"win32\") command! -nargs=0 MarkDownPreview exec('py markdown_preview2()') command! -nargs=0 MarkDownNewPost exec('py markdown_newpost2()') else command! -nargs=0 MarkDownPreview exec('py markdown_preview()') command! -nargs=0 MarkDownNewPost exec('py markdown_newpost()') endif ``` 最后，只须安装Python的markdown2模块就可以用了。\n2011-03-23更新：\npentie已合并这些功能到新版本的VimRepress。\n2011-04-04更新：\n作为Markdown写博的重度患者，我觉得Vim的其它相关插件都缺乏对Markdown源码的有效管理，所以我干脆写了个新的插件UltraBlog。\n","permalink":"http://0x3f.org/posts/blogging-with-vim/","summary":"\u003cp\u003e\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=3510\"\u003eVimRepress\u003c/a\u003e是Vim写博客的插件中较新的一个，是久未更新的\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=1953\"\u003eVimpress\u003c/a\u003e的一个衍生版。\u003c/p\u003e\n\n\u003cp\u003e虽然不是所有此类插件中功能最多的一个，但VimRepress非常实用，除包含最常用的几个功能外，还支持\u003ca href=\"http://daringfireball.net/projects/markdown/\"\u003eMarkdown\u003c/a\u003e。但是当前版本的VimRepress在转换Markdown格式的字符串到HTML时，是通过直接调用外部命令\u003cstrong\u003emarkdown\u003c/strong\u003e来实现的，这显然只是针对Linux（及其它类UNIX）系统设计的。\u003c/p\u003e\n\n\u003cp\u003e为了使VimRepress支持在Windows下使用Markdown写文章，可以对它做一些改进。\u003c/p\u003e\n\n\u003cp\u003e修改VimRepress的源文件\u003cstrong\u003eblog.vim\u003c/strong\u003e，在\u003ccode\u003eif __name__ == \"__main__\":\u003c/code\u003e这一行的上方加入如下两个函数：\u003c/p\u003e\n\n\u003cp\u003e\n```python\ndef markdown_preview2():\n    import sys\n    reload(sys)\n    sys.setdefaultencoding('utf-8')\n    import markdown2 as mkd\n\n    global vimpress_temp_dir\n    if vimpress_temp_dir == '':\n        vimpress_temp_dir = tempfile.mkdtemp(suffix=\"vimpress\")\n    temp_htm = os.path.join(vimpress_temp_dir, \"vimpress_temp.htm\")\n    html_heads = \\\n\"\"\"\u003c!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\u003e\n\u003chtml\u003e\n\u003chead\u003e\n   \u003cmeta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\"\"\"\n    tmp_file = open(temp_htm, 'w')\n    tmp_file.write(html_heads)\n    txt = \"\\n\".join(vim.current.buffer[:])\n    #txt = unicode(txt,'cp936')\n    tmp_file.write(mkd.markdown(txt))\n    #tmp_file.write(mkd.markdown(\"\\n\".join(vim.current.buffer[:])))\n    tmp_file.close()\n\n    webbrowser.open(\"file://%s\" % temp_htm)\n\ndef markdown_newpost2():\n    import sys\n    reload(sys)\n    sys.setdefaultencoding('utf-8')\n    import markdown2 as mkd\n\n    global vimpress_temp_dir\n    if vimpress_temp_dir == '':\n        vimpress_temp_dir = tempfile.mkdtemp(suffix=\"vimpress\")\n    temp_htm = os.path.join(vimpress_temp_dir, \"vimpress_post.htm\")\n\n    title = \"\"\n    title_s = 0\n    try:\n        while title_s \u003c 10:\n            if vim.current.buffer[title_s].startswith(\"#\"):\n                title = vim.current.buffer[title_s].strip('#')\n                break\n            title_s += 1\n    except IndexError:\n        pass\n\n    cur_file = vim.eval('expand(\"%:p\")')\n    if cur_file is None: \n        cur_file = os.path.join(vimpress_temp_dir, \"tmp_vimpress.mkd\")\n        sys.stdout.write(\"\\n\\nCurrent buffer saved to %s\\n\\n\" % cur_file)\n    vim.command(\":w! %s\" % cur_file)\n    tmp_file = open(temp_htm, 'w')\n    tmp_file.write(mkd.markdown(\"\\n\".join(vim.current.buffer[:])))\n    tmp_file.close()\n    sys.stdout.write(\"Press ENTER to continue.\")\n    vim.command(\":bdelete\")\n    vim.command(\":r %s\" % temp_htm)\n    blog_new_post(title = title)\n```\n\u003c/p\u003e","title":"使用Vim写博客"},{"content":"在Windows下，我希望把vba文件安装到$VIM/vimfiles目录下，而不是用户主目录中。\nVim在安装vba文件时默认从$VIMRUNTIME中取出第一个路径作为安装路径，使用如下命令查看当前设置：\n```vim :echo \u0026rtp ``` 在Windows下，Vim默认将用户主目录放在了$VIMRUNTIME的第一个，因此才会将vba安装到用户主目录。\n修改方法为在vimrc中加入如下设置：\n```vim set rtp-=$HOME/vimfiles ``` ","permalink":"http://0x3f.org/posts/howto-set-the-default-vimball-install-path/","summary":"\u003cp\u003e在Windows下，我希望把vba文件安装到$VIM/vimfiles目录下，而不是用户主目录中。\u003c/p\u003e\n\n\u003cp\u003eVim在安装vba文件时默认从$VIMRUNTIME中取出第一个路径作为安装路径，使用如下命令查看当前设置：\u003c/p\u003e\n\n\u003cp\u003e\n```vim\n:echo \u0026rtp\n```\n\u003c/p\u003e\n\n\u003cp\u003e在Windows下，Vim默认将用户主目录放在了$VIMRUNTIME的第一个，因此才会将vba安装到用户主目录。\u003c/p\u003e\n\n\u003cp\u003e修改方法为在vimrc中加入如下设置：\u003c/p\u003e\n\n\u003cp\u003e\n```vim\nset rtp-=$HOME/vimfiles\n```\n\u003c/p\u003e","title":"修改Vimball默认安装路径"},{"content":"Changelog 2011-03-14 Now Dumperor is stable enough. Add the abillity to export table structures or data to a human readable format, which is suit for comparing. Add the abillity to manage multiple configurations. Add a desktop application to sort the human readable output file of table structures, written in python and tk. Check the main page for more information.\n","permalink":"http://0x3f.org/posts/dumperor-v100-released/","summary":"\u003ch3\u003eChangelog\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cstrong\u003e2011-03-14\u003c/strong\u003e\n\u003col\u003e\n\t\u003cli\u003eNow Dumperor is stable enough.\u003c/li\u003e\n\t\u003cli\u003eAdd the abillity to export table structures or data to a human readable format, which is suit for comparing.\u003c/li\u003e\n\t\u003cli\u003eAdd the abillity to manage multiple configurations.\u003c/li\u003e\n\t\u003cli\u003eAdd a desktop application to sort the human readable output file of table structures, written in python and tk.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCheck the \u003ca href=\"http://0x3f.org/?p=1617\"\u003emain page\u003c/a\u003e for more information.\u003c/p\u003e","title":"Dumperor v1.0.0 Released"},{"content":"上周 Oxygen v2.0 发布之后，感觉还不稳定，忍住了。前两天终于刷上了刚发布的 Oxygen v2.0.1 。\n事先直接做了一次完整的擦除，刷完后没发现 XDA 上乱七八糟的问题。用了两天，除了 UI 的变化，没看出来跟以前版本有什么不同，只是仍未实现轨迹球唤醒这点很遗憾。\n","permalink":"http://0x3f.org/posts/flashed-oxygen-v201/","summary":"\u003cp\u003e上周 Oxygen v2.0 发布之后，感觉还不稳定，忍住了。前两天终于刷上了刚发布的 Oxygen v2.0.1 。\u003c/p\u003e\n\u003cp\u003e事先直接做了一次完整的擦除，刷完后没发现 XDA 上乱七八糟的问题。用了两天，除了 UI 的变化，没看出来跟以前版本有什么不同，只是仍未实现轨迹球唤醒这点很遗憾。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/C-dYsOdeOj-iYlIZm_l8IA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/_ceUJ_lBTHzc/TXOfYdamg3I/AAAAAAAABmc/F_2AXlKogkA/s400/snap20110306_223834.png\" height=\"400\" width=\"240\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"刷了Oxygen v2.0.1"},{"content":"把淘宝上价格比较靠谱的几家问了个遍，都没有货，估计都是因为价格高，只代购，不存货。最后还是在买Kindle的店等了好几天才搞到了原装黑色皮套，虽然相对已经算是低价，还是十分地肉疼。\n无图无真相：\n","permalink":"http://0x3f.org/posts/expensive-kindle-cover/","summary":"\u003cp\u003e把淘宝上价格比较靠谱的几家问了个遍，都没有货，估计都是因为价格高，只代购，不存货。最后还是在买Kindle的店等了好几天才搞到了原装黑色皮套，虽然相对已经算是低价，还是十分地肉疼。\u003c/p\u003e\n\n\u003cp\u003e无图无真相：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/mSN41KmfWQKYLFvQ0h014g?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/_ceUJ_lBTHzc/TWueBePKfoI/AAAAAAAABlU/4wf8o37uZ1A/s400/C360_2011-02-28%2020-51-59.jpg\" height=\"267\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/tiQUWUaArTyClLcSZkdCZg?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/_ceUJ_lBTHzc/TWueCzrD5AI/AAAAAAAABlY/XcSP3X0U87M/s400/C360_2011-02-28%2020-53-05.jpg\" height=\"267\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"好贵的套啊"},{"content":"\nChange Log 2011-02-23 Wednesday 22:24:12 Rename anti-manpower-spam to anti-artificial-spam. Don't just test if the URL is in the banned ones, but also test if it is a substring of one of them. Optimize the speed of matching. Check the plugin\u0026rsquo;s page for more information.\n","permalink":"http://0x3f.org/posts/anti-artificial-spam-v02-released/","summary":"\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/jrOJUT0rqkBrzPsVM4k4EA?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh4.googleusercontent.com/_ceUJ_lBTHzc/TWZX7Vkc9qI/AAAAAAAABkg/BUMJWsLaqWA/s800/wp-anti-artificial-spam.png\" height=\"106\" width=\"345\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eChange Log\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cstrong\u003e2011-02-23 Wednesday 22:24:12\u003c/strong\u003e\n\u003col\u003e\n\t\u003cli\u003eRename anti-manpower-spam to anti-artificial-spam.\u003c/li\u003e\n\t\u003cli\u003eDon't just test if the URL is in the banned ones, but also test if it is a substring of one of them.\u003c/li\u003e\n\t\u003cli\u003eOptimize the speed of matching.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCheck \u003ca href=\"http://0x3f.org/?p=1293\"\u003ethe plugin\u0026rsquo;s page\u003c/a\u003e for more information.\u003c/p\u003e","title":"Anti Artificial Spam v0.2 Released"},{"content":"垂涎已久，昨天终于出手，今天上午就收到了。\n把玩了一下自带的系统，用免费的3G网络看Wikipedia，体验不错。中文文件名不能显示，嵌入了中文字体的PDF可以正常显示。买DXG的目的就是为了看计算机类的英文PDF和繁体竖排的扫描版的古籍PDF，所以不折腾，直接装多看系统。\n多看果然给力，全中文界面，中文输入法，中文TTS语音朗读，而且支持MP3播放、图片浏览和包括chm、epub在内的多种电子书格式。因为暂时用不上，所以先不深究。连到Arch传PDF，直接自动挂载并弹出Nautilus，没想到对Linux如此友好！\n贴了膜，所以有反光，但是只要没有灯光直射，大角度效果依然良好：\n来个微距：\n以上图片出自G7+Camera360，光线不好，马马虎虎。\n缺点。一是不支持触摸操控，加上官方系统古板、笨拙，做一些高级操作是很费力的，好在多看系统在这一点上做得很好。二是PDF翻页的时候速度确实比较慢，还要闪一下屏，不过还可以接受。多看系统也不完美，最要命的是不支持3G网络，要使用3G网络还得切换到官方系统中；另外就是不支持重力感应，文档方向需要手工设置。\n齐活了，从此不用再担心长时间在电脑上看OReilly累眼了，也不用发愁中华书局的扫描版史书没法看了。\n","permalink":"http://0x3f.org/posts/got-kindle-dxg/","summary":"\u003cp\u003e垂涎已久，昨天终于出手，今天上午就收到了。\u003c/p\u003e\n\u003cp\u003e把玩了一下自带的系统，用免费的3G网络看Wikipedia，体验不错。中文文件名不能显示，嵌入了中文字体的PDF可以正常显示。买DXG的目的就是为了看计算机类的英文PDF和繁体竖排的扫描版的古籍PDF，所以不折腾，直接装多看系统。\u003c/p\u003e\n\u003cp\u003e多看果然给力，全中文界面，中文输入法，中文TTS语音朗读，而且支持MP3播放、图片浏览和包括chm、epub在内的多种电子书格式。因为暂时用不上，所以先不深究。连到Arch传PDF，直接自动挂载并弹出Nautilus，没想到对Linux如此友好！\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/QiUW7raz-GRIIAHY6ExhGg?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/_ceUJ_lBTHzc/TWEYsx6aK_I/AAAAAAAABjw/zhEKpfsTGEs/s400/C360_2011-02-20%2021-22-34.jpg\" height=\"400\" width=\"267\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/Gsdt90fZObxY1siONP8RBQ?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh6.googleusercontent.com/_ceUJ_lBTHzc/TWEZHhvqyuI/AAAAAAAABj0/o9e0BhrS9mo/s400/C360_2011-02-20%2021-23-15.jpg\" height=\"400\" width=\"267\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e贴了膜，所以有反光，但是只要没有灯光直射，大角度效果依然良好：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/eZQCdCXnRJ9bvxeEf4HXdg?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/_ceUJ_lBTHzc/TWEZH4lMbPI/AAAAAAAABj4/QPTOixm9gbU/s400/C360_2011-02-20%2021-21-33.jpg\" height=\"267\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e来个微距：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/y192tUMfE2zZfTEWmuCQVQ?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh5.googleusercontent.com/_ceUJ_lBTHzc/TWEZH6AcODI/AAAAAAAABj8/_xOmnTnj0UQ/s400/C360_2011-02-20%2021-20-50.jpg\" height=\"267\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e以上图片出自G7+Camera360，光线不好，马马虎虎。\u003c/p\u003e\n\u003cp\u003e缺点。一是不支持触摸操控，加上官方系统古板、笨拙，做一些高级操作是很费力的，好在多看系统在这一点上做得很好。二是PDF翻页的时候速度确实比较慢，还要闪一下屏，不过还可以接受。多看系统也不完美，最要命的是不支持3G网络，要使用3G网络还得切换到官方系统中；另外就是不支持重力感应，文档方向需要手工设置。\u003c/p\u003e\n\u003cp\u003e齐活了，从此不用再担心长时间在电脑上看OReilly累眼了，也不用发愁中华书局的扫描版史书没法看了。\u003c/p\u003e","title":"初入Kindle DX Graphite"},{"content":"Faenza Icons Theme是适用于GTK+环境的一套图标主题，风格很漂亮，而且齐全。\n","permalink":"http://0x3f.org/posts/icon-theme-faenza/","summary":"\u003cp\u003e\u003ca href=\"http://tiheum.deviantart.com/art/Faenza-Icons-173323228\"\u003eFaenza Icons Theme\u003c/a\u003e是适用于GTK+环境的一套图标主题，风格很漂亮，而且齐全。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://picasaweb.google.com/lh/photo/oR3thuG4Fu9kHj_9JE6l5g?feat=embedwebsite\"\u003e\u003cimg src=\"https://lh3.googleusercontent.com/_ceUJ_lBTHzc/TV8kBGrLlFI/AAAAAAAABjc/NCuw2C_QaHk/s400/faenza_icons_by_tiheum-d2v6x24.png\" height=\"300\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"精美的图标主题：Faenza"},{"content":"最近把MySQL从5.1升级到5.5，之后创建存储过程时报如下错误：\nERROR 1548 (HY000) at line 5: Cannot load from mysql.proc. The table is probably corrupted\n解决办法是执行如下命令： ```bash mysql_upgrade -p ``` mysql_upgrade是MySQL提供的一个指令，作用是检查MySQL中的各个表与当前版本的数据库是否匹配并尝试修复所有发现的问题。MySQL官方文档中推荐在每次升级后执行一下这个指令。\n","permalink":"http://0x3f.org/posts/execute-mysql-upgrade-after-upgrading/","summary":"\u003cp\u003e最近把MySQL从5.1升级到5.5，之后创建存储过程时报如下错误：\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003eERROR 1548 (HY000) at line 5: Cannot load from mysql.proc. The table is probably corrupted\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e解决办法是执行如下命令：\n\n```bash\nmysql_upgrade -p\n```\n\n\u003ca href=\"http://dev.mysql.com/doc/refman/5.0/en/mysql-upgrade.html\" target=\"_blank\"\u003emysql_upgrade\u003c/a\u003e是MySQL提供的一个指令，作用是检查MySQL中的各个表与当前版本的数据库是否匹配并尝试修复所有发现的问题。MySQL官方文档中推荐在每次升级后执行一下这个指令。\u003c/p\u003e","title":"MySQL升级后执行mysql_upgrade"},{"content":"问题表现为在登录页面输入用户名和密码并点击登录按钮后，Wordpress跳转到登录页面。\n解决方法是修改wp-includes/plugable.php中的wp_set_auth_cookie()函数，将下面这行：\n1 setcookie($auth_cookie_name, $auth_cookie, $expire, ADMIN_COOKIE_PATH, COOKIE_DOMAIN, $secure, true); 改成：\n1 setcookie($auth_cookie_name, $auth_cookie, $expire, SITECOOKIEPATH, COOKIE_DOMAIN, $secure, true); 这一行在这个函数中有两处，是根据php的版本决定执行哪一块，所以应该根据自己的情况修改，或者干脆两处都修改。\n在我的tp-link tl-wr841n中发现这个问题，而中兴无线猫中没有这个问题。\n","permalink":"http://0x3f.org/posts/wordpress-fails-logging-in-with-some-wifi-routers/","summary":"\u003cp\u003e问题表现为在登录页面输入用户名和密码并点击登录按钮后，Wordpress跳转到登录页面。\u003c/p\u003e\n\u003cp\u003e解决方法是修改\u003cstrong\u003e\u003cem\u003ewp-includes/plugable.php\u003c/em\u003e\u003c/strong\u003e中的\u003cstrong\u003e\u003cem\u003ewp_set_auth_cookie()\u003c/em\u003e\u003c/strong\u003e函数，将下面这行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003esetcookie\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$auth_cookie_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$auth_cookie\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$expire\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eADMIN_COOKIE_PATH\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eCOOKIE_DOMAIN\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$secure\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e改成：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003esetcookie\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$auth_cookie_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$auth_cookie\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$expire\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eSITECOOKIEPATH\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eCOOKIE_DOMAIN\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$secure\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这一行在这个函数中有两处，是根据php的版本决定执行哪一块，所以应该根据自己的情况修改，或者干脆两处都修改。\u003c/p\u003e\n\u003cp\u003e在我的tp-link tl-wr841n中发现这个问题，而中兴无线猫中没有这个问题。\u003c/p\u003e","title":"部分无线路由导致Wordpress无法登录"},{"content":"\n花了两个周末，读完了Agile Web Application Development with Yii1.1 and PHP5，边读边做，受益匪浅。\n这本书从零开始细致地讲解了用Yii开发一个项目管理系统TrackStar的全过程，涉及到Yii的大部分主要特性。全书风格简洁凝练，没有过多的占用篇幅的截图，但讲解浅显易懂，可操作性很强，是我看过的Tutorial类的书里面最好的一本。\n从这段时间学习Yii的体会中，我觉得在目前的条件下，对于有PHP程序开发基础的人，学习路线应该是：\nYii权威指南→The Yii Blog Tutorial→Agile Web Application Development with Yii1.1 and PHP5\n","permalink":"http://0x3f.org/posts/after-reading-agile-web-application-development-with-yii11-and-php5/","summary":"\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/UbKjF4vtCfgJnNA1L7g04w?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/TT1ktv2GLvI/AAAAAAAABjA/MIM7i3CQjxk/s400/cover.jpg\" height=\"400\" width=\"324\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e花了两个周末，读完了\u003cem\u003eAgile Web Application Development with Yii1.1 and PHP5\u003c/em\u003e，边读边做，受益匪浅。\u003c/p\u003e\n\n\u003cp\u003e这本书从零开始细致地讲解了用Yii开发一个项目管理系统\u003cem\u003eTrackStar\u003c/em\u003e的全过程，涉及到Yii的大部分主要特性。全书风格简洁凝练，没有过多的占用篇幅的截图，但讲解浅显易懂，可操作性很强，是我看过的\u003cstrong\u003eTutorial\u003c/strong\u003e类的书里面最好的一本。\u003c/p\u003e\n\n\u003cp\u003e从这段时间学习Yii的体会中，我觉得在目前的条件下，对于有PHP程序开发基础的人，学习路线应该是：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://www.yiiframework.com/doc/guide/\"\u003eYii权威指南\u003c/a\u003e→\u003ca href=\"http://www.yiiframework.com/doc/blog/\"\u003eThe Yii Blog Tutorial\u003c/a\u003e→Agile Web Application Development with Yii1.1 and PHP5\u003c/p\u003e","title":"读完Agile Web Application Development with Yii1.1 and PHP5"},{"content":"相对于鸡肋cmd.exe，Console2有以下优点：\n窗口大小可调整 字体样式可选择 支持多标签 有很方便的选择、复制、粘贴等基本编辑功能 支持自定义快捷键 对经常不得不使用Windows虚拟终端的人来说，以上几个特性足以使人忘掉cmd.exe。其实，Console2本身只是Shell的图形前端，只是在默认情况下它会调用cmd.exe处理用户输入，因此，也可以通过设置使Console2成为Cygwin的前端，只是从这一点上讲，Console2和Mintty相比完全没有优势。\n","permalink":"http://0x3f.org/posts/console2-as-an-alternative-of-cmd-exe/","summary":"\u003cp\u003e相对于鸡肋cmd.exe，\u003ca href=\"http://sourceforge.net/projects/console/\"\u003eConsole2\u003c/a\u003e有以下优点：\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e窗口大小可调整\u003c/li\u003e\n\u003cli\u003e字体样式可选择\u003c/li\u003e\n\u003cli\u003e支持多标签\u003c/li\u003e\n\u003cli\u003e有很方便的选择、复制、粘贴等基本编辑功能\u003c/li\u003e\n\u003cli\u003e支持自定义快捷键\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e对经常不得不使用Windows虚拟终端的人来说，以上几个特性足以使人忘掉cmd.exe。其实，Console2本身只是Shell的图形前端，只是在默认情况下它会调用cmd.exe处理用户输入，因此，也可以通过设置使Console2成为Cygwin的前端，只是从这一点上讲，Console2和\u003ca href=\"http://code.google.com/p/mintty/\"\u003eMintty\u003c/a\u003e相比完全没有优势。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/hfesI_yiNpTZ68BKIqdImA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/TTotT9zYK6I/AAAAAAAABi0/Qzv4d2Abe-g/s400/console2.png\" height=\"332\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"Console2：取代cmd.exe的Windows虚拟终端"},{"content":"Linux一般使用Samba向Windows共享资源。另一个办法就是使用SSH。\nDokan是一个为Windows提供实现新文件系统的开发库，而Dokan SSHFS是在此基础上实现的挂载SSH通道为本地分区的文件系统。必须先安装Dokan，然后再安装Dokan SSHFS。\n如果从安装SSH服务做起，步骤是：\n在Linux主机上安装openssh 修改Linux主机的/etc/hosts.allow，加入sshd: ALL，以允许外部访问 启动sshd守护进程 在Windows主机上安装Dokan和Dokan SSHFS 通过SSHFS的图形配置工具挂载SSH通道 这种方式的好处是简单，但是存在安全隐患，不管怎样，公布SSH连接绝非好事，这意味著接入用户可以远程控制Linux主机，尤其是当SSH账户的权限较高时。因此，这种方式只适用于虚拟机或家庭网络，例如对Host-Guests共享支持不佳的KVM虚拟机来说就是个好的选择。即便如此，也要注意相应的Windows主机的安全防范，否则，入侵者可以通过Windows主机做跳板来进入Linux主机。\n","permalink":"http://0x3f.org/posts/mount-linux-dirs-as-windows-local-partitions/","summary":"\u003cp\u003eLinux一般使用Samba向Windows共享资源。另一个办法就是使用SSH。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://dokan-dev.net/en/\"\u003eDokan\u003c/a\u003e是一个为Windows提供实现新文件系统的开发库，而\u003ca href=\"http://dokan-dev.net/en/download/#sshfs\"\u003eDokan SSHFS\u003c/a\u003e是在此基础上实现的挂载SSH通道为本地分区的文件系统。必须先安装Dokan，然后再安装Dokan SSHFS。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/d6J9vTU8cvK2KEplEo0ZaQ?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh4.ggpht.com/_ceUJ_lBTHzc/TThWJn7FrzI/AAAAAAAABic/Et7kroeInF8/s400/sshfs.png\" height=\"338\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e如果从安装SSH服务做起，步骤是：\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e在Linux主机上安装openssh\u003c/li\u003e\n\u003cli\u003e修改Linux主机的\u003cstrong\u003e/etc/hosts.allow\u003c/strong\u003e，加入\u003ccode\u003esshd: ALL\u003c/code\u003e，以允许外部访问\u003c/li\u003e\n\u003cli\u003e启动sshd守护进程\u003c/li\u003e\n\u003cli\u003e在Windows主机上安装Dokan和Dokan SSHFS\u003c/li\u003e\n\u003cli\u003e通过SSHFS的图形配置工具挂载SSH通道\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e这种方式的好处是简单，但是存在安全隐患，不管怎样，公布SSH连接绝非好事，这意味著接入用户可以远程控制Linux主机，尤其是当SSH账户的权限较高时。因此，这种方式只适用于虚拟机或家庭网络，例如对Host-Guests共享支持不佳的KVM虚拟机来说就是个好的选择。即便如此，也要注意相应的Windows主机的安全防范，否则，入侵者可以通过Windows主机做跳板来进入Linux主机。\u003c/p\u003e","title":"Dokan SSHFS：Windows下通过SSH挂载Linux主机为本地分区"},{"content":"上周日读完了这本The Pragmatic Programmer的中译本，都是经验之谈，有些东西读后受益匪浅，更多的需要时间去体会。\n很纠结读的是中译本，但实在买不到原版，非常好奇他们是怎样地殚精竭虑才能想出如此烂俗的译名。\n","permalink":"http://0x3f.org/posts/after-reading-pragmatic-programmers/","summary":"\u003cp\u003e上周日读完了这本\u003cstrong\u003e\u003cem\u003eThe Pragmatic Programmer\u003c/em\u003e\u003c/strong\u003e的中译本，都是经验之谈，有些东西读后受益匪浅，更多的需要时间去体会。\u003c/p\u003e\n\u003cp\u003e很纠结读的是中译本，但实在买不到原版，非常好奇他们是怎样地殚精竭虑才能想出如此烂俗的译名。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/jtr_krg4zxuQ2SjAY6_msw?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh4.ggpht.com/_ceUJ_lBTHzc/TSxhb6t4awI/AAAAAAAABiQ/YDce_zvQreQ/s400/%E7%A8%8B%E5%BA%8F%E5%91%98%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93_crop1.jpg\" height=\"400\" width=\"302\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"读完《程序员修炼之道》"},{"content":"在Oracle中插入或更新LOB字段时，可以将字符串以如下方式写入SQL语句：\n1 insert tbl_lob (fld_lob) values (utl_raw.cast_to_raw(\u0026#39;hello world\u0026#39;)); 这样做的限制是：\nOracle中单条SQL语句有长度限制 cast_to_raw()对字符串有长度限制 因此如果要插入或更新的字符串过长，会导致执行失败。此时应该使用dbms_lob处理LOB相关字段。下面是利用dbms_lob更新一个BLOB字段的存储过程，对CLOB的操作同理：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 create or replace procedure updateblob( ctbl in varchar2, cfld in varchar2, cstr in varchar2, ccond in varchar2 ) is vqry varchar2(1000); vblob blob; vbatch varchar2(2000); vstrlen number; voffset number :=1; vamt number :=2000; begin vstrlen := length(cstr); vqry := \u0026#39;update \u0026#39;||ctbl||\u0026#39; set \u0026#39;||cfld||\u0026#39;=empty_blob() where \u0026#39;||ccond; execute immediate vqry; vqry := \u0026#39;select \u0026#39;||cfld||\u0026#39; from \u0026#39;||ctbl||\u0026#39; where \u0026#39;||ccond||\u0026#39; for update\u0026#39;; execute immediate vqry into vblob; if vstrlen\u0026gt;vamt then while vstrlen\u0026gt;voffset loop vbatch := substr(cstr, voffset, vamt); voffset := voffset+vamt; dbms_lob.writeappend(vblob, length(vbatch), utl_raw.cast_to_raw(vbatch)); end loop; else dbms_lob.writeappend(vblob, length(cstr), utl_raw.cast_to_raw(cstr)); end if; commit; end; 示例：\n1 2 3 4 5 6 7 8 9 10 -- 将tbl_lob表的fld_lob字段的值改为“hello lob !”，要求被更改的行满足条件： -- 1. fld_code字段的值以“2011”开头 -- 2. fld_name字段的值等于“Hell” declare vcond varchar2(1000); begin vcond := \u0026#39;fld_code like \u0026#39;\u0026#39;2011%\u0026#39;\u0026#39; and fld_name=\u0026#39;\u0026#39;Hell\u0026#39;\u0026#39;\u0026#39;; updateblob(\u0026#39;tbl_lob\u0026#39;, \u0026#39;fld_lob\u0026#39;, \u0026#39;hello lob !\u0026#39;, vcond); end; ","permalink":"http://0x3f.org/posts/oracle-lob-operations/","summary":"\u003cp\u003e在Oracle中插入或更新LOB字段时，可以将字符串以如下方式写入SQL语句：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003einsert\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003etbl_lob\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efld_lob\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003evalues\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutl_raw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecast_to_raw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;hello world\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这样做的限制是：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003eOracle中单条SQL语句有长度限制\u003c/li\u003e\n\t\u003cli\u003ecast_to_raw()对字符串有长度限制\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e因此如果要插入或更新的字符串过长，会导致执行失败。此时应该使用dbms_lob处理LOB相关字段。下面是利用dbms_lob更新一个BLOB字段的存储过程，对CLOB的操作同理：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ecreate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ereplace\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eprocedure\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eupdateblob\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003ectbl\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evarchar2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003ecfld\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evarchar2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003ecstr\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evarchar2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003eccond\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evarchar2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eis\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evqry\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evarchar2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evblob\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003eblob\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evbatch\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evarchar2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evstrlen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evoffset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003enumber\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evamt\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003enumber\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ebegin\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evstrlen\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecstr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evqry\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;update \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"n\"\u003ectbl\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; set \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"n\"\u003ecfld\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;=empty_blob() where \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"n\"\u003eccond\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eexecute\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eimmediate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evqry\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003evqry\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;select \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"n\"\u003ecfld\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; from \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"n\"\u003ectbl\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; where \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"n\"\u003eccond\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; for update\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eexecute\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eimmediate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evqry\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003einto\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evblob\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evstrlen\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003evamt\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003ewhile\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evstrlen\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003evoffset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"n\"\u003evbatch\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003esubstr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecstr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evamt\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"n\"\u003evoffset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003evoffset\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003evamt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"n\"\u003edbms_lob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewriteappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evblob\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evbatch\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eutl_raw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecast_to_raw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evbatch\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"k\"\u003eend\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003edbms_lob\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewriteappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evblob\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecstr\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eutl_raw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecast_to_raw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecstr\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eend\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003ecommit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e示例：\u003c/p\u003e","title":"Oracle中对LOB字段的操作方法"},{"content":"darkstat是一个跨平台的网络流量监测工具，可显示最大一个月内操作系统的各项网络流量指标。\n具有以下特性：\n以守护进程方式运行，提供Web用户界面，零配置，易于使用 可显示较为详细的网络流量指标 性能表现好，占用资源少 跨平台，支持多个UNIX、类UNIX操作系统，并有非官方的Windows移植版 具有以下不足：\n功能较为简单，以易用性换灵活性 日志记录功能比较单薄，需要编写辅助脚本并设置定时任务 darkstat启动时需要手工指定监视的网络接口，因此需要用根权限启动：\n1 sudo darkstat -i eth0 darkstat默认使用667端口提供Web访问，可以用-p参数指定端口：\n1 sudo darkstat -i eth0 -p 8080 darkstat的Web用户界面分为Graph、Hosts和Host三部分。Graph是缺省主页，用于显示最近一分钟、一小时、一天和一个月的流量统计直方图，将光标置于任何一个直方条上可查看对应时刻的流量指标：\nHosts界面按主机显示各自的流量统计指标的值：\n单击Hosts界面上的IP进入对应主机的Host界面，此界面按TCP/UDP类型显示对应的主机的各端口的网络流量指标的值：\n可通过如下命令查看占用指定端口的进程：\n[lenin@archer ~]$ lsof -i tcp:58062 -n COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME mlnet 18660 lenin 74u IPv4 251788 0t0 TCP 192.168.1.3:58062-\u003e122.116.212.89:http (ESTABLISHED) darkstat区别于其它流量监测工具的最大的优点就是简单易用，非常适合对流量监测应用不复杂的场景。前段时间公司的一台RHEL服务器因为流量过大多次被网管拔线，后来用darkstat监测到大部分流量被几个UDP端口占去，进而发现原来是服务器被入侵并被安装了一个扫描器SIPVicious。\n","permalink":"http://0x3f.org/posts/darkstat-as-a-network-discharge-meter/","summary":"\u003cp\u003e\u003ca href=\"http://dmr.ath.cx/net/darkstat/\"\u003edarkstat\u003c/a\u003e是一个跨平台的网络流量监测工具，可显示最大一个月内操作系统的各项网络流量指标。\u003c/p\u003e\n\u003cp\u003e具有以下特性：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003e以守护进程方式运行，提供Web用户界面，零配置，易于使用\u003c/li\u003e\n\t\u003cli\u003e可显示较为详细的网络流量指标\u003c/li\u003e\n\t\u003cli\u003e性能表现好，占用资源少\u003c/li\u003e\n\t\u003cli\u003e跨平台，支持多个UNIX、类UNIX操作系统，并有非官方的Windows移植版\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e具有以下不足：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003e功能较为简单，以易用性换灵活性\u003c/li\u003e\n\t\u003cli\u003e日志记录功能比较单薄，需要编写辅助脚本并设置定时任务\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003edarkstat启动时需要手工指定监视的网络接口，因此需要用根权限启动：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo darkstat -i eth0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003edarkstat默认使用\u003cstrong\u003e667\u003c/strong\u003e端口提供Web访问，可以用\u003cstrong\u003e-p\u003c/strong\u003e参数指定端口：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo darkstat -i eth0 -p \u003cspan class=\"m\"\u003e8080\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003edarkstat的Web用户界面分为Graph、Hosts和Host三部分。Graph是缺省主页，用于显示最近一分钟、一小时、一天和一个月的流量统计直方图，将光标置于任何一个直方条上可查看对应时刻的流量指标：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/NAB3_2TtnezdM45HoNd5pQ?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh4.ggpht.com/_ceUJ_lBTHzc/TRcCUWqnF0I/AAAAAAAABhs/wLRQb3rvHW8/s400/darkstat-graphs.png\" height=\"400\" width=\"395\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHosts界面按主机显示各自的流量统计指标的值：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/kG1J2j2eecaLUnhDL-fArA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh4.ggpht.com/_ceUJ_lBTHzc/TRcCUXxnsMI/AAAAAAAABhw/ri5OsbqPdmc/s400/darkstat-hosts.png\" height=\"322\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e单击Hosts界面上的IP进入对应主机的Host界面，此界面按TCP/UDP类型显示对应的主机的各端口的网络流量指标的值：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/XBNQWty4lp63OWwyAFm_BA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TRcCUn6lg_I/AAAAAAAABh0/6Aj0hArzIYk/s800/darkstat-host.png\" height=\"800\" width=\"190\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e可通过如下命令查看占用指定端口的进程：\u003c/p\u003e\n\u003cblockquote\u003e\n[lenin@archer ~]$ lsof -i tcp:58062 -n\nCOMMAND   PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nmlnet   18660 lenin   74u  IPv4 251788      0t0  TCP 192.168.1.3:58062-\u003e122.116.212.89:http (ESTABLISHED)\n\u003c/blockquote\u003e\n\u003cp\u003edarkstat区别于其它流量监测工具的最大的优点就是简单易用，非常适合对流量监测应用不复杂的场景。前段时间公司的一台RHEL服务器因为流量过大多次被网管拔线，后来用darkstat监测到大部分流量被几个UDP端口占去，进而发现原来是服务器被入侵并被安装了一个扫描器\u003ca href=\"http://code.google.com/p/sipvicious/\"\u003eSIPVicious\u003c/a\u003e。\u003c/p\u003e","title":"darkstat: 网络流量监测工具"},{"content":"在top中，内存使用情况显示为如下格式：\nMem: 3056828k total, 2624472k used, 432356k free, 185196k buffers Swap: 2096476k total, 0k used, 2096476k free, 1613592k cached 根据内存的使用情况，将内存空间划分为四种类型：已使用（used），未使用（free），缓冲区（buffers）和已缓存（cached）。\n“已使用”是指目前正被使用的活跃的内存区域。“未使用”是指当前空闲的内存区域。“缓冲区”是用于存放即将写入存储介质的数据的区域。“已缓存”是指曾因需要而被读入内存、但目前已不被使用的数据。Linux通常会在资源使用完毕后保留一部分数据在内存中而不全部释放，这就是“已缓存”区域，这样当这些数据再次被使用时，系统就可以直接从内存中读取。而“缓冲区”用于将对存储介质的写操作集中进行。因此，“缓冲区”和“已缓存”特性对减少存储介质IO和加速系统运行都具有非常重要的作用。\n所以，Linux运行一段时间后，通常看起来空闲内存都很小，其实是因为很大一部分被用作“已缓存”区域，这部分内存会在内存资源紧张时被自动释放，也可以通过如下命令手工释放：\n1 echo 1 \u0026gt; /proc/sys/vm/drop_caches ","permalink":"http://0x3f.org/posts/linux-memory-usage/","summary":"\u003cp\u003e在top中，内存使用情况显示为如下格式：\u003c/p\u003e\n\u003cblockquote\u003e\nMem:   3056828k total,  2624472k used,   432356k free,   185196k buffers\nSwap:  2096476k total,        0k used,  2096476k free,  1613592k cached\n\u003c/blockquote\u003e\n\u003cp\u003e根据内存的使用情况，将内存空间划分为四种类型：已使用（used），未使用（free），缓冲区（buffers）和已缓存（cached）。\u003c/p\u003e\n\u003cp\u003e“已使用”是指目前正被使用的活跃的内存区域。“未使用”是指当前空闲的内存区域。“缓冲区”是用于存放即将写入存储介质的数据的区域。“已缓存”是指曾因需要而被读入内存、但目前已不被使用的数据。Linux通常会在资源使用完毕后保留一部分数据在内存中而不全部释放，这就是“已缓存”区域，这样当这些数据再次被使用时，系统就可以直接从内存中读取。而“缓冲区”用于将对存储介质的写操作集中进行。因此，“缓冲区”和“已缓存”特性对减少存储介质IO和加速系统运行都具有非常重要的作用。\u003c/p\u003e\n\u003cp\u003e所以，Linux运行一段时间后，通常看起来空闲内存都很小，其实是因为很大一部分被用作“已缓存”区域，这部分内存会在内存资源紧张时被自动释放，也可以通过如下命令手工释放：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u0026gt; /proc/sys/vm/drop_caches\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Linux的内存使用机制"},{"content":"在Vim中，关键词是一个至关重要的概念。合理地利用关键词，可以快速地对光标下有特殊含义的字符串进行一系列的操作，例如通过快捷键复制关键词、查询函数定义或文档、在项目中查询所有引用当前函数的地方等等。这对工作效率的提升有极大的帮助。\n但我的Vim对PHP文件的关键词识别有问题，在选择函数名的时候总是将函数名后的小括弧一起选入。\nVim使用选项iskeyword设定关键词的匹配规则，使用如下命令查看当前文件类型的关键词规则：\n1 set iskeyword 我这里查看PHP文件的规则结果如下：\niskeyword=@,48-57,_,192-255,$,( 不明白为什么缺省设置中会有左括弧，在vimrc中加入如下配置取消之：\n1 au FileType php set iskeyword-=( ","permalink":"http://0x3f.org/posts/howto-set-keyword-identification-in-vim/","summary":"\u003cp\u003e在Vim中，关键词是一个至关重要的概念。合理地利用关键词，可以快速地对光标下有特殊含义的字符串进行一系列的操作，例如通过快捷键复制关键词、查询函数定义或文档、在项目中查询所有引用当前函数的地方等等。这对工作效率的提升有极大的帮助。\u003c/p\u003e\n\u003cp\u003e但我的Vim对PHP文件的关键词识别有问题，在选择函数名的时候总是将函数名后的小括弧一起选入。\u003c/p\u003e\n\u003cp\u003eVim使用选项iskeyword设定关键词的匹配规则，使用如下命令查看当前文件类型的关键词规则：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003eiskeyword\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e我这里查看PHP文件的规则结果如下：\u003c/p\u003e\n\u003cblockquote\u003e\niskeyword=@,48-57,_,192-255,$,(\n\u003c/blockquote\u003e\n\u003cp\u003e不明白为什么缺省设置中会有左括弧，在vimrc中加入如下配置取消之：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eFileType\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003eiskeyword\u003c/span\u003e\u003cspan class=\"p\"\u003e-=(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Vim中设置关键词识别规则的方法"},{"content":"五月末入手 Desire 后一直没有折腾，一是因为时间和精力不够，二也没有迫切的需要。\n这次 Google Map 的更新给了我足够的理由，加上 Froyo 原生的“移动到SD”功能已被榨干最后一点油水，于是用 unrEVOked3 很傻瓜地 root 了 Desire ，用 Move2SD Enabler 开启了完全的 App2SD ，用 Market Enabler 化妆潜入米国菜市场安装了 Google Map 5.0 ，最后还启用了 SetCPU 。\n后来还是没有把持住，一不做二不休，对原装的 Sense 做了一个 nandroid 备份，刷上了 Oxygen 。 Oxygen 的主题十分的简洁美观，我觉得比 Sense 漂亮：\nOxygen 基于 AOSP ，是改动较少、较接近于官方Android的一个ROM，最大的优点是速度快和稳定性高。这两天使用的感受证明了这两点，尤其是速度，一骑绝尘啊，比 Sense 之流好多了。当然，因为精简，理论上在耗电量上较 Sense 要小，不过我实际感觉如果持续使用的话也好不到哪去，但是待机的话效果还是比较明显，可能跟启用了 SetCPU 也有一定的关系。\n开始差点刷了 MIUI ，但是很多人反映有耗电和稳定性的问题。\n","permalink":"http://0x3f.org/posts/rooted-desire-and-flashed-oxygen/","summary":"\u003cp\u003e五月末入手 Desire 后一直没有折腾，一是因为时间和精力不够，二也没有迫切的需要。\u003c/p\u003e\n\u003cp\u003e这次 Google Map 的\u003ca href=\"http://android.guao.hk/posts/google-maps-5-0-for-android-coming.html\"\u003e更新\u003c/a\u003e给了我足够的理由，加上 Froyo 原生的“\u003cem\u003e移动到SD\u003c/em\u003e”功能已被榨干最后一点油水，于是用 \u003ca href=\"http://unrevoked.com/\"\u003eunrEVOked3\u003c/a\u003e 很傻瓜地 root 了 Desire ，用 Move2SD Enabler 开启了完全的 App2SD ，用 Market Enabler 化妆潜入米国菜市场安装了 Google Map 5.0 ，最后还启用了 SetCPU 。\u003c/p\u003e\n\u003cp\u003e后来还是没有把持住，一不做二不休，对原装的 Sense 做了一个 nandroid 备份，刷上了 \u003ca href=\"http://forum.xda-developers.com/showthread.php?t=829734\"\u003eOxygen\u003c/a\u003e 。 Oxygen 的主题十分的简洁美观，我觉得比 Sense 漂亮：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/9wFenU4A3IbKivS2cGboQw?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/TQ4LVo_oUGI/AAAAAAAABg4/ecJd4sggC0A/s400/CAP201012192130.png\" height=\"400\" width=\"240\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eOxygen 基于 \u003ca href=\"http://source.android.com/\"\u003eAOSP\u003c/a\u003e ，是改动较少、较接近于官方Android的一个ROM，最大的优点是速度快和稳定性高。这两天使用的感受证明了这两点，尤其是速度，一骑绝尘啊，比 Sense 之流好多了。当然，因为精简，理论上在耗电量上较 Sense 要小，不过我实际感觉如果持续使用的话也好不到哪去，但是待机的话效果还是比较明显，可能跟启用了 SetCPU 也有一定的关系。\u003c/p\u003e\n\u003cp\u003e开始差点刷了 \u003ca href=\"http://www.miui.com/\"\u003eMIUI\u003c/a\u003e ，但是很多人反映有耗电和稳定性的问题。\u003c/p\u003e","title":"Root了Desire并刷了Oxygen"},{"content":"\nChange Log 2010-12-12 Sunday Add the ability to append the selected categories to posts Add the ability to delete the selected categories from posts Check the plugin\u0026rsquo;s page for more information.\n","permalink":"http://0x3f.org/posts/batchcat-v02-released/","summary":"\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/bqYPszwt0P7OI9snKxv3WA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TIIMnE-09dI/AAAAAAAABdk/q_hDtyXJozo/s800/wp-batch-cat.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eChange Log\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cstrong\u003e2010-12-12 Sunday\u003c/strong\u003e\n\u003col\u003e\n\t\u003cli\u003eAdd the ability to append the selected categories to posts\u003c/li\u003e\n\t\u003cli\u003eAdd the ability to delete the selected categories from posts\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCheck \u003ca href=\"http://0x3f.org/?p=1603\"\u003ethe plugin\u0026rsquo;s page\u003c/a\u003e for more information.\u003c/p\u003e","title":"Batch Cat v0.2 Released"},{"content":"Vim认为一个文本文件的每一行都应该由一换行符结束，即使文件的最后一行也不例外。这就使得Vim保存过的文本文件在其它文本编辑器中查看时可能会在文件末尾多出一个空行。一般来说，这不是个问题，但对于程序员来说，有时候一些不规范的运行环境或其它组件就要求文件的最后一行不能有换行符，否则就会出莫名其妙的问题，尤其是在Windows环境下最常见。\n要在保存文件时不在最后一行添加换行符，最常见、最简单的方法就是：\n1 2 :set binary :set noendofline 但是这样做有一个问题，就是会把DOS格式的文件自动转换成UNIX格式，WinSlave们肯定不希望这么做。\n因此，可在vimrc中加入如下内容：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026#34; Save the current buffer as a file with no EOF sign. function! SaveAsNOEOF(filename) let a=getline(1,line(\u0026#39;$\u0026#39;)-1) let b=map(a, \u0026#39;iconv(v:val,\u0026#34;\u0026#39;.\u0026amp;enc.\u0026#39;\u0026#34;,\u0026#34;\u0026#39;.\u0026amp;fenc.\u0026#39;\u0026#34;) . nr2char(13)\u0026#39;) call extend(b, getline(\u0026#39;$\u0026#39;, \u0026#39;$\u0026#39;)) call writefile(b,a:filename, \u0026#39;b\u0026#39;) if a:filename == bufname(\u0026#39;%\u0026#39;) set nomodified endif endfunction \u0026#34; Save the current buffer and get rid of the EOF sign. function! SaveNOEOF() call SaveAsNOEOF(bufname(\u0026#39;%\u0026#39;)) endfunction command! -complete=file -nargs=0 SaveNOEOF :call SaveNOEOF() command! -complete=file -nargs=1 SaveAsNOEOF :call SaveAsNOEOF(\u0026lt;q-args\u0026gt;) 然后就可以使用SaveNOEOF和SaveAsNOEOF两条命令去保存没有EOF的文件了。\n说明：本文的目的在于保存文件时移除最后一行的换行符，而并非移除EOF，上述配置中使用EOF只为记忆更容易起见。\n更新：\n2010-12-15 修正SaveNOEOF命令报缺少参数的错误的问题 修正保存当前buffer后没有变更文档修改状态的问题 修正保存文件后总是将编码转换成encoding选项的值的问题 ","permalink":"http://0x3f.org/posts/howto-remove-eof-in-vim/","summary":"\u003cp\u003eVim认为一个文本文件的每一行都应该由一换行符结束，即使文件的最后一行也不例外。这就使得Vim保存过的文本文件在其它文本编辑器中查看时可能会在文件末尾多出一个空行。一般来说，这不是个问题，但对于程序员来说，有时候一些不规范的运行环境或其它组件就要求文件的最后一行不能有换行符，否则就会出莫名其妙的问题，尤其是在Windows环境下最常见。\u003c/p\u003e\n\u003cp\u003e要在保存文件时不在最后一行添加换行符，最常见、最简单的方法就是：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003ebinary\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003enoendofline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e但是这样做有一个问题，就是会把DOS格式的文件自动转换成UNIX格式，WinSlave们肯定不希望这么做。\u003c/p\u003e\n\u003cp\u003e因此，可在vimrc中加入如下内容：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; Save the current buffer as a file with no EOF sign.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveAsNOEOF\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003egetline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;iconv(v:val,\u0026#34;\u0026#39;\u003c/span\u003e.\u0026amp;\u003cspan class=\"nx\"\u003eenc\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;\u0026#34;,\u0026#34;\u0026#39;\u003c/span\u003e.\u0026amp;\u003cspan class=\"nx\"\u003efenc\u003c/span\u003e.\u003cspan class=\"s1\"\u003e\u0026#39;\u0026#34;) . nr2char(13)\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eextend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egetline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;$\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;$\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003ewritefile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;b\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003efilename\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003ebufname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003enomodified\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; Save the current buffer and get rid of the EOF sign.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveNOEOF\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveAsNOEOF\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebufname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003efile\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003enargs\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveNOEOF\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveNOEOF\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003efile\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003enargs\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveAsNOEOF\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveAsNOEOF\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eq\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e然后就可以使用SaveNOEOF和SaveAsNOEOF两条命令去保存没有EOF的文件了。\u003c/p\u003e","title":"Vim保存文件时移除尾行换行符的方法"},{"content":"昨天晚上放弃了年终聚餐，去看了《黄粱梦》。\n一个很老套的故事，耳熟能详，但是经过精心的演绎，加上声、光、电的完美运用，真就给人以耳目一新的感觉。我一直不怎么观注地方戏曲，以往觉得能凑合听听的也就是河南的越调、安徽的黄梅戏等，河北的地方戏也就听说过一个河北梆子，像邯郸的平调落子这样的闻所未闻。《黄粱梦》彻底改变了我对地方戏曲的看法，京剧、昆曲固然高雅，但假如也加入魔术、杂技、俚语甚至RAP，肯定会让人觉得不伦不类，地方戏曲的长处就在于灵活多变，不拘泥形式，能够很快地针对时代变化作出改进，如果分寸拿捏得好，就能不断推陈出新。\n整场戏用两个小时的时间表现了卢生一梦中的一生，故事情节十分紧凑，每折都用不同的场景、不同的唱腔、不同的表现形式，让人眼花缭乱，一改传统戏剧连篇累牍的大段说词，整场看下来从未觉得枯燥乏味，很适应时下流行的快餐文化。在故事情节上，《黄粱梦》并没有跳出惩恶扬善、因果报应的老套，当然，一味地追求突破未见得是好事。\n虽然时间不长，但是整场戏有很多地方让人印象深刻，比如有句意味深长的戏词“邯郸道长，人生路短”，还有那句雷倒了无数人的“现在哪里还有什么纯真美女啊”。当然，最让人意犹未尽的还是这段高潮的“贪官舞”：\n","permalink":"http://0x3f.org/posts/a-fools-paradise/","summary":"\u003cp\u003e昨天晚上放弃了年终聚餐，去看了《黄粱梦》。\u003c/p\u003e\n\u003cp\u003e一个很老套的故事，耳熟能详，但是经过精心的演绎，加上声、光、电的完美运用，真就给人以耳目一新的感觉。我一直不怎么观注地方戏曲，以往觉得能凑合听听的也就是河南的越调、安徽的黄梅戏等，河北的地方戏也就听说过一个河北梆子，像邯郸的平调落子这样的闻所未闻。《黄粱梦》彻底改变了我对地方戏曲的看法，京剧、昆曲固然高雅，但假如也加入魔术、杂技、俚语甚至RAP，肯定会让人觉得不伦不类，地方戏曲的长处就在于灵活多变，不拘泥形式，能够很快地针对时代变化作出改进，如果分寸拿捏得好，就能不断推陈出新。\u003c/p\u003e\n\u003cp\u003e整场戏用两个小时的时间表现了卢生一梦中的一生，故事情节十分紧凑，每折都用不同的场景、不同的唱腔、不同的表现形式，让人眼花缭乱，一改传统戏剧连篇累牍的大段说词，整场看下来从未觉得枯燥乏味，很适应时下流行的快餐文化。在故事情节上，《黄粱梦》并没有跳出惩恶扬善、因果报应的老套，当然，一味地追求突破未见得是好事。\u003c/p\u003e\n\u003cp\u003e虽然时间不长，但是整场戏有很多地方让人印象深刻，比如有句意味深长的戏词“邯郸道长，人生路短”，还有那句雷倒了无数人的“现在哪里还有什么纯真美女啊”。当然，最让人意犹未尽的还是这段高潮的“贪官舞”：\u003c/p\u003e\n\u003cp\u003e\u003cembed src=\"http://www.tudou.com/v/anrxiFeKSfM/v.swf\" type=\"application/x-shockwave-flash\" allowscriptaccess=\"always\" allowfullscreen=\"true\" wmode=\"opaque\" width=\"480\" height=\"400\"\u003e\u003c/embed\u003e\u003c/p\u003e","title":"黄粱一梦"},{"content":"Hope GTK是套漂亮的冷色调的GTK主题，色调过渡柔和，细节表现得也很好，整体给人以平静的感觉。\n","permalink":"http://0x3f.org/posts/gtk-theme-hope/","summary":"\u003cp\u003e\u003ca href=\"http://0rax0.deviantart.com/art/Hope-GTK-187658025\"\u003eHope GTK\u003c/a\u003e是套漂亮的冷色调的GTK主题，色调过渡柔和，细节表现得也很好，整体给人以平静的感觉。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/4_sO8LFMCRO5xLKi6v9wQA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh4.ggpht.com/_ceUJ_lBTHzc/TPpOe4PGEjI/AAAAAAAABgc/Lhir6fzkDWE/s400/hope_gtk_by_0rax0-d33q5ux.jpg\" height=\"320\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"Hope GTK：平静、柔和、细腻的主题"},{"content":"前段时间突然发现kvm中的windows在启动时蓝屏，开始以为是kvm新版本的bug，后来发现如果不启用虚拟机硬盘的virtio就不会出现蓝屏。\n于是下载了最新版的virtio，然而更新后，蓝屏的问题并没有解决，所以目前只能暂时不使用virtio。不过网卡的virtio是没有问题的。\n","permalink":"http://0x3f.org/posts/virto-may-breakdown-windows/","summary":"\u003cp\u003e前段时间突然发现kvm中的windows在启动时蓝屏，开始以为是kvm新版本的bug，后来发现如果不启用虚拟机硬盘的virtio就不会出现蓝屏。\u003c/p\u003e\n\u003cp\u003e于是下载了最新版的virtio，然而更新后，蓝屏的问题并没有解决，所以目前只能暂时不使用virtio。不过网卡的virtio是没有问题的。\u003c/p\u003e","title":"virtio可能导致windows蓝屏"},{"content":"基于GTK的程序菜单本身支持通过在焦点所在的菜单项上按下组合键来定义该菜单项的快捷键，但默认并不开启。\n一般来说，对于支持X的会话管理的桌面环境，可以通过修改相应的设置来开启这个功能：\nGNOME中该设置项所在的路径是：主选单 \u003e 桌面 \u003e 偏好设定 \u003e 选单及功具列 \u003e 可编辑选单捷径键 XFCE中该设置项所在的路径是：主选单 \u003e 设置 \u003e 外观 \u003e 设置 \u003e 开启可编辑快捷键 对于不支持会话管理的桌面环境，可在~/.gtkrc-2.0中添加如下配置内容：\ngtk-can-change-accels = 1 ","permalink":"http://0x3f.org/posts/howto-enable-hotkey-for-gtk-menus/","summary":"\u003cp\u003e基于GTK的程序菜单本身支持通过在焦点所在的菜单项上按下组合键来定义该菜单项的快捷键，但默认并不开启。\u003c/p\u003e\n\u003cp\u003e一般来说，对于支持X的会话管理的桌面环境，可以通过修改相应的设置来开启这个功能：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003eGNOME中该设置项所在的路径是：主选单 \u003e 桌面 \u003e 偏好设定 \u003e 选单及功具列 \u003e 可编辑选单捷径键\u003c/li\u003e\n\t\u003cli\u003eXFCE中该设置项所在的路径是：主选单 \u003e 设置 \u003e 外观 \u003e 设置 \u003e 开启可编辑快捷键\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e对于不支持会话管理的桌面环境，可在~/.gtkrc-2.0中添加如下配置内容：\u003c/p\u003e\n\u003cblockquote\u003e\ngtk-can-change-accels = 1\n\u003c/blockquote\u003e","title":"开启自定义GTK程序菜单快捷键的方法"},{"content":"最近rxvt-unicode-256color的一次更新触发了screen的一个缺陷。新的版本将默认的环境变量$TERM由rxvt-256color改成了rxvt-unicode-256color，这导致在rxvt中启动screen时报这样的错误：\n$TERM too long - sorry. 虽然可以在.Xdefaults中指定$TERM的值，但是据说这样会导致rxvt加载错误的terminfo，并导致终端的颜色由256色降低到88色。另外虽然按照同样的说法，可以在screenrc中设置$TERM的值，但是不知道是我写的格式不对还是什么原因，无效。\n最终还是设了个别名：\n1 2 3 # vi ~/.bashrc alias screenx=\u0026#39;export TERM=screen-256color \u0026amp;\u0026amp; screen\u0026#39; ","permalink":"http://0x3f.org/posts/screen-is-sorry-for-term-being-too-long/","summary":"\u003cp\u003e最近rxvt-unicode-256color的一次更新触发了screen的一个缺陷。新的版本将默认的环境变量$TERM由rxvt-256color改成了rxvt-unicode-256color，这导致在rxvt中启动screen时报这样的错误：\u003c/p\u003e\n\u003cblockquote\u003e\n$TERM too long - sorry.\n\u003c/blockquote\u003e\n\u003cp\u003e虽然可以在.Xdefaults中指定$TERM的值，但是\u003ca href=\"https://aur.archlinux.org/packages.php?ID=13060\"\u003e据说\u003c/a\u003e这样会导致rxvt加载错误的terminfo，并导致终端的颜色由256色降低到88色。另外虽然按照同样的说法，可以在screenrc中设置$TERM的值，但是不知道是我写的格式不对还是什么原因，无效。\u003c/p\u003e\n\u003cp\u003e最终还是设了个别名：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi ~/.bashrc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ealias\u003c/span\u003e \u003cspan class=\"nv\"\u003escreenx\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;export TERM=screen-256color \u0026amp;\u0026amp; screen\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"screen曰：$TERM too long - sorry."},{"content":"Oxygen是KDE桌面环境中的一套著名的图标集，但是据说基于GTK的桌面环境如GNOME、XFCE等对其支持得不好，我这里在GNOME下倒没发现问题，不过在XFCE下文件夹的图标显示的是缺省的图标，不好看。\nOxygen Refit是针对GTK的桌面环境修改的Oxygen图标集，在XFCE下可以正常显示，但是缺点是最大分辨率只有48×48，不能显示较大的高清图标。Archlinux下可以安装AUR中的oxygenrefit2-icon-theme。\n","permalink":"http://0x3f.org/posts/oxygen-iconset-fit-for-xfce/","summary":"\u003cp\u003eOxygen是KDE桌面环境中的一套著名的图标集，但是据说基于GTK的桌面环境如GNOME、XFCE等对其支持得不好，我这里在GNOME下倒没发现问题，不过在XFCE下文件夹的图标显示的是缺省的图标，不好看。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://gnome-look.org/content/show.php/Oxygen+Refit+2?content=79756\"\u003eOxygen Refit\u003c/a\u003e是针对GTK的桌面环境修改的Oxygen图标集，在XFCE下可以正常显示，但是缺点是最大分辨率只有48×48，不能显示较大的高清图标。Archlinux下可以安装AUR中的\u003ca href=\"http://aur.archlinux.org/packages.php?ID=18673\"\u003eoxygenrefit2-icon-theme\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/cURosgqNAesp47LgLj4LpA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/TPJ4grT0drI/AAAAAAAABf0/R22H_Nv6kbA/s400/2010-11-28.23%3A33%3A01.-usr-share-icons-oxygen-256x256-places%20%28%E9%A1%AF%E7%A4%BA%E7%B8%AE%E5%9C%96%29%20.01.png\" height=\"249\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"Oxygen Refit：适用于xfce的Oxygen图标集"},{"content":"WinMerge是开源的差异比较工具，只运行于Windows平台。\n具有以下实用特性：\n支持文件内容和文件、文件夹差异比较 文件内容比较采用左右双栏显示，支持语法高亮 提供Windows资源管理器右键菜单，以选择文件或文件夹进行比较 具有以下不足：\n文件夹比较结果以单栏显示，不直观 仅支持两方比较，不支持多方比较 使用时的注意事项：\n使用树状的列表显示文件夹比较结果可以稍微缓解单栏显示导致的不直观的问题 Windows资源管理器的右键菜单需要在设置界面手工设置才能加入选取不同目标进行比较的菜单项 相较于商业的Beyong Compare等工具，WinMerge在操作的直观度和功能细节上存在不足，但是在差异比较的主要功能上，WinMerge完全可以胜任日常工作。同时，由于免费，WinMerge可以作为这些商业软件很好的替代工具。\n后记：这些天越来越对使用未授权的商业软件感到不安，于是开始寻找这些工具的开源、免费替代品。\n","permalink":"http://0x3f.org/posts/winmerge-as-a-free-diff-tool/","summary":"\u003cp\u003e\u003ca href=\"http://winmerge.org/\"\u003eWinMerge\u003c/a\u003e是开源的差异比较工具，只运行于Windows平台。\u003c/p\u003e\n\u003cp\u003e具有以下实用特性：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003e支持文件内容和文件、文件夹差异比较\u003c/li\u003e\n\t\u003cli\u003e文件内容比较采用左右双栏显示，支持语法高亮\u003c/li\u003e\n\t\u003cli\u003e提供Windows资源管理器右键菜单，以选择文件或文件夹进行比较\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e具有以下不足：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003e文件夹比较结果以单栏显示，不直观\u003c/li\u003e\n\t\u003cli\u003e仅支持两方比较，不支持多方比较\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e使用时的注意事项：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003e使用树状的列表显示文件夹比较结果可以稍微缓解单栏显示导致的不直观的问题\u003c/li\u003e\n\t\u003cli\u003eWindows资源管理器的右键菜单需要在设置界面手工设置才能加入选取不同目标进行比较的菜单项\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e相较于商业的Beyong Compare等工具，WinMerge在操作的直观度和功能细节上存在不足，但是在差异比较的主要功能上，WinMerge完全可以胜任日常工作。同时，由于免费，WinMerge可以作为这些商业软件很好的替代工具。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e后记：这些天越来越对使用未授权的商业软件感到不安，于是开始寻找这些工具的开源、免费替代品。\u003c/strong\u003e\u003c/p\u003e","title":"WinMerge：开源的差异比较工具"},{"content":"虽然是个大版本，但4.0在实际功能上并没有太大的进步。新版本相对于3.x增加的主要特性是：\n支持皮肤 图形界面的配置工具 增加系统托盘图标 托盘图标和输入条提供右键菜单，如皮肤切换、选择输入法等 放弃GBK编码，改用UTF-8编码 拼音支持多词库 一系列细节功能及Bug修复 最主要的特性只有前两个，可见fcitx 4.0只是这个项目涅槃后的一个新的起点，象征意义大于实际意义，尤其对于码表输入法用户来说是这样。三年前我就说过，fcitx在用户造词上有个致命缺陷，就是对于多音字它总是使用字母表中声母靠前的编码，对于音码或者音形码输入法来说，这样造出来的词的编码经常会是错的，更糟糕的是用户还不容易自行修改词组编码。三年后的今天，新版本并没有解决这个问题。\n此外，需要注意的是，新版本对界面和易用性的改进也带来一些负面的影响，fcitx不再是当年以轻巧著称的那只小企鹅了，在我这里，它的内存占用达到了26M，所幸反应速度仍然很快。\n三年前，由于众所周知的原因，fcitx的路线图显得非常混乱，几个新版本都非常不稳定，所以我不再使用源中的版本，转而编译安装了新版本中相对稳定的黑色星期五版，不知不觉中三年过去了，想到一直用著这个版本就这么过来了，很感慨。要卸载编译安装的程序就得用源码重新configure一下再make uninstall，所幸还能在这里找到这个版本。\nArchlinux下安装AUR中的fcitx-config时报如下错误：\nERROR: certificate common name “*.github.com” doesn’t match requested host name “github.com”. 需要修改/etc/makepkg.conf，使wget在下载源码时不做安全验证：\n# 增加--no-check-certificate参数 DLAGENTS=('ftp::/usr/bin/wget -c --passive-ftp -t 3 --waitretry=3' 'http::/usr/bin/wget -c -t 3 --waitretry=3 --no-check-certificate' 'https::/usr/bin/wget -c -t 3 --waitretry=3 --no-check-certificate' 'rsync::/usr/bin/rsync -z' 'scp::/usr/bin/scp -C') 新版本的稳定性不如黑色星期五版，如果把简繁转换热键修改为ALT+J，使用时会导致fcitx崩溃。加之实际功能的改进不大，所以是否升级就无可无不可了。\n","permalink":"http://0x3f.org/posts/upgraded-to-fcitx4/","summary":"\u003cp\u003e虽然是个大版本，但4.0在实际功能上并没有太大的进步。新版本相对于3.x增加的主要特性是：\u003c/p\u003e\n\u003col\u003e\n  \u003cli\u003e支持皮肤\u003c/li\u003e\n  \u003cli\u003e图形界面的配置工具\u003c/li\u003e\n  \u003cli\u003e增加系统托盘图标\u003c/li\u003e\n  \u003cli\u003e托盘图标和输入条提供右键菜单，如皮肤切换、选择输入法等\u003c/li\u003e\n  \u003cli\u003e放弃GBK编码，改用UTF-8编码\u003c/li\u003e\n  \u003cli\u003e拼音支持多词库\u003c/li\u003e\n  \u003cli\u003e一系列细节功能及Bug修复\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e最主要的特性只有前两个，可见fcitx 4.0只是这个项目涅槃后的一个新的起点，象征意义大于实际意义，尤其对于码表输入法用户来说是这样。三年前我就\u003ca href=\"http://0x3f.org/?p=185\"\u003e说过\u003c/a\u003e，fcitx在用户造词上有个致命缺陷，就是对于多音字它总是使用字母表中声母靠前的编码，对于音码或者音形码输入法来说，这样造出来的词的编码经常会是错的，更糟糕的是用户还不容易自行修改词组编码。三年后的今天，新版本并没有解决这个问题。\u003c/p\u003e\n\u003cp\u003e此外，需要注意的是，新版本对界面和易用性的改进也带来一些负面的影响，fcitx不再是当年以轻巧著称的那只小企鹅了，在我这里，它的内存占用达到了26M，所幸反应速度仍然很快。\u003c/p\u003e\n\u003cp\u003e三年前，由于众所周知的原因，fcitx的路线图显得非常混乱，几个新版本都非常不稳定，所以我不再使用源中的版本，转而编译安装了新版本中相对稳定的黑色星期五版，不知不觉中三年过去了，想到一直用著这个版本就这么过来了，很感慨。要卸载编译安装的程序就得用源码重新configure一下再make uninstall，所幸还能在\u003ca href=\"http://www.fcitx.org/download/fcitx-3.5-BlackFri.tar.bz2\"\u003e这里\u003c/a\u003e找到这个版本。\u003c/p\u003e\n\u003cp\u003eArchlinux下安装AUR中的fcitx-config时报如下错误：\u003c/p\u003e\n\u003cblockquote\u003e\nERROR: certificate common name “*.github.com” doesn’t match requested host name “github.com”.\n\u003c/blockquote\u003e\n\u003cp\u003e需要修改/etc/makepkg.conf，使wget在下载源码时不做安全验证：\u003c/p\u003e\n\u003cblockquote\u003e\n# 增加--no-check-certificate参数\nDLAGENTS=('ftp::/usr/bin/wget -c --passive-ftp -t 3 --waitretry=3'\n          'http::/usr/bin/wget -c -t 3 --waitretry=3 --no-check-certificate'\n          'https::/usr/bin/wget -c -t 3 --waitretry=3 --no-check-certificate'\n          'rsync::/usr/bin/rsync -z'\n          'scp::/usr/bin/scp -C')\n\u003c/blockquote\u003e\n\u003cp\u003e新版本的稳定性不如黑色星期五版，如果把简繁转换热键修改为ALT+J，使用时会导致fcitx崩溃。加之实际功能的改进不大，所以是否升级就无可无不可了。\u003c/p\u003e","title":"升级fcitx到4.0"},{"content":"简述\n目标：移除Windows 7，整块硬盘完全分配给Archlinux。\n原分区结构：\n分区类型挂载文件系统容量 /dev/sda1主分区，启动分区Windows 7的安装分区ntfs30G /dev/sda2扩展分区--- /dev/sda5逻辑分区Windows的D盘ntfs40G /dev/sda3主分区/ext378G /dev/sda4交换分区swap-2G 调整后分区结构：\n分区类型挂载文件系统容量 /dev/sda1主分区，启动分区/ext330G /dev/sda2主分区/homeext3120G /dev/sda3交换分区swap-2G 步骤\n```bash sudo grub-install /dev/sda ``` ```bash sudo vi /boot/grub/menu.lst ``` # (2) Arch Linux title Arch Linux root (hd0,0) kernel /boot/vmlinuz26 root=/dev/sda1 resume=/dev/sda4 ro acpi_osi=\"Linux\" initrd /boot/kernel26.img 安装U盘启动的Puppy Linux ```bash mkfs.ext3 /dev/sda1 ``` ```bash # 先点击桌面上sda1和sda3的盘符，使之被挂载到/mnt下 cd /mnt/sda3 cp -a * /mnt/sda1 ``` ```bash vi /mnt/sda1/etc/fstab ``` # 修改必要的挂载点，如将根目录的挂载点由sda3改为sda1： /dev/sda1 / ext3 defaults,noatime 0 1 重启系统，并引导到新分区上的系统中 ```bash sudo grub-install /dev/sda ``` 重启并进入Puppy，使用gparted删除除sda1以外的所有分区，然后在空闲的空间上创建ext3格式的主分区sda2和交换分区sda3 ```bash cp -a /mnt/sda1/home/* /mnt/sda2 rm -rf /mnt/sda1/home/* ``` ```bash vi /mnt/sda1/etc/fstab ``` # 将fstab中磁盘分区的挂载点配置为如下内容 /dev/sda1 / ext3 defaults,noatime 0 1 /dev/sda2 /home ext3 defaults,noatime 1 2 /dev/sda3 swap swap defaults 0 0 ```bash vi /mnt/boot/grub/menu.lst ``` # 将原来启动项中的sda3修改为sda1，由于配置过休眠，也将resume参数中的sda4改为sda3，即交换分区 重启系统 后记\n从Arch诞生时只装XP，到装上Archlinux后双系统并存，再到尝试Win7，两年的时间里，一直有很多原因让Windows像只寄生虫一样顽强地活著。最近硬盘空间越来越紧张，早前装的Win7也很长时间不用了，于是时隔三年之后，我又成了个纯粹的Archer。\n","permalink":"http://0x3f.org/posts/adjust-disk-partitions-in-archlinux/","summary":"\u003cp\u003e\u003ch2\u003e简述\u003c/h2\u003e\u003c/p\u003e\n\n\u003cp\u003e目标：移除Windows 7，整块硬盘完全分配给Archlinux。\u003c/p\u003e\n\n\u003cp\u003e原分区结构：\u003c/p\u003e\n\n\u003cp\u003e\n\u003ctable class=\"art_tbl\"\u003e\n\u003ctr\u003e\u003cth class=\"art_tbl_th\"\u003e分区\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e类型\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e挂载\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e文件系统\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e容量\u003c/th\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda1\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e主分区，启动分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003eWindows 7的安装分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003entfs\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e30G\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda2\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e扩展分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e-\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e-\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e-\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda5\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e逻辑分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003eWindows的D盘\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003entfs\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e40G\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda3\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e主分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e/\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003eext3\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e78G\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda4\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e交换分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003eswap\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e-\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e2G\u003c/td\u003e\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/p\u003e\n\n\u003cp\u003e调整后分区结构：\u003c/p\u003e\n\n\u003cp\u003e\n\u003ctable class=\"art_tbl\"\u003e\n\u003ctr\u003e\u003cth class=\"art_tbl_th\"\u003e分区\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e类型\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e挂载\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e文件系统\u003c/th\u003e\u003cth class=\"art_tbl_th\"\u003e容量\u003c/th\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda1\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e主分区，启动分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e/\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003eext3\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e30G\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda2\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e主分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e/home\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003eext3\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e120G\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd class=\"art_tbl_td\"\u003e/dev/sda3\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e交换分区\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003eswap\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e-\u003c/td\u003e\u003ctd class=\"art_tbl_td\"\u003e2G\u003c/td\u003e\u003c/tr\u003e\n\u003c/table\u003e\n\u003c/p\u003e\n\n\u003cp\u003e\u003ch2\u003e步骤\u003c/h2\u003e\u003c/p\u003e\n\n\u003col\u003e\n```bash\nsudo grub-install /dev/sda\n```\n```bash\nsudo vi /boot/grub/menu.lst\n```\n# (2) Arch Linux\ntitle  Arch Linux\nroot   (hd0,0)\nkernel /boot/vmlinuz26 root=/dev/sda1 resume=/dev/sda4 ro acpi_osi=\"Linux\"\ninitrd /boot/kernel26.img\n\u003c/blockquote\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"http://0x3f.org/?p=1699\"\u003e安装U盘启动的Puppy Linux\u003c/a\u003e\u003c/li\u003e\n```bash\nmkfs.ext3 /dev/sda1\n```\n```bash\n# 先点击桌面上sda1和sda3的盘符，使之被挂载到/mnt下\n\ncd /mnt/sda3\ncp -a * /mnt/sda1\n```\n```bash\nvi /mnt/sda1/etc/fstab\n```\n# 修改必要的挂载点，如将根目录的挂载点由sda3改为sda1：\n/dev/sda1           /         ext3      defaults,noatime       0       1\n\u003c/blockquote\u003e\u003c/li\u003e\n  \u003cli\u003e重启系统，并引导到新分区上的系统中\u003c/li\u003e\n```bash\nsudo grub-install /dev/sda\n```\n  \u003cli\u003e重启并进入Puppy，使用gparted删除除sda1以外的所有分区，然后在空闲的空间上创建ext3格式的主分区sda2和交换分区sda3\u003c/li\u003e\n```bash\ncp -a /mnt/sda1/home/* /mnt/sda2\nrm -rf /mnt/sda1/home/*\n```\n```bash\nvi /mnt/sda1/etc/fstab\n```\n# 将fstab中磁盘分区的挂载点配置为如下内容\n/dev/sda1        /          ext3      defaults,noatime         0        1\n/dev/sda2        /home      ext3      defaults,noatime         1        2\n/dev/sda3        swap       swap      defaults                 0        0\n```bash\nvi /mnt/boot/grub/menu.lst\n```\n# 将原来启动项中的sda3修改为sda1，由于配置过休眠，也将resume参数中的sda4改为sda3，即交换分区\n\u003c/blockquote\u003e\n  \u003cli\u003e重启系统\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ch2\u003e后记\u003c/h2\u003e\u003c/p\u003e","title":"调整Arch的磁盘分区"},{"content":"Puppy Linux的体积只有一百多兆字节，但图形界面实现得很完备，也包含了很多短小精悍的工具，安装和使用都很方便，非常适合用来做日常维护工具盘。\nPuppy自带了傻瓜式的启动U盘制作工具，但官方只提供整个发行版的ISO镜像下载，通常需要刻录成光盘并引导系统启动后才可以继续将Puppy安装到U盘。其实也可以不刻录光盘，而是把Puppy安装到硬盘上。\nPuppy本身封装得很好，对软硬件环境的要求不高，完全可以安装到一个独立的目录中而不影响其它操作系统。本文基于Linux环境下通过GRUB引导的前提，Windows下应该可以通过GRUB4DOS引导。\n挂载Puppy的ISO镜像到一个目录： 1 sudo mount -o loop puppy.iso /media/puppy 复制镜像中的所有文件到根目录下的puppy目录： 1 2 sudo mkdir /puppy sudo cp -a /media/puppy/* /puppy 修改GRUB的引导文件，加入Puppy的引导项： 1 sudo vi /boot/grub/menu.lst # (2) Puppy title Puppy root (hd0,2) kernel /puppy/vmlinuz root=/dev/ram0 initrd /puppy/initrd.gz 重启系统并启动到Puppy\n使用桌面上的Setup中的Puppy Universal Installer制作启动U盘。不过虽然这是官方推荐的制作工具，但我的杂牌U盘无论如何也不能引导系统，最后使用另一个备选的工具“BootFlash USB Installer”的USB-HDD模式制作成功。\n","permalink":"http://0x3f.org/posts/howto-create-bootable-udisk-for-puppylinux/","summary":"\u003cp\u003ePuppy Linux的体积只有一百多兆字节，但图形界面实现得很完备，也包含了很多短小精悍的工具，安装和使用都很方便，非常适合用来做日常维护工具盘。\u003c/p\u003e\n\u003cp\u003ePuppy自带了傻瓜式的启动U盘制作工具，但官方只提供整个发行版的ISO镜像下载，通常需要刻录成光盘并引导系统启动后才可以继续将Puppy安装到U盘。其实也可以不刻录光盘，而是把Puppy安装到硬盘上。\u003c/p\u003e\n\u003cp\u003ePuppy本身封装得很好，对软硬件环境的要求不高，完全可以安装到一个独立的目录中而不影响其它操作系统。本文基于Linux环境下通过GRUB引导的前提，Windows下应该可以通过GRUB4DOS引导。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e挂载Puppy的ISO镜像到一个目录：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo mount -o loop puppy.iso /media/puppy\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e复制镜像中的所有文件到根目录下的puppy目录：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo mkdir /puppy\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo cp -a /media/puppy/* /puppy\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003e修改GRUB的引导文件，加入Puppy的引导项：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo vi /boot/grub/menu.lst\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cblockquote\u003e\n# (2) Puppy\ntitle Puppy\nroot (hd0,2)\nkernel /puppy/vmlinuz root=/dev/ram0\ninitrd /puppy/initrd.gz\n\u003c/blockquote\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003e\n\u003cp\u003e重启系统并启动到Puppy\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e使用桌面上的\u003cstrong\u003eSetup\u003c/strong\u003e中的\u003cstrong\u003ePuppy Universal Installer\u003c/strong\u003e制作启动U盘。不过虽然这是官方推荐的制作工具，但我的杂牌U盘无论如何也不能引导系统，最后使用另一个备选的工具“\u003cstrong\u003eBootFlash USB Installer\u003c/strong\u003e”的\u003cstrong\u003eUSB-HDD\u003c/strong\u003e模式制作成功。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e","title":"制作Puppy Linux的启动U盘"},{"content":" 创建Twitter应用程序 从2010年9月起，twitter只支持第三方应用程序使用oauth方式登录。要使用第三方API程序，就必须先在twitter中创建应用程序。\n申请地址如下：\nhttps://twitter.com/apps/\n填写信息时，Application Type应该选Browser，Default Access type应选Read \u0026amp; Write，User Twitter for login不选，其它随便。\n创建成功后，该应用程序的Consumer key和Consumer secret在部署API时一般都要用到。\n第三方API程序 gtap gtap使用python开发，可部署在appspot上。\n部署前，先修改app.yaml，填写在appspot上创建的应用程序的ID，并使用符号#注释掉secure: always，因为GFW屏蔽了appspot的https。\n然后修改main.py，填写Consumer key和Consumer secret。\n最后安装App Engine SDK，使用其中的appcfg.py上传gtap文件夹：\n1 appcfg.py update gtap 在浏览器中（此时应使用可以翻墙的代理）访问在appspot上创建的应用程序的URL地址（如：http://xxx.appspot.com ），在打开的页面中点击Sign in with Twitter，然后在跳转到的页面中点击Allow按钮。在跳转到的页面上修改API的密码（据说有些客户端要求API的密码与Twitter的密码一致）。\n在客户端中使用API的地址如下：\nhttp://xxx.appspot.com/ 其中，xxx是appspot应用程序的ID，末尾的斜杠必不可少。\ntwip twip使用php开发，应部署在支持PHP的服务器上。\n首先将config-example.php改名为config.php，然后修改其中的OAUTH_KEY/OAUTH_SECRET/BASE_URL三项内容，前两项分别是Consumer key和Consumer secret，base_url应该是twip部署到服务器上后的URL地址（如http://myblog.com/twip/ ，最后的斜杠必不可少）。\n然后在浏览器中访问上面的base_url，选择使用o模式，API地址会在最后的页面中输出。\n补充说明 当前版本的Google App Engine SDK要求使用python 2.5，但如果只是用来上传应用程序到appspot，2.5以上版本的python也可以用，只是在上传时会报某些模块已不推荐使用。如果使用appcfg.py时报找不到2.5版本的python，可以强制使用已安装的新版本的python执行之，即：python appcfg.py update gtap ","permalink":"http://0x3f.org/posts/howto-setup-twitter-api-of-your-own/","summary":"\u003ch2\u003e 创建Twitter应用程序 \u003c/h2\u003e\n\u003cp\u003e从2010年9月起，twitter只支持第三方应用程序使用oauth方式登录。要使用第三方API程序，就必须先在twitter中创建应用程序。\u003c/p\u003e\n\u003cp\u003e申请地址如下：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/apps/\"\u003ehttps://twitter.com/apps/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e填写信息时，\u003cb\u003eApplication Type\u003c/b\u003e应该选\u003cb\u003eBrowser\u003c/b\u003e，\u003cb\u003eDefault Access type\u003c/b\u003e应选\u003cb\u003eRead \u0026amp; Write\u003c/b\u003e，\u003cb\u003eUser Twitter for login\u003c/b\u003e不选，其它随便。\u003c/p\u003e\n\u003cp\u003e创建成功后，该应用程序的\u003cb\u003eConsumer key\u003c/b\u003e和\u003cb\u003eConsumer secret\u003c/b\u003e在部署API时一般都要用到。\u003c/p\u003e\n\u003ch2\u003e 第三方API程序 \u003c/h2\u003e\n\u003ch3\u003e gtap \u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"http://code.google.com/p/gtap/\"\u003egtap\u003c/a\u003e使用python开发，可部署在appspot上。\u003c/p\u003e\n\u003cp\u003e部署前，先修改\u003cb\u003eapp.yaml\u003c/b\u003e，填写在appspot上创建的应用程序的ID，并使用符号#注释掉\u003cb\u003esecure: always\u003c/b\u003e，因为GFW屏蔽了appspot的https。\u003c/p\u003e\n\u003cp\u003e然后修改\u003cb\u003emain.py\u003c/b\u003e，填写Consumer key和Consumer secret。\u003c/p\u003e\n\u003cp\u003e最后安装\u003ca href=\"http://code.google.com/intl/zh-CN/appengine/downloads.html\"\u003eApp Engine SDK\u003c/a\u003e，使用其中的\u003cb\u003eappcfg.py\u003c/b\u003e上传gtap文件夹：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eappcfg.py update gtap\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e在浏览器中（此时应使用可以翻墙的代理）访问在appspot上创建的应用程序的URL地址（如：http://xxx.appspot.com ），在打开的页面中点击\u003cb\u003eSign in with Twitter\u003c/b\u003e，然后在跳转到的页面中点击\u003cb\u003eAllow\u003c/b\u003e按钮。在跳转到的页面上修改API的密码（据说有些客户端要求API的密码与Twitter的密码一致）。\u003c/p\u003e\n\u003cp\u003e在客户端中使用API的地址如下：\u003c/p\u003e\n\u003cblockquote\u003e\nhttp://xxx.appspot.com/\n\u003c/blockquote\u003e\n\u003cp\u003e其中，\u003cb\u003exxx\u003c/b\u003e是appspot应用程序的ID，末尾的斜杠必不可少。\u003c/p\u003e\n\u003ch3\u003e twip \u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"http://code.google.com/p/twip/\"\u003etwip\u003c/a\u003e使用php开发，应部署在支持PHP的服务器上。\u003c/p\u003e\n\u003cp\u003e首先将\u003cb\u003econfig-example.php\u003c/b\u003e改名为\u003cb\u003econfig.php\u003c/b\u003e，然后修改其中的OAUTH_KEY/OAUTH_SECRET/BASE_URL三项内容，前两项分别是Consumer key和Consumer secret，base_url应该是twip部署到服务器上后的URL地址（如http://myblog.com/twip/ ，最后的斜杠必不可少）。\u003c/p\u003e\n\u003cp\u003e然后在浏览器中访问上面的base_url，选择使用o模式，API地址会在最后的页面中输出。\u003c/p\u003e\n\u003ch2\u003e 补充说明 \u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e当前版本的Google App Engine SDK要求使用python 2.5，但如果只是用来上传应用程序到appspot，2.5以上版本的python也可以用，只是在上传时会报某些模块已不推荐使用。如果使用appcfg.py时报找不到2.5版本的python，可以强制使用已安装的新版本的python执行之，即：python appcfg.py update gtap\u003c/li\u003e\n\u003c/ol\u003e","title":"搭建自己的Twitter API"},{"content":"du du是命令行中用于查看目录和文件的空间占用情况的指令。\n常用示例：\n1 du -h /tmp/logs ncdu ncdu为du提供了一个基于NCurses的命令行用户界面，并能够按照多种条件对分析结果进行排序，它大大简化了du指令的使用。\nbaobab baobab使用基于GTK的图形用户界面，突出特点是可以分析远程目录。\n参考 磁盘目录占用空间计算排序工具 - ncdu ","permalink":"http://0x3f.org/posts/storage-space-analysing-tools/","summary":"\u003ch3\u003edu\u003c/h3\u003e\n\u003cp\u003edu是命令行中用于查看目录和文件的空间占用情况的指令。\u003c/p\u003e\n\u003cp\u003e常用示例：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edu -h /tmp/logs\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3\u003encdu\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"http://dev.yorhel.nl/ncdu\"\u003encdu\u003c/a\u003e为du提供了一个基于NCurses的命令行用户界面，并能够按照多种条件对分析结果进行排序，它大大简化了du指令的使用。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/xQINh1zrBdZcY27Evm9Cog?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/TKWkJk8hkjI/AAAAAAAABfU/vTIJqHTxAX0/s400/disk_usage_analyzers-ncdu_01.png\" height=\"250\" width=\"400\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003ebaobab\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"http://www.marzocca.net/linux/baobab/index.html\"\u003ebaobab\u003c/a\u003e使用基于GTK的图形用户界面，突出特点是可以分析远程目录。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/rGbtFe2Je23r1TB1MmX-tA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TKWkJ1_yLJI/AAAAAAAABfY/pt_peEEU2f8/s400/disk_usage_analyzers-baobab_01.png\" height=\"400\" width=\"386\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003e参考\u003c/h3\u003e\n\u003col\u003e\n    \u003cli\u003e\u003ca href=\"http://www.vpser.net/manage/ncdu.html\"\u003e磁盘目录占用空间计算排序工具 - ncdu\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e","title":"目录与文件的存储空间占用分析工具"},{"content":"可以让回忆放肆一些。\n中秋的晚上公司餐厅放电影，《邻家特工》和《越光宝盒》，本来打算看完《越光》就走，结果先放的是《特工》。也好，复习一下，好在这片子不错，再看也挺有意思。《越光》纯属烂片，但是如今看看这种不费脑子的东西也变得无可无不可。免费的零食很烘托气氛，唯一的惊喜是居然还有罐装啤酒。\n回到住处的当夜就发布了Dumperor。其实这个东西很早就开始做了，起初的目的是为了判断数据库脚本从SQL Server迁移到Oracle和MySQL是否成功。单纯的迁移只能保证修改后的脚本在这两个数据库中执行不会报错，但究竟是不是该执行的东西都成功执行了，一般很难判断，尤其是那帮家伙总是在发版前一两天才告诉我要迁移脚本，那么多不规范的语句，能保证不报错就已经不错了，遑论没有遗漏。所以就著手做一个数据库表结构和数据的导出工具，这样只需用diff工具比较标准数据库和测试数据库导出的脚本就可以了。\n从一开始我就决定不使用公司产品的一行代码。其实做这个东西最大的麻烦不是来自来自于如何查询不同的数据库的表结构，而是数据库抽象层。如果要白手起家搞个抽象层的话，我想可能代码量比Dumperor本身都大，于是选择了Yii框架。后来在Dumperor基本成型时又觉得为了仅仅使用最基本的数据库查询功能就捆绑这么大一个框架，有点搞笑，谢天谢地，我终于花时间学了PDO。\n中秋节放假的第二天，开始读Google Code上关于Chrome扩展开发的官方文档。这事源于本尊被另一个Chrome扩展作者无视了。\n一直强迫自己喜欢上Firefox，但都败了。本来对Opera充满希望，但是从10.0起它带给我的除了失望就是更多的失望，这个东西的发展就像它的国家的位置一样怪异，你永远不能以常人的思维去臆测Opera的开发者，他们就像一群母系氏族社会的娘们儿一样整天跟著感觉走。\n于是不知道什么时候我就开始经常用Chrome了，前段时间开始用一个扩展辅助MLDonkey下载。这个东西会在工具栏里添加一个图标，唯一的作用就是打开选项设置页面设置那个也许这辈子都只需要设置一次的MLDonkey的URL地址。于是我给那个扩展的作者写了封邮件，那家伙居然到现在都没有回复。\n所以本尊决定无视他了。太祖武皇帝的那句丰衣足食的圣谕真是至理名言，读完文档我就发现这个扩展完全应该用Chrome的Page Action取代Browser Action，简单地说就是当且仅当本页面中包含有可下载的资源时才在地址栏中显示一个图标，而不应该总是在工具栏占用一个图标的位置。\n随后要做的就是用AJAX请求取代弹出新窗口的方式添加下载任务，我嫌每次添加一个下载任务后都要关闭一个弹出窗口太麻烦。我的目标是用AJAX请求将要下载的任务在后台传递给MLDonkey，并用Chrome的Desktop Notification功能弹出桌面提示对话框显示结果状态。这样很优雅。\n但是实际去做的时候问题来了，虽然Chrome本身允许扩展使用跨域的AJAX，但是至少在和MLDonkey进行通讯时，无论成功与否，得到的返回信息都是空的，状态码也都是0。这个问题浪费了我几乎一整天的时间，最终我决定用AJAX的请求响应时间来判断失败或成功，因为一次AJAX请求响应过程在MLDonkey没启动的时候耗费的时间一般会比正在运行时要长。这就要求每个用户都要根据自己的情况设定合适的超时时间。为了避免麻烦，最后还是实现了通过弹窗添加下载任务的模式，毕竟这个东西总是可靠的。\n要发布的时候发现如今在Chrome Extension Gallery中发布扩展居然要收费了，虽然只是一次性的。最后花了八两银子注册了Google Checkout账户，又付了五刀美帝币，才把DonkeyBuddy传上去。发布个免费扩展还得倒贴，本尊也太背了吧。\n节后收到了Dell sk8115键盘、HP百灵无线鼠标和Nokia BH-105蓝牙耳机，sk8115是用来让我的纤纤玉手撒野的，百灵鼠是用来接替即将退役的雷柏7100的，而BH-105和我的小七搭配得天衣无缝。\n很久没有安静地整理一下头绪了，感谢我那价值四十两银子的Dell sk8115，它让我显得如此的语无伦次。\n","permalink":"http://0x3f.org/posts/note-after-the-mid-autumn-day/","summary":"\u003cp\u003e可以让回忆放肆一些。\u003c/p\u003e\n\u003cp\u003e中秋的晚上公司餐厅放电影，《邻家特工》和《越光宝盒》，本来打算看完《越光》就走，结果先放的是《特工》。也好，复习一下，好在这片子不错，再看也挺有意思。《越光》纯属烂片，但是如今看看这种不费脑子的东西也变得无可无不可。免费的零食很烘托气氛，唯一的惊喜是居然还有罐装啤酒。\u003c/p\u003e\n\u003cp\u003e回到住处的当夜就发布了Dumperor。其实这个东西很早就开始做了，起初的目的是为了判断数据库脚本从SQL Server迁移到Oracle和MySQL是否成功。单纯的迁移只能保证修改后的脚本在这两个数据库中执行不会报错，但究竟是不是该执行的东西都成功执行了，一般很难判断，尤其是那帮家伙总是在发版前一两天才告诉我要迁移脚本，那么多不规范的语句，能保证不报错就已经不错了，遑论没有遗漏。所以就著手做一个数据库表结构和数据的导出工具，这样只需用diff工具比较标准数据库和测试数据库导出的脚本就可以了。\u003c/p\u003e\n\u003cp\u003e从一开始我就决定不使用公司产品的一行代码。其实做这个东西最大的麻烦不是来自来自于如何查询不同的数据库的表结构，而是数据库抽象层。如果要白手起家搞个抽象层的话，我想可能代码量比Dumperor本身都大，于是选择了Yii框架。后来在Dumperor基本成型时又觉得为了仅仅使用最基本的数据库查询功能就捆绑这么大一个框架，有点搞笑，谢天谢地，我终于花时间学了PDO。\u003c/p\u003e\n\u003cp\u003e中秋节放假的第二天，开始读Google Code上关于Chrome扩展开发的官方文档。这事源于本尊被另一个Chrome扩展作者无视了。\u003c/p\u003e\n\u003cp\u003e一直强迫自己喜欢上Firefox，但都败了。本来对Opera充满希望，但是从10.0起它带给我的除了失望就是更多的失望，这个东西的发展就像它的国家的位置一样怪异，你永远不能以常人的思维去臆测Opera的开发者，他们就像一群母系氏族社会的娘们儿一样整天跟著感觉走。\u003c/p\u003e\n\u003cp\u003e于是不知道什么时候我就开始经常用Chrome了，前段时间开始用一个扩展辅助MLDonkey下载。这个东西会在工具栏里添加一个图标，唯一的作用就是打开选项设置页面设置那个也许这辈子都只需要设置一次的MLDonkey的URL地址。于是我给那个扩展的作者写了封邮件，那家伙居然到现在都没有回复。\u003c/p\u003e\n\u003cp\u003e所以本尊决定无视他了。太祖武皇帝的那句丰衣足食的圣谕真是至理名言，读完文档我就发现这个扩展完全应该用Chrome的Page Action取代Browser Action，简单地说就是当且仅当本页面中包含有可下载的资源时才在地址栏中显示一个图标，而不应该总是在工具栏占用一个图标的位置。\u003c/p\u003e\n\u003cp\u003e随后要做的就是用AJAX请求取代弹出新窗口的方式添加下载任务，我嫌每次添加一个下载任务后都要关闭一个弹出窗口太麻烦。我的目标是用AJAX请求将要下载的任务在后台传递给MLDonkey，并用Chrome的Desktop Notification功能弹出桌面提示对话框显示结果状态。这样很优雅。\u003c/p\u003e\n\u003cp\u003e但是实际去做的时候问题来了，虽然Chrome本身允许扩展使用跨域的AJAX，但是至少在和MLDonkey进行通讯时，无论成功与否，得到的返回信息都是空的，状态码也都是0。这个问题浪费了我几乎一整天的时间，最终我决定用AJAX的请求响应时间来判断失败或成功，因为一次AJAX请求响应过程在MLDonkey没启动的时候耗费的时间一般会比正在运行时要长。这就要求每个用户都要根据自己的情况设定合适的超时时间。为了避免麻烦，最后还是实现了通过弹窗添加下载任务的模式，毕竟这个东西总是可靠的。\u003c/p\u003e\n\u003cp\u003e要发布的时候发现如今在Chrome Extension Gallery中发布扩展居然要收费了，虽然只是一次性的。最后花了八两银子注册了Google Checkout账户，又付了五刀美帝币，才把DonkeyBuddy传上去。发布个免费扩展还得倒贴，本尊也太背了吧。\u003c/p\u003e\n\u003cp\u003e节后收到了Dell sk8115键盘、HP百灵无线鼠标和Nokia BH-105蓝牙耳机，sk8115是用来让我的纤纤玉手撒野的，百灵鼠是用来接替即将退役的雷柏7100的，而BH-105和我的小七搭配得天衣无缝。\u003c/p\u003e\n\u003cp\u003e很久没有安静地整理一下头绪了，感谢我那价值四十两银子的Dell sk8115，它让我显得如此的语无伦次。\u003c/p\u003e","title":"中秋后记"},{"content":" DonkeyBuddy is an extension for Google Chrome Browser. It's intended to make life easier when you add downloading tasks to MLDonkey.\nFeatures Users can choose how to interact with MLDonkey, either by AJAX or popup windows. The AJAX mode interacts with MLDonkey by AJAX requests and uses desktop notifications to show the results, so it won't bother you by popping up windows and forcing you to close them. The popup-window mode interacts with MLDonkey by popping up a window and displays results in it, this is always a reliable way to add downloads but annoying. An icon will be displayed in the location bar only when downloadable resources are found in the current tab, so it saves you the space in both toolbar and location bar. Batch downloading. Screenshots Location bar icon: Desktop notification: Popup window: Settings page: Install https://chrome.google.com/webstore/detail/hbajjpcakkngealbehjippmdbfapodnn\nFAQ Why a success notification pops up when I haven't even started MLDonkey ?\nSince the responses of the cross-domain AJAX requests have an empty message and a status which has the value 0, so I can't identify that whether they are successful or not. But when MLDonkey is not running, AJAX requests always take more time to receive responses, so if a request has not received its reponse within a reasonable time, DonkeyBuddy will take it as a failure. So you should set the *AJAX timeout* option to a suitable value on your condition. If you are still in trouble, use the popup-windows mode instead. Why a failure notification pops up when the downloading task has acturally been added ?\nTake a look at the upper question. How can I send the selected links to MLDonkey in one click ?\nClick on this extension's icon in the address bar. Change log version 1.1.0 (2011-05-15 Sunday) Enable batch downloading for VeryCD.com.\nversion 1.0.1 (2010-09-25 Saturday) 1. Fix the problem that the image in the option page doesn't display as is expected. 2. Set the default value of the option *AJAX timeout* to 1000.\nversion 1.0 (2010-09-24 Friday) Initial release.\n","permalink":"http://0x3f.org/posts/donkeybuddy-a-chrome-extension-for-mldonkey/","summary":"\u003cdiv class=\"illustration_left\"\u003e\n\u003ca href=\"http://picasaweb.google.com/lh/photo/CLpE8Gtpb3r3F9kcqmS60g?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/TJyWhIpMAgI/AAAAAAAABec/KDw6n_qdQ98/s800/donkey-256x256.png\" /\u003e\u003c/a\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eDonkeyBuddy\u003c/strong\u003e is an extension for Google Chrome Browser. It's intended to make life easier when you add downloading tasks to MLDonkey.\u003c/p\u003e\n\n\u003ch2\u003eFeatures\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eUsers can choose how to interact with MLDonkey, either by AJAX or\npopup windows.\u003c/li\u003e\n\u003cli\u003eThe AJAX mode interacts with MLDonkey by AJAX requests and uses\ndesktop notifications to show the results, so it won't bother you by\npopping up windows and forcing you to close them.\u003c/li\u003e\n\u003cli\u003eThe popup-window mode interacts with MLDonkey by popping up a window\nand displays results in it, this is always a reliable way to add\ndownloads but annoying.\u003c/li\u003e\n\u003cli\u003eAn icon will be displayed in the location bar only when downloadable\nresources are found in the current tab, so it saves you the space in\nboth toolbar and location bar.\u003c/li\u003e\n\u003cli\u003eBatch downloading.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003eScreenshots\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eLocation bar icon: \u003cbr /\u003e\n\u003ca href=\"http://picasaweb.google.com/lh/photo/021647BS--VLalgORMtuVA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/TJyWhUJIzBI/AAAAAAAABeg/ZQ2WeLfTf0k/s800/donkeybuddy-location_bar_icon_01.png\" alt=\"image\" /\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eDesktop notification: \u003cbr /\u003e\n\u003ca href=\"http://picasaweb.google.com/lh/photo/aBu0jSZu3y7Ux-EKKgQibQ?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/TJyWhchc1lI/AAAAAAAABek/O3OuDRkgL88/s400/donkeybuddy-notification_01.png\" alt=\"image\" /\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003ePopup window: \u003cbr /\u003e\n\u003ca href=\"http://picasaweb.google.com/lh/photo/GbGe38VG8mU_LyXZDFYgtA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/TJyWhmg-04I/AAAAAAAABeo/8cbj0a-m_Fg/s400/donkeybuddy-popup_window_01.png\" alt=\"image\" /\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eSettings page: \u003cbr /\u003e\n\u003ca href=\"http://picasaweb.google.com/lh/photo/uUKzfwcmEQfJaHY6cHVNqw?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TJyWhsEQILI/AAAAAAAABes/ezlPD6jaUuQ/s400/donkeybuddy-settings_01.png\" alt=\"image\" /\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003eInstall\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://chrome.google.com/webstore/detail/hbajjpcakkngealbehjippmdbfapodnn\"\u003ehttps://chrome.google.com/webstore/detail/hbajjpcakkngealbehjippmdbfapodnn\u003c/a\u003e\u003c/p\u003e","title":"DonkeyBuddy: A Chrome Extension for MLDonkey"},{"content":" Dumperor is a multi-database dumping toolkit. It dumps table structures and data from databases, and generates CREATE-TABLE SQL statements for table structures or INSERT SQL statements for data.\nPart of the original intention for developing Dumperor is to check whether a migration of SQL scripts from one database to another is successful, you know, by comparing the differences between two files, one dumped before executing scripts and the other after. The second part is to ensure that upgrades to table structures or data not miss anything, similarly. The last part is to take samples of databases and put up development or testing environments with them, or even replace sensitive information with fake data.\nDumperor is written in PHP 5 and hosted on GitHub with the New BSD License:\nhttps://github.com/xbot/Dumperor\nFor the shortage of time, there must be some limitations and bugs in Dumperor. So reports from users are welcome, emails prefered. I will be very grateful if someone send their suggestions on Dumpeor to me.\nFeatures Currently support Microsoft SQL Server, Oracle and MySQL. Dump table structures and generate CREATE-TABLE SQL statements. Dump data and generate INSERT SQL statements. Dump table structures or data and output them in a human readable format. Save dumped information to user-specified files. Display table structures with web page tables in the web browser. Options controlling which information should be displayed in the web browser. Options controlling which information should be and should not be dumped from the database. A limit number can be set to take sample of a huge database. Needless tables or columns can be prevented from appearing in dumped results. Only the needed tables are to be exported if you like. Sensitive columns can be dumped with fake data. Conditions can be added to data querying statements. With PDO support by default but extensive to many kinds of database toolkits. More in the future ... Requirements A web server configured with PHP5 support. PDO feature of PHP. PHP 5.x, notice that some versions in 5.3.x series have a bug in function parse_ini_file(), which may cause trouble. Limitations (Known Issues) Conditions for data querying only support numeric columns and equation relation. Support for auto increment columns has not been implemented. Sensitive columns must be prefixed with table names. Needless columns must be specified only with column names, nothing more. Data types which have not been tested may fail dumping. Installation Instructions Download a stable release from GitHub or clone a git repo: git clone git://github.com/xbot/Dumperor.git Copy files to a folder which can be visited by the web server, e.g. www/dumperor. Rename dumperor.ini.sample to dumperor.ini and change the settings to meet your needs. Visit Dumperor from the web browser to start dumping. News 2011-03-14 v1.0.0 released. changelog 2010-09-22 v0.1a released. changelog ","permalink":"http://0x3f.org/posts/dumperor-as-a-multidb-dumping-tool/","summary":"\u003cdiv class=\"illustration_left\"\u003e\n    \u003ca href=\"http://picasaweb.google.com/lh/photo/lR2jgtHibgYwfhCy3fJyMQ?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TI44ZufyOhI/AAAAAAAABeM/6ElHu0gdYzY/s800/dumperor.png\" /\u003e\u003c/a\u003e\n\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eDumperor\u003c/strong\u003e is a multi-database dumping toolkit. It dumps table structures and data from databases, and generates CREATE-TABLE SQL statements for table structures or INSERT SQL statements for data.\u003c/p\u003e\n\u003cp\u003ePart of the original intention for developing Dumperor is to check whether a migration of SQL scripts from one database to another is successful, you know, by comparing the differences between two files, one dumped before executing scripts and the other after. The second part is to ensure that upgrades to table structures or data not miss anything, similarly. The last part is to take samples of databases and put up development or testing environments with them, or even replace sensitive information with fake data.\u003c/p\u003e","title":"Dumperor: Multi-Database Dumping Toolkit"},{"content":"主要目标是解决我的X200在Archlinux（本文内容均基于此发行版）下CPU温度长期居高不下的问题，基本原理是使用cpufrequtils根据CPU负载状况自动变频，和使用laptop-mode-tools实现其它硬件设备的自动节能。最直接的效果是省电，从而延长电池的使用时间，产生的附加影响就是CPU及笔记本整体的温度下降。我几乎不用电池，所以节能不是我的关注点，但降温却是我所欲也。\n首先安装cpufrequtils，并将acpi-cpufreq、cpufreq_ondemand、cpufreq_powersave加入rc.conf的MODULES中，使系统在启动时加载这些模块。\n默认情况下，内核采用cpufreq的performance模式，以获得最高性能，现在用ondemand模式使CPU根据负载状况自动变频。修改/etc/conf.d/cpufreq文件，将governor项设为ondemand。\n将cpufreq加入rc.conf的DAEMONS中，此守护进程会在系统启动时读取配置文件/etc/conf.d/cpufreq中的设置项，故上面设置的ondemand模式会在系统启动时得以自动生效。\n然后安装laptop-mode-tools，并修改/etc/laptop-mode/laptop-mode.conf，打开所有的三个以ENABLE开头的选项，和所有以CONTROL开头的选项。\n将laptop-mode加入rc.conf的DAEMONS中，使其随系统自动启动。\n修改/etc/laptop-mode/conf.d/usb-autosuspend.conf，此配置文件用来配置laptop-mode如何管理USB设备的电源使用。我希望在任何时候都启用USB设备自动节能，但需要把我的无线鼠标排除在外，故作如下配置：\n```bash # 启用USB设备自动挂起 CONTROL_USB_AUTOSUSPEND=\"auto\" # 将不使用自动挂起的USB设备的ID填在下面，使用lsusb命令查看ID AUTOSUSPEND_USBID_BLACKLIST=\"04fc:05dc\" # 总是启用USB自动挂起 BATT_SUSPEND_USB=1 LM_AC_SUSPEND_USB=1 NOLM_AC_SUSPEND_USB=1 ``` 类似地，修改intel-hda-powersave.conf，此配置文件用于配置laptop-mode如何管理Intel HDA音频芯片的电源使用。我希望一直启用声卡自动节能，并适当地将自动进入节电模式的空闲时间增加到30秒，故配置如下：\n```bash # 启用Intel音频芯片电源管理 CONTROL_INTEL_HDA_POWER=\"auto\" # 总是启用 BATT_INTEL_HDA_POWERSAVE=1 LM_AC_INTEL_HDA_POWERSAVE=1 NOLM_AC_INTEL_HDA_POWERSAVE=1 # 适当地设置声卡进入节电模式的超时时间 INTEL_HDA_DEVICE_TIMEOUT=30 ``` 类似地，修改intel-sata-powermgmt.conf，启用sata硬盘接口的电源管理。由于我用Blueman控制蓝牙设备，一般不用时都将其关闭，同时经常使用wifi，故蓝牙和无线网卡均未作配置。\n最后，关闭conky,Firefox和Chromium，powertop显示conky是个很吵闹的东西，关掉它可以使Wakeups-from-idle per second的值下降很多，另外Chromium和Firefox也是耗电大户。\n在此之前，系统空闲时CPU温度一般是50多度，普通使用时一般在60多度，如果开了kvm虚拟机会达到60至90度间。经过以上设置，系统空闲时CPU温度一度下降到39度，即使开了虚拟机，一般也可维持在50到80度间。\n另外，对于以上内容，我还有些没搞明白的地方和要补充说明的东西：\n虽然将laptop-mode加入rc.conf且已随系统启动，但使用命令“cat /proc/sys/vm/laptop_mode”查询得到的结果仍然是0，也就是说没有自动启用laptop-mode，必须使用命令“sudo /etc/rc.d/laptop-mode restart”手动重启才行。目前没有找到解决办法。 虽然启用laptop-mode接管声卡电源管理，但没找到查看是否生效的方法，于是在/etc/rc.local中加入命令“echo 1 \u0026gt; /sys/module/sndhdaintel/parameters/power_save”以强制声卡节电。 Intel的powertop是个好东西，用它可以查看哪些进程最影响CPU节能。我们优化的标准之一就是使powertop中显示的“Wakeups-from-idle per second”尽可能地减少。powertop的另一个特点就是通过自动检查当前系统中电源使用的配置情况给出优化的建议，这是个很贴心的功能。 鉴于目前存疑较多并将继续尝试，所以在标题中特别注明“不完全”三个字……\n参考 http://itgen.blogspot.com/2009/03/energy-management-in-linux.html http://www.ibm.com/developerworks/cn/linux/l-cpufreq-1/index.html http://www.lesswatts.org/ ","permalink":"http://0x3f.org/posts/howto-cool-archlinux-down/","summary":"\u003cp\u003e主要目标是解决我的X200在Archlinux\u003cem\u003e（本文内容均基于此发行版）\u003c/em\u003e下CPU温度长期居高不下的问题，基本原理是使用\u003ca href=\"http://wiki.archlinux.org/index.php/Cpufrequtils\"\u003ecpufrequtils\u003c/a\u003e根据CPU负载状况自动变频，和使用\u003ca href=\"http://wiki.archlinux.org/index.php/Laptop_Mode_Tools\"\u003elaptop-mode-tools\u003c/a\u003e实现其它硬件设备的自动节能。最直接的效果是省电，从而延长电池的使用时间，产生的附加影响就是CPU及笔记本整体的温度下降。我几乎不用电池，所以节能不是我的关注点，但降温却是我所欲也。\u003c/p\u003e\n\n\u003cp\u003e首先安装cpufrequtils，并将\u003cstrong\u003eacpi-cpufreq\u003c/strong\u003e、\u003cstrong\u003ecpufreq_ondemand\u003c/strong\u003e、\u003cstrong\u003ecpufreq_powersave\u003c/strong\u003e加入\u003cstrong\u003erc.conf\u003c/strong\u003e的\u003cstrong\u003eMODULES\u003c/strong\u003e中，使系统在启动时加载这些模块。\u003c/p\u003e\n\n\u003cp\u003e默认情况下，内核采用cpufreq的performance模式，以获得最高性能，现在用ondemand模式使CPU根据负载状况自动变频。修改\u003cstrong\u003e/etc/conf.d/cpufreq\u003c/strong\u003e文件，将\u003cstrong\u003egovernor\u003c/strong\u003e项设为\u003cstrong\u003eondemand\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e将\u003cstrong\u003ecpufreq\u003c/strong\u003e加入\u003cstrong\u003erc.conf\u003c/strong\u003e的\u003cstrong\u003eDAEMONS\u003c/strong\u003e中，此守护进程会在系统启动时读取配置文件\u003cstrong\u003e/etc/conf.d/cpufreq\u003c/strong\u003e中的设置项，故上面设置的ondemand模式会在系统启动时得以自动生效。\u003c/p\u003e\n\n\u003cp\u003e然后安装laptop-mode-tools，并修改\u003cstrong\u003e/etc/laptop-mode/laptop-mode.conf\u003c/strong\u003e，打开所有的三个以\u003cstrong\u003eENABLE\u003c/strong\u003e开头的选项，和所有以\u003cstrong\u003eCONTROL\u003c/strong\u003e开头的选项。\u003c/p\u003e\n\n\u003cp\u003e将\u003cstrong\u003elaptop-mode\u003c/strong\u003e加入\u003cstrong\u003erc.conf\u003c/strong\u003e的\u003cstrong\u003eDAEMONS\u003c/strong\u003e中，使其随系统自动启动。\u003c/p\u003e\n\n\u003cp\u003e修改\u003cstrong\u003e/etc/laptop-mode/conf.d/usb-autosuspend.conf\u003c/strong\u003e，此配置文件用来配置laptop-mode如何管理USB设备的电源使用。我希望在任何时候都启用USB设备自动节能，但需要把我的无线鼠标排除在外，故作如下配置：\u003c/p\u003e\n\n```bash\n# 启用USB设备自动挂起\nCONTROL_USB_AUTOSUSPEND=\"auto\"\n\n# 将不使用自动挂起的USB设备的ID填在下面，使用lsusb命令查看ID\nAUTOSUSPEND_USBID_BLACKLIST=\"04fc:05dc\"\n\n# 总是启用USB自动挂起\nBATT_SUSPEND_USB=1\nLM_AC_SUSPEND_USB=1\nNOLM_AC_SUSPEND_USB=1\n```\n\n\u003cp\u003e类似地，修改\u003cstrong\u003eintel-hda-powersave.conf\u003c/strong\u003e，此配置文件用于配置laptop-mode如何管理Intel HDA音频芯片的电源使用。我希望一直启用声卡自动节能，并适当地将自动进入节电模式的空闲时间增加到30秒，故配置如下：\u003c/p\u003e\n\n```bash\n# 启用Intel音频芯片电源管理\nCONTROL_INTEL_HDA_POWER=\"auto\"\n\n# 总是启用\nBATT_INTEL_HDA_POWERSAVE=1\nLM_AC_INTEL_HDA_POWERSAVE=1\nNOLM_AC_INTEL_HDA_POWERSAVE=1\n\n# 适当地设置声卡进入节电模式的超时时间\nINTEL_HDA_DEVICE_TIMEOUT=30\n```\n\n\u003cp\u003e类似地，修改\u003cstrong\u003eintel-sata-powermgmt.conf\u003c/strong\u003e，启用sata硬盘接口的电源管理。由于我用Blueman控制蓝牙设备，一般不用时都将其关闭，同时经常使用wifi，故蓝牙和无线网卡均未作配置。\u003c/p\u003e\n\n\u003cp\u003e最后，关闭conky,Firefox和Chromium，\u003ca href=\"http://www.lesswatts.org/projects/powertop/\"\u003epowertop\u003c/a\u003e显示conky是个很吵闹的东西，关掉它可以使\u003cstrong\u003eWakeups-from-idle per second\u003c/strong\u003e的值下降很多，另外Chromium和Firefox也是耗电大户。\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e在此之前，系统空闲时CPU温度一般是50多度，普通使用时一般在60多度，如果开了kvm虚拟机会达到60至90度间。经过以上设置，系统空闲时CPU温度一度下降到39度，即使开了虚拟机，一般也可维持在50到80度间。\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e另外，对于以上内容，我还有些没搞明白的地方和要补充说明的东西：\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e虽然将laptop-mode加入rc.conf且已随系统启动，但使用命令“\u003cstrong\u003ecat /proc/sys/vm/laptop_mode\u003c/strong\u003e”查询得到的结果仍然是0，也就是说没有自动启用laptop-mode，必须使用命令“\u003cstrong\u003esudo /etc/rc.d/laptop-mode restart\u003c/strong\u003e”手动重启才行。目前没有找到解决办法。\u003c/li\u003e\n\u003cli\u003e虽然启用laptop-mode接管声卡电源管理，但没找到查看是否生效的方法，于是在/etc/rc.local中加入命令“\u003cstrong\u003eecho 1 \u0026gt; /sys/module/snd\u003cem\u003ehda\u003c/em\u003eintel/parameters/power_save\u003c/strong\u003e”以强制声卡节电。\u003c/li\u003e\n\u003cli\u003eIntel的powertop是个好东西，用它可以查看哪些进程最影响CPU节能。我们优化的标准之一就是使powertop中显示的“Wakeups-from-idle per second”尽可能地减少。powertop的另一个特点就是通过自动检查当前系统中电源使用的配置情况给出优化的建议，这是个很贴心的功能。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e鉴于目前存疑较多并将继续尝试，所以在标题中特别注明“不完全”三个字……\u003c/p\u003e\n\n\u003ch3\u003e参考\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003ehttp://itgen.blogspot.com/2009/03/energy-management-in-linux.html\u003c/li\u003e\n\u003cli\u003ehttp://www.ibm.com/developerworks/cn/linux/l-cpufreq-1/index.html\u003c/li\u003e\n\u003cli\u003ehttp://www.lesswatts.org/\u003c/li\u003e\n\u003c/ol\u003e","title":"Arch不完全降温笔记"},{"content":"QuickFix窗口只有打开和关闭的命令，而使用一个热键来切换打开状态可以减少热键资源的浪费，使用也更方便。\n从这里找到使用自定义函数完成此功能的方法：使用一个全局变量记录QuickFix窗口的打开状态，从而判断是应该关闭还是打开。但其提供的函数存在状态同步的问题，假如在QuickFix窗口中使用“:q”退出窗口，此方法将不能正常工作。评论中给出了很好的解决方法，但其提供的代码有些小问题，修改之后如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 nmap \u0026lt;leader\u0026gt;co :QFix\u0026lt;CR\u0026gt; nmap \u0026lt;leader\u0026gt;ct :call QFixToggle(1)\u0026lt;CR\u0026gt; command! -bang -nargs=? QFix call QFixToggle(\u0026lt;bang\u0026gt;0) function! QFixToggle(forced) if exists(\u0026#34;g:qfix_win\u0026#34;) \u0026amp;\u0026amp; a:forced != 0 cclose else if exists(\u0026#34;g:my_quickfix_win_height\u0026#34;) execute \u0026#34;copen \u0026#34;.g:my_quickfix_win_height else copen endif endif endfunction augroup QFixToggle autocmd! autocmd BufWinEnter quickfix let g:qfix_win = bufnr(\u0026#34;$\u0026#34;) autocmd BufWinLeave * if exists(\u0026#34;g:qfix_win\u0026#34;) \u0026amp;\u0026amp; expand(\u0026#34;\u0026lt;abuf\u0026gt;\u0026#34;) == g:qfix_win | unlet! g:qfix_win | endif augroup END ","permalink":"http://0x3f.org/posts/howto-toggle-quickfix-in-vim-using-hotkeys/","summary":"\u003cp\u003eQuickFix窗口只有打开和关闭的命令，而使用一个热键来切换打开状态可以减少热键资源的浪费，使用也更方便。\u003c/p\u003e\n\u003cp\u003e从\u003ca href=\"http://vim.wikia.com/wiki/Toggle_to_open_or_close_the_quickfix_window\"\u003e这里\u003c/a\u003e找到使用自定义函数完成此功能的方法：使用一个全局变量记录QuickFix窗口的打开状态，从而判断是应该关闭还是打开。但其提供的函数存在状态同步的问题，假如在QuickFix窗口中使用“:q”退出窗口，此方法将不能正常工作。评论中给出了很好的解决方法，但其提供的代码有些小问题，修改之后如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003enmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eco\u003c/span\u003e :\u003cspan class=\"nx\"\u003eQFix\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003enmap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eleader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ect\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eQFixToggle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ebang\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003enargs\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e? \u003cspan class=\"nx\"\u003eQFix\u003c/span\u003e \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eQFixToggle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebang\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eQFixToggle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eforced\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eexists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;g:qfix_win\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u0026amp;\u0026amp; \u003cspan class=\"nx\"\u003ea\u003c/span\u003e:\u003cspan class=\"nx\"\u003eforced\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ecclose\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eexists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;g:my_quickfix_win_height\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eexecute\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;copen \u0026#34;\u003c/span\u003e.\u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003emy_quickfix_win_height\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003ecopen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eaugroup\u003c/span\u003e \u003cspan class=\"nx\"\u003eQFixToggle\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eBufWinEnter\u003c/span\u003e \u003cspan class=\"nx\"\u003equickfix\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eqfix_win\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebufnr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;$\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eautocmd\u003c/span\u003e \u003cspan class=\"nx\"\u003eBufWinLeave\u003c/span\u003e * \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eexists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;g:qfix_win\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u0026amp;\u0026amp; \u003cspan class=\"nx\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;abuf\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eqfix_win\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003eunlet\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eg\u003c/span\u003e:\u003cspan class=\"nx\"\u003eqfix_win\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eaugroup\u003c/span\u003e \u003cspan class=\"nx\"\u003eEND\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"使用热键切换Vim的QuickFix窗口打开状态"},{"content":"\nIntroduction Batch Cat is intended to help users change categories of posts in bulk.\nThe main features are:\nAssign the selected categories to posts. Append the selected categories to posts. Delete the selected categories from posts. Intuitionistic operating manners which come up with people's common practice. Configurable number of posts listed in one page. Slimming but enough searching and sorting options. More in the future. Screenshot Installation \u0026 Usage As usual, upload the folder of Batch Cat to the wordpress plugin directory, activate it then.\nYou can perform operations in the page which lies in Tools-\u0026gt;Batch Cat in the admin panel.\nTo alter settings of this plugin, go to Settings-\u0026gt;Batch Cat Settings.\nDownload Batch Cat is now hosted in the wordpress plugin repository:\nhttp://wordpress.org/extend/plugins/batch-cat/\nWish List I18N More search options More information in the post list Change Log 2011-03-20 Sunday Solve the compatibility problem under Wordpress 3.1, thanks to wongkediri. 2010-12-12 Sunday Add the ability to append the selected categories to posts Add the ability to delete the selected categories from posts 2010-09-04 Saturday Initial release. ","permalink":"http://0x3f.org/posts/wp-batchcat/","summary":"\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/bqYPszwt0P7OI9snKxv3WA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TIIMnE-09dI/AAAAAAAABdk/q_hDtyXJozo/s800/wp-batch-cat.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eIntroduction\u003c/h3\u003e\n\u003cp\u003eBatch Cat is intended to help users change categories of posts in bulk.\u003c/p\u003e\n\u003cp\u003eThe main features are:\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003eAssign the selected categories to posts.\u003c/li\u003e\n\t\u003cli\u003eAppend the selected categories to posts.\u003c/li\u003e\n\t\u003cli\u003eDelete the selected categories from posts.\u003c/li\u003e\n    \u003cli\u003eIntuitionistic operating manners which come up with people's common practice.\u003c/li\u003e\n    \u003cli\u003eConfigurable number of posts listed in one page.\u003c/li\u003e\n    \u003cli\u003eSlimming but enough searching and sorting options.\u003c/li\u003e\n    \u003cli\u003eMore in the future.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eScreenshot\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/HbcUjNJ5wuK_XtIUxw1GWw?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TIIK1-R9vDI/AAAAAAAABdc/18irrESzXok/s400/wordpress_plugin-batch_cat.png\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"WordPress Plugin: Batch Cat"},{"content":"花了两天时间读完了《WordPress Plug-in Development》，通过实例讲解，很细致，适合用来入门，当然，深度和广度都有限。\n","permalink":"http://0x3f.org/posts/after-reading-wordpress-plug-in-development/","summary":"\u003cp\u003e花了两天时间读完了《WordPress Plug-in Development》，通过实例讲解，很细致，适合用来入门，当然，深度和广度都有限。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/k7nT3M9jrDW1dPv-nzKJvQ?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh4.ggpht.com/_ceUJ_lBTHzc/THnN7TJZDlI/AAAAAAAABdI/OBmuprXqpX4/s400/wordpress-plugin-development.jpg\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"读完《WordPress Plug-in Development》"},{"content":"两周前为了批量下载某视频网站中的电视剧，写了个BASH脚本。将电视剧列表页面的URL地址作为唯一参数传给脚本，然后就会把所有视频下载到当前目录下，并自动重命名，同时生成一个M3U格式的播放列表。\n由于在线视频不支持断点续传，所以对于单个视频来说无法实现。但对于整个批量下载任务来说，实现了宏观上的断点续传，已经下载的视频不会被重复下载。由于有些视频网站会在午夜更改视频地址，所以这一点很有用。\n主流视频网站应该是都支持的，我只测试了我下载电视剧的网站，不支持的都是非主流的！\n唯一可能需要注意的依赖是PHP，必须安装后才能使用。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 #!/bin/bash print_help_msg () { echo \u0026#34;You see, I\u0026#39;m nothing .\u0026#34; exit 0 } check_param () { if [ $# -ne 1 ]; then print_help_msg fi } check_m3u () { if ! [ -a p.m3u ] || [ `wc -l p.m3u|awk \u0026#39;{ print $1 }\u0026#39;` -eq 0 ]; then echo \u0026#39;#EXTM3U\u0026#39; \u0026gt; p.m3u fi } check_param $* check_m3u export LC_ALL=en_US.UTF-8 ue=$(php -r \u0026#34;echo urlencode(\u0026#39;$1\u0026#39;);\u0026#34;) parser=\u0026#34;http://www.flvcd.com/parse.php?flag=\u0026amp;format=\u0026amp;kw=$ue\u0026amp;sbt=%BF%AA%CA%BCGO%21\u0026#34; if ! wget $parser -U mozilla -O meta.html ; then echo \u0026#34;Unable to touch the parser, check network status for the cause .\u0026#34; exit 0 fi grep \u0026#34;\u0026lt;N\u0026gt;\u0026#34; meta.html \u0026gt; title.lst grep \u0026#34;\u0026lt;U\u0026gt;\u0026#34; meta.html \u0026gt; url.lst iconv -f gbk -t utf-8 title.lst -o title.lst sed -i \u0026#39;s/\u0026lt;N\u0026gt;//g\u0026#39; title.lst sed -i \u0026#39;s/ //g\u0026#39; title.lst sed -i \u0026#39;s/\u0026lt;U\u0026gt;//g\u0026#39; url.lst l1=`wc -l title.lst|awk \u0026#39;{ print $1 }\u0026#39;` l2=`wc -l url.lst|awk \u0026#39;{ print $1 }\u0026#39;` if [ \u0026#34;$l1\u0026#34; != \u0026#34;$l2\u0026#34; ]; then echo \u0026#34;Title.lst has $l1 lines, but url.lst got $l2.\u0026#34; exit 0 fi if [ $l1 -eq 0 ]; then echo \u0026#34;Nothing got from the parser, check meta.html for detail info.\u0026#34; exit 0 fi arrTitle=(`cat title.lst`) arrURL=(`cat url.lst`) idx=$((`wc -l p.m3u|awk \u0026#39;{ print $1 }\u0026#39;`-1)) while [ $idx -lt $l1 ]; do title=${arrTitle[$idx]} url=${arrURL[$idx]} idx=$((idx+1)) if ! wget $url -U mozilla -O \u0026#34;${title}.flv\u0026#34; ; then echo \u0026#34;Failed fetching ${title}.flv, maybe its URL has been changed !\u0026#34; exit 0 fi cmd=\u0026#34;sed -i \u0026#39;\\$a\\\\${title}.flv\u0026#39; p.m3u\u0026#34; eval $cmd done echo \u0026#39;done !\u0026#39; exit 0 另外，使用VLC执行播放列表效果灰常不错，视频之间衔接平滑流畅。\n","permalink":"http://0x3f.org/posts/a-bash-script-downloading-videos-in-batch/","summary":"\u003cp\u003e两周前为了批量下载某视频网站中的电视剧，写了个BASH脚本。将电视剧列表页面的URL地址作为唯一参数传给脚本，然后就会把所有视频下载到当前目录下，并自动重命名，同时生成一个M3U格式的播放列表。\u003c/p\u003e\n\u003cp\u003e由于在线视频不支持断点续传，所以对于单个视频来说无法实现。但对于整个批量下载任务来说，实现了宏观上的断点续传，已经下载的视频不会被重复下载。由于有些视频网站会在午夜更改视频地址，所以这一点很有用。\u003c/p\u003e\n\u003cp\u003e主流视频网站应该是都支持的，我只测试了我下载电视剧的网站，\u003cstrong\u003e不支持的都是非主流的！\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e唯一可能需要注意的依赖是PHP，必须安装后才能使用。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e67\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eprint_help_msg \u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;You see, I\u0026#39;m nothing .\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echeck_param \u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$#\u003c/span\u003e -ne \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        print_help_msg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echeck_m3u \u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e ! \u003cspan class=\"o\"\u003e[\u003c/span\u003e -a p.m3u \u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"sb\"\u003e`\u003c/span\u003ewc -l p.m3u\u003cspan class=\"p\"\u003e|\u003c/span\u003eawk \u003cspan class=\"s1\"\u003e\u0026#39;{ print $1 }\u0026#39;\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e -eq \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;#EXTM3U\u0026#39;\u003c/span\u003e \u0026gt; p.m3u\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echeck_param \u003cspan class=\"nv\"\u003e$*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echeck_m3u\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eLC_ALL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003een_US.UTF-8\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ephp -r \u003cspan class=\"s2\"\u003e\u0026#34;echo urlencode(\u0026#39;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#39;);\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eparser\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;http://www.flvcd.com/parse.php?flag=\u0026amp;format=\u0026amp;kw=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ue\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;sbt=%BF%AA%CA%BCGO%21\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e ! wget \u003cspan class=\"nv\"\u003e$parser\u003c/span\u003e -U mozilla -O meta.html \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Unable to touch the parser, check network status for the cause .\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egrep \u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;N\u0026gt;\u0026#34;\u003c/span\u003e meta.html \u0026gt; title.lst\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egrep \u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;U\u0026gt;\u0026#34;\u003c/span\u003e meta.html \u0026gt; url.lst\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiconv -f gbk -t utf-8 title.lst -o title.lst\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;s/\u0026lt;N\u0026gt;//g\u0026#39;\u003c/span\u003e title.lst\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;s/ //g\u0026#39;\u003c/span\u003e title.lst\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;s/\u0026lt;U\u0026gt;//g\u0026#39;\u003c/span\u003e url.lst\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003el1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003ewc -l title.lst\u003cspan class=\"p\"\u003e|\u003c/span\u003eawk \u003cspan class=\"s1\"\u003e\u0026#39;{ print $1 }\u0026#39;\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003el2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003ewc -l url.lst\u003cspan class=\"p\"\u003e|\u003c/span\u003eawk \u003cspan class=\"s1\"\u003e\u0026#39;{ print $1 }\u0026#39;\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$l1\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$l2\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Title.lst has \u003c/span\u003e\u003cspan class=\"nv\"\u003e$l1\u003c/span\u003e\u003cspan class=\"s2\"\u003e lines, but url.lst got \u003c/span\u003e\u003cspan class=\"nv\"\u003e$l2\u003c/span\u003e\u003cspan class=\"s2\"\u003e.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$l1\u003c/span\u003e -eq \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Nothing got from the parser, check meta.html for detail info.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003earrTitle\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003ecat title.lst\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003earrURL\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003ecat url.lst\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eidx\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$((\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003ewc -l p.m3u\u003cspan class=\"p\"\u003e|\u003c/span\u003eawk \u003cspan class=\"s1\"\u003e\u0026#39;{ print $1 }\u0026#39;\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"k\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$idx\u003c/span\u003e -lt \u003cspan class=\"nv\"\u003e$l1\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003earrTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$idx\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003earrURL\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$idx\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eidx\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$((\u003c/span\u003eidx+1\u003cspan class=\"k\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e ! wget \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e -U mozilla -O \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003etitle\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e.flv\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Failed fetching \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003etitle\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e.flv, maybe its URL has been changed !\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003ecmd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;sed -i \u0026#39;\\$a\\\\\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003etitle\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e.flv\u0026#39; p.m3u\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eeval\u003c/span\u003e \u003cspan class=\"nv\"\u003e$cmd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;done !\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e另外，使用VLC执行播放列表效果灰常不错，视频之间衔接平滑流畅。\u003c/p\u003e","title":"批量下载视频的BASH脚本"},{"content":"根据帮助文档，gvim在windows下的最大化是通过模拟打开窗口菜单并点击最大化菜单项实现的，而在Linux下的方法较为灵活。\n下面的方法是在vim中通过调用wmctrl实现最大化的方法：\n1 2 3 4 5 6 7 8 9 if has(\u0026#39;win32\u0026#39;) au GUIEnter * simalt ~x else au GUIEnter * call MaximizeWindow() endif function! MaximizeWindow() silent !wmctrl -r :ACTIVE: -b add,maximized_vert,maximized_horz endfunction 当然也可以通过配置窗口管理器规则实现自动最大化，但上面的方法更灵活。\n","permalink":"http://0x3f.org/posts/howto-auto-maximize-gvim-at-startup/","summary":"\u003cp\u003e根据帮助文档，gvim在windows下的最大化是通过模拟打开窗口菜单并点击最大化菜单项实现的，而在Linux下的方法较为灵活。\u003c/p\u003e\n\u003cp\u003e下面的方法是在vim中通过调用wmctrl实现最大化的方法：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e9\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003ehas\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;win32\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eGUIEnter\u003c/span\u003e * \u003cspan class=\"nx\"\u003esimalt\u003c/span\u003e \u003cspan class=\"p\"\u003e~\u003c/span\u003e\u003cspan class=\"nx\"\u003ex\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"nx\"\u003eGUIEnter\u003c/span\u003e * \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eMaximizeWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eMaximizeWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003esilent\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003ewmctrl\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e :\u003cspan class=\"nx\"\u003eACTIVE\u003c/span\u003e: \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003emaximized_vert\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nx\"\u003emaximized_horz\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e当然也可以通过配置窗口管理器规则实现自动最大化，但上面的方法更灵活。\u003c/p\u003e","title":"启动GVim时自动最大化窗口的方法"},{"content":"简述 InstallShield已经内建了对MySQL和Oracle的支持。但是这个功能是通过ODBC实现的，它对SQL脚本的格式要求非常严格，因此已经通过官方客户端测试的脚本在IS中执行时往往就会报错。\n一般来说，数据库脚本只保证通过官方客户端测试即可，同时维护一份供IS执行的脚本费时费力。因此，考虑安装程序对两数据库的支持通过官方客户端实现。\nMySQL\nfunction InstallMySQLComponent(szComponent) NUMBER nResult; STRING szServer,szDB,szUser,szPassword,sCMD,sOPT,sResult1,sResult2,svLine,sMsg,sPath; NUMBER nvFileHandle,nvCount; LIST listStatus; begin sMsg = \u0026#39;安装\u0026#39;+szComponent+\u0026#39; ...\u0026#39;; SdShowMsg(sMsg, TRUE); // source命令不认识windows路径中的反斜杠，故将SRCDIR中的反斜杠替换成斜杠 sPath = SRCDIR; StrReplace(sPath, \u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;, 0); // Fetch database connection information SQLRTGetConnectionInfo( \u0026#39;mysql\u0026#39;, szServer, szDB, szUser, szPassword ); sCMD = WINSYSDIR^\u0026#39;cmd.exe\u0026#39;; sOPT = \u0026#39; /c \u0026#39;+SRCDIR^\u0026#39;mysql.exe -h\u0026#39;+szServer+\u0026#39; -u\u0026#39;+szUser+\u0026#39; -p\u0026#39;+szPassword+\u0026#39; -D\u0026#39;+szDB; sOPT = sOPT+\u0026#39; -e \u0026#34;source \u0026#39;+sPath^szComponent+\u0026#39;.sql\u0026#34; \u0026gt; \u0026#39;+SRCDIR^\u0026#39;dbstatus.txt 2\u0026gt;\u0026amp;1\u0026#39;; // Execute the script associated with the given component in database nResult=LaunchAppAndWait(sCMD, sOPT, WAIT|LAAW_OPTION_HIDDEN); if (nResult \u0026lt; 0) then MessageBox(\u0026#39;Failed installing \u0026#39;+szComponent+\u0026#39; !\u0026#39;, SEVERE); abort; endif; // 关闭安装提示 SdShowMsg(\u0026#39;\u0026#39;, FALSE); // Read dbstatus.txt OpenFileMode(FILE_MODE_NORMAL); if (OpenFile(nvFileHandle, SRCDIR, \u0026#39;dbstatus.txt\u0026#39;)\u0026lt;0) then MessageBox(\u0026#39;Failed checking the status of installing \u0026#39;+szComponent+\u0026#39; !\u0026#39;, SEVERE); abort; endif; listStatus = ListCreate(STRINGLIST); while GetLine(nvFileHandle, svLine) = 0 ListAddString(listStatus, svLine, AFTER); endwhile; CloseFile(nvFileHandle); // Count how many lines fetched from dbstatus.txt nvCount = ListCount(listStatus); if nvCount \u0026gt; 0 then sMsg = \u0026#34;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\\n\u0026#34;; sMsg = sMsg+\u0026#34;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\\n\u0026#34;; sMsg = sMsg+\u0026#34;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）\u0026#34;; nResult = AskYesNo(sMsg, YES); if (nResult = YES) then LaunchApp(WINSYSDIR^\u0026#39;notepad.exe\u0026#39;, SRCDIR^\u0026#39;dbstatus.txt\u0026#39;); endif; abort; endif; end; Oracle\nfunction InstallOracleComponent(szComponent) NUMBER nResult,nvFileHandle,nIndex,nvCount; STRING sMsg,szServer,szDB,szUser,szPassword,sCMD,sOPT,sInstance,sTmp,svLine; LIST listStatus; begin sMsg = \u0026#39;安装\u0026#39;+szComponent+\u0026#39; ...\u0026#39;; SdShowMsg(sMsg, TRUE); // Fetch database connection information SQLRTGetConnectionInfo( \u0026#39;oracle\u0026#39;, szServer, szDB, szUser, szPassword ); nIndex = StrFind(szServer, \u0026#39;:\u0026#39;); nIndex = StrFindEx(szServer, \u0026#39;/\u0026#39;, nIndex); StrSub(sInstance, szServer, nIndex+1, 100); sCMD = WINSYSDIR^\u0026#39;cmd.exe\u0026#39;; sOPT = \u0026#39; /c \u0026#39;+\u0026#39;sqlplus.exe -L -S \u0026#39;+szUser+\u0026#39;/\u0026#39;+szPassword+\u0026#39;@\u0026#39;+sInstance; sOPT = sOPT+\u0026#39; @\u0026#39;+SRCDIR^szComponent+\u0026#39;.sql \u0026gt; \u0026#39;+SRCDIR^\u0026#39;dbstatus.txt 2\u0026gt;\u0026amp;1\u0026#39;; // Execute the script associated with the given component in database nResult=LaunchAppAndWait(sCMD, sOPT, WAIT|LAAW_OPTION_HIDDEN); if (nResult \u0026lt; 0) then MessageBox(\u0026#39;Failed installing \u0026#39;+szComponent+\u0026#39; !\u0026#39;, SEVERE); abort; endif; // 关闭安装提示 SdShowMsg(\u0026#39;\u0026#39;, FALSE); // 在dbstatus.txt中查询字符串holytail，如果存在，说明脚本已执行完 if (FileGrep(SRCDIR^\u0026#39;dbstatus.txt\u0026#39;, \u0026#39;holytail\u0026#39;, svLine, nIndex, RESTART) = 0) then // 在dbstatus.txt中查询字符串ORA-，如果存在，说明脚本执行出现错误 if (FileGrep(SRCDIR^\u0026#39;dbstatus.txt\u0026#39;, \u0026#39;ORA-\u0026#39;, svLine, nIndex, RESTART) = 0) then sMsg = \u0026#34;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\\n\u0026#34;; sMsg = sMsg+\u0026#34;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\\n\u0026#34;; sMsg = sMsg+\u0026#34;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）\u0026#34;; nResult = AskYesNo(sMsg, YES); if (nResult = YES) then LaunchApp(WINSYSDIR^\u0026#39;notepad.exe\u0026#39;, SRCDIR^\u0026#39;dbstatus.txt\u0026#39;); endif; abort; endif; else sMsg = \u0026#34;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\\n\u0026#34;; sMsg = sMsg+\u0026#34;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\\n\u0026#34;; sMsg = sMsg+\u0026#34;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）\u0026#34;; nResult = AskYesNo(sMsg, YES); if (nResult = YES) then LaunchApp(WINSYSDIR^\u0026#39;notepad.exe\u0026#39;, SRCDIR^\u0026#39;dbstatus.txt\u0026#39;); endif; abort; endif; end; 总结 为便于获取脚本在数据库中的执行结果，故通过官方客户端执行脚本时通过符号“\u003e”将客户端的输出信息重定向到dbstatus.txt中；同时，使用“2\u003e\u00261”将标准错误输出重定向到标准输出设备上，当然，会进一步重定向到dbstatus.txt文件中，否则，无法获取出错信息。 sqlplus执行SQL脚本后不会自动退出，故应在Oracle的脚本后加上语句“exit;”。 重载OnSQLComponentInstalled()函数，并在其中禁止MySQL和Oracle的SQL脚本对应的Component被执行安装，然后通过以上两个函数更新数据库。 ","permalink":"http://0x3f.org/posts/howto-run-sql-scripts-in-mysql-oracle-within-installshield/","summary":"\u003ch2\u003e简述\u003c/h2\u003e\n\u003cp\u003eInstallShield已经内建了对MySQL和Oracle的支持。但是这个功能是通过ODBC实现的，它对SQL脚本的格式要求非常严格，因此已经通过官方客户端测试的脚本在IS中执行时往往就会报错。\u003c/p\u003e\n\u003cp\u003e一般来说，数据库脚本只保证通过官方客户端测试即可，同时维护一份供IS执行的脚本费时费力。因此，考虑安装程序对两数据库的支持通过官方客户端实现。\u003c/p\u003e\n\u003ch2\u003eMySQL\u003c/h2\u003e\u003cbr\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003efunction InstallMySQLComponent(szComponent)\n    NUMBER nResult;\n    STRING szServer,szDB,szUser,szPassword,sCMD,sOPT,sResult1,sResult2,svLine,sMsg,sPath;\n    NUMBER nvFileHandle,nvCount;\n    LIST listStatus;\nbegin\n    sMsg = \u0026#39;安装\u0026#39;+szComponent+\u0026#39; ...\u0026#39;;\n    SdShowMsg(sMsg, TRUE);\n    // source命令不认识windows路径中的反斜杠，故将SRCDIR中的反斜杠替换成斜杠\n    sPath = SRCDIR;\n    StrReplace(sPath, \u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;, 0);\n    // Fetch database connection information\n    SQLRTGetConnectionInfo( \u0026#39;mysql\u0026#39;, szServer, szDB, szUser, szPassword );\n    sCMD = WINSYSDIR^\u0026#39;cmd.exe\u0026#39;;\n    sOPT = \u0026#39; /c \u0026#39;+SRCDIR^\u0026#39;mysql.exe -h\u0026#39;+szServer+\u0026#39; -u\u0026#39;+szUser+\u0026#39; -p\u0026#39;+szPassword+\u0026#39; -D\u0026#39;+szDB;\n    sOPT = sOPT+\u0026#39; -e \u0026#34;source \u0026#39;+sPath^szComponent+\u0026#39;.sql\u0026#34; \u0026gt; \u0026#39;+SRCDIR^\u0026#39;dbstatus.txt 2\u0026gt;\u0026amp;1\u0026#39;;\n    // Execute the script associated with the given component in database\n    nResult=LaunchAppAndWait(sCMD, sOPT, WAIT|LAAW_OPTION_HIDDEN);\n    if (nResult \u0026lt; 0) then\n        MessageBox(\u0026#39;Failed installing \u0026#39;+szComponent+\u0026#39; !\u0026#39;, SEVERE);\n        abort;\n    endif;\n    // 关闭安装提示\n    SdShowMsg(\u0026#39;\u0026#39;, FALSE);\n    // Read dbstatus.txt\n    OpenFileMode(FILE_MODE_NORMAL);\n    if (OpenFile(nvFileHandle, SRCDIR, \u0026#39;dbstatus.txt\u0026#39;)\u0026lt;0) then\n        MessageBox(\u0026#39;Failed checking the status of installing \u0026#39;+szComponent+\u0026#39; !\u0026#39;, SEVERE);\n        abort;\n    endif;\n    listStatus = ListCreate(STRINGLIST);\n    while GetLine(nvFileHandle, svLine) = 0\n        ListAddString(listStatus, svLine, AFTER);\n    endwhile;\n    CloseFile(nvFileHandle);\n    // Count how many lines fetched from dbstatus.txt\n    nvCount = ListCount(listStatus);\n    if nvCount \u0026gt; 0 then\n        sMsg = \u0026#34;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\\n\u0026#34;;\n        sMsg = sMsg+\u0026#34;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\\n\u0026#34;;\n        sMsg = sMsg+\u0026#34;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）\u0026#34;;\n        nResult = AskYesNo(sMsg, YES);\n        if (nResult = YES) then\n            LaunchApp(WINSYSDIR^\u0026#39;notepad.exe\u0026#39;, SRCDIR^\u0026#39;dbstatus.txt\u0026#39;);\n\tendif;                   \n        abort;\n    endif;\nend;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eOracle\u003c/h2\u003e\u003cbr\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003efunction InstallOracleComponent(szComponent)  \n    NUMBER nResult,nvFileHandle,nIndex,nvCount;\n    STRING sMsg,szServer,szDB,szUser,szPassword,sCMD,sOPT,sInstance,sTmp,svLine;\n    LIST listStatus;\nbegin\n    sMsg = \u0026#39;安装\u0026#39;+szComponent+\u0026#39; ...\u0026#39;;\n    SdShowMsg(sMsg, TRUE);\n    // Fetch database connection information\n    SQLRTGetConnectionInfo( \u0026#39;oracle\u0026#39;, szServer, szDB, szUser, szPassword );\n    nIndex = StrFind(szServer, \u0026#39;:\u0026#39;);\n    nIndex = StrFindEx(szServer, \u0026#39;/\u0026#39;, nIndex);\n    StrSub(sInstance, szServer, nIndex+1, 100);\n    sCMD = WINSYSDIR^\u0026#39;cmd.exe\u0026#39;;\n    sOPT = \u0026#39; /c \u0026#39;+\u0026#39;sqlplus.exe -L -S \u0026#39;+szUser+\u0026#39;/\u0026#39;+szPassword+\u0026#39;@\u0026#39;+sInstance;\n    sOPT = sOPT+\u0026#39; @\u0026#39;+SRCDIR^szComponent+\u0026#39;.sql \u0026gt; \u0026#39;+SRCDIR^\u0026#39;dbstatus.txt 2\u0026gt;\u0026amp;1\u0026#39;;\n    // Execute the script associated with the given component in database\n    nResult=LaunchAppAndWait(sCMD, sOPT, WAIT|LAAW_OPTION_HIDDEN);\n    if (nResult \u0026lt; 0) then\n        MessageBox(\u0026#39;Failed installing \u0026#39;+szComponent+\u0026#39; !\u0026#39;, SEVERE);\n        abort;\n    endif;               \n    // 关闭安装提示\n    SdShowMsg(\u0026#39;\u0026#39;, FALSE);\n    // 在dbstatus.txt中查询字符串holytail，如果存在，说明脚本已执行完\n    if (FileGrep(SRCDIR^\u0026#39;dbstatus.txt\u0026#39;, \u0026#39;holytail\u0026#39;, svLine, nIndex, RESTART) = 0) then\n        // 在dbstatus.txt中查询字符串ORA-，如果存在，说明脚本执行出现错误\n        if (FileGrep(SRCDIR^\u0026#39;dbstatus.txt\u0026#39;, \u0026#39;ORA-\u0026#39;, svLine, nIndex, RESTART) = 0) then\n            sMsg = \u0026#34;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\\n\u0026#34;;\n            sMsg = sMsg+\u0026#34;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\\n\u0026#34;;\n            sMsg = sMsg+\u0026#34;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）\u0026#34;;\n            nResult = AskYesNo(sMsg, YES);\n            if (nResult = YES) then\n                LaunchApp(WINSYSDIR^\u0026#39;notepad.exe\u0026#39;, SRCDIR^\u0026#39;dbstatus.txt\u0026#39;);\n            endif;                   \n            abort;\n        endif;\n    else\n        sMsg = \u0026#34;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\\n\u0026#34;;\n        sMsg = sMsg+\u0026#34;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\\n\u0026#34;;\n        sMsg = sMsg+\u0026#34;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）\u0026#34;;\n        nResult = AskYesNo(sMsg, YES);\n        if (nResult = YES) then\n            LaunchApp(WINSYSDIR^\u0026#39;notepad.exe\u0026#39;, SRCDIR^\u0026#39;dbstatus.txt\u0026#39;);\n        endif;                   \n        abort;\n    endif;\nend;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003e总结\u003c/h2\u003e\n\u003col\u003e\n\t\u003cli\u003e为便于获取脚本在数据库中的执行结果，故通过官方客户端执行脚本时通过符号“\u003cstrong\u003e\u003e\u003c/strong\u003e”将客户端的输出信息重定向到\u003cstrong\u003edbstatus.txt\u003c/strong\u003e中；同时，使用“\u003cstrong\u003e2\u003e\u00261\u003c/strong\u003e”将标准错误输出重定向到标准输出设备上，当然，会进一步重定向到dbstatus.txt文件中，否则，无法获取出错信息。\u003c/li\u003e\n\t\u003cli\u003esqlplus执行SQL脚本后不会自动退出，故应在Oracle的脚本后加上语句“\u003cstrong\u003eexit;\u003c/strong\u003e”。\u003c/li\u003e\n\t\u003cli\u003e重载\u003cstrong\u003eOnSQLComponentInstalled()\u003c/strong\u003e函数，并在其中禁止MySQL和Oracle的SQL脚本对应的Component被执行安装，然后通过以上两个函数更新数据库。\u003c/li\u003e\n\u003c/ol\u003e","title":"InstallShield在MySQL和Oracle中执行SQL脚本的方法"},{"content":"我的型号是X200，问题表现为在GNOME或XFCE下静音按钮无效，使用xev也捕获不到输入信号，而音量增加和减小按钮可以正常使用且有OSD。\n解决办法是在grub的启动菜单中，给内核加上参数acpi_osi=“Linux”，如：\n1 2 3 4 5 # (0) Arch Linux title Arch Linux root (hd0,2) kernel /boot/vmlinuz26 root=/dev/sda3 resume=/dev/sda4 ro acpi_osi=\u0026#34;Linux\u0026#34; initrd /boot/kernel26.img 从查到的资料看，acpi_osi参数是用来指定操作系统接口的，据说有些硬件都只针对Windows做了测试或优化，对于这些硬件，如果将内核的操作系统接口指定为Linux，则有可能会出问题。所以内核从2.6.23版本开始，此参数的默认值被改成了“!Linux”，以保证更广泛的兼容性和稳定性。\n而根据这里的说法，thinkpad一直以来在对Linux的兼容程度上有很好的口碑，故可以放心添加这个参数。\n另外，xfce下使用OSD需要安装xfce4-volumed。\n","permalink":"http://0x3f.org/posts/howto-make-thinkpad-mute-button-detected-on-linux/","summary":"\u003cp\u003e我的型号是X200，问题表现为在GNOME或XFCE下静音按钮无效，使用xev也捕获不到输入信号，而音量增加和减小按钮可以正常使用且有OSD。\u003c/p\u003e\n\u003cp\u003e解决办法是在grub的启动菜单中，给内核加上参数\u003cstrong\u003eacpi_osi=“Linux”\u003c/strong\u003e，如：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# (0) Arch Linux\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etitle  Arch Linux\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroot   \u003cspan class=\"o\"\u003e(\u003c/span\u003ehd0,2\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekernel /boot/vmlinuz26 \u003cspan class=\"nv\"\u003eroot\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/sda3 \u003cspan class=\"nv\"\u003eresume\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/sda4 ro \u003cspan class=\"nv\"\u003eacpi_osi\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Linux\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einitrd /boot/kernel26.img\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e从查到的资料看，\u003cstrong\u003eacpi_osi\u003c/strong\u003e参数是用来指定操作系统接口的，据说有些硬件都只针对Windows做了测试或优化，对于这些硬件，如果将内核的操作系统接口指定为Linux，则有可能会出问题。所以内核从2.6.23版本开始，此参数的默认值被改成了“\u003cstrong\u003e!Linux\u003c/strong\u003e”，以保证更广泛的兼容性和稳定性。\u003c/p\u003e\n\u003cp\u003e而根据\u003ca href=\"http://www.thinkwiki.org/wiki/Mute_button\"\u003e这里\u003c/a\u003e的说法，thinkpad一直以来在对Linux的兼容程度上有很好的口碑，故可以放心添加这个参数。\u003c/p\u003e\n\u003cp\u003e另外，xfce下使用OSD需要安装xfce4-volumed。\u003c/p\u003e","title":"使Thinkpad的静音按钮能被识别的方法"},{"content":"早在keke童鞋的博客上见过，直到今天下载了个flash视频教程要看时才想起来，毕竟已经不是几年前Flash很火的时候了，为了降低CPU占用，我连Chromium的Flash插件都禁用了。\n使用后的感觉就是简单实用，有暂停，有快进，能调进度，功能一样不多，一样不少。\n要装两个包，swfdec是解码包，swfdec-gnome是播放器。\nhttp://swfdec.freedesktop.org\n","permalink":"http://0x3f.org/posts/swfdec-as-a-slim-flash-player/","summary":"\u003cp\u003e早在keke童鞋的\u003ca href=\"http://www.imkeke.net/linux/flash-player-swfdec.html\"\u003e博客\u003c/a\u003e上见过，直到今天下载了个flash视频教程要看时才想起来，毕竟已经不是几年前Flash很火的时候了，为了降低CPU占用，我连Chromium的Flash插件都禁用了。\u003c/p\u003e\n\u003cp\u003e使用后的感觉就是简单实用，有暂停，有快进，能调进度，功能一样不多，一样不少。\u003c/p\u003e\n\u003cp\u003e要装两个包，swfdec是解码包，swfdec-gnome是播放器。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://swfdec.freedesktop.org\"\u003e\u003ca href=\"http://swfdec.freedesktop.org\"\u003ehttp://swfdec.freedesktop.org\u003c/a\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/pBEyuoK_FQwurdii1Oekdg?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/TFWQ5SwzQnI/AAAAAAAABcc/IFg7kX6pXD4/s400/2010-08-01.23%3A17%3A32.%E6%88%AA%E5%8F%96%E9%80%89%E5%8C%BA.01.png\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"swfdec：简单好用的Flash播放器"},{"content":"虽然由于我的H108B没有TTL引脚而无法通过TTL线登入猫的BusyBox系统，但TTL线在Linux下的使用方法仍然值得一叙，因为除此之外，它还有较为广泛的用途，例如为路由器刷OpenWRT系统等等。\nTTL转USB端子是目前较为常见的此类设备，这得益于它的简单易用和便携性。在这类设备上最常见的就是台湾的Prolific Technology生产的PL2303：\n这种芯片的驱动已被编译进Linux内核，如果使用的是较新版本的内核，则使用该芯片的TTL转USB端子会被自动识别，通常为/dev/ttyUSB0设备，使用lsusb命令可以查看：\n[lenin@archer ~]$ lsusb Bus 008 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 007 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 006 Device 003: ID 067b:2303 Prolific Technology, Inc. PL2303 Serial Port Bus 006 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub 将四根杜邦线连接到TTL转USB插头上，并接入相应设备的对应引脚。同一根线两端连接的引脚必须对应，另外，VCC引脚不能接线，否则会烧坏TTL转 USB芯片。\n在计算机上使用串口通讯程序进行操控，常见的串口通讯程序有：minicom，microcom，picocom，tinyserial，xgcom。\n以minicom为例，进入minicom的设置界面：\nsudo minicom -s 先设置默认的通讯设备为ttyUSB0并设置硬件流控制（Hardware Flow Control）为No：\n保存为缺省设置：\n启动minicom：\nsudo minicom 理论上说，此时即可和设备进行通讯了。\nWindows下要安装相应芯片的驱动，通讯程序一般用SecureCRT。\n","permalink":"http://0x3f.org/posts/usage-of-ttl-wire-on-linux/","summary":"\u003cp\u003e虽然由于\u003ca href=\"http://0x3f.org/?p=1544\"\u003e我的H108B\u003c/a\u003e没有TTL引脚而无法通过TTL线登入猫的\u003ca href=\"http://en.wikipedia.org/wiki/BusyBox\"\u003eBusyBox\u003c/a\u003e系统，但TTL线在Linux下的使用方法仍然值得一叙，因为除此之外，它还有较为广泛的用途，例如为路由器刷\u003ca href=\"http://en.wikipedia.org/wiki/OpenWrt\"\u003eOpenWRT\u003c/a\u003e系统等等。\u003c/p\u003e\n\u003cp\u003eTTL转USB端子是目前较为常见的此类设备，这得益于它的简单易用和便携性。在这类设备上最常见的就是台湾的Prolific Technology生产的\u003cstrong\u003ePL2303\u003c/strong\u003e：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/fAc0kt6VmnFFTUY7IA-VrA?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/TEHb1u6n7TI/AAAAAAAABbU/FA7aEZPTn-A/s400/C360_2010-07-17%2011-07-17.jpg\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e这种芯片的驱动已被编译进Linux内核，如果使用的是较新版本的内核，则使用该芯片的TTL转USB端子会被自动识别，通常为\u003cstrong\u003e/dev/ttyUSB0\u003c/strong\u003e设备，使用\u003cstrong\u003elsusb\u003c/strong\u003e命令可以查看：\u003c/p\u003e\n\u003cblockquote\u003e\n[lenin@archer ~]$ lsusb\nBus 008 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\nBus 007 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\nBus 006 Device 003: ID 067b:2303 Prolific Technology, Inc. PL2303 Serial Port\nBus 006 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub\n\u003c/blockquote\u003e\n\u003cp\u003e将四根杜邦线连接到TTL转USB插头上，并接入相应设备的对应引脚。同一根线两端连接的引脚必须对应，另外，VCC引脚不能接线，否则会烧坏TTL转 USB芯片。\u003c/p\u003e\n\u003cp\u003e在计算机上使用串口通讯程序进行操控，常见的串口通讯程序有：\u003ca href=\"http://en.wikipedia.org/wiki/Minicom\"\u003eminicom\u003c/a\u003e，\u003ca href=\"http://en.wikipedia.org/wiki/Microcom\"\u003emicrocom\u003c/a\u003e，picocom，tinyserial，xgcom。\u003c/p\u003e\n\u003cp\u003e以minicom为例，进入minicom的设置界面：\u003c/p\u003e\n\u003cblockquote\u003esudo minicom -s\u003c/blockquote\u003e\n\u003cp\u003e先设置默认的通讯设备为ttyUSB0并设置硬件流控制（Hardware Flow Control）为No：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/YnqotA0Fo6Z883T7aKvDcg?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/TEMR710O6XI/AAAAAAAABb4/noM3E7ZEiuM/s800/2010-07-17.10%3A25%3A38.%E6%88%AA%E5%8F%96%E9%80%89%E5%8C%BA.01.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/G2S6THC9IqvBChZGkJfyqQ?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/TEMR7zBjcmI/AAAAAAAABb8/Z63_oSfjrnc/s400/2010-07-17.10%3A29%3A04.urxvt.01.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e保存为缺省设置：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/lY9b49woVJhLdkPJqViT3Q?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh4.ggpht.com/_ceUJ_lBTHzc/TEMR8Fjk3cI/AAAAAAAABcA/QnHscEzj1OY/s800/2010-07-17.10%3A29%3A35.%E6%88%AA%E5%8F%96%E9%80%89%E5%8C%BA.01.png\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"TTL线在Linux下的用法"},{"content":"之前提到过对华为HG522、HG527的超级用户的破解方法。网通附送的另一种猫，是中兴ZXV10 H108B无线猫，体积更小，而且天线是内置的。\n上次的方法不能用在这个型号的猫上，但可以用ftp的方式破解。以下步骤基于Linux，并只在硬件版本为V1.1.02、软件版本为V1.1.02T18_N的H108B上测试通过：\n使用普通用户进入猫的设置页面并开启FTP服务，将用户名和密码均设为admin\n连接ftp服务器：\nftp 192.168.1.1 输入用户名和密码，成功登录FTP服务器：\n[lenin@archer ~]$ ftp 192.168.1.1 Connected to 192.168.1.1. 220 Welcome to virtual FTP service. Name (192.168.1.1:lenin): admin 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u003e 切换到/etc目录并下载配置文件board.conf： cd ../ cd etc get board.conf 如下所示：\nftp\u003e cd ../ 250 Directory successfully changed. ftp\u003e cd etc 250 Directory successfully changed. ftp\u003e get board.conf 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for board.conf (39516 bytes). 226 File send OK. 39516 bytes received in 0.0496 seconds (796003 bytes/s) ftp\u003e 在下载到本地的board.conf中查找right，后跟0表示超级用户，若为1则表示普通用户，如下所示： 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;row id=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;item\u0026gt;\u0026#34;right\u0026#34;, \u0026#34;0\u0026#34;\u0026lt;/item\u0026gt; \u0026lt;item\u0026gt;\u0026#34;username\u0026#34;, \u0026#34;bjcnchgw\u0026#34;\u0026lt;/item\u0026gt; \u0026lt;item\u0026gt;\u0026#34;enable\u0026#34;, \u0026#34;1\u0026#34;\u0026lt;/item\u0026gt; \u0026lt;item\u0026gt;\u0026#34;password\u0026#34;, \u0026#34;bjcnchgw72915767\u0026#34;\u0026lt;/item\u0026gt; \u0026lt;/row\u0026gt; \u0026lt;row id=\u0026#34;1\u0026#34;\u0026gt; \u0026lt;item\u0026gt;\u0026#34;right\u0026#34;, \u0026#34;1\u0026#34;\u0026lt;/item\u0026gt; \u0026lt;item\u0026gt;\u0026#34;username\u0026#34;, \u0026#34;user\u0026#34;\u0026lt;/item\u0026gt; \u0026lt;item\u0026gt;\u0026#34;password\u0026#34;, \u0026#34;mypasswd\u0026#34;\u0026lt;/item\u0026gt; \u0026lt;/row\u0026gt; 在如下页面使用超级用户登录： http://192.168.1.1/cnc.html 进入“网络”→“宽带设置”页面，删除所有“连接名称”列出的连接（其中，TR069是网通远程控制猫并修改超级用户密码的连接；INTERNET被设置成了桥接，所以不能实现路由功能；另外两个应该是用来屏蔽第三、四个LAN口的。所以要全部删除。），并创建新的连接： 进入“网络”→“远程管理”页面，取消“周期上报功能”。\n由于“用户管理”页面不提供超级用户改密码的功能，所以此时应下载最新的board.conf，修改里面的超级用户的密码，再上传到/etc目录，假设已登入FTP并切换到/etc目录下：\nftp\u003e put board.conf 200 PORT command successful. Consider using PASV. 150 Ok to send data. 226 File receive OK. 39516 bytes sent in 0.0195 seconds (2026565 bytes/s) ftp\u003e 最后重启猫即可。 据说有使用TTL转USB线登入H108B的嵌入式Linux操作系统来破解超级用户的，但是我的猫的集成电路板上居然没有焊TTL引脚，显然H108B不只一个硬件版本，TTL线白买了。\n以上照片出自G7+Camera360\n","permalink":"http://0x3f.org/posts/howto-enable-routing-and-auto-dialing-for-unicom-adsl-modem-2/","summary":"\u003cp\u003e之前提到过对华为HG522、HG527的超级用户的\u003ca href=\"http://0x3f.org/?p=1528\"\u003e破解方法\u003c/a\u003e。网通附送的另一种猫，是\u003cstrong\u003e中兴ZXV10 H108B\u003c/strong\u003e无线猫，体积更小，而且天线是内置的。\u003c/p\u003e\n\u003cp\u003e上次的方法不能用在这个型号的猫上，但可以用\u003cstrong\u003eftp\u003c/strong\u003e的方式破解。以下步骤基于Linux，并只在硬件版本为\u003cstrong\u003eV1.1.02\u003c/strong\u003e、软件版本为\u003cstrong\u003eV1.1.02T18_N\u003c/strong\u003e的H108B上测试通过：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e使用\u003cstrong\u003e普通用户\u003c/strong\u003e进入猫的设置页面并开启FTP服务，将用户名和密码均设为\u003cstrong\u003eadmin\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e连接ftp服务器：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\nftp 192.168.1.1\n\u003c/blockquote\u003e\n\u003cp\u003e输入用户名和密码，成功登录FTP服务器：\u003c/p\u003e\n\u003cblockquote\u003e\n[lenin@archer ~]$ ftp 192.168.1.1\nConnected to 192.168.1.1.\n220 Welcome to virtual FTP service.\nName (192.168.1.1:lenin): admin\n331 Please specify the password.\nPassword:\n230 Login successful.\nRemote system type is UNIX.\nUsing binary mode to transfer files.\nftp\u003e \n\u003c/blockquote\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e切换到\u003cstrong\u003e/etc\u003c/strong\u003e目录并下载配置文件\u003cstrong\u003eboard.conf\u003c/strong\u003e：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\ncd ../\ncd etc\nget board.conf\n\u003c/blockquote\u003e\n\u003cp\u003e如下所示：\u003c/p\u003e\n\u003cblockquote\u003e\nftp\u003e cd ../\n250 Directory successfully changed.\nftp\u003e cd etc\n250 Directory successfully changed.\nftp\u003e get board.conf\n200 PORT command successful. Consider using PASV.\n150 Opening BINARY mode data connection for board.conf (39516 bytes).\n226 File send OK.\n39516 bytes received in 0.0496 seconds (796003 bytes/s)\nftp\u003e \n\u003c/blockquote\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003e在下载到本地的board.conf中查找\u003cstrong\u003eright\u003c/strong\u003e，后跟\u003cstrong\u003e0\u003c/strong\u003e表示超级用户，若为\u003cstrong\u003e1\u003c/strong\u003e则表示普通用户，如下所示：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;row\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\u0026#34;right\u0026#34;, \u0026#34;0\u0026#34;\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\u0026#34;username\u0026#34;, \u0026#34;bjcnchgw\u0026#34;\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\u0026#34;enable\u0026#34;, \u0026#34;1\u0026#34;\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\u0026#34;password\u0026#34;, \u0026#34;bjcnchgw72915767\u0026#34;\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/row\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;row\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\u0026#34;right\u0026#34;, \u0026#34;1\u0026#34;\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\u0026#34;username\u0026#34;, \u0026#34;user\u0026#34;\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;item\u0026gt;\u003c/span\u003e\u0026#34;password\u0026#34;, \u0026#34;mypasswd\u0026#34;\u003cspan class=\"nt\"\u003e\u0026lt;/item\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/row\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003col start=\"5\"\u003e\n\u003cli\u003e在如下页面使用超级用户登录：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\nhttp://192.168.1.1/cnc.html\n\u003c/blockquote\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003e进入“\u003cstrong\u003e网络\u003c/strong\u003e”→“\u003cstrong\u003e宽带设置\u003c/strong\u003e”页面，删除所有“\u003cstrong\u003e连接名称\u003c/strong\u003e”列出的连接（\u003cem\u003e其中，TR069是网通远程控制猫并修改超级用户密码的连接；INTERNET被设置成了桥接，所以不能实现路由功能；另外两个应该是用来屏蔽第三、四个LAN口的。所以要全部删除。\u003c/em\u003e），并创建新的连接：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/G5p8or5AvVumvFOr89XLqQ?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/TEHd0wXELFI/AAAAAAAABbs/gtxn0tKGyJM/s400/2010-07-17.19%3A48%3A30.%E6%88%AA%E5%8F%96%E9%80%89%E5%8C%BA.01.png\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"网通ADSL猫开启路由和自动拨号功能的方法之二"},{"content":"问题描述\npppoe可以连接，ifconfig可以看到ppp0接口，一切正常，只是不能上网。\n解决办法\n使用如下命令查看路由表：\n1 route 正常情况下返回的结果中应该有如下内容：\ndefault * 0.0.0.0 U 0 0 0 ppp0 如果没有，可手工添加：\n1 route add default dev ppp0 如果可以上网，就成功了。\n使用如下脚本在pppoe连接成功时自动添加路由表项：\n1 2 3 4 5 6 #!/bin/sh if ifconfig ppp0 \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ; then route del default route add default dev ppp0 fi 将上述内容保存成名为01-route.sh的文件，权限755，放到/etc/ppp/ip-up.d目录下。\n然后创建以下两个脚本：\n1 2 3 4 5 6 7 8 9 10 11 12 #!/bin/bash if ifconfig ppp0 \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ; then echo \u0026#39;PPPOE has already been switched on !\u0026#39; exit 0 fi off sudo pon sleep 5 sudo /etc/ppp/ip-up 1 2 3 4 5 6 7 8 9 #!/bin/bash if ! ifconfig ppp0 \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ; then echo \u0026#39;PPPOE has already been switched off !\u0026#39; exit 0 fi sudo poff sudo /etc/ppp/ip-down 分别命名为on和off并复制到环境变量PATH下，以后即可使用这两个脚本建立和注销pppoe连接。\n原因分析\n问题的原因是pppoe连接建立时，没有自动往路由表中添加相关路由项。\n一般情况下，如果使用的是ppp做pppoe连接，其配置文件中默认会开启defaultroute选项，该选项的作用就是在pppoe连接建立时自动添加路由表项，但在路由表中已经存在default项时，该操作将不会进行。\n一般有两种情况会使路由表中在pppoe连接建立前就存在default项。一种情况是网络接口配置中设置了route，如在archlinux下，就是rc.conf文件中的gateway项。如果使用的是静态地址，则需要做这种配置，但对于大多数使用DHCP动态分配IP地址的情况，这项配置则不需要。另一种情况就是ADSL Modem自带路由功能，在分配IP给计算机时也会自动添加一条路由表项。\n","permalink":"http://0x3f.org/posts/problem-on-pppoe-connections-on-linux/","summary":"\u003cp\u003e\u003cstrong\u003e问题描述\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003epppoe可以连接，ifconfig可以看到ppp0接口，一切正常，只是不能上网。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e解决办法\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e使用如下命令查看路由表：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroute\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e正常情况下返回的结果中应该有如下内容：\u003c/p\u003e\n\u003cblockquote\u003e\ndefault  *  0.0.0.0   U   0   0  0 ppp0\n\u003c/blockquote\u003e\n\u003cp\u003e如果没有，可手工添加：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroute add default dev ppp0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e如果可以上网，就成功了。\u003c/p\u003e\n\u003cp\u003e使用如下脚本在pppoe连接成功时自动添加路由表项：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e ifconfig ppp0  \u0026gt; /dev/null 2\u0026gt;\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    route del default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    route add default dev ppp0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e将上述内容保存成名为\u003cstrong\u003e01-route.sh\u003c/strong\u003e的文件，权限\u003cstrong\u003e755\u003c/strong\u003e，放到\u003cstrong\u003e/etc/ppp/ip-up.d\u003c/strong\u003e目录下。\u003c/p\u003e\n\u003cp\u003e然后创建以下两个脚本：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e ifconfig ppp0  \u0026gt; /dev/null 2\u0026gt;\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;PPPOE has already been switched on !\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eoff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo pon\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esleep \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo /etc/ppp/ip-up\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e9\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e ! ifconfig ppp0  \u0026gt; /dev/null 2\u0026gt;\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;PPPOE has already been switched off !\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo poff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo /etc/ppp/ip-down\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e分别命名为\u003cstrong\u003eon\u003c/strong\u003e和\u003cstrong\u003eoff\u003c/strong\u003e并复制到环境变量PATH下，以后即可使用这两个脚本建立和注销pppoe连接。\u003c/p\u003e","title":"Linux下pppoe连接建立后仍不能上网的问题"},{"content":"北京网通送的无线猫有的是华为HG522，有的是HG527，屏蔽了路由和PPPOE自动拨号功能，须使用超级用户登入才能使用这些功能。\n假设网关为默认的192.168.1.1，先使用普通用户登录，然后访问地址： http://192.168.1.1/downloadconfigfile.conf 下载该文件并搜索username，找到超级用户的用户名和密码，如：\n1 \u0026lt;X_ATP_UserInfoInstance InstanceID=\u0026#34;1\u0026#34; Username=\u0026#34;bjcnchgw\u0026#34; Userpassword=\u0026#34;bjcnchgw27852654\u0026#34; Userlevel=\u0026#34;2\u0026#34; Busy=\u0026#34;0\u0026#34; LoginIP=\u0026#34;\u0026#34;/\u0026gt; 在如下地址使用超级用户登录： http://192.168.1.1/cnc.html 设置内容如下图： 终于不用再忍受公共网络了……\n","permalink":"http://0x3f.org/posts/howto-enable-routing-and-auto-dialing-for-unicom-adsl-modem-1/","summary":"\u003cp\u003e北京网通送的无线猫有的是华为HG522，有的是HG527，屏蔽了路由和PPPOE自动拨号功能，须使用超级用户登入才能使用这些功能。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e假设网关为默认的192.168.1.1，先使用普通用户登录，然后访问地址：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\nhttp://192.168.1.1/downloadconfigfile.conf\n\u003c/blockquote\u003e\n\u003cp\u003e下载该文件并搜索\u003cstrong\u003eusername\u003c/strong\u003e，找到超级用户的用户名和密码，如：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;X_ATP_UserInfoInstance\u003c/span\u003e \u003cspan class=\"na\"\u003eInstanceID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eUsername=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;bjcnchgw\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eUserpassword=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;bjcnchgw27852654\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eUserlevel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eBusy=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eLoginIP=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003e在如下地址使用超级用户登录：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\nhttp://192.168.1.1/cnc.html\n\u003c/blockquote\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e设置内容如下图：\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/MwzSxgWShGMJmYJdSQRw8w?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/TDAy1kazOFI/AAAAAAAABa8/jRmlkSC4MaM/s400/32144754dc04625b375cf1d83f3587fc.media.812x604.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e终于不用再忍受公共网络了……\u003c/em\u003e\u003c/p\u003e","title":"网通ADSL猫开启路由和自动拨号功能的方法之一"},{"content":"每cd到一个目录下就ls，这成了我的习惯。以下Bash函数和别名可以实现cd到一个目录下就自动执行ls命令：\n1 2 3 4 5 cdl() { cd \u0026#34;${1}\u0026#34;; ls; } alias cd=cdl 将上述内容添加到用户主目录中的.bashrc中即可。\n","permalink":"http://0x3f.org/posts/howto-do-auto-listing-after-changing-directory/","summary":"\u003cp\u003e每cd到一个目录下就ls，这成了我的习惯。以下Bash函数和别名可以实现cd到一个目录下就自动执行ls命令：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecdl\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003e1\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ls\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ealias\u003c/span\u003e \u003cspan class=\"nv\"\u003ecd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ecdl\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e将上述内容添加到用户主目录中的.bashrc中即可。\u003c/p\u003e","title":"cd到目录下后自动ls的方法"},{"content":"freetds是第三方、开源的数据库客户端和连接库，支持Sybase和Microsoft SQL Server，它最大的好处是允许非Windows平台的程序连接SQL Server。\nfreetds的编译和安装命令如下：\n1 2 3 ./configure --with-tdsver=8.0 --enable-msdblib make make install configure的这两个参数是必不可少的，否则可能无法连接SQL Server。\n安装后修改freetds.conf（一般应该在/usr/local/etc/freetds.conf），添加如下内容：\n[mysvr] host = 10.1.29.40 port = 1433 tds version = 8.0 client charset = utf-8 上述参数应根据实际情况修改。\n最后使用如下命令测试连接：\n1 tsql -S mysvr -U sa -P 123456 给公司产品做Linux下的安装包，把开发环境放在了Cygwin中，非常享受在全屏、半透明的mintty下敲命令。今天发现在Cygwin下也是可以编译安装Linux下的程序的，只是效率非常低下。故上述内容对Cygwin环境同样成立。\n","permalink":"http://0x3f.org/posts/connect-to-sqlserver-using-freetds-on-linux/","summary":"\u003cp\u003e\u003ca href=\"http://www.freetds.org\"\u003efreetds\u003c/a\u003e是第三方、开源的数据库客户端和连接库，支持Sybase和Microsoft SQL Server，它最大的好处是允许非Windows平台的程序连接SQL Server。\u003c/p\u003e\n\u003cp\u003efreetds的编译和安装命令如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure --with-tdsver\u003cspan class=\"o\"\u003e=\u003c/span\u003e8.0 --enable-msdblib\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003econfigure的这两个参数是必不可少的，否则可能无法连接SQL Server。\u003c/p\u003e\n\u003cp\u003e安装后修改\u003cstrong\u003efreetds.conf\u003c/strong\u003e（\u003cem\u003e一般应该在/usr/local/etc/freetds.conf\u003c/em\u003e），添加如下内容：\u003c/p\u003e\n\u003cblockquote\u003e\n[mysvr]\n        host = 10.1.29.40\n        port = 1433\n        tds version = 8.0\n        client charset = utf-8\n\u003c/blockquote\u003e\n\u003cp\u003e上述参数应根据实际情况修改。\u003c/p\u003e\n\u003cp\u003e最后使用如下命令测试连接：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etsql -S mysvr -U sa -P \u003cspan class=\"m\"\u003e123456\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e给公司产品做Linux下的安装包，把开发环境放在了Cygwin中，非常享受在全屏、半透明的mintty下敲命令。今天发现在Cygwin下也是可以编译安装Linux下的程序的，只是效率非常低下。故上述内容对Cygwin环境同样成立。\u003c/p\u003e","title":"Linux下使用freetds连接SQL Server"},{"content":"昨天发现wordpress3.0已经发布，就顺手升级了。\n略看了一下更新内容，几乎没什么让我感兴趣的，但与MU版本的合并堪称WP历史上的一个里程碑，从此一套WP可以支持创建多个博客了。\n但我最近几度都想把博客换到dokuwiki下。\n自从开始用dokuwiki来组织知识和GTD以来，我对wiki产生了越来越深的痴迷，最主要的原因就是它可以用很简单的语法写出格式规整的文章，我几乎可以不用考虑排版布局而只需把注意力放在文章内容上就行了。而将wiki上的文章发到博客上时，还需要重写，比较浪费时间。\n但我最终放弃这个想法，最主要的原因是博客文章太多了，截至现在已经有五百多篇且大多是用HTML写的，难以转换。何况WP作为一个博客系统较wiki有着天生的优势，使用较为方便，如果用wiki来做博客，要做不少工作。\n","permalink":"http://0x3f.org/posts/after-upgrading-to-wordpress30/","summary":"\u003cp\u003e昨天发现wordpress3.0已经发布，就顺手升级了。\u003c/p\u003e\n\u003cp\u003e略看了一下更新内容，几乎没什么让我感兴趣的，但与MU版本的合并堪称WP历史上的一个里程碑，从此一套WP可以支持创建多个博客了。\u003c/p\u003e\n\u003cp\u003e但我最近几度都想把博客换到dokuwiki下。\u003c/p\u003e\n\u003cp\u003e自从\u003ca href=\"http://0x3f.org/?p=1455\"\u003e开始用dokuwiki来组织知识和GTD\u003c/a\u003e以来，我对wiki产生了越来越深的痴迷，最主要的原因就是它可以用很简单的语法写出格式规整的文章，我几乎可以不用考虑排版布局而只需把注意力放在文章内容上就行了。而将wiki上的文章发到博客上时，还需要重写，比较浪费时间。\u003c/p\u003e\n\u003cp\u003e但我最终放弃这个想法，最主要的原因是博客文章太多了，截至现在已经有五百多篇且大多是用HTML写的，难以转换。何况WP作为一个博客系统较wiki有着天生的优势，使用较为方便，如果用wiki来做博客，要做不少工作。\u003c/p\u003e","title":"升级到wordpress3.0"},{"content":"最近客户提的一个需求，要实现分页打印功能。公司产品对打印功能实现得不够好，排版全由程序生成，耦合度高，且不支持分页，需要用笨拙的方法变通。\n于是我对如何更好地实现分页打印产生了兴趣，Google了一下，整理了一个Demo：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html;charset=utf-8\u0026#34;/\u0026gt; \u0026lt;style media=print\u0026gt; .Noprint{display:none;} .PageNext{page-break-after: always;} \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;OBJECT id=WebBrowser classid=CLSID:8856F961-340A-11D0-A96B-00C04FD705A2 height=0 width=0 VIEWASTEXT\u0026gt; \u0026lt;/OBJECT\u0026gt; \u0026lt;div class=\u0026#34;Noprint\u0026#34;\u0026gt; \u0026lt;input onclick=document.all.WebBrowser.ExecWB(6,1) type=button value=打印 name=Button\u0026gt; \u0026lt;input onclick=document.all.WebBrowser.ExecWB(7,1) type=button value=打印预览 name=Button\u0026gt; \u0026lt;input onclick=document.all.WebBrowser.ExecWB(8,1) type=button value=页面设置 name=Button4\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;PageNext\u0026#34;\u0026gt; \u0026lt;center\u0026gt;\u0026lt;h1\u0026gt;雅游\u0026lt;/h1\u0026gt;\u0026lt;/center\u0026gt; \u0026lt;p\u0026gt;旧院人称曲中，前门对武定桥，后门在钞库街。妓家鳞次，比屋而居。屋宇精洁，花木萧疏，迥非尘境。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;到门则铜环半启，珠箔低垂;升阶则猧儿吠客，鹦哥唤茶；登堂则假母肃迎，分宾抗礼；\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;进轩则丫鬟毕妆，捧艳而出；坐久则水陆备至，丝肉竞陈；定情则目眺心挑，绸缪宛转。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;纨绔少年，绣肠才子，无不魂迷色阵，气尽雌风矣。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;妓家，仆婢称之曰娘，外人呼之曰小娘，假母称之曰娘儿。\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;有客称客曰姐夫，客称假母曰外婆。\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;PageNext\u0026#34;\u0026gt; \u0026lt;center\u0026gt;\u0026lt;h1\u0026gt;木兰花令·拟古决绝词\u0026lt;/h1\u0026gt;\u0026lt;/center\u0026gt; \u0026lt;center\u0026gt;\u0026lt;h3\u0026gt;清·纳兰容若\u0026lt;/h3\u0026gt;\u0026lt;/center\u0026gt; \u0026lt;p\u0026gt;人生若只如初见，何事秋风悲画扇。等闲变却故人心，却道故人心易变!\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;骊山语罢清宵半，泪雨零铃终不怨。何如薄幸锦衣郎，比翼连枝当日愿!\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 这个方法的好处是支持以低耦合的方式分页打印，同时支持只打印页面上指定的部分内容；缺点是由于使用了ActiveX，故只支持IE浏览器。\n","permalink":"http://0x3f.org/posts/howto-do-paged-printing-using-javascript/","summary":"\u003cp\u003e最近客户提的一个需求，要实现分页打印功能。公司产品对打印功能实现得不够好，排版全由程序生成，耦合度高，且不支持分页，需要用笨拙的方法变通。\u003c/p\u003e\n\u003cp\u003e于是我对如何更好地实现分页打印产生了兴趣，Google了一下，整理了一个Demo：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ehtml\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003emeta\u003c/span\u003e \u003cspan class=\"na\"\u003ehttp-equiv\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Content-Type\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003econtent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;text/html;charset=utf-8\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003estyle\u003c/span\u003e \u003cspan class=\"na\"\u003emedia\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eNoprint\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003enone\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003ePageNext\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003epage-break-after\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003ealways\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003estyle\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eOBJECT\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eWebBrowser\u003c/span\u003e \u003cspan class=\"na\"\u003eclassid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eCLSID:8856F961-340A-11D0-A96B-00C04FD705A2\u003c/span\u003e \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e0\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e0\u003c/span\u003e \u003cspan class=\"na\"\u003eVIEWASTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eOBJECT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Noprint\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003einput\u003c/span\u003e   \u003cspan class=\"na\"\u003eonclick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003edocument.all.WebBrowser.ExecWB(6,1)\u003c/span\u003e   \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ebutton\u003c/span\u003e   \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e打印\u003c/span\u003e   \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eButton\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003einput\u003c/span\u003e   \u003cspan class=\"na\"\u003eonclick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003edocument.all.WebBrowser.ExecWB(7,1)\u003c/span\u003e   \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ebutton\u003c/span\u003e   \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e打印预览\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eButton\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003einput\u003c/span\u003e   \u003cspan class=\"na\"\u003eonclick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003edocument.all.WebBrowser.ExecWB(8,1)\u003c/span\u003e   \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ebutton\u003c/span\u003e   \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e页面设置\u003c/span\u003e   \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eButton4\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;PageNext\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e雅游\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e旧院人称曲中，前门对武定桥，后门在钞库街。妓家鳞次，比屋而居。屋宇精洁，花木萧疏，迥非尘境。\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e到门则铜环半启，珠箔低垂;升阶则猧儿吠客，鹦哥唤茶；登堂则假母肃迎，分宾抗礼；\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e进轩则丫鬟毕妆，捧艳而出；坐久则水陆备至，丝肉竞陈；定情则目眺心挑，绸缪宛转。\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e纨绔少年，绣肠才子，无不魂迷色阵，气尽雌风矣。\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e妓家，仆婢称之曰娘，外人呼之曰小娘，假母称之曰娘儿。\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e有客称客曰姐夫，客称假母曰外婆。\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;PageNext\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e木兰花令·拟古决绝词\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eh3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e清·纳兰容若\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eh3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e人生若只如初见，何事秋风悲画扇。等闲变却故人心，却道故人心易变!\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e骊山语罢清宵半，泪雨零铃终不怨。何如薄幸锦衣郎，比翼连枝当日愿!\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ehtml\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e这个方法的好处是支持以低耦合的方式分页打印，同时支持只打印页面上指定的部分内容；缺点是由于使用了ActiveX，故只支持IE浏览器。\u003c/p\u003e","title":"用JavaScript实现分页打印"},{"content":"利用国外服务器中转feedburner的图标：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;?php /* * 将$fburl替换为自己的feedburner订阅数图片地址，然后将博客中的图片地址换成此脚本的URL即可 */ $fburl = \u0026#39;http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF\u0026amp;amp;fg=444444\u0026amp;amp;anim=0\u0026#39;; $fbfl = \u0026#39;fb.gif\u0026#39;; $fp = fopen($fburl, \u0026#39;rb\u0026#39;); if ($fp) { $fp_local = fopen($fbfl, \u0026#39;wb\u0026#39;); if ($fp_local) { while (!feof($fp)) { fwrite($fp_local, fread($fp, 1024*8), 1024*8); } fclose($fp_local); } fclose($fp); } header(\u0026#39;Location: \u0026#39;.$fbfl); ?\u0026gt; 或者：\n1 2 3 4 \u0026lt;?php header(\u0026#39;Content-Type: image/gif\u0026#39;); readfile(\u0026#39;http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF\u0026amp;fg=444444\u0026amp;anim=0\u0026#39;); ?\u0026gt; ","permalink":"http://0x3f.org/posts/howto-display-feedburner-subscription-image/","summary":"\u003cp\u003e利用国外服务器中转feedburner的图标：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * 将$fburl替换为自己的feedburner订阅数图片地址，然后将博客中的图片地址换成此脚本的URL即可\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$fburl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF\u0026amp;amp;fg=444444\u0026amp;amp;anim=0\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$fbfl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;fb.gif\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fburl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;rb\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$fp_local\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fbfl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;wb\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp_local\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nx\"\u003efwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp_local\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003efread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1024\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"mi\"\u003e1024\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003efclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp_local\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003efclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Location: \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fbfl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e或者：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Content-Type: image/gif\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ereadfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF\u0026amp;fg=444444\u0026amp;anim=0\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"中转feedburner订阅数图标"},{"content":"cpufrequtils可以根据不同的方案自动调节CPU的频率，从而达到在系统空闲时降低CPU温度、节省电力的目的。\nArchlinux官方wiki已经介绍得很明白了：http://wiki.archlinux.org/index.php/Cpufrequtils_(简体中文)\n使用后效果明显，CPU温度有所下降，下面是cpufrequtils在Arch上的工作情况：\n[lenin@archer ~]$ cpufreq-info cpufrequtils 007: cpufreq-info (C) Dominik Brodowski 2004-2009 Report errors and bugs to cpufreq@vger.kernel.org, please. analyzing CPU 0: driver: acpi-cpufreq CPUs which run at the same hardware frequency: 0 1 CPUs which need to have their frequency coordinated by software: 0 maximum transition latency: 10.0 us. hardware limits: 800 MHz - 2.53 GHz available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz available cpufreq governors: ondemand, performance current policy: frequency should be within 800 MHz and 1.60 GHz. The governor \u0026#34;ondemand\u0026#34; may decide which speed to use within this range. current CPU frequency is 800 MHz. analyzing CPU 1: driver: acpi-cpufreq CPUs which run at the same hardware frequency: 0 1 CPUs which need to have their frequency coordinated by software: 1 maximum transition latency: 10.0 us. hardware limits: 800 MHz - 2.53 GHz available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz available cpufreq governors: ondemand, performance current policy: frequency should be within 800 MHz and 1.60 GHz. The governor \u0026#34;performance\u0026#34; may decide which speed to use within this range. current CPU frequency is 1.60 GHz. ","permalink":"http://0x3f.org/posts/using-cpufrequtils-to-reduce-cpu-temperature/","summary":"\u003cp\u003ecpufrequtils可以根据不同的方案自动调节CPU的频率，从而达到在系统空闲时降低CPU温度、节省电力的目的。\u003c/p\u003e\n\u003cp\u003eArchlinux官方wiki已经介绍得很明白了：\u003ca href=\"http://wiki.archlinux.org/index.php/Cpufrequtils_(简体中文)\"\u003e\u003ca href=\"http://wiki.archlinux.org/index.php/Cpufrequtils_(\"\u003ehttp://wiki.archlinux.org/index.php/Cpufrequtils_(\u003c/a\u003e简体中文)\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e使用后效果明显，CPU温度有所下降，下面是cpufrequtils在\u003ca href=\"http://0x3f.org/?tag=arch\"\u003eArch\u003c/a\u003e上的工作情况：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e[lenin@archer ~]$ cpufreq-info \ncpufrequtils 007: cpufreq-info (C) Dominik Brodowski 2004-2009\nReport errors and bugs to cpufreq@vger.kernel.org, please.\nanalyzing CPU 0:\n  driver: acpi-cpufreq\n  CPUs which run at the same hardware frequency: 0 1\n  CPUs which need to have their frequency coordinated by software: 0\n  maximum transition latency: 10.0 us.\n  hardware limits: 800 MHz - 2.53 GHz\n  available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz\n  available cpufreq governors: ondemand, performance\n  current policy: frequency should be within 800 MHz and 1.60 GHz.\n                  The governor \u0026#34;ondemand\u0026#34; may decide which speed to use\n                  within this range.\n  current CPU frequency is 800 MHz.\nanalyzing CPU 1:\n  driver: acpi-cpufreq\n  CPUs which run at the same hardware frequency: 0 1\n  CPUs which need to have their frequency coordinated by software: 1\n  maximum transition latency: 10.0 us.\n  hardware limits: 800 MHz - 2.53 GHz\n  available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz\n  available cpufreq governors: ondemand, performance\n  current policy: frequency should be within 800 MHz and 1.60 GHz.\n                  The governor \u0026#34;performance\u0026#34; may decide which speed to use\n                  within this range.\n  current CPU frequency is 1.60 GHz.\n\u003c/code\u003e\u003c/pre\u003e","title":"低碳生活：使用 cpufrequtils降低CPU温度"},{"content":"作为和NSIS并立的、两个最流行的免费Windows应用程序安装包制作工具之一，Inno在学习难度上相对要低一些，非常适合对一些简单的桌面程序打包。但对于较复杂的安装过程，或者Web应用程序来说，我个人觉得不是Inno的强项。当然，既然Inno内嵌了Pascal语言用以扩展功能，理论上不是不可以应付复杂的安装过程，但实现起来要复杂一些。\n比如对于在安装过程中连接数据库并执行SQL脚本这样的需求，使用InstallShield应该会简单地多，而Inno却不支持直接操作数据库，并且相关的资料说明少之又少，还不如NSIS丰富，以至于我踏破铁鞋无觅处，最终却在NSIS的资料中找到了思路。\n主要的思路是，在安装过程中，调用数据库客户端连接数据库并执行SQL脚本，然后将执行结果或错误信息输出到文件中，最后通过分析这个文件来判断命令执行的结果。但是，既然是调用特定的客户端，那么对不同数据库的操作自然就有所区别，具体情况如下所述。\n首先在打包脚本的[Files]段将必需的文件包含进来：\n```ini [Files] Source: \"D:\\Development\\MyDemoApp\\code\\*\"; DestDir: \"{app}\"; Flags: ignoreversion recursesubdirs createallsubdirs Source: \"D:\\Development\\MyDemoApp\\sqlcmd.exe\"; Flags: dontcopy Source: \"D:\\Development\\MyDemoApp\\sqlcmd.rll\"; Flags: dontcopy Source: \"D:\\Development\\MyDemoApp\\mysql.exe\"; Flags: dontcopy Source: \"D:\\Development\\MyDemoApp\\script_mssql.sql\"; Flags: dontcopy Source: \"D:\\Development\\MyDemoApp\\script_mysql.sql\"; Flags: dontcopy Source: \"D:\\Development\\MyDemoApp\\script_oracle.sql\"; Flags: dontcopy ``` 在SQL Server中执行脚本的代码片断：\n```pascal function ExecScriptInMSSQL(DBHost, DBLogin, DBPass, DBName: String): Boolean; var ConnectExe: String; ConnectParam: String; begin {解压临时文件} ExtractTemporaryFile('sqlcmd.exe'); ExtractTemporaryFile('sqlcmd.rll'); ExtractTemporaryFile('script_mssql.sql'); {构造数据库连接字符串} ConnectExe := ExpandConstant('{tmp}') + '\\sqlcmd.exe'; ConnectParam := ' -S ' + DBHost + ' -U ' + DBLogin + ' -P ' + DBPass + ' -d ' + DBName + ' -i script_mssql.sql -o ' + ExpandConstant('{tmp}') + '\\dbstatus.txt'; {建立数据库连接并执行脚本} if Exec(ConnectExe, ConnectParam, '', SW_HIDE, ewWaitUntilTerminated, ResultCode) then begin Result := ResultCode = 0; LoadStringFromFile(ExpandConstant('{tmp}') + '\\dbstatus.txt', StatusString); if StatusString \u003c\u003e '' then begin MsgBox(StatusString, mbError, MB_OK); Result := False; end else begin Result := True; end; end else begin MsgBox('Database update failed:'#10#10 + SysErrorMessage(ResultCode), mbError, MB_OK); Result := False; end; end; ``` 在MySQL中执行脚本的代码片断：\n```pascal function ExecScriptInMYSQL(DBHost, DBLogin, DBPass, DBName: String): Boolean; var ConnectExe: String; ConnectParam: String; begin {解压临时文件} ExtractTemporaryFile('mysql.exe'); ExtractTemporaryFile('script_mysql.sql'); {构造数据库连接字符串} ConnectExe := ExpandConstant('cmd'); ConnectParam := ' /c \"' + ExpandConstant('{tmp}') + '\\mysql.exe' + ' -h' + DBHost + ' -u' + DBLogin + ' -p' + DBPass + ' -D' + DBName + ' -e \"source ' + ExpandConstant('{tmp}') + '\\script_mysql.sql\"\" \u003e ' + ExpandConstant('{tmp}') + '\\dbstatus.txt 2\u003e\u00261'; {建立数据库连接并执行脚本} if Exec(ConnectExe, ConnectParam, '', SW_HIDE, ewWaitUntilTerminated, ResultCode) then begin Result := ResultCode = 0; LoadStringFromFile(ExpandConstant('{tmp}') + '\\dbstatus.txt', StatusString); if StatusString \u003c\u003e '' then begin MsgBox(StatusString, mbError, MB_OK); Result := False; end else begin Result := True; end; end else begin MsgBox('Database update failed:'#10#10 + SysErrorMessage(ResultCode), mbError, MB_OK); Result := False; end; end; ``` 由于mysql.exe没有输出结果到文件的参数，故需要使用cmd.exe来运行mysql.exe以便将其输出重定向到文件dbstatus.txt中。此外，在命令的最后加上参数2\u0026gt;\u0026amp;1，将标准错误输出设备也重定向到文件上，否则命令执行的错误信息不会输出到文件中。\n在Oracle中执行脚本的代码片断：\n```pascal function ExecScriptInORACLE(ClientPath, DBInstance, DBLogin, DBPass: String): Boolean; begin {解压临时文件} ExtractTemporaryFile('script_oracle.sql'); {连接数据库并执行脚本} if Exec(ExpandConstant('cmd'), ' /c \"' + ClientPath + ' -L -S ' + DBLogin + '/' + DBPass + '@' + DBInstance + ' @' + ExpandConstant('{tmp}') + '\\script_oracle.sql \u003e ' + ExpandConstant('{tmp}') + '\\dbstatus.txt 2\u003e\u00261', '', SW_HIDE, ewWaitUntilTerminated, ResultCode) then begin Result := ResultCode = 0; LoadStringFromFile(ExpandConstant('{tmp}') + '\\dbstatus.txt', StatusString); if Pos('holytail', StatusString) \u003c\u003e 0 then begin {若输出信息中有“holytail”的子串，则表示脚本成功执行} {若执行有误，提示用户打开日志文件} if Pos('ORA-', StatusString) \u003c\u003e 0 then begin {提示用户脚本执行出错} if MsgBox('数据库更新出错，是否打开日志文件？', mbConfirmation, MB_YESNO) = IDYES then begin {打开日志} if not ShellExec('', ExpandConstant('{tmp}') + '\\dbstatus.txt', '', '', SW_SHOW, ewNoWait, ErrorCode) then begin MsgBox('日志文件打开错误！', mbError, MB_OK); end; end; Result := False; {若执行无误，返回True} end else begin Result := True; end; end else if StatusString \u003c\u003e '' then begin MsgBox(StatusString, mbError, MB_OK); Result := False; end else begin Result := True; end; end else begin MsgBox('Database update failed:'#10#10 + SysErrorMessage(ResultCode), mbError, MB_OK); Result := False; end; end; ``` Oracle的客户端太大，不能集成到安装包中，应使用一个TInputFileWizardPage由用户选择sqlplus.exe的安装位置。同时，由于sqlplus.exe也没有输出结果到文件的参数，也须使用cmd.exe来运行它并重定向输出到文件。此外，由于sqlplus.exe执行脚本时无论成功还是失败，都会输出信息，故无法像使用sqlcmd.exe和mysql.exe那样简单地判断脚本是否执行成功，需要在脚本的最后通过select语句输出一个特殊的字符串到文件中，然后通过判断dbstatus.txt中是否存在该字符串来判断脚本的执行情况；且由于sqlplus.exe执行完脚本后不会自动退出，还要在脚本最后加上exit语句；故script_oracle.sql的最后必须是如下内容：\n```sql SELECT 'holytail' FROM dual; exit; ``` ","permalink":"http://0x3f.org/posts/howto-execute-sql-scripts-in-inno-setup/","summary":"\u003cp\u003e作为和\u003ca href=\"http://zh.wikipedia.org/zh-cn/Nullsoft%E8%85%B3%E6%9C%AC%E5%AE%89%E8%A3%9D%E7%B3%BB%E7%B5%B1\"\u003eNSIS\u003c/a\u003e并立的、两个最流行的免费Windows应用程序安装包制作工具之一，\u003ca href=\"http://en.wikipedia.org/wiki/Inno_Setup\"\u003eInno\u003c/a\u003e在学习难度上相对要低一些，非常适合对一些简单的桌面程序打包。但对于较复杂的安装过程，或者Web应用程序来说，我个人觉得不是Inno的强项。当然，既然Inno内嵌了\u003ca href=\"http://zh.wikipedia.org/zh-cn/Pascal\"\u003ePascal\u003c/a\u003e语言用以扩展功能，理论上不是不可以应付复杂的安装过程，但实现起来要复杂一些。\u003c/p\u003e\n\n\u003cp\u003e比如对于在安装过程中连接数据库并执行SQL脚本这样的需求，使用\u003ca href=\"http://en.wikipedia.org/wiki/InstallShield\"\u003eInstallShield\u003c/a\u003e应该会简单地多，而Inno却不支持直接操作数据库，并且相关的资料说明少之又少，还不如NSIS丰富，以至于我踏破铁鞋无觅处，最终却在NSIS的资料中找到了思路。\u003c/p\u003e\n\n\u003cp\u003e主要的思路是，在安装过程中，调用数据库客户端连接数据库并执行SQL脚本，然后将执行结果或错误信息输出到文件中，最后通过分析这个文件来判断命令执行的结果。但是，既然是调用特定的客户端，那么对不同数据库的操作自然就有所区别，具体情况如下所述。\u003c/p\u003e\n\n\u003cp\u003e首先在打包脚本的\u003cstrong\u003e[Files]\u003c/strong\u003e段将必需的文件包含进来：\u003c/p\u003e\n\n```ini\n[Files]\nSource: \"D:\\Development\\MyDemoApp\\code\\*\"; DestDir: \"{app}\"; Flags: ignoreversion recursesubdirs createallsubdirs\nSource: \"D:\\Development\\MyDemoApp\\sqlcmd.exe\"; Flags: dontcopy\nSource: \"D:\\Development\\MyDemoApp\\sqlcmd.rll\"; Flags: dontcopy\nSource: \"D:\\Development\\MyDemoApp\\mysql.exe\"; Flags: dontcopy\nSource: \"D:\\Development\\MyDemoApp\\script_mssql.sql\"; Flags: dontcopy\nSource: \"D:\\Development\\MyDemoApp\\script_mysql.sql\"; Flags: dontcopy\nSource: \"D:\\Development\\MyDemoApp\\script_oracle.sql\"; Flags: dontcopy\n```\n\n\u003cp\u003e在SQL Server中执行脚本的代码片断：\u003c/p\u003e\n\n```pascal\nfunction ExecScriptInMSSQL(DBHost, DBLogin, DBPass, DBName: String): Boolean;\nvar\n    ConnectExe: String;\n    ConnectParam: String;\nbegin\n    {解压临时文件}\n    ExtractTemporaryFile('sqlcmd.exe');\n    ExtractTemporaryFile('sqlcmd.rll');\n    ExtractTemporaryFile('script_mssql.sql');\n    {构造数据库连接字符串}\n    ConnectExe := ExpandConstant('{tmp}') + '\\sqlcmd.exe';\n    ConnectParam := ' -S ' + DBHost\n        + ' -U ' + DBLogin\n        + ' -P ' + DBPass\n        + ' -d ' + DBName\n        + ' -i script_mssql.sql -o '\n        + ExpandConstant('{tmp}') + '\\dbstatus.txt';\n    {建立数据库连接并执行脚本}\n    if Exec(ConnectExe, ConnectParam, '', SW_HIDE, ewWaitUntilTerminated, ResultCode) then begin\n        Result := ResultCode = 0;\n        LoadStringFromFile(ExpandConstant('{tmp}') + '\\dbstatus.txt', StatusString);\n        if StatusString \u003c\u003e '' then begin\n            MsgBox(StatusString, mbError, MB_OK);\n            Result := False;\n        end else begin\n            Result := True;\n        end;\n    end else begin\n        MsgBox('Database update failed:'#10#10 + SysErrorMessage(ResultCode), mbError, MB_OK);\n        Result := False;\n    end;\nend;\n```\n\n\u003cp\u003e在MySQL中执行脚本的代码片断：\u003c/p\u003e","title":"Inno Setup执行SQL脚本的方法"},{"content":"FreeArc的特点在于它在压缩比率与效率上取得了一个很好的平衡。传统的压缩程序则多偏重一点，要么占用系统资源低、速度快，但压缩比率小，如ZIP、RAR；要么压缩比率高，但占用系统资源大、速度慢，如7z。 把RAR归于前者只是相对而言，除了WinZip，没有哪个压缩工具能取得像WinRAR那样的成功。之所以能做到这一点，是因为WinRAR不但继承了WinZip易用的优点，还具有对多种压缩算法广泛的兼容度，最重要的是，RAR压缩算法在效率与比率之间取得了一个非常好的平衡。凭借这些优势，WinRAR一举推翻了WinZip的王座，直到现在，它都是这个领域值得学习的榜样。 早在7-Zip刚刚推出的时候，我就用过它。在压缩比率上，7z较RAR有着明显的优势，但在系统资源占用和压缩速度上，7z的表现非常不理想。最糟糕的是，如果你的机器配置较低，再加上你使用Windows系统，并且尤其喜欢使用图形界面的压缩工具，那7-zip对你来说就是一场恶梦，我曾经有过压缩一个较大的文件时进度条半天都不移动的经历。当然，在Windows命令行或Linux的终端中使用7-zip情况要好很多。此外，随着7-zip自身的完善和电脑配置的更新换代，这些劣势对7-zip普及的限制正逐渐弱化，事实上，我倾向于推荐用7-zip取代WinRAR，因为前者免费且有较大的压缩比率，而后者是收费的。 上周偶然发现的FreeArc，它的主页上居然宣称比最好的压缩工具都快1.5到3倍，并且同时拥有超高的压缩比率。于是我拿7-zip与之作了几个粗略的对比测试，发现虽然没有宣称的那么夸张，但在压缩同样的文件并使用同样的压缩级别时，FreeArc均比7-zip快一些，而压缩比率却要稍高于后者。甚至对于某些格式的文件，FreeArc的“普通”级别的压缩比率都比7-zip“最高”级别的大。 鉴于7-zip是资源占用大户，我非常怀疑在效率上FreeArc较WinRAR会有什么优势，更遑论快上1.5到3倍，但它的效率高于7-zip却是一个不争的事实，何况还有更高的压缩比率。此外，这次的测试中使用的操作系统和7-zip都是64位的，而FreeArc却是32位的，因此在效率的比试上会有不公平的地方。 当然，FreeArc自身的缺点也很大： 尚无64位版本 只支持Windows和Linux系统 不支持多卷压缩（分割压缩） 其它一些问题 如果能在较短的时间内解决这些问题，我认为FreeArc还是很有前景的。\n","permalink":"http://0x3f.org/posts/freearc/","summary":"\u003cp\u003e\u003ca href=\"http://freearc.org/\"\u003eFreeArc\u003c/a\u003e的特点在于它在压缩比率与效率上取得了一个很好的平衡。传统的压缩程序则多偏重一点，要么占用系统资源低、速度快，但压缩比率小，如ZIP、RAR；要么压缩比率高，但占用系统资源大、速度慢，如7z。 \u003c/p\u003e\n\n\u003cp\u003e把RAR归于前者只是相对而言，除了WinZip，没有哪个压缩工具能取得像WinRAR那样的成功。之所以能做到这一点，是因为WinRAR不但继承了WinZip易用的优点，还具有对多种压缩算法广泛的兼容度，最重要的是，RAR压缩算法在效率与比率之间取得了一个非常好的平衡。凭借这些优势，WinRAR一举推翻了WinZip的王座，直到现在，它都是这个领域值得学习的榜样。 \u003c/p\u003e\n\n\u003cp\u003e早在7-Zip刚刚推出的时候，我就用过它。在压缩比率上，7z较RAR有着明显的优势，但在系统资源占用和压缩速度上，7z的表现非常不理想。最糟糕的是，如果你的机器配置较低，再加上你使用Windows系统，并且尤其喜欢使用图形界面的压缩工具，那7-zip对你来说就是一场恶梦，我曾经有过压缩一个较大的文件时进度条半天都不移动的经历。当然，在Windows命令行或Linux的终端中使用7-zip情况要好很多。此外，随着7-zip自身的完善和电脑配置的更新换代，这些劣势对7-zip普及的限制正逐渐弱化，事实上，我倾向于推荐用7-zip取代WinRAR，因为前者免费且有较大的压缩比率，而后者是收费的。 \u003c/p\u003e\n\n\u003cp\u003e上周偶然发现的FreeArc，它的主页上居然宣称比最好的压缩工具都快1.5到3倍，并且同时拥有超高的压缩比率。于是我拿7-zip与之作了几个粗略的对比测试，发现虽然没有宣称的那么夸张，但在压缩同样的文件并使用同样的压缩级别时，FreeArc均比7-zip快一些，而压缩比率却要稍高于后者。甚至对于某些格式的文件，FreeArc的“普通”级别的压缩比率都比7-zip“最高”级别的大。 \u003c/p\u003e\n\n\u003cp\u003e鉴于7-zip是资源占用大户，我非常怀疑在效率上FreeArc较WinRAR会有什么优势，更遑论快上1.5到3倍，但它的效率高于7-zip却是一个不争的事实，何况还有更高的压缩比率。此外，这次的测试中使用的操作系统和7-zip都是64位的，而FreeArc却是32位的，因此在效率的比试上会有不公平的地方。 \u003c/p\u003e\n\n\u003cp\u003e当然，FreeArc自身的缺点也很大： \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e尚无64位版本\u003c/li\u003e\n\u003cli\u003e只支持Windows和Linux系统\u003c/li\u003e\n\u003cli\u003e不支持多卷压缩（分割压缩）\u003c/li\u003e\n\u003cli\u003e其它一些问题\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e如果能在较短的时间内解决这些问题，我认为FreeArc还是很有前景的。\u003c/p\u003e","title":"FreeArc：兼顾压缩比率与效率的压缩程序"},{"content":"一般情况下，如果能找到可用的证书，就可以直接使用，只不过会因证书的某些信息不正确或与部署证书的主机不匹配而导致浏览器提示证书无效，但这并不影响使用。\n需要手工生成证书的情况有：\n找不到可用的证书 需要配置双向SSL，但缺少客户端证书 需要对证书作特别的定制 首先，无论是在Linux下还是在Windows下的Cygwin中，进行下面的操作前都须确认已安装OpenSSL软件包。\n1. 创建根证书密钥文件root.key：\n``` openssl genrsa -des3 -out root.key ``` 输出内容为：\n``` [lenin@archer ~]$ openssl genrsa -des3 -out root.key Generating RSA private key, 512 bit long modulus .................++++++++++++ ..++++++++++++ e is 65537 (0x10001) Enter pass phrase for root.key: ← 输入一个新密码 Verifying - Enter pass phrase for root.key: ← 重新输入一遍密码 ``` 2. 创建根证书的申请文件root.req：\n``` openssl req -new -key root.key -out root.req ``` 输出内容为：\n``` [lenin@archer ~]$ openssl req -new -key root.key -out root.req Enter pass phrase for root.key: ← 输入前面创建的密码 You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN ← 国家代号，中国输入CN State or Province Name (full name) [Some-State]:BeiJing ← 省的全名，拼音 Locality Name (eg, city) []:BeiJing ← 市的全名，拼音 Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp. ← 公司英文名 Organizational Unit Name (eg, section) []: ← 可以不输入 Common Name (eg, YOUR name) []: ← 此时不输入 Email Address []:admin@mycompany.com ← 电子邮箱，可随意填\nPlease enter the following 'extra' attributes to be sent with your certificate request A challenge password []: ← 可以不输入 An optional company name []: ← 可以不输入\n``` 3. 创建一个自当前日期起为期十年的根证书root.crt：\n``` openssl x509 -req -days 3650 -sha1 -extensions v3_ca -signkey root.key -in root.req -out root.crt ``` 输出内容为：\n``` [lenin@archer ~]$ openssl x509 -req -days 3650 -sha1 -extensions v3_ca -signkey root.key -in root.req -out root.crt Signature ok subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./emailAddress=admin@mycompany.com Getting Private key Enter pass phrase for root.key: ← 输入前面创建的密码 ``` 4. 创建服务器证书密钥server.key：\n``` openssl genrsa -out server.key 2048 ``` 输出内容为：\n``` [lenin@archer ~]$ openssl genrsa -out server.key 2048 Generating RSA private key, 2048 bit long modulus ....+++ ..................................................+++ e is 65537 (0x10001) ``` 5.创建服务器证书的申请文件server.req：\n``` openssl req -new -key server.key -out server.req ``` 输出内容为：\n``` [lenin@archer ~]$ openssl req -new -key server.key -out server.req You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN ← 国家名称，中国输入CN State or Province Name (full name) [Some-State]:BeiJing ← 省名，拼音 Locality Name (eg, city) []:BeiJing ← 市名，拼音 Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp. ← 公司英文名 Organizational Unit Name (eg, section) []: ← 可以不输入 Common Name (eg, YOUR name) []:www.mycompany.com ← 服务器主机名，若填写不正确，浏览器会报告证书无效，但并不影响使用 Email Address []:admin@mycompany.com ← 电子邮箱，可随便填 Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []: ← 可以不输入 An optional company name []: ← 可以不输入 ``` 6. 创建自当前日期起有效期为期两年的服务器证书server.crt：\n``` openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in server.req -out server.crt ``` 输出内容为：\n``` [lenin@archer ~]$ openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in server.req -out server.crt Signature ok subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www.mycompany.com/emailAddress=admin@mycompany.com Getting CA Private Key Enter pass phrase for root.key: ← 输入前面创建的密码 ``` 7. 创建客户端证书密钥文件client.key：\n``` openssl genrsa -des3 -out client.key 2048 ``` 输出内容为：\n``` [lenin@archer ~]$ openssl genrsa -des3 -out client.key 2048 Generating RSA private key, 2048 bit long modulus .........................................................................................+++ ......................................................................................................................+++ e is 65537 (0x10001) Enter pass phrase for client.key: ← 输入一个新密码 Verifying - Enter pass phrase for client.key: ← 重新输入一遍密码 ``` 8. 创建客户端证书的申请文件client.req：\n``` openssl req -new -key client.key -out client.req ``` 输出内容为：\n``` [lenin@archer ~]$ openssl genrsa -des3 -out client.key 2048 Generating RSA private key, 2048 bit long modulus .........................................................................................+++ ......................................................................................................................+++ e is 65537 (0x10001) Enter pass phrase for client.key: Verifying - Enter pass phrase for client.key: [lenin@archer ~]$ openssl req -new -key client.key -out client.req Enter pass phrase for client.key: ← 输入上一步中创建的密码 You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN ← 国家名称，中国输入CN State or Province Name (full name) [Some-State]:BeiJing ← 省名称，拼音 Locality Name (eg, city) []:BeiJing ← 市名称，拼音 Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp. ← 公司英文名 Organizational Unit Name (eg, section) []: ← 可以不填 Common Name (eg, YOUR name) []:Lenin ← 自己的英文名，可以随便填 Email Address []:admin@mycompany.com ← 电子邮箱，可以随便填 Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []: ← 可以不填 An optional company name []: ← 可以不填 ``` 9. 创建一个自当前日期起有效期为两年的客户端证书client.crt：\n``` openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in client.req -out client.crt ``` 输出内容为：\n``` [lenin@archer ~]$ openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in client.req -out client.crt Signature ok subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www.mycompany.com/emailAddress=admin@mycompany.com Getting CA Private Key Enter pass phrase for root.key: ← 输入上面创建的密码 ``` 10. 将客户端证书文件client.crt和客户端证书密钥文件client.key合并成客户端证书安装包client.pfx：\n``` openssl pkcs12 -export -in client.crt -inkey client.key -out client.pfx ``` 输出内容为：\n``` [lenin@archer ~]$ openssl pkcs12 -export -in client.crt -inkey client.key -out client.pfx Enter pass phrase for client.key: ← 输入上面创建的密码 Enter Export Password: ← 输入一个新的密码，用作客户端证书的保护密码，在客户端安装证书时需要输入此密码 Verifying - Enter Export Password: ← 确认密码 ``` 11. 保存生成的文件备用，其中server.crt和server.key是配置单向SSL时需要使用的证书文件，client.crt是配置双向SSL时需要使用的证书文件，client.pfx是配置双向SSL时需要客户端安装的证书文件\n","permalink":"http://0x3f.org/posts/howto-create-ssl-certificates/","summary":"\u003cp\u003e一般情况下，如果能找到可用的证书，就可以直接使用，只不过会因证书的某些信息不正确或与部署证书的主机不匹配而导致浏览器提示证书无效，但这并不影响使用。\u003c/p\u003e\n\n\u003cp\u003e需要手工生成证书的情况有：\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e找不到可用的证书\u003c/li\u003e\n\u003cli\u003e需要配置双向SSL，但缺少客户端证书\u003c/li\u003e\n\u003cli\u003e需要对证书作特别的定制\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e首先，无论是在Linux下还是在Windows下的Cygwin中，进行下面的操作前都须确认已安装OpenSSL软件包。\u003c/p\u003e\n\n\u003cp\u003e1. 创建根证书密钥文件\u003cstrong\u003eroot.key\u003c/strong\u003e：\u003c/p\u003e\n\n```\nopenssl genrsa -des3 -out root.key\n```\n\n\u003cp\u003e输出内容为：\u003c/p\u003e\n\n```\n[lenin@archer ~]$ openssl genrsa -des3 -out root.key\nGenerating RSA private key, 512 bit long modulus\n.................++++++++++++\n..++++++++++++\ne is 65537 (0x10001)\nEnter pass phrase for root.key:                ← 输入一个新密码\nVerifying - Enter pass phrase for root.key:    ← 重新输入一遍密码\n```\n\n\u003cp\u003e2. 创建根证书的申请文件\u003cstrong\u003eroot.req\u003c/strong\u003e：\u003c/p\u003e\n\n```\nopenssl req -new -key root.key -out root.req\n```\n\n\u003cp\u003e输出内容为：\u003c/p\u003e\n\n```\n[lenin@archer ~]$ openssl req -new -key root.key -out root.req\nEnter pass phrase for root.key:                                              ← 输入前面创建的密码\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:CN                                         ← 国家代号，中国输入CN\nState or Province Name (full name) [Some-State]:BeiJing                      ← 省的全名，拼音\nLocality Name (eg, city) []:BeiJing                                          ← 市的全名，拼音\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp.   ← 公司英文名\nOrganizational Unit Name (eg, section) []:                                   ← 可以不输入\nCommon Name (eg, YOUR name) []:                                              ← 此时不输入\nEmail Address []:admin@mycompany.com                                         ← 电子邮箱，可随意填\u003c/p\u003e","title":"SSL证书生成方法"},{"content":"PHP最大的特点在于它拥有一个丰富、灵活、强大的函数库，因此得以机动灵活成为软件开发语言中的轻骑兵。\nphp.js是一个用Javascript实现的函数库，它试图用Javascript最大程度地重写PHP的函数库。相对于JQuery、ExtJS这些Javascript库，php.js不并致力于为AJAX、DOM和界面开发提供一揽子解决方案，它只是将PHP函数的强大和简便带到前端开发中来，由于JQuery这样的库并不旨在提供完全的Javascript开发标准和手段，实际上，它弥补了这些高端的工具库与低端的Javascript开发之间的一个空白。\n对于熟悉PHP的人尤其是PHP程序员来说，使用php.js是几乎不需要切换思维方式的。\n这是使用php实现的日期格式校验函数：\n```php function IsValidDate($strDate, $strFormat='Y-m-d') { $strDate = trim($strDate); $unixTime = strtotime($strDate); $strNewDate = date($strFormat, $unixTime); return $strDate == $strNewDate; } ``` 这是使用php.js实现的日期格式校验函数：\n```javascript function IsValidDate(strDate, strFormat) { strDate = trim(strDate); var unixTime = strtotime(strDate); var strNewDate = date(strFormat, unixTime); return strDate == strNewDate; } ``` ","permalink":"http://0x3f.org/posts/phpjs/","summary":"\u003cp\u003ePHP最大的特点在于它拥有一个丰富、灵活、强大的函数库，因此得以机动灵活成为软件开发语言中的轻骑兵。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://phpjs.org/\"\u003ephp.js\u003c/a\u003e是一个用Javascript实现的函数库，它试图用Javascript最大程度地重写PHP的函数库。相对于JQuery、ExtJS这些Javascript库，php.js不并致力于为AJAX、DOM和界面开发提供一揽子解决方案，它只是将PHP函数的强大和简便带到前端开发中来，由于JQuery这样的库并不旨在提供完全的Javascript开发标准和手段，实际上，它弥补了这些高端的工具库与低端的Javascript开发之间的一个空白。\u003c/p\u003e\n\n\u003cp\u003e对于熟悉PHP的人尤其是PHP程序员来说，使用php.js是几乎不需要切换思维方式的。\u003c/p\u003e\n\n\u003cp\u003e这是使用php实现的日期格式校验函数：\u003c/p\u003e\n\n\u003cp\u003e\n```php\nfunction IsValidDate($strDate, $strFormat='Y-m-d') {\n    $strDate = trim($strDate);\n    $unixTime = strtotime($strDate);\n    $strNewDate = date($strFormat, $unixTime);\n    return $strDate == $strNewDate;\n}\n```\n\u003c/p\u003e\n\n\u003cp\u003e这是使用php.js实现的日期格式校验函数：\u003c/p\u003e\n\n\u003cp\u003e\n```javascript\nfunction IsValidDate(strDate, strFormat) {\n    strDate = trim(strDate);\n    var unixTime = strtotime(strDate);\n    var strNewDate = date(strFormat, unixTime);\n    return strDate == strNewDate;\n}\n```\n\u003c/p\u003e","title":"强大的工具函数库：php.js"},{"content":"\n《The Pragmatic Programmer》是本好书，虽然中文译名极为恶俗。为践行书中提到的DRY原则，我开始反思平时编码时总是重复出现的问题，其中之一就是很低级的语法错误，有时忘了语句最后的分号，有时忘了声明变量，凡此种种，不一而足。\n相对于IDE，我更喜欢Vim，这也是语法错误没有检查出来的原因。因此就产生了给Vim添加语法检查功能的需求。下面是检查PHP代码的vimrc内容：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026#34; Check the syntax of a PHP file function! CheckPHPSyntax() if \u0026amp;filetype != \u0026#39;php\u0026#39; echohl WarningMsg | echo \u0026#39;This is not a PHP file !\u0026#39; | echohl None return endif setlocal makeprg=php\\ -l\\ -n\\ -d\\ html_errors=off\\ % setlocal errorformat=%m\\ in\\ %f\\ on\\ line\\ %l echohl WarningMsg | echo \u0026#39;Syntax checking output:\u0026#39; | echohl None if \u0026amp;modified == 1 silent write endif silent make clist endfunction au filetype php map \u0026lt;F5\u0026gt; :call CheckPHPSyntax()\u0026lt;CR\u0026gt; au filetype php imap \u0026lt;F5\u0026gt; \u0026lt;ESC\u0026gt;:call CheckPHPSyntax()\u0026lt;CR\u0026gt; 以上脚本为Vim添加了一个检查PHP语法错误的函数和两个快捷键映射，此后可按F5键即时检查当前Buffer中的PHP当面的语法。和网上其它同类的函数相比，这个函数的优点在于改进了检查结果的显示，使用silent命令隐藏了所有不必要的输出。\n以下是检查Python代码语法错误的脚本：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026#34; Check the syntax of a python file function! CheckPythonSyntax() if \u0026amp;filetype != \u0026#39;python\u0026#39; echohl WarningMsg | echo \u0026#39;This is not a Python file !\u0026#39; | echohl None return endif setlocal makeprg=python\\ -u\\ % set efm=%C\\ %.%#,%A\\ \\ File\\ \\\u0026#34;%f\\\u0026#34;\\\\,\\ line\\ %l%.%#,%Z%[%^\\ ]%\\\\@=%m echohl WarningMsg | echo \u0026#39;Syntax checking output:\u0026#39; | echohl None if \u0026amp;modified == 1 silent write endif exec \u0026#34;silent make -c \\\u0026#34;import py_compile;py_compile.compile(r\u0026#39;\u0026#34;.bufname(\u0026#34;%\u0026#34;).\u0026#34;\u0026#39;)\\\u0026#34;\u0026#34; clist endfunction au filetype python map \u0026lt;F5\u0026gt; :call CheckPythonSyntax()\u0026lt;CR\u0026gt; au filetype python imap \u0026lt;F5\u0026gt; \u0026lt;ESC\u0026gt;:call CheckPythonSyntax()\u0026lt;CR\u0026gt; 上面两部分的配置脚本中虽然都指定了使用F5检查代码语法，但由于使用了 au filetype 指定了相应的语言类型，因此没有冲突。\n和PHP相比，Python似乎更受垂青，因为除了上面和PHP一样的语法检查方式，它还有令人惊艳的PyFlakes （见脚注 1 ）。\nPyFlakes的意思是 Make on the fly ，与另一神器Emacs的Flymake遥相呼应。只需要举出PyFlakes的两三个特性，就足以说明这是怎样的一个尤物了：其一是实时和高效，PyFlakes会在输入代码的同时检查语法错误，而且用户丝毫感觉不到任何停顿（对于游戏玩家或高清电影狂可能“卡”更好理解）；其二是智能，它居然能检查出哪些导入的模块没有被使用，哪些被使用的模块没有被导入；其三，PyFlakes检查出语法错误后会使用红色波浪线标识出错误位置。它使Vim完成了一个华丽的转身。\n此外，由于PyFlakes是通过解析代码来检查语法错误，因此不必担心代码会被实际执行。\n需要说明的是，PyFlakes要求Vim在编译时启用了对Python的支持，这一点可以使用 :ver 命令查看，一般各Linux发行版自带的Vim都加入了这个特性，而Windows下的版本没有此特性的可能性较大，好在作者提供了加入Python特性的Vim的Windows编译版。\n既然事已如此，不妨一不做、二不休，为Vim加上即时执行代码的功能。这个想法由来已久，出于和寻找 phpsh 同样的原因，我希望能在Vim中临时输入小块代码，然后即时执行并查看结果；或者即时执行正在编写的Python模块或程序。以下脚本实现了随手打开一个新的分割窗口并创建一个临时的脚本文件的功能：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026#34; Open a temporary PHP file in a new window function! PHPSandBox() let tmpfile = tempname().\u0026#39;.php\u0026#39; exe \u0026#39;new \u0026#39;.tmpfile call setline(\u0026#39;.\u0026#39;, \u0026#39;\u0026lt;?php\u0026#39;) normal o normal o call setline(\u0026#39;.\u0026#39;, \u0026#39;?\u0026gt;\u0026#39;) normal k startinsert endfunction \u0026#34; Open a temporary Python file in a new window function! PySandBox() let tmpfile = tempname().\u0026#39;.py\u0026#39; exe \u0026#39;new \u0026#39;.tmpfile call setline(\u0026#39;.\u0026#39;, \u0026#39;#!/usr/bin/python\u0026#39;) normal o call setline(\u0026#39;.\u0026#39;, \u0026#39;# -*- coding: utf-8 -*-\u0026#39;) normal o startinsert endfunction nmap \u0026lt;leader\u0026gt;sbpy :call PySandBox()\u0026lt;CR\u0026gt; nmap \u0026lt;leader\u0026gt;sbph :call PHPSandBox()\u0026lt;CR\u0026gt; 下面的脚本则实现了即时执行当前Buffer中代码的功能：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 \u0026#34; Run a PHP script function! ExecutePHPScript() if \u0026amp;filetype != \u0026#39;php\u0026#39; echohl WarningMsg | echo \u0026#39;This is not a PHP file !\u0026#39; | echohl None return endif setlocal makeprg=php\\ -f\\ % setlocal errorformat=%m\\ in\\ %f\\ on\\ line\\ %l echohl WarningMsg | echo \u0026#39;Execution output:\u0026#39; | echohl None if \u0026amp;modified == 1 silent write endif silent make clist endfunction au filetype php map \u0026lt;C-F5\u0026gt; :call ExecutePHPScript()\u0026lt;CR\u0026gt; au filetype php imap \u0026lt;C-F5\u0026gt; \u0026lt;ESC\u0026gt;:call ExecutePHPScript()\u0026lt;CR\u0026gt; \u0026#34; Run a python script function! ExecutePythonScript() if \u0026amp;filetype != \u0026#39;python\u0026#39; echohl WarningMsg | echo \u0026#39;This is not a Python file !\u0026#39; | echohl None return endif setlocal makeprg=python\\ -u\\ % set efm=%C\\ %.%#,%A\\ \\ File\\ \\\u0026#34;%f\\\u0026#34;\\\\,\\ line\\ %l%.%#,%Z%[%^\\ ]%\\\\@=%m echohl WarningMsg | echo \u0026#39;Execution output:\u0026#39; | echohl None if \u0026amp;modified == 1 silent write endif silent make clist endfunction au filetype python map \u0026lt;C-F5\u0026gt; :call ExecutePythonScript()\u0026lt;CR\u0026gt; au filetype python imap \u0026lt;C-F5\u0026gt; \u0026lt;ESC\u0026gt;:call ExecutePythonScript()\u0026lt;CR\u0026gt; **Foot Note 1 **:\nPyFlakes本身是个通用的工具，其作者提供了一个Vim的插件调用PyFlakes的功能，故此处所说的PyFlakes实指Vim的PyFlakes插件。\n","permalink":"http://0x3f.org/posts/syntax-checking-and-code-executing-in-vim/","summary":"\u003cp\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/SaV494hGreI/AAAAAAAAAzY/xExf7CzGyv0/s800/the-mug-of-vi.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e《\u003ca href=\"http://www.pragprog.com/the-pragmatic-programmer\"\u003eThe Pragmatic Programmer\u003c/a\u003e》是本好书，虽然中文译名极为恶俗。为践行书中提到的\u003ca href=\"http://en.wikipedia.org/wiki/Don't_repeat_yourself\"\u003eDRY原则\u003c/a\u003e，我开始反思平时编码时总是重复出现的问题，其中之一就是很低级的语法错误，有时忘了语句最后的分号，有时忘了声明变量，凡此种种，不一而足。\u003c/p\u003e\n\u003cp\u003e相对于IDE，我更喜欢Vim，这也是语法错误没有检查出来的原因。因此就产生了给Vim添加语法检查功能的需求。下面是检查PHP代码的vimrc内容：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-vim\" data-lang=\"vim\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026#34; Check the syntax of a PHP file\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"nx\"\u003eCheckPHPSyntax\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u0026amp;\u003cspan class=\"k\"\u003efiletype\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;php\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eechohl\u003c/span\u003e \u003cspan class=\"nx\"\u003eWarningMsg\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;This is not a PHP file !\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003eechohl\u003c/span\u003e \u003cspan class=\"nx\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003esetlocal\u003c/span\u003e \u003cspan class=\"nx\"\u003emakeprg\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\\ \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003el\u003c/span\u003e\\ \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003en\u003c/span\u003e\\ \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\\ \u003cspan class=\"nx\"\u003ehtml_errors\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003eoff\u003c/span\u003e\\ %\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003esetlocal\u003c/span\u003e \u003cspan class=\"nx\"\u003eerrorformat\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e%\u003cspan class=\"nx\"\u003em\u003c/span\u003e\\ \u003cspan class=\"nx\"\u003ein\u003c/span\u003e\\ %\u003cspan class=\"nx\"\u003ef\u003c/span\u003e\\ \u003cspan class=\"nx\"\u003eon\u003c/span\u003e\\ \u003cspan class=\"nx\"\u003eline\u003c/span\u003e\\ %\u003cspan class=\"nx\"\u003el\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eechohl\u003c/span\u003e \u003cspan class=\"nx\"\u003eWarningMsg\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Syntax checking output:\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003eechohl\u003c/span\u003e \u003cspan class=\"nx\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u0026amp;\u003cspan class=\"nx\"\u003emodified\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003esilent\u003c/span\u003e \u003cspan class=\"nx\"\u003ewrite\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003esilent\u003c/span\u003e \u003cspan class=\"nx\"\u003emake\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eclist\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eendfunction\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"k\"\u003efiletype\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"k\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eF5\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e :\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eCheckPHPSyntax\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eau\u003c/span\u003e \u003cspan class=\"k\"\u003efiletype\u003c/span\u003e \u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003eimap\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eF5\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eESC\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e:\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e \u003cspan class=\"nx\"\u003eCheckPHPSyntax\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eCR\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e以上脚本为Vim添加了一个检查PHP语法错误的函数和两个快捷键映射，此后可按F5键即时检查当前Buffer中的PHP当面的语法。和网上其它同类的函数相比，这个函数的优点在于改进了检查结果的显示，使用silent命令隐藏了所有不必要的输出。\u003c/p\u003e","title":"在Vim中检查语法和执行代码"},{"content":"发现这个图标主题有段时间了，但直到今天偶然重新启用它，才突然觉得这套色调灰暗、风格搞怪的图标其实整体效果很好，很有个性，且极为闷骚，实为标榜非主流人士居家旅行必备。\n","permalink":"http://0x3f.org/posts/buuf-deuce-icon-theme/","summary":"\u003cp\u003e发现这个\u003ca href=\"http://djany.deviantart.com/art/Gnome-Buuf-Deuce-1-1-R8-73339997\"\u003e图标主题\u003c/a\u003e有段时间了，但直到今天偶然重新启用它，才突然觉得这套色调灰暗、风格搞怪的图标其实整体效果很好，很有个性，且极为闷骚，实为标榜非主流人士居家旅行必备。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/dGjc_mAUv2rQOLRDLlUZKw?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/S8CQfF_kpbI/AAAAAAAABZ8/UV3W7nTx3vA/s800/Gnome_Buuf_Deuce_1_1_R8_by_djany.jpg\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"Buuf-Deuce：搞怪的图标主题"},{"content":"Archlinux下的GNOME升级到2.30后，若启用了Compiz，则光标主题只能使用X默认的主题，无法自定义。尚不清楚是GNOME新版本自身的问题还是仅限于Arch发行版。\n在官方提供解决方案或更新之前，可以先使用Xdefault或Xresource文件实现。\n以后者为例，编辑用户主目录下的.Xresource，在文件最后添加如下内容：\nXcursor.theme: faber-anthracite-shd-m\nfaber-anthracite-sdh-m是我使用的光标主题的文件夹名。\n然后执行如下命令：\nxrdb ~/.Xresource\n最后注销并重新登录即可。\n","permalink":"http://0x3f.org/posts/problem-about-icon-theme-on-gnome230/","summary":"\u003cp\u003eArchlinux下的GNOME升级到2.30后，若启用了Compiz，则光标主题只能使用X默认的主题，无法自定义。尚不清楚是GNOME新版本自身的问题还是仅限于Arch发行版。\u003c/p\u003e\n\n\u003cp\u003e在官方提供解决方案或更新之前，可以先使用Xdefault或Xresource文件实现。\u003c/p\u003e\n\n\u003cp\u003e以后者为例，编辑用户主目录下的\u003cstrong\u003e.Xresource\u003c/strong\u003e，在文件最后添加如下内容：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eXcursor.theme: faber-anthracite-shd-m\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cstrong\u003efaber-anthracite-sdh-m\u003c/strong\u003e是我使用的光标主题的文件夹名。\u003c/p\u003e\n\n\u003cp\u003e然后执行如下命令：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003exrdb ~/.Xresource\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e最后注销并重新登录即可。\u003c/p\u003e","title":"Archlinux升级到GNOME2.30后的光标主题问题"},{"content":"时常需要测试一些简短的代码是否能得到需要的结果，如果去写测试脚本再执行，显然太麻烦。虽然PHP自身也支持通过-a参数启动交互模式，但功能较为局限。如果PHP有像bpython那样的交互式解释器，就太好了。\nphpsh就是这样一个工具，它是由facebook的开发者用Python实现的PHP的交互式解释器，并具备以下特性：\n命令行历史回溯 tab键自动补全 快速文档索引 ","permalink":"http://0x3f.org/posts/phpsh/","summary":"\u003cp\u003e时常需要测试一些简短的代码是否能得到需要的结果，如果去写测试脚本再执行，显然太麻烦。虽然PHP自身也支持通过\u003cstrong\u003e\u003cem\u003e-a\u003c/em\u003e\u003c/strong\u003e参数启动交互模式，但功能较为局限。如果PHP有像\u003ca href=\"http://bpython-interpreter.org/\"\u003ebpython\u003c/a\u003e那样的交互式解释器，就太好了。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://www.phpsh.org/\"\u003ephpsh\u003c/a\u003e就是这样一个工具，它是由\u003ca href=\"http://zh.wikipedia.org/wiki/Facebook\"\u003efacebook\u003c/a\u003e的开发者用Python实现的PHP的交互式解释器，并具备以下特性：\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e命令行历史回溯\u003c/li\u003e\n\u003cli\u003etab键自动补全\u003c/li\u003e\n\u003cli\u003e快速文档索引\u003c/li\u003e\n\u003c/ol\u003e","title":"phpsh：PHP的交互式解释器"},{"content":"cx_Freeze打包Python程序的命令基本格式如下：\n```python cxfreeze main.py --target-dir appdir ``` 它表示把脚本main.py或以main.py为程序入口的程序打包并导出到当前路径中名为appdir的目录中。\n对于Windows下的GUI应用程序，以上面的命令导出后，运行时会弹出cmd命令行的黑窗口，须加上如下命令中的参数：\n```python cxfreeze main.py --target-dir appdir --base-name=win32gui ``` 对于比较复杂的程序，cx_Freeze支持distutils格式的打包脚本，当然，彼此之间在引入的模块和支持的参数上还是有差别的。\ncx_Freeze的文档中有其支持的全部命令参数及说明，写到setup.py脚本中时，所有参数中的-符号应换成下划线。\n我的setup.py内容大致如下：\n```python #!/usr/bin/python # -*- coding: utf-8 -*- from cx_Freeze import setup,Executable includefiles = [('settings.ini.jctest','settings.ini') ,'README.mkd'] includes = [] excludes = ['Tkinter'] packages = ['sqlalchemy.engine', 'sqlalchemy.orm', 'sqlalchemy.dialects.mssql'] setup( name = 'pyutil', version = '0.1', description = 'A general enhancement utility for XXX', author = 'Lenin Lee', author_email = 'lenin.lee@xxx.com', options = {'build_exe':{'excludes':excludes,'packages':packages,'include_files':includefiles}}, executables = [Executable('jcitk.py') , Executable('jcvfd.py') , Executable('jcvdupcr.py') , Executable('jcddupcr.py') , Executable('jcclostfd.py') , Executable('jcvcard.py') , Executable('jcvcardii.py') , Executable('jcclostsoid.py')] ) ``` 在摸索如何写setup.py的过程中，遇到一些问题。\n首先是如何将配置文件settings.ini自动复制到打包文件夹中。这个问题的解决办法是使用build_exe命令的参数include_files。此参数的值是一个列表，列表的每一项可以是一个表示要复制的文件的路径的字符串，或者是一个tuple。若是tuple，第一个元素是表示要复制的文件的路径，第二个元素是表示复制后要修改成的文件名。需要说明的是，文件夹可以和文件一样使用这样的方法复制到打包文件夹中。\n其次，在打包引入了SQLAlchemy的程序后，若运行该程序时报某模块导入失败的错，应将报错信息中提示的模块所在的包填写到packages参数中。虽然也可以在程序中import这些包，但是在setup.py中使用packages参数的做法更合理。而且如果在程序中导入了没有被显式调用的模块或包的话，对于使用pyflakes检查语法错误的环境，会显示模块或包未被调用的警告，至少看起来不舒服。\n再次，Windows下打包时应使用python 2.5，因为2.6版本需要Microsoft Visual C++ 2008 Redistributable，一般非开发环境的系统中都没安装这个，运行程序时就会报错。\n","permalink":"http://0x3f.org/posts/cx-freeze/","summary":"\u003cp\u003ecx_Freeze打包Python程序的命令基本格式如下：\u003c/p\u003e\n\n\u003cp\u003e\n```python\ncxfreeze main.py --target-dir appdir\n```\n\u003c/p\u003e\n\n\u003cp\u003e它表示把脚本main.py或以main.py为程序入口的程序打包并导出到当前路径中名为\u003cstrong\u003eappdir\u003c/strong\u003e的目录中。\u003c/p\u003e\n\n\u003cp\u003e对于Windows下的GUI应用程序，以上面的命令导出后，运行时会弹出\u003cstrong\u003ecmd\u003c/strong\u003e命令行的黑窗口，须加上如下命令中的参数：\u003c/p\u003e\n\n\u003cp\u003e\n```python\ncxfreeze main.py --target-dir appdir --base-name=win32gui\n```\n\u003c/p\u003e\n\n\u003cp\u003e对于比较复杂的程序，cx_Freeze支持\u003ca href=\"http://www.ibm.com/developerworks/cn/linux/sdk/python/charm-19/\"\u003edistutils\u003c/a\u003e格式的打包脚本，当然，彼此之间在引入的模块和支持的参数上还是有差别的。\u003c/p\u003e\n\n\u003cp\u003ecx_Freeze的文档中有其支持的全部命令参数及说明，写到setup.py脚本中时，所有参数中的\u003cstrong\u003e-\u003c/strong\u003e符号应换成下划线。\u003c/p\u003e\n\n\u003cp\u003e我的setup.py内容大致如下：\u003c/p\u003e\n\n\u003cp\u003e\n```python\n#!/usr/bin/python\n# -*- coding: utf-8 -*-\nfrom cx_Freeze import setup,Executable\n\nincludefiles = [('settings.ini.jctest','settings.ini')\n        ,'README.mkd']\nincludes = []\nexcludes = ['Tkinter']\npackages = ['sqlalchemy.engine', 'sqlalchemy.orm', 'sqlalchemy.dialects.mssql']\n\nsetup(\n    name = 'pyutil',\n    version = '0.1',\n    description = 'A general enhancement utility for XXX',\n    author = 'Lenin Lee',\n    author_email = 'lenin.lee@xxx.com',\n    options = {'build_exe':{'excludes':excludes,'packages':packages,'include_files':includefiles}},\n    executables = [Executable('jcitk.py')\n        , Executable('jcvfd.py')\n        , Executable('jcvdupcr.py')\n        , Executable('jcddupcr.py')\n        , Executable('jcclostfd.py')\n        , Executable('jcvcard.py')\n        , Executable('jcvcardii.py')\n        , Executable('jcclostsoid.py')]\n)\n```\n\u003c/p\u003e","title":"使用cx_Freeze的distutils脚本打包Python程序"},{"content":"前年买了个倒把小西施开始喝茶，渐渐地就觉得喝茶的趣味一半在茶，一半在泡。这周买了茶盘、茶道组等一应物件儿，直到周五晚上才有时间过把瘾。怕睡不着觉，没敢泡生茶，新开了一饼易武大树熟茶。\n","permalink":"http://0x3f.org/posts/starting-tea-ceremony/","summary":"\u003cp\u003e前年买了个倒把小西施开始喝茶，渐渐地就觉得喝茶的趣味一半在茶，一半在泡。这周买了茶盘、茶道组等一应物件儿，直到周五晚上才有时间过把瘾。怕睡不着觉，没敢泡生茶，新开了一饼易武大树熟茶。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/2OI8UYBIqMUejiDCtL3JKg?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/S6OqNZV5xgI/AAAAAAAABVg/nipIKJWV6xk/s400/%E8%8C%B6%E9%81%93%20002.JPG\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"开始玩儿茶道"},{"content":"前段时间工作中遇到的一个需求，要求计算两个日期之间工作日的数量，即排除期间所有的周六和周日之后的天数。\n在网上找到一个自定义函数，原函数有些小问题，例如如果传入的截止日期如果有时间且足够大，则计算结果可能出错，修正后代码如下：\n```sql --函数：类似datediff，不统计期间所有的周六和周日 if exists (select * from dbo.sysobjects where id=object_id(N'[dbo].[f_WorkDay]') and xtype in (N'FN',N'IF',N'TF')) drop function [dbo].[f_WorkDay] GO CREATE FUNCTION f_WorkDay( @dt_begin datetime, @dt_end datetime )RETURNS int AS BEGIN DECLARE @workday int,@i int,@bz bit,@dt datetime set @dt_begin = convert(datetime, convert(nvarchar(32), @dt_begin, 23)) set @dt_end = convert(datetime, convert(nvarchar(32), @dt_end, 23)) IF @dt_begin\u003e@dt_end SELECT @bz=1,@dt=@dt_begin,@dt_begin=@dt_end,@dt_end=@dt ELSE SET @bz=0 SELECT @i=DATEDIFF(Day,@dt_begin,@dt_end),@workday=@i/7*5,@dt_begin=DATEADD(Day,@i/7*7,@dt_begin) WHILE @dt_begin\u003c@dt_end BEGIN SELECT @workday=CASE WHEN (@@DATEFIRST+DATEPART(Weekday,@dt_begin)-1)%7 BETWEEN 1 AND 5 THEN @workday+1 ELSE @workday END,@dt_begin=@dt_begin+1 END RETURN(CASE WHEN @bz=1 THEN -@workday ELSE @workday END) END GO ``` 此函数的原理是，使用datediff计算两日期之间的差值A，然后取A与7的商，即计算期间内有几个整周。然后使用这个商与5相乘，得到所有整周内的工作日天数B。接着，使用A除以7再乘以7得到C，这就约去了A中最后不到一个整周的天数。再在起始日期的基础上加上C，得到一个新的起始日期，然后从这个新的起始日期开始遍历至截止日期的每一天，每增加一天，判断若此日期是工作日，则在C的基础上累加一。判断一个日期（假设使用@dt_begin表示）是否是工作日的方法是：(@@datefirst+datepart(Weekday, @dt_begin)-1)%7的值在1和5之间。\n此外还有一个需求是计算两个日期之间排除最后一个周六周日后的天数，仿照上面的函数实现了一个新函数，现在想来，有点儿把问题复杂化了，完全可以直接从后往前推的。\n```sql --函数：类似datediff，不统计截止日期@dt_end前最近一次的周六和周日，若dt_end是周日，则不统计其前面的那个周六。 if exists (select * from dbo.sysobjects where id=object_id(N'[dbo].[f_WorkDayOnce]') and xtype in (N'FN',N'IF',N'TF')) drop function [dbo].[f_WorkDayOnce] GO CREATE FUNCTION f_WorkDayOnce( @dt_begin datetime, @dt_end datetime )RETURNS int AS BEGIN DECLARE @day_count int,@weekday int,@weekend_dropped int,@i int,@bz bit,@dt datetime set @dt_begin = convert(datetime, convert(nvarchar(32), @dt_begin, 23)) set @dt_end = convert(datetime, convert(nvarchar(32), @dt_end, 23)) IF @dt_begin\u003e@dt_end SELECT @bz=1,@dt=@dt_begin,@dt_begin=@dt_end,@dt_end=@dt ELSE SET @bz=0 SELECT @i=DATEDIFF(Day,@dt_begin,@dt_end),@weekday=(@@datefirst+datepart(weekday,@dt_end)-1)%7,@day_count=@i,@weekend_dropped=0 if @i=0 set @day_count=0 else begin if @weekday=0 set @day_count=@i-1 else begin while @dt_begin\u003c@dt_end and @weekend_dropped\u003c2 begin select @weekend_dropped=@weekend_dropped+(case when (@@datefirst+datepart(weekday,@dt_begin)-1)%7 between 1 and 5 then 0 else 1 end),@dt_begin=@dt_begin+1 end select @day_count=@day_count-@weekend_dropped end end RETURN(CASE WHEN @bz=1 THEN -@day_count ELSE @day_count END) END GO ``` ","permalink":"http://0x3f.org/posts/counting-days-between-dates-in-sqlserver/","summary":"\u003cp\u003e前段时间工作中遇到的一个需求，要求计算两个日期之间工作日的数量，即排除期间所有的周六和周日之后的天数。\u003c/p\u003e\n\n\u003cp\u003e在网上找到一个自定义函数，原函数有些小问题，例如如果传入的截止日期如果有时间且足够大，则计算结果可能出错，修正后代码如下：\u003c/p\u003e\n\n\u003cp\u003e\n```sql\n--函数：类似datediff，不统计期间所有的周六和周日\nif exists (select * from dbo.sysobjects where id=object_id(N'[dbo].[f_WorkDay]') and xtype in (N'FN',N'IF',N'TF')) \ndrop function [dbo].[f_WorkDay] \nGO\n\nCREATE FUNCTION f_WorkDay(\n@dt_begin   datetime,\n@dt_end     datetime \n)RETURNS int \nAS \nBEGIN \n    DECLARE @workday int,@i int,@bz bit,@dt datetime \n\n    set @dt_begin = convert(datetime, convert(nvarchar(32), @dt_begin, 23))\n    set @dt_end = convert(datetime, convert(nvarchar(32), @dt_end, 23))    \n\n    IF @dt_begin\u003e@dt_end \n        SELECT @bz=1,@dt=@dt_begin,@dt_begin=@dt_end,@dt_end=@dt \n    ELSE \n        SET @bz=0 \n\n    SELECT @i=DATEDIFF(Day,@dt_begin,@dt_end),@workday=@i/7*5,@dt_begin=DATEADD(Day,@i/7*7,@dt_begin) \n\n    WHILE @dt_begin\u003c@dt_end \n    BEGIN \n        SELECT @workday=CASE WHEN (@@DATEFIRST+DATEPART(Weekday,@dt_begin)-1)%7 BETWEEN 1 AND 5 THEN @workday+1 ELSE @workday END,@dt_begin=@dt_begin+1 \n    END \n\n    RETURN(CASE WHEN @bz=1 THEN -@workday ELSE @workday END) \nEND \nGO\n```\n\u003c/p\u003e","title":"SQL Server的自定义函数：统计两日期之间工作日的数量"},{"content":"春节前的一段时间，重新拾起近一年没动过的ForeverFantasy。\n虽然一年内没什么更新，但是我却一直都在用，基本上只限于将用Vim写好的Markdown格式的文档转换成HTML。\n重写了相当一部分代码，较大程度地改变了界面布局，突然发现经过一年的沉淀，对wxPython的理解增进了不少，开发起来比起去年这个时候清楚了很多。\n这些天来一直坚持着每天或多或少的做一些，如果说有什么主要的进展的话，那就是界面的重构，以及昨天实现了调用Vim编辑文档并回收文档内容的功能。\nForeverFantasy和Vim协同的一个最大的问题就是如何判断Vim已经退出。Python调用外部程序的方法有很多，比如传统的commands模块、os.system()等，subprocess是致力于替代这些旧有的方式的一个模块，它的一个特点是可以在启动一个外部程序作为子进程后还能监控这个进程的运行状态。这为ForeverFantasy在Vim退出后回收文档内容提供了更简捷的途径。\n下面的代码可以说明如何使用subprocess运行外部程序并监控运行状态：\n```python import subprocess process = subprocess.Popen('gvim', shell=True) status = process.poll() if 0 == status: print 'The external program exited.' if status is None: print 'The external program is still running.' ``` 理论上，可以拿实例process的poll()方法监视进程的运行状态，而且这一点在Windows上也确实可以做到，但是到了Linux下，诡异的事出现了，即使刚刚打开gvim，poll()方法也会马上返回一个0，同时process.pid的值总是和实际在运行的那个gvim进程的pid的值差3，而且在虚拟终端中输入gvim命令也不会阻塞终端，就像别的命令加上“\u0026amp;”符号的效果一样。尝试用strace跟踪gvim的运行，试图找到问题原因，无果。我猜想可能/usr/bin/gvim是一个跳板，它启动后会启动一个新的gvim进程。总之，这个方法在Linux下是行不通的。\n因此我觉得只能另寻出路了，既然不能监控gvim进程，那就监控gvim进程所编辑的文件，只要这个文件不被任何进程占用，就可以判定gvim已退出。这一点，在Linux下易如反掌，不用说，lsof当仁不让。\n用commands.getstatusoutput('lsof file.txt')测试发现，如果文件file.txt被某进程占用，则返回的状态值为0，反之，返回256。\n最终，我在程序中使用了两种判断方式，在Windows平台使用subprocess跟踪gvim.exe进程，而在Linux及Unix平台使用lsof检查文档占用情况。\n剩下的就是进行这个判断的时间问题了。\n很显然，如果在子进程被启动后马上使用while循环不停的检查，一来必须使用多线程，二来系统资源占用也会很高。这时就需要利用wxPython的事件机制了，当ForeverFantasy启动Gvim时，主窗口失去焦点，而当Gvim退出时，ForeverFantasy又会获得焦点，只要能在ForeverFantasy窗口获得焦点时做一次检查即可。不过，在选择最合适的事件的问题上，又是一波三折。\n在wxPython的API文档中没有找到事件列表，倒是在Wiki中找到了。顾名思义，觉得wx.EVT_SET_FOCUS比较靠谱，但试用失败，看API中关于FocusEvent的说明，这个事件适用于窗口控件；然后又试了wx.EVT_CHILD_FOCUS，只有在窗口包含的控件中有获得焦点的情况才会触发；最后才发现wx.EVT_ACTIVATE，这个事件会在窗口失去焦点和获得焦点时各触发一次，使用GetActive()方法可以判断是获得焦点还是失去焦点。\n完成与Vim的协同使ForeverFantasy在我手上由原来单纯的格式转换工具进化为基本可用的文档编辑器，就算是Milestone 2吧。\n此外，还有一些小的经验：\n1. 调用非环境变量下的程序，即命令中必须带程序所在的路径时，应当将程序所在目录的完整路径以自然字符串的形式传递给subprocess.Popen类的构造方法的cwd参数，即如下所示：\n```python process = subprocess.Popen('gvim.exe', cwd=r'C:\\program files\\vim\\vim72', shell=True) ``` 这样可以有效避免路径中的空格和特殊字符对命令执行的影响。\n2. Vim编辑一个文档时，实际操作的是一个临时文件，而不是原文件，这个临时文件与原文件同路径，名称为在原文件名的基础上，前面加一个句点，后面加后缀“.swp”。应该用lsof监控这个临时文件，才可以判断出编辑该文档的Vim进程的运行状态。由于对于不存在的文件使用lsof命令的返回值也是256，故可以同时判断临时文件和原文件的占用情况，这样就为对其它编辑器的支持奠定了基础。\n2010-03-10 Wednesday 22:52:13 更新\n感谢KL童鞋和依云童鞋指教，果然加上-f参数就可以了。\n","permalink":"http://0x3f.org/posts/supernatural-phenomenon-of-controlling-external-processes-in-python/","summary":"\u003cp\u003e春节前的一段时间，重新拾起近一年没动过的\u003ca href=\"http://0x3f.org/?tag=foreverfantasy\"\u003eForeverFantasy\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e虽然一年内没什么更新，但是我却一直都在用，基本上只限于将用Vim写好的\u003ca href=\"http://en.wikipedia.org/wiki/Markdown\"\u003eMarkdown\u003c/a\u003e格式的文档转换成HTML。\u003c/p\u003e\n\n\u003cp\u003e重写了相当一部分代码，较大程度地改变了界面布局，突然发现经过一年的沉淀，对\u003ca href=\"http://en.wikipedia.org/wiki/WxPython\"\u003ewxPython\u003c/a\u003e的理解增进了不少，开发起来比起去年这个时候清楚了很多。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/bNRGQr0g6aLuqDUm8EQ6mg?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh6.ggpht.com/_ceUJ_lBTHzc/S5UYPQmTAzI/AAAAAAAABUc/znMRxXuE8dE/s400/2010-03-08.23%3A27%3A03.%E5%B7%A5%E4%BD%9C%E5%8C%BA%201.01.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e这些天来一直坚持着每天或多或少的做一些，如果说有什么主要的进展的话，那就是界面的重构，以及昨天实现了调用Vim编辑文档并回收文档内容的功能。\u003c/p\u003e\n\n\u003cp\u003eForeverFantasy和Vim协同的一个最大的问题就是如何判断Vim已经退出。Python调用外部程序的方法有很多，比如传统的\u003ca href=\"http://docs.python.org/library/commands.html\"\u003ecommands\u003c/a\u003e模块、\u003ca href=\"http://docs.python.org/library/os.html\"\u003eos\u003c/a\u003e.system()等，\u003ca href=\"http://docs.python.org/library/subprocess.html\"\u003esubprocess\u003c/a\u003e是致力于替代这些旧有的方式的一个模块，它的一个特点是可以在启动一个外部程序作为子进程后还能监控这个进程的运行状态。这为ForeverFantasy在Vim退出后回收文档内容提供了更简捷的途径。\u003c/p\u003e\n\n\u003cp\u003e下面的代码可以说明如何使用subprocess运行外部程序并监控运行状态：\u003c/p\u003e\n\n\u003cp\u003e\n```python\nimport subprocess\nprocess = subprocess.Popen('gvim', shell=True)\nstatus = process.poll()\nif 0 == status:\n    print 'The external program exited.'\nif status is None:\n    print 'The external program is still running.'\n```\n\u003c/p\u003e\n\n\u003cp\u003e理论上，可以拿实例process的poll()方法监视进程的运行状态，而且这一点在Windows上也确实可以做到，但是到了Linux下，诡异的事出现了，即使刚刚打开gvim，poll()方法也会马上返回一个0，同时process.pid的值总是和实际在运行的那个gvim进程的pid的值差3，而且在虚拟终端中输入gvim命令也不会阻塞终端，就像别的命令加上“\u003cstrong\u003e\u0026amp;\u003c/strong\u003e”符号的效果一样。尝试用\u003ca href=\"http://en.wikipedia.org/wiki/Strace\"\u003estrace\u003c/a\u003e跟踪gvim的运行，试图找到问题原因，无果。我猜想可能/usr/bin/gvim是一个跳板，它启动后会启动一个新的gvim进程。总之，这个方法在Linux下是行不通的。\u003c/p\u003e\n\n\u003cp\u003e因此我觉得只能另寻出路了，既然不能监控gvim进程，那就监控gvim进程所编辑的文件，只要这个文件不被任何进程占用，就可以判定gvim已退出。这一点，在Linux下易如反掌，不用说，\u003ca href=\"http://en.wikipedia.org/wiki/Lsof\"\u003elsof\u003c/a\u003e当仁不让。\u003c/p\u003e\n\n\u003cp\u003e用\u003cstrong\u003ecommands.getstatusoutput('lsof file.txt')\u003c/strong\u003e测试发现，如果文件file.txt被某进程占用，则返回的状态值为0，反之，返回256。\u003c/p\u003e\n\n\u003cp\u003e最终，我在程序中使用了两种判断方式，在Windows平台使用subprocess跟踪gvim.exe进程，而在Linux及Unix平台使用lsof检查文档占用情况。\u003c/p\u003e\n\n\u003cp\u003e剩下的就是进行这个判断的时间问题了。\u003c/p\u003e\n\n\u003cp\u003e很显然，如果在子进程被启动后马上使用while循环不停的检查，一来必须使用多线程，二来系统资源占用也会很高。这时就需要利用wxPython的事件机制了，当ForeverFantasy启动Gvim时，主窗口失去焦点，而当Gvim退出时，ForeverFantasy又会获得焦点，只要能在ForeverFantasy窗口获得焦点时做一次检查即可。不过，在选择最合适的事件的问题上，又是一波三折。\u003c/p\u003e\n\n\u003cp\u003e在wxPython的\u003ca href=\"http://www.wxpython.org/docs/api/frames.html\"\u003eAPI\u003c/a\u003e文档中没有找到\u003ca href=\"http://wiki.wxpython.org/ListOfEvents\"\u003e事件列表\u003c/a\u003e，倒是在\u003ca href=\"http://wiki.wxpython.org\"\u003eWiki\u003c/a\u003e中找到了。顾名思义，觉得wx.EVT_SET_FOCUS比较靠谱，但试用失败，看API中关于FocusEvent的说明，这个事件适用于窗口控件；然后又试了wx.EVT_CHILD_FOCUS，只有在窗口包含的控件中有获得焦点的情况才会触发；最后才发现\u003cstrong\u003ewx.EVT_ACTIVATE\u003c/strong\u003e，这个事件会在窗口失去焦点和获得焦点时各触发一次，使用GetActive()方法可以判断是获得焦点还是失去焦点。\u003c/p\u003e\n\n\u003cp\u003e完成与Vim的协同使ForeverFantasy在我手上由原来单纯的格式转换工具进化为基本可用的文档编辑器，就算是\u003cstrong\u003eMilestone 2\u003c/strong\u003e吧。\u003c/p\u003e\n\n\u003cp\u003e此外，还有一些小的经验：\u003c/p\u003e\n\n\u003cp\u003e1. 调用非环境变量下的程序，即命令中必须带程序所在的路径时，应当将程序所在目录的完整路径以自然字符串的形式传递给subprocess.Popen类的构造方法的cwd参数，即如下所示：\u003c/p\u003e\n\n\u003cp\u003e\n```python\nprocess = subprocess.Popen('gvim.exe', cwd=r'C:\\program files\\vim\\vim72', shell=True)\n```\n\u003c/p\u003e\n\n\u003cp\u003e这样可以有效避免路径中的空格和特殊字符对命令执行的影响。\u003c/p\u003e\n\n\u003cp\u003e2. Vim编辑一个文档时，实际操作的是一个临时文件，而不是原文件，这个临时文件与原文件同路径，名称为在原文件名的基础上，前面加一个句点，后面加后缀“.swp”。应该用lsof监控这个临时文件，才可以判断出编辑该文档的Vim进程的运行状态。由于对于不存在的文件使用lsof命令的返回值也是256，故可以同时判断临时文件和原文件的占用情况，这样就为对其它编辑器的支持奠定了基础。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e2010-03-10 Wednesday 22:52:13 更新\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e感谢KL童鞋和依云童鞋指教，果然加上\u003cstrong\u003e-f\u003c/strong\u003e参数就可以了。\u003c/p\u003e","title":"Python控制外部进程的灵异事件"},{"content":"\n关于自动补全，最初用的是SuperTab，那个时候Vim的自动补全插件寥寥无几，也就SuperTab比较有名。不过实际使用过程中这个插件给我的体验不是很好，原因是补全的准确度不高。\n后来出了一个新插件，AutoComplPop，功能和使用都很简单。但是很快我就又用回SuperTab，原因是AutoComplPop在输入的同时实时地查询匹配的关键词，导致输入极不流畅，效率很低。\n一直就这么凑合着用着SuperTab，随着这个插件版本的更新，旧功能不断地完善，新功能也接二连三地引入，SuperTab在匹配关键词的准确度上有了一些改善，但是新的问题又出现了。SuperTab后来加入一个新功能，对于程序源文件，可以在其引入的文件以及API文件中匹配关键词。比如假设我当前正在编辑a.php，在a.php中有include 'b.php';这样的语句，当我输入array并按下Tab键时，SuperTab不但会在当前文件中查询所有匹配项，还会到b.php中查询，如果配置过vim、指定一个包含了php的API的文件，则SuperTab还会自动从这个文件中查询匹配项。按理说这个功能的理念很好，但问题就在于SuperTab做的是实时查询，如果源文件中包含的文件较多，各个文件又较大，问题就显而易见了。我不得不在写程序时小心地使用Tab键，否则有时就会出现按一下Tab键然后等着Vim在那狂搜的情况。\n前两天发现了NeoComplCache，光看名字就让我有点儿兴奋，一般使用缓存的速度都很快。这个插件会在Vim打开文件的时候对上下文作一个索引，并把索引结果保存到缓存中。同时，文件更改的内容会在保存的时候被索引。此外，NeoComplCache支持多种关键词索引模式，例如它会判断当前路径下的文件或目录的名字是否匹配补全条件，也可以从缓存的程序语言API中匹配补全条件。到此为止，它就解决了SuperTab和AutoComplPop共同的效率问题，并具备它们各自的长处。看了一遍文档，发现这个插件的功能比较细致，大概有以下一些特点：\n1、使用缓存，自动补全时效率高； 2、生成的关键词列表准确； 3、支持下划线分割的关键词，如apple_boy_cat，就可以只输入a_b_c，然后补全； 4、支持驼峰格式匹配关键词，如AppleBoyCat，就可以只输入ABC，然后补全； 5、既可以像AutoComplPop那样在Vim中输入的同时自动弹出补全列表，又可以自定义快捷键手动触发； 6、支持从文件名和目录名中匹配补全条件； 7、对于程序源文件，支持从语言API中匹配补全条件；\nNeoComplCache的缺点是文档不全，虽然从只言片语中发现它还支持Snippet，但从文档中没有找到足够的有用信息。加之一直用SnipMate感觉不错，所以目前还是用它来实现snippet功能。\n这就有个搭配问题：虽然NeoComplCache不存在补全时的效率问题，但我仍然打算只在需要补全时才用快捷键触发此功能，最主要的原因是我既希望用Tab键触发SnipMate的代码块补全功能，又希望修SuperTab那样用Tab选择补全列表中的选项。也就是要达到只用Tab键就可以完成打开自动补全列表、补全列表选项选择和SnipMate代码块替换的效果。但是，如果将Tab映射到触发自动补全，则补全列表选择和SnipMate均无法使用Tab，反之亦然。\n所以我想如果能让NeoComplCache、SuperTab、SnipMate和谐共存，那问题就解决了，几经摸索，终于找到了办法：\n1、设置NeoComplCache不自动弹出补全列表，即在vimrc中加入：\nlet g:NeoComplCache_DisableAutoComplete = 1\n2、由于NeoComplCache在手工模式下使用快捷键组合\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;打开补全列表，故设置SuperTab的默认补全操作为\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;，即在vimrc中加入：\nlet g:SuperTabDefaultCompletionType = '\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;'\n这样，NeoComplCache只负责补全关键词缓存的生成，SuperTab控制Tab键的行为并在需要触发补全操作时打开补全列表、进而在列表中的选项间移动焦点，而当光标前的关键词是snippet时，SnipMate会被优先调用并完成代码块的替换。\n就在写这篇文章的时候，我突然觉得NeoComplCache自动弹出补全列表+SnipMate的方式也挺好，只是这样就不能用Tab键选择列表中的选项了。\n相关阅读： 用neocomplete换掉了YouCompleteMe How to Make YouCompleteMe Compatible with UltiSnips ","permalink":"http://0x3f.org/posts/neocomplcache-vim/","summary":"\u003cp\u003e\u003cimg src=\"http://lh3.ggpht.com/_ceUJ_lBTHzc/SaV494hGreI/AAAAAAAAAzY/xExf7CzGyv0/s800/the-mug-of-vi.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e关于自动补全，最初用的是\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=1643\"\u003eSuperTab\u003c/a\u003e，那个时候Vim的自动补全插件寥寥无几，也就SuperTab比较有名。不过实际使用过程中这个插件给我的体验不是很好，原因是补全的准确度不高。\u003c/p\u003e\n\u003cp\u003e后来出了一个新插件，\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=1879\"\u003eAutoComplPop\u003c/a\u003e，功能和使用都很简单。但是很快我就又用回SuperTab，原因是AutoComplPop在输入的同时实时地查询匹配的关键词，导致输入极不流畅，效率很低。\u003c/p\u003e\n\u003cp\u003e一直就这么凑合着用着SuperTab，随着这个插件版本的更新，旧功能不断地完善，新功能也接二连三地引入，SuperTab在匹配关键词的准确度上有了一些改善，但是新的问题又出现了。SuperTab后来加入一个新功能，对于程序源文件，可以在其引入的文件以及API文件中匹配关键词。比如假设我当前正在编辑a.php，在a.php中有\u003cstrong\u003einclude 'b.php';\u003c/strong\u003e这样的语句，当我输入\u003cstrong\u003earray\u003c/strong\u003e并按下Tab键时，SuperTab不但会在当前文件中查询所有匹配项，还会到b.php中查询，如果配置过vim、指定一个包含了php的API的文件，则SuperTab还会自动从这个文件中查询匹配项。按理说这个功能的理念很好，但问题就在于SuperTab做的是实时查询，如果源文件中包含的文件较多，各个文件又较大，问题就显而易见了。我不得不在写程序时小心地使用Tab键，否则有时就会出现按一下Tab键然后等着Vim在那狂搜的情况。\u003c/p\u003e\n\u003cp\u003e前两天发现了\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=2620\"\u003eNeoComplCache\u003c/a\u003e，光看名字就让我有点儿兴奋，一般使用缓存的速度都很快。这个插件会在Vim打开文件的时候对上下文作一个索引，并把索引结果保存到缓存中。同时，文件更改的内容会在保存的时候被索引。此外，NeoComplCache支持多种关键词索引模式，例如它会判断当前路径下的文件或目录的名字是否匹配补全条件，也可以从缓存的程序语言API中匹配补全条件。到此为止，它就解决了SuperTab和AutoComplPop共同的效率问题，并具备它们各自的长处。看了一遍文档，发现这个插件的功能比较细致，大概有以下一些特点：\u003c/p\u003e\n\u003cp\u003e1、使用缓存，自动补全时效率高；\n2、生成的关键词列表准确；\n3、支持下划线分割的关键词，如apple_boy_cat，就可以只输入a_b_c，然后补全；\n4、支持驼峰格式匹配关键词，如AppleBoyCat，就可以只输入ABC，然后补全；\n5、既可以像AutoComplPop那样在Vim中输入的同时自动弹出补全列表，又可以自定义快捷键手动触发；\n6、支持从文件名和目录名中匹配补全条件；\n7、对于程序源文件，支持从语言API中匹配补全条件；\u003c/p\u003e\n\u003cp\u003eNeoComplCache的缺点是文档不全，虽然从只言片语中发现它还支持Snippet，但从文档中没有找到足够的有用信息。加之一直用\u003ca href=\"http://www.vim.org/scripts/script.php?script_id=2540\"\u003eSnipMate\u003c/a\u003e感觉不错，所以目前还是用它来实现snippet功能。\u003c/p\u003e\n\u003cp\u003e这就有个搭配问题：虽然NeoComplCache不存在补全时的效率问题，但我仍然打算只在需要补全时才用快捷键触发此功能，最主要的原因是我既希望用Tab键触发SnipMate的代码块补全功能，又希望修SuperTab那样用Tab选择补全列表中的选项。也就是要达到只用Tab键就可以完成打开自动补全列表、补全列表选项选择和SnipMate代码块替换的效果。但是，如果将Tab映射到触发自动补全，则补全列表选择和SnipMate均无法使用Tab，反之亦然。\u003c/p\u003e\n\u003cp\u003e所以我想如果能让NeoComplCache、SuperTab、SnipMate和谐共存，那问题就解决了，几经摸索，终于找到了办法：\u003c/p\u003e\n\u003cp\u003e1、设置NeoComplCache不自动弹出补全列表，即在vimrc中加入：\u003c/p\u003e\n\u003cblockquote\u003e\n  \u003cp\u003elet g:NeoComplCache_DisableAutoComplete = 1\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e2、由于NeoComplCache在手工模式下使用快捷键组合\u003ccode\u003e\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;\u003c/code\u003e打开补全列表，故设置SuperTab的默认补全操作为\u003ccode\u003e\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;\u003c/code\u003e，即在vimrc中加入：\u003c/p\u003e\n\u003cblockquote\u003e\n  \u003cp\u003elet g:SuperTabDefaultCompletionType = '\u003ccode\u003e\u0026lt;C-X\u0026gt;\u0026lt;C-U\u0026gt;\u003c/code\u003e'\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这样，NeoComplCache只负责补全关键词缓存的生成，SuperTab控制Tab键的行为并在需要触发补全操作时打开补全列表、进而在列表中的选项间移动焦点，而当光标前的关键词是snippet时，SnipMate会被优先调用并完成代码块的替换。\u003c/p\u003e\n\u003cp\u003e就在写这篇文章的时候，我突然觉得NeoComplCache自动弹出补全列表+SnipMate的方式也挺好，只是这样就不能用Tab键选择列表中的选项了。\u003c/p\u003e\n\u003ch3 id=\"相关阅读\"\u003e相关阅读：\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/post/replace-youcompleteme-with-neocomplete/\"\u003e用neocomplete换掉了YouCompleteMe\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/post/make-youcompleteme-ultisnips-compatible/\"\u003eHow to Make YouCompleteMe Compatible with UltiSnips\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Vim的终极自动补全插件：NeoComplCache"},{"content":"最初将脚本的文件编码和coding行都设定为UTF-8，在windows下执行时，中文无法保存，报编码错误。将上述两个编码改为GBK后，保存正常，但查询时报错。\nTraceback内容如下：\n``` Traceback (most recent call last): File \"test.py\", line 36, in \u0026lt;module\u0026gt; \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;for obj in session.query(User): File \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\query.py\", line 1411, in instances \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;rows = [process[0](row, None) for row in fetch] File \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\mapper.py\", line 1788, in _instance \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;populate_state(state, dict_, row, isnew, only_load_props) File \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\mapper.py\", line 1677, in populate_state \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;populator(state, dict_, row, isnew=isnew, **flags) File \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\strategies.py\", line 118, in new_execute \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;dict_[key] = row[col] File \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\engine\\base.py\", line 1634, in __getitem__ \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return self.__colfuncs[key][0](self.__row) File \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\engine\\base.py\", line 1716, in getcol \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return processor(row[index]) File \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\types.py\", line 568, in process \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return decoder(value)[0] File \"C:\\Python26\\lib\\encodings\\utf_8.py\", line 16, in decode \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return codecs.utf_8_decode(input, errors, True) UnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)\n``` 环境为：\nOS：Windows XP简体中文版 DB：SQL Server 2008 Express简体中文版 DB模块：pyodbc 脚本文件编码：GBK 脚本coding行：GBK\n脚本内容：\n```python #!/usr/bin/python # -*- encoding: gbk -*- from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker from sqlalchemy import Column, Integer, String, Text, ForeignKey, Numeric, Unicode Base = declarative_base() class User(Base): \"\"\"User class\"\"\" __tablename__ = 'users' id = Column(Numeric(22,0), primary_key=True) name = Column(Unicode(128), nullable=False, unique=True) def __init__(self, id, name): self.id = id self.name = name if __name__ == '__main__': db_engine = create_engine('mssql://sa:password@localhost/mydatabase', echo=True) Session = sessionmaker(bind=db_engine) session = Session() Base.metadata.drop_all(db_engine) Base.metadata.create_all(db_engine) jim = User(1, '中文') session.add(jim) session.commit() ''' for obj in session.query(User): print obj.name ''' ``` 上面的脚本执行后，数据得以正常保存，在数据库中的查询结果也正常，没有乱码。但是，当把从drop_all()到commit()行注释掉，取消for循环前后的多行字符串起止符后，即运行查询时，抛出上面的Traceback。\nGoogle了很长时间，没有找到有用的东西。CPyUG更没指望。\n回溯Traceback，打开sqlalchemy的types.py，UnicodeEncodeError的抛出点在String类的result_processor()方法：\n```python def result_processor(self, dialect, coltype): wants_unicode = self.convert_unicode or dialect.convert_unicode needs_convert = wants_unicode and \\ (not dialect.returns_unicode_strings or self.convert_unicode == 'force') if needs_convert: # note we *assume* that we do not have a unicode object # here, instead of an expensive isinstance() check. decoder = codecs.getdecoder(dialect.encoding) def process(value): if value is not None: # decoder returns a tuple: (value, len) return decoder(value)[0] else: return value return process else: return None ``` 这个方法就是根据数据库方言dialect和字段类型coltype返回一个字符串的解码函数。若在if语句上面将needs_convert置为False，即不对该字段使用解码器，则再执行上面的脚本时，查询正常。\n由于前面create_engine()函数的encoding参数缺省为UTF-8，故dialect.encoding的值为“UTF-8”，故if语句中decoder实际引用的是codecs.utf_8_decode()。也就是说，result_processor()方法在实际执行过程中返回的是一个封装了utf_8_decode()函数的函数。即，UnicodeEncodeError是在对从数据库中查询出来的中文字符串进行UTF-8解码时抛出的。\n对传入process()函数的值作isinstance(value,unicode)判断，显示为True，表明从数据库中查询出来的中文本身就是unicode字节码，当对它再进行UTF-8解码时，就抛出了UnicodeEncodeError的错误。为验证以上判断，做如下实验：\n```python \u003e\u003e\u003et = '中文' \u003e\u003e\u003eu = u'中文' \u003e\u003e\u003eisinstance(t, str) True \u003e\u003e\u003eisinstance(t, unicode) False \u003e\u003e\u003eisinstance(u, str) False \u003e\u003e\u003eisinstance(u, unicode) True \u003e\u003e\u003ex = t.decode('utf-8') \u003e\u003e\u003ex u'\\u4e2d\\u6587' \u003e\u003e\u003eisinstance(x, unicode) True \u003e\u003e\u003ex == u True \u003e\u003e\u003e import codecs \u003e\u003e\u003e dc = codecs.getdecoder('utf-8') \u003e\u003e\u003e dc(u) Traceback (most recent call last): File \"\", line 1, in File \"/usr/lib/python2.6/encodings/utf_8.py\", line 16, in decode return codecs.utf_8_decode(input, errors, True) UnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128) ``` 得证。\n在Python中，字符串类型str和unicode类型是两种不同的数据类型，str类型的数据可以通过指定正确的编码来转换成unicode类型，对unicode类型的数据作重复的解码操作就会抛出类似上面的错误。\n实事上，若将name字段声明为String类，则保存和查询操作均无问题。但由于我需要sqlalchemy建表时将相应字段的类型设为nvarchar，故必须使用Unicode类声明该列。\n那有没有办法使result_processor()方法不返回一个对字段值作重复解码的函数呢？\n返回result_processor()方法，self.convert_unicode对于Unicode类是True，dialect.convert_unicode由create_engine()函数的convert_unicode参数控制，缺省为False，故needs_convert变量为True，无法更改；dialect.returns_unicode_strings是由sqlalchemy.engine模块default.py中的DefaultDialect类的_check_unicode_returns()方法返回的，该方法内容为：\n```python def _check_unicode_returns(self, connection): cursor = connection.connection.cursor() cursor.execute( str( expression.select( [expression.cast( expression.literal_column(\"'test unicode returns'\"),sqltypes.VARCHAR(60)) ]).compile(dialect=self) ) ) row = cursor.fetchone() result = isinstance(row[0], unicode) cursor.close() return result ``` 此方法的功能为生成一条SQL语句，在数据库中执行后，判断返回的值是否为unicode类型。由于SQL Server是ASCII编码，故此方法返回False。因此，dialect.returns_unicode_strings的值为False。最终，needs_convert只能为True。我觉得这是sqlalchemy的一个Bug。\n在此条件下，目前尚未找到较好的解决办法，只能使用硬编码强制置result_processor()方法中的needs_convert变量为False。\n2010-02-25 更新：\n谢谢KL童鞋指出问题原因和解决办法，使问题得以完美解决。\n1、由于Python在载入site模块时会删除setdefaultencoding()函数，故不能以在脚本开头调用此函数的方式指定默认编码；sitecustomize.py是一个python会自动导入的模块，故应当使用这个文件指定默认编码；\n2、我这里需要使用utf-8作默认编码器，sitecustomize.py的内容如下：\n```python #!/usr/bin/python # -*- coding: gbk -*- import sys sys.setdefaultencoding('utf-8') ``` 3、将sitecustomize.py保存到python安装目录下的Lib\\site-packages目录中；\n另外，在此处发现了跟本问题相关的资料，辅助治疗，效果更佳。\n","permalink":"http://0x3f.org/posts/chinese-problem-of-sqlalchemy-with-sqlserver/","summary":"\u003cp\u003e最初将脚本的文件编码和coding行都设定为UTF-8，在windows下执行时，中文无法保存，报编码错误。将上述两个编码改为GBK后，保存正常，但查询时报错。\u003c/p\u003e\n\n\u003cp\u003eTraceback内容如下：\u003c/p\u003e\n\n```\nTraceback (most recent call last):\nFile \"test.py\", line 36, in \u003ccode\u003e\u0026lt;module\u0026gt;\u003c/code\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;for obj in session.query(User):\nFile \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\query.py\", line 1411, in instances\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;rows = [process[0](row, None) for row in fetch]\nFile \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\mapper.py\", line 1788, in _instance\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;populate_state(state, dict_, row, isnew, only_load_props)\nFile \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\mapper.py\", line 1677, in populate_state\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;populator(state, dict_, row, isnew=isnew, **flags)\nFile \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\orm\\strategies.py\", line 118, in new_execute\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;dict_[key] = row[col]\nFile \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\engine\\base.py\", line 1634, in __getitem__\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return self.__colfuncs[key][0](self.__row)\nFile \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\engine\\base.py\", line 1716, in getcol\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return processor(row[index])\nFile \"C:\\Python26\\lib\\site-packages\\sqlalchemy-0.6beta1-py2.6.egg\\sqlalchemy\\types.py\", line 568, in process\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return decoder(value)[0]\nFile \"C:\\Python26\\lib\\encodings\\utf_8.py\", line 16, in decode\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;return codecs.utf_8_decode(input, errors, True)\nUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)\u003c/p\u003e","title":"SQLAlchemy操作SQL Server的中文问题"},{"content":"昨天更新了一下系统，今天开机就白屏了。于是先关掉Compiz，看了一下Archlinux的新闻，发现新的xf86-video-intel中已经移除了UMS，也就意味着只能使用KMS做3D加速了。\nUMS的全称是User Mode-Setting，是一种传统的图形界面初始化方案，即在X加载之后由它初始化图形界面。这种方案的弊端是虚拟终端不具备显示和处理图形的能力，同时虚拟终端和图形界面之间的切换显得缓慢并带有闪烁。\nKMS的全称是Kernel Mode-Setting，是新一代图形界面初始化方案，它将图形界面的初始化由X加载之后由X负责进行改为在内核初始化时由内核进行。KMS的好处不仅仅是解决了上面UMS的问题，同时也使得Linux具备了在启动时显示漂亮的开机图示的能力。另外，在3D加速性能和低功耗方面，KMS也较UMS更胜一筹。\n我的Thinkpad X200使用的是Intel GMA 945的芯片组，而Archlinux的Wiki上仍以915为例，所以尝试着做如下内容：\n一、去除/boot/grub/menu.lst中Kernel启动参数中的vga参数；\n二、加入以下内容到/etc/modprobe.d/modprobe.conf：\noptions i945 modeset=1\n三、在/etc/rc.conf中的MODULES行加入intel_agp和i945；\n重启系统后，Compiz白屏问题解决，3D加速性能似乎有所上升。\n","permalink":"http://0x3f.org/posts/switching-from-ums-to-kms/","summary":"\u003cp\u003e昨天更新了一下系统，今天开机就白屏了。于是先关掉Compiz，看了一下Archlinux的\u003ca href=\"http://www.archlinux.org/news/484/\"\u003e新闻\u003c/a\u003e，发现新的\u003cstrong\u003exf86-video-intel\u003c/strong\u003e中已经移除了UMS，也就意味着只能使用KMS做3D加速了。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://www.thinkwiki.org/wiki/Intel_Graphics_Media_Accelerator_950#User_mode_setting_.28UMS.29\"\u003eUMS\u003c/a\u003e的全称是\u003cstrong\u003eUser Mode-Setting\u003c/strong\u003e，是一种传统的图形界面初始化方案，即在X加载之后由它初始化图形界面。这种方案的弊端是虚拟终端不具备显示和处理图形的能力，同时虚拟终端和图形界面之间的切换显得缓慢并带有闪烁。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://wiki.archlinux.org/index.php/KMS\"\u003eKMS\u003c/a\u003e的全称是\u003cstrong\u003eKernel Mode-Setting\u003c/strong\u003e，是新一代图形界面初始化方案，它将图形界面的初始化由X加载之后由X负责进行改为在内核初始化时由内核进行。KMS的好处不仅仅是解决了上面UMS的问题，同时也使得Linux具备了在启动时显示漂亮的开机图示的能力。另外，在3D加速性能和低功耗方面，KMS也较UMS更胜一筹。\u003c/p\u003e\n\n\u003cp\u003e我的\u003ca href=\"http://0x3f.org/?p=819\"\u003eThinkpad X200\u003c/a\u003e使用的是Intel GMA 945的芯片组，而Archlinux的\u003ca href=\"http://wiki.archlinux.org/index.php/Intel_(简体中文)#KMS_.28Kernel_Mode_Setting.29\"\u003eWiki\u003c/a\u003e上仍以915为例，所以尝试着做如下内容：\u003c/p\u003e\n\n\u003cp\u003e一、去除/boot/grub/menu.lst中Kernel启动参数中的\u003ca href=\"http://0x3f.org/?p=866\"\u003evga参数\u003c/a\u003e；\u003c/p\u003e\n\n\u003cp\u003e二、加入以下内容到/etc/modprobe.d/modprobe.conf：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eoptions i945 modeset=1\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e三、在/etc/rc.conf中的\u003cstrong\u003eMODULES\u003c/strong\u003e行加入\u003cstrong\u003eintel_agp\u003c/strong\u003e和\u003cstrong\u003ei945\u003c/strong\u003e；\u003c/p\u003e\n\n\u003cp\u003e重启系统后，Compiz白屏问题解决，3D加速性能似乎有所上升。\u003c/p\u003e","title":"被迫弃UMS而用KMS"},{"content":"这是去年晚些时侯发现的一个问题。\n公司产品的后台定时任务应该是用独立的PHP进程驱动的。在做一个项目的时候，为了便于手工调试，我在定时任务中使用了大量的echo输出信息并在浏览器中手工执行此任务的脚本。\n手工执行通过，输出信息完全没有问题。但在实际运行的过程中，一个很诡异的事情发生了：即使我将实际处理数据的代码全部注释掉，只对原始数据做简单的查询，此定时任务仍然极其健壮地中途退出。最要命的是无论程序日志还是PHP的错误日志，都没有任何相关信息。直到后来我把所有echo输出都取消，问题才解决。\n事后模糊地记得很久以前似乎在哪本书上看到过在无输出设备的情况下echo过多数据会导致PHP进程崩溃的内容，但原因已想不起来了。\n","permalink":"http://0x3f.org/posts/too-many-echoes-may-crash-php/","summary":"\u003cp\u003e这是去年晚些时侯发现的一个问题。\u003c/p\u003e\n\u003cp\u003e公司产品的后台定时任务应该是用独立的PHP进程驱动的。在做一个项目的时候，为了便于手工调试，我在定时任务中使用了大量的echo输出信息并在浏览器中手工执行此任务的脚本。\u003c/p\u003e\n\u003cp\u003e手工执行通过，输出信息完全没有问题。但在实际运行的过程中，一个很诡异的事情发生了：即使我将实际处理数据的代码全部注释掉，只对原始数据做简单的查询，此定时任务仍然极其健壮地中途退出。最要命的是无论程序日志还是PHP的错误日志，都没有任何相关信息。直到后来我把所有echo输出都取消，问题才解决。\u003c/p\u003e\n\u003cp\u003e事后模糊地记得很久以前似乎在哪本书上看到过在无输出设备的情况下echo过多数据会导致PHP进程崩溃的内容，但原因已想不起来了。\u003c/p\u003e","title":"PHP后台echo过多会导致进程崩溃"},{"content":"VirtualBox安装后默认的网络接入方式是NAT，也是最简单的一种。但NAT网络中的虚拟机系统不具有和主机同一网段的IP地址，不能和主机直接通信。这对于开发者来说是不适用的。\nHost Interface网络接入方式可以使虚拟机系统获得与主机同一网段的IP地址，因此也使得虚拟机系统像主机所在的局域网中的一台真实的计算机一样，可以和其它计算机通信。\n对于Linux平台的VirtualBox，可以有两种方式实现Host Interface网络。一是使用系统网桥，二是使用VirtualBox内建的机制。\n第一种方式复杂但通用，尤其是对于2.1.0以前的版本来说，这是唯一的途径。从2.1.0开始，VirtuaBox内建了支持Host Interface的机制，这极大地简化了此类型网络的配置。\n首先，加载vboxnetflt模块：\nsudo modprobe vboxnetflt\n然后在VirtualBox中配置虚拟机的网络连接方式，选择“Bridged Adapter”。\n最后启动虚拟机即可。\n另外，若虚拟机系统是精简版的Windows，网卡驱动可能不会自动安装，这时需要另外下载网卡的驱动并安装。\n为方便起见，可将vboxnetflt模块加入到开机自动启动的模块列表中，每种发行版设置自启动模块的位置和方法不一样，在Archlinux下，是在/etc/rc.conf文件中的modules行中设置。\n参考文章：Archlinux Wiki: VirtualBox\n","permalink":"http://0x3f.org/posts/virtualbox-host-interface/","summary":"\u003cp\u003e\u003ca href=\"http://zh.wikipedia.org/wiki/VirtualBox\"\u003eVirtualBox\u003c/a\u003e安装后默认的网络接入方式是\u003ca href=\"http://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2\"\u003eNAT\u003c/a\u003e，也是最简单的一种。但NAT网络中的虚拟机系统不具有和主机同一网段的IP地址，不能和主机直接通信。这对于开发者来说是不适用的。\u003c/p\u003e\n\n\u003cp\u003eHost Interface网络接入方式可以使虚拟机系统获得与主机同一网段的IP地址，因此也使得虚拟机系统像主机所在的局域网中的一台真实的计算机一样，可以和其它计算机通信。\u003c/p\u003e\n\n\u003cp\u003e对于Linux平台的VirtualBox，可以有两种方式实现Host Interface网络。一是使用系统网桥，二是使用VirtualBox内建的机制。\u003c/p\u003e\n\n\u003cp\u003e第一种方式复杂但通用，尤其是对于2.1.0以前的版本来说，这是唯一的途径。从2.1.0开始，VirtuaBox内建了支持Host Interface的机制，这极大地简化了此类型网络的配置。\u003c/p\u003e\n\n\u003cp\u003e首先，加载\u003cstrong\u003evboxnetflt\u003c/strong\u003e模块：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003esudo modprobe vboxnetflt\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e然后在VirtualBox中配置虚拟机的网络连接方式，选择“\u003cstrong\u003eBridged Adapter\u003c/strong\u003e”。\u003c/p\u003e\n\n\u003cp\u003e最后启动虚拟机即可。\u003c/p\u003e\n\n\u003cp\u003e另外，若虚拟机系统是精简版的Windows，网卡驱动可能不会自动安装，这时需要另外下载网卡的驱动并安装。\u003c/p\u003e\n\n\u003cp\u003e为方便起见，可将vboxnetflt模块加入到开机自动启动的模块列表中，每种发行版设置自启动模块的位置和方法不一样，在Archlinux下，是在\u003cstrong\u003e/etc/rc.conf\u003c/strong\u003e文件中的\u003cstrong\u003emodules\u003c/strong\u003e行中设置。\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e参考文章：\u003ca href=\"http://wiki.archlinux.org/index.php/VirtualBox\"\u003eArchlinux Wiki: VirtualBox\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e","title":"VirtualBox的Host Interface网络接入方式的配置"},{"content":" 上次鼓捣出立方体还是几年前在学校的时候，Ubuntu+Beryl。 我那个时候的台式机，Celeron Tualatin+256M SDRAM+GForce 440，跑XP要了亲命，忍无可忍而投奔Linux，结果一不小心鼓捣出了立方体，捎带着Firefox、OpenOffice开了一大堆，屁事儿没有，我就是这么死心塌地地上了贼船，直至今天。 后来一直用Archlinux，习惯了Fluxbox和Openbox的简洁。买了X200后曾试图找寻一下旧日华丽的记忆，但却人是物非，新的X200、新的Archlinux、新的Compiz-fusion远不如当年的老牛破车那么搭调。虽说也搞出了立方体，但所有的窗口都没有边框，于是作罢。 上周六鬼使神差的进入GNOME并打开Fusion-icon，奇迹就这么出现了： ","permalink":"http://0x3f.org/posts/cube-is-back/","summary":"上次鼓捣出立方体还是几年前在学校的时候，\u003ca href=\"http://zh.wikipedia.org/zh-cn/Ubuntu\"\u003eUbuntu\u003c/a\u003e+\u003ca href=\"http://en.wikipedia.org/wiki/Beryl_(window_manager)\"\u003eBeryl\u003c/a\u003e。\n\n我那个时候的台式机，\u003ca href=\"http://en.wikipedia.org/wiki/Celeron#Tualatin-256\"\u003eCeleron Tualatin\u003c/a\u003e+256M SDRAM+GForce 440，跑XP要了亲命，忍无可忍而投奔Linux，结果一不小心鼓捣出了立方体，捎带着Firefox、OpenOffice开了一大堆，屁事儿没有，我就是这么死心塌地地上了贼船，直至今天。\n\n后来一直用\u003ca href=\"http://zh.wikipedia.org/zh-cn/ArchLinux\"\u003eArchlinux\u003c/a\u003e，习惯了\u003ca href=\"http://zh.wikipedia.org/zh-cn/Fluxbox\"\u003eFluxbox\u003c/a\u003e和\u003ca href=\"http://zh.wikipedia.org/zh-cn/Openbox\"\u003eOpenbox\u003c/a\u003e的简洁。买了X200后曾试图找寻一下旧日华丽的记忆，但却人是物非，新的X200、新的Archlinux、新的\u003ca href=\"http://zh.wikipedia.org/zh-cn/Compiz_Fusion\"\u003eCompiz-fusion\u003c/a\u003e远不如当年的老牛破车那么搭调。虽说也搞出了立方体，但所有的窗口都没有边框，于是作罢。\n\n上周六鬼使神差的进入GNOME并打开Fusion-icon，奇迹就这么出现了：\n\n\u003ca href=\"http://picasaweb.google.com/lh/photo/HkPacmXQACapxzViLh4kRw?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/SwvnvUJImNI/AAAAAAAABPk/076ZiKsl4Uw/s400/screenshot_001.png\" /\u003e\u003c/a\u003e","title":"立方体归来"},{"content":"下载gvim的一个扩展“gvimfullscreen_win32”，并解压缩。 将gvimfullscreen.dll复制到gvim安装目录下，与gvim.exe同目录。 修改gvim配置文件_vimrc，在其中添加如下内容： ```vim if has('win32') map :call libcallnr(\"gvimfullscreen.dll\", \"ToggleFullScreen\", 0) endif ``` 此后，即可使用F11键开关gvim的全屏状态。 ","permalink":"http://0x3f.org/posts/fullscreen-for-gvim-on-windows/","summary":"下载gvim的一个扩展“\u003ca href=\"https://github.com/derek/gvimfullscreen_win32\"\u003egvimfullscreen_win32\u003c/a\u003e”，并解压缩。\n\n将\u003cstrong\u003egvimfullscreen.dll\u003c/strong\u003e复制到gvim安装目录下，与\u003cstrong\u003egvim.exe\u003c/strong\u003e同目录。\n\n修改gvim配置文件\u003cstrong\u003e_vimrc\u003c/strong\u003e，在其中添加如下内容：\n\n```vim\nif has('win32')\n    map \u003cF11\u003e \u003cEsc\u003e:call libcallnr(\"gvimfullscreen.dll\", \"ToggleFullScreen\", 0)\u003cCR\u003e\nendif\n```\n\n此后，即可使用\u003cstrong\u003eF11\u003c/strong\u003e键开关gvim的全屏状态。","title":"Windows下GVim的全屏"},{"content":" In the 20×20 grid below, four numbers along a diagonal line have been marked in red.\n08 02 22 97 38 15 00 40 00 75 04 05 07 78 52 12 50 77 91 08 49 49 99 40 17 81 18 57 60 87 17 40 98 43 69 48 04 56 62 00 81 49 31 73 55 79 14 29 93 71 40 67 53 88 30 03 49 13 36 65 52 70 95 23 04 60 11 42 69 24 68 56 01 32 56 71 37 02 36 91 22 31 16 71 51 67 63 89 41 92 36 54 22 40 40 28 66 33 13 80 24 47 32 60 99 03 45 02 44 75 33 53 78 36 84 20 35 17 12 50 32 98 81 28 64 23 67 10 26 38 40 67 59 54 70 66 18 38 64 70 67 26 20 68 02 62 12 20 95 63 94 39 63 08 40 91 66 49 94 21 24 55 58 05 66 73 99 26 97 17 78 78 96 83 14 88 34 89 63 72 21 36 23 09 75 00 76 44 20 45 35 14 00 61 33 97 34 31 33 95 78 17 53 28 22 75 31 67 15 94 03 80 04 62 16 14 09 53 56 92 16 39 05 42 96 35 31 47 55 58 88 24 00 17 54 24 36 29 85 57 86 56 00 48 35 71 89 07 05 44 44 37 44 60 21 58 51 54 17 58 19 80 81 68 05 94 47 69 28 73 92 13 86 52 17 77 04 89 55 40 04 52 08 83 97 35 99 16 07 97 57 32 16 26 26 79 33 27 98 66 88 36 68 87 57 62 20 72 03 46 33 67 46 55 12 32 63 93 53 69 04 42 16 73 38 25 39 11 24 94 72 18 08 46 29 32 40 62 76 36 20 69 36 41 72 30 23 88 34 62 99 69 82 67 59 85 74 04 36 16 20 73 35 29 78 31 90 01 74 31 49 71 48 86 81 16 23 57 05 54 01 70 54 71 83 51 54 69 16 92 33 48 61 43 52 01 89 19 67 48\nThe product of these numbers is 26 × 63 × 78 × 14 = 1788696.\nWhat is the greatest product of four adjacent numbers in any direction (up, down, left, right, or diagonally) in the 20×20 grid?\n这道题最难的地方在于将上面400个数输入到程序中的矩阵里，嘿嘿，后来看别人的解，真有这么干的，饿滴神呀。\n我直接把这个矩阵复制到一个文本文件里，然后在程序里解析：\n```python #!/bin/python # -*- coding: utf-8 -*- matrix = [] products = [] metaFile = open('c:/matrix.txt', 'rb') for line in metaFile.readlines(): matrix.append(line.split()) metaFile.close() for row in range(20): for col in range(20): if col+3 \u003c 20: products.append( int(matrix[row][col]) * int(matrix[row][col+1]) * int(matrix[row][col+2]) * int(matrix[row][col+3]) ) if row+3 \u003c 20: products.append( int(matrix[row][col]) * int(matrix[row+1][col]) * int(matrix[row+2][col]) * int(matrix[row+3][col]) ) if col+3 \u003c 20 and row+3 \u003c 20: products.append( int(matrix[row][col]) * int(matrix[row+1][col+1]) * int(matrix[row+2][col+2]) * int(matrix[row+3][col+3]) ) if row+3 \u003c 20 and col-3 \u003e 0: products.append( int(matrix[row][col]) * int(matrix[row+1][col-1]) * int(matrix[row+2][col-2]) * int(matrix[row+3][col-3]) ) products.sort() print products ``` ","permalink":"http://0x3f.org/posts/project-euler-11/","summary":"\u003cblockquote\u003e\n  \u003cp\u003eIn the 20×20 grid below, four numbers along a diagonal line have been marked in red.\u003c/p\u003e\n  \n  \u003cp\u003e08 02 22 97 38 15 00 40 00 75 04 05 07 78 52 12 50 77 91 08\n  49 49 99 40 17 81 18 57 60 87 17 40 98 43 69 48 04 56 62 00\n  81 49 31 73 55 79 14 29 93 71 40 67 53 88 30 03 49 13 36 65\n  52 70 95 23 04 60 11 42 69 24 68 56 01 32 56 71 37 02 36 91\n  22 31 16 71 51 67 63 89 41 92 36 54 22 40 40 28 66 33 13 80\n  24 47 32 60 99 03 45 02 44 75 33 53 78 36 84 20 35 17 12 50\n  32 98 81 28 64 23 67 10 26 38 40 67 59 54 70 66 18 38 64 70\n  67 26 20 68 02 62 12 20 95 63 94 39 63 08 40 91 66 49 94 21\n  24 55 58 05 66 73 99 26 97 17 78 78 96 83 14 88 34 89 63 72\n  21 36 23 09 75 00 76 44 20 45 35 14 00 61 33 97 34 31 33 95\n  78 17 53 28 22 75 31 67 15 94 03 80 04 62 16 14 09 53 56 92\n  16 39 05 42 96 35 31 47 55 58 88 24 00 17 54 24 36 29 85 57\n  86 56 00 48 35 71 89 07 05 44 44 37 44 60 21 58 51 54 17 58\n  19 80 81 68 05 94 47 69 28 73 92 13 86 52 17 77 04 89 55 40\n  04 52 08 83 97 35 99 16 07 97 57 32 16 26 26 79 33 27 98 66\n  88 36 68 87 57 62 20 72 03 46 33 67 46 55 12 32 63 93 53 69\n  04 42 16 73 38 25 39 11 24 94 72 18 08 46 29 32 40 62 76 36\n  20 69 36 41 72 30 23 88 34 62 99 69 82 67 59 85 74 04 36 16\n  20 73 35 29 78 31 90 01 74 31 49 71 48 86 81 16 23 57 05 54\n  01 70 54 71 83 51 54 69 16 92 33 48 61 43 52 01 89 19 67 48\u003c/p\u003e","title":"欧拉工程第十一解"},{"content":" nacre同学说，urxvt是可以实现真透明的。起初我以为是要用transset-df来实现，但这个东西一般需要手动操作，不具有太大的实用性，而且会把整个窗口透明化。不过后来发现真的不需要用它来画蛇添足，有xcompmgr足矣。\n因为我用openbox，要实现窗口的阴影和动画效果，xcompmgr是必须的，我把它设成了开机自启动。比起xcompmgr默认的参数值，下面这条定制的命令实现了简洁的阴影和合理的渐隐渐显时间，因此提供了一个各方面都比较均衡、合理的桌面体验：\nxcompmgr -Ss -n -Cc -fF -I-10 -O-10 -D1 -t-3 -l-4 -r4\n然后在.Xresources中添加以下两行：\nURxvt.depth:32 URxvt.background:rgba:0000/0000/0000/dddd\n最后当然要执行一下：\nxrdb ~/.Xresources\n此后直接启动urxvt即可。\n这里面最有意思的就是background项的配置，它有两种形式，一种是：\nURxvt.background:[80]black\n还有一种就是前面提到的形式。\n第一种形式中，中括号里的数字表示半透明度对应的百分比，括号外是颜色名称；第二种形式提供了比第一种更多的色彩选择，四组数字都是十六进制数，前三组是RGB颜色值，最后一组是半透明度，数值越大，透明度越低。\n在查阅“man urxvt”的时候，发现urxvt的man pages里的内容真是异常丰富，大部分功能都讲解得言简意赅。以往还抱怨这个东西在网上连个健全的文档都找不到，原来全在这儿呢，真不知道以往无数次地man的时候为什么没有注意到这些，难道man了rxvt了？\nPS：这样实现urxvt的真半透明后，貌似xcompmgr实现的阴影在urxvt身上就消失了，求解中……\n","permalink":"http://0x3f.org/posts/true-transparent-of-rxvt-unicode/","summary":"\u003cdiv class=\"illustration_right\"\u003e\n\u003ca href=\"http://picasaweb.google.com/lh/photo/J2FyvgBhXopEgPlX9whJ3w?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/Saghr1cRaoI/AAAAAAAAA0o/fye5JZl3Pxc/s288/2009-02-28-012206_1280x800_scrot.png\" /\u003e\u003c/a\u003e\n\u003c/div\u003e\n\n\u003cp\u003enacre同学说，urxvt是可以实现真透明的。起初我以为是要用\u003ca href=\"http://www.forchheimer.se/transset-df/\"\u003etransset-df\u003c/a\u003e来实现，但这个东西一般需要手动操作，不具有太大的实用性，而且会把整个窗口透明化。不过后来发现真的不需要用它来画蛇添足，有\u003ca href=\"http://wiki.archlinux.org/index.php/Xcompmgr\"\u003excompmgr\u003c/a\u003e足矣。\u003c/p\u003e\n\n\u003cp\u003e因为我用\u003ca href=\"http://en.wikipedia.org/wiki/Openbox\"\u003eopenbox\u003c/a\u003e，要实现窗口的阴影和动画效果，xcompmgr是必须的，我把它设成了开机自启动。比起xcompmgr默认的参数值，下面这条定制的命令实现了简洁的阴影和合理的渐隐渐显时间，因此提供了一个各方面都比较均衡、合理的桌面体验：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003excompmgr -Ss -n -Cc -fF -I-10 -O-10 -D1 -t-3 -l-4 -r4\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e然后在.Xresources中添加以下两行：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eURxvt.depth:32\n  URxvt.background:rgba:0000/0000/0000/dddd\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e最后当然要执行一下：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003exrdb ~/.Xresources\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e此后直接启动urxvt即可。\u003c/p\u003e\n\n\u003cp\u003e这里面最有意思的就是background项的配置，它有两种形式，一种是：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eURxvt.background:[80]black\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e还有一种就是前面提到的形式。\u003c/p\u003e\n\n\u003cp\u003e第一种形式中，中括号里的数字表示半透明度对应的百分比，括号外是颜色名称；第二种形式提供了比第一种更多的色彩选择，四组数字都是十六进制数，前三组是RGB颜色值，最后一组是半透明度，数值越大，透明度越低。\u003c/p\u003e\n\n\u003cp\u003e在查阅“man urxvt”的时候，发现urxvt的man pages里的内容真是异常丰富，大部分功能都讲解得言简意赅。以往还抱怨这个东西在网上连个健全的文档都找不到，原来全在这儿呢，真不知道以往无数次地man的时候为什么没有注意到这些，难道man了rxvt了？\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003ePS：这样实现urxvt的真半透明后，貌似xcompmgr实现的阴影在urxvt身上就消失了，求解中……\u003c/em\u003e\u003c/p\u003e","title":"rxvt-unicode的真透明"},{"content":"urxvt（rxvt的unicode版本，支持多国语言，官方网站）。\n具有以下特性：\n支持真半透明 支持Unicode编码，支持多国语言 支持英文和非英文字符使用不同的字体 支持CS模式，节省系统资源 轻量，速度快 支持Perl扩展功能 但是urxvt有一个很影响情绪的缺陷，就是字符的间距过大，看起来很不舒服。不过已有补丁用来解决这个问题，例如Archlinux用户可以安装rxvt-unicode-chinese：\nurxvt的配置选项可以参考其官方网站上的说明，另外这里有一份详细的配置文件。 更新日志： 2011-01-15 修改文章标题 重写文章内容 由于原来的rxvt-unicode-256color包已不存在，更换为rxvt-unicode-chinese 补充一份配置文件 ","permalink":"http://0x3f.org/posts/rxvt-unicode-256color-is-perfect/","summary":"\u003cp\u003e\u003ca href=\"http://en.wikipedia.org/wiki/Rxvt-unicode\"\u003eurxvt\u003c/a\u003e（\u003ca href=\"http://www.rxvt.org/\"\u003erxvt\u003c/a\u003e的unicode版本，支持多国语言，\u003ca href=\"http://software.schmorp.de/pkg/rxvt-unicode.html\"\u003e官方网站\u003c/a\u003e）。\u003c/p\u003e\n\n\u003cp\u003e具有以下特性：\u003c/p\u003e\n\u003col\u003e\n\t\u003cli\u003e支持真半透明\u003c/li\u003e\n\t\u003cli\u003e支持Unicode编码，支持多国语言\u003c/li\u003e\n\t\u003cli\u003e支持英文和非英文字符使用不同的字体\u003c/li\u003e\n\t\u003cli\u003e支持CS模式，节省系统资源\u003c/li\u003e\n\t\u003cli\u003e轻量，速度快\u003c/li\u003e\n\t\u003cli\u003e支持Perl扩展功能\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e但是urxvt有一个很影响情绪的缺陷，就是字符的间距过大，看起来很不舒服。不过已有补丁用来解决这个问题，例如Archlinux用户可以安装\u003ca href=\"http://aur.archlinux.org/packages.php?ID=32488\"\u003erxvt-unicode-chinese\u003c/a\u003e：\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/6B48rqC08p3C7paP_Y651w?feat=embedwebsite\"\u003e\u003cimg src=\"http://lh5.ggpht.com/_ceUJ_lBTHzc/SY71tgK4J0I/AAAAAAAAAw4/3Vf4HbPZfS4/s400/rxvt-unicode-256color.png\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\nurxvt的配置选项可以参考其官方网站上的说明，另外\u003ca href=\"http://pastebin.com/WzT6pTKA\"\u003e这里\u003c/a\u003e有一份详细的配置文件。\n\n\u003cstrong\u003e更新日志：\u003c/strong\u003e\n\n\u003cstrong\u003e2011-01-15\u003c/strong\u003e\n\u003col\u003e\n\t\u003cli\u003e修改文章标题\u003c/li\u003e\n\t\u003cli\u003e重写文章内容\u003c/li\u003e\n\t\u003cli\u003e由于原来的rxvt-unicode-256color包已不存在，更换为rxvt-unicode-chinese\u003c/li\u003e\n\t\u003cli\u003e补充一份配置文件\u003c/li\u003e\n\u003c/ol\u003e","title":"完美的终端模拟器：rxvt-unicode"},{"content":"The sum of the primes below 10 is 2 + 3 + 5 + 7 = 17.\nFind the sum of all the primes below two million.\n题目越来越变态，开始好玩儿了。\n第七解里的算法在这里算是废了，一万个素数都算得那么费劲，两百万以下的素数有十几万个，不得不用筛选法了。\n普通的筛选效率也不行，当初就是因为这个原因才没用它。不过优化过的筛选法就很奇妙了，下面是Lua的实现：\n```lua require('math') local limit = 2000000 local primes = {} for i=1,limit do table.insert(primes,true) end primes[0] = false primes[1] = false for i=0,math.floor(math.sqrt(limit)) do if primes[i] then for j=math.pow(i,2),limit,i do primes[j] = false end end end local sumVal = 0 for i,j in ipairs(primes) do if j then sumVal = sumVal + i end end print(sumVal) ``` 在我这里两秒半就出结果了，Python的表现也不错，四秒半出结果：\n```python from math import sqrt limit = 2000000 primes = [True for i in range(0,limit)] primes[0] = False primes[1] = False for i in range(1,int(sqrt(limit))+1): if primes[i]: for j in range(i**2,limit,i): primes[j] = False sumVal = 0 for i in range(len(primes)): if primes[i]: sumVal += i print sumVal ``` ","permalink":"http://0x3f.org/posts/project-euler-10/","summary":"\u003cblockquote\u003e\u003cp\u003eThe sum of the primes below 10 is 2 + 3 + 5 + 7 = 17.\u003c/p\u003e\n\n\u003cp\u003eFind the sum of all the primes below two million.\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cp\u003e题目越来越变态，开始好玩儿了。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://0x3f.org/?p=753\"\u003e第七解\u003c/a\u003e里的算法在这里算是废了，一万个素数都算得那么费劲，两百万以下的素数有十几万个，不得不用筛选法了。\u003c/p\u003e\n\n\u003cp\u003e普通的筛选效率也不行，当初就是因为这个原因才没用它。不过优化过的筛选法就很奇妙了，下面是Lua的实现：\u003c/p\u003e\n\n\u003cp\u003e\n```lua\nrequire('math')\n\nlocal limit = 2000000\n\nlocal primes = {}\nfor i=1,limit do\n    table.insert(primes,true)\nend\nprimes[0] = false\nprimes[1] = false\n\nfor i=0,math.floor(math.sqrt(limit)) do\n    if primes[i] then\n        for j=math.pow(i,2),limit,i do\n            primes[j] = false\n        end\n    end\nend\n\nlocal sumVal = 0\nfor i,j in ipairs(primes) do\n    if j then\n        sumVal = sumVal + i\n    end\nend\n\nprint(sumVal)\n```\n\u003c/p\u003e","title":"欧拉工程第十解"},{"content":" A Pythagorean triplet is a set of three natural numbers, a \u003c b \u003c c, for which,\na2 + b2 = c2\nFor example, 32 + 42 = 9 + 16 = 25 = 52.\nThere exists exactly one Pythagorean triplet for which a + b + c = 1000. Find the product abc. 解：\n```python flag = False for a in range(1,1000): for b in range(1,1000): if a ** 2 + b ** 2 == (1000 - a - b) ** 2: print a,b,(1000 - a - b) print a * b * (1000 - a - b) flag = True break if flag: break ``` ","permalink":"http://0x3f.org/posts/project-euler-9/","summary":"\u003cblockquote\u003e\n\u003cp\u003eA Pythagorean triplet is a set of three natural numbers, \u003cb\u003e\u003cem\u003ea\u003c/em\u003e\u003c/b\u003e \u003c \u003cb\u003e\u003cem\u003eb\u003c/em\u003e\u003c/b\u003e \u003c \u003cb\u003e\u003cem\u003ec\u003c/em\u003e\u003c/b\u003e, for which,\u003c/p\u003e\n\n\u003cp\u003e\u003cb\u003e\u003cem\u003ea\u003c/em\u003e\u003c/b\u003e\u003csup\u003e2\u003c/sup\u003e + \u003cb\u003e\u003cem\u003eb\u003c/em\u003e\u003c/b\u003e\u003csup\u003e2\u003c/sup\u003e = \u003cb\u003e\u003cem\u003ec\u003c/em\u003e\u003c/b\u003e\u003csup\u003e2\u003c/sup\u003e\u003c/p\u003e\n\n\u003cp\u003eFor example, 3\u003csup\u003e2\u003c/sup\u003e + 4\u003csup\u003e2\u003c/sup\u003e = 9 + 16 = 25 = 5\u003csup\u003e2\u003c/sup\u003e.\u003c/p\u003e\n\n\u003cp\u003eThere exists exactly one Pythagorean triplet for which \u003cb\u003e\u003cem\u003ea\u003c/em\u003e\u003c/b\u003e + \u003cb\u003e\u003cem\u003eb\u003c/em\u003e\u003c/b\u003e + \u003cb\u003e\u003cem\u003ec\u003c/em\u003e\u003c/b\u003e = 1000.\nFind the product \u003cb\u003e\u003cem\u003eabc\u003c/em\u003e\u003c/b\u003e.\n\u003c/blockquote\u003e\n\n\n\u003cp\u003e解：\u003c/p\u003e\n\n\u003cp\u003e\n```python\nflag = False\nfor a in range(1,1000):\n    for b in range(1,1000):\n        if a ** 2 + b ** 2 == (1000 - a - b) ** 2:\n            print a,b,(1000 - a - b)\n            print a * b * (1000 - a - b)\n            flag = True\n            break\n    if flag:\n        break\n```\n\u003c/p\u003e","title":"欧拉工程第九解"},{"content":"Find the greatest product of five consecutive digits in the 1000-digit number.\n73167176531330624919225119674426574742355349194934 96983520312774506326239578318016984801869478851843 85861560789112949495459501737958331952853208805511 12540698747158523863050715693290963295227443043557 66896648950445244523161731856403098711121722383113 62229893423380308135336276614282806444486645238749 30358907296290491560440772390713810515859307960866 70172427121883998797908792274921901699720888093776 65727333001053367881220235421809751254540594752243 52584907711670556013604839586446706324415722155397 53697817977846174064955149290862569321978468622482 83972241375657056057490261407972968652414535100474 82166370484403199890008895243450658541227588666881 16427171479924442928230863465674813919123162824586 17866458359124566529476545682848912883142607690042 24219022671055626321111109370544217506941658960408 07198403850962455444362981230987879927244284909188 84580156166097919133875499200524063689912560717606 05886116467109405077541002256983155200055935729725 71636269561882670428252483600823257530420752963450\n穷举，解：\n```python def MakeProduct(strNum): prod = 1 for char in strNum: prod = prod * int(char) return prod def GetTheFirstProduct(strNum): if len(strNum) \u003c 5: return 0,0 return MakeProduct(strNum[:5]),strNum[1:] num = '7316717653133062491922511967442657474235534919493496983520312774506326239578318016984801869478851843858615607891129494954595017379583319528532088055111254069874715852386305071569329096329522744304355766896648950445244523161731856403098711121722383113622298934233803081353362766142828064444866452387493035890729629049156044077239071381051585930796086670172427121883998797908792274921901699720888093776657273330010533678812202354218097512545405947522435258490771167055601360483958644670632441572215539753697817977846174064955149290862569321978468622482839722413756570560574902614079729686524145351004748216637048440319989000889524345065854122758866688116427171479924442928230863465674813919123162824586178664583591245665294765456828489128831426076900422421902267105562632111110937054421750694165896040807198403850962455444362981230987879927244284909188845801561660979191338754992005240636899125607176060588611646710940507754100225698315520005593572972571636269561882670428252483600823257530420752963450' largestProduct = 0 while len(num) \u003e= 5: tmp = GetTheFirstProduct(num) if tmp == (0,0): break num = tmp[1] if largestProduct \u003c tmp[0]: largestProduct = tmp[0] print largestProduct ``` 如果先找到下五个均不为零的连续整数，然后计算它们的积并以之参与比较，效率会更高：\n```python def MakeProduct(strNum): prod = 1 for char in strNum: prod = prod * int(char) return prod def GetTheFirstProduct(strNum): if len(strNum) \u003c 5: return 0,0 subStr = strNum[:5] index = subStr.rfind('0') if index == -1: return MakeProduct(subStr),strNum[1:] else: return GetTheFirstProduct(strNum[index+1:]) num = '7316717653133062491922511967442657474235534919493496983520312774506326239578318016984801869478851843858615607891129494954595017379583319528532088055111254069874715852386305071569329096329522744304355766896648950445244523161731856403098711121722383113622298934233803081353362766142828064444866452387493035890729629049156044077239071381051585930796086670172427121883998797908792274921901699720888093776657273330010533678812202354218097512545405947522435258490771167055601360483958644670632441572215539753697817977846174064955149290862569321978468622482839722413756570560574902614079729686524145351004748216637048440319989000889524345065854122758866688116427171479924442928230863465674813919123162824586178664583591245665294765456828489128831426076900422421902267105562632111110937054421750694165896040807198403850962455444362981230987879927244284909188845801561660979191338754992005240636899125607176060588611646710940507754100225698315520005593572972571636269561882670428252483600823257530420752963450' largestProduct = 0 while len(num) \u003e= 5: tmp = GetTheFirstProduct(num) if tmp == (0,0): break num = tmp[1] if largestProduct \u003c tmp[0]: largestProduct = tmp[0] print largestProduct ``` ","permalink":"http://0x3f.org/posts/project-euler-8/","summary":"\u003cblockquote\u003e\u003cp\u003eFind the greatest product of five consecutive digits in the 1000-digit number.\u003c/p\u003e\n\n\u003cp\u003e73167176531330624919225119674426574742355349194934\n96983520312774506326239578318016984801869478851843\n85861560789112949495459501737958331952853208805511\n12540698747158523863050715693290963295227443043557\n66896648950445244523161731856403098711121722383113\n62229893423380308135336276614282806444486645238749\n30358907296290491560440772390713810515859307960866\n70172427121883998797908792274921901699720888093776\n65727333001053367881220235421809751254540594752243\n52584907711670556013604839586446706324415722155397\n53697817977846174064955149290862569321978468622482\n83972241375657056057490261407972968652414535100474\n82166370484403199890008895243450658541227588666881\n16427171479924442928230863465674813919123162824586\n17866458359124566529476545682848912883142607690042\n24219022671055626321111109370544217506941658960408\n07198403850962455444362981230987879927244284909188\n84580156166097919133875499200524063689912560717606\n05886116467109405077541002256983155200055935729725\n71636269561882670428252483600823257530420752963450\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cp\u003e穷举，解：\u003c/p\u003e\n\n\u003cp\u003e\n```python\ndef MakeProduct(strNum):\n    prod = 1\n    for char in strNum:\n        prod = prod * int(char)\n    return prod\n    \ndef GetTheFirstProduct(strNum):\n    if len(strNum) \u003c 5:\n        return 0,0\n    return MakeProduct(strNum[:5]),strNum[1:]\n\nnum = '7316717653133062491922511967442657474235534919493496983520312774506326239578318016984801869478851843858615607891129494954595017379583319528532088055111254069874715852386305071569329096329522744304355766896648950445244523161731856403098711121722383113622298934233803081353362766142828064444866452387493035890729629049156044077239071381051585930796086670172427121883998797908792274921901699720888093776657273330010533678812202354218097512545405947522435258490771167055601360483958644670632441572215539753697817977846174064955149290862569321978468622482839722413756570560574902614079729686524145351004748216637048440319989000889524345065854122758866688116427171479924442928230863465674813919123162824586178664583591245665294765456828489128831426076900422421902267105562632111110937054421750694165896040807198403850962455444362981230987879927244284909188845801561660979191338754992005240636899125607176060588611646710940507754100225698315520005593572972571636269561882670428252483600823257530420752963450'\n\nlargestProduct = 0\nwhile len(num) \u003e= 5:\n    tmp = GetTheFirstProduct(num)\n    if tmp == (0,0):\n        break\n    num = tmp[1]\n    if largestProduct \u003c tmp[0]:\n        largestProduct = tmp[0]\nprint largestProduct\n```\n\u003c/p\u003e","title":"欧拉工程第八解"},{"content":"第七解：\nBy listing the first six prime numbers: 2, 3, 5, 7, 11, and 13, we can see that the 6th prime is 13.\nWhat is the 10001st prime number?\n穷举，并加以最大程度的优化：对大于2的素数，只判断奇数；判断一个奇数是否素数时，只拿已经找到的素数中小于第这个数平方根的数来相除，如果均不能整除，就是素数。Python的实现：\n```python def IsPrimeNum(num,feed): from math import sqrt tmp = feed[:] while tmp[-1] \u003e int(sqrt(num)): tmp.pop() for i in tmp: if num % i == 0: return False return True limit = 10001 feed = [2,3,5,7] temp = 7 counter = 4 while counter \u003c limit : temp += 2 if IsPrimeNum(temp,feed): feed.append(temp) counter += 1 print temp ``` 执行了一下，在我这里居然用了五百秒才出结果，神啊，差不多十分钟啊。想到PHP号称速度很快，于是用PHP重新实现了一下：\n```php function IsPrimeNum($num,$feed){ $base = floor(sqrt($num)); foreach($feed as $i=\u003e$v){ if($v \u003e $base){ return true; } if($num % $v == 0){ return false; } } } $limit = 10001; $feed = array(2,3,5,7); $counter = 4; $tmp = 7; while($counter \u003c $limit){ $tmp += 2; if(IsPrimeNum($tmp,$feed)){ $counter++; $feed[] = $tmp; } } echo $tmp; ``` 还好，七十四秒出结果，看来PHP的牛皮不是吹的。当然，Lua会更快：\n```lua function IsPrimeNum(num,feed) require('math') local limit = math.floor(math.sqrt(num)) for i,v in ipairs(feed) do if v \u003e limit then return true end if num % v == 0 then return false end end end local limit = 10001 local feed = {2,3,5,7} local counter = 4 local tmp = 7 while counter \u003c limit do tmp = tmp + 2 if IsPrimeNum(tmp,feed) then counter = counter + 1 table.insert(feed,tmp) end end print(tmp) ``` 执行完后还是吓了一跳，0.3秒，同样是语言，效率的差别咋就那么大呢？！我在想用Java会不会算到2009去。\n我不相信这道题用Python就那么难解，下面是用递归实现的程序：\n```python from math import sqrt def GuessPrime(feed,limit): if feed == 2 : return [2] elif feed == 3 : return [2,3] tmp = int(sqrt(feed)) primes = GuessPrime(tmp,limit) base = 0 if tmp % 2 == 0: base = tmp + 1 else: base = tmp for i in range(base,feed,2): flag = 0 for j in primes: if i % j == 0: flag = 1 break if flag == 0: primes.append(i) if len(primes) == limit: return primes return primes limit = 10001 feed = 1000000 primes = GuessPrime(feed,limit) print primes[limit-1] ``` 11秒就出了结果，说到底，算法的改进才是硬道理！\n","permalink":"http://0x3f.org/posts/project-euler-7/","summary":"\u003cp\u003e第七解：\u003c/p\u003e\n\n\u003cblockquote\u003e\u003cp\u003eBy listing the first six prime numbers: 2, 3, 5, 7, 11, and 13, we can see that the 6th prime is 13.\u003c/p\u003e\n\n\u003cp\u003eWhat is the 10001st prime number?\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cp\u003e穷举，并加以最大程度的优化：对大于2的素数，只判断奇数；判断一个奇数是否素数时，只拿已经找到的素数中小于第这个数平方根的数来相除，如果均不能整除，就是素数。Python的实现：\u003c/p\u003e\n\n\u003cp\u003e\n```python\ndef IsPrimeNum(num,feed):\n    from math import sqrt\n    tmp = feed[:]\n    while tmp[-1] \u003e int(sqrt(num)):\n        tmp.pop()\n    for i in tmp:\n        if num % i == 0:\n            return False\n    return True\n\nlimit = 10001\nfeed = [2,3,5,7]\ntemp = 7\ncounter = 4\nwhile counter \u003c limit :\n    temp += 2\n    if IsPrimeNum(temp,feed):\n        feed.append(temp)\n        counter += 1\nprint temp\n```\n\u003c/p\u003e","title":"欧拉工程第七解"},{"content":"第六解：\nThe sum of the squares of the first ten natural numbers is, 12 + 22 + \u0026hellip; + 102 = 385\nThe square of the sum of the first ten natural numbers is, (1 + 2 + \u0026hellip; + 10)2 = 552 = 3025\nHence the difference between the sum of the squares of the first ten natural numbers and the square of the sum is 3025 385 = 2640. Find the difference between the sum of the squares of the first one hundred natural numbers and the square of the sum.\n解：\n```python sumSquare = 0 sum = 0 for i in range(1,101): sumSquare += i**2 sum += i print sum**2 - sumSquare ``` ","permalink":"http://0x3f.org/posts/project-euler-6/","summary":"\u003cp\u003e第六解：\u003c/p\u003e\n\n\u003cblockquote\u003e\u003cp\u003eThe sum of the squares of the first ten natural numbers is,\n12 + 22 + \u0026hellip; + 102 = 385\u003c/p\u003e\n\n\u003cp\u003eThe square of the sum of the first ten natural numbers is,\n(1 + 2 + \u0026hellip; + 10)2 = 552 = 3025\u003c/p\u003e\n\n\u003cp\u003eHence the difference between the sum of the squares of the first ten natural numbers and the square of the sum is 3025  385 = 2640.\nFind the difference between the sum of the squares of the first one hundred natural numbers and the square of the sum.\u003c/p\u003e","title":"欧拉工程第六解"},{"content":"第五解：\n2520 is the smallest number that can be divided by each of the numbers from 1 to 10 without any remainder. What is the smallest number that is evenly divisible by all of the numbers from 1 to 20?\n解：\n```python #为简洁明了，此处不作校验 def GetGreatestCommonDivisor(min,max): '''辗转相除法求最大公约数''' while min \u003e 0: tmp = min min = max % min max = tmp return max def GetLeastCommonMultiple(a,b): if a \u003e b: max = a min = b else: max = b min = a div = GetGreatestCommonDivisor(min,max) return min * max / div temp = 1 for i in range(1,21): temp = GetLeastCommonMultiple(i,temp) print temp ``` 本题旨在求最小公倍数。此算法有意思的是，它的精华在于如何求解两个正整数的最大公约数，有点围魏救赵的意思。\n在这里可以找到另外一些求解最小公倍数的方法。\n","permalink":"http://0x3f.org/posts/project-euler-5/","summary":"\u003cp\u003e第五解：\u003c/p\u003e\n\n\u003cblockquote\u003e\u003cp\u003e2520 is the smallest number that can be divided by each of the numbers from 1 to 10 without any remainder.\nWhat is the smallest number that is evenly divisible by all of the numbers from 1 to 20?\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cp\u003e解：\u003c/p\u003e\n\n\u003cp\u003e\n```python\n#为简洁明了，此处不作校验\ndef GetGreatestCommonDivisor(min,max):\n    '''辗转相除法求最大公约数'''\n    while min \u003e 0:\n        tmp = min\n        min = max % min\n        max = tmp\n    return max\n\ndef GetLeastCommonMultiple(a,b):\n    if a \u003e b:\n        max = a\n        min = b\n    else:\n        max = b\n        min = a\n    div = GetGreatestCommonDivisor(min,max)\n    return min * max / div\n\ntemp = 1\nfor i in range(1,21):\n    temp = GetLeastCommonMultiple(i,temp)\nprint temp\n```\n\u003c/p\u003e","title":"欧拉工程第五解"},{"content":"第四解：\nA palindromic number reads the same both ways. The largest palindrome made from the product of two 2-digit numbers is 9009 = 91 × 99. Find the largest palindrome made from the product of two 3-digit numbers.\n解：\n```python largestPalindrome = 0 for i in range(100,1000): for j in range(100,1000): product = i * j if int(str(product)[::-1]) == product and product \u003e largestPalindrome: largestPalindrome = product print largestPalindrome ``` 穷举，有没有效率高的办法？\n","permalink":"http://0x3f.org/posts/project-euler-4/","summary":"\u003cp\u003e第四解：\u003c/p\u003e\n\n\u003cblockquote\u003e\u003cp\u003eA palindromic number reads the same both ways. The largest palindrome made from the product of two 2-digit numbers is 9009 = 91 × 99.\nFind the largest palindrome made from the product of two 3-digit numbers.\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cp\u003e解：\u003c/p\u003e\n\n\u003cp\u003e\n```python\nlargestPalindrome = 0\nfor i in range(100,1000):\n    for j in range(100,1000):\n        product = i * j\n        if int(str(product)[::-1]) == product and product \u003e largestPalindrome:\n            largestPalindrome = product\nprint largestPalindrome\n```\n\u003c/p\u003e","title":"欧拉工程第四解"},{"content":"第三解：\nThe prime factors of 13195 are 5, 7, 13 and 29. What is the largest prime factor of the number 600851475143 ?\n解：\n```python feed = 600851475143 def GetFactor(feed,footmark): while footmark \u003c feed: footmark += 2 if feed % footmark == 0: print footmark GetFactor(feed / footmark,footmark) break GetFactor(feed,1) ``` ","permalink":"http://0x3f.org/posts/project-euler-3/","summary":"\u003cp\u003e第三解：\u003c/p\u003e\n\n\u003cblockquote\u003e\u003cp\u003eThe prime factors of 13195 are 5, 7, 13 and 29.\nWhat is the largest prime factor of the number 600851475143 ?\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cp\u003e解：\u003c/p\u003e\n\n\u003cp\u003e\n```python\nfeed = 600851475143\n\ndef GetFactor(feed,footmark):\n    while footmark \u003c feed:\n        footmark += 2\n        if feed % footmark == 0:\n            print footmark\n            GetFactor(feed / footmark,footmark)\n            break\n\nGetFactor(feed,1)\n```\n\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://picasaweb.google.com/lh/photo/CQ25Wrocadk-dyd7sOiRUA\"\u003e\u003cimg src=\"http://lh6.ggpht.com/lenin.lee/SP3inG0AczI/AAAAAAAAAjA/DBMygQUR9HI/s400/project_euler_problem_003.png\" /\u003e\u003c/a\u003e\u003c/p\u003e","title":"欧拉工程第三解"},{"content":"第二解：\nEach new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be: 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, \u0026hellip; Find the sum of all the even-valued terms in the sequence which do not exceed four million.\n解：\n```python i = 1 j = 2 sum = 0 while j \u003c 4000000 : if j % 2 == 0 : sum = sum + j t = i i = j j = t + j print sum ``` ","permalink":"http://0x3f.org/posts/project-euler-2/","summary":"\u003cp\u003e第二解：\u003c/p\u003e\n\n\u003cblockquote\u003e\u003cp\u003eEach new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:\n1, 2, 3, 5, 8, 13, 21, 34, 55, 89, \u0026hellip;\nFind the sum of all the even-valued terms in the sequence which do not exceed four million.\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cp\u003e解：\u003c/p\u003e\n\n\u003cp\u003e\n```python\ni = 1\nj = 2\nsum = 0\nwhile j \u003c 4000000 :\n    if j % 2 == 0 :\n        sum = sum + j\n    t = i\n    i = j\n    j = t + j\nprint sum\n```\n\u003c/p\u003e","title":"欧拉工程第二解"},{"content":" “欧拉工程”是一个很有意思的网站，它每周会提供一道数学题，要求访问者使用任一种编程语言设计一个计算机程序求解。到现在为止已经出了二百一十一道题，当然，题的难度是依次递增的。几十个国家的程序员已参与了这个工程，截至目前，中国有四百多人参与，但是解决所有的二百多道题的只有一个人。 我觉得没事儿的时候做一道很有意思，下面是第一道，很简单： If we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23. Find the sum of all the multiples of 3 or 5 below 1000. 最容易想到的一算法就是依次取出一到一千的整数，只要是三或五的倍数，就累加起来，最终的和就是结果： ```python sum = 0 for num in range(1,1000): if not (num % 3 != 0 and num % 5 != 0): sum += num print sum ``` 但是我觉得这个算法太普通了，从一到一千要做一千次循环，时间复杂度会比较高。所以我设想只取出三和五的倍数，然后相加就行了，所需要考虑的只是怎么处理三和五的公倍数的问题。下面是我的算法，只有三百多次循环： ```python def SumMultiple(feed,limit): threeMultiple = 3 * feed fiveMultiple = 5 * feed if threeMultiple \u003e= limit: return None if fiveMultiple \u003e= limit: return threeMultiple if fiveMultiple % 3 == 0: return threeMultiple return threeMultiple + fiveMultiple sum = 0 for feed in range(1,500): if SumMultiple(feed,1000) == None: break; sum += SumMultiple(feed,1000) print sum ``` 不过事与愿违，通过测试，这个算法的效率要比上一种低，我想应该是SumMultiple()函数中运算和比较次数较多导致的。 不管怎样，第一个问题已经顺利解决了： ","permalink":"http://0x3f.org/posts/project-euler-1/","summary":"\u003cdiv style=\"float:right;margin-left:10px;margin-bottom:10px;\"\u003e\n\t\u003ca href=\"http://picasaweb.google.com/lh/photo/AAMfMJges97jrmxxYmmsXw\"\u003e\u003cimg src=\"http://lh5.ggpht.com/lenin.lee/SOjhkJQQ7HI/AAAAAAAAAbk/HT6_ZIxVCJE/s144/euler.jpg\" /\u003e\u003c/a\u003e\n\u003c/div\u003e\n\u003cp\u003e\n“\u003ca href=\"http://projecteuler.net/\"\u003e欧拉工程\u003c/a\u003e”是一个很有意思的网站，它每周会提供一道数学题，要求访问者使用任一种编程语言设计一个计算机程序求解。到现在为止已经出了二百一十一道题，当然，题的难度是依次递增的。几十个国家的程序员已参与了这个工程，截至目前，中国有四百多人参与，但是解决所有的二百多道题的只有一个人。\n\u003c/p\u003e\n\u003cp\u003e\n我觉得没事儿的时候做一道很有意思，下面是第一道，很简单：\n\u003c/p\u003e\n\t\u003cblockquote\u003e\n\tIf we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23.\n\tFind the sum of all the multiples of 3 or 5 below 1000.\n\t\u003c/blockquote\u003e\n\u003cp\u003e\n最容易想到的一算法就是依次取出一到一千的整数，只要是三或五的倍数，就累加起来，最终的和就是结果：\n\u003c/p\u003e\n```python\nsum = 0\n\nfor num in range(1,1000):\n\tif not (num % 3 != 0 and num % 5 != 0):\n\t\tsum += num\n\nprint sum\n```\n\u003cp\u003e\n但是我觉得这个算法太普通了，从一到一千要做一千次循环，时间复杂度会比较高。所以我设想只取出三和五的倍数，然后相加就行了，所需要考虑的只是怎么处理三和五的公倍数的问题。下面是我的算法，只有三百多次循环：\n\u003c/p\u003e","title":"欧拉工程第一解"},{"content":"写完urxvt-unicode快速上手，本以为已将urxvt的用法一网打尽，不料AndyWxy网友又找到了两个新的功能：使urxvt启用标签和在urxvt中打开网页链接。\n标签功能很实用，一般为了达到复用终端窗口的目的会采用两种方式：一是配合screen使用，另一个就是启用标签。然而前者有一个缺点就是不直观，标签页恰好能弥补这个缺陷。urxvt不愧是个功能强大的终端工具，如果在编译时开启perl支持，则urxvt可启用多标签功能。用法如下：\n一是在启动的时候加入命令行参数：\nurxvt -pe tabbed\n二是在配置文件“.Xresources”中添加如下配置信息：\nURxvt.perl-ext-common: default,tabbed\n则默认情况下执行urxvt就会打开多标签功能。urxvt的标签支持使用鼠标操作，同时可以使用Ctrl+Shift+左右箭头来切换标签页，使用Ctrl+Shift+向下箭头开启新标签。\n另外一个功能就是可以通过在urxvt中的链接上点击鼠标左键来通过设定的浏览器打开之。首先在“.Xresources”文件中添加如下内容：\nURxvt.urlLauncher: firefox URxvt.matcher.button: 1\n然后使用如下命令打开urxvt：\nurxvt -pe matcher\n即可。也可以在配置文件中添加上述内容之后再添加一行：\nURxvt.perl-ext-common: matcher\n此后即默认开启在终端窗口中打开链接的功能。注意修改“.Xresources”文件后需要执行如下命令才能使修改后的配置文件生效：\nxrdb ~/.Xresources\n","permalink":"http://0x3f.org/posts/let-rxvt-unicode-support-tags-and-links/","summary":"\u003cp\u003e写完\u003ca href=\"http://0x3f.org/?p=376\"\u003eurxvt-unicode快速上手\u003c/a\u003e，本以为已将urxvt的用法一网打尽，不料AndyWxy网友又找到了两个新的功能：使urxvt启用标签和在urxvt中打开网页链接。\u003c/p\u003e\n\n\u003cp\u003e标签功能很实用，一般为了达到复用终端窗口的目的会采用两种方式：一是配合screen使用，另一个就是启用标签。然而前者有一个缺点就是不直观，标签页恰好能弥补这个缺陷。urxvt不愧是个功能强大的终端工具，如果在编译时开启perl支持，则urxvt可启用多标签功能。用法如下：\u003c/p\u003e\n\n\u003cp\u003e一是在启动的时候加入命令行参数：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eurxvt -pe tabbed\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e二是在配置文件“.Xresources”中添加如下配置信息：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eURxvt.perl-ext-common: default,tabbed\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e则默认情况下执行urxvt就会打开多标签功能。urxvt的标签支持使用鼠标操作，同时可以使用Ctrl+Shift+左右箭头来切换标签页，使用Ctrl+Shift+向下箭头开启新标签。\u003c/p\u003e\n\n\u003cp\u003e另外一个功能就是可以通过在urxvt中的链接上点击鼠标左键来通过设定的浏览器打开之。首先在“.Xresources”文件中添加如下内容：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eURxvt.urlLauncher: firefox\n  URxvt.matcher.button: 1\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e然后使用如下命令打开urxvt：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eurxvt -pe matcher\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e即可。也可以在配置文件中添加上述内容之后再添加一行：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eURxvt.perl-ext-common: matcher\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e此后即默认开启在终端窗口中打开链接的功能。注意修改“.Xresources”文件后需要执行如下命令才能使修改后的配置文件生效：\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003exrdb ~/.Xresources\u003c/p\u003e\n\u003c/blockquote\u003e","title":"为rxvt-unicode开启标签和链接支持"},{"content":" \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;rxvt是我最喜欢的虚拟终端，它有以下优点： \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;轻量：体积小，启动速度快，占用系统资源极低 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;美观：各种外观（如颜色、字体、半透明等）均可定制 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;功能强：具备一个终端工具应当有的各种实用功能 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;然而它很难被初学者接受，一是因为它的缺省外观很难看，而自身又不提供图形界面的配置工具，只能通过修改配置文件来设置，然而网上相关的资料却非常少；二是因为在rxvt中使用复制和粘贴非常“不方便”，它并不支持人们已经习惯的Ctrl+C和Ctrl+V的复制、粘贴方式，这也是网上关于rxvt问得最多的问题；最后一个门槛是它对中文等东亚文字的支持不好。 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;其实rxvt以上三个所谓的门槛都是初学者对它的误解。首先rxvt的配置文件非常简单，只要学过英语的人都能看明白，通过简单的配置就可以使之变得非常漂亮，丝毫不逊色于Konsole、Gnome-terminal等主流终端。 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;其次，rxvt虽然不支持Ctrl+C和Ctrl+V的复制、粘贴，但是它有自己的一套操作方式。Linux下普遍使用的图形界面均为X11，而X11支持一种独特的复制粘贴方式，即如果你在另一个程序比如文本编辑器中使用鼠标拖动来高亮一段文字后，不用进行任何操作，此时选中的内容已经复制到剪贴板中了，随后在rxvt中单击鼠标中键即可将选中内容粘贴到其中，此外，如果鼠标没有中键，可以同时按下左右键以达到同样的效果，还可以使用Shift+Insert组合键来完成粘贴；反之，从rxvt中向外复制内容同样如此。 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;最后，虽然rxvt对东亚文字支持不好，但是rxvt有几个修改版，其中一个就是rxvt-unicode。顾名思义，rxvt-unicode支持unicode编码，因此对东亚文字的支持完全没有问题。安装完成后，使用urxvt即可打开之。 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;此外，rxvt-unicode还有一个很好的特性，它可以工作在C/S模式。使用urxvtd启动rxvt的后台程序，此后任何时候使用urxvtc即可打开一个rxvt终端，所有的rxvtc共用一个urxvtd，因此在同时运行的终端比较多的时候，在内存占用上要比全部使用urxvt少一些。不过据我粗略计算，如果打开的终端不是非常多（比如说几十个），那么使用普通模式和使用C/S模式对内存的占用没有太大的差距，因为普通模式下的urxvt占用内存本身就非常少。在我看来使用C/S模式的最大好处是启动速度比普通模式要快一些。 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;关于rxvt的美化和设置，可以参看我以前写的一篇文章。下图是我现在使用的rxvt的截图： \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;以下是我当前的rxvt配置文件的内容： !Xft.dpi:96 !fontforge.FontView.FontFamily:wenquanyi bitmap song Rxvt.geometry:192×144 Rxvt.background:#2e2e2e Rxvt.foreground:antiquewhite Rxvt.colorBD:yellow Rxvt.colorUL:green Rxvt.multichar_encoding:utf-8 Rxvt.scrollBar:Fault Rxvt.scrollBar_right:True Rxvt.scrollBar_floating: True Rxvt.scrollstyle: next Rxvt.saveLines:10000 Rxvt.color0:black Rxvt.color1:red3 Rxvt.color2:springgreen Rxvt.color3:wheat3 Rxvt.color4:navy Rxvt.color5:magenta4 Rxvt.color6:steelblue1 Rxvt.color7:gray85 Rxvt.color8:gray10 Rxvt.color9:SkyBlue3 Rxvt.color10:chartreuse3 Rxvt.color11:lightgoldenrod2 Rxvt.color12:SkyBlue1 Rxvt.color13:pink1 Rxvt.color14:lightblue1 Rxvt.color15:#dbeff9 Rxvt.font:xft:Vera Sans YuanTi Mono :size=10,xft:Monospace:size=10 Rxvt.menu:/etc/X11/rxvt.menu Rxvt.preeditType:Root Rxvt.transparency:255 ","permalink":"http://0x3f.org/posts/quick-guide-for-rxvt-unicode/","summary":"\u003c!--rxvt-unicode快速上手--\u003e\n\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003ca href=\"http://www.rxvt.org/\"\u003erxvt\u003c/a\u003e是我最喜欢的虚拟终端，它有以下优点：\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cb\u003e轻量\u003c/b\u003e：体积小，启动速度快，占用系统资源极低\u003cbr/\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cb\u003e美观\u003c/b\u003e：各种外观（如颜色、字体、半透明等）均可定制\u003cbr/\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cb\u003e功能强\u003c/b\u003e：具备一个终端工具应当有的各种实用功能\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;然而它很难被初学者接受，一是因为它的缺省外观很难看，而自身又不提供图形界面的配置工具，只能通过修改配置文件来设置，然而网上相关的资料却非常少；二是因为在rxvt中使用复制和粘贴非常“不方便”，它并不支持人们已经习惯的Ctrl+C和Ctrl+V的复制、粘贴方式，这也是网上关于rxvt问得最多的问题；最后一个门槛是它对中文等东亚文字的支持不好。\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;其实rxvt以上三个所谓的门槛都是初学者对它的误解。首先rxvt的配置文件非常简单，只要学过英语的人都能看明白，通过简单的配置就可以使之变得非常漂亮，丝毫不逊色于\u003ca href=\"http://en.wikipedia.org/wiki/Konsole\"\u003eKonsole\u003c/a\u003e、\u003ca href=\"http://en.wikipedia.org/wiki/GNOME_Terminal\"\u003eGnome-terminal\u003c/a\u003e等主流终端。\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;其次，rxvt虽然不支持Ctrl+C和Ctrl+V的复制、粘贴，但是它有自己的一套操作方式。Linux下普遍使用的图形界面均为\u003ca href=\"http://www.x.org/\"\u003eX11\u003c/a\u003e，而X11支持一种独特的复制粘贴方式，即如果你在另一个程序比如文本编辑器中使用鼠标拖动来高亮一段文字后，不用进行任何操作，此时选中的内容已经复制到剪贴板中了，随后在rxvt中单击鼠标中键即可将选中内容粘贴到其中，此外，如果鼠标没有中键，可以同时按下左右键以达到同样的效果，还可以使用Shift+Insert组合键来完成粘贴；反之，从rxvt中向外复制内容同样如此。\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;最后，虽然rxvt对东亚文字支持不好，但是rxvt有几个修改版，其中一个就是\u003ca href=\"http://software.schmorp.de/pkg/rxvt-unicode.html\"\u003erxvt-unicode\u003c/a\u003e。顾名思义，rxvt-unicode支持unicode编码，因此对东亚文字的支持完全没有问题。安装完成后，使用urxvt即可打开之。\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;此外，rxvt-unicode还有一个很好的特性，它可以工作在C/S模式。使用urxvtd启动rxvt的后台程序，此后任何时候使用urxvtc即可打开一个rxvt终端，所有的rxvtc共用一个urxvtd，因此在同时运行的终端比较多的时候，在内存占用上要比全部使用urxvt少一些。不过据我粗略计算，如果打开的终端不是非常多（比如说几十个），那么使用普通模式和使用C/S模式对内存的占用没有太大的差距，因为普通模式下的urxvt占用内存本身就非常少。在我看来使用C/S模式的最大好处是启动速度比普通模式要快一些。\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;关于rxvt的美化和设置，可以参看我以前写的一篇\u003ca href=\"http://0x3f.org/?p=316\"\u003e文章\u003c/a\u003e。下图是我现在使用的rxvt的截图：\n\u003c/p\u003e\u003cp\u003e\n\u003ca href=\"http://picasaweb.google.com/lenin.lee/Weblog/photo#5173912470992319602\"\u003e\u003cimg src=\"http://lh5.google.com/lenin.lee/R81t-tR19HI/AAAAAAAAASc/DNDprQnOY-A/s400/urxvt.png\" /\u003e\u003c/a\u003e\n\u003c/p\u003e\u003cp\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;以下是我当前的rxvt配置文件的内容：\n\u003c/p\u003e\u003cp\u003e\n\u003cblockquote\u003e\n!Xft.dpi:96\n!fontforge.FontView.FontFamily:wenquanyi bitmap song\n\nRxvt.geometry:192×144\nRxvt.background:#2e2e2e\nRxvt.foreground:antiquewhite\nRxvt.colorBD:yellow\nRxvt.colorUL:green\nRxvt.multichar_encoding:utf-8\nRxvt.scrollBar:Fault\nRxvt.scrollBar_right:True\nRxvt.scrollBar_floating: True\nRxvt.scrollstyle: next\nRxvt.saveLines:10000\nRxvt.color0:black\nRxvt.color1:red3\nRxvt.color2:springgreen\nRxvt.color3:wheat3\nRxvt.color4:navy\nRxvt.color5:magenta4\nRxvt.color6:steelblue1\nRxvt.color7:gray85\nRxvt.color8:gray10\nRxvt.color9:SkyBlue3\nRxvt.color10:chartreuse3\nRxvt.color11:lightgoldenrod2\nRxvt.color12:SkyBlue1\nRxvt.color13:pink1\nRxvt.color14:lightblue1\nRxvt.color15:#dbeff9\n\nRxvt.font:xft:Vera Sans YuanTi Mono :size=10,xft:Monospace:size=10\n\nRxvt.menu:/etc/X11/rxvt.menu\nRxvt.preeditType:Root\nRxvt.transparency:255\n\u003c/blockquote\u003e\n\u003c/p\u003e","title":"rxvt-unicode快速上手"},{"content":" \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;rxvt是个快速且节省内存的模拟终端，原版rxvt对中文等非字母语言的支持不好，所以它有许多修改版，rxvt-unicode-ml是比较适合中国人使用的rxvt修改版。\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;rxvt轻量但不简单，它有许多设置选项和启动参数，用户可以在命令行使用“rxvt -help”查看其常用启动参数，使用“rxvt --help”查看更为详细的启动参数。\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;通过修改用户主目录下的“.Xresources”文件可以配置urxvt的行为，从而不必每次都加启动参数，我的\".Xresources\"文件内容如下：\nRxvt.background:white\nRxvt.foreground:black\nRxvt.colorBD:yellow\nRxvt.colorUL:green\nRxvt.multichar_encoding:gb2312\nRxvt.scrollBar:Fault\nRxvt.scrollBar_right:True\nRxvt.scrollBar_floating: True\nRxvt.scrollstyle: next\nRxvt.saveLines:10000\nRxvt.color0:black\nRxvt.color1:red3\nRxvt.color2:springgreen\nRxvt.color3:wheat3\nRxvt.color4:navy\nRxvt.color5:magenta4\nRxvt.color6:steelblue1\nRxvt.color7:gray85\nRxvt.color8:gray10\nRxvt.color9:SkyBlue3\nRxvt.color10:chartreuse3\nRxvt.color11:lightgoldenrod2\nRxvt.color12:SkyBlue1\nRxvt.color13:pink1\nRxvt.color14:lightblue1\nRxvt.color15:#dbeff9\nRxvt.font:xft:Vera Sans YuanTi Mono :size=10,xft:Monospace:size=10\nRxvt.menu:/etc/X11/rxvt.menu\nRxvt.preeditType:Root\nRxvt.geometry:192×174\nRxvt.transparency:255 \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;这个配置文件是白底黑字，当然可以修改为全透明或者半透明，不过，只要在启动时加入启动参数就可以实现全透明：\nurxvt -tr \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;也可以实现半透明：\nurxvt -fg lightgray -bg black -bc -tr -tint lightgray -sh 60 -sr ","permalink":"http://0x3f.org/posts/half-transparent-for-rxvt-unicode/","summary":"\u003c!-- urxvt的半透明方案 --\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;rxvt是个快速且节省内存的模拟终端，原版rxvt对中文等非字母语言的支持不好，所以它有许多修改版，rxvt-unicode-ml是比较适合中国人使用的rxvt修改版。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;rxvt轻量但不简单，它有许多设置选项和启动参数，用户可以在命令行使用“\u003cfont color=\"#036803\"\u003erxvt -help\u003c/font\u003e”查看其常用启动参数，使用“\u003cfont color=\"#036803\"\u003erxvt --help\u003c/font\u003e”查看更为详细的启动参数。\u003c/p\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;通过修改用户主目录下的“\u003cfont color=\"#a73800\"\u003e.Xresources\u003c/font\u003e”文件可以配置urxvt的行为，从而不必每次都加启动参数，我的\"\u003cfont color=\"#a73800\"\u003e.Xresources\u003c/font\u003e\"文件内容如下：\u003c/p\u003e\n\u003cblockquote\u003e\u003cfont color=\"#036803\"\u003eRxvt.background:white\u003cbr\u003e\nRxvt.foreground:black\u003cbr\u003e\nRxvt.colorBD:yellow\u003cbr\u003e\nRxvt.colorUL:green\u003cbr\u003e\nRxvt.multichar_encoding:gb2312\u003cbr\u003e\nRxvt.scrollBar:Fault\u003cbr\u003e\nRxvt.scrollBar_right:True\u003cbr\u003e\nRxvt.scrollBar_floating: True\u003cbr\u003e\nRxvt.scrollstyle: next\u003cbr\u003e\nRxvt.saveLines:10000\u003cbr\u003e\nRxvt.color0:black\u003cbr\u003e\nRxvt.color1:red3\u003cbr\u003e\nRxvt.color2:springgreen\u003cbr\u003e\nRxvt.color3:wheat3\u003cbr\u003e\nRxvt.color4:navy\u003cbr\u003e\nRxvt.color5:magenta4\u003cbr\u003e\nRxvt.color6:steelblue1\u003cbr\u003e\nRxvt.color7:gray85\u003cbr\u003e\nRxvt.color8:gray10\u003cbr\u003e\nRxvt.color9:SkyBlue3\u003cbr\u003e\nRxvt.color10:chartreuse3\u003cbr\u003e\nRxvt.color11:lightgoldenrod2\u003cbr\u003e\nRxvt.color12:SkyBlue1\u003cbr\u003e\nRxvt.color13:pink1\u003cbr\u003e\nRxvt.color14:lightblue1\u003cbr\u003e\nRxvt.color15:#dbeff9\u003cbr\u003e\nRxvt.font:xft:Vera Sans YuanTi Mono :size=10,xft:Monospace:size=10\u003cbr\u003e\nRxvt.menu:/etc/X11/rxvt.menu\u003cbr\u003e\nRxvt.preeditType:Root\u003cbr\u003e\nRxvt.geometry:192×174\u003cbr\u003e\nRxvt.transparency:255\u003c/font\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;这个配置文件是白底黑字，当然可以修改为全透明或者半透明，不过，只要在启动时加入启动参数就可以实现全透明：\u003c/p\u003e\n\u003cblockquote\u003e\u003cfont color=\"#036803\"\u003eurxvt -tr\u003c/font\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;也可以实现半透明：\u003c/p\u003e\n\u003cblockquote\u003e\u003cfont color=\"#036803\"\u003eurxvt -fg lightgray -bg black -bc -tr -tint lightgray -sh 60 -sr\u003c/font\u003e\u003c/blockquote\u003e","title":"rxvt-unicode的半透明方案"},{"content":"http://forum.ubuntu.org.cn/viewtopic.php?t=32798\u0026amp;amp;highlight=\n目录 一、安装Edgy与硬盘的分区\n（1）安装与分区\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;3\n（2）多硬盘需要注意的一点\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;3\n（3）Linux下硬盘分区的概念\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-4\n二、改变账户操作理念\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-4\n三、修改源并配置网络\n（1）源及其使用方法\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-5\n（2）配置ADSL网络\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-6\n四、系统的中文化与输入法\n（1）系统的中文化\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;6\n（2）中文字体的美化\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-6\n（3）中文输入法的安装与配置\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;8\n（4）主要程序界面的汉化\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;11\n（5）Abiword中文乱码的解决办法\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-11\n五、多媒体播放器的安装与配置\n（1）万能播放器 mplayer\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-12\n（2）音频播放器 audacious 及 mp3 文件 tag 乱码的解决\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-12\n（3）媒体解码库 gstreamer\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;13\n六、网络工具的安装与配置\n（1）Opera 的安装与配置及中文输入法问题的解决\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;13\n（2）即时通讯程序\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;14\n（a）集成即时通讯工具 gaim\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-14\n（b）最逼真的 QQ 工具\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;15\n（c）功能最强大的 QQ 工具 Eva\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;16\n（d）多协议即时通讯工具 Kopete\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-16\n（3）新闻阅读\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-16\n（4）邮件客户端\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;17\n（5）下载工具\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-17\n（6）p2p 工具\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-17\n七、编辑器、编译环境与词典\n（1）编辑器\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;17\n（2）编译环境\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-17\n（3）词典\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;18\n八、NVIDA 显卡驱动与 Beryl 的安装\n（1）nvida 显卡驱动的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;18\n（2）安装 Beryl\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;20\n（3）Splash Screen 的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;22\n九、Wine 的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;22\n十、虚拟机 Vmware\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;23\n十一、磁盘分区的挂载\n（1）挂载一个原先存在而没有挂载的分区\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;23\n（2）新加入一块还没有分区的全新的硬盘\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;24\n十二、游戏\n（1）linux 下面的游戏\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-25\n（2）win 下的游戏\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;25\n十三、一些常用工具\n（1）读写 ntfs 分区\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-25\n（2）java 日记本\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-26\n（3）图片管理 Picasa\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;26\n（4）光碟烧录 GnomeBaker\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-26\n（5）CHM 阅读器\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;26\n（6）数学程序\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-27\n十四、Linux 下程序的安装\n（1）deb 软件包的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;27\n（2）rpm 软件包的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;27\n（3）使用源码进行安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;28\n（4）绿色软件\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;29\n十五、其它 GUI 的安装\n（1）KDE\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;29\n十六、进阶技巧\n（1）关于 Grub 的 FAQ\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;29\n（2）桌面图标隐藏、显示设置\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;31\n（3）在/var/cache/apt/archives 里面发现大量原来使用 apt-get 下来的 deb 包，太占空间了，能不能删掉？31\n（4）gvim 的字体太难看，怎样设置为雅黑?\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;31\n（5）为什么键盘上的左右箭头不能用了？\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;31\n（6）有些常用命令记不住怎么办?\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;32\n（7）快速搜索文件\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;32\n（8）“不打开”音乐播放器预听 mp3\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;33\n一、安装Edgy与硬盘的分区\n（1）安装与分区\n安装就不用多说了，使用LiveCD安装非常简单，如果你装过Windows系统，这个将比它更简单。\n首先将LiveCD的安装盘放入光驱，在BIOS里面设置成从光驱启动，使用LiveCD光盘启动后，系统桌面上有个“Install”的图标，双击后启动安装程序，一步一步地配置选项就行了。\n关键是硬盘分区的问题。\n如果你是想在硬盘上原有的一个分区上安装ubuntu，那么首先应确保这个分区上的重要数据都已被转移，然后在选择磁盘分区的时候选择手动分区，再将这个分区删除，在删除分区后得到的空间上新建一个swap分区，这个相当于windows下面的虚拟内存，一般要求不小于你的内存容量，我的内存是256M，划分的swap是512M。\n然后在剩余的空间上建立一个主分区，用来安装系统所必需的文件，这个分区建议不低于5个G，当然，如果你的硬盘容量很大，还可以划分主分区以外的逻辑分区。\n（2）多硬盘需要注意的一点\n如果你有两块以上的硬盘，并想在不同的硬盘上安装不同的系统，那么需要注意一点，就是硬盘的连接顺序。\n每块硬盘都在其电源线与数据线之间有两排共八个针，每两个针是一组，通过一个接头用来决定磁盘的一些功能。其中有一组是用来决定该磁盘是不是主盘的，有接头的是主盘，没有接头的是从盘，主机中只有一块硬盘的无需在意这个，有没有这个接头都能用，但若是有多块硬盘，那么必需只有一块是主盘，否则有两块主盘的话系统启动会出问题。\n说了这么多，现在该切入正题了。\n对于多块硬盘，如果先前使用的是windows，那么它对硬盘接在总线上的顺序没什么要求。但对于linux，它要求主盘必须接在总线上距离主板上IDE接口近的那个接口上，而从盘接在总线上离IDE接口远的地方。拿我来说，我有两块硬盘，原来就一块主盘，就随便接在了总线上的末端，后来增加一块从盘时，就接在了剩下的那个位于总线中间的接口上，在windows下没有出过任何问题。后来装了ubuntu,发现总是正在操作，突然就死了机，系统没有任何反应，按了主机上的reset键后，当出现启动画面时，又死了，有时需要从windows启动，然后再使用热启动，有时候要关了机再开，然后才可以进入系统。\n起先我还以为是edgy不稳定，后来发现是硬盘接口惹的祸，于是把主盘和从盘的接口顺序对调了一下，问题迎刃而解。\n（3）Linux下硬盘分区的概念\n与windows的fat、fat32和ntfs文件系统格式不同，linux的ext2和ext3文件系统非常的高明和优秀，它具有比windows文件系统更好的安全性、稳定性和低碎片率，它产生的碎片率一般不高于0.4%,几乎不影响系统性能。所以，windows下面那套多分几个区以方便文件管理的思想可以扔到火星上去了。\n另外linux对磁盘分区的管理采取“挂载”的概念，它把所有的分区都挂载到主分区的一个一个的文件夹上，任何一个文件在硬盘上的路径都是按文件夹的路径划分，而不是windows下的先按C、D、E、F分区，再按文件夹路径的方法。\n具体的说，例如我的一首音乐文件在windows下的存放格式为“C:\\Music\\Classic\\一意孤行.mp3”,在linux下就可能是“/home/lans/Music/Classic/一意孤行.mp3”。\n所以在划分完磁盘分区后，还有一个挂载磁盘分区的步骤，也就是将划分好的分区挂到某个目录下，swap分区无须挂载，主分区应挂载在“/”下面，其它分区可自行选择目录，建议将“/home”挂到主分区外的别的逻辑分区上（如果你分区的时候除了主分区还划分了别的逻辑分区的话），因为/home下面是你的帐户所在的主目录，而你经常使用和存放的文件大多数也都放在这里，即使以后要重装系统，也不必担心会丢失。\n二、改变帐户操作理念\n在windows下面，大家一般使用的都是有超级用户权限的帐户。也就是说，使用者可以为所欲为，你可以随意地、不受限制地修改硬盘中的所有数据。这就给了木马病毒以可乘之机，另外用户的任何失误都可能造成难以挽回的灾难，如果平常使用一般权限的帐户的话，由于windows本身的问题，又多有不便。\n在linux下面，也有这样的超级用户，叫“根用户”，帐户名为“root”,但是由于linux的功能太强大了，一条命令就可以毁了整个系统。所以一般不使用，而是使用在安装系统时由用户自己设定的帐户，这个帐户没有超级用户的权限，只拥有对主目录（即”/home/用户名”）目录下文件的读写权限，对此外的文件只有读权限，没有写权限。\n不过不必担心会遇到像windows下的困难，下面会看到，我们对系统的操作会大量使用控制台这个东西，它就相当于windows下的命令行。不过linux的命令行实在太强大了，远非DOS那个玩具可比，所以结合命令行的灵活强大和GUI的美观方便使得linux才是操作系统中的王道。\n此外，如果对所做的操作很有把握，有时候使用root权限在图形界面下工作会比较方便，这需要使用root帐户登录，ubuntu默认关闭root在登录界面登录，所以需要开启它。\nSystem -\u0026gt; Administration -\u0026gt; Login Screen Setup\n系统 -\u0026gt; 系统管理 -\u0026gt; 登录屏幕设置\nLogin Screen Setup\n登录屏幕设置\nSecurity Tab -\u0026gt; Options -\u0026gt; Allow root to login with GDM (\u0026lsquo;\u0026lsquo;\u0026lsquo;Checked\u0026rsquo;\u0026rsquo;\u0026rsquo;)\n安全 -\u0026gt; 选项 -\u0026gt; 允许 root 通过 GDM 登录（“勾选”）\n另外，还要修改root的密码，打开“系统”－“系统管理”－“用户和组”\n在里面修改root的密码。\n三、修改源并配置网络\n（1）源及其使用方法\n什么是源呢。\n在windows下面，要安装程序的话，首先要选择一个你喜欢的软件下载站，在搜索引擎里面输入该软件的名字，搜到后还要选择一个快速的下载链接，使用你喜欢的下载工具，下载回来以后再执行该安装程序。很多时候还要重新启动系统，等等。\n但是在linux下，这一切将会变得十分简单，你只需要在系统自带的“新立得”软件包管理器里选择想要使用的程序，然后连接上网即可。如果你事先知道想要安装的程序的名字，那么更简单，你只需要在控制台输入一条简单的命令即可。剩下的事，什么都不用你管了。这一切都是因为系统会自动从源里下载并自动安装这个软件。\n系统安装后，自带的有一个源，但是由于需要选择一个下载速度快的源，另外安装别的一些软件还需要有特殊的源，所以需要修改一下源。\n打开控制台输入命令：\nsudo gedit /etc/apt/sources.list sudo 就是 super user do 的意思\n如果你安装时选择的是中文的话，那么缺省的源是位于国内的ubuntu亚洲官方源，可以在源文件上添加多个源，但速度慢的源最好不要加，否则速度将会非常的慢。wiki上的快速指南上有很多源可以选择。需要注意的是不同版本的ubuntu有不同的源，千万不要选错了源，ubuntu6.10的代号是edgy，所以打开wiki上edgy的快速指南就行了。\n添加了选定的源后，保存并退出gedit。然后连上网，在控制台输入：\nsudo apt-get update\n以更新软件列表。\nsudo apt-get dist-upgrade\n这个是为了更新系统\n（2）配置ADSL网络\n对于一直在线的用户，网络配置很容易，这里不作赘述，下面介绍一下ADSL上网的要点。\n在控制台执行\nsudo pppoeconf\n然后按着它的提示一步一步操作即可，需要注意的是在输入ADSL帐户的时候，输入框里面缺省的有几个字，先把它们删掉再输入。后面它会提示你是不是开机自动连接上网，如果你的ADSL是按时收费，一定要选择no。\n以后如果要上网，只需执行\npon dsl-provider\n如果要断开连接，执行\npoff\n四、系统的中文化与输入法\n（1）系统的中文化\nubuntu是一个国际化的操作系统，它可以兼容多个语言平台，不像windows那样还要分成多个语言的版本。\n如果在安装操作系统的时候已经选择了安装中文，那么系统安装后就是简体中文的。如果安装时没有在意而装了英文版，或者想在多个语言版本之间切换，那么可又打开菜单中“系统”里面的“系统管理”，然后点选里面的“语言支持”选择即可。\n（2）中文字体的美化\nubuntu的中文界面并不太美观，似乎是开源的字体还不完善，为了养眼，不得不使用一些商业字体来美化界面了。有一种也是比较流行的字体美化方案是使用苹果机的Mac系统的圆体，但是我试过后发现它只能在大于等于十四号的字体才会显示为圆体，而正常的10号却显示的是宋体，圆体虽好看，但只好望洋兴叹。这里介绍一下我的美化方案：方正黑体＋微软雅黑\n方正黑体可以到百度上搜一下，微软雅黑建议到远景论坛下载。下面以我的系统为例,我的帐户名是lans,下载回来的东西都放在主目录下面：\n分别是“FZHTJW.ttf””msyh.ttf”“msyhbd.ttf”“segoeui.ttf”“segoeuib.ttf”“segoeuipr.ttf”“segoeuiprb.ttf”,将它们放在主目录下新建的font目录下面\n执行\nsudo mv /home/lans/font/* /usr/share/fonts/truetype\n将其挪入系统的字体文件夹\n备份现有的 fonts.conf\nsudo cp /etc/fonts/fonts.conf /etc/fonts/fonts.conf.bak\n以后若要恢复原来的配置，只需执行\nsudo cp /etc/fonts/fonts.conf.bak /etc/fonts.conf\n即可\n修改字体配置文件\nsudo gedit /etc/fonts/fonts.conf\n在里面加入下面的内容：\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;alias\u0026gt; \u0026lt;family\u0026gt;Segoe UI\u0026lt;/family\u0026gt; \u0026lt;prefer\u0026gt; \u0026lt;family\u0026gt;Segoe UI\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Microsoft YaHei\u0026lt;/family\u0026gt; \u0026lt;/prefer\u0026gt; \u0026lt;/alias\u0026gt; \u0026lt;alias\u0026gt; \u0026lt;family\u0026gt;FZHei-B01S\u0026lt;/family\u0026gt; \u0026lt;prefer\u0026gt; \u0026lt;family\u0026gt;FZHei-B01S\u0026lt;/family\u0026gt; \u0026lt;/prefer\u0026gt; \u0026lt;/alias\u0026gt; 在“系统”－“首选项”－“字体”里选择：应用程序字体－方正黑体－10；窗口标题－微软雅黑粗体－10；其余都是微软雅黑－10即可。如果是LCD显示器，为了更好的显示效果，建议在字体渲染里面选择“次象素平滑”。并安装类似于windows下面的cleartype的显示优化程序,执行\nsudo gedit /etc/apt/sources.list\n添加以下的源\ndeb http://www.elisanet.fi/mlind/ubuntu edgy fonts\ndeb-src http://www.elisanet.fi/mlind/ubuntu edgy fonts\n然后sudo apt-get update\nsudo apt-get dist-upgrade\n然后刷新字体缓存\nsudo fc-cache -f -v\n执行完后，按Ctrl+Alt+BackSpace重新启动X-window即可。\n（3）中文输入法的安装配置\na、scim\n如果你在安装的时候就一直在线，那么中文输入法已经完全安装，按Ctrl+Space即可使用。若不是这样，那么系统安装的不是一个完整的中文输入法。\n中文输入法比较有名的有两个，系统默认安装的是scim，我们就说这个。\n执行\nsudo apt-get install scim-pinyin im-switch scim-tables-zh scim-qtimm\n其中scim-pinyin和scim-tables-zh可选其一，也可都安装，前者是拼音输入方案，后者包括常用的二笔和五笔等方案。\n安装成功之后按Ctrl+At+BackSpace重启X-window即可使用。\nb、fcitx\nfcitx是一款很好用的中文输入法，听到很多人说scim与系统中许多软件存在冲突，我在使用中没有发现什么问题，但是使用fcitx后确实爱不释手，因为这个工具功能上要比scim强得多，很像我以前在windows下面最喜欢使用的极点中文。\nsudo apt-get install im-switch fcitx\n如果是使用上面的方法安装，直接执行下面第二步，如果是使用下载的安装包安装，执行下面：\n1、如果是使用下载的安装包安装，还应该执行下面的命令：\nsudo chmod -R 755 /usr/share/fcitx\n任意位置新建立一个文件叫 fcitx，内容如下：\nXIM=fcitx\nXIM_PROGRAM=/usr/bin/fcitx\nXIM_ARGS=\u0026quot;\u0026quot;\nGTK_IM_MODULE=XIM\nQT_IM_MODULE=XIM\nDEPENDS=\u0026ldquo;fcitx\u0026rdquo;\n复制到 /etc/X11/xinit/xinput.d/ 下以保证im-switch 能找到它\n2、执行 代码:\nsudo im-switch -s fcitx\n和 代码:\nim-switch -s fcitx\n将二个帐号的输入法都换成 fcitx\n3，如果是在英文local 下而无法调出输入法（XIM）(如果是中文local 不必进行此操作)修正步骤如下：\n编辑 /etc/gtk-2.0/gtk.immodules 文件（sudo gedit /etc/gtk-2.0/gtk.immodules），在xim 的 local 增加 en 也就是说： 代码:\n\u0026ldquo;/usr/lib/gtk-2.0/2.4.0/immodules/im-xim.so\u0026rdquo;\n\u0026ldquo;xim\u0026rdquo; \u0026ldquo;X Input Method\u0026rdquo; \u0026ldquo;gtk20\u0026rdquo; \u0026ldquo;/usr/share/locale\u0026rdquo; \u0026ldquo;ko:ja:th:zh\u0026rdquo;\n改成 代码:\n\u0026ldquo;/usr/lib/gtk-2.0/2.4.0/immodules/im-xim.so\u0026rdquo;\n\u0026ldquo;xim\u0026rdquo; \u0026ldquo;X Input Method\u0026rdquo; \u0026ldquo;gtk20\u0026rdquo; \u0026ldquo;/usr/share/locale\u0026rdquo; \u0026ldquo;en:ko:ja:th:zh\u0026rdquo;\n保存退出，重启x-window就好了。\n其它参考：\n1，不希望使用一大堆用不着的输入法，可以关闭它：\nsudo gedit /usr/share/fcitx/data/tabels.conf\n把里面不要的输入法整段删除，至于双拼可以在下面说的config 里关闭\n2，在打字时要输入,.号经常按不出来，可以这样：\n~/.fcitx 目录下有一个 config 文件（启动至少一次fcitx 才会自动建立）可以配置翻页键把里面的 ,. 二个删除，不然在出联想时打不出,. 号\n3，不想让它一直显示在那，可以这样：\n~/.fcitx 目录下有一个 config 文件可以配置 代码:\n主窗口隐藏模式=1\n4，在英文local 下 fcitx 打出的字全方块，可以这样：\n修改上面说的这个config 里的 代码:\n显示字体(中)=字体名\n5，使用ctrl+左shift键可以切换输入方案\n6，其它应用技巧可以到fcitx的主页下载其最新版的使用说明书（pdf文档）。\n（4）主要程序界面的汉化\n据说如果安装系统的时候一直在线，那么不但输入法会完整安装，而且各种软件的简体中文包都会安装，如果像我这样不是一直在线的，那么需要到源上下载相应的中文包，才可以实现openoffice、firefox界面的中文显示。\nsudo apt-get install mozilla-firefox-locale-zh-cn openoffice.org-help-zh-cn openoffice.org-l10n-zh-cn\n(5)Abiword 中文乱码的解决办法\nAbiword是个很好的轻量级的文字编辑排版工具，我最欣赏它的是打开文档的速度和支持文档格式的种类多样性。但是安装后的Abiword默认只支持英文，输入中文会显示乱码，想显示正常的话还要设置字体为中文字体，每次都要设置，太麻烦。\n究其原因，是因为Styles的设置文件在/usr/share/AbiSuite-2.4/templates/下面，如果你使用的系统语言是简体中文，那么对应的abiword设置文件是normal.awt-zh_CN。可以使用以下方法来修改：\nsudo gedit /usr/share/AbiSuite-2.4/templates/normal.awt-zh_CN\n将Times New Roman替换为Microsoft YaHei（或者其它你喜欢的字体），然后保存即可。\n如果喜欢使用vim编辑，使用以下命令：\nsudo vim /usr/share/AbiSuite-2.4/templates/normal.awt-zh_CN\n然后在正常模式下输入冒号，键入以下命令：\n%s/\u0026lt;Times New Roman\u0026gt;/Microsoft YaHei/g\n再输入冒号，输入wq，回车即可。\n五、多媒体播放器的安装与配置\n（1）万能播放器mplayer\n这是个linux下面很流行的播放器，系统安装完后自带的有音频和视频播放器，但是都没有很全的解码器，所以很多东西都不能播放.\n从源上下载并安装mplayer：\nsudo apt-get install mplayer\n然后安装解码器包：\nsudo apt-get install w32codecs\n这时候，你就可以使用mplayer播放大多数媒体文件了。需要注意的是，如果打开媒体文件时提示视频设备有问题，那么可以在设置界面换一个视频驱动即可，直到没有问题为止。\nmplayer皮肤的安装：假设下载回来的是名字是skin_name.tar.bz2的压缩包：\nsudo tar jxvf /路径名/skin_name.tar.bz2\nsudo mkdir -p ~/.mplayer/skins #如果你是第一次安装皮肤，只需执行一次\nsudo cp /路径名/skin_name ~/.mplayer/skins/ \u0026amp;\u0026amp; mv ~/.mplayer/skins/{skin_name,the_other_name} #mplayer皮肤列表中将显示为the_other_name\n（2）音频播放器audacious及mp3文件tag乱码的解决\na、audacious\nmplayer虽是万能的，但是听音频文件最好还是用专门的音乐播放器，这里推荐现在开始流行的audacious.\nsudo apt-get install audacious\n安装audacious的解码器\nsudo apt-get install audacious-plugins audacious-plugins-extra audacious-plugins-extra-console\n安装完成，现在可以使用它来听多种格式的音频文件了。\n另外，audacious的播放列表默认使用UTF-8的编码，但大多数mp3使用的是GBK编码，所以播放列表上会出现乱码，我只发现一种不彻底解决的办法，就是打开audacious的设置界面，在插件栏目里面选择mpeg插件，在其首选项里面的“标题”里把“ID3格式”后面填上“GBK”，保存即可。这样以后再往播放列表里面添加歌曲的时候虽说刚开始还是乱码，但是当开始播放这首音乐的时候就会变成正常的标题，目前似乎还没有更好的方法。\nb、mp3的tag乱码\n使用工具：ID3iconv 0.2.1\n使用方法：cd 到你要的文件夹下，用这个命令转换：\njava -jar ~/id3iconv-0.2.1.jar -e GBK /路径/*.mp3\n注意：我这边用 -e 指定 mp3 原来的编码是 GBK 的。繁体中文就改为 Big5\n如果有很多个子文件夹，又不想一个一个 cd 到里面转换，可以配合 find 命令来解决：\nfind . -iname \u0026ldquo;*.mp3\u0026rdquo; -execdir java -jar ~/id3iconv-0.2.1.jar -e GBK {} ;\nfind 命令中的 -execdir 参数是让转换的程序在 找到的文件的 那个目录里执行， 也就相当于一个一个 cd 到里面再转换了。\n（3）媒体解码库gstreamer\ngstreamer是针对系统自带的音频和视频播放器的解码包，打开“新立得”软件包管理器在里面搜索gstreamer，你会得到一大堆结果，在里面选择你需要的解码包即可。\n六、网络工具的安装与配置\n（1）Opera的安装与配置及中文输入法问题的解决\nOpera是linux上另一款可以和Firefox比美的浏览器，占用系统资源比firefox低，性能比firefox要好，而且是唯一一个得到国际认证的浏览器，我尤其喜欢它极其强大的快捷键设置。但是源里现在似乎没有，需要从网上下载。\n打开www.opera.com，如果你在linux下使用firefox浏览的话，那么第一个页面应该就是opera的linux版，注意选择ubuntu下载包。\n下载下来之后双击运行，将会用deb解包器打开，点选上面的安装即可。下面介绍使用控制台安装的命令：（假设下载回来的文件名是opera.deb）\nsudo dpkg -i opera.deb\n卸载的时候使用：\nsudo dpkg -r opera\ndpkg是专门用来处理”.deb”格式的安装包的命令，更深的应用可在控制台下输入\ndpkg –help\n来了解。\n下面介绍opera界面的汉化，安装完成后只有英文语言文件，输入以下命令获取9.01版本的中 文语言文件：\nwget -c http://www.opera.com/download/lng/901/ouw901_zh-cn.lng\ngedit ouw*.lng\nctrl+H\n9.01-\u0026gt;9.10\n在opera浏览器的语言设置中选中*_zh-cn.lng即可\nopera安装后如果遇到中文输入法不能使用的问题，输入以下命令修改文件：\nsudo gedit /usr/bin/opera\n在开头添加:\nexport QT_IM_MODULE=XIM #使 SCIM 能够输入中文\nexport LC_ALL=zh_CN #使 Opera 能够以你选择的字体显示中文\n现在可以正常使用了。\n（2）即时通讯程序\n(a)集成即时通讯工具gaim\n系统已默认安装了集成即时通讯工具Gaim,但是系统默认安装的gaim不带QQ插件，现在打开“新立得”，在里面搜索gaim，然后卸载它。\n再到Gaim中国下载集成了QQ的gaim版本，网址是：www.gaimcn.com\n下载下来的是个deb包，使用刚才介绍的安装方法安装即可，安装完毕后就可以使用了，里面已集成有QQ协议。\nGaim使用中你会发现，如果你使用的是多帐号，那么它们要么同时在线，如果你设置状态为隐身，那么所有的帐号都被隐身，如果你希望设置帐号之间使用不同的状态，那么点击软件界面最下方的状态选择处，最下面有新建的按钮，新建一个状态，你可以设置有的帐号隐身，有的帐号在线，然后保存这个状态，以后选择相应的状态即可选择谁在线，谁隐身，需要注意的是你设置的时候要在这个新建的状态中为每个帐号选择一个状态，即你新建的其实是一个状态组合。\n(b)最逼真的QQ工具\nLumaQQ是linux下最逼真的QQ工具。\n它需要java运行时环境的支持，所以要先安装java运行时环境：\nsudo apt-get install sun-java5-jre\n设置当前默认的java解释器:\nsudo update-alternatives \u0026ndash;config java\n执行后会出现类似如下的画面:\nThere are 4 alternatives which provide `java\u0026#39;. Selection Alternative ----------------------------------------------- *+ 1 /usr/lib/jvm/java-gcj/jre/bin/java 2 /usr/bin/gij-wrapper-4.1 3 /usr/bin/gij-wrapper-4.0 4 /usr/lib/jvm/java-1.5.0-sun/jre/bin/java Press enter to keep the default[*], or type selection number: 输入 有包含 \u0026ldquo;sun\u0026rdquo; 的行的前面的数字。如上面显示，则输入 4，然后回车确定。\n然后到LumaQQ官方站点下载相应的压缩包，解压，然后将目录移入/opt目录：\nsudo mv /路径/LumaQQ /opt\n建立快捷方式：\nsudo gedit /usr/share/applications/LumaQQ.desktop\n在新增的文件内加入下面这几行\n1 2 3 4 5 6 7 8 [Desktop Entry] Name=LumaQQ Comment=QQ Client Exec=/opt/LumaQQ/lumaqq Icon=/opt/LumaQQ/QQ.png Terminal=false Type=Application Categories=Application;Network; 保存编辑过的文件,到(应用程序 -\u0026gt; Internat -\u0026gt; LumaQQ)执行之。\n（c）功能最强大的QQ工具Eva\nEva是KDE下面的一个QQ客户端，这里需要说明的是GNOME与KDE下的程序在彼此环境里是可以通用的，我使用后就毅然抛弃其它几种QQ客户端，因为它的界面不但小巧好看，而且最重要的是它的功能是linux下面最强的。\nEva可以接收图片、自定义表情，进行屏幕截图，传送图片，传送文件，可以说和官方QQ相比，除了视频、语音之外，它具备了所有实用的功能。\nsudo apt-get install eva\n（d）多协议即时通讯工具Kopete\nKopete也是KDE下面的工具，它类似GNOME下的gaim，但是我觉得不管是界面还是功能，都比gaim要好，如果你喜欢使用MSN,yahoo msg,ICQ等，可以安装这个东西：\nsudo apt-get install kopete\n（3）新闻阅读\n如果你希望阅读RSS聚合新闻，那么还要安装RSS新闻阅读器，这里推荐liferea:\nsudo apt-get install liferea\n另外我现在使用的一款KDE下的工具也很好：\nsudo apt-get install akregator\n（4）邮件客户端\n系统自带的evolution已经是很好的邮件客户端了，需要指出的是，在evolution里面设置gmail的帐号不用另外设置其pop和smtp的端口号，因为gmail的端口号与别的邮箱不同，在windows下面需要另外设置。\n（5）下载工具\n比较有名的是d4x，现在新兴的有个MultiGet,如果使用d4x的话，输入命令：\nsudo apt-get install d4x\n如果希望使用MultiGet,请到论坛下载，源里似乎没有。\n（6）p2p工具\nsudo apt-get install amule #win下的emule用这个代替\nsudo apt-get install Azureus #win下的bitcomet用这个代替\n七、编辑器、编译环境与词典\n（1）编辑器\nLinux下面的编辑器十分强大，功能也十分丰富，是windows下面的那些文本编辑器所不能比拟的。比较有名的是vim和emacs.\n这里以vim为例，使用源安装，输入命令：\nsudo apt-get install gvim\nvim的功能非常丰富和强大，最好找一些专门的资料去学习，另外它自带的也有很详细的帮助文件，只不过是英文的，英文好的可以看一下。\n（2）编译环境\nLinux是开源的，所以有很多发行版，像redhat,redflag,suse,ubuntu等等，这些发行版虽然都是使用的是linux内核，但是由于种种原因，系统的环境变量不尽相同，使用在一个系统上打包的安装包在另一个系统上安装程序，往往会出现问题，但是在所有的linux发行版中安装程序有一个普适的方法，就是使用源代码安装，这就需要编译环境，另外如果你想在linux下面编程，也需要它。\n输入命令：\nsudo apt-get install build-essential bin86 kernel-package libqt3-headers libqt3-mt-dev\n（3）词典\n星际译王是个很好的词典工具，它的功能相当于windows下面的金山词霸。\nsudo apt-get install stardict\n这里安装的只是星际译王的词典程序，它有很多词典供你选择安装，你可以到源上去选择：\nsudo apt-get install stardict*\n然后选择你喜欢的词典安装即可。也可以到其官方站点选择词典下载后安装。\nhttp://stardict.sourceforge.net/\n将下载的词典解压，然后复制或移动到/usr/share/stardict/dic\n八、NVIDA显卡驱动与Beryl的安装\nBeryl是linux下的一个主题管理程序，说它相当于windows下面的windowblinds不知道恰当不恰当。安装了beryl之后，linux的桌面变得比之windows vista有过之而无不及，喜欢漂亮界面的可以试用一下。\n当然，使用beryl的代价是牺牲系统性能，使用beryl的机子工作效率会比之前低一些。而且有人反映装了beryl之后会使系统变得非常慢，不知道是硬件的原因还是别的什么东西，不过大多数人应该不会出现什么问题，我的机子配置并不高，好几年前配的了，但是一直使用beryl都没有什么问题，速度也完全可以接受。\n下面介绍的是NVIDA的显卡下，beryl的安装。因为我用的就是nvida的显卡。\n另外需要说明的是下面的内容借鉴了论坛里面“NV 1.0-9629驱动+edgy+aiglx+Beryl方法汇总”的帖子，在此对作者表示感谢。\n（1）nvida显卡驱动的安装\n首先，要确认你的系统是全新安装的ubuntu6.10,而不是从6.06升级上来的，否则可能会出问题。\n其次，到http://www.nvidia.com/object/unix.html下载对应32/64位版本的驱动，假设放在/home/lans/下面，\n删除原有驱动(假设你安装过源里面的nvidia-glx驱动，如果没有装过或曾经手动安装驱动的可以跳过）：\nsudo apt-get \u0026ndash;purge remove nvidia-glx\n然后灰复X的设置\nsudo cp /etc/X11/xorg.conf.backup /etc/X11/xorg.conf\n重启，确定起动正常\n然后，执行命令：\nsudo gedit /etc/default/linux-restricted-modules-common\n在最后的双引号里面添加nv两个字，添加后就是“nv”\n预防起动X失败\nsudo cp /etc/X11/xorg.conf /etc/X11/xorg.conf.mybackup\n如果起动X失败，可以用sudo cp /etc/X11/xorg.conf.mybackup /etc/X11/xorg.conf来灰复X设置，然后起动\n以下为网络上留传的要点，原贴作者多台机器安装没有使用，我安装的时候也没有用，如果不 行，可以尝试（但是会删除受限制模块，导致某些别的硬件无法使用：\nsudo apt-get \u0026ndash;purge remove nvidia-settings nvidia-kernel-common\nsudo rm /etc/init.d/nvidia-*\n下面开始安装（对于曾经手动安装nv驱动的，可以在安装的时候选择卸载旧版的驱动）：\n请拿出一张纸和一支笔，记录下一下的命令，因为我们要去到纯终端里面安装\n注销后，按Ctrl+Alt+F1，输入用户名和密码，登录后关闭gdm：\nsudo /etc/init.d/gdm stop\n然后开始安装（假设下载的文件放在/home/lans/目录下）\nsudo sh /home/lans/NVIDIA-Linux-x86-1.0-9629-pkg1.run(如果你下载的是64位驱动 sudo sh /home/lans/NVIDIA-Linux-x86_64-1.0-9629-pkg1.run）\n进入安装界面后，首先接受协议，选“接受”\n可能会有提示已经安装了旧的驱动（视乎你自己是否有手动安装过），是否删除，选yes就是了， 一般会提示缺少模块，问是否网上下载，选“no”， 提示需要自己编译模块，选“ok”，然后编译安装开始， 最后提示需要修改xorg.conf，是否允许，选yes，完成安装，选ok。\n然后回到终端界面,重启gdm:\nsudo /etc/init.d/gdm start\n现在可以重启试试驱动是否已经装好，在“应用程序-》系统工具-》NVIDIA X server setting里面可以看到驱动的信息\n提示：每次更新内核后都需要重新安装nv的驱动！\n（2）安装Beryl\n1.添加源 ：\nsudo gedit /etc/apt/sources.list\n加入以下源的其中一个 ：\ndeb http://www.beerorkid.com/compiz edgy main-edgy\ndeb http://media.blutkind.org/xgl/ edgy main-edgy\ndeb http://compiz-mirror.lupine.me.uk/ edgy main-edgy\ndeb http://ubuntu.compiz.net/ edgy main-edgy\n如果是64位的：\ndeb http://www.beerorkid.com/compiz edgy main-edgy main-edgy-amd64\ndeb http://media.blutkind.org/xgl/ edgy main-edgy main-edgy-amd64\ndeb http://compiz-mirror.lupine.me.uk/ edgy main-edgy main-edgy-amd64\ndeb http://ubuntu.compiz.net/ edgy main-edgy main-edgy-amd64\n保存后退出\n然后加入钥匙，在控制台输入：（下面的任选其一）\nwget http://www.beerorkid.com/compiz/quinn.key.asc -O - | sudo apt-key add -\nwget http://media.blutkind.org/xgl/quinn.key.asc -O - | sudo apt-key add -\nwget http://compiz-mirror.lupine.me.uk/quinn.key.asc -O - | sudo apt-key add -\nwget http://ubuntu.compiz.net/quinn.key.asc -O - | sudo apt-key add -\n刷新库\nsudo apt-get update\nsudo apt-get dist-upgrade\n2.安装beryl\nsudo apt-get install beryl emerald emerald-themes\n修改xorg.conf\nsudo gedit /etc/X11/xorg.conf\n在 Section \u0026ldquo;Screen\u0026rdquo; 里面添加\nOption \u0026ldquo;AddARGBGLXVisuals\u0026rdquo; \u0026ldquo;True\u0026rdquo;\n保存并退出.\n下面为可选(我没有使用)：\n在 Section \u0026ldquo;Device\u0026rdquo; 里面添加\nOption \u0026ldquo;TripleBuffer\u0026rdquo; \u0026ldquo;true\u0026rdquo;\n添加如下一项：（本人没有添加）\nSection \u0026ldquo;Extensions\u0026rdquo;\nOption \u0026ldquo;Composite\u0026rdquo; \u0026ldquo;Enable\u0026rdquo;\nEndSection\n保存退出\n3.最后,在系统-》首选项-》会话-》起动程序 里面添加一项”beryl-manager“\n注销\nalt+ctrl+backspace，重启X\n再登录，就可以看到beryl的效果了。\n附：错误解决\n如果出现窗口框闪烁，可以在系统-》首选项-》会话-》起动程序 里面添加一项”emerald –replace“\nberyl 除了自己附带的主题，还可以到\nhttp://browse.deviantart.com/customizat \u0026hellip; linuxutil/\nhttp://gnome-look.org/\n去下载。\n（3）Splash Screen的安装\na、Ubuntu Splash\n即输入用户名和密码后进入桌面时显示的那个长方形图形，喜欢换皮的可以在以下路径修改：\n/usr/share/pixmaps/splash/ubuntu-splash.png\nb、OpenOffice Splash\n即运行openoffice时显示的那个图片，在以下路径：\n/usr/lib/openoffice2/program/openintro_ubuntu.bmp\nc、gimp splash\n/usr/share/gimp/2.0/images\n九、Wine的安装\nwine用来在linux下面运行一些windows下面的程序，不是所有的windows的程序都可以使用wine来运行，只是一部分。\n输入以下命令从源里安装wine：\nsudo apt-get install wine\n为了方便使用，建议安装EasyWine,这是个wine的辅助工具。\n可以到linux公社下载。\n安装完毕后，在控制台输入\nEasyWine即可启动程序，注意大小写，linux严格区分大小写。需要注意的是，如果运行时出现错误，就使用以下命令运行EasyWine,\nbash EasyWine\n通过以下命令可以设置wine的参数：\nwinecfg\n运行程序时使用以下命令：\nwine /程序路径/程序名称.exe\n十、虚拟机VMware\n如果有些事需要在windows下面做而又嫌装双系统麻烦的可以使用这个虚拟机。可以到linux公社下载，然后安装。linux公社上面有它的注册码，安装完后在“帮助”菜单里面输入注册码。\n解压后在控制台执行：\ncd /路径\n即进入该目录\n执行./vmware-install.pl\n十一、磁盘分区的挂载\n如果你在装系统时有的分区没有挂载，或者装完系统后磁盘分区有所变更，那么需要使用一些命令来重新挂载分区。\n（1）挂载一个原先存在而没有挂载的分区\n例如，我要挂载第二块磁盘第一分区(对应的是/dev/目录下面的hdd1,第二第三分区对应的是什么应在“系统管理”里面参看“设备管理器”)\n1.建立挂载目录\n一般把分区挂在/media下面，建立hdd1目录，此目录名字任意\nsudo mkdir /media/hdd1\n2、挂载分区\n分区为ntfs格式：\nsudo mount -t ntfs /dev/hdd1 /media/hdd1\n分区为fat32格式：\nsudo mount -t vfat /dev/hdd1 /media/hdd1\n3、自动挂载分区\n按照第二步的方法挂载的话，下次启动系统时不会自动挂载，要想让系统自动挂载该分区，输入以下命令：\nsudo cp /etc/fstab /etc/fstab_backup\nsudo gedit /etc/fstab\n在打开的文件里最后一行加入：\n/dev/hdd1 /media/hdd1 ntfs utf8,umask=0222 0 0\n如果是fat32分区，输入：\n/dev/hdd1 /media/hdd1 vfat utf8,umask=000 0 0\n保存并退出，重新启动系统即可。\n（2）新加入一块还没有分区的全新的硬盘\n论坛里有相应的帖子，此处不再赘言。\n十二、游戏\n（1）linux下面的游戏\nlinux志在成为一个稳定高效的操作平台，由于其应用方向和用户人群的特定性，所以这上面的游戏都是一些休闲类、智力类的小游戏。这并不是说linux就做不出大型的高质量的游戏来，比如DOOM，据说CS就是对DOOM的拙劣模仿。\n1、泡泡龙\nsudo apt-get install frozen-bubble\n2、百战天虫\n当然不是官方的东西，一个2D模仿百战天虫的东东\nsudo apt-get install wormux\n3、linux下的雷电\n看起来不错，但是我装上后速度非常慢，不知道什么原因。\nsudo apt-get install chromium\n4、等等\n在菜单中的“添加删除程序”中还有很多，可自行选择。\n（2）win下的游戏\n如果你安装了wine,那么windows下面的一些游戏你仍然可以玩，众所周知的就是魔兽争霸了，具体的设置方法见论坛上的相关帖子，由于我不常玩儿游戏，这里不作介绍，相信你选择linux也不是为了玩儿游戏的。\n十三、一些常用工具\n（1）读写ntfs分区\nubuntu默认只支持对ntfs分区的读操作，而不支持写操作，现在使用ntfs-3g已经可以实现对ntfs分区的写操作。\n需要特别说明的是，现在ntfs-3g还没有完美支持这项功能，据我使用的体会而言，在ntfs上建立文件和文件夹是没有问题的，但是删除文件的时候，回收站没有提示，文件其实已经移入该分区的”.Trash-用户名”目录里面了，只能手工清除了。另外，对中文的支持也不完美，有时候会出现带有中文的文件及文件夹均无法显示的问题。\nsudo apt-get install ntfs-3g\nsudo gedit /etc/fstab\n修改你的ntfs分区那一行，原先的\u0026quot;ntfs\u0026quot;改为\u0026quot;ntfs-3g\u0026quot;即可。例如我的是\n/dev/hda5 /media/hda5 ntfs-3g efaults,nls=utf8,umask=007,gid=46 0 0\nsudo gedit /etc/modules\n在文件末尾加上一行内容\u0026quot;fuse\u0026quot;\n重启生效，或是使用命令重新挂载\nsudo modprobe fuse\nsudo umount -a\nsudo mount -a\n如果出现问题，只需将上面的ntfs-3g替换为ntfs然后再重启或重新挂载即可。\n（2）java日记本\n一直觉得linux下面写日记没有什么好东西，后来想起来原来在windows下就用过一个java日记本，还不错。\n首先你应该确认已经安装了java运行时环境，如果没有，请参看lumaqq的安装部分。\n我在网上没有找到linux下面的压缩包，于是下了一个windows下面的安装程序，在虚拟机里安装后，将其文件夹复制出来。\n执行里面的jdiary.sh就行了，如果没有运行，那是因为该脚本是在win下编写的，里面的回车bash不认所致，使用gedit打开该脚本，然后把里面的回车全部删除，再重新回车即可。\n（3）图片管理Picasa\nGoogle的这款图片管理软件相信很多人都知道吧，到它的主页下载并安装即可。\n（4）光碟烧录GnomeBaker\nsudo apt-get install gnomebaker\n（5）CHM阅读器\n很多电子书都是chm格式的，如果需要阅读，可以使用这个工具，在“新立得”或“添加删除程序”里面找吧。\n有些chm文件阅读时会出现乱码或者左边的目录显示不出来的问题，这时需要使用别的工具来阅读了，我现在使用的是firefox的一款插件chm reader，你可以到它的插件下载网页下载安装，一次看不完时还可以把当前页面加入收藏夹，下次直接打开收藏夹中链接即可，很方便。\n（6）数学程序\na、scilab:功能相当于matlab,法国科学院出品。\nsudo apt-get install scilab\nb、Maxima:出身名门，上个世纪六十年代由MIT（麻省理工）开发，原来美军赞助的东东，功能相当于mathematica，我现在就是以它为计算工具，非常好用。\nsudo apt-get install maxima\n安装后的maxima没有图形用户界面，它是在控制台上运行的，当然你可以安装它的图形用户界面：\nsudo apt-get install wxmaxima\n十四、Linux下程序的安装\n（1）deb软件包的安装\ndeb是Debian Linux提供的一个包管理器，优点是不被严格的依赖性检查所困扰。ubuntu使用的就是这种软件包。\n安装方法：\nsudo dpkg -i /软件包路径/软件包名字.deb\n卸载方法：\nsudo dpkg -r 软件名字\n另外在ubuntu桌面版中你也可以直接双击该软件包，里面有安装按钮。\n（2）rpm软件包的安装\nRPM全称是Red Hat Package Manager（Red Hat包管理器）。它最初是RedHat开发的软件包，在很多linux发行版上应用很广泛。在ubuntu中，应先将其转化为deb包，然后再安装，转化方法为：\nsudo alien 软件包名称.rpm\n然后再执行sudo dpkg -i 软件包名称.deb\n如果提示不认alien命令，执行：\nsudo apt-get install alien\n（3）使用源码进行安装\n使用源代码安装软件，能按照用户的需要选择定制的安装方式进行安装，而不是仅仅依靠那些在安装包中的预配置的参数选择安装。它可以克服linux发行版众多的问题。\n首先将下载回来的源码解压到一个目录里，然后进入这个目录：\ncd /目录路径\n获得root权限：\nsu root\n执行：\n./configure 配置选项 #本步非必须，你下载源码的时候一般在下载页面都会有安装提示，源码包里的Readme和Install文件也会有说明，如果说要执行这一步，那么按照提示操作即可。\n下面编译：\nmake\n如果提示出错，那么看看上面./configure后有没有提示有什么东西不存在，如果有，只要执行：sudo apt-get install 该缺失组件名称 即可。\n下面安装：\nmake install\n下一步为可选，用来清除安装时产生的临时文件：\nmake clean\n卸载时进入该源码目录，执行：\nmake uninstall\n（4）绿色软件\n解压即可运行的程序。\n解压后cp或mv到任一目录即可。\n十五、其它GUI的安装\n1、KDE\nKDE是和GNOME齐名的一个GUI，它可以和GNOME共存，在登录界面可以选择是从KDE启动还是从GNOME启动，KDE和GNOME下面的程序在彼此上面都可以运行。使用下面命令安装KDE及KDE下常用工具：\nsudo apt-get install kubuntu-desktop\n安装完成后会提示你使用KDM还是GDM，这两个分别是两者之下的桌面管理程序，随便选择一个即可，以后如果想切换，执行以下命令：\nsudo dpkg-reconfigure kdm\n十六、进阶技巧\n（1）关于Grub的FAQ\n1、如何使用liveCD修复Grub？\n在终端下输入：\nsudo su\ngrub\n你应该看到像这样的东西：\ngrub\u0026gt;\n接着输入：\nroot (hdx,y)\nsetup (hdx)\n不要完全照样输入，先弄懂这些命令的含义。\nhd表示硬盘，格式是\n(hd硬盘号,分区号)\n从零开始计算。\n所以（按照日常的习惯，从1开始数），(hd0,0)表示第一个硬盘的第一个分区，(hd0,1)表示第一个硬盘的第2个分区，(hd1,4)表示第2个硬盘的第5个分区。\n（注意，linux系统里是用hda1表示第一个硬盘的第一个分区，不要把它和grub中的表示混起来。）\nroot (hdx,y)\n这里的(hdx,y) 是/boot 目录所在的分区（通常情况下，也就是你装ubuntu系统的分区，除非你安装的时候把/boot分出去了。）如果你不知道你把ubuntu装在第几个分区，可以在输入root (hd0, 时按Tab键来补全。（假设你把ubuntu装在第一块硬盘上）\n按了tab后，你将看到一些有关各个分区的信息。通常你可以通过分区的大小和格式看出你把ubuntu系统装在哪里了。\nsetup (hdx) 通常情况下，是setup (hd0)。（多半你把ubuntu装在第一块硬盘上。）要注意的是，不要输入setup (hd0,0)。我曾经犯过这个错误。(如果你没把命令抄下来，凭记忆操作的话，可能会犯这种错误。）\n最后，用\nquit\n退出grub,重启系统。\n2、两块硬盘，第一块装ubuntu，第二块装winxp,怎样设置grub使之可引导xp?\nsudo gedit /boot/grub/menu.lst\n然后在最后加上如下内容即可：\ntitle Microsoft Windows XP Professional\nroot (hd1,0)\nmakeactive\nmap (hd0) (hd1)\nmap (hd1) (hd0)\nchainloader +1\n（2）桌面图标隐藏、显示设置\n执行：\ngconf-editor\n在下面路径设置：\napp-\u0026gt;nautilus-\u0026gt;desktop-\u0026gt;vomules_visible\n（3）在/var/cache/apt/archives里面发现大量原来使用apt-get下来的deb包，太占空间了，能不能删掉？\n执行：\nsudo apt-get clean\n（4）gvim的字体太难看，怎样设置为雅黑?\n首先应确认你已安装雅黑字体，然后执行：\ntouch /.gvimrc //已存在/.gvimrc文件就直接执行下面的\ncat \u0026raquo; ~/.gvimrc\n\u0026ldquo;设置默认字体\nset guifont=Microsoft\\ YaHei\n（5）为什么键盘上的左右箭头不能用了？\n不知道是系统自己的bug还是别的什么原因，这是因为你在“系统”－“首选项”里面设置了快捷键，在快捷键里面删除使用左右箭头的键即可解决问题。\n(6)有些常用命令记不住怎么办?\n如今的GNOME和KDE图形用户界面已经可以完成几乎一切工作了，但是命令行在做很多工作的时候非常方便，所以经常使用的命令比较长或者不容易记住会是件很崩溃的事情，不过可以使用以下方法缩短这些命令:\n在终端中输入:\nsudo gedit /etc/bash.bashrc\n在打开的文件里面加入以下代码:\nalias update=\u0026lsquo;sudo apt-get update\u0026rsquo;\nalias upgrade=\u0026lsquo;sudo apt-get dist-upgrade\u0026rsquo;\nalias go=\u0026lsquo;pon dsl-provider\u0026rsquo;\n这里列出了三个自定义命令:第一个使用update代替单引号中的命令，这样以后在终端中直接输入update就可以更新源中程序的列表了；第二个使用upgrade代替后面单引号中的内容，以后使用upgrade即可在源得到更新后更新系统，第三个使用go来代替后面的ADSL拨号命令。\n自定义命令是可以任意起名字的，但是事前你应该确认系统中没有这个命令，可以在终端中输入你想用的单词并回车，如果提示没有这个命令，才可以自定义。\n（7）快速搜索文件\n当然你可以使用系统自带的图形界面的搜索工具，事实上我也经常使用它；也可以安装类似windows下面的百度硬盘、Google桌面一样的桌面搜索工具“Beagle”；但是我不喜欢前者的低速和后者过于占用内存，以前在windows下，我喜欢使用一款叫“locate32”的搜索工具，它只需先建立一个硬盘中数据的数据库，然后什么时候需要搜索，什么时候打开它就行了。这种工具借鉴了桌面搜索的快速和普通搜索工具的平时不占用系统资源的优点，所以我很喜欢。\n在linux下面，系统同样提供了这样一个工具，它应该是默认就安装上了的。\n首先，在控制台下输入命令：\nsudo updatedb\n键入密码后开始建立数据库，完成后输入：\nlocate 关键词\n即可找到硬盘中所有携带该关键词的文件。\n这种工具的缺点也很明显，由于它平时不运行，所以它不能实时捕捉到硬盘上文件的变化，如果你所要找的文件比数据库建立的时间要新，那么可能就找不到。所以要经常利用系统空闲的时间更新数据库。\n（8）“不打开”音乐播放器预听mp3\nwindows下面可以在某音乐文件上单击鼠标选中后在文件夹中预听，在linux下会更简单、有趣：\nsudo apt-get install mpg123\nmpg123是linux命令行界面下听mp3的工具，经常工作在CLI（COMMAND LINE INTERFACE）下又喜欢听歌的人是不会陌生的。\n在GNOME（KDE下我没有试）下它会有另一种妙用，安装成功后，打开音乐文件夹，找到一个mp3格式的文件，将鼠标箭头放上去，什么都不用做，音乐会自动播放，当你将鼠标箭头移走时，音乐自动停止。\n这是因为鼠标箭头放在mp3文件上时，系统会自动调用mpg123在后台播放该文件，箭头移走后，mpg123自动关闭，所以不用担心会无谓的占用系统资源。\n","permalink":"http://0x3f.org/posts/ubuntu-610-tutorial/","summary":"\u003cp\u003e\u003ca HREF=\"http://forum.ubuntu.org.cn/viewtopic.php?t=32798\u0026amp;highlight=\" TARGET=\"_blank\"\u003e\u003ca href=\"http://forum.ubuntu.org.cn/viewtopic.php?t=32798\u0026amp;amp;highlight=\"\u003ehttp://forum.ubuntu.org.cn/viewtopic.php?t=32798\u0026amp;amp;highlight=\u003c/a\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"目录\"\u003e目录\u003c/h2\u003e\n\u003cp\u003e一、安装Edgy与硬盘的分区\u003cbr\u003e\n（1）安装与分区\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;3\u003cbr\u003e\n（2）多硬盘需要注意的一点\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;3\u003cbr\u003e\n（3）Linux下硬盘分区的概念\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-4\u003cbr\u003e\n二、改变账户操作理念\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-4\u003cbr\u003e\n三、修改源并配置网络\u003cbr\u003e\n（1）源及其使用方法\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-5\u003cbr\u003e\n（2）配置ADSL网络\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-6\u003cbr\u003e\n四、系统的中文化与输入法\u003cbr\u003e\n（1）系统的中文化\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;6\u003cbr\u003e\n（2）中文字体的美化\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-6\u003cbr\u003e\n（3）中文输入法的安装与配置\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;8\u003cbr\u003e\n（4）主要程序界面的汉化\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;11\u003cbr\u003e\n（5）Abiword中文乱码的解决办法\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-11\u003cbr\u003e\n五、多媒体播放器的安装与配置\u003cbr\u003e\n（1）万能播放器 mplayer\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-12\u003cbr\u003e\n（2）音频播放器 audacious 及 mp3 文件 tag 乱码的解决\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-12\u003cbr\u003e\n（3）媒体解码库 gstreamer\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;13\u003cbr\u003e\n六、网络工具的安装与配置\u003cbr\u003e\n（1）Opera 的安装与配置及中文输入法问题的解决\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;13\u003cbr\u003e\n（2）即时通讯程序\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;14\u003cbr\u003e\n（a）集成即时通讯工具 gaim\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-14\u003cbr\u003e\n（b）最逼真的 QQ 工具\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;15\u003cbr\u003e\n（c）功能最强大的 QQ 工具 Eva\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;16\u003cbr\u003e\n（d）多协议即时通讯工具 Kopete\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-16\u003cbr\u003e\n（3）新闻阅读\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-16\u003cbr\u003e\n（4）邮件客户端\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;17\u003cbr\u003e\n（5）下载工具\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-17\u003cbr\u003e\n（6）p2p 工具\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-17\u003cbr\u003e\n七、编辑器、编译环境与词典\u003cbr\u003e\n（1）编辑器\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;17\u003cbr\u003e\n（2）编译环境\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-17\u003cbr\u003e\n（3）词典\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;18\u003cbr\u003e\n八、NVIDA 显卡驱动与 Beryl 的安装\u003cbr\u003e\n（1）nvida 显卡驱动的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;18\u003cbr\u003e\n（2）安装 Beryl\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;20\u003cbr\u003e\n（3）Splash Screen 的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;22\u003cbr\u003e\n九、Wine 的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;22\u003cbr\u003e\n十、虚拟机 Vmware\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;23\u003cbr\u003e\n十一、磁盘分区的挂载\u003cbr\u003e\n（1）挂载一个原先存在而没有挂载的分区\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;23\u003cbr\u003e\n（2）新加入一块还没有分区的全新的硬盘\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;24\u003cbr\u003e\n十二、游戏\u003cbr\u003e\n（1）linux 下面的游戏\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-25\u003cbr\u003e\n（2）win 下的游戏\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;25\u003cbr\u003e\n十三、一些常用工具\u003cbr\u003e\n（1）读写 ntfs 分区\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-25\u003cbr\u003e\n（2）java 日记本\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-26\u003cbr\u003e\n（3）图片管理 Picasa\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;26\u003cbr\u003e\n（4）光碟烧录 GnomeBaker\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-26\u003cbr\u003e\n（5）CHM 阅读器\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;26\u003cbr\u003e\n（6）数学程序\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-27\u003cbr\u003e\n十四、Linux 下程序的安装\u003cbr\u003e\n（1）deb 软件包的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;27\u003cbr\u003e\n（2）rpm 软件包的安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;27\u003cbr\u003e\n（3）使用源码进行安装\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;28\u003cbr\u003e\n（4）绿色软件\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;29\u003cbr\u003e\n十五、其它 GUI 的安装\u003cbr\u003e\n（1）KDE\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;29\u003cbr\u003e\n十六、进阶技巧\u003cbr\u003e\n（1）关于 Grub 的 FAQ\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;29\u003cbr\u003e\n（2）桌面图标隐藏、显示设置\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;31\u003cbr\u003e\n（3）在/var/cache/apt/archives 里面发现大量原来使用 apt-get 下来的 deb 包，太占空间了，能不能删掉？31\u003cbr\u003e\n（4）gvim 的字体太难看，怎样设置为雅黑?\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;31\u003cbr\u003e\n（5）为什么键盘上的左右箭头不能用了？\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;31\u003cbr\u003e\n（6）有些常用命令记不住怎么办?\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;32\u003cbr\u003e\n（7）快速搜索文件\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;32\u003cbr\u003e\n（8）“不打开”音乐播放器预听 mp3\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;33\u003c/p\u003e","title":"UBUNTU 6.10 Edgy Eft 入门全程导用"},{"content":"前一段的维金，现在的熊猫烧香，windows上总是不消停。\n当年的冲击波，那是我唯一一次中毒的经历，居然还很兴奋。自从转到Linux，感觉这些都离我越来越远，窃自暗爽。\n说到瑞星和卡巴斯基的撕逼，曾经也为选杀毒软件很头疼，后来幡然醒悟，只是个心理安慰，随便装一个就行了。当然，还是现在在Linux上裸奔更好。\n","permalink":"http://0x3f.org/posts/panda-burning-joss-sticks/","summary":"\u003cp\u003e前一段的维金，现在的熊猫烧香，windows上总是不消停。\u003c/p\u003e\n\u003cp\u003e当年的冲击波，那是我唯一一次中毒的经历，居然还很兴奋。自从转到Linux，感觉这些都离我越来越远，窃自暗爽。\u003c/p\u003e\n\u003cp\u003e说到瑞星和卡巴斯基的撕逼，曾经也为选杀毒软件很头疼，后来幡然醒悟，只是个心理安慰，随便装一个就行了。当然，还是现在在Linux上裸奔更好。\u003c/p\u003e","title":"「熊猫烧香」"}]