---
layout: post
title: PHP序列化方案效率比較
tags:
- PHP
- 編程
status: publish
type: post
published: true
comments: true
meta:
  views: '855'
  _edit_last: '1'
  aktt_notify_twitter: 'no'
---
<p>同時對以下幾種PHP的序列化方案進行了測試：</p>

<ul>
<li>serialize() and unserialize()</li>
<li>json_encode() and json_decode()</li>
<li>msgpack_serialize() and msgpack_unserialize()</li>
<li>igbinary_serialize() and igbinary_unserialize()</li>
</ul>

<p>測試環境：</p>

<ul>
<li>OS:        Archlinux 32-bit</li>
<li>CPU:       CORE 2 DUO T9400, 2.53GHz</li>
<li>Mem:       DDR3, 3G</li>
<li>Server:    nginx v1.0.0</li>
<li>PHP:       php v5.3.6 + php-fpm</li>
<li>Profiler:  xhprof v0.9.2</li>
</ul>

<p>測試代碼塊：</p>

{% codeblock lang:php %}
<?php
class Test{
    function __construct(){
        $this->value = str_repeat('a', 1000);
    }
}

function produce($num)
{
    $arr = array();
    for ($i = 0; $i < $num; $i++) {
        $arr[] = new Test();
    }

    $data = serialize($arr);

    $arr = unserialize($data);

    $data = json_encode($arr);

    $arr = json_decode($data);

    $data = msgpack_serialize($arr);

    $arr = msgpack_unserialize($data);

    $data = igbinary_serialize($arr);

    $arr = igbinary_unserialize($data);
}

produce(10000);
?>
{% endcodeblock %}

<p>測試結果：</p>

<p><a href="https://picasaweb.google.com/lh/photo/TAyUpJxyW3RVj18DU4B9gg?feat=embedwebsite"><img src="https://lh6.googleusercontent.com/-2iBCMB4kyOg/Taq-aeruqEI/AAAAAAAABp4/wyqG-Qt5s0c/s400/php_serialization.png" height="124" width="400" /></a></p>

<ul>
<li>序列化性能：serialize() <strong><em>24.611ms</em></strong> &gt; msgpack_serialize() <strong><em>32.687ms</em></strong> &gt; igbinary_serialize() <strong><em>36.012ms</em></strong> &gt; json_encode() <strong><em>132.142ms</em></strong></li>
<li>反序列化性能：igbinary_unserialize() <strong><em>12.141ms</em></strong> &gt; msgpack_unserialize() <strong><em>17.185ms</em></strong> &gt; unserialize() <strong><em>28.723ms</em></strong> &gt; json_decode() <strong><em>183.141ms</em></strong></li>
<li>綜合性能：igbinary <strong><em>48.153ms</em></strong> &gt; msgpack <strong><em>49.872ms</em></strong> &gt; serialize <strong><em>53.334ms</em></strong> &gt; json <strong><em>315.283ms</em></strong></li>
</ul>

<p>測試結果并沒有像傳說中的那樣，官方的序列化和反序列化函數性能與msgpack和igbinary兩個第三方的擴展相差不大，而JSON性能非常差。</p>

<p>Posted via <a href="http://0x3f.org/?p=1894">UltraBlog.vim</a>.</p>
