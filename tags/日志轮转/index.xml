<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>日志轮转 on 晴耕雨讀</title><link>http://0x3f.org/tags/%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC/</link><description>Recent content in 日志轮转 on 晴耕雨讀</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>© 淘气 2022</copyright><lastBuildDate>Mon, 15 Jan 2024 16:48:09 +0800</lastBuildDate><atom:link href="http://0x3f.org/tags/%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC/index.xml" rel="self" type="application/rss+xml"/><item><title>轻松管理 Docker 下的 MariaDB 错误日志：重定向到日志控制台和日志轮转</title><link>http://0x3f.org/posts/steps-to-implement-redirection-and-rotation-for-error-logs-of-docker-deployed-mariadb/</link><pubDate>Mon, 15 Jan 2024 16:48:09 +0800</pubDate><guid>http://0x3f.org/posts/steps-to-implement-redirection-and-rotation-for-error-logs-of-docker-deployed-mariadb/</guid><description>本文旨在通过把 MariaDB 的错误日志重定向到 Docker 的错误控制台以实现通过 Loki 收集日志，并使用日志轮转控制日志文件大小。
指定固定的日志文件名 1 2 [mariadb] log_error=/config/databases/mariadb.err 把容器中的错误日志重定向到 Docker 日志控制台 在容器的环境变量中添加以下内容：
1 2 DOCKER_MODS=lscr.io/linuxserver/mods:universal-stdout-logs LOGS_TO_STDOUT=/config/databases/mariadb.err 设置 MariaDB 的 root@localhost 用户的鉴权方式 创建 root@localhost 用户：
1 CREATE USER &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED VIA &amp;#39;unix_socket&amp;#39;; 或更改已存在的 root@localhost 用户的鉴权方式：
1 ALTER USER &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED VIA &amp;#39;unix_socket&amp;#39;; 受权 RELOAD 给 root@localhost 用户 1 GRANT RELOAD ON *.* TO &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39;;` 配置 logrotate 在宿主机创建 /etc/logrotate.d/mariadb：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 /mnt/user/appdata/mariadb/databases/mariadb.</description></item></channel></rss>