<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Nginx on 晴耕雨讀</title><link>http://0x3f.org/tags/nginx/</link><description>Recent content in Nginx on 晴耕雨讀</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>© 淘气 2021</copyright><lastBuildDate>Tue, 14 Feb 2017 13:35:41 +0000</lastBuildDate><atom:link href="http://0x3f.org/tags/nginx/index.xml" rel="self" type="application/rss+xml"/><item><title>用NGINX实现WSS</title><link>http://0x3f.org/posts/implement-wss-with-nginx/</link><pubDate>Tue, 14 Feb 2017 13:35:41 +0000</pubDate><guid>http://0x3f.org/posts/implement-wss-with-nginx/</guid><description>实现基于SSL的安全的WebSocket。
NGINX配置 server { listen 4431; server_name ws.sample.com; ssl on; ssl_certificate ssl/server.crt; ssl_certificate_key ssl/server.key; ssl_session_timeout 5m; ssl_session_cache shared:SSL:50m; ssl_protocols SSLv3 SSLv2 TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP; location / { proxy_pass http://127.0.0.1:4759; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &amp;quot;Upgrade&amp;quot;; proxy_set_header X-Real-IP $remote_addr; proxy_read_timeout 60s; } } 常见问题 连不上或连接时报错 WebSocket network error: OSStatus Error -9807: Invalid certificate chain
如果使用的是自签证书或者证书针对的域名和连接所指定的不符，会出这种问题。
wss一分钟自动断开 NGINX里设置proxy_read_timeout或者程序实现心跳。</description></item><item><title>用OpenResty自动转换silk到MP3</title><link>http://0x3f.org/posts/convert-silk-to-mp3-with-openresty/</link><pubDate>Wed, 25 Jan 2017 18:59:00 +0000</pubDate><guid>http://0x3f.org/posts/convert-silk-to-mp3-with-openresty/</guid><description>PHP没有原生的转换silk格式音频到mp3的方案，所以考虑用NGINX+Lua调用命令行工具实现。
思路 当访问以「.silk.mp3」为后缀的文件时，查找对应的mp3文件，存在则返回，否则，如果对应的silk文件存在，调用命令行工具转换文件格式，然后内部重定向到新生成的mp3。
安装 OpenResty silk-v3-decoder ffmpeg NGINX配置 1 2 3 location ~* /.*\.silk\.mp3$ { content_by_lua_file &amp;#34;/opt/script/silk2mp3.lua&amp;#34;; } Lua脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 function file_exists(name) local f=io.open(name,&amp;#34;r&amp;#34;) if f~=nil then io.close(f) return true else return false end end local resource = ngx.var.request_filename; local realResource = resource:sub(1, #resource - 9).</description></item><item><title>NGINX: 405 Not Allowed</title><link>http://0x3f.org/posts/nginx-405-not-allowed/</link><pubDate>Sun, 19 Feb 2012 00:00:00 +0000</pubDate><guid>http://0x3f.org/posts/nginx-405-not-allowed/</guid><description>NGINX不允许向静态文件提交POST方式的请求，否则报405错误。测试方法为，使用curl向服务器上的静态文件提交POST请求：
```bash curl -d 1=1 http://localhost/version.txt ``` 得到以下结果： ```html 405 Not Allowed 405 Not Allowed nginx/1.0.11 ``` 网上传抄的添加以下配置的解决办法不可用：
```nginx error_page 405 =200 @405; location @405 { root /srv/http; } ``` 一种不完美但可用的方法为：
```nginx upstream static_backend { server localhost:80; } server { listen 80; # ... error_page 405 =200 @405; location @405 { root /srv/http; proxy_method GET; proxy_pass http://static_backend; } } ``` 即转换静态文件接收的POST请求到GET方式。
Posted via UltraBlog.vim.</description></item><item><title>读完《Nginx HTTP Server》</title><link>http://0x3f.org/posts/after-reading-nginx-http-server/</link><pubDate>Fri, 29 Apr 2011 00:00:00 +0000</pubDate><guid>http://0x3f.org/posts/after-reading-nginx-http-server/</guid><description>昨天晚上在杭州飞北京的飞机上读完了这本书，用Kindle DXG。
作者是江苏科技大学的一位外籍老师，所以这本书也很有教科书的风格，先用一章的篇幅介绍Linux的相关概念和日常操作，而后通过和Apache的对比讲述了Nginx的主要特性，并使用Wordpress、MediaWiki等作了实例讲解。面面俱到，简单易懂，但并不深入。
目前介绍Nginx的书还不多，这本算得上是其中很好的一本。但是前六十页都是介绍Linux的基本概念，和后面的内容关系不大，显得很突兀，且很不KISS，对于一本只有三百多页的小书来说，这个篇幅很令人遐想。抛开这一点，这本书当属眼下入门Nginx的优秀指南。
Posted via UltraBlog.vim.</description></item></channel></rss>