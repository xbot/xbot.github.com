<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>全文检索 on 晴耕雨讀</title><link>http://0x3f.org/tags/%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/</link><description>Recent content in 全文检索 on 晴耕雨讀</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>© 淘气 2022</copyright><lastBuildDate>Mon, 19 Jun 2017 23:10:41 +0000</lastBuildDate><atom:link href="http://0x3f.org/tags/%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/index.xml" rel="self" type="application/rss+xml"/><item><title>用MySQL的全文检索实现相关性排序</title><link>http://0x3f.org/posts/fulltext-searching-in-mysql/</link><pubDate>Mon, 19 Jun 2017 23:10:41 +0000</pubDate><guid>http://0x3f.org/posts/fulltext-searching-in-mysql/</guid><description>实现根据文章的关键词搜索出相关的文章，并按相关性排序。
数据库版本是5.6.x，还不能像5.7那样支持中文的全文检索，所以另外创建一列保存关键词的编码。方法为base64转码并去掉「%」符号：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 &amp;lt;?php /** * 转换关键词到全文检索的格式 * * @param mixed $keywords 关键词数组或英文逗号分隔的字符串 * @return string */ function encode_keywords($keywords) { $encoder = function ($keyword) { return str_replace(&amp;#39;%&amp;#39;, &amp;#39;&amp;#39;, urlencode(trim($keyword))); }; if (!is_array($keywords)) { $keywords = explode(&amp;#39;,&amp;#39;, $keywords); } return implode(&amp;#39; &amp;#39;, array_map($encoder, $keywords)); } 对该列创建全文检索的索引：
1 CREATEFULLTEXTINDEXidx_post_keywordsONposts(keywords_ft); 查询语句：
1 2 3 4 5 6 7 8 9 10 11 SELECTid,title,keywords,(MATCH(keywords_ft)AGAINST(&amp;#39;E697B6E5B09A E5A8B1E4B990E59C88&amp;#39;INNATURALLANGUAGEMODE))AS`score`FROMpostsWHEREMATCH(keywords_ft)AGAINST(&amp;#39;E697B6E5B09A E5A8B1E4B990E59C88&amp;#39;INNATURALLANGUAGEMODE)ORDERBYscoreDESCLIMIT10</description></item></channel></rss>