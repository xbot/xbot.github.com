<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>晴耕雨讀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晴耕雨讀">
<meta property="og:url" content="http://0x3f.org/page/22/index.html">
<meta property="og:site_name" content="晴耕雨讀">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晴耕雨讀">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93233020-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">目录</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="https://t.me/s/blingings">不灵</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://0x3f.org"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-project-euler-21" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-21/"><strong>Project Euler Problem 21 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-21/" class="article-date">
  <time datetime="2014-04-17T14:18:00.000Z" itemprop="datePublished">2014-04-17</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-21/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Amicable-numbers"><a href="#Amicable-numbers" class="headerlink" title="Amicable numbers"></a>Amicable numbers</h2><p>Let d(n) be defined as the sum of proper divisors of n (numbers less than n which divide evenly into n).<br>If d(a) = b and d(b) = a, where a ≠ b, then a and b are an amicable pair and each of a and b are called amicable numbers.</p>
<p>For example, the proper divisors of 220 are 1, 2, 4, 5, 10, 11, 20, 22, 44, 55 and 110; therefore d(220) = 284. The proper divisors of 284 are 1, 2, 4, 71 and 142; so d(284) = 220.</p>
<p>Evaluate the sum of all the amicable numbers under 10000.</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight python"><figcaption><span>p21.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum_proper_factors</span><span class="params">(n)</span>:</span></span><br><span class="line">    (result, sqrt) = (<span class="number">1</span>, n ** <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    (start, step) = n % <span class="number">2</span> == <span class="number">1</span> <span class="keyword">and</span> (<span class="number">3</span>, <span class="number">2</span>) <span class="keyword">or</span> (<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(start, int(sqrt) + <span class="number">1</span>, step):</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            result += i + n / i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sqrt == int(sqrt):</span><br><span class="line">        result -= sqrt</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10000</span>):</span><br><span class="line">        sum1 = sum_proper_factors(i)</span><br><span class="line">        <span class="keyword">if</span> sum1 &gt; i:</span><br><span class="line">            <span class="keyword">if</span> i == sum_proper_factors(sum1):</span><br><span class="line">                result += i + sum1</span><br><span class="line">    <span class="keyword">print</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    startTime = time.time()</span><br><span class="line">    main()</span><br><span class="line">    <span class="keyword">print</span> time.time() - startTime</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><figcaption><span>p21.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum_proper_factors</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	sum, sqrt := <span class="number">1</span>, math.Sqrt(<span class="keyword">float64</span>(n))</span><br><span class="line"></span><br><span class="line">	start, step := <span class="number">2</span>, <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> n%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">		start, step = <span class="number">3</span>, <span class="number">2</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := start; i &lt;= <span class="keyword">int</span>(sqrt); i += step &#123;</span><br><span class="line">		<span class="keyword">if</span> n%i == <span class="number">0</span> &#123;</span><br><span class="line">			sum += i + n/i</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> sqrt == <span class="keyword">float64</span>(<span class="keyword">int</span>(sqrt)) &#123;</span><br><span class="line">		sum -= <span class="keyword">int</span>(sqrt)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	result, startTime := <span class="number">0</span>, time.Now()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">		iSum := sum_proper_factors(i)</span><br><span class="line">		<span class="keyword">if</span> iSum &gt; i &#123;</span><br><span class="line">			<span class="keyword">if</span> i == sum_proper_factors(iSum) &#123;</span><br><span class="line">				result += i + iSum</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(result, time.Now().Sub(startTime))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’m the 70186th person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-20" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-20/"><strong>Project Euler Problem 20 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-14</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-20/" class="article-date">
  <time datetime="2014-04-14T14:19:00.000Z" itemprop="datePublished">2014-04-14</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-20/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Factorial-digit-sum"><a href="#Factorial-digit-sum" class="headerlink" title="Factorial digit sum"></a>Factorial digit sum</h2><p>n! means n × (n − 1) × … × 3 × 2 × 1</p>
<p>For example, 10! = 10 × 9 × … × 3 × 2 × 1 = 3628800,<br>and the sum of the digits in the number 10! is 3 + 6 + 2 + 8 + 8 + 0 + 0 = 27.</p>
<p>Find the sum of the digits in the number 100!</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight python"><figcaption><span>p20.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    product = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">101</span>):</span><br><span class="line">        product *= i</span><br><span class="line">    <span class="keyword">print</span> sum([int(x) <span class="keyword">for</span> x <span class="keyword">in</span> str(product)])</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><figcaption><span>p20.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math/big"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    product := big.NewInt(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">101</span>; i++ &#123;</span><br><span class="line">        product.Mul(product, big.NewInt(<span class="keyword">int64</span>(i)))</span><br><span class="line">    &#125;</span><br><span class="line">    sum := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> idx := <span class="keyword">range</span> product.String() &#123;</span><br><span class="line">        tmp, _ := strconv.Atoi(product.String()[idx : idx+<span class="number">1</span>])</span><br><span class="line">        sum += tmp</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’m the 100089th person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-a-ride-to-lugou-bridge" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/a-ride-to-lugou-bridge/"><strong>骑行卢沟桥</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-13</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/a-ride-to-lugou-bridge/" class="article-date">
  <time datetime="2014-04-13T11:55:00.000Z" itemprop="datePublished">2014-04-13</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/行见/">行见</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/a-ride-to-lugou-bridge/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>更始元年三月癸丑，孤亲提铁骑南下卢沟，为甲午一百二十年祭。</p>
<p>以前一直以为很远，后来发现单程只有三十多公里，而且基本都是平地，自从去年推上妙峰山后，一般难度就不怕不怕啦。</p>
<p>先交作业：</p>
<p>不知道为什么，记录到了北安河就结束了，最后十公里木有了。</p>
<img src="http://pic.yupoo.com/leninlee/DGaYw0Qi/medish.jpg">
<img src="http://pic.yupoo.com/leninlee/DGaZP1XR/medish.jpg">
<img src="http://pic.yupoo.com/leninlee/DGbqdTkZ/medish.jpg">
<p>在网上见有人说从桥西进去不查门票，遂先过永定河，从西边进去，路上捡了个迷路的小盆友，说刚刚用手机导航直接上了高速！聊 后得知是北科大的学生，曾国藩的老乡，骑了辆不知道什么牌子的旧车，怯生生的，不禁遥想老夫当年，去矽谷吃顿七块钱的土豆牛肉饭都美得不行不行的。</p>
<p>骑到桥西入口，一个大妈模样的头从售票处小窗口里伸出来：“二十！”，要不说我没有大妈缘呢，走到哪都被拦，去年苦逼哈哈地推到七王坟，大妈说封山防火，片板不得入山。老老实实地买了票，才见著真神，爱个国容易么。桥是金章宗的时候建的，乾隆五十多年重修。桥下就是永定河，左宗棠任直隶总督时在此治水，旧称无定河，不过不是“可怜无定河边骨，犹是春闺梦里人”里的那条。</p>
<img src="http://pic.yupoo.com/leninlee/DGbmWZvZ/medish.jpg">
<p>请小盆友拍了张孤王的戎装照：</p>
<img src="http://pic.yupoo.com/leninlee/DGbmX91K/medish.jpg">
<p>果然每个狮子都不一样，小学课本不余欺也：</p>
<img src="http://pic.yupoo.com/leninlee/DGbmYClu/medish.jpg">
<p>卢沟晓月，所谓的燕京八景之一，我一般不尿这种虚无缥缈、滥竽充数的东西，鲁迅在《再论雷峰塔的倒掉》里说：</p>
<blockquote>
<p>我们中国的许多人，——我在此特别正重声明：并不包括四万万同胞全部！——大抵患有一种“十景病”，至少是“八景病”，沉重起来的时候大概在清朝。凡看一部县志，这一县往往有十景或八景，如“远村明月”、“萧寺清钟”、“古池好水”之类。</p>
</blockquote>
<p>我虽然不喜欢鲁迅，因为此人文风过于惼狭和左倾，虽然老先生一再声明不针对所有国人，但还是随处可见断章取义、不懂装懂的人扯大旗作虎皮，动辄就中国人的劣根性怎么怎么样。但在这一点上我跟老先生意见一致，就某些小县城都有所谓“七台八景”，台好歹还有个土堆，景就开始胡扯了。</p>
<img src="http://pic.yupoo.com/leninlee/DGbmY2fr/medish.jpg">
<p>摆一堆仿明清的大炮干什么，跟七七世变不搭调，更容易联想到两甲子前的那场战争，此日漫挥天下泪，有公足庄海军威。</p>
<img src="http://pic.yupoo.com/leninlee/DGcan9YW/medish.jpg">
<p>小盆友的高中历史是体育老师教的，居然不知道宛平城。这座长宽只有几百米的小城是崇祯为抵御闯贼建的桥头堡。不要门票。</p>
<img src="http://pic.yupoo.com/leninlee/DGbmXnSE/medish.jpg">
<p>这么小的一座城居然还有瓮城：</p>
<img src="http://pic.yupoo.com/leninlee/DGbmZQTg/medish.jpg">
<p>城里有个抗日纪念馆，免费参观，因为没处存车，没有进去，不过受党国栽培多年，用脚趾头也能想到里面都是什么，不去也罢。城里没啥可吃的，小盆友说要回校再吃饭，我心说您是直接奔学院路了，我还有几十公里路要绕，不补充热量怎么行，请小盆友吃了顿热干面。这兄弟明显没有方向感，好容易才让他找著北，在手机上找好回学院路的路线，最后送出东门，然后告诉他怎么走之后，老夫才起驾回宫。</p>
<p>之后的路基本比较轻松，大体沿永定河一直走，河边的永定楼气势恢宏，懒得拍照了，再上G109，从军庄路一路放坡下来，很爽。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-19" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-19/"><strong>Project Euler Problem 19 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-12</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-19/" class="article-date">
  <time datetime="2014-04-12T13:21:00.000Z" itemprop="datePublished">2014-04-12</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-19/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Counting-Sundays"><a href="#Counting-Sundays" class="headerlink" title="Counting Sundays"></a>Counting Sundays</h2><p>You are given the following information, but you may prefer to do some research for yourself.</p>
<ul>
<li>1 Jan 1900 was a Monday.</li>
<li>Thirty days has September,<br>April, June and November.<br>All the rest have thirty-one,<br>Saving February alone,<br>Which has twenty-eight, rain or shine.<br>And on leap years, twenty-nine.  </li>
<li>A leap year occurs on any year evenly divisible by 4, but not on a century unless it is divisible by 400.</li>
</ul>
<p>How many Sundays fell on the first of the month during the twentieth century (1 Jan 1901 to 31 Dec 2000)?</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight python"><figcaption><span>p19.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_leap</span><span class="params">(year)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> year % <span class="number">400</span> == <span class="number">0</span> <span class="keyword">or</span> year % <span class="number">100</span> != <span class="number">0</span> <span class="keyword">and</span> year % <span class="number">4</span> == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_days</span><span class="params">(year, month, day)</span>:</span></span><br><span class="line">    days = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">1900</span>, year):</span><br><span class="line">        days += is_leap(y) <span class="keyword">and</span> <span class="number">366</span> <span class="keyword">or</span> <span class="number">365</span></span><br><span class="line">    thirties = [<span class="number">4</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>]</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">1</span>, month):</span><br><span class="line">        <span class="keyword">if</span> m == <span class="number">2</span>:</span><br><span class="line">            days += is_leap(year) <span class="keyword">and</span> <span class="number">29</span> <span class="keyword">or</span> <span class="number">28</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            days += m <span class="keyword">in</span> thirties <span class="keyword">and</span> <span class="number">30</span> <span class="keyword">or</span> <span class="number">31</span></span><br><span class="line">    <span class="keyword">return</span> days + day</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> year <span class="keyword">in</span> range(<span class="number">1901</span>, <span class="number">2001</span>):</span><br><span class="line">        <span class="keyword">for</span> month <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">13</span>):</span><br><span class="line">            <span class="keyword">if</span> count_days(year, month, <span class="number">1</span>) % <span class="number">7</span> == <span class="number">0</span>:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><figcaption><span>p19.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">is_leap</span><span class="params">(year <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> math.Mod(<span class="keyword">float64</span>(year), <span class="number">400</span>) == <span class="number">0</span> || math.Mod(<span class="keyword">float64</span>(year), <span class="number">100</span>) != <span class="number">0</span> &amp;&amp; math.Mod(<span class="keyword">float64</span>(year), <span class="number">4</span>) == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">count_days</span><span class="params">(year, month, day <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    days := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> y := <span class="number">1900</span>; y &lt; year; y++ &#123;</span><br><span class="line">        <span class="keyword">if</span> is_leap(y) &#123;</span><br><span class="line">            days += <span class="number">366</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            days += <span class="number">365</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> m := <span class="number">1</span>; m &lt; month; m++ &#123;</span><br><span class="line">        <span class="keyword">if</span> m == <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> is_leap(year) &#123;</span><br><span class="line">                days += <span class="number">29</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                days += <span class="number">28</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> m == <span class="number">4</span> || m == <span class="number">6</span> || m == <span class="number">9</span> || m == <span class="number">11</span> &#123;</span><br><span class="line">                days += <span class="number">30</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                days += <span class="number">31</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> days + day</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> year := <span class="number">1901</span>; year &lt; <span class="number">2001</span>; year++ &#123;</span><br><span class="line">        <span class="keyword">for</span> month := <span class="number">1</span>; month &lt; <span class="number">13</span>; month++ &#123;</span><br><span class="line">            <span class="keyword">if</span> math.Mod(<span class="keyword">float64</span>(count_days(year, month, <span class="number">1</span>)), <span class="number">7</span>) == <span class="number">0</span> &#123;</span><br><span class="line">                count++</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’m the 65183rd person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-18-and-67" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-18-and-67/"><strong>Project Euler Problem 18&amp;67 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-10</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-18-and-67/" class="article-date">
  <time datetime="2014-04-10T13:28:00.000Z" itemprop="datePublished">2014-04-10</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-18-and-67/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Maximum-path-sum-I"><a href="#Maximum-path-sum-I" class="headerlink" title="Maximum path sum I"></a>Maximum path sum I</h2><p>By starting at the top of the triangle below and moving to adjacent numbers on the row below, the maximum total from top to bottom is 23.</p>
<p>3<br>7 4<br>2 4 6<br>8 5 9 3</p>
<p>That is, 3 + 7 + 4 + 9 = 23.</p>
<p>Find the maximum total from top to bottom of the triangle below:</p>
<p>75<br>95 64<br>17 47 82<br>18 35 87 10<br>20 04 82 47 65<br>19 01 23 75 03 34<br>88 02 77 73 07 63 67<br>99 65 04 28 06 16 70 92<br>41 41 26 56 83 40 80 70 33<br>41 48 72 33 47 32 37 16 94 29<br>53 71 44 65 25 43 91 52 97 51 14<br>70 11 33 28 77 73 17 78 39 68 17 57<br>91 71 52 38 17 14 91 43 58 50 27 29 48<br>63 66 04 68 89 53 67 30 73 16 69 87 40 31<br>04 62 98 27 23 09 70 98 73 93 38 53 60 04 23</p>
<p><strong>NOTE</strong>: As there are only 16384 routes, it is possible to solve this problem by trying every route. However, Problem 67, is the same challenge with a triangle containing one-hundred rows; it cannot be solved by brute force, and requires a clever method! ;o)</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight python"><figcaption><span>p18.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    matrix = []</span><br><span class="line">    file = open(<span class="string">'data_p18.txt'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file.readlines():</span><br><span class="line">        matrix.append(map(int, line.replace(<span class="string">'\n'</span>, <span class="string">''</span>).split(<span class="string">' '</span>)))</span><br><span class="line"></span><br><span class="line">    (x, y) = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(len(matrix)):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(matrix[y])):</span><br><span class="line">            <span class="keyword">if</span> y &gt; <span class="number">0</span>:</span><br><span class="line">                greaterParentPathValue = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> x &gt; <span class="number">0</span>:</span><br><span class="line">                    greaterParentPathValue = matrix[y - <span class="number">1</span>][x - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> x &lt; len(matrix[y - <span class="number">1</span>]) <span class="keyword">and</span> matrix[y - <span class="number">1</span>][x] \</span><br><span class="line">                    &gt; greaterParentPathValue:</span><br><span class="line">                    greaterParentPathValue = matrix[y - <span class="number">1</span>][x]</span><br><span class="line">                matrix[y][x] += greaterParentPathValue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> max(matrix[<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>I’m the 70471st person to have solved this problem.</p>
<h2 id="Maximum-path-sum-II"><a href="#Maximum-path-sum-II" class="headerlink" title="Maximum path sum II"></a>Maximum path sum II</h2><p>By starting at the top of the triangle below and moving to adjacent numbers on the row below, the maximum total from top to bottom is 23.</p>
<p><strong>3</strong><br><strong>7</strong> 4<br>2 <strong>4</strong> 6<br>8 5 <strong>9</strong> 3</p>
<p>That is, 3 + 7 + 4 + 9 = 23.</p>
<p>Find the maximum total from top to bottom in <a href="http://projecteuler.net/project/triangle.txt" target="_blank" rel="noopener">triangle.txt</a> (right click and ‘Save Link/Target As…’), a 15K text file containing a triangle with one-hundred rows.</p>
<p><strong>NOTE</strong>: This is a much more difficult version of Problem 18. It is not possible to try every route to solve this problem, as there are 2^99 altogether! If you could check one trillion (10^12) routes every second it would take over twenty billion years to check them all. There is an efficient algorithm to solve it. ;o)</p>
<h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight go"><figcaption><span>p67.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bufio"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"sort"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">"data_p67.txt"</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="literal">nil</span> != err &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">    matrix := <span class="built_in">make</span>([][]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    reader := bufio.NewReader(f)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        line, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">nil</span> != err || io.EOF == err &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        row := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">        numbers := strings.Split(strings.Replace(line, <span class="string">"\n"</span>, <span class="string">""</span>, <span class="number">-1</span>), <span class="string">" "</span>)</span><br><span class="line">        <span class="keyword">for</span> i := <span class="keyword">range</span> numbers &#123;</span><br><span class="line">            number, _ := strconv.Atoi(numbers[i])</span><br><span class="line">            row = <span class="built_in">append</span>(row, number)</span><br><span class="line">        &#125;</span><br><span class="line">        matrix = <span class="built_in">append</span>(matrix, row)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> y := <span class="number">0</span>; y &lt; <span class="built_in">len</span>(matrix); y++ &#123;</span><br><span class="line">        <span class="keyword">for</span> x := <span class="number">0</span>; x &lt; <span class="built_in">len</span>(matrix[y]); x++ &#123;</span><br><span class="line">            <span class="keyword">if</span> y &gt; <span class="number">0</span> &#123;</span><br><span class="line">                greaterParentPathValue := <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> x &gt; <span class="number">0</span> &#123;</span><br><span class="line">                    greaterParentPathValue = matrix[y<span class="number">-1</span>][x<span class="number">-1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> x &lt; <span class="built_in">len</span>(matrix[y<span class="number">-1</span>]) &amp;&amp; matrix[y<span class="number">-1</span>][x] &gt; greaterParentPathValue &#123;</span><br><span class="line">                    greaterParentPathValue = matrix[y<span class="number">-1</span>][x]</span><br><span class="line">                &#125;</span><br><span class="line">                matrix[y][x] += greaterParentPathValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sort.Sort(sort.Reverse(sort.IntSlice(matrix[<span class="built_in">len</span>(matrix)<span class="number">-1</span>])))</span><br><span class="line">    fmt.Println(matrix[<span class="built_in">len</span>(matrix)<span class="number">-1</span>][<span class="number">0</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’m the 50650th person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-17" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-17/"><strong>Project Euler Problem 17 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-09</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-17/" class="article-date">
  <time datetime="2014-04-09T14:29:00.000Z" itemprop="datePublished">2014-04-09</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-17/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Number-letter-counts"><a href="#Number-letter-counts" class="headerlink" title="Number letter counts"></a>Number letter counts</h2><p>If the numbers 1 to 5 are written out in words: one, two, three, four, five, then there are 3 + 3 + 5 + 4 + 4 = 19 letters used in total.</p>
<p>If all the numbers from 1 to 1000 (one thousand) inclusive were written out in words, how many letters would be used?</p>
<p><strong>NOTE</strong>: Do not count spaces or hyphens. For example, 342 (three hundred and forty-two) contains 23 letters and 115 (one hundred and fifteen) contains 20 letters. The use of “and” when writing out numbers is in compliance with British usage.</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight python"><figcaption><span>p17.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">translate_number</span><span class="params">(num)</span>:</span></span><br><span class="line">    words = &#123;</span><br><span class="line">        <span class="number">0</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="number">1</span>: <span class="string">'one'</span>,</span><br><span class="line">        <span class="number">2</span>: <span class="string">'two'</span>,</span><br><span class="line">        <span class="number">3</span>: <span class="string">'three'</span>,</span><br><span class="line">        <span class="number">4</span>: <span class="string">'four'</span>,</span><br><span class="line">        <span class="number">5</span>: <span class="string">'five'</span>,</span><br><span class="line">        <span class="number">6</span>: <span class="string">'six'</span>,</span><br><span class="line">        <span class="number">7</span>: <span class="string">'seven'</span>,</span><br><span class="line">        <span class="number">8</span>: <span class="string">'eight'</span>,</span><br><span class="line">        <span class="number">9</span>: <span class="string">'nine'</span>,</span><br><span class="line">        <span class="number">10</span>: <span class="string">'ten'</span>,</span><br><span class="line">        <span class="number">11</span>: <span class="string">'eleven'</span>,</span><br><span class="line">        <span class="number">12</span>: <span class="string">'twelve'</span>,</span><br><span class="line">        <span class="number">13</span>: <span class="string">'thirteen'</span>,</span><br><span class="line">        <span class="number">14</span>: <span class="string">'fourteen'</span>,</span><br><span class="line">        <span class="number">15</span>: <span class="string">'fifteen'</span>,</span><br><span class="line">        <span class="number">16</span>: <span class="string">'sixteen'</span>,</span><br><span class="line">        <span class="number">17</span>: <span class="string">'seventeen'</span>,</span><br><span class="line">        <span class="number">18</span>: <span class="string">'eighteen'</span>,</span><br><span class="line">        <span class="number">19</span>: <span class="string">'nineteen'</span>,</span><br><span class="line">        <span class="number">20</span>: <span class="string">'twenty'</span>,</span><br><span class="line">        <span class="number">30</span>: <span class="string">'thirty'</span>,</span><br><span class="line">        <span class="number">40</span>: <span class="string">'forty'</span>,</span><br><span class="line">        <span class="number">50</span>: <span class="string">'fifty'</span>,</span><br><span class="line">        <span class="number">60</span>: <span class="string">'sixty'</span>,</span><br><span class="line">        <span class="number">70</span>: <span class="string">'seventy'</span>,</span><br><span class="line">        <span class="number">80</span>: <span class="string">'eighty'</span>,</span><br><span class="line">        <span class="number">90</span>: <span class="string">'ninety'</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    english = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> num / <span class="number">1000</span> &gt; <span class="number">0</span>:</span><br><span class="line">        english += translate_number(num / <span class="number">1000</span>) + <span class="string">' thousand'</span></span><br><span class="line">        tmp = translate_number(num % <span class="number">1000</span>)</span><br><span class="line">        english += ((tmp.strip() == <span class="string">''</span> <span class="keyword">or</span> tmp.find(<span class="string">'hundred'</span>) &gt; <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">and</span> <span class="string">' '</span> <span class="keyword">or</span> <span class="string">' and '</span>) + tmp</span><br><span class="line">    <span class="keyword">elif</span> num / <span class="number">100</span> &gt; <span class="number">0</span>:</span><br><span class="line">        english += translate_number(num / <span class="number">100</span>) + <span class="string">' hundred'</span></span><br><span class="line">        tmp = translate_number(num % <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">if</span> tmp.strip() != <span class="string">''</span>:</span><br><span class="line">            english += <span class="string">' and '</span> + tmp</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> words.has_key(num):</span><br><span class="line">            english += words[num]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            english += words[num / <span class="number">10</span> * <span class="number">10</span>] + <span class="string">'-'</span> + words[num % <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> english</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1001</span>):</span><br><span class="line">        count += len(translate_number(i).replace(<span class="string">' '</span>, <span class="string">''</span>).replace(<span class="string">'-'</span>,</span><br><span class="line">                     <span class="string">''</span>))</span><br><span class="line">    <span class="keyword">print</span> count</span><br></pre></td></tr></table></figure>
<p>I’m the 71762nd person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-16" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-16/"><strong>Project Euler Problem 16 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-08</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-16/" class="article-date">
  <time datetime="2014-04-08T13:57:00.000Z" itemprop="datePublished">2014-04-08</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-16/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Power-digit-sum"><a href="#Power-digit-sum" class="headerlink" title="Power digit sum"></a>Power digit sum</h2><p>2^15 = 32768 and the sum of its digits is 3 + 2 + 7 + 6 + 8 = 26.</p>
<p>What is the sum of the digits of the number 2^1000?</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight python"><figcaption><span>p16.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    str = format(math.pow(<span class="number">2</span>, <span class="number">1000</span>), <span class="string">'f'</span>)</span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> str[:str.index(<span class="string">'.'</span>)]:</span><br><span class="line">        sum += int(c)</span><br><span class="line">    <span class="keyword">print</span> sum</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><figcaption><span>p16.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math/big"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    num, base := big.NewInt(<span class="number">1</span>), big.NewInt(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> power := <span class="number">0</span>; power &lt; <span class="number">1000</span>; power++ &#123;</span><br><span class="line">        num.Mul(num, base)</span><br><span class="line">    &#125;</span><br><span class="line">    result := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(num.String()); i++ &#123;</span><br><span class="line">        bit, _ := strconv.Atoi(num.String()[i : i+<span class="number">1</span>])</span><br><span class="line">        result += bit</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(num.String(), result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’m the 109044th person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-15" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-15/"><strong>Project Euler Problem 15 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-02</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-15/" class="article-date">
  <time datetime="2014-04-02T13:44:00.000Z" itemprop="datePublished">2014-04-02</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-15/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Lattice-paths"><a href="#Lattice-paths" class="headerlink" title="Lattice paths"></a>Lattice paths</h2><p>Starting in the top left corner of a 2×2 grid, and only being able to move to the right and down, there are exactly 6 routes to the bottom right corner.</p>
<img src="http://pic.yupoo.com/leninlee/DEwoQ7qc/medish.jpg">
<p>How many such routes are there through a 20×20 grid?</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight python"><figcaption><span>p15.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    (steps, a, b) = (<span class="number">20</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    i = steps * <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> i &gt; steps:</span><br><span class="line">        a *= i</span><br><span class="line">        i -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> steps &gt; <span class="number">1</span>:</span><br><span class="line">        b *= steps</span><br><span class="line">        steps -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> a / b</span><br></pre></td></tr></table></figure>
<p>I’m the 86747th person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-14" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-14/"><strong>Project Euler Problem 14 Solved</strong></a>
      <small class="article-date-index">&nbsp; 2014-04-01</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-14/" class="article-date">
  <time datetime="2014-04-01T14:17:00.000Z" itemprop="datePublished">2014-04-01</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-14/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Longest-Collatz-sequence"><a href="#Longest-Collatz-sequence" class="headerlink" title="Longest Collatz sequence"></a>Longest Collatz sequence</h2><p>The following iterative sequence is defined for the set of positive integers:</p>
<p>n → n/2 (n is even)<br>n → 3n + 1 (n is odd)</p>
<p>Using the rule above and starting with 13, we generate the following sequence:</p>
<p>13 → 40 → 20 → 10 → 5 → 16 → 8 → 4 → 2 → 1</p>
<p>It can be seen that this sequence (starting at 13 and finishing at 1) contains 10 terms. Although it has not been proved yet (Collatz Problem), it is thought that all starting numbers finish at 1.</p>
<p>Which starting number, under one million, produces the longest chain?</p>
<p>NOTE: Once the chain starts the terms are allowed to go above one million.</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><figure class="highlight go"><figcaption><span>p14.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collatz</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> math.Mod(<span class="keyword">float64</span>(n), <span class="number">2</span>) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> collatz(n/<span class="number">2</span>) + <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> collatz(n*<span class="number">3</span>+<span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line"></span><br><span class="line">    i, iLen, count, max := <span class="number">1000000</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i &gt; <span class="number">1</span> &#123;</span><br><span class="line">        iLen = collatz(i)</span><br><span class="line">        <span class="keyword">if</span> iLen &gt; count &#123;</span><br><span class="line">            count = iLen</span><br><span class="line">            max = i</span><br><span class="line">        &#125;</span><br><span class="line">        i--</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    end := time.Now()</span><br><span class="line">    fmt.Println(end.Sub(start), max, count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’m the 104188th person to have solved this problem.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-flamework-dependency-injection" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/flamework-dependency-injection/"><strong>PHP框架实战（六）：依赖注入</strong></a>
      <small class="article-date-index">&nbsp; 2014-03-30</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/flamework-dependency-injection/" class="article-date">
  <time datetime="2014-03-30T02:00:00.000Z" itemprop="datePublished">2014-03-30</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/flamework-dependency-injection/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>依赖注入是个很好的解耦方法，也可以优雅的实现懒加载。</p>
<p>以数据库连接为例，当一个组件用到数据库时，最简单粗暴的办法是在使用前创建连接：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        $db = <span class="keyword">new</span> DatabaseConnection($schema, $host, $port, $login, $password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样做的缺点是代码一旦执行，Component行为将不可更改，有时我们需要在程序执行的过程中决定其行为。很直接地，可以想到给Component添加一个Setter方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $__db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;__db !== <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// do something ...</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setConnection</span><span class="params">($db)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;__db = $db;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样就把Component和数据库连接解耦了。这时又有一个问题，怎样管理数据库连接？最简单粗暴的办法是在每次使用前创建，如果在程序中多处需要改变数据库连接，这就把代码写死了。</p>
<p>一种解决问题的方法是使用一个全局变量保存连接，对于简单场景，这没问题，但是这种做法会污染全局命名空间，尤其是在依赖较多的情况下，这种做法就不可取了。另一种方法就是用一个注册表持有所有依赖，这就是依赖注入要做的事。</p>
<p>我曾经处理过一个问题，生产环境中即使在无请求的情况下也会在短时间内生成大量会话文件，直接原因是使用了keepalived检查系统可用性。由于程序在一开始就打开了会话，并且keepalived不能保持会话，导致每次访问都会生成一个新的会话文件。这就是没有使用懒加载导致的错误。</p>
<p>懒加载可以让每个组件只有在需要的情况下才被初始化，一方面简化了代码、提高了可读性，另一方面也能提高程序效率、降低资源消耗。如果组件很多，而每次请求实际用到的很少，初始化所有组件产生的资源消耗将会很可观。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>用单例模式实现，以键值对的形式注册依赖。同时支持以变量和callable的形式注入，前者用以注册简单类型或已实例化的依赖，后者可以用匿名函数的方式更灵活地管理依赖。同时，注入依赖时可以指定该依赖是否为单例模式，如果是，callable类型的依赖将会在第一次被调用后保持下来。此外，使用__call()魔术方法实现直接以getter方法的方式获取依赖。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">org</span>\<span class="title">x3f</span>\<span class="title">flamework</span>\<span class="title">base</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">org</span>\<span class="title">x3f</span>\<span class="title">flamework</span>\<span class="title">exceptions</span>\<span class="title">FlameException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dependency Injection Class</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Donie Leigh &lt;donie.leigh<span class="doctag">@gmail</span>.com&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://0x3f.org</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@copyright</span> Copyright &amp;copy; 2013-2014 Donie Leigh</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@license</span> BSD (3-terms)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DI</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> object Singleton instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> $_instance;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array Services</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $_services = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Singleton constructor</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Donie Leigh &lt;donie.leigh<span class="doctag">@gmail</span>.com&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the singleton instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> object Singleton instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">self</span>::$_instance <span class="keyword">instanceof</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>::$_instance = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$_instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add a service to the register</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key Service name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mixed $service Callable to create a service instance or exactly an instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bool $isSingleton Set true to treat this service as singleton</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">($key, $service, $isSingleton=false)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_services[strtolower($key)] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'service'</span> =&gt; $service,</span><br><span class="line">            <span class="string">'isSingleton'</span> =&gt; $isSingleton,</span><br><span class="line">            <span class="string">'instance'</span> =&gt; <span class="keyword">null</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get a service instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed Service instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $key = strtolower($key);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_services[$key])) &#123;</span><br><span class="line">            $info = &amp;<span class="keyword">$this</span>-&gt;_services[$key];</span><br><span class="line">            <span class="keyword">if</span> ($info[<span class="string">'instance'</span>] !== <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> $info[<span class="string">'instance'</span>];</span><br><span class="line">            <span class="keyword">if</span> (is_callable($info[<span class="string">'service'</span>])) &#123;</span><br><span class="line">                $instance = call_user_func($info[<span class="string">'service'</span>]);</span><br><span class="line">                <span class="keyword">if</span> ($info[<span class="string">'isSingleton'</span>] === <span class="keyword">true</span>)</span><br><span class="line">                    $info[<span class="string">'instance'</span>] = $instance;</span><br><span class="line">                <span class="keyword">return</span> $instance;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> $info[<span class="string">'service'</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get service with magic method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $method get&#123;ServiceName&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $parameters Parameters, currently useless</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed Service instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $parameters)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos(strtolower($method), <span class="string">'get'</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">            $serviceName = substr($method, <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($serviceName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FlameException(<span class="string">'Call to undefined method: '</span>.$method);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// END class DI</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$di = DI::getInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单类型</span></span><br><span class="line">$di-&gt;set(<span class="string">'foo'</span>, <span class="string">'bar'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每次调用生成不同的依赖</span></span><br><span class="line">$di-&gt;set(<span class="string">'newPassword'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $pwd = ”;</span><br><span class="line">    $pwdLen = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $pwdLen; $i++) &#123;</span><br><span class="line">        $pwd .= chr(mt_rand(<span class="number">33</span>, <span class="number">126</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $pwd;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注入对象实例</span></span><br><span class="line">$di-&gt;set(<span class="string">'simpleSession'</span>, <span class="keyword">new</span> SimpleSession());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依赖在第一次被获取时动态创建，然后保持为单例</span></span><br><span class="line">$di-&gt;set(<span class="string">'complicatedSession'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $session = <span class="keyword">new</span> ComplicatedSession();</span><br><span class="line">    $session-&gt;setFirstVisitTime(time());</span><br><span class="line">    <span class="keyword">return</span> $session;</span><br><span class="line">&#125;, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取依赖</span></span><br><span class="line"><span class="keyword">echo</span> $di-&gt;get(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以getter的形式获取依赖</span></span><br><span class="line"><span class="keyword">echo</span> $di-&gt;getFoo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>之前的版本中，org\x3f\flamework\base\WebApplication中保存了数据库连接和日志级别，现在就可以把它们从这个类中解耦了。使用依赖注入，可以使框架核心保持尽可能的精简，最大程度地保证任何一个组件都是可拆卸和更换的，也是防止过度设计的一个很好的机制。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/21/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" href="/page/23/">Next &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 晴耕雨讀&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = '0x3f';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
