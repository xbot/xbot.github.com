<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>晴耕雨讀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晴耕雨讀">
<meta property="og:url" content="http://0x3f.org/page/38/index.html">
<meta property="og:site_name" content="晴耕雨讀">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晴耕雨讀">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93233020-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">目录</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="https://t.me/s/blingings">不灵</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://0x3f.org"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-freearc" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/freearc/"><strong>FreeArc：兼顾压缩比率与效率的压缩程序</strong></a>
      <small class="article-date-index">&nbsp; 2010-05-09</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/freearc/" class="article-date">
  <time datetime="2010-05-08T16:00:00.000Z" itemprop="datePublished">2010-05-09</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/freearc/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://freearc.org/" target="_blank" rel="noopener">FreeArc</a>的特点在于它在压缩比率与效率上取得了一个很好的平衡。传统的压缩程序则多偏重一点，要么占用系统资源低、速度快，但压缩比率小，如ZIP、RAR；要么压缩比率高，但占用系统资源大、速度慢，如7z。 </p>

<p>把RAR归于前者只是相对而言，除了WinZip，没有哪个压缩工具能取得像WinRAR那样的成功。之所以能做到这一点，是因为WinRAR不但继承了WinZip易用的优点，还具有对多种压缩算法广泛的兼容度，最重要的是，RAR压缩算法在效率与比率之间取得了一个非常好的平衡。凭借这些优势，WinRAR一举推翻了WinZip的王座，直到现在，它都是这个领域值得学习的榜样。 </p>

<p>早在7-Zip刚刚推出的时候，我就用过它。在压缩比率上，7z较RAR有着明显的优势，但在系统资源占用和压缩速度上，7z的表现非常不理想。最糟糕的是，如果你的机器配置较低，再加上你使用Windows系统，并且尤其喜欢使用图形界面的压缩工具，那7-zip对你来说就是一场恶梦，我曾经有过压缩一个较大的文件时进度条半天都不移动的经历。当然，在Windows命令行或Linux的终端中使用7-zip情况要好很多。此外，随着7-zip自身的完善和电脑配置的更新换代，这些劣势对7-zip普及的限制正逐渐弱化，事实上，我倾向于推荐用7-zip取代WinRAR，因为前者免费且有较大的压缩比率，而后者是收费的。 </p>

<p>上周偶然发现的FreeArc，它的主页上居然宣称比最好的压缩工具都快1.5到3倍，并且同时拥有超高的压缩比率。于是我拿7-zip与之作了几个粗略的对比测试，发现虽然没有宣称的那么夸张，但在压缩同样的文件并使用同样的压缩级别时，FreeArc均比7-zip快一些，而压缩比率却要稍高于后者。甚至对于某些格式的文件，FreeArc的“普通”级别的压缩比率都比7-zip“最高”级别的大。 </p>

<p>鉴于7-zip是资源占用大户，我非常怀疑在效率上FreeArc较WinRAR会有什么优势，更遑论快上1.5到3倍，但它的效率高于7-zip却是一个不争的事实，何况还有更高的压缩比率。此外，这次的测试中使用的操作系统和7-zip都是64位的，而FreeArc却是32位的，因此在效率的比试上会有不公平的地方。 </p>

<p>当然，FreeArc自身的缺点也很大： </p>

<ol>
<li>尚无64位版本</li>
<li>只支持Windows和Linux系统</li>
<li>不支持多卷压缩（分割压缩）</li>
<li>其它一些问题</li>
</ol>

<p>如果能在较短的时间内解决这些问题，我认为FreeArc还是很有前景的。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-create-ssl-certificates" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-create-ssl-certificates/"><strong>SSL证书生成方法</strong></a>
      <small class="article-date-index">&nbsp; 2010-05-03</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-create-ssl-certificates/" class="article-date">
  <time datetime="2010-05-02T16:00:00.000Z" itemprop="datePublished">2010-05-03</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-create-ssl-certificates/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>一般情况下，如果能找到可用的证书，就可以直接使用，只不过会因证书的某些信息不正确或与部署证书的主机不匹配而导致浏览器提示证书无效，但这并不影响使用。</p>

<p>需要手工生成证书的情况有：</p>

<ol>
<li>找不到可用的证书</li>
<li>需要配置双向SSL，但缺少客户端证书</li>
<li>需要对证书作特别的定制</li>
</ol>

<p>首先，无论是在Linux下还是在Windows下的Cygwin中，进行下面的操作前都须确认已安装OpenSSL软件包。</p>

<p>1. 创建根证书密钥文件<strong>root.key</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -des3 -out root.key</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -des3 -out root.key</span><br><span class="line">Generating RSA private key, 512 bit long modulus</span><br><span class="line">.................++++++++++++</span><br><span class="line">..++++++++++++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for root.key:                ← 输入一个新密码</span><br><span class="line">Verifying - Enter pass phrase for root.key:    ← 重新输入一遍密码</span><br></pre></td></tr></table></figure>

<p>2. 创建根证书的申请文件<strong>root.req</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key root.key -out root.req</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl req -new -key root.key -out root.req</span><br><span class="line">Enter pass phrase for root.key:                                              ← 输入前面创建的密码</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN                                         ← 国家代号，中国输入CN</span><br><span class="line">State or Province Name (full name) [Some-State]:BeiJing                      ← 省的全名，拼音</span><br><span class="line">Locality Name (eg, city) []:BeiJing                                          ← 市的全名，拼音</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp.   ← 公司英文名</span><br><span class="line">Organizational Unit Name (eg, section) []:                                   ← 可以不输入</span><br><span class="line">Common Name (eg, YOUR name) []:                                              ← 此时不输入</span><br><span class="line">Email Address []:admin@mycompany.com                                         ← 电子邮箱，可随意填&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:                                                     ← 可以不输入</span><br><span class="line">An optional company name []:                                                 ← 可以不输入&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>3. 创建一个自当前日期起为期十年的根证书<strong>root.crt</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 3650 -sha1 -extensions v3_ca -signkey root.key -in root.req -out root.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl x509 -req -days 3650 -sha1 -extensions v3_ca -signkey root.key -in root.req -out root.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./emailAddress=admin@mycompany.com</span><br><span class="line">Getting Private key</span><br><span class="line">Enter pass phrase for root.key:    ← 输入前面创建的密码</span><br></pre></td></tr></table></figure>

<p>4. 创建服务器证书密钥<strong>server.key</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -out server.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">....+++</span><br><span class="line">..................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br></pre></td></tr></table></figure>

<p>5.创建服务器证书的申请文件<strong>server.req</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key server.key -out server.req</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl req -new -key server.key -out server.req</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN                                          ← 国家名称，中国输入CN</span><br><span class="line">State or Province Name (full name) [Some-State]:BeiJing                       ← 省名，拼音</span><br><span class="line">Locality Name (eg, city) []:BeiJing                                           ← 市名，拼音</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp.    ← 公司英文名</span><br><span class="line">Organizational Unit Name (eg, section) []:                                    ← 可以不输入</span><br><span class="line">Common Name (eg, YOUR name) []:www.mycompany.com                              ← 服务器主机名，若填写不正确，浏览器会报告证书无效，但并不影响使用</span><br><span class="line">Email Address []:admin@mycompany.com                                          ← 电子邮箱，可随便填</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:                                                      ← 可以不输入</span><br><span class="line">An optional company name []:                                                  ← 可以不输入</span><br></pre></td></tr></table></figure>

<p>6. 创建自当前日期起有效期为期两年的服务器证书<strong>server.crt</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in server.req -out server.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in server.req -out server.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www.mycompany.com/emailAddress=admin@mycompany.com</span><br><span class="line">Getting CA Private Key</span><br><span class="line">Enter pass phrase for root.key:    ← 输入前面创建的密码</span><br></pre></td></tr></table></figure>

<p>7. 创建客户端证书密钥文件<strong>client.key</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -des3 -out client.key 2048</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -des3 -out client.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">.........................................................................................+++</span><br><span class="line">......................................................................................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for client.key:              ← 输入一个新密码</span><br><span class="line">Verifying - Enter pass phrase for client.key:  ← 重新输入一遍密码</span><br></pre></td></tr></table></figure>

<p>8. 创建客户端证书的申请文件<strong>client.req</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key client.key -out client.req</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -des3 -out client.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">.........................................................................................+++</span><br><span class="line">......................................................................................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for client.key:</span><br><span class="line">Verifying - Enter pass phrase for client.key:</span><br><span class="line">[lenin@archer ~]$ openssl req -new -key client.key -out client.req</span><br><span class="line">Enter pass phrase for client.key:                                              ← 输入上一步中创建的密码</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN                                           ← 国家名称，中国输入CN</span><br><span class="line">State or Province Name (full name) [Some-State]:BeiJing                        ← 省名称，拼音</span><br><span class="line">Locality Name (eg, city) []:BeiJing                                            ← 市名称，拼音</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp.     ← 公司英文名</span><br><span class="line">Organizational Unit Name (eg, section) []:                                     ← 可以不填</span><br><span class="line">Common Name (eg, YOUR name) []:Lenin                                           ← 自己的英文名，可以随便填</span><br><span class="line">Email Address []:admin@mycompany.com                                           ← 电子邮箱，可以随便填</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:                                                       ← 可以不填</span><br><span class="line">An optional company name []:                                                   ← 可以不填</span><br></pre></td></tr></table></figure>

<p>9. 创建一个自当前日期起有效期为两年的客户端证书<strong>client.crt</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in client.req -out client.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in client.req -out client.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www.mycompany.com/emailAddress=admin@mycompany.com</span><br><span class="line">Getting CA Private Key</span><br><span class="line">Enter pass phrase for root.key:          ← 输入上面创建的密码</span><br></pre></td></tr></table></figure>

<p>10. 将客户端证书文件<strong>client.crt</strong>和客户端证书密钥文件<strong>client.key</strong>合并成客户端证书安装包<strong>client.pfx</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -export -in client.crt -inkey client.key -out client.pfx</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl pkcs12 -export -in client.crt -inkey client.key -out client.pfx</span><br><span class="line">Enter pass phrase for client.key:        ← 输入上面创建的密码</span><br><span class="line">Enter Export Password:                   ← 输入一个新的密码，用作客户端证书的保护密码，在客户端安装证书时需要输入此密码</span><br><span class="line">Verifying - Enter Export Password:       ← 确认密码</span><br></pre></td></tr></table></figure>

<p>11. 保存生成的文件备用，其中<strong>server.crt</strong>和<strong>server.key</strong>是配置单向SSL时需要使用的证书文件，<strong>client.crt</strong>是配置双向SSL时需要使用的证书文件，<strong>client.pfx</strong>是配置双向SSL时需要客户端安装的证书文件</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-phpjs" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/phpjs/"><strong>强大的工具函数库：php.js</strong></a>
      <small class="article-date-index">&nbsp; 2010-04-24</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/phpjs/" class="article-date">
  <time datetime="2010-04-23T16:00:00.000Z" itemprop="datePublished">2010-04-24</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/phpjs/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>PHP最大的特点在于它拥有一个丰富、灵活、强大的函数库，因此得以机动灵活成为软件开发语言中的轻骑兵。</p>

<p><a href="http://phpjs.org/" target="_blank" rel="noopener">php.js</a>是一个用Javascript实现的函数库，它试图用Javascript最大程度地重写PHP的函数库。相对于JQuery、ExtJS这些Javascript库，php.js不并致力于为AJAX、DOM和界面开发提供一揽子解决方案，它只是将PHP函数的强大和简便带到前端开发中来，由于JQuery这样的库并不旨在提供完全的Javascript开发标准和手段，实际上，它弥补了这些高端的工具库与低端的Javascript开发之间的一个空白。</p>

<p>对于熟悉PHP的人尤其是PHP程序员来说，使用php.js是几乎不需要切换思维方式的。</p>

<p>这是使用php实现的日期格式校验函数：</p>

<p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsValidDate</span><span class="params">($strDate, $strFormat=<span class="string">'Y-m-d'</span>)</span> </span>&#123;</span><br><span class="line">    $strDate = trim($strDate);</span><br><span class="line">    $unixTime = strtotime($strDate);</span><br><span class="line">    $strNewDate = date($strFormat, $unixTime);</span><br><span class="line">    <span class="keyword">return</span> $strDate == $strNewDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</p>

<p>这是使用php.js实现的日期格式校验函数：</p>

<p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsValidDate</span>(<span class="params">strDate, strFormat</span>) </span>&#123;</span><br><span class="line">    strDate = trim(strDate);</span><br><span class="line">    <span class="keyword">var</span> unixTime = strtotime(strDate);</span><br><span class="line">    <span class="keyword">var</span> strNewDate = date(strFormat, unixTime);</span><br><span class="line">    <span class="keyword">return</span> strDate == strNewDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-syntax-checking-and-code-executing-in-vim" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/syntax-checking-and-code-executing-in-vim/"><strong>在Vim中检查语法和执行代码</strong></a>
      <small class="article-date-index">&nbsp; 2010-04-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/syntax-checking-and-code-executing-in-vim/" class="article-date">
  <time datetime="2010-04-16T16:00:00.000Z" itemprop="datePublished">2010-04-17</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/syntax-checking-and-code-executing-in-vim/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <div class="illustration_right">
<a href="http://picasaweb.google.com/lh/photo/OXk7sdAO9gNHu0qkTgK1PA?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh3.ggpht.com/_ceUJ_lBTHzc/SaV494hGreI/AAAAAAAAAzY/xExf7CzGyv0/s800/the-mug-of-vi.jpg"></a>
</div>

<p>《<a href="http://www.pragprog.com/the-pragmatic-programmer" target="_blank" rel="noopener">The Pragmatic Programmer</a>》的确是本好书，虽然中文译名极为恶俗。为践行书中提到的<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank" rel="noopener">DRY原则</a>，我开始反思平时编码时总是重复出现的问题，其中之一就是很低级的语法错误，有时忘了语句最后的分号，有时忘了声明变量，凡此种种，不一而足。</p>

<p>相对于IDE，我更喜欢Vim，这也是语法错误没有检查出来的原因。因此就产生了给Vim添加语法检查功能的需求。下面是检查PHP代码的vimrc内容：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Check the syntax of a PHP file</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">CheckPHPSyntax</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'php'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a PHP file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=php\ -<span class="keyword">l</span>\ -n\ -d\ html_errors=off\ %</span><br><span class="line">    <span class="keyword">setlocal</span> errorformat=%<span class="keyword">m</span>\ in\ %<span class="keyword">f</span>\ <span class="keyword">on</span>\ <span class="built_in">line</span>\ %<span class="keyword">l</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Syntax checking output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">silent</span> <span class="keyword">make</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">map</span> <span class="symbol">&lt;F5&gt;</span> :<span class="keyword">call</span> CheckPHPSyntax()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">imap</span> <span class="symbol">&lt;F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> CheckPHPSyntax()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<p>以上脚本为Vim添加了一个检查PHP语法错误的函数和两个快捷键映射，此后可按F5键即时检查当前Buffer中的PHP当面的语法。和网上其它同类的函数相比，这个函数的优点在于改进了检查结果的显示，使用silent命令隐藏了所有不必要的输出。</p>

<p>以下是检查Python代码语法错误的脚本：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Check the syntax of a python file</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">CheckPythonSyntax</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'python'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a Python file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=<span class="keyword">python</span>\ -<span class="keyword">u</span>\ %</span><br><span class="line">    <span class="keyword">set</span> efm=%C\ %.%#,%A\ \ File\ \<span class="string">"%f\"</span>\\,\ <span class="built_in">line</span>\ %<span class="keyword">l</span>%.%#,%Z%[%^\ ]%\\@=%<span class="keyword">m</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Syntax checking output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    exec <span class="string">"silent make -c \"import py_compile;py_compile.compile(r'"</span>.<span class="built_in">bufname</span>(<span class="string">"%"</span>).<span class="string">"')\""</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">map</span> <span class="symbol">&lt;F5&gt;</span> :<span class="keyword">call</span> CheckPythonSyntax()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">imap</span> <span class="symbol">&lt;F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> CheckPythonSyntax()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<p>上面两部分的配置脚本中虽然都指定了使用F5检查代码语法，但由于使用了<strong>au filetype</strong>指定了相应的语言类型，因此没有冲突。</p>

<p>和PHP相比，Python似乎更受垂青，因为除了上面和PHP一样的语法检查方式，它还有令人惊艳的<a href="http://www.vim.org/scripts/script.php?script_id=2441" target="_blank" rel="noopener">PyFlakes</a><a href="#footnote-pyflakes"> <sup><b>1</b></sup></a>。</p>

<p>PyFlakes的意思是<strong>Make on the fly</strong>，与另一神器Emacs的Flymake遥相呼应。只需要举出PyFlakes的两三个特性，就足以说明这是怎样的一个尤物了：其一是实时和高效，PyFlakes会在输入代码的同时检查语法错误，而且用户丝毫感觉不到任何停顿（<em>对于游戏玩家或高清电影狂可能“卡”更好理解</em>）；其二是智能，它居然能检查出哪些导入的模块没有被使用，哪些被使用的模块没有被导入；其三，PyFlakes检查出语法错误后会使用红色波浪线标识出错误位置。它使Vim完成了一个华丽的转身。</p>

<p>此外，由于PyFlakes是通过解析代码来检查语法错误，因此不必担心代码会被实际执行。</p>

<p>需要说明的是，PyFlakes要求Vim在编译时启用了对Python的支持，这一点可以使用<strong>:ver</strong>命令查看，一般各Linux发行版自带的Vim都加入了这个特性，而Windows下的版本没有此特性的可能性较大，好在作者提供了<a href="http://symbolsystem.com/vim/" target="_blank" rel="noopener">加入Python特性的Vim的Windows编译版</a>。</p>

<p>既然事已如此，不妨一不做、二不休，为Vim加上即时执行代码的功能。这个想法由来已久，出于和<a href="http://0x3f.org/?p=1433">寻找phpsh</a>同样的原因，我希望能在Vim中临时输入小块代码，然后即时执行并查看结果；或者即时执行正在编写的Python模块或程序。以下脚本实现了随手打开一个新的分割窗口并创建一个临时的脚本文件的功能：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Open a temporary PHP file in a new window</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">PHPSandBox</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">let</span> tmpfile = <span class="built_in">tempname</span>().<span class="string">'.php'</span></span><br><span class="line">    <span class="keyword">exe</span> <span class="string">'new '</span>.tmpfile</span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'&lt;?php'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'?&gt;'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">k</span></span><br><span class="line">    <span class="keyword">startinsert</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="comment">" Open a temporary Python file in a new window</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">PySandBox</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">let</span> tmpfile = <span class="built_in">tempname</span>().<span class="string">'.py'</span></span><br><span class="line">    <span class="keyword">exe</span> <span class="string">'new '</span>.tmpfile</span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'#!/usr/bin/python'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'# -*- coding: utf-8 -*-'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">startinsert</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>sbpy :<span class="keyword">call</span> PySandBox()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>sbph :<span class="keyword">call</span> PHPSandBox()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<p>下面的脚本则实现了即时执行当前Buffer中代码的功能：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Run a PHP script</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">ExecutePHPScript</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'php'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a PHP file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=php\ -<span class="keyword">f</span>\ %</span><br><span class="line">    <span class="keyword">setlocal</span> errorformat=%<span class="keyword">m</span>\ in\ %<span class="keyword">f</span>\ <span class="keyword">on</span>\ <span class="built_in">line</span>\ %<span class="keyword">l</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Execution output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">silent</span> <span class="keyword">make</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">map</span> <span class="symbol">&lt;C-F5&gt;</span> :<span class="keyword">call</span> ExecutePHPScript()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">imap</span> <span class="symbol">&lt;C-F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> ExecutePHPScript()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Run a python script</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">ExecutePythonScript</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'python'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a Python file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=<span class="keyword">python</span>\ -<span class="keyword">u</span>\ %</span><br><span class="line">    <span class="keyword">set</span> efm=%C\ %.%#,%A\ \ File\ \<span class="string">"%f\"</span>\\,\ <span class="built_in">line</span>\ %<span class="keyword">l</span>%.%#,%Z%[%^\ ]%\\@=%<span class="keyword">m</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Execution output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">silent</span> <span class="keyword">make</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">map</span> <span class="symbol">&lt;C-F5&gt;</span> :<span class="keyword">call</span> ExecutePythonScript()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">imap</span> <span class="symbol">&lt;C-F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> ExecutePythonScript()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<blockquote id="footnote-pyflakes">
<p><sup><b>Foot Note 1 :</b></sup></p>
<p>
PyFlakes本身是个通用的工具，其作者提供了一个Vim的插件调用PyFlakes的功能，故此处所说的PyFlakes实指Vim的PyFlakes插件。
</p>
</blockquote>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-buuf-deuce-icon-theme" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/buuf-deuce-icon-theme/"><strong>Buuf-Deuce：搞怪的图标主题</strong></a>
      <small class="article-date-index">&nbsp; 2010-04-10</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/buuf-deuce-icon-theme/" class="article-date">
  <time datetime="2010-04-09T16:00:00.000Z" itemprop="datePublished">2010-04-10</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/buuf-deuce-icon-theme/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>发现这个<a href="http://djany.deviantart.com/art/Gnome-Buuf-Deuce-1-1-R8-73339997" target="_blank" rel="noopener">图标主题</a>有段时间了，但直到今天偶然重新启用它，才突然觉得这套色调灰暗、风格搞怪的图标其实整体效果很好，很有个性，且极为闷骚，实为标榜非主流人士居家旅行必备。</p>
<p><a href="http://picasaweb.google.com/lh/photo/dGjc_mAUv2rQOLRDLlUZKw?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh5.ggpht.com/_ceUJ_lBTHzc/S8CQfF_kpbI/AAAAAAAABZ8/UV3W7nTx3vA/s800/Gnome_Buuf_Deuce_1_1_R8_by_djany.jpg"></a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-problem-about-icon-theme-on-gnome230" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/problem-about-icon-theme-on-gnome230/"><strong>Archlinux升级到GNOME2.30后的光标主题问题</strong></a>
      <small class="article-date-index">&nbsp; 2010-04-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/problem-about-icon-theme-on-gnome230/" class="article-date">
  <time datetime="2010-04-03T16:00:00.000Z" itemprop="datePublished">2010-04-04</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/problem-about-icon-theme-on-gnome230/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>Archlinux下的GNOME升级到2.30后，若启用了Compiz，则光标主题只能使用X默认的主题，无法自定义。尚不清楚是GNOME新版本自身的问题还是仅限于Arch发行版。</p>

<p>在官方提供解决方案或更新之前，可以先使用Xdefault或Xresource文件实现。</p>

<p>以后者为例，编辑用户主目录下的<strong>.Xresource</strong>，在文件最后添加如下内容：</p>

<blockquote>
  <p>Xcursor.theme: faber-anthracite-shd-m</p>
</blockquote>

<p><strong>faber-anthracite-sdh-m</strong>是我使用的光标主题的文件夹名。</p>

<p>然后执行如下命令：</p>

<blockquote>
  <p>xrdb ~/.Xresource</p>
</blockquote>

<p>最后注销并重新登录即可。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-phpsh" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/phpsh/"><strong>phpsh：PHP的交互式解释器</strong></a>
      <small class="article-date-index">&nbsp; 2010-03-29</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/phpsh/" class="article-date">
  <time datetime="2010-03-28T16:00:00.000Z" itemprop="datePublished">2010-03-29</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/phpsh/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>时常需要测试一些简短的代码是否能得到需要的结果，如果去写测试脚本再执行，显然太麻烦。虽然PHP自身也支持通过<strong><em>-a</em></strong>参数启动交互模式，但功能较为局限。如果PHP有像<a href="http://bpython-interpreter.org/" target="_blank" rel="noopener">bpython</a>那样的交互式解释器，就太好了。</p>

<p><a href="http://www.phpsh.org/" target="_blank" rel="noopener">phpsh</a>就是这样一个工具，它是由<a href="http://zh.wikipedia.org/wiki/Facebook" target="_blank" rel="noopener">facebook</a>的开发者用Python实现的PHP的交互式解释器，并具备以下特性：</p>

<ol>
<li>命令行历史回溯</li>
<li>tab键自动补全</li>
<li>快速文档索引</li>
</ol>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-cx-freeze" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/cx-freeze/"><strong>使用cx_Freeze的distutils脚本打包Python程序</strong></a>
      <small class="article-date-index">&nbsp; 2010-03-26</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/cx-freeze/" class="article-date">
  <time datetime="2010-03-25T16:00:00.000Z" itemprop="datePublished">2010-03-26</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/cx-freeze/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>cx_Freeze打包Python程序的命令基本格式如下：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cxfreeze main.py --target-dir appdir</span><br></pre></td></tr></table></figure>
</p>

<p>它表示把脚本main.py或以main.py为程序入口的程序打包并导出到当前路径中名为<strong>appdir</strong>的目录中。</p>

<p>对于Windows下的GUI应用程序，以上面的命令导出后，运行时会弹出<strong>cmd</strong>命令行的黑窗口，须加上如下命令中的参数：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cxfreeze main.py --target-dir appdir --base-name=win32gui</span><br></pre></td></tr></table></figure>
</p>

<p>对于比较复杂的程序，cx_Freeze支持<a href="http://www.ibm.com/developerworks/cn/linux/sdk/python/charm-19/" target="_blank" rel="noopener">distutils</a>格式的打包脚本，当然，彼此之间在引入的模块和支持的参数上还是有差别的。</p>

<p>cx_Freeze的文档中有其支持的全部命令参数及说明，写到setup.py脚本中时，所有参数中的<strong>-</strong>符号应换成下划线。</p>

<p>我的setup.py内容大致如下：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> cx_Freeze <span class="keyword">import</span> setup,Executable</span><br><span class="line"></span><br><span class="line">includefiles = [(<span class="string">'settings.ini.jctest'</span>,<span class="string">'settings.ini'</span>)</span><br><span class="line">        ,<span class="string">'README.mkd'</span>]</span><br><span class="line">includes = []</span><br><span class="line">excludes = [<span class="string">'Tkinter'</span>]</span><br><span class="line">packages = [<span class="string">'sqlalchemy.engine'</span>, <span class="string">'sqlalchemy.orm'</span>, <span class="string">'sqlalchemy.dialects.mssql'</span>]</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name = <span class="string">'pyutil'</span>,</span><br><span class="line">    version = <span class="string">'0.1'</span>,</span><br><span class="line">    description = <span class="string">'A general enhancement utility for XXX'</span>,</span><br><span class="line">    author = <span class="string">'Lenin Lee'</span>,</span><br><span class="line">    author_email = <span class="string">'lenin.lee@xxx.com'</span>,</span><br><span class="line">    options = &#123;<span class="string">'build_exe'</span>:&#123;<span class="string">'excludes'</span>:excludes,<span class="string">'packages'</span>:packages,<span class="string">'include_files'</span>:includefiles&#125;&#125;,</span><br><span class="line">    executables = [Executable(<span class="string">'jcitk.py'</span>)</span><br><span class="line">        , Executable(<span class="string">'jcvfd.py'</span>)</span><br><span class="line">        , Executable(<span class="string">'jcvdupcr.py'</span>)</span><br><span class="line">        , Executable(<span class="string">'jcddupcr.py'</span>)</span><br><span class="line">        , Executable(<span class="string">'jcclostfd.py'</span>)</span><br><span class="line">        , Executable(<span class="string">'jcvcard.py'</span>)</span><br><span class="line">        , Executable(<span class="string">'jcvcardii.py'</span>)</span><br><span class="line">        , Executable(<span class="string">'jcclostsoid.py'</span>)]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</p>

<p>在摸索如何写setup.py的过程中，遇到一些问题。</p>

<p>首先是如何将配置文件<strong>settings.ini</strong>自动复制到打包文件夹中。这个问题的解决办法是使用build_exe命令的参数<strong>include_files</strong>。此参数的值是一个列表，列表的每一项可以是一个表示要复制的文件的路径的字符串，或者是一个tuple。若是tuple，第一个元素是表示要复制的文件的路径，第二个元素是表示复制后要修改成的文件名。需要说明的是，文件夹可以和文件一样使用这样的方法复制到打包文件夹中。</p>

<p>其次，在打包引入了SQLAlchemy的程序后，若运行该程序时报某模块导入失败的错，应将报错信息中提示的模块所在的包填写到<strong>packages</strong>参数中。虽然也可以在程序中import这些包，但是在setup.py中使用packages参数的做法更合理。而且如果在程序中导入了没有被显式调用的模块或包的话，对于使用<a href="http://swik.net/PyFlakes" target="_blank" rel="noopener">pyflakes</a>检查语法错误的<a href="http://www.vim.org/scripts/script.php?script_id=2441" target="_blank" rel="noopener">环境</a>，会显示模块或包未被调用的警告，至少看起来不舒服。</p>

<p>再次，Windows下打包时应使用python 2.5，因为2.6版本需要<a href="http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF&amp;displaylang=zh-cn" target="_blank" rel="noopener">Microsoft Visual C++ 2008 Redistributable</a>，一般非开发环境的系统中都没安装这个，运行程序时就会报错。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-starting-tea-ceremony" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/starting-tea-ceremony/"><strong>开始玩儿茶道</strong></a>
      <small class="article-date-index">&nbsp; 2010-03-20</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/starting-tea-ceremony/" class="article-date">
  <time datetime="2010-03-19T16:00:00.000Z" itemprop="datePublished">2010-03-20</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/starting-tea-ceremony/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>前年买了个倒把小西施开始喝茶，渐渐地就觉得喝茶的趣味一半在茶，一半在泡。这周买了茶盘、茶道组等一应物件儿，直到周五晚上才有时间过把瘾。怕睡不着觉，没敢泡生茶，新开了一饼易武大树熟茶。</p>
<p><a href="http://picasaweb.google.com/lh/photo/2OI8UYBIqMUejiDCtL3JKg?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh6.ggpht.com/_ceUJ_lBTHzc/S6OqNZV5xgI/AAAAAAAABVg/nipIKJWV6xk/s400/%E8%8C%B6%E9%81%93%20002.JPG"></a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-counting-days-between-dates-in-sqlserver" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/counting-days-between-dates-in-sqlserver/"><strong>SQL Server的自定义函数：统计两日期之间工作日的数量</strong></a>
      <small class="article-date-index">&nbsp; 2010-03-13</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/counting-days-between-dates-in-sqlserver/" class="article-date">
  <time datetime="2010-03-12T16:00:00.000Z" itemprop="datePublished">2010-03-13</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/counting-days-between-dates-in-sqlserver/#disqus_thread" class="article-comment-link">Комментарии</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>前段时间工作中遇到的一个需求，要求计算两个日期之间工作日的数量，即排除期间所有的周六和周日之后的天数。</p>

<p>在网上找到一个自定义函数，原函数有些小问题，例如如果传入的截止日期如果有时间且足够大，则计算结果可能出错，修正后代码如下：</p>

<p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--函数：类似datediff，不统计期间所有的周六和周日</span></span><br><span class="line">if exists (<span class="keyword">select</span> * <span class="keyword">from</span> dbo.sysobjects <span class="keyword">where</span> <span class="keyword">id</span>=object_id(N<span class="string">'[dbo].[f_WorkDay]'</span>) <span class="keyword">and</span> xtype <span class="keyword">in</span> (N<span class="string">'FN'</span>,N<span class="string">'IF'</span>,N<span class="string">'TF'</span>)) </span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> [dbo].[f_WorkDay] </span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> f_WorkDay(</span><br><span class="line">@dt_begin   datetime,</span><br><span class="line">@dt_end     datetime </span><br><span class="line">)<span class="keyword">RETURNS</span> <span class="built_in">int</span> </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">    <span class="keyword">DECLARE</span> @workday <span class="built_in">int</span>,@i <span class="built_in">int</span>,@bz <span class="built_in">bit</span>,@dt datetime </span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> @dt_begin = <span class="keyword">convert</span>(datetime, <span class="keyword">convert</span>(<span class="keyword">nvarchar</span>(<span class="number">32</span>), @dt_begin, <span class="number">23</span>))</span><br><span class="line">    <span class="keyword">set</span> @dt_end = <span class="keyword">convert</span>(datetime, <span class="keyword">convert</span>(<span class="keyword">nvarchar</span>(<span class="number">32</span>), @dt_end, <span class="number">23</span>))    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">IF</span> @dt_begin&gt;@dt_end </span><br><span class="line">        <span class="keyword">SELECT</span> @bz=<span class="number">1</span>,@dt=@dt_begin,@dt_begin=@dt_end,@dt_end=@dt </span><br><span class="line">    <span class="keyword">ELSE</span> </span><br><span class="line">        <span class="keyword">SET</span> @bz=<span class="number">0</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> @i=<span class="keyword">DATEDIFF</span>(<span class="keyword">Day</span>,@dt_begin,@dt_end),@workday=@i/<span class="number">7</span>*<span class="number">5</span>,@dt_begin=<span class="keyword">DATEADD</span>(<span class="keyword">Day</span>,@i/<span class="number">7</span>*<span class="number">7</span>,@dt_begin) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">WHILE</span> @dt_begin&lt;@dt_end </span><br><span class="line">    <span class="keyword">BEGIN</span> </span><br><span class="line">        <span class="keyword">SELECT</span> @workday=<span class="keyword">CASE</span> <span class="keyword">WHEN</span> (@@DATEFIRST+<span class="keyword">DATEPART</span>(<span class="keyword">Weekday</span>,@dt_begin)<span class="number">-1</span>)%<span class="number">7</span> <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">5</span> <span class="keyword">THEN</span> @workday+<span class="number">1</span> <span class="keyword">ELSE</span> @workday <span class="keyword">END</span>,@dt_begin=@dt_begin+<span class="number">1</span> </span><br><span class="line">    <span class="keyword">END</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">RETURN</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> @bz=<span class="number">1</span> <span class="keyword">THEN</span> -@workday <span class="keyword">ELSE</span> @workday <span class="keyword">END</span>) </span><br><span class="line"><span class="keyword">END</span> </span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>
</p>

<p>此函数的原理是，使用datediff计算两日期之间的差值A，然后取A与7的商，即计算期间内有几个整周。然后使用这个商与5相乘，得到所有整周内的工作日天数B。接着，使用A除以7再乘以7得到C，这就约去了A中最后不到一个整周的天数。再在起始日期的基础上加上C，得到一个新的起始日期，然后从这个新的起始日期开始遍历至截止日期的每一天，每增加一天，判断若此日期是工作日，则在C的基础上累加一。判断一个日期（假设使用@dt_begin表示）是否是工作日的方法是：<strong>(@@datefirst+datepart(Weekday, @dt_begin)-1)%7</strong>的值在1和5之间。</p>

<p>此外还有一个需求是计算两个日期之间排除最后一个周六周日后的天数，仿照上面的函数实现了一个新函数，现在想来，有点儿把问题复杂化了，完全可以直接从后往前推的。</p>

<p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--函数：类似datediff，不统计截止日期@dt_end前最近一次的周六和周日，若dt_end是周日，则不统计其前面的那个周六。</span></span><br><span class="line">if exists (<span class="keyword">select</span> * <span class="keyword">from</span> dbo.sysobjects <span class="keyword">where</span> <span class="keyword">id</span>=object_id(N<span class="string">'[dbo].[f_WorkDayOnce]'</span>) <span class="keyword">and</span> xtype <span class="keyword">in</span> (N<span class="string">'FN'</span>,N<span class="string">'IF'</span>,N<span class="string">'TF'</span>)) </span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> [dbo].[f_WorkDayOnce]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> f_WorkDayOnce(</span><br><span class="line">@dt_begin   datetime,</span><br><span class="line">@dt_end     datetime </span><br><span class="line">)<span class="keyword">RETURNS</span> <span class="built_in">int</span> </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">    <span class="keyword">DECLARE</span> @day_count <span class="built_in">int</span>,@<span class="keyword">weekday</span> <span class="built_in">int</span>,@weekend_dropped <span class="built_in">int</span>,@i <span class="built_in">int</span>,@bz <span class="built_in">bit</span>,@dt datetime </span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> @dt_begin = <span class="keyword">convert</span>(datetime, <span class="keyword">convert</span>(<span class="keyword">nvarchar</span>(<span class="number">32</span>), @dt_begin, <span class="number">23</span>))</span><br><span class="line">    <span class="keyword">set</span> @dt_end = <span class="keyword">convert</span>(datetime, <span class="keyword">convert</span>(<span class="keyword">nvarchar</span>(<span class="number">32</span>), @dt_end, <span class="number">23</span>))    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">IF</span> @dt_begin&gt;@dt_end </span><br><span class="line">        <span class="keyword">SELECT</span> @bz=<span class="number">1</span>,@dt=@dt_begin,@dt_begin=@dt_end,@dt_end=@dt </span><br><span class="line">    <span class="keyword">ELSE</span> </span><br><span class="line">        <span class="keyword">SET</span> @bz=<span class="number">0</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> @i=<span class="keyword">DATEDIFF</span>(<span class="keyword">Day</span>,@dt_begin,@dt_end),@<span class="keyword">weekday</span>=(@@datefirst+<span class="keyword">datepart</span>(<span class="keyword">weekday</span>,@dt_end)<span class="number">-1</span>)%<span class="number">7</span>,@day_count=@i,@weekend_dropped=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> @i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">set</span> @day_count=<span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> @<span class="keyword">weekday</span>=<span class="number">0</span></span><br><span class="line">            <span class="keyword">set</span> @day_count=@i<span class="number">-1</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">while</span> @dt_begin&lt;@dt_end <span class="keyword">and</span> @weekend_dropped&lt;<span class="number">2</span></span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">select</span> @weekend_dropped=@weekend_dropped+(<span class="keyword">case</span> <span class="keyword">when</span> (@@datefirst+<span class="keyword">datepart</span>(<span class="keyword">weekday</span>,@dt_begin)<span class="number">-1</span>)%<span class="number">7</span> <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">5</span> <span class="keyword">then</span> <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">end</span>),@dt_begin=@dt_begin+<span class="number">1</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">select</span> @day_count=@day_count-@weekend_dropped</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">RETURN</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> @bz=<span class="number">1</span> <span class="keyword">THEN</span> -@day_count <span class="keyword">ELSE</span> @day_count <span class="keyword">END</span>) </span><br><span class="line"><span class="keyword">END</span> </span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>
</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/37/">&laquo; Назад</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><a class="page-number" href="/page/37/">37</a><span class="page-number current">38</span><a class="page-number" href="/page/39/">39</a><a class="page-number" href="/page/40/">40</a><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" href="/page/39/">Далее &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 晴耕雨讀&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = '0x3f';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
