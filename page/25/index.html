<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>晴耕雨讀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晴耕雨讀">
<meta property="og:url" content="http://0x3f.org/page/25/index.html">
<meta property="og:site_name" content="晴耕雨讀">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晴耕雨讀">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93233020-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">目录</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="https://t.me/s/blingings">不灵</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://0x3f.org"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-flamework" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/flamework/"><strong>PHP框架实战：Flamework</strong></a>
      <small class="article-date-index">&nbsp; 2013-12-26</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/flamework/" class="article-date">
  <time datetime="2013-12-26T12:24:00.000Z" itemprop="datePublished">2013-12-26</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/flamework/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>从今天开始，逐步实现一个PHP的MVC框架，以践行平时对这方面的一些想法。</p>
<h2 id="项目信息"><a href="#项目信息" class="headerlink" title="项目信息"></a>项目信息</h2><ul>
<li>名称：Flamework (<em>Flame Framework</em>)</li>
<li>源码：<a href="https://github.com/xbot/flamework" target="_blank" rel="noopener">https://github.com/xbot/flamework</a></li>
</ul>
<h2 id="框架特性"><a href="#框架特性" class="headerlink" title="框架特性"></a>框架特性</h2><p><strong>激进</strong></p>
<p>用PHP高版本引入的新特性，不考虑向前兼容问题，没有历史包袱。</p>
<p><strong>命名空间</strong></p>
<p>PHP 5.3引入的命名空间可以有效避免类命名冲突，这样可以使类名看起来更自然，不用再在类名前面加难看的前缀了。</p>
<p><strong>类的自动加载</strong></p>
<p>手动include会增加维护的难度，因为经常会出现一个类被从源码中移除而它的include行还在的问题，这会拖慢程序执行速度、增加内存占用。</p>
<p>实现类的自动加载可以在类被引用时自动include相应的源码。</p>
<p><strong>异常的自动处理</strong></p>
<p>在设计程序时，一般应该把用户级的错误返回给页面显示，或者对一些HTTP错误显示个性化的页面（<em>例如人民群众喜闻乐见的404页面</em>），所以在业务逻辑、数据操作这些层一般应该逐级向上抛异常，然后在Controller里捕获并加工成页面可识别的格式（<em>例如JSON</em>）。这样做的缺点是Controller里每个Action都包含重复的try…catch块。</p>
<p>异常的自动处理允许开发者指定自定义的异常处理逻辑，将异常处理与普通逻辑解耦，这样每个Action只需实现它所关注的功能即可。</p>
<p><strong>过滤器</strong></p>
<p>过滤器允许面向切面编程，是将横向逻辑与纵向逻辑解耦的重要工具。Flamework要实现针对Controller和Action两个级别的过滤器链，过滤器可在该级别逻辑前后执行，并能停止该级别逻辑及后续过滤器的执行。</p>
<p><strong>懒加载</strong></p>
<p>对尽可能多的资源实现懒加载，例如数据库连接、类、组件等，目的是提高效率、节约资源。</p>
<p><strong>参数绑定</strong></p>
<p>自动将请求中的参数与Action方法的参数绑定，从而避免在Action里出现通过$_POST、$_GET这些数组取参数的脏代码，也可以自动实现参数的校验和错误处理。</p>
<p><strong>ActiveRecord</strong></p>
<p>ORM是对关系模型和对象模型的阻抗不匹配问题的解决方案，ActiveRecord是目前最流行的一种ORM的实现方式。通过AR，可以以更对象化的方式操作关系数据库的数据。</p>
<p><strong>依赖注入</strong></p>
<p>依赖注入是个很好的解耦方法，也可以很优雅地实现懒加载。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="/post/flamework-code-spec">零：代码规范</a></li>
</ol>
<ul>
<li><a href="/post/flamework-entry">一：框架入口与类的自动加载</a></li>
<li><a href="/post/flamework-error-auto-handling">二：错误和异常的自动处理</a></li>
<li><a href="/post/flamework-controller-and-filter">三：实现Controller和Filter</a></li>
<li><a href="/post/flamework-view-rendering">四：视图的模板与渲染</a></li>
<li><a href="/post/flamework-active-record">五：ORM与ActiveRecord</a></li>
<li><a href="/post/flamework-dependency-injection">六：依赖注入</a></li>
<li><a href="/post/flamework-summary">∝：烈焰之终章</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-books-read-in-the-second-half-of-2013" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/books-read-in-the-second-half-of-2013/"><strong>这半年读过的几本书</strong></a>
      <small class="article-date-index">&nbsp; 2013-12-25</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/books-read-in-the-second-half-of-2013/" class="article-date">
  <time datetime="2013-12-25T15:10:00.000Z" itemprop="datePublished">2013-12-25</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/青梅煮酒/">青梅煮酒</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/books-read-in-the-second-half-of-2013/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>微博一度使我更新博客的频率一降再降，现在我决定回归。已经写了七年，依然乐此不疲。</p>
<p>这半年去过一些地方，读过一些书，顿悟了一些东西，我是个有一身毛病的动物，但我享受debug的过程。</p>
<p>现在读书的动力很大程度上来自于使用PaperWhite的愉悦感，虽然最初买电子书阅读器的目的是读盗版，不过现在宁愿为了更好的排版而买正版，而且觉得更过瘾。现在我在买一本书前都要先看有没有电子版，没有的话就去找盗版，连盗版都没有才去买印刷版。</p>
<h2 id="小通鉴"><a href="#小通鉴" class="headerlink" title="小通鉴"></a>小通鉴</h2><img src="http://pic.yupoo.com/leninlee/DpCW6kFR/medish.jpg">
<p>虽然《通鉴》读了三年还没有读完，这本小书却很快就过了一遍。它从通鉴里抽出了几个故事，展开评论了一下。读了原史再看别人的解读，经常会会心一笑，或心有戚戚，或醍醐灌顶。读史最大的好处有两个，一是学做事，一是学做人，我注六经，六经注我。</p>
<h2 id="诛仙"><a href="#诛仙" class="headerlink" title="诛仙"></a>诛仙</h2><img src="http://pic.yupoo.com/leninlee/DpD1kbUK/medish.jpg">
<p>纯粹是为了了结旧账，这书在我还在学校的时候还没写完，隔了多年，画一个圈圈，终结它。书本身的故事不错，本来可以再深挖一些，可惜被文笔糟蹋了，整本书缩写为原来的一百分之一波形不会有失真。</p>
<h2 id="我所认识的蒋介石"><a href="#我所认识的蒋介石" class="headerlink" title="我所认识的蒋介石"></a>我所认识的蒋介石</h2><img src="http://pic.yupoo.com/leninlee/DpD2nJlC/medish.jpg">
<p>这本书只读了开头就读不下去了，对于历史和历史人物，全面肯定和全面否定都是不可信的。</p>
<h2 id="大漠苍狼：绝密飞行"><a href="#大漠苍狼：绝密飞行" class="headerlink" title="大漠苍狼：绝密飞行"></a>大漠苍狼：绝密飞行</h2><img src="http://pic.yupoo.com/leninlee/DpD5NoG1/medish.jpg">
<p>悬疑设定得不错。不过现在越来越不喜欢有恐怖色彩的东西，所以这可能是我最后看的一本这种题材的书。</p>
<h2 id="Javascript权威指南"><a href="#Javascript权威指南" class="headerlink" title="Javascript权威指南"></a>Javascript权威指南</h2><img src="http://pic.yupoo.com/leninlee/DpD6JS7c/medish.jpg">
<p>传说中的犀牛书，Javascript最权威的资料之一。第一部分“语言核心”是要细读的，第二部分“客户端的JS”对有几年经验的人，从13到18章浏览一遍，之后的用康圣人读书法。读完这本书就知道什么叫生命不息挖坑不止。</p>
<h2 id="精通CSS"><a href="#精通CSS" class="headerlink" title="精通CSS"></a>精通CSS</h2><img src="http://pic.yupoo.com/leninlee/DpD860nd/medish.jpg">
<p>本想查漏补缺，所以没选《CSS禅意花园》，结果这书还是偏设计。难道这个星球上就没有一本给非前端开发看的CSS书么？</p>
<h2 id="Spring-in-Action"><a href="#Spring-in-Action" class="headerlink" title="Spring in Action"></a>Spring in Action</h2><img src="http://pic.yupoo.com/leninlee/DpD9xCFY/medish.jpg">
<p>重新寻找丢掉的青春，撂下五年再拾起来容易么。这书是本不错的Spring初级教材。</p>
<h2 id="板桥杂记"><a href="#板桥杂记" class="headerlink" title="板桥杂记"></a>板桥杂记</h2><img src="http://pic.yupoo.com/leninlee/DpDblJwq/medish.jpg">
<p>明末清初大才子余怀的招嫖回忆录，从对江南名妓的记述中映射物是人非之慨，文笔绝佳。秋风团扇，一觉扬州，于字字雕琢中见山河离碎、愁绪盈怀。每个危楼听雨的暮年都有著软红十丈的青春。</p>
<h2 id="NoSQL精粹"><a href="#NoSQL精粹" class="headerlink" title="NoSQL精粹"></a>NoSQL精粹</h2><img src="http://pic.yupoo.com/leninlee/DpDdM5l4/medish.jpg">
<p>NoSQL绝佳的一本入门教材，对NoSQL的概念、应用场景、各类实现的优缺点等等都有适度的介绍。对于一直使用传统技术的人而言，这本书有醍醐灌顶使人捶胸顿足怒相见恨晚叹青春易逝之副作用。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-practical-drag-and-drop-implementation-with-dojo" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/practical-drag-and-drop-implementation-with-dojo/"><strong>用Dojo实现拖放操作的最佳实践</strong></a>
      <small class="article-date-index">&nbsp; 2013-11-05</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/practical-drag-and-drop-implementation-with-dojo/" class="article-date">
  <time datetime="2013-11-05T08:58:00.000Z" itemprop="datePublished">2013-11-05</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/practical-drag-and-drop-implementation-with-dojo/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>网上关于Dojo实现拖放操作的资料都讲得很浅，所以我在研究这个东西的时候在一些细节上费了不少功夫，例如创建自定义样式的拖拽物件、将光标置于拖拽开始时的位置等等。这些细节一般在实现个性化的拖放操作时都要涉及，但几乎找不到任何直接的资料，所以本文斗胆宣称是当前Dojo拖放的最佳实践。</p>
<h2 id="创建自定义样式的拖拽物件"><a href="#创建自定义样式的拖拽物件" class="headerlink" title="创建自定义样式的拖拽物件"></a>创建自定义样式的拖拽物件</h2><p>Dojo缺省的拖拽物件样式很丑，通过覆盖官方文档里列出的几个CSS的class可以有限地调整部分样式，如果需要更多个性化，就需要使用自定义的物件模板。</p>
<p>通过重载Source对象的creator方法可以实现这一点。这个方法会在创建拖拽物件的时候被调用，如果hint参数的值为“avatar”就表示将被创建的是被拖拽物件，此时可以使用预先定义好的模板avatarTmpl创建物件的node。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.dndSrc = <span class="keyword">new</span> Source(<span class="keyword">this</span>.itemList.domNode, &#123;</span><br><span class="line">    copyOnly:<span class="literal">true</span>,</span><br><span class="line">    selfAccept:<span class="literal">true</span>,</span><br><span class="line">    creator: <span class="function"><span class="keyword">function</span>(<span class="params">item, hint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> n;</span><br><span class="line">        <span class="keyword">if</span> (hint == <span class="string">'avatar'</span>) &#123;</span><br><span class="line">            n = domConstruct.toDom(lang.replace(avatarTmpl, item));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">node</span>:n, <span class="attr">data</span>:item, <span class="attr">type</span>:[<span class="string">'text'</span>]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="置光标位置于拖拽起始处"><a href="#置光标位置于拖拽起始处" class="headerlink" title="置光标位置于拖拽起始处"></a>置光标位置于拖拽起始处</h2><p>在拖拽开始后，Dojo默认将光标置于被拖拽物件的左上角，而一般把光标置于拖拽开始时相对于物件的位置处显得比较自然。</p>
<p>实现方式是先记录拖拽开始时光标的位置，然后设置dojo.dnd.Manager的两个位移属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">on(<span class="keyword">this</span>.domNode, <span class="string">'mousedown'</span>, lang.hitch(<span class="keyword">this</span>, <span class="keyword">this</span>._setDndOffset))</span><br><span class="line"></span><br><span class="line">_setDndOffset: <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// summary: 鼠标按下时将光标相对于组件的位移设置为dojo.dnd.Manager的位移</span></span><br><span class="line">    <span class="comment">//          即使光标在拖动开始后位于拖动开始时的位置</span></span><br><span class="line">    <span class="keyword">var</span> cPos = Functions.getCursorPosition(evt);</span><br><span class="line">    <span class="keyword">var</span> nPos = domGeometry.position(<span class="keyword">this</span>.domNode);</span><br><span class="line">    Manager.manager().OFFSET_X = nPos.x - cPos.x;</span><br><span class="line">    Manager.manager().OFFSET_Y = nPos.y - cPos.y;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="使鼠标事件穿透被拖拽物件"><a href="#使鼠标事件穿透被拖拽物件" class="headerlink" title="使鼠标事件穿透被拖拽物件"></a>使鼠标事件穿透被拖拽物件</h2><p>将光标置于物件开始被拖拽时的位置后，物件本身会挡住mouseover事件，导致Target不能获知物件被拖拽到自己上方，以致能拖不能放。</p>
<p>解决方法是通过CSS使鼠标事件穿透被拖拽物件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.dojoDndAvatar &#123;</span><br><span class="line">    pointer-events: none; <span class="comment">/*Chrome, FF下使鼠标事件穿透*/</span></span><br><span class="line">    background:transparent; <span class="comment">/*IE下使鼠标事件穿透*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-typeerror-access-denied" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/typeerror-access-denied/"><strong>IE中使用IFrame上传文件报错——TypeError:拒绝访问</strong></a>
      <small class="article-date-index">&nbsp; 2013-08-03</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/typeerror-access-denied/" class="article-date">
  <time datetime="2013-08-02T17:03:00.000Z" itemprop="datePublished">2013-08-03</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/typeerror-access-denied/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>场景为：</p>
<p>点击一个图标，打开文件选择对话框，选择好文件后即时上传。</p>
<p>之前的实现方式是在一个隐藏表单中放一个file类型的input元素，通过调用input.click()打开对话框，同时监听input.onchange，最后通过dojo/request/iframe上传文件。</p>
<p>这个实现方式在Chrome和Firefox里都没问题，但是在IE里报错：“<strong>TypeError:拒绝访问</strong>”。原因是IE要求必须通过点击file类型的input的按钮打开选择对话框，否则就报这个错误。</p>
<p>解决办法是修改input元素的样式，或者直接用dojox.form.Uploader替代。</p>
<p><em>因为这个破问题又血战到半夜，只支持IE9+的世界你们好吗，还支持IE7+的屌丝伤不起……不起……起……啊。<strong>IE不死，吾难未已！！！</strong></em></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-dojo-dnd-cannot-read-property-type-of-undefined" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/dojo-dnd-cannot-read-property-type-of-undefined/"><strong>Dojo DnD: Cannot read property &#39;type&#39; of undefined</strong></a>
      <small class="article-date-index">&nbsp; 2013-07-11</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/dojo-dnd-cannot-read-property-type-of-undefined/" class="article-date">
  <time datetime="2013-07-11T14:44:00.000Z" itemprop="datePublished">2013-07-11</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/dojo-dnd-cannot-read-property-type-of-undefined/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>场景如下：</p>
<p>假设有两个Widget：ItemListWidget和ItemWidget，后者要被创建多份并追加到前者内部，同时ItemListWidget要作为dojo/dnd/Source，每个ItemWidget作为一个单元可被拖拽到另外一个dojo/dnd/Target容器中。</p>
<p>问题是，当Source被创建后，再添加到ItemListWidget的ItemWidget实例在被拖拽时会报如下错误：</p>
<blockquote>
<p>Uncaught TypeError: Cannot read property ‘type’ of undefined</p>
</blockquote>
<p>在Chrome开发工具中点开这个错误，显示以下内容：</p>
<img src="http://pic.yupoo.com/leninlee/D0dD4euT/cULuA.png">
<p>从方法的注释或API中可以看到，checkAcceptance()是用来判断当前拖拽对象是否在这个target接受的范围之内，接受规则用Source和Target的构造参数中的“accept”定义。在这个方法里通过Source.getItem()方法拿到的对象是null，上述错误就是从这儿报出来的。</p>
<p>接合API和Reference Guide发现，每个Source中的可拖拽项目在Source中都要有一个对应的对象，这个对象至少包括两个属性：“data”和“type”。在<a href="http://dojotoolkit.org/reference-guide/1.9/dojo/dnd.html" target="_blank" rel="noopener">Reference Guide</a>中，对这两个属性有详细说明，简言之，data是向Target传递的数据，type是被Target用来判断拖拽个体是否属于接受范围的依据。</p>
<p>当Source实例被创建时，已经存在于ItemListWidget中的ItemWidget实例会被自动创建对应的上述对象，但之后加入的不会。解决的办法是调用Source.setItem()方法为每一个新加入的ItemWidget关联相应的对象，或在ItemWidget中添加一个构造参数，用于指定Source，并在postCreate()方法中为当前ItemWidget实例关联相应的对象:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">define([</span><br><span class="line">    <span class="string">"dojo/_base/declare"</span>,</span><br><span class="line">    <span class="string">"dijit/_WidgetBase"</span>,</span><br><span class="line">], <span class="function"><span class="keyword">function</span>(<span class="params">declare, _WidgetBase</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> declare(<span class="string">"ItemWidget"</span>, [_WidgetBase], &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 本Widget实例所属的Source实例</span></span><br><span class="line">        dndSrc: <span class="literal">null</span>,</span><br><span class="line">        </span><br><span class="line">        postCreate: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.inherited(<span class="built_in">arguments</span>);</span><br><span class="line">            <span class="comment">// 不需要传递数据时，可忽略data参数</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.dndSrc !== <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">this</span>.dndSrc.setItem(<span class="keyword">this</span>.id, &#123;<span class="attr">type</span>:[<span class="string">"text"</span>]&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-take-sakura-as-my-primary-terminal" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/take-sakura-as-my-primary-terminal/"><strong>Take Sakura as My Primary Terminal</strong></a>
      <small class="article-date-index">&nbsp; 2013-07-07</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/take-sakura-as-my-primary-terminal/" class="article-date">
  <time datetime="2013-07-07T04:07:00.000Z" itemprop="datePublished">2013-07-07</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/take-sakura-as-my-primary-terminal/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>It’s a long time since I came across rxvt-unicode. </p>
<p>About seven years ago, when I switched from Windows XP to Ubuntu mainly for performance issues, I never be bored with searching for everything with a higher speed. To me, gnome-terminal is too much slow as a terminal being frequently opened and closed. Then, rxvt-unicode came through.</p>
<p>At first glance, rxvt-unicode was so ugly that I put it behind without the slightest bit of hesitation. Not until I once saw a screenshot did I realize this ugly thing can actually be pretty like that. So I started to take it as my primary terminal since then, for it was the fastest terminal I can find at that time.</p>
<p>Time flies, rxvt-unicode has proved to be a very good friend within these years, only until yesterday. I descided to change my Zsh theme to agnoster, which is a very pretty and git-friendly theme. Although I did everything according to the official manual, the right and left arrow signs were still displayed as boxes, then I tried almost all the methods I could find from Google, it still didn’t work.</p>
<p>So I reluctantly descided to part from rxvt-unicode. A number of terminals came out through these years, some of them also show a good performance, like sakura, terminator, etc. Now I take sakura as my primary terminal, it runs as fast as rxvt-unicode while working normally with agnoster or powerline.</p>
<p>Here is the final effect:</p>
<img src="http://pic.yupoo.com/leninlee/CZy402Q6/fc4i1.png" width="500">
<p><strong>Update (2013-07-07 23:34:53):</strong></p>
<p>Thanks to Star Brilliant, he mentioned LilyTerm in his comment. I discovered that it is even faster than Sakura while supplying plenty of functions, so now I descide to switch to LilyTerm.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-after-reading-wukongs-biography" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/after-reading-wukongs-biography/"><strong>读完《悟空传》</strong></a>
      <small class="article-date-index">&nbsp; 2013-07-05</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/after-reading-wukongs-biography/" class="article-date">
  <time datetime="2013-07-05T15:12:00.000Z" itemprop="datePublished">2013-07-05</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/青梅煮酒/">青梅煮酒</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/after-reading-wukongs-biography/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>我要这天，再遮不住我眼；要这地，再埋不了我心；要这众生，都明白我意；要那诸佛，都烟消云散！</strong></p>
<p>这是本适合少年读、青年悟、中年回味的书，很遗憾没有在我最好的几年里读过它。到了没有激情和理想的年龄，已经不能耐著性子读这种需要花时间和动脑子的书，这次在Kindle PaperWhite上匆匆翻完，我知道可能需要很多年去慢慢的品。</p>
<img src="http://pic.yupoo.com/leninlee/CZj8ATdH/medish.jpg">

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-get-position-in-qtablewidget-for-changed-cellwidgets" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/get-position-in-qtablewidget-for-changed-cellwidgets/"><strong>PySide: How to Get the Position of a Widget-Value-Changed Cell in QTableWidget</strong></a>
      <small class="article-date-index">&nbsp; 2013-07-01</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/get-position-in-qtablewidget-for-changed-cellwidgets/" class="article-date">
  <time datetime="2013-06-30T16:57:00.000Z" itemprop="datePublished">2013-07-01</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/get-position-in-qtablewidget-for-changed-cellwidgets/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>Assume we have created an instance of QTableWidget, in which cells are filled with widgets like QComboBox, QCheckBox, etc. When values are changed, we need to get the row and column indexes of the cells. But the QTableWidget.cellChanged() and QTableWidget.itemChanged() signals are only effective for cells containing QTableWidgetItem instances, for those in which widgets are filled in with QTableWidget.setCellWidget(), this doesn’t work.</p>
<p>This problem nearly made me crazy last weekend. So how can I make it ?</p>
<p>Here is the solution, by leveraging QSignalMapper, we can send other data to the slots instead of the default value. As the following code snippet shows, I put the row and column indexes into a string, then mapped it with the QComboBox.currentIndexChanged() slot. Notice that this slot has two generics, one accept an int type as the parameter and the other accept a string, so a <strong>QString</strong> key should be used to select the second generic.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">signalMapper = QtCore.QSignalMapper(self.ui)</span><br><span class="line">signalMapper.setMapping(comboWidget, <span class="string">'%d,%d'</span> % (rowIdx, colIdx))</span><br><span class="line">comboWidget.currentIndexChanged[<span class="string">'QString'</span>].connect(signalMapper.map)</span><br><span class="line">signalMapper.mapped[<span class="string">'QString'</span>].connect(self.__onCellWidgetChanged)</span><br></pre></td></tr></table></figure>
<p>The only downside of this solution is, we should call QTableWidget.cellWidget() seperately to get the new value. Which I think it’s not to much trouble.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-my-mouses-of-all-those-years" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/my-mouses-of-all-those-years/"><strong>那些年我用过的鼠标</strong></a>
      <small class="article-date-index">&nbsp; 2013-06-29</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/my-mouses-of-all-those-years/" class="article-date">
  <time datetime="2013-06-29T11:53:00.000Z" itemprop="datePublished">2013-06-29</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/my-mouses-of-all-those-years/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>第四款，罗技M185，卖相不错，无光，一节五号电池驱动，据说很省电，握感不错，正在用。</p>
<img src="http://pic.yupoo.com/leninlee/CYn6F5gI/medium.jpg">
<p>第三款，惠普百灵，卖相不错，大小适中，左侧两个快捷按键在浏览网页时前进后退很方便。两节七号电池驱动，不太省电。先后买过两个，都是滚轮失灵，似乎这款的滚轮有问题，伤心了。</p>
<img src="http://pic.yupoo.com/leninlee/CYn6Fr6q/medium.jpg">
<p>第二款，雷柏7100，形状较大，握感还可以，用一节五号电池，省电。最后按键失灵，壮烈牺牲。</p>
<img src="http://pic.yupoo.com/leninlee/CYn6G96i/medium.jpg">
<p>第一款，Thinkpad 31P7410，先后买过两三个，比较小巧，按键易坏，不推荐。</p>
<img src="http://pic.yupoo.com/leninlee/CYn6Fkha/medium.jpg">

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-after-reading-ten-years-of-traveling" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/after-reading-ten-years-of-traveling/"><strong>读完《背包十年》</strong></a>
      <small class="article-date-index">&nbsp; 2013-06-06</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/after-reading-ten-years-of-traveling/" class="article-date">
  <time datetime="2013-06-06T14:12:00.000Z" itemprop="datePublished">2013-06-06</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/青梅煮酒/">青梅煮酒</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/after-reading-ten-years-of-traveling/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>年龄越大，越有种对失去自由的恐惧。“老牛自知夕阳晚，不用扬鞭自奋蹄”，于是越来越想走得远点儿，然后就看到了这本书。这是我第一次正经买电子书，花了3￥，用了五天的时间。</p>
<p>这是本游记，主要讲的是作者十年旅行的见闻和心路历程，从自然平实的词句中可以看出作者心态很平和，能体会这种心态，已经很好。</p>
<img src="http://pic.yupoo.com/leninlee/CUTfChw6/medium.jpg">
<p><strong>PS: 有点淡淡的忧桑，今天，我高考十年……</strong></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/24/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><a class="page-number" href="/page/27/">27</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" href="/page/26/">Next &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 晴耕雨讀&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = '0x3f';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
