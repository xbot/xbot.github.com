<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>晴耕雨讀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晴耕雨讀">
<meta property="og:url" content="http://0x3f.org/page/36/index.html">
<meta property="og:site_name" content="晴耕雨讀">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晴耕雨讀">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93233020-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">目录</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="https://t.me/s/blingings">不灵</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://0x3f.org"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-note-after-the-mid-autumn-day" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/note-after-the-mid-autumn-day/"><strong>中秋后记</strong></a>
      <small class="article-date-index">&nbsp; 2010-09-26</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/note-after-the-mid-autumn-day/" class="article-date">
  <time datetime="2010-09-25T16:00:00.000Z" itemprop="datePublished">2010-09-26</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/note-after-the-mid-autumn-day/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>可以让回忆放肆一些。</p>
<p>中秋的晚上公司餐厅放电影，《邻家特工》和《越光宝盒》，本来打算看完《越光》就走，结果先放的是《特工》。也好，复习一下，好在这片子不错，再看也挺有意思。《越光》纯属烂片，但是如今看看这种不费脑子的东西也变得无可无不可。免费的零食很烘托气氛，唯一的惊喜是居然还有罐装啤酒。</p>
<p>回到住处的当夜就发布了Dumperor。其实这个东西很早就开始做了，起初的目的是为了判断数据库脚本从SQL Server迁移到Oracle和MySQL是否成功。单纯的迁移只能保证修改后的脚本在这两个数据库中执行不会报错，但究竟是不是该执行的东西都成功执行了，一般很难判断，尤其是那帮家伙总是在发版前一两天才告诉我要迁移脚本，那么多不规范的语句，能保证不报错就已经不错了，遑论没有遗漏。所以就著手做一个数据库表结构和数据的导出工具，这样只需用diff工具比较标准数据库和测试数据库导出的脚本就可以了。</p>
<p>从一开始我就决定不使用公司产品的一行代码。其实做这个东西最大的麻烦不是来自来自于如何查询不同的数据库的表结构，而是数据库抽象层。如果要白手起家搞个抽象层的话，我想可能代码量比Dumperor本身都大，于是选择了Yii框架。后来在Dumperor基本成型时又觉得为了仅仅使用最基本的数据库查询功能就捆绑这么大一个框架，有点搞笑，谢天谢地，我终于花时间学了PDO。</p>
<p>中秋节放假的第二天，开始读Google Code上关于Chrome扩展开发的官方文档。这事源于本尊被另一个Chrome扩展作者无视了。</p>
<p>一直强迫自己喜欢上Firefox，但都败了。本来对Opera充满希望，但是从10.0起它带给我的除了失望就是更多的失望，这个东西的发展就像它的国家的位置一样怪异，你永远不能以常人的思维去臆测Opera的开发者，他们就像一群母系氏族社会的娘们儿一样整天跟著感觉走。</p>
<p>于是不知道什么时候我就开始经常用Chrome了，前段时间开始用一个扩展辅助MLDonkey下载。这个东西会在工具栏里添加一个图标，唯一的作用就是打开选项设置页面设置那个也许这辈子都只需要设置一次的MLDonkey的URL地址。于是我给那个扩展的作者写了封邮件，那家伙居然到现在都没有回复。</p>
<p>所以本尊决定无视他了。太祖武皇帝的那句丰衣足食的圣谕真是至理名言，读完文档我就发现这个扩展完全应该用Chrome的Page Action取代Browser Action，简单地说就是当且仅当本页面中包含有可下载的资源时才在地址栏中显示一个图标，而不应该总是在工具栏占用一个图标的位置。</p>
<p>随后要做的就是用AJAX请求取代弹出新窗口的方式添加下载任务，我嫌每次添加一个下载任务后都要关闭一个弹出窗口太麻烦。我的目标是用AJAX请求将要下载的任务在后台传递给MLDonkey，并用Chrome的Desktop Notification功能弹出桌面提示对话框显示结果状态。这样很优雅。</p>
<p>但是实际去做的时候问题来了，虽然Chrome本身允许扩展使用跨域的AJAX，但是至少在和MLDonkey进行通讯时，无论成功与否，得到的返回信息都是空的，状态码也都是0。这个问题浪费了我几乎一整天的时间，最终我决定用AJAX的请求响应时间来判断失败或成功，因为一次AJAX请求响应过程在MLDonkey没启动的时候耗费的时间一般会比正在运行时要长。这就要求每个用户都要根据自己的情况设定合适的超时时间。为了避免麻烦，最后还是实现了通过弹窗添加下载任务的模式，毕竟这个东西总是可靠的。</p>
<p>要发布的时候发现如今在Chrome Extension Gallery中发布扩展居然要收费了，虽然只是一次性的。最后花了八两银子注册了Google Checkout账户，又付了五刀美帝币，才把DonkeyBuddy传上去。发布个免费扩展还得倒贴，本尊也太背了吧。</p>
<p>节后收到了Dell sk8115键盘、HP百灵无线鼠标和Nokia BH-105蓝牙耳机，sk8115是用来让我的纤纤玉手撒野的，百灵鼠是用来接替即将退役的雷柏7100的，而BH-105和我的小七搭配得天衣无缝。</p>
<p>很久没有安静地整理一下头绪了，感谢我那价值四十两银子的Dell sk8115，它让我显得如此的语无伦次。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-donkeybuddy-a-chrome-extension-for-mldonkey" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/donkeybuddy-a-chrome-extension-for-mldonkey/"><strong>DonkeyBuddy: A Chrome Extension for MLDonkey</strong></a>
      <small class="article-date-index">&nbsp; 2010-09-24</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/donkeybuddy-a-chrome-extension-for-mldonkey/" class="article-date">
  <time datetime="2010-09-23T16:00:00.000Z" itemprop="datePublished">2010-09-24</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/donkeybuddy-a-chrome-extension-for-mldonkey/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <div class="illustration_left">
<a href="http://picasaweb.google.com/lh/photo/CLpE8Gtpb3r3F9kcqmS60g?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh5.ggpht.com/_ceUJ_lBTHzc/TJyWhIpMAgI/AAAAAAAABec/KDw6n_qdQ98/s800/donkey-256x256.png"></a>
</div>

<p><strong>DonkeyBuddy</strong> is an extension for Google Chrome Browser. It's intended to make life easier when you add downloading tasks to MLDonkey.</p>

<h2>Features</h2>

<ol>
<li>Users can choose how to interact with MLDonkey, either by AJAX or
popup windows.</li>
<li>The AJAX mode interacts with MLDonkey by AJAX requests and uses
desktop notifications to show the results, so it won't bother you by
popping up windows and forcing you to close them.</li>
<li>The popup-window mode interacts with MLDonkey by popping up a window
and displays results in it, this is always a reliable way to add
downloads but annoying.</li>
<li>An icon will be displayed in the location bar only when downloadable
resources are found in the current tab, so it saves you the space in
both toolbar and location bar.</li>
<li>Batch downloading.</li>
</ol>

<h2>Screenshots</h2>

<ol>
<li>Location bar icon: <br>
<a href="http://picasaweb.google.com/lh/photo/021647BS--VLalgORMtuVA?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh6.ggpht.com/_ceUJ_lBTHzc/TJyWhUJIzBI/AAAAAAAABeg/ZQ2WeLfTf0k/s800/donkeybuddy-location_bar_icon_01.png" alt="image"></a></li>
<li>Desktop notification: <br>
<a href="http://picasaweb.google.com/lh/photo/aBu0jSZu3y7Ux-EKKgQibQ?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh6.ggpht.com/_ceUJ_lBTHzc/TJyWhchc1lI/AAAAAAAABek/O3OuDRkgL88/s400/donkeybuddy-notification_01.png" alt="image"></a></li>
<li>Popup window: <br>
<a href="http://picasaweb.google.com/lh/photo/GbGe38VG8mU_LyXZDFYgtA?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh5.ggpht.com/_ceUJ_lBTHzc/TJyWhmg-04I/AAAAAAAABeo/8cbj0a-m_Fg/s400/donkeybuddy-popup_window_01.png" alt="image"></a></li>
<li>Settings page: <br>
<a href="http://picasaweb.google.com/lh/photo/uUKzfwcmEQfJaHY6cHVNqw?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh3.ggpht.com/_ceUJ_lBTHzc/TJyWhsEQILI/AAAAAAAABes/ezlPD6jaUuQ/s400/donkeybuddy-settings_01.png" alt="image"></a></li>
</ol>

<h2>Install</h2>

<p><a href="https://chrome.google.com/webstore/detail/hbajjpcakkngealbehjippmdbfapodnn" target="_blank" rel="noopener">https://chrome.google.com/webstore/detail/hbajjpcakkngealbehjippmdbfapodnn</a></p>

<h2>FAQ</h2>

<ol>
<li><p><strong>Why a success notification pops up when I haven't even started
MLDonkey ?</strong></p>

<ul>
<li>Since the responses of the cross-domain AJAX requests have an
empty message and a status which has the value 0, so I can't
identify that whether they are successful or not.</li>
<li>But when MLDonkey is not running, AJAX requests always take more
time to receive responses, so if a request has not received its
reponse within a reasonable time, DonkeyBuddy will take it as a
failure. So you should set the *AJAX timeout* option to a
suitable value on your condition.</li>
<li>If you are still in trouble, use the popup-windows mode instead.</li>
</ul></li>
<li><p><strong>Why a failure notification pops up when the downloading task has
acturally been added ?</strong></p>

<ul>
<li>Take a look at the upper question.</li>
</ul></li>
<li><p><strong>How can I send the selected links to MLDonkey in one click ?</strong></p>

<ul>
<li>Click on this extension's icon in the address bar.</li>
</ul></li>
</ol>

<h2>Change log</h2>

<blockquote>
  <p><strong>version 1.1.0 (2011-05-15 Sunday)</strong>
  Enable batch downloading for VeryCD.com.</p>
  
  <p><strong>version 1.0.1 (2010-09-25 Saturday)</strong>
  1.  Fix the problem that the image in the option page doesn't display
      as is expected.
  2.  Set the default value of the option *AJAX timeout* to 1000.</p>
  
  <p><strong>version 1.0 (2010-09-24 Friday)</strong> Initial release.</p>
</blockquote>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-dumperor-as-a-multidb-dumping-tool" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/dumperor-as-a-multidb-dumping-tool/"><strong>Dumperor: Multi-Database Dumping Toolkit</strong></a>
      <small class="article-date-index">&nbsp; 2010-09-23</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/dumperor-as-a-multidb-dumping-tool/" class="article-date">
  <time datetime="2010-09-22T16:00:00.000Z" itemprop="datePublished">2010-09-23</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/dumperor-as-a-multidb-dumping-tool/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <div class="illustration_left"><br>    <a href="http://picasaweb.google.com/lh/photo/lR2jgtHibgYwfhCy3fJyMQ?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh3.ggpht.com/_ceUJ_lBTHzc/TI44ZufyOhI/AAAAAAAABeM/6ElHu0gdYzY/s800/dumperor.png"></a><br></div>

<p><strong>Dumperor</strong> is a multi-database dumping toolkit. It dumps table structures and data from databases, and generates CREATE-TABLE SQL statements for table structures or INSERT SQL statements for data.</p>
<p>Part of the original intention for developing Dumperor is to check whether a migration of SQL scripts from one database to another is successful, you know, by comparing the differences between two files, one dumped before executing scripts and the other after. The second part is to ensure that upgrades to table structures or data not miss anything, similarly. The last part is to take samples of databases and put up development or testing environments with them, or even replace sensitive information with fake data.</p>
<p>Dumperor is written in PHP 5 and hosted on GitHub with the New BSD License:</p>
<p><a href="https://github.com/xbot/Dumperor" target="_blank" rel="noopener">https://github.com/xbot/Dumperor</a></p>
<p>For the shortage of time, there must be some limitations and bugs in Dumperor. So reports from users are welcome, emails prefered. I will be very grateful if someone send their suggestions on Dumpeor to me.</p>
<h2>Features</h2>

<ol><br>    <li>Currently support Microsoft SQL Server, Oracle and MySQL.</li><br>    <li>Dump table structures and generate CREATE-TABLE SQL statements.</li><br>    <li>Dump data and generate INSERT SQL statements.</li><br>    <li>Dump table structures or data and output them in a human readable format.</li><br>    <li>Save dumped information to user-specified files.</li><br>    <li>Display table structures with web page tables in the web browser.</li><br>    <li>Options controlling which information should be displayed in the web browser.</li><br>    <li>Options controlling which information should be and should not be dumped from the database.</li><br>    <li>A limit number can be set to take sample of a huge database.</li><br>    <li>Needless tables or columns can be prevented from appearing in dumped results.</li><br>    <li>Only the needed tables are to be exported if you like.</li><br>    <li>Sensitive columns can be dumped with fake data.</li><br>    <li>Conditions can be added to data querying statements.</li><br>    <li>With PDO support by default but extensive to many kinds of database toolkits.</li><br>    <li>More in the future …</li><br></ol>

<h2>Requirements</h2>

<ol><br>    <li>A web server configured with PHP5 support.</li><br>    <li>PDO feature of PHP.</li><br>    <li>PHP 5.x, notice that some versions in 5.3.x series have a <a href="http://bugs.php.net/bug.php?id=47332" target="_blank" rel="noopener">bug in function parse_ini_file(), which may cause trouble.</a></li><br></ol>

<h2>Limitations (Known Issues)</h2>

<ol><br>    <li>Conditions for data querying only support numeric columns and equation relation.</li><br>    <li>Support for auto increment columns has not been implemented.</li><br>    <li>Sensitive columns must be prefixed with table names.</li><br>    <li>Needless columns must be specified only with column names, nothing more.</li><br>    <li>Data types which have not been tested may fail dumping.</li><br></ol>

<h2>Installation Instructions</h2>

<ol><br>    <li>Download a stable release from GitHub or clone a git repo:</li><br>    <ul><br>        <li><code>git clone git://github.com/xbot/Dumperor.git</code></li><br>    </ul><br>    <li>Copy files to a folder which can be visited by the web server, e.g. www/dumperor.</li><br>    <li>Rename dumperor.ini.sample to dumperor.ini and change the settings to meet your needs.</li><br>    <li>Visit Dumperor from the web browser to start dumping.</li><br></ol>

<h2>News</h2>

<ol><br>    <li>2011-03-14 v1.0.0 released. <a href="https://github.com/xbot/Dumperor/wiki/Changelog" target="_blank" rel="noopener">changelog</a></li><br>    <li>2010-09-22 v0.1a released. <a href="https://github.com/xbot/Dumperor/wiki/Changelog" target="_blank" rel="noopener">changelog</a></li><br></ol>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-cool-archlinux-down" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-cool-archlinux-down/"><strong>Arch不完全降温笔记</strong></a>
      <small class="article-date-index">&nbsp; 2010-09-18</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-cool-archlinux-down/" class="article-date">
  <time datetime="2010-09-17T16:00:00.000Z" itemprop="datePublished">2010-09-18</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-cool-archlinux-down/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>主要目标是解决我的X200在Archlinux<em>（本文内容均基于此发行版）</em>下CPU温度长期居高不下的问题，基本原理是使用<a href="http://wiki.archlinux.org/index.php/Cpufrequtils" target="_blank" rel="noopener">cpufrequtils</a>根据CPU负载状况自动变频，和使用<a href="http://wiki.archlinux.org/index.php/Laptop_Mode_Tools" target="_blank" rel="noopener">laptop-mode-tools</a>实现其它硬件设备的自动节能。最直接的效果是省电，从而延长电池的使用时间，产生的附加影响就是CPU及笔记本整体的温度下降。我几乎不用电池，所以节能不是我的关注点，但降温却是我所欲也。</p>

<p>首先安装cpufrequtils，并将<strong>acpi-cpufreq</strong>、<strong>cpufreq_ondemand</strong>、<strong>cpufreq_powersave</strong>加入<strong>rc.conf</strong>的<strong>MODULES</strong>中，使系统在启动时加载这些模块。</p>

<p>默认情况下，内核采用cpufreq的performance模式，以获得最高性能，现在用ondemand模式使CPU根据负载状况自动变频。修改<strong>/etc/conf.d/cpufreq</strong>文件，将<strong>governor</strong>项设为<strong>ondemand</strong>。</p>

<p>将<strong>cpufreq</strong>加入<strong>rc.conf</strong>的<strong>DAEMONS</strong>中，此守护进程会在系统启动时读取配置文件<strong>/etc/conf.d/cpufreq</strong>中的设置项，故上面设置的ondemand模式会在系统启动时得以自动生效。</p>

<p>然后安装laptop-mode-tools，并修改<strong>/etc/laptop-mode/laptop-mode.conf</strong>，打开所有的三个以<strong>ENABLE</strong>开头的选项，和所有以<strong>CONTROL</strong>开头的选项。</p>

<p>将<strong>laptop-mode</strong>加入<strong>rc.conf</strong>的<strong>DAEMONS</strong>中，使其随系统自动启动。</p>

<p>修改<strong>/etc/laptop-mode/conf.d/usb-autosuspend.conf</strong>，此配置文件用来配置laptop-mode如何管理USB设备的电源使用。我希望在任何时候都启用USB设备自动节能，但需要把我的无线鼠标排除在外，故作如下配置：</p>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用USB设备自动挂起</span></span><br><span class="line">CONTROL_USB_AUTOSUSPEND=<span class="string">"auto"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将不使用自动挂起的USB设备的ID填在下面，使用lsusb命令查看ID</span></span><br><span class="line">AUTOSUSPEND_USBID_BLACKLIST=<span class="string">"04fc:05dc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 总是启用USB自动挂起</span></span><br><span class="line">BATT_SUSPEND_USB=1</span><br><span class="line">LM_AC_SUSPEND_USB=1</span><br><span class="line">NOLM_AC_SUSPEND_USB=1</span><br></pre></td></tr></table></figure>

<p>类似地，修改<strong>intel-hda-powersave.conf</strong>，此配置文件用于配置laptop-mode如何管理Intel HDA音频芯片的电源使用。我希望一直启用声卡自动节能，并适当地将自动进入节电模式的空闲时间增加到30秒，故配置如下：</p>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用Intel音频芯片电源管理</span></span><br><span class="line">CONTROL_INTEL_HDA_POWER=<span class="string">"auto"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 总是启用</span></span><br><span class="line">BATT_INTEL_HDA_POWERSAVE=1</span><br><span class="line">LM_AC_INTEL_HDA_POWERSAVE=1</span><br><span class="line">NOLM_AC_INTEL_HDA_POWERSAVE=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 适当地设置声卡进入节电模式的超时时间</span></span><br><span class="line">INTEL_HDA_DEVICE_TIMEOUT=30</span><br></pre></td></tr></table></figure>

<p>类似地，修改<strong>intel-sata-powermgmt.conf</strong>，启用sata硬盘接口的电源管理。由于我用Blueman控制蓝牙设备，一般不用时都将其关闭，同时经常使用wifi，故蓝牙和无线网卡均未作配置。</p>

<p>最后，关闭conky,Firefox和Chromium，<a href="http://www.lesswatts.org/projects/powertop/" target="_blank" rel="noopener">powertop</a>显示conky是个很吵闹的东西，关掉它可以使<strong>Wakeups-from-idle per second</strong>的值下降很多，另外Chromium和Firefox也是耗电大户。</p>

<p><em>在此之前，系统空闲时CPU温度一般是50多度，普通使用时一般在60多度，如果开了kvm虚拟机会达到60至90度间。经过以上设置，系统空闲时CPU温度一度下降到39度，即使开了虚拟机，一般也可维持在50到80度间。</em></p>

<p>另外，对于以上内容，我还有些没搞明白的地方和要补充说明的东西：</p>

<ol>
<li>虽然将laptop-mode加入rc.conf且已随系统启动，但使用命令“<strong>cat /proc/sys/vm/laptop_mode</strong>”查询得到的结果仍然是0，也就是说没有自动启用laptop-mode，必须使用命令“<strong>sudo /etc/rc.d/laptop-mode restart</strong>”手动重启才行。目前没有找到解决办法。</li>
<li>虽然启用laptop-mode接管声卡电源管理，但没找到查看是否生效的方法，于是在/etc/rc.local中加入命令“<strong>echo 1 &gt; /sys/module/snd<em>hda</em>intel/parameters/power_save</strong>”以强制声卡节电。</li>
<li>Intel的powertop是个好东西，用它可以查看哪些进程最影响CPU节能。我们优化的标准之一就是使powertop中显示的“Wakeups-from-idle per second”尽可能地减少。powertop的另一个特点就是通过自动检查当前系统中电源使用的配置情况给出优化的建议，这是个很贴心的功能。</li>
</ol>

<p>鉴于目前存疑较多并将继续尝试，所以在标题中特别注明“不完全”三个字……</p>

<h3>参考</h3>

<ol>
<li>http://itgen.blogspot.com/2009/03/energy-management-in-linux.html</li>
<li>http://www.ibm.com/developerworks/cn/linux/l-cpufreq-1/index.html</li>
<li>http://www.lesswatts.org/</li>
</ol>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-toggle-quickfix-in-vim-using-hotkeys" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-toggle-quickfix-in-vim-using-hotkeys/"><strong>使用热键切换Vim的QuickFix窗口打开状态</strong></a>
      <small class="article-date-index">&nbsp; 2010-09-10</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-toggle-quickfix-in-vim-using-hotkeys/" class="article-date">
  <time datetime="2010-09-09T16:00:00.000Z" itemprop="datePublished">2010-09-10</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-toggle-quickfix-in-vim-using-hotkeys/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>QuickFix窗口只有打开和关闭的命令，而使用一个热键来切换打开状态可以减少热键资源的浪费，使用也更方便。</p>
<p>从<a href="http://vim.wikia.com/wiki/Toggle_to_open_or_close_the_quickfix_window" target="_blank" rel="noopener">这里</a>找到使用自定义函数完成此功能的方法：使用一个全局变量记录QuickFix窗口的打开状态，从而判断是应该关闭还是打开。但其提供的函数存在状态同步的问题，假如在QuickFix窗口中使用“:q”退出窗口，此方法将不能正常工作。评论中给出了很好的解决方法，但其提供的代码有些小问题，修改之后如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span><span class="keyword">co</span> :QFix<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>ct :<span class="keyword">call</span> QFixToggle(<span class="number">1</span>)<span class="symbol">&lt;CR&gt;</span></span><br><span class="line">command! -bang -nargs=? QFix <span class="keyword">call</span> QFixToggle(<span class="symbol">&lt;bang&gt;</span><span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">QFixToggle</span><span class="params">(forced)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">exists</span>(<span class="string">"g:qfix_win"</span>) &amp;&amp; <span class="variable">a:forced</span> != <span class="number">0</span></span><br><span class="line">        <span class="keyword">cclose</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">exists</span>(<span class="string">"g:my_quickfix_win_height"</span>)</span><br><span class="line">            <span class="keyword">execute</span> <span class="string">"copen "</span>.<span class="variable">g:my_quickfix_win_height</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">copen</span></span><br><span class="line">        <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">augroup</span> QFixToggle</span><br><span class="line">    autocmd!</span><br><span class="line">    <span class="keyword">autocmd</span> BufWinEnter quickfix <span class="keyword">let</span> <span class="variable">g:qfix_win</span> = <span class="built_in">bufnr</span>(<span class="string">"$"</span>)</span><br><span class="line">    <span class="keyword">autocmd</span> BufWinLeave * <span class="keyword">if</span> <span class="built_in">exists</span>(<span class="string">"g:qfix_win"</span>) &amp;&amp; <span class="built_in">expand</span>(<span class="string">"&lt;abuf&gt;"</span>) == <span class="variable">g:qfix_win</span> | unlet! <span class="variable">g:qfix_win</span> | <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">augroup</span> END</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-wp-batchcat" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/wp-batchcat/"><strong>WordPress Plugin: Batch Cat</strong></a>
      <small class="article-date-index">&nbsp; 2010-09-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/wp-batchcat/" class="article-date">
  <time datetime="2010-09-03T16:00:00.000Z" itemprop="datePublished">2010-09-04</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/wp-batchcat/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://picasaweb.google.com/lh/photo/bqYPszwt0P7OI9snKxv3WA?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh3.ggpht.com/_ceUJ_lBTHzc/TIIMnE-09dI/AAAAAAAABdk/q_hDtyXJozo/s800/wp-batch-cat.png"></a></p>
<h3>Introduction</h3>

<p>Batch Cat is intended to help users change categories of posts in bulk.</p>
<p>The main features are:</p>
<ol><br>    <li>Assign the selected categories to posts.</li><br>    <li>Append the selected categories to posts.</li><br>    <li>Delete the selected categories from posts.</li><br>    <li>Intuitionistic operating manners which come up with people’s common practice.</li><br>    <li>Configurable number of posts listed in one page.</li><br>    <li>Slimming but enough searching and sorting options.</li><br>    <li>More in the future.</li><br></ol>

<h3>Screenshot</h3>

<p><a href="http://picasaweb.google.com/lh/photo/HbcUjNJ5wuK_XtIUxw1GWw?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh3.ggpht.com/_ceUJ_lBTHzc/TIIK1-R9vDI/AAAAAAAABdc/18irrESzXok/s400/wordpress_plugin-batch_cat.png"></a></p>
<h3>Installation &amp; Usage</h3>

<p>As usual, upload the folder of Batch Cat to the wordpress plugin directory, activate it then.</p>
<p>You can perform operations in the page which lies in <b>Tools-&gt;Batch Cat</b> in the admin panel.</p>
<p>To alter settings of this plugin, go to <b>Settings-&gt;Batch Cat Settings</b>.</p>
<h3>Download</h3>

<p>Batch Cat is now hosted in the wordpress plugin repository:</p>
<p><a href="http://wordpress.org/extend/plugins/batch-cat/" target="_blank" rel="noopener">http://wordpress.org/extend/plugins/batch-cat/</a></p>
<h3>Wish List</h3>

<ol><br><li>I18N</li><br><li>More search options</li><br><li>More information in the post list</li><br></ol>

<h3>Change Log</h3>

<blockquote><br><strong>2011-03-20 Sunday</strong><br><ol><br>    <li>Solve the compatibility <a href="http://wordpress.org/support/topic/plugin-batch-cat-doesnt-work-for-31" target="_blank" rel="noopener">problem</a> under Wordpress 3.1, thanks to <a href="http://coliq.wongkediri.com/batch-cat-wordpress-plugin-not-working-fixed.html" target="_blank" rel="noopener">wongkediri</a>.</li><br></ol><br></blockquote>

<blockquote><br><strong>2010-12-12 Sunday</strong><br><ol><br>    <li>Add the ability to append the selected categories to posts</li><br>    <li>Add the ability to delete the selected categories from posts</li><br></ol><br></blockquote>

<blockquote><br><b>2010-09-04 Saturday</b><br>Initial release.<br></blockquote>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-after-reading-wordpress-plug-in-development" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/after-reading-wordpress-plug-in-development/"><strong>读完《WordPress Plug-in Development》</strong></a>
      <small class="article-date-index">&nbsp; 2010-08-29</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/after-reading-wordpress-plug-in-development/" class="article-date">
  <time datetime="2010-08-28T16:00:00.000Z" itemprop="datePublished">2010-08-29</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/after-reading-wordpress-plug-in-development/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>花了两天时间读完了《WordPress Plug-in Development》，通过实例讲解，很细致，适合用来入门，当然，深度和广度都有限。</p>
<p><a href="http://picasaweb.google.com/lh/photo/k7nT3M9jrDW1dPv-nzKJvQ?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh4.ggpht.com/_ceUJ_lBTHzc/THnN7TJZDlI/AAAAAAAABdI/OBmuprXqpX4/s400/wordpress-plugin-development.jpg"></a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-a-bash-script-downloading-videos-in-batch" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/a-bash-script-downloading-videos-in-batch/"><strong>批量下载视频的BASH脚本</strong></a>
      <small class="article-date-index">&nbsp; 2010-08-28</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/a-bash-script-downloading-videos-in-batch/" class="article-date">
  <time datetime="2010-08-27T16:00:00.000Z" itemprop="datePublished">2010-08-28</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/a-bash-script-downloading-videos-in-batch/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>两周前为了批量下载某视频网站中的电视剧，写了个BASH脚本。将电视剧列表页面的URL地址作为唯一参数传给脚本，然后就会把所有视频下载到当前目录下，并自动重命名，同时生成一个M3U格式的播放列表。</p>
<p>由于在线视频不支持断点续传，所以对于单个视频来说无法实现。但对于整个批量下载任务来说，实现了宏观上的断点续传，已经下载的视频不会被重复下载。由于有些视频网站会在午夜更改视频地址，所以这一点很有用。</p>
<p>主流视频网站应该是都支持的，我只测试了我下载电视剧的网站，<strong>不支持的都是非主流的！</strong></p>
<p>唯一可能需要注意的依赖是PHP，必须安装后才能使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print_help_msg</span></span> () &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"You see, I'm nothing ."</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_param</span></span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$#</span> -ne 1 ]; <span class="keyword">then</span></span><br><span class="line">        print_help_msg</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_m3u</span></span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> ! [ -a p.m3u ] || [ `wc -l p.m3u|awk <span class="string">'&#123; print $1 &#125;'</span>` -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">'#EXTM3U'</span> &gt; p.m3u</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_param $*</span><br><span class="line">check_m3u</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> LC_ALL=en_US.UTF-8</span><br><span class="line"></span><br><span class="line">ue=$(php -r <span class="string">"echo urlencode('<span class="variable">$1</span>');"</span>)</span><br><span class="line">parser=<span class="string">"http://www.flvcd.com/parse.php?flag=&amp;format=&amp;kw=<span class="variable">$ue</span>&amp;sbt=%BF%AA%CA%BCGO%21"</span></span><br><span class="line"><span class="keyword">if</span> ! wget <span class="variable">$parser</span> -U mozilla -O meta.html ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Unable to touch the parser, check network status for the cause ."</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">grep <span class="string">"&lt;N&gt;"</span> meta.html &gt; title.lst</span><br><span class="line">grep <span class="string">"&lt;U&gt;"</span> meta.html &gt; url.lst</span><br><span class="line">iconv -f gbk -t utf-8 title.lst -o title.lst</span><br><span class="line">sed -i <span class="string">'s/&lt;N&gt;//g'</span> title.lst</span><br><span class="line">sed -i <span class="string">'s/ //g'</span> title.lst</span><br><span class="line">sed -i <span class="string">'s/&lt;U&gt;//g'</span> url.lst</span><br><span class="line"></span><br><span class="line">l1=`wc -l title.lst|awk <span class="string">'&#123; print $1 &#125;'</span>`</span><br><span class="line">l2=`wc -l url.lst|awk <span class="string">'&#123; print $1 &#125;'</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$l1</span>"</span> != <span class="string">"<span class="variable">$l2</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Title.lst has <span class="variable">$l1</span> lines, but url.lst got <span class="variable">$l2</span>."</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$l1</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Nothing got from the parser, check meta.html for detail info."</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">arrTitle=(`cat title.lst`)</span><br><span class="line">arrURL=(`cat url.lst`)</span><br><span class="line"></span><br><span class="line">idx=$((`wc -l p.m3u|awk <span class="string">'&#123; print $1 &#125;'</span>`-1))</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$idx</span> -lt <span class="variable">$l1</span> ]; <span class="keyword">do</span></span><br><span class="line">    title=<span class="variable">$&#123;arrTitle[$idx]&#125;</span></span><br><span class="line">    url=<span class="variable">$&#123;arrURL[$idx]&#125;</span></span><br><span class="line">    idx=$((idx+1))</span><br><span class="line">    <span class="keyword">if</span> ! wget <span class="variable">$url</span> -U mozilla -O <span class="string">"<span class="variable">$&#123;title&#125;</span>.flv"</span> ; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Failed fetching <span class="variable">$&#123;title&#125;</span>.flv, maybe its URL has been changed !"</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    cmd=<span class="string">"sed -i '\$a\\<span class="variable">$&#123;title&#125;</span>.flv' p.m3u"</span></span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$cmd</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'done !'</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
<p>另外，使用VLC执行播放列表效果灰常不错，视频之间衔接平滑流畅。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-auto-maximize-gvim-at-startup" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-auto-maximize-gvim-at-startup/"><strong>启动GVim时自动最大化窗口的方法</strong></a>
      <small class="article-date-index">&nbsp; 2010-08-25</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-auto-maximize-gvim-at-startup/" class="article-date">
  <time datetime="2010-08-24T16:00:00.000Z" itemprop="datePublished">2010-08-25</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-auto-maximize-gvim-at-startup/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>根据帮助文档，gvim在windows下的最大化是通过模拟打开窗口菜单并点击最大化菜单项实现的，而在Linux下的方法较为灵活。</p>
<p>下面的方法是在vim中通过调用wmctrl实现最大化的方法：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'win32'</span>)</span><br><span class="line">    <span class="keyword">au</span> GUIEnter * <span class="keyword">simalt</span> ~<span class="keyword">x</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">au</span> GUIEnter * <span class="keyword">call</span> MaximizeWindow()</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">MaximizeWindow</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">silent</span> !wmctrl -r :ACTIVE: -<span class="keyword">b</span> <span class="built_in">add</span>,maximized_vert,maximized_horz</span><br><span class="line"><span class="keyword">endfunction</span></span><br></pre></td></tr></table></figure>
<p>当然也可以通过配置窗口管理器规则实现自动最大化，但上面的方法更灵活。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-run-sql-scripts-in-mysql-oracle-within-installshield" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-run-sql-scripts-in-mysql-oracle-within-installshield/"><strong>InstallShield在MySQL和Oracle中执行SQL脚本的方法</strong></a>
      <small class="article-date-index">&nbsp; 2010-08-24</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-run-sql-scripts-in-mysql-oracle-within-installshield/" class="article-date">
  <time datetime="2010-08-23T16:00:00.000Z" itemprop="datePublished">2010-08-24</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-run-sql-scripts-in-mysql-oracle-within-installshield/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2>简述</h2>

<p>InstallShield已经内建了对MySQL和Oracle的支持。但是这个功能是通过ODBC实现的，它对SQL脚本的格式要求非常严格，因此已经通过官方客户端测试的脚本在IS中执行时往往就会报错。</p>
<p>一般来说，数据库脚本只保证通过官方客户端测试即可，同时维护一份供IS执行的脚本费时费力。因此，考虑安装程序对两数据库的支持通过官方客户端实现。</p>
<h2>MySQL</h2><br><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">function InstallMySQLComponent(szComponent)</span><br><span class="line">    NUMBER nResult;</span><br><span class="line">    STRING szServer,szDB,szUser,szPassword,sCMD,sOPT,sResult1,sResult2,svLine,sMsg,sPath;</span><br><span class="line">    NUMBER nvFileHandle,nvCount;</span><br><span class="line">    LIST listStatus;</span><br><span class="line">begin</span><br><span class="line">    sMsg = &apos;安装&apos;+szComponent+&apos; ...&apos;;</span><br><span class="line">    SdShowMsg(sMsg, TRUE);</span><br><span class="line">    // source命令不认识windows路径中的反斜杠，故将SRCDIR中的反斜杠替换成斜杠</span><br><span class="line">    sPath = SRCDIR;</span><br><span class="line">    StrReplace(sPath, &apos;\\&apos;, &apos;/&apos;, 0);</span><br><span class="line">    // Fetch database connection information</span><br><span class="line">    SQLRTGetConnectionInfo( &apos;mysql&apos;, szServer, szDB, szUser, szPassword );</span><br><span class="line">    sCMD = WINSYSDIR^&apos;cmd.exe&apos;;</span><br><span class="line">    sOPT = &apos; /c &apos;+SRCDIR^&apos;mysql.exe -h&apos;+szServer+&apos; -u&apos;+szUser+&apos; -p&apos;+szPassword+&apos; -D&apos;+szDB;</span><br><span class="line">    sOPT = sOPT+&apos; -e &quot;source &apos;+sPath^szComponent+&apos;.sql&quot; &gt; &apos;+SRCDIR^&apos;dbstatus.txt 2&gt;&amp;1&apos;;</span><br><span class="line">    // Execute the script associated with the given component in database</span><br><span class="line">    nResult=LaunchAppAndWait(sCMD, sOPT, WAIT|LAAW_OPTION_HIDDEN);</span><br><span class="line">    if (nResult &lt; 0) then</span><br><span class="line">        MessageBox(&apos;Failed installing &apos;+szComponent+&apos; !&apos;, SEVERE);</span><br><span class="line">        abort;</span><br><span class="line">    endif;</span><br><span class="line">    // 关闭安装提示</span><br><span class="line">    SdShowMsg(&apos;&apos;, FALSE);</span><br><span class="line">    // Read dbstatus.txt</span><br><span class="line">    OpenFileMode(FILE_MODE_NORMAL);</span><br><span class="line">    if (OpenFile(nvFileHandle, SRCDIR, &apos;dbstatus.txt&apos;)&lt;0) then</span><br><span class="line">        MessageBox(&apos;Failed checking the status of installing &apos;+szComponent+&apos; !&apos;, SEVERE);</span><br><span class="line">        abort;</span><br><span class="line">    endif;</span><br><span class="line">    listStatus = ListCreate(STRINGLIST);</span><br><span class="line">    while GetLine(nvFileHandle, svLine) = 0</span><br><span class="line">        ListAddString(listStatus, svLine, AFTER);</span><br><span class="line">    endwhile;</span><br><span class="line">    CloseFile(nvFileHandle);</span><br><span class="line">    // Count how many lines fetched from dbstatus.txt</span><br><span class="line">    nvCount = ListCount(listStatus);</span><br><span class="line">    if nvCount &gt; 0 then</span><br><span class="line">        sMsg = &quot;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\n&quot;;</span><br><span class="line">        sMsg = sMsg+&quot;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\n&quot;;</span><br><span class="line">        sMsg = sMsg+&quot;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）&quot;;</span><br><span class="line">        nResult = AskYesNo(sMsg, YES);</span><br><span class="line">        if (nResult = YES) then</span><br><span class="line">            LaunchApp(WINSYSDIR^&apos;notepad.exe&apos;, SRCDIR^&apos;dbstatus.txt&apos;);</span><br><span class="line">	endif;                   </span><br><span class="line">        abort;</span><br><span class="line">    endif;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><br><br><h2>Oracle</h2><br><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">function InstallOracleComponent(szComponent)  </span><br><span class="line">    NUMBER nResult,nvFileHandle,nIndex,nvCount;</span><br><span class="line">    STRING sMsg,szServer,szDB,szUser,szPassword,sCMD,sOPT,sInstance,sTmp,svLine;</span><br><span class="line">    LIST listStatus;</span><br><span class="line">begin</span><br><span class="line">    sMsg = &apos;安装&apos;+szComponent+&apos; ...&apos;;</span><br><span class="line">    SdShowMsg(sMsg, TRUE);</span><br><span class="line">    // Fetch database connection information</span><br><span class="line">    SQLRTGetConnectionInfo( &apos;oracle&apos;, szServer, szDB, szUser, szPassword );</span><br><span class="line">    nIndex = StrFind(szServer, &apos;:&apos;);</span><br><span class="line">    nIndex = StrFindEx(szServer, &apos;/&apos;, nIndex);</span><br><span class="line">    StrSub(sInstance, szServer, nIndex+1, 100);</span><br><span class="line">    sCMD = WINSYSDIR^&apos;cmd.exe&apos;;</span><br><span class="line">    sOPT = &apos; /c &apos;+&apos;sqlplus.exe -L -S &apos;+szUser+&apos;/&apos;+szPassword+&apos;@&apos;+sInstance;</span><br><span class="line">    sOPT = sOPT+&apos; @&apos;+SRCDIR^szComponent+&apos;.sql &gt; &apos;+SRCDIR^&apos;dbstatus.txt 2&gt;&amp;1&apos;;</span><br><span class="line">    // Execute the script associated with the given component in database</span><br><span class="line">    nResult=LaunchAppAndWait(sCMD, sOPT, WAIT|LAAW_OPTION_HIDDEN);</span><br><span class="line">    if (nResult &lt; 0) then</span><br><span class="line">        MessageBox(&apos;Failed installing &apos;+szComponent+&apos; !&apos;, SEVERE);</span><br><span class="line">        abort;</span><br><span class="line">    endif;               </span><br><span class="line">    // 关闭安装提示</span><br><span class="line">    SdShowMsg(&apos;&apos;, FALSE);</span><br><span class="line">    // 在dbstatus.txt中查询字符串holytail，如果存在，说明脚本已执行完</span><br><span class="line">    if (FileGrep(SRCDIR^&apos;dbstatus.txt&apos;, &apos;holytail&apos;, svLine, nIndex, RESTART) = 0) then</span><br><span class="line">        // 在dbstatus.txt中查询字符串ORA-，如果存在，说明脚本执行出现错误</span><br><span class="line">        if (FileGrep(SRCDIR^&apos;dbstatus.txt&apos;, &apos;ORA-&apos;, svLine, nIndex, RESTART) = 0) then</span><br><span class="line">            sMsg = &quot;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\n&quot;;</span><br><span class="line">            sMsg = sMsg+&quot;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\n&quot;;</span><br><span class="line">            sMsg = sMsg+&quot;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）&quot;;</span><br><span class="line">            nResult = AskYesNo(sMsg, YES);</span><br><span class="line">            if (nResult = YES) then</span><br><span class="line">                LaunchApp(WINSYSDIR^&apos;notepad.exe&apos;, SRCDIR^&apos;dbstatus.txt&apos;);</span><br><span class="line">            endif;                   </span><br><span class="line">            abort;</span><br><span class="line">        endif;</span><br><span class="line">    else</span><br><span class="line">        sMsg = &quot;更新数据库出错，点“是”打开日志文件并退出安装，点“否”直接退出安装。\n&quot;;</span><br><span class="line">        sMsg = sMsg+&quot;若错误可忽略，可选择数据库类型“none”以跳过数据库更新并直接更新程序，\n&quot;;</span><br><span class="line">        sMsg = sMsg+&quot;然后在数据库中手工执行SQL脚本（安装后保存在script目录下）&quot;;</span><br><span class="line">        nResult = AskYesNo(sMsg, YES);</span><br><span class="line">        if (nResult = YES) then</span><br><span class="line">            LaunchApp(WINSYSDIR^&apos;notepad.exe&apos;, SRCDIR^&apos;dbstatus.txt&apos;);</span><br><span class="line">        endif;                   </span><br><span class="line">        abort;</span><br><span class="line">    endif;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><br><br><h2>总结</h2>

<ol><br>    <li>为便于获取脚本在数据库中的执行结果，故通过官方客户端执行脚本时通过符号“<strong>&gt;</strong>”将客户端的输出信息重定向到<strong>dbstatus.txt</strong>中；同时，使用“<strong>2&gt;&amp;1</strong>”将标准错误输出重定向到标准输出设备上，当然，会进一步重定向到dbstatus.txt文件中，否则，无法获取出错信息。</li><br>    <li>sqlplus执行SQL脚本后不会自动退出，故应在Oracle的脚本后加上语句“<strong>exit;</strong>”。</li><br>    <li>重载<strong>OnSQLComponentInstalled()</strong>函数，并在其中禁止MySQL和Oracle的SQL脚本对应的Component被执行安装，然后通过以上两个函数更新数据库。</li><br></ol>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/35/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><a class="page-number" href="/page/35/">35</a><span class="page-number current">36</span><a class="page-number" href="/page/37/">37</a><a class="page-number" href="/page/38/">38</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" href="/page/37/">Next &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 晴耕雨讀&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = '0x3f';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
