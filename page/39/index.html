<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>晴耕雨讀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晴耕雨讀">
<meta property="og:url" content="http://0x3f.org/page/39/index.html">
<meta property="og:site_name" content="晴耕雨讀">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晴耕雨讀">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93233020-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">目录</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="https://t.me/s/blingings">不灵</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://0x3f.org"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-neocomplcache-vim" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/neocomplcache-vim/"><strong>Vim的终极自动补全插件：NeoComplCache</strong></a>
      <small class="article-date-index">&nbsp; 2010-02-27</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/neocomplcache-vim/" class="article-date">
  <time datetime="2010-02-26T16:00:00.000Z" itemprop="datePublished">2010-02-27</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/neocomplcache-vim/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <img src="http://lh3.ggpht.com/_ceUJ_lBTHzc/SaV494hGreI/AAAAAAAAAzY/xExf7CzGyv0/s800/the-mug-of-vi.jpg">
<p>关于自动补全，最初用的是<a href="http://www.vim.org/scripts/script.php?script_id=1643" target="_blank" rel="noopener">SuperTab</a>，那个时候Vim的自动补全插件寥寥无几，也就SuperTab比较有名。不过实际使用过程中这个插件给我的体验不是很好，原因是补全的准确度不高。</p>

<p>后来出了一个新插件，<a href="http://www.vim.org/scripts/script.php?script_id=1879" target="_blank" rel="noopener">AutoComplPop</a>，功能和使用都很简单。但是很快我就又用回SuperTab，原因是AutoComplPop在输入的同时实时地查询匹配的关键词，导致输入极不流畅，效率很低。</p>

<p>一直就这么凑合着用着SuperTab，随着这个插件版本的更新，旧功能不断地完善，新功能也接二连三地引入，SuperTab在匹配关键词的准确度上有了一些改善，但是新的问题又出现了。SuperTab后来加入一个新功能，对于程序源文件，可以在其引入的文件以及API文件中匹配关键词。比如假设我当前正在编辑a.php，在a.php中有<strong>include ‘b.php’;</strong>这样的语句，当我输入<strong>array</strong>并按下Tab键时，SuperTab不但会在当前文件中查询所有匹配项，还会到b.php中查询，如果配置过vim、指定一个包含了php的API的文件，则SuperTab还会自动从这个文件中查询匹配项。按理说这个功能的理念很好，但问题就在于SuperTab做的是实时查询，如果源文件中包含的文件较多，各个文件又较大，问题就显而易见了。我不得不在写程序时小心地使用Tab键，否则有时就会出现按一下Tab键然后等着Vim在那狂搜的情况。</p>

<p>前两天发现了<a href="http://www.vim.org/scripts/script.php?script_id=2620" target="_blank" rel="noopener">NeoComplCache</a>，光看名字就让我有点儿兴奋，一般使用缓存的速度都很快。这个插件会在Vim打开文件的时候对上下文作一个索引，并把索引结果保存到缓存中。同时，文件更改的内容会在保存的时候被索引。此外，NeoComplCache支持多种关键词索引模式，例如它会判断当前路径下的文件或目录的名字是否匹配补全条件，也可以从缓存的程序语言API中匹配补全条件。到此为止，它就解决了SuperTab和AutoComplPop共同的效率问题，并具备它们各自的长处。看了一遍文档，发现这个插件的功能比较细致，大概有以下一些特点：</p>

<p>1、使用缓存，自动补全时效率高；<br>2、生成的关键词列表准确；<br>3、支持下划线分割的关键词，如apple_boy_cat，就可以只输入a_b_c，然后补全；<br>4、支持驼峰格式匹配关键词，如AppleBoyCat，就可以只输入ABC，然后补全；<br>5、既可以像AutoComplPop那样在Vim中输入的同时自动弹出补全列表，又可以自定义快捷键手动触发；<br>6、支持从文件名和目录名中匹配补全条件；<br>7、对于程序源文件，支持从语言API中匹配补全条件；</p>

<p>NeoComplCache的缺点是文档不全，虽然从只言片语中发现它还支持Snippet，但从文档中没有找到足够的有用信息。加之一直用<a href="http://www.vim.org/scripts/script.php?script_id=2540" target="_blank" rel="noopener">SnipMate</a>感觉不错，所以目前还是用它来实现snippet功能。</p>

<p>这就有个搭配问题：虽然NeoComplCache不存在补全时的效率问题，但我仍然打算只在需要补全时才用快捷键触发此功能，最主要的原因是我既希望用Tab键触发SnipMate的代码块补全功能，又希望修SuperTab那样用Tab选择补全列表中的选项。也就是要达到只用Tab键就可以完成打开自动补全列表、补全列表选项选择和SnipMate代码块替换的效果。但是，如果将Tab映射到触发自动补全，则补全列表选择和SnipMate均无法使用Tab，反之亦然。</p>

<p>所以我想如果能让NeoComplCache、SuperTab、SnipMate和谐共存，那问题就解决了，几经摸索，终于找到了办法：</p>

<p>1、设置NeoComplCache不自动弹出补全列表，即在vimrc中加入：</p>

<blockquote><br>  <p>let g:NeoComplCache_DisableAutoComplete = 1</p><br></blockquote>

<p>2、由于NeoComplCache在手工模式下使用快捷键组合<code>&lt;C-X&gt;&lt;C-U&gt;</code>打开补全列表，故设置SuperTab的默认补全操作为<code>&lt;C-X&gt;&lt;C-U&gt;</code>，即在vimrc中加入：</p>

<blockquote><br>  <p>let g:SuperTabDefaultCompletionType = ‘<code>&lt;C-X&gt;&lt;C-U&gt;</code>‘</p><br></blockquote>

<p>这样，NeoComplCache只负责补全关键词缓存的生成，SuperTab控制Tab键的行为并在需要触发补全操作时打开补全列表、进而在列表中的选项间移动焦点，而当光标前的关键词是snippet时，SnipMate会被优先调用并完成代码块的替换。</p>

<p>就在写这篇文章的时候，我突然觉得NeoComplCache自动弹出补全列表+SnipMate的方式也挺好，只是这样就不能用Tab键选择列表中的选项了。</p>

<h3 id="相关阅读："><a href="#相关阅读：" class="headerlink" title="相关阅读："></a>相关阅读：</h3><ul>
<li><a href="/post/replace-youcompleteme-with-neocomplete/">用neocomplete换掉了YouCompleteMe</a></li>
<li><a href="/post/make-youcompleteme-ultisnips-compatible/">How to Make YouCompleteMe Compatible with UltiSnips</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-chinese-problem-of-sqlalchemy-with-sqlserver" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/chinese-problem-of-sqlalchemy-with-sqlserver/"><strong>SQLAlchemy操作SQL Server的中文问题</strong></a>
      <small class="article-date-index">&nbsp; 2010-02-24</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/chinese-problem-of-sqlalchemy-with-sqlserver/" class="article-date">
  <time datetime="2010-02-23T16:00:00.000Z" itemprop="datePublished">2010-02-24</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/chinese-problem-of-sqlalchemy-with-sqlserver/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>最初将脚本的文件编码和coding行都设定为UTF-8，在windows下执行时，中文无法保存，报编码错误。将上述两个编码改为GBK后，保存正常，但查询时报错。</p>

<p>Traceback内容如下：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">File &quot;test.py&quot;, line 36, in &lt;code&gt;&amp;lt;module&amp;gt;&lt;/code&gt;</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;for obj in session.query(User):</span><br><span class="line">File &quot;C:\Python26\lib\site-packages\sqlalchemy-0.6beta1-py2.6.egg\sqlalchemy\orm\query.py&quot;, line 1411, in instances</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;rows = [process[0](row, None) for row in fetch]</span><br><span class="line">File &quot;C:\Python26\lib\site-packages\sqlalchemy-0.6beta1-py2.6.egg\sqlalchemy\orm\mapper.py&quot;, line 1788, in _instance</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;populate_state(state, dict_, row, isnew, only_load_props)</span><br><span class="line">File &quot;C:\Python26\lib\site-packages\sqlalchemy-0.6beta1-py2.6.egg\sqlalchemy\orm\mapper.py&quot;, line 1677, in populate_state</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;populator(state, dict_, row, isnew=isnew, **flags)</span><br><span class="line">File &quot;C:\Python26\lib\site-packages\sqlalchemy-0.6beta1-py2.6.egg\sqlalchemy\orm\strategies.py&quot;, line 118, in new_execute</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;dict_[key] = row[col]</span><br><span class="line">File &quot;C:\Python26\lib\site-packages\sqlalchemy-0.6beta1-py2.6.egg\sqlalchemy\engine\base.py&quot;, line 1634, in __getitem__</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return self.__colfuncs[key][0](self.__row)</span><br><span class="line">File &quot;C:\Python26\lib\site-packages\sqlalchemy-0.6beta1-py2.6.egg\sqlalchemy\engine\base.py&quot;, line 1716, in getcol</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return processor(row[index])</span><br><span class="line">File &quot;C:\Python26\lib\site-packages\sqlalchemy-0.6beta1-py2.6.egg\sqlalchemy\types.py&quot;, line 568, in process</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return decoder(value)[0]</span><br><span class="line">File &quot;C:\Python26\lib\encodings\utf_8.py&quot;, line 16, in decode</span><br><span class="line">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return codecs.utf_8_decode(input, errors, True)</span><br><span class="line">UnicodeEncodeError: &apos;ascii&apos; codec can&apos;t encode characters in position 0-1: ordinal not in range(128)&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>环境为：</p>

<p>OS：Windows XP简体中文版
DB：SQL Server 2008 Express简体中文版
DB模块：pyodbc
脚本文件编码：GBK
脚本coding行：GBK</p>

<p>脚本内容：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- encoding: gbk -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String, Text, ForeignKey, Numeric, Unicode</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="string">"""User class"""</span></span><br><span class="line"></span><br><span class="line">    __tablename__ = <span class="string">'users'</span></span><br><span class="line"></span><br><span class="line">    id = Column(Numeric(<span class="number">22</span>,<span class="number">0</span>), primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(Unicode(<span class="number">128</span>), nullable=<span class="keyword">False</span>, unique=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, id, name)</span>:</span></span><br><span class="line">        self.id = id</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    db_engine = create_engine(<span class="string">'mssql://sa:password@localhost/mydatabase'</span>, echo=<span class="keyword">True</span>)</span><br><span class="line">    Session = sessionmaker(bind=db_engine)</span><br><span class="line">    session = Session()</span><br><span class="line"></span><br><span class="line">    Base.metadata.drop_all(db_engine)</span><br><span class="line">    Base.metadata.create_all(db_engine)</span><br><span class="line"></span><br><span class="line">    jim = User(<span class="number">1</span>, <span class="string">'中文'</span>)</span><br><span class="line">    session.add(jim)</span><br><span class="line">    session.commit()</span><br><span class="line"></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    for obj in session.query(User):</span></span><br><span class="line"><span class="string">        print obj.name</span></span><br><span class="line"><span class="string">    '''</span></span><br></pre></td></tr></table></figure>
</p>

<p>上面的脚本执行后，数据得以正常保存，在数据库中的查询结果也正常，没有乱码。但是，当把从drop_all()到commit()行注释掉，取消for循环前后的多行字符串起止符后，即运行查询时，抛出上面的Traceback。</p>

<p>Google了很长时间，没有找到有用的东西。CPyUG更没指望。</p>

<p>回溯Traceback，打开sqlalchemy的types.py，UnicodeEncodeError的抛出点在String类的result_processor()方法：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result_processor</span><span class="params">(self, dialect, coltype)</span>:</span></span><br><span class="line">    wants_unicode = self.convert_unicode <span class="keyword">or</span> dialect.convert_unicode</span><br><span class="line">    needs_convert = wants_unicode <span class="keyword">and</span> \</span><br><span class="line">                    (<span class="keyword">not</span> dialect.returns_unicode_strings <span class="keyword">or</span> </span><br><span class="line">                    self.convert_unicode == <span class="string">'force'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> needs_convert:</span><br><span class="line">        <span class="comment"># note we *assume* that we do not have a unicode object</span></span><br><span class="line">        <span class="comment"># here, instead of an expensive isinstance() check.</span></span><br><span class="line">        decoder = codecs.getdecoder(dialect.encoding)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(value)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">                <span class="comment"># decoder returns a tuple: (value, len)</span></span><br><span class="line">                <span class="keyword">return</span> decoder(value)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> value</span><br><span class="line">        <span class="keyword">return</span> process</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure>
</p>

<p>这个方法就是根据数据库方言dialect和字段类型coltype返回一个字符串的解码函数。若在if语句上面将needs_convert置为False，即不对该字段使用解码器，则再执行上面的脚本时，查询正常。</p>

<p>由于前面create_engine()函数的encoding参数缺省为UTF-8，故dialect.encoding的值为“UTF-8”，故if语句中decoder实际引用的是codecs.utf_8_decode()。也就是说，result_processor()方法在实际执行过程中返回的是一个封装了utf_8_decode()函数的函数。即，UnicodeEncodeError是在对从数据库中查询出来的中文字符串进行UTF-8解码时抛出的。</p>

<p>对传入process()函数的值作isinstance(value,unicode)判断，显示为True，表明从数据库中查询出来的中文本身就是unicode字节码，当对它再进行UTF-8解码时，就抛出了UnicodeEncodeError的错误。为验证以上判断，做如下实验：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;t = <span class="string">'中文'</span></span><br><span class="line">&gt;&gt;&gt;u = <span class="string">u'中文'</span></span><br><span class="line">&gt;&gt;&gt;isinstance(t, str)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">&gt;&gt;&gt;isinstance(t, unicode)</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">&gt;&gt;&gt;isinstance(u, str)</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">&gt;&gt;&gt;isinstance(u, unicode)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">&gt;&gt;&gt;x = t.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">&gt;&gt;&gt;x</span><br><span class="line"><span class="string">u'\u4e2d\u6587'</span></span><br><span class="line">&gt;&gt;&gt;isinstance(x, unicode)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">&gt;&gt;&gt;x == u</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> codecs</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dc = codecs.getdecoder(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dc(u)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;input&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/usr/lib/python2.6/encodings/utf_8.py"</span>, line <span class="number">16</span>, <span class="keyword">in</span> decode</span><br><span class="line">    <span class="keyword">return</span> codecs.utf_8_decode(input, errors, <span class="keyword">True</span>)</span><br><span class="line">UnicodeEncodeError: <span class="string">'ascii'</span> codec can<span class="string">'t encode characters in position 0-1: ordinal not in range(128)</span></span><br></pre></td></tr></table></figure>
</p>

<p>得证。</p>

<p>在Python中，字符串类型str和unicode类型是两种不同的数据类型，str类型的数据可以通过指定正确的编码来转换成unicode类型，对unicode类型的数据作重复的解码操作就会抛出类似上面的错误。</p>

<p>实事上，若将name字段声明为String类，则保存和查询操作均无问题。但由于我需要sqlalchemy建表时将相应字段的类型设为nvarchar，故必须使用Unicode类声明该列。</p>

<p>那有没有办法使result_processor()方法不返回一个对字段值作重复解码的函数呢？</p>

<p>返回result_processor()方法，self.convert_unicode对于Unicode类是True，dialect.convert_unicode由create_engine()函数的convert_unicode参数控制，缺省为False，故needs_convert变量为True，无法更改；dialect.returns_unicode_strings是由sqlalchemy.engine模块default.py中的DefaultDialect类的_check_unicode_returns()方法返回的，该方法内容为：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_check_unicode_returns</span><span class="params">(self, connection)</span>:</span></span><br><span class="line">    cursor = connection.connection.cursor()</span><br><span class="line">    cursor.execute(</span><br><span class="line">        str(</span><br><span class="line">            expression.select( </span><br><span class="line">            [expression.cast(</span><br><span class="line">                expression.literal_column(<span class="string">"'test unicode returns'"</span>),sqltypes.VARCHAR(<span class="number">60</span>))</span><br><span class="line">            ]).compile(dialect=self)</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    row = cursor.fetchone()</span><br><span class="line">    result = isinstance(row[<span class="number">0</span>], unicode)</span><br><span class="line">    cursor.close()</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
</p>

<p>此方法的功能为生成一条SQL语句，在数据库中执行后，判断返回的值是否为unicode类型。由于SQL Server是ASCII编码，故此方法返回False。因此，dialect.returns_unicode_strings的值为False。最终，needs_convert只能为True。我觉得这是sqlalchemy的一个Bug。</p>

<p>在此条件下，目前尚未找到较好的解决办法，只能使用硬编码强制置result_processor()方法中的needs_convert变量为False。</p>

<p><strong>2010-02-25 更新：</strong></p>

<p>谢谢KL童鞋指出问题原因和解决办法，使问题得以完美解决。</p>

<p>1、由于Python在载入site模块时会删除setdefaultencoding()函数，故不能以在脚本开头调用此函数的方式指定默认编码；sitecustomize.py是一个python会自动导入的模块，故应当使用这个文件指定默认编码；</p>

<p>2、我这里需要使用utf-8作默认编码器，sitecustomize.py的内容如下：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: gbk -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>
</p>

<p>3、将sitecustomize.py保存到python安装目录下的Lib\site-packages目录中；</p>

<p>另外，在<a href="http://www.woodpecker.org.cn/diveintopython/xml_processing/unicode.html" target="_blank" rel="noopener">此处</a>发现了跟本问题相关的资料，辅助治疗，效果更佳。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-switching-from-ums-to-kms" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/switching-from-ums-to-kms/"><strong>被迫弃UMS而用KMS</strong></a>
      <small class="article-date-index">&nbsp; 2010-02-13</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/switching-from-ums-to-kms/" class="article-date">
  <time datetime="2010-02-12T16:00:00.000Z" itemprop="datePublished">2010-02-13</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/switching-from-ums-to-kms/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>昨天更新了一下系统，今天开机就白屏了。于是先关掉Compiz，看了一下Archlinux的<a href="http://www.archlinux.org/news/484/" target="_blank" rel="noopener">新闻</a>，发现新的<strong>xf86-video-intel</strong>中已经移除了UMS，也就意味着只能使用KMS做3D加速了。</p>

<p><a href="http://www.thinkwiki.org/wiki/Intel_Graphics_Media_Accelerator_950#User_mode_setting_.28UMS.29" target="_blank" rel="noopener">UMS</a>的全称是<strong>User Mode-Setting</strong>，是一种传统的图形界面初始化方案，即在X加载之后由它初始化图形界面。这种方案的弊端是虚拟终端不具备显示和处理图形的能力，同时虚拟终端和图形界面之间的切换显得缓慢并带有闪烁。</p>

<p><a href="http://wiki.archlinux.org/index.php/KMS" target="_blank" rel="noopener">KMS</a>的全称是<strong>Kernel Mode-Setting</strong>，是新一代图形界面初始化方案，它将图形界面的初始化由X加载之后由X负责进行改为在内核初始化时由内核进行。KMS的好处不仅仅是解决了上面UMS的问题，同时也使得Linux具备了在启动时显示漂亮的开机图示的能力。另外，在3D加速性能和低功耗方面，KMS也较UMS更胜一筹。</p>

<p>我的<a href="http://0x3f.org/?p=819">Thinkpad X200</a>使用的是Intel GMA 945的芯片组，而Archlinux的<a href="http://wiki.archlinux.org/index.php/Intel_(简体中文)#KMS_.28Kernel_Mode_Setting.29" target="_blank" rel="noopener">Wiki</a>上仍以915为例，所以尝试着做如下内容：</p>

<p>一、去除/boot/grub/menu.lst中Kernel启动参数中的<a href="http://0x3f.org/?p=866">vga参数</a>；</p>

<p>二、加入以下内容到/etc/modprobe.d/modprobe.conf：</p>

<blockquote>
  <p>options i945 modeset=1</p>
</blockquote>

<p>三、在/etc/rc.conf中的<strong>MODULES</strong>行加入<strong>intel_agp</strong>和<strong>i945</strong>；</p>

<p>重启系统后，Compiz白屏问题解决，3D加速性能似乎有所上升。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-virtualbox-host-interface" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/virtualbox-host-interface/"><strong>VirtualBox的Host Interface网络接入方式的配置</strong></a>
      <small class="article-date-index">&nbsp; 2010-01-31</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/virtualbox-host-interface/" class="article-date">
  <time datetime="2010-01-30T16:00:00.000Z" itemprop="datePublished">2010-01-31</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/virtualbox-host-interface/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://zh.wikipedia.org/wiki/VirtualBox" target="_blank" rel="noopener">VirtualBox</a>安装后默认的网络接入方式是<a href="http://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2" target="_blank" rel="noopener">NAT</a>，也是最简单的一种。但NAT网络中的虚拟机系统不具有和主机同一网段的IP地址，不能和主机直接通信。这对于开发者来说是不适用的。</p>

<p>Host Interface网络接入方式可以使虚拟机系统获得与主机同一网段的IP地址，因此也使得虚拟机系统像主机所在的局域网中的一台真实的计算机一样，可以和其它计算机通信。</p>

<p>对于Linux平台的VirtualBox，可以有两种方式实现Host Interface网络。一是使用系统网桥，二是使用VirtualBox内建的机制。</p>

<p>第一种方式复杂但通用，尤其是对于2.1.0以前的版本来说，这是唯一的途径。从2.1.0开始，VirtuaBox内建了支持Host Interface的机制，这极大地简化了此类型网络的配置。</p>

<p>首先，加载<strong>vboxnetflt</strong>模块：</p>

<blockquote>
  <p>sudo modprobe vboxnetflt</p>
</blockquote>

<p>然后在VirtualBox中配置虚拟机的网络连接方式，选择“<strong>Bridged Adapter</strong>”。</p>

<p>最后启动虚拟机即可。</p>

<p>另外，若虚拟机系统是精简版的Windows，网卡驱动可能不会自动安装，这时需要另外下载网卡的驱动并安装。</p>

<p>为方便起见，可将vboxnetflt模块加入到开机自动启动的模块列表中，每种发行版设置自启动模块的位置和方法不一样，在Archlinux下，是在<strong>/etc/rc.conf</strong>文件中的<strong>modules</strong>行中设置。</p>

<p><em>参考文章：<a href="http://wiki.archlinux.org/index.php/VirtualBox" target="_blank" rel="noopener">Archlinux Wiki: VirtualBox</a></em></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-too-many-echoes-may-crash-php" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/too-many-echoes-may-crash-php/"><strong>PHP后台echo过多会导致进程崩溃</strong></a>
      <small class="article-date-index">&nbsp; 2010-01-31</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/too-many-echoes-may-crash-php/" class="article-date">
  <time datetime="2010-01-30T16:00:00.000Z" itemprop="datePublished">2010-01-31</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/too-many-echoes-may-crash-php/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>这是去年晚些时侯发现的一个问题。</p>
<p>公司产品的后台定时任务应该是用独立的PHP进程驱动的。在做一个项目的时候，为了便于手工调试，我在定时任务中使用了大量的echo输出信息并在浏览器中手工执行此任务的脚本。</p>
<p>手工执行通过，输出信息完全没有问题。但在实际运行的过程中，一个很诡异的事情发生了：即使我将实际处理数据的代码全部注释掉，只对原始数据做简单的查询，此定时任务仍然极其健壮地中途退出。最要命的是无论程序日志还是PHP的错误日志，都没有任何相关信息。直到后来我把所有echo输出都取消，问题才解决。</p>
<p>事后模糊地记得很久以前似乎在哪本书上看到过在无输出设备的情况下echo过多数据会导致PHP进程崩溃的内容，但原因已想不起来了。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-cube-is-back" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/cube-is-back/"><strong>立方体归来</strong></a>
      <small class="article-date-index">&nbsp; 2009-11-24</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/cube-is-back/" class="article-date">
  <time datetime="2009-11-23T16:00:00.000Z" itemprop="datePublished">2009-11-24</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/cube-is-back/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        
上次鼓捣出立方体还是几年前在学校的时候，<a href="http://zh.wikipedia.org/zh-cn/Ubuntu" target="_blank" rel="noopener">Ubuntu</a>+<a href="http://en.wikipedia.org/wiki/Beryl_(window_manager)" target="_blank" rel="noopener">Beryl</a>。

我那个时候的台式机，<a href="http://en.wikipedia.org/wiki/Celeron#Tualatin-256" target="_blank" rel="noopener">Celeron Tualatin</a>+256M SDRAM+GForce 440，跑XP要了亲命，忍无可忍而投奔Linux，结果一不小心鼓捣出了立方体，捎带着Firefox、OpenOffice开了一大堆，屁事儿没有，我就是这么死心塌地地上了贼船，直至今天。

后来一直用<a href="http://zh.wikipedia.org/zh-cn/ArchLinux" target="_blank" rel="noopener">Archlinux</a>，习惯了<a href="http://zh.wikipedia.org/zh-cn/Fluxbox" target="_blank" rel="noopener">Fluxbox</a>和<a href="http://zh.wikipedia.org/zh-cn/Openbox" target="_blank" rel="noopener">Openbox</a>的简洁。买了X200后曾试图找寻一下旧日华丽的记忆，但却人是物非，新的X200、新的Archlinux、新的<a href="http://zh.wikipedia.org/zh-cn/Compiz_Fusion" target="_blank" rel="noopener">Compiz-fusion</a>远不如当年的老牛破车那么搭调。虽说也搞出了立方体，但所有的窗口都没有边框，于是作罢。

上周六鬼使神差的进入GNOME并打开Fusion-icon，奇迹就这么出现了：

<a href="http://picasaweb.google.com/lh/photo/HkPacmXQACapxzViLh4kRw?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh5.ggpht.com/_ceUJ_lBTHzc/SwvnvUJImNI/AAAAAAAABPk/076ZiKsl4Uw/s400/screenshot_001.png"></a>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-fullscreen-for-gvim-on-windows" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/fullscreen-for-gvim-on-windows/"><strong>Windows下GVim的全屏</strong></a>
      <small class="article-date-index">&nbsp; 2009-09-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/fullscreen-for-gvim-on-windows/" class="article-date">
  <time datetime="2009-09-16T16:00:00.000Z" itemprop="datePublished">2009-09-17</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/fullscreen-for-gvim-on-windows/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        下载gvim的一个扩展“<a href="https://github.com/derek/gvimfullscreen_win32" target="_blank" rel="noopener">gvimfullscreen_win32</a>”，并解压缩。

将<strong>gvimfullscreen.dll</strong>复制到gvim安装目录下，与<strong>gvim.exe</strong>同目录。

修改gvim配置文件<strong>_vimrc</strong>，在其中添加如下内容：

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'win32'</span>)</span><br><span class="line">    <span class="keyword">map</span> <span class="symbol">&lt;F11&gt;</span> <span class="symbol">&lt;Esc&gt;</span>:<span class="keyword">call</span> <span class="built_in">libcallnr</span>(<span class="string">"gvimfullscreen.dll"</span>, <span class="string">"ToggleFullScreen"</span>, <span class="number">0</span>)<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

此后，即可使用<strong>F11</strong>键开关gvim的全屏状态。

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-project-euler-11" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/project-euler-11/"><strong>欧拉工程第十一解</strong></a>
      <small class="article-date-index">&nbsp; 2009-05-12</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/project-euler-11/" class="article-date">
  <time datetime="2009-05-11T16:00:00.000Z" itemprop="datePublished">2009-05-12</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/project-euler-11/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
  <p>In the 20×20 grid below, four numbers along a diagonal line have been marked in red.</p>
  
  <p>08 02 22 97 38 15 00 40 00 75 04 05 07 78 52 12 50 77 91 08
  49 49 99 40 17 81 18 57 60 87 17 40 98 43 69 48 04 56 62 00
  81 49 31 73 55 79 14 29 93 71 40 67 53 88 30 03 49 13 36 65
  52 70 95 23 04 60 11 42 69 24 68 56 01 32 56 71 37 02 36 91
  22 31 16 71 51 67 63 89 41 92 36 54 22 40 40 28 66 33 13 80
  24 47 32 60 99 03 45 02 44 75 33 53 78 36 84 20 35 17 12 50
  32 98 81 28 64 23 67 10 26 38 40 67 59 54 70 66 18 38 64 70
  67 26 20 68 02 62 12 20 95 63 94 39 63 08 40 91 66 49 94 21
  24 55 58 05 66 73 99 26 97 17 78 78 96 83 14 88 34 89 63 72
  21 36 23 09 75 00 76 44 20 45 35 14 00 61 33 97 34 31 33 95
  78 17 53 28 22 75 31 67 15 94 03 80 04 62 16 14 09 53 56 92
  16 39 05 42 96 35 31 47 55 58 88 24 00 17 54 24 36 29 85 57
  86 56 00 48 35 71 89 07 05 44 44 37 44 60 21 58 51 54 17 58
  19 80 81 68 05 94 47 69 28 73 92 13 86 52 17 77 04 89 55 40
  04 52 08 83 97 35 99 16 07 97 57 32 16 26 26 79 33 27 98 66
  88 36 68 87 57 62 20 72 03 46 33 67 46 55 12 32 63 93 53 69
  04 42 16 73 38 25 39 11 24 94 72 18 08 46 29 32 40 62 76 36
  20 69 36 41 72 30 23 88 34 62 99 69 82 67 59 85 74 04 36 16
  20 73 35 29 78 31 90 01 74 31 49 71 48 86 81 16 23 57 05 54
  01 70 54 71 83 51 54 69 16 92 33 48 61 43 52 01 89 19 67 48</p>
  
  <p>The product of these numbers is 26 × 63 × 78 × 14 = 1788696.</p>
  
  <p>What is the greatest product of four adjacent numbers in any direction (up, down, left, right, or diagonally) in the 20×20 grid?</p>
</blockquote>

<p>这道题最难的地方在于将上面400个数输入到程序中的矩阵里，嘿嘿，后来看别人的解，真有这么干的，饿滴神呀。</p>

<p>我直接把这个矩阵复制到一个文本文件里，然后在程序里解析：</p>

<p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">matrix = []</span><br><span class="line">products = []</span><br><span class="line"></span><br><span class="line">metaFile = open(<span class="string">'c:/matrix.txt'</span>, <span class="string">'rb'</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> metaFile.readlines():</span><br><span class="line">    matrix.append(line.split())</span><br><span class="line">metaFile.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">        <span class="keyword">if</span> col+<span class="number">3</span> &lt; <span class="number">20</span>:</span><br><span class="line">            products.append( int(matrix[row][col]) * int(matrix[row][col+<span class="number">1</span>]) * int(matrix[row][col+<span class="number">2</span>]) * int(matrix[row][col+<span class="number">3</span>]) )</span><br><span class="line">        <span class="keyword">if</span> row+<span class="number">3</span> &lt; <span class="number">20</span>:</span><br><span class="line">            products.append( int(matrix[row][col]) * int(matrix[row+<span class="number">1</span>][col]) * int(matrix[row+<span class="number">2</span>][col]) * int(matrix[row+<span class="number">3</span>][col]) )</span><br><span class="line">        <span class="keyword">if</span> col+<span class="number">3</span> &lt; <span class="number">20</span> <span class="keyword">and</span> row+<span class="number">3</span> &lt; <span class="number">20</span>:</span><br><span class="line">            products.append( int(matrix[row][col]) * int(matrix[row+<span class="number">1</span>][col+<span class="number">1</span>]) * int(matrix[row+<span class="number">2</span>][col+<span class="number">2</span>]) * int(matrix[row+<span class="number">3</span>][col+<span class="number">3</span>]) )</span><br><span class="line">        <span class="keyword">if</span> row+<span class="number">3</span> &lt; <span class="number">20</span> <span class="keyword">and</span> col<span class="number">-3</span> &gt; <span class="number">0</span>:</span><br><span class="line">            products.append( int(matrix[row][col]) * int(matrix[row+<span class="number">1</span>][col<span class="number">-1</span>]) * int(matrix[row+<span class="number">2</span>][col<span class="number">-2</span>]) * int(matrix[row+<span class="number">3</span>][col<span class="number">-3</span>]) )</span><br><span class="line">products.sort()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> products</span><br></pre></td></tr></table></figure>
</p>

<p><a href="http://picasaweb.google.com/lh/photo/6GIcY8wcBjsfMJJVvTErFg?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh4.ggpht.com/_ceUJ_lBTHzc/SgmYbZY9k9I/AAAAAAAAA7w/epp8uIaGv0k/s400/project_euler_problem_11.png"></a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-true-transparent-of-rxvt-unicode" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/true-transparent-of-rxvt-unicode/"><strong>rxvt-unicode的真透明</strong></a>
      <small class="article-date-index">&nbsp; 2009-02-28</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/true-transparent-of-rxvt-unicode/" class="article-date">
  <time datetime="2009-02-27T16:00:00.000Z" itemprop="datePublished">2009-02-28</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/true-transparent-of-rxvt-unicode/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <div class="illustration_right">
<a href="http://picasaweb.google.com/lh/photo/J2FyvgBhXopEgPlX9whJ3w?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh5.ggpht.com/_ceUJ_lBTHzc/Saghr1cRaoI/AAAAAAAAA0o/fye5JZl3Pxc/s288/2009-02-28-012206_1280x800_scrot.png"></a>
</div>

<p>nacre同学说，urxvt是可以实现真透明的。起初我以为是要用<a href="http://www.forchheimer.se/transset-df/" target="_blank" rel="noopener">transset-df</a>来实现，但这个东西一般需要手动操作，不具有太大的实用性，而且会把整个窗口透明化。不过后来发现真的不需要用它来画蛇添足，有<a href="http://wiki.archlinux.org/index.php/Xcompmgr" target="_blank" rel="noopener">xcompmgr</a>足矣。</p>

<p>因为我用<a href="http://en.wikipedia.org/wiki/Openbox" target="_blank" rel="noopener">openbox</a>，要实现窗口的阴影和动画效果，xcompmgr是必须的，我把它设成了开机自启动。比起xcompmgr默认的参数值，下面这条定制的命令实现了简洁的阴影和合理的渐隐渐显时间，因此提供了一个各方面都比较均衡、合理的桌面体验：</p>

<blockquote>
  <p>xcompmgr -Ss -n -Cc -fF -I-10 -O-10 -D1 -t-3 -l-4 -r4</p>
</blockquote>

<p>然后在.Xresources中添加以下两行：</p>

<blockquote>
  <p>URxvt.depth:32
  URxvt.background:rgba:0000/0000/0000/dddd</p>
</blockquote>

<p>最后当然要执行一下：</p>

<blockquote>
  <p>xrdb ~/.Xresources</p>
</blockquote>

<p>此后直接启动urxvt即可。</p>

<p>这里面最有意思的就是background项的配置，它有两种形式，一种是：</p>

<blockquote>
  <p>URxvt.background:[80]black</p>
</blockquote>

<p>还有一种就是前面提到的形式。</p>

<p>第一种形式中，中括号里的数字表示半透明度对应的百分比，括号外是颜色名称；第二种形式提供了比第一种更多的色彩选择，四组数字都是十六进制数，前三组是RGB颜色值，最后一组是半透明度，数值越大，透明度越低。</p>

<p>在查阅“man urxvt”的时候，发现urxvt的man pages里的内容真是异常丰富，大部分功能都讲解得言简意赅。以往还抱怨这个东西在网上连个健全的文档都找不到，原来全在这儿呢，真不知道以往无数次地man的时候为什么没有注意到这些，难道man了rxvt了？</p>

<p><em>PS：这样实现urxvt的真半透明后，貌似xcompmgr实现的阴影在urxvt身上就消失了，求解中……</em></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-rxvt-unicode-256color-is-perfect" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/rxvt-unicode-256color-is-perfect/"><strong>完美的终端模拟器：rxvt-unicode</strong></a>
      <small class="article-date-index">&nbsp; 2009-02-08</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/rxvt-unicode-256color-is-perfect/" class="article-date">
  <time datetime="2009-02-07T16:00:00.000Z" itemprop="datePublished">2009-02-08</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/rxvt-unicode-256color-is-perfect/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://en.wikipedia.org/wiki/Rxvt-unicode" target="_blank" rel="noopener">urxvt</a>（<a href="http://www.rxvt.org/" target="_blank" rel="noopener">rxvt</a>的unicode版本，支持多国语言，<a href="http://software.schmorp.de/pkg/rxvt-unicode.html" target="_blank" rel="noopener">官方网站</a>）。</p>

<p>具有以下特性：</p>
<ol>
	<li>支持真半透明</li>
	<li>支持Unicode编码，支持多国语言</li>
	<li>支持英文和非英文字符使用不同的字体</li>
	<li>支持CS模式，节省系统资源</li>
	<li>轻量，速度快</li>
	<li>支持Perl扩展功能</li>
</ol>

<p>但是urxvt有一个很影响情绪的缺陷，就是字符的间距过大，看起来很不舒服。不过已有补丁用来解决这个问题，例如Archlinux用户可以安装<a href="http://aur.archlinux.org/packages.php?ID=32488" target="_blank" rel="noopener">rxvt-unicode-chinese</a>：</p>

<p><a href="http://picasaweb.google.com/lh/photo/6B48rqC08p3C7paP_Y651w?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh5.ggpht.com/_ceUJ_lBTHzc/SY71tgK4J0I/AAAAAAAAAw4/3Vf4HbPZfS4/s400/rxvt-unicode-256color.png"></a></p>

urxvt的配置选项可以参考其官方网站上的说明，另外<a href="http://pastebin.com/WzT6pTKA" target="_blank" rel="noopener">这里</a>有一份详细的配置文件。

<strong>更新日志：</strong>

<strong>2011-01-15</strong>
<ol>
	<li>修改文章标题</li>
	<li>重写文章内容</li>
	<li>由于原来的rxvt-unicode-256color包已不存在，更换为rxvt-unicode-chinese</li>
	<li>补充一份配置文件</li>
</ol>



      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/38/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><a class="page-number" href="/page/38/">38</a><span class="page-number current">39</span><a class="page-number" href="/page/40/">40</a><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" href="/page/40/">Next &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 晴耕雨讀&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = '0x3f';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
