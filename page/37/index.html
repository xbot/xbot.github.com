<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>晴耕雨讀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晴耕雨讀">
<meta property="og:url" content="http://0x3f.org/page/37/index.html">
<meta property="og:site_name" content="晴耕雨讀">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晴耕雨讀">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93233020-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">目录</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="https://t.me/s/blingings">不灵</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://0x3f.org"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-problem-on-pppoe-connections-on-linux" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/problem-on-pppoe-connections-on-linux/"><strong>Linux下pppoe连接建立后仍不能上网的问题</strong></a>
      <small class="article-date-index">&nbsp; 2010-07-10</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/problem-on-pppoe-connections-on-linux/" class="article-date">
  <time datetime="2010-07-09T16:00:00.000Z" itemprop="datePublished">2010-07-10</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/problem-on-pppoe-connections-on-linux/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>问题描述</strong></p>
<p>pppoe可以连接，ifconfig可以看到ppp0接口，一切正常，只是不能上网。</p>
<p><strong>解决办法</strong></p>
<p>使用如下命令查看路由表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route</span><br></pre></td></tr></table></figure>
<p>正常情况下返回的结果中应该有如下内容：</p>
<blockquote><br>default  *  0.0.0.0   U   0   0  0 ppp0<br></blockquote>

<p>如果没有，可手工添加：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add default dev ppp0</span><br></pre></td></tr></table></figure>
<p>如果可以上网，就成功了。</p>
<p>使用如下脚本在pppoe连接成功时自动添加路由表项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> ifconfig ppp0  &gt; /dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">    route del default</span><br><span class="line">    route add default dev ppp0</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>将上述内容保存成名为<strong>01-route.sh</strong>的文件，权限<strong>755</strong>，放到<strong>/etc/ppp/ip-up.d</strong>目录下。</p>
<p>然后创建以下两个脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> ifconfig ppp0  &gt; /dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'PPPOE has already been switched on !'</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">off</span><br><span class="line"> </span><br><span class="line">sudo pon</span><br><span class="line">sleep 5</span><br><span class="line">sudo /etc/ppp/ip-up</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> ! ifconfig ppp0  &gt; /dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'PPPOE has already been switched off !'</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">sudo poff</span><br><span class="line">sudo /etc/ppp/ip-down</span><br></pre></td></tr></table></figure>
<p>分别命名为<strong>on</strong>和<strong>off</strong>并复制到环境变量PATH下，以后即可使用这两个脚本建立和注销pppoe连接。</p>
<p><strong>原因分析</strong></p>
<p>问题的原因是pppoe连接建立时，没有自动往路由表中添加相关路由项。</p>
<p>一般情况下，如果使用的是<strong>ppp</strong>做pppoe连接，其配置文件中默认会开启<strong>defaultroute</strong>选项，该选项的作用就是在pppoe连接建立时自动添加路由表项，但在路由表中已经存在<strong>default</strong>项时，该操作将不会进行。</p>
<p>一般有两种情况会使路由表中在pppoe连接建立前就存在default项。一种情况是网络接口配置中设置了route，如在archlinux下，就是rc.conf文件中的gateway项。如果使用的是静态地址，则需要做这种配置，但对于大多数使用DHCP动态分配IP地址的情况，这项配置则不需要。另一种情况就是ADSL Modem自带路由功能，在分配IP给计算机时也会自动添加一条路由表项。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-enable-routing-and-auto-dialing-for-unicom-adsl-modem-1" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-enable-routing-and-auto-dialing-for-unicom-adsl-modem-1/"><strong>网通ADSL猫开启路由和自动拨号功能的方法之一</strong></a>
      <small class="article-date-index">&nbsp; 2010-07-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-enable-routing-and-auto-dialing-for-unicom-adsl-modem-1/" class="article-date">
  <time datetime="2010-07-03T16:00:00.000Z" itemprop="datePublished">2010-07-04</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-enable-routing-and-auto-dialing-for-unicom-adsl-modem-1/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>北京网通送的无线猫有的是华为HG522，有的是HG527，屏蔽了路由和PPPOE自动拨号功能，须使用超级用户登入才能使用这些功能。</p>
<ol>
<li>假设网关为默认的192.168.1.1，先使用普通用户登录，然后访问地址：</li>
</ol>
<blockquote><br><a href="http://192.168.1.1/downloadconfigfile.conf" target="_blank" rel="noopener">http://192.168.1.1/downloadconfigfile.conf</a><br></blockquote>

<p>下载该文件并搜索<strong>username</strong>，找到超级用户的用户名和密码，如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">X_ATP_UserInfoInstance</span> <span class="attr">InstanceID</span>=<span class="string">"1"</span> <span class="attr">Username</span>=<span class="string">"bjcnchgw"</span> <span class="attr">Userpassword</span>=<span class="string">"bjcnchgw27852654"</span> <span class="attr">Userlevel</span>=<span class="string">"2"</span> <span class="attr">Busy</span>=<span class="string">"0"</span> <span class="attr">LoginIP</span>=<span class="string">""</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在如下地址使用超级用户登录：</li>
</ol>
<blockquote><br><a href="http://192.168.1.1/cnc.html" target="_blank" rel="noopener">http://192.168.1.1/cnc.html</a><br></blockquote>

<ol start="3">
<li>设置内容如下图：</li>
</ol>
<p><a href="http://picasaweb.google.com/lh/photo/MwzSxgWShGMJmYJdSQRw8w?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh6.ggpht.com/_ceUJ_lBTHzc/TDAy1kazOFI/AAAAAAAABa8/jRmlkSC4MaM/s400/32144754dc04625b375cf1d83f3587fc.media.812x604.png"></a></p>
<p><em>终于不用再忍受公共网络了……</em></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-connect-to-sqlserver-using-freetds-on-linux" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/connect-to-sqlserver-using-freetds-on-linux/"><strong>Linux下使用freetds连接SQL Server</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-20</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/connect-to-sqlserver-using-freetds-on-linux/" class="article-date">
  <time datetime="2010-06-19T16:00:00.000Z" itemprop="datePublished">2010-06-20</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/connect-to-sqlserver-using-freetds-on-linux/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.freetds.org" target="_blank" rel="noopener">freetds</a>是第三方、开源的数据库客户端和连接库，支持Sybase和Microsoft SQL Server，它最大的好处是允许非Windows平台的程序连接SQL Server。</p>
<p>freetds的编译和安装命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure --with-tdsver=8.0 --<span class="built_in">enable</span>-msdblib</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>configure的这两个参数是必不可少的，否则可能无法连接SQL Server。</p>
<p>安装后修改<strong>freetds.conf</strong>（<em>一般应该在/usr/local/etc/freetds.conf</em>），添加如下内容：</p>
<blockquote><br>[mysvr]<br>        host = 10.1.29.40<br>        port = 1433<br>        tds version = 8.0<br>        client charset = utf-8<br></blockquote>

<p>上述参数应根据实际情况修改。</p>
<p>最后使用如下命令测试连接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsql -S mysvr -U sa -P 123456</span><br></pre></td></tr></table></figure>
<p>给公司产品做Linux下的安装包，把开发环境放在了Cygwin中，非常享受在全屏、半透明的mintty下敲命令。今天发现在Cygwin下也是可以编译安装Linux下的程序的，只是效率非常低下。故上述内容对Cygwin环境同样成立。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-do-auto-listing-after-changing-directory" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-do-auto-listing-after-changing-directory/"><strong>cd到目录下后自动ls的方法</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-20</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-do-auto-listing-after-changing-directory/" class="article-date">
  <time datetime="2010-06-19T16:00:00.000Z" itemprop="datePublished">2010-06-20</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-do-auto-listing-after-changing-directory/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>每cd到一个目录下就ls，这成了我的习惯。以下Bash函数和别名可以实现cd到一个目录下就自动执行ls命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">cdl</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cd</span> <span class="string">"<span class="variable">$&#123;1&#125;</span>"</span>;</span><br><span class="line">    ls;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">cd</span>=cdl</span><br></pre></td></tr></table></figure>
<p>将上述内容添加到用户主目录中的.bashrc中即可。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-after-upgrading-to-wordpress30" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/after-upgrading-to-wordpress30/"><strong>升级到wordpress3.0</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-19</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/after-upgrading-to-wordpress30/" class="article-date">
  <time datetime="2010-06-18T16:00:00.000Z" itemprop="datePublished">2010-06-19</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/after-upgrading-to-wordpress30/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>昨天发现wordpress3.0已经发布，就顺手升级了。</p>
<p>略看了一下更新内容，几乎没什么让我感兴趣的，但与MU版本的合并堪称WP历史上的一个里程碑，从此一套WP可以支持创建多个博客了。</p>
<p>但我最近几度都想把博客换到dokuwiki下。</p>
<p>自从<a href="http://0x3f.org/?p=1455">开始用dokuwiki来组织知识和GTD</a>以来，我对wiki产生了越来越深的痴迷，最主要的原因就是它可以用很简单的语法写出格式规整的文章，我几乎可以不用考虑排版布局而只需把注意力放在文章内容上就行了。而将wiki上的文章发到博客上时，还需要重写，比较浪费时间。</p>
<p>但我最终放弃这个想法，最主要的原因是博客文章太多了，截至现在已经有五百多篇且大多是用HTML写的，难以转换。何况WP作为一个博客系统较wiki有着天生的优势，使用较为方便，如果用wiki来做博客，要做不少工作。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-do-paged-printing-using-javascript" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-do-paged-printing-using-javascript/"><strong>用JavaScript实现分页打印</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-19</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-do-paged-printing-using-javascript/" class="article-date">
  <time datetime="2010-06-18T16:00:00.000Z" itemprop="datePublished">2010-06-19</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-do-paged-printing-using-javascript/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近客户提的一个需求，要实现分页打印功能。公司产品对打印功能实现得不够好，排版全由程序生成，耦合度高，且不支持分页，需要用笨拙的方法变通。</p>
<p>于是我对如何更好地实现分页打印产生了兴趣，Google了一下，整理了一个Demo：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">media</span>=<span class="string">print</span>&gt;</span><span class="undefined">    </span></span><br><span class="line"><span class="css">        <span class="selector-class">.Noprint</span>&#123;<span class="attribute">display</span>:none;&#125;    </span></span><br><span class="line"><span class="css">        <span class="selector-class">.PageNext</span>&#123;<span class="attribute">page-break-after</span>: always;&#125;    </span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">WebBrowser</span> <span class="attr">classid</span>=<span class="string">CLSID:8856F961-340A-11D0-A96B-00C04FD705A2</span> <span class="attr">height</span>=<span class="string">0</span> <span class="attr">width</span>=<span class="string">0</span> <span class="attr">VIEWASTEXT</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"Noprint"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span>   <span class="attr">onclick</span>=<span class="string">document.all.WebBrowser.ExecWB(6,1)</span>   <span class="attr">type</span>=<span class="string">button</span>   <span class="attr">value</span>=<span class="string">打印</span>   <span class="attr">name</span>=<span class="string">Button</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span>   <span class="attr">onclick</span>=<span class="string">document.all.WebBrowser.ExecWB(7,1)</span>   <span class="attr">type</span>=<span class="string">button</span>   <span class="attr">value</span>=<span class="string">打印预览</span> <span class="attr">name</span>=<span class="string">Button</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span>   <span class="attr">onclick</span>=<span class="string">document.all.WebBrowser.ExecWB(8,1)</span>   <span class="attr">type</span>=<span class="string">button</span>   <span class="attr">value</span>=<span class="string">页面设置</span>   <span class="attr">name</span>=<span class="string">Button4</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"PageNext"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>雅游<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>旧院人称曲中，前门对武定桥，后门在钞库街。妓家鳞次，比屋而居。屋宇精洁，花木萧疏，迥非尘境。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>到门则铜环半启，珠箔低垂;升阶则猧儿吠客，鹦哥唤茶；登堂则假母肃迎，分宾抗礼；<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>进轩则丫鬟毕妆，捧艳而出；坐久则水陆备至，丝肉竞陈；定情则目眺心挑，绸缪宛转。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>纨绔少年，绣肠才子，无不魂迷色阵，气尽雌风矣。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>妓家，仆婢称之曰娘，外人呼之曰小娘，假母称之曰娘儿。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>有客称客曰姐夫，客称假母曰外婆。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"PageNext"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>木兰花令·拟古决绝词<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>清·纳兰容若<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>人生若只如初见，何事秋风悲画扇。等闲变却故人心，却道故人心易变!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>骊山语罢清宵半，泪雨零铃终不怨。何如薄幸锦衣郎，比翼连枝当日愿!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个方法的好处是支持以低耦合的方式分页打印，同时支持只打印页面上指定的部分内容；缺点是由于使用了ActiveX，故只支持IE浏览器。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-display-feedburner-subscription-image" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-display-feedburner-subscription-image/"><strong>中转feedburner订阅数图标</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-14</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-display-feedburner-subscription-image/" class="article-date">
  <time datetime="2010-06-13T16:00:00.000Z" itemprop="datePublished">2010-06-14</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-display-feedburner-subscription-image/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>利用国外服务器中转feedburner的图标：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 将$fburl替换为自己的feedburner订阅数图片地址，然后将博客中的图片地址换成此脚本的URL即可</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$fburl = <span class="string">'http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF&amp;amp;fg=444444&amp;amp;anim=0'</span>;</span><br><span class="line">$fbfl = <span class="string">'fb.gif'</span>;</span><br><span class="line">$fp = fopen($fburl, <span class="string">'rb'</span>);</span><br><span class="line"><span class="keyword">if</span> ($fp) &#123;</span><br><span class="line">    $fp_local = fopen($fbfl, <span class="string">'wb'</span>);</span><br><span class="line">    <span class="keyword">if</span> ($fp_local) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!feof($fp)) &#123;</span><br><span class="line">            fwrite($fp_local, fread($fp, <span class="number">1024</span>*<span class="number">8</span>), <span class="number">1024</span>*<span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fclose($fp_local);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line">header(<span class="string">'Location: '</span>.$fbfl);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'Content-Type: image/gif'</span>);</span><br><span class="line">readfile(<span class="string">'http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF&amp;fg=444444&amp;anim=0'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-using-cpufrequtils-to-reduce-cpu-temperature" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/using-cpufrequtils-to-reduce-cpu-temperature/"><strong>低碳生活：使用 cpufrequtils降低CPU温度</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-11</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/using-cpufrequtils-to-reduce-cpu-temperature/" class="article-date">
  <time datetime="2010-06-10T16:00:00.000Z" itemprop="datePublished">2010-06-11</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/using-cpufrequtils-to-reduce-cpu-temperature/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>cpufrequtils可以根据不同的方案自动调节CPU的频率，从而达到在系统空闲时降低CPU温度、节省电力的目的。</p>
<p>Archlinux官方wiki已经介绍得很明白了：<a href="http://wiki.archlinux.org/index.php/Cpufrequtils_(简体中文)" target="_blank" rel="noopener">http://wiki.archlinux.org/index.php/Cpufrequtils_(简体中文)</a></p>
<p>使用后效果明显，CPU温度有所下降，下面是cpufrequtils在<a href="http://0x3f.org/?tag=arch">Arch</a>上的工作情况： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ cpufreq-info </span><br><span class="line">cpufrequtils 007: cpufreq-info (C) Dominik Brodowski 2004-2009</span><br><span class="line">Report errors and bugs to cpufreq@vger.kernel.org, please.</span><br><span class="line">analyzing CPU 0:</span><br><span class="line">  driver: acpi-cpufreq</span><br><span class="line">  CPUs which run at the same hardware frequency: 0 1</span><br><span class="line">  CPUs which need to have their frequency coordinated by software: 0</span><br><span class="line">  maximum transition latency: 10.0 us.</span><br><span class="line">  hardware limits: 800 MHz - 2.53 GHz</span><br><span class="line">  available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz</span><br><span class="line">  available cpufreq governors: ondemand, performance</span><br><span class="line">  current policy: frequency should be within 800 MHz and 1.60 GHz.</span><br><span class="line">                  The governor &quot;ondemand&quot; may decide which speed to use</span><br><span class="line">                  within this range.</span><br><span class="line">  current CPU frequency is 800 MHz.</span><br><span class="line">analyzing CPU 1:</span><br><span class="line">  driver: acpi-cpufreq</span><br><span class="line">  CPUs which run at the same hardware frequency: 0 1</span><br><span class="line">  CPUs which need to have their frequency coordinated by software: 1</span><br><span class="line">  maximum transition latency: 10.0 us.</span><br><span class="line">  hardware limits: 800 MHz - 2.53 GHz</span><br><span class="line">  available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz</span><br><span class="line">  available cpufreq governors: ondemand, performance</span><br><span class="line">  current policy: frequency should be within 800 MHz and 1.60 GHz.</span><br><span class="line">                  The governor &quot;performance&quot; may decide which speed to use</span><br><span class="line">                  within this range.</span><br><span class="line">  current CPU frequency is 1.60 GHz.</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-execute-sql-scripts-in-inno-setup" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-execute-sql-scripts-in-inno-setup/"><strong>Inno Setup执行SQL脚本的方法</strong></a>
      <small class="article-date-index">&nbsp; 2010-05-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-execute-sql-scripts-in-inno-setup/" class="article-date">
  <time datetime="2010-05-16T16:00:00.000Z" itemprop="datePublished">2010-05-17</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/howto-execute-sql-scripts-in-inno-setup/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>作为和<a href="http://zh.wikipedia.org/zh-cn/Nullsoft%E8%85%B3%E6%9C%AC%E5%AE%89%E8%A3%9D%E7%B3%BB%E7%B5%B1" target="_blank" rel="noopener">NSIS</a>并立的、两个最流行的免费Windows应用程序安装包制作工具之一，<a href="http://en.wikipedia.org/wiki/Inno_Setup" target="_blank" rel="noopener">Inno</a>在学习难度上相对要低一些，非常适合对一些简单的桌面程序打包。但对于较复杂的安装过程，或者Web应用程序来说，我个人觉得不是Inno的强项。当然，既然Inno内嵌了<a href="http://zh.wikipedia.org/zh-cn/Pascal" target="_blank" rel="noopener">Pascal</a>语言用以扩展功能，理论上不是不可以应付复杂的安装过程，但实现起来要复杂一些。</p>

<p>比如对于在安装过程中连接数据库并执行SQL脚本这样的需求，使用<a href="http://en.wikipedia.org/wiki/InstallShield" target="_blank" rel="noopener">InstallShield</a>应该会简单地多，而Inno却不支持直接操作数据库，并且相关的资料说明少之又少，还不如NSIS丰富，以至于我踏破铁鞋无觅处，最终却在NSIS的资料中找到了思路。</p>

<p>主要的思路是，在安装过程中，调用数据库客户端连接数据库并执行SQL脚本，然后将执行结果或错误信息输出到文件中，最后通过分析这个文件来判断命令执行的结果。但是，既然是调用特定的客户端，那么对不同数据库的操作自然就有所区别，具体情况如下所述。</p>

<p>首先在打包脚本的<strong>[Files]</strong>段将必需的文件包含进来：</p>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Files]</span></span><br><span class="line">Source: "D:\Development\MyDemoApp\code\*"; DestDir: "&#123;app&#125;"; Flags: ignoreversion recursesubdirs createallsubdirs</span><br><span class="line">Source: "D:\Development\MyDemoApp\sqlcmd.exe"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\sqlcmd.rll"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\mysql.exe"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\script_mssql.sql"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\script_mysql.sql"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\script_oracle.sql"; Flags: dontcopy</span><br></pre></td></tr></table></figure>

<p>在SQL Server中执行脚本的代码片断：</p>

<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExecScriptInMSSQL</span><span class="params">(DBHost, DBLogin, DBPass, DBName: <span class="keyword">String</span>)</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    ConnectExe: <span class="keyword">String</span>;</span><br><span class="line">    ConnectParam: <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">&#123;解压临时文件&#125;</span></span><br><span class="line">    ExtractTemporaryFile(<span class="string">'sqlcmd.exe'</span>);</span><br><span class="line">    ExtractTemporaryFile(<span class="string">'sqlcmd.rll'</span>);</span><br><span class="line">    ExtractTemporaryFile(<span class="string">'script_mssql.sql'</span>);</span><br><span class="line">    <span class="comment">&#123;构造数据库连接字符串&#125;</span></span><br><span class="line">    ConnectExe := ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\sqlcmd.exe'</span>;</span><br><span class="line">    ConnectParam := <span class="string">' -S '</span> + DBHost</span><br><span class="line">        + <span class="string">' -U '</span> + DBLogin</span><br><span class="line">        + <span class="string">' -P '</span> + DBPass</span><br><span class="line">        + <span class="string">' -d '</span> + DBName</span><br><span class="line">        + <span class="string">' -i script_mssql.sql -o '</span></span><br><span class="line">        + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>;</span><br><span class="line">    <span class="comment">&#123;建立数据库连接并执行脚本&#125;</span></span><br><span class="line">    <span class="keyword">if</span> Exec(ConnectExe, ConnectParam, <span class="string">''</span>, SW_HIDE, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        Result := ResultCode = <span class="number">0</span>;</span><br><span class="line">        LoadStringFromFile(ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, StatusString);</span><br><span class="line">        <span class="keyword">if</span> StatusString &lt;&gt; <span class="string">''</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            MsgBox(StatusString, mbError, MB_OK);</span><br><span class="line">            Result := False;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            Result := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">'Database update failed:'</span><span class="string">#10#10</span> + SysErrorMessage(ResultCode), mbError, MB_OK);</span><br><span class="line">        Result := False;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>在MySQL中执行脚本的代码片断：</p>

<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExecScriptInMYSQL</span><span class="params">(DBHost, DBLogin, DBPass, DBName: <span class="keyword">String</span>)</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    ConnectExe: <span class="keyword">String</span>;</span><br><span class="line">    ConnectParam: <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">&#123;解压临时文件&#125;</span></span><br><span class="line">    ExtractTemporaryFile(<span class="string">'mysql.exe'</span>);</span><br><span class="line">    ExtractTemporaryFile(<span class="string">'script_mysql.sql'</span>);</span><br><span class="line">    <span class="comment">&#123;构造数据库连接字符串&#125;</span></span><br><span class="line">    ConnectExe := ExpandConstant(<span class="string">'cmd'</span>);</span><br><span class="line">    ConnectParam := <span class="string">' /c "'</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\mysql.exe'</span></span><br><span class="line">        + <span class="string">' -h'</span> + DBHost</span><br><span class="line">        + <span class="string">' -u'</span> + DBLogin</span><br><span class="line">        + <span class="string">' -p'</span> + DBPass</span><br><span class="line">        + <span class="string">' -D'</span> + DBName</span><br><span class="line">        + <span class="string">' -e "source '</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\script_mysql.sql"" &gt; '</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt 2&gt;&amp;1'</span>;</span><br><span class="line">    <span class="comment">&#123;建立数据库连接并执行脚本&#125;</span></span><br><span class="line">    <span class="keyword">if</span> Exec(ConnectExe, ConnectParam, <span class="string">''</span>, SW_HIDE, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        Result := ResultCode = <span class="number">0</span>;</span><br><span class="line">        LoadStringFromFile(ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, StatusString);</span><br><span class="line">        <span class="keyword">if</span> StatusString &lt;&gt; <span class="string">''</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            MsgBox(StatusString, mbError, MB_OK);</span><br><span class="line">            Result := False;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            Result := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">'Database update failed:'</span><span class="string">#10#10</span> + SysErrorMessage(ResultCode), mbError, MB_OK);</span><br><span class="line">        Result := False;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>由于mysql.exe没有输出结果到文件的参数，故需要使用cmd.exe来运行mysql.exe以便将其输出重定向到文件dbstatus.txt中。此外，在命令的最后加上参数<strong>2&gt;&amp;1</strong>，将标准错误输出设备也重定向到文件上，否则命令执行的错误信息不会输出到文件中。</p>

<p>在Oracle中执行脚本的代码片断：</p>

<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExecScriptInORACLE</span><span class="params">(ClientPath, DBInstance, DBLogin, DBPass: <span class="keyword">String</span>)</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">&#123;解压临时文件&#125;</span></span><br><span class="line">    ExtractTemporaryFile(<span class="string">'script_oracle.sql'</span>);</span><br><span class="line">    <span class="comment">&#123;连接数据库并执行脚本&#125;</span></span><br><span class="line">    <span class="keyword">if</span> Exec(ExpandConstant(<span class="string">'cmd'</span>), <span class="string">' /c "'</span> + ClientPath + <span class="string">' -L -S '</span> + DBLogin</span><br><span class="line">        + <span class="string">'/'</span> + DBPass</span><br><span class="line">        + <span class="string">'@'</span> + DBInstance</span><br><span class="line">        + <span class="string">' @'</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\script_oracle.sql &gt; '</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt 2&gt;&amp;1'</span>,</span><br><span class="line">        <span class="string">''</span>,</span><br><span class="line">        SW_HIDE, ewWaitUntilTerminated, ResultCode)</span><br><span class="line">    <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        Result := ResultCode = <span class="number">0</span>;</span><br><span class="line">        LoadStringFromFile(ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, StatusString);</span><br><span class="line">        <span class="keyword">if</span> Pos(<span class="string">'holytail'</span>, StatusString) &lt;&gt; <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">&#123;若输出信息中有“holytail”的子串，则表示脚本成功执行&#125;</span></span><br><span class="line">            <span class="comment">&#123;若执行有误，提示用户打开日志文件&#125;</span></span><br><span class="line">            <span class="keyword">if</span> Pos(<span class="string">'ORA-'</span>, StatusString) &lt;&gt; <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                <span class="comment">&#123;提示用户脚本执行出错&#125;</span></span><br><span class="line">                <span class="keyword">if</span> MsgBox(<span class="string">'数据库更新出错，是否打开日志文件？'</span>, mbConfirmation, MB_YESNO) = IDYES <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                    <span class="comment">&#123;打开日志&#125;</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> ShellExec(<span class="string">''</span>, ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, <span class="string">''</span>, <span class="string">''</span>, SW_SHOW, ewNoWait, ErrorCode) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                        MsgBox(<span class="string">'日志文件打开错误！'</span>, mbError, MB_OK);</span><br><span class="line">                    <span class="keyword">end</span>;</span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">                Result := False;</span><br><span class="line">            <span class="comment">&#123;若执行无误，返回True&#125;</span></span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                Result := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> StatusString &lt;&gt; <span class="string">''</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            MsgBox(StatusString, mbError, MB_OK);</span><br><span class="line">            Result := False;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            Result := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">'Database update failed:'</span><span class="string">#10#10</span> + SysErrorMessage(ResultCode), mbError, MB_OK);</span><br><span class="line">        Result := False;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>Oracle的客户端太大，不能集成到安装包中，应使用一个<strong>TInputFileWizardPage</strong>由用户选择sqlplus.exe的安装位置。同时，由于sqlplus.exe也没有输出结果到文件的参数，也须使用cmd.exe来运行它并重定向输出到文件。此外，由于sqlplus.exe执行脚本时无论成功还是失败，都会输出信息，故无法像使用sqlcmd.exe和mysql.exe那样简单地判断脚本是否执行成功，需要在脚本的最后通过select语句输出一个特殊的字符串到文件中，然后通过判断dbstatus.txt中是否存在该字符串来判断脚本的执行情况；且由于sqlplus.exe执行完脚本后不会自动退出，还要在脚本最后加上exit语句；故<strong>script_oracle.sql</strong>的最后必须是如下内容：</p>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">'holytail'</span> <span class="keyword">FROM</span> dual;</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-freearc" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/freearc/"><strong>FreeArc：兼顾压缩比率与效率的压缩程序</strong></a>
      <small class="article-date-index">&nbsp; 2010-05-09</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/freearc/" class="article-date">
  <time datetime="2010-05-08T16:00:00.000Z" itemprop="datePublished">2010-05-09</time>
</a>-->
      <!--
-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://0x3f.org/post/freearc/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://freearc.org/" target="_blank" rel="noopener">FreeArc</a>的特点在于它在压缩比率与效率上取得了一个很好的平衡。传统的压缩程序则多偏重一点，要么占用系统资源低、速度快，但压缩比率小，如ZIP、RAR；要么压缩比率高，但占用系统资源大、速度慢，如7z。 </p>

<p>把RAR归于前者只是相对而言，除了WinZip，没有哪个压缩工具能取得像WinRAR那样的成功。之所以能做到这一点，是因为WinRAR不但继承了WinZip易用的优点，还具有对多种压缩算法广泛的兼容度，最重要的是，RAR压缩算法在效率与比率之间取得了一个非常好的平衡。凭借这些优势，WinRAR一举推翻了WinZip的王座，直到现在，它都是这个领域值得学习的榜样。 </p>

<p>早在7-Zip刚刚推出的时候，我就用过它。在压缩比率上，7z较RAR有着明显的优势，但在系统资源占用和压缩速度上，7z的表现非常不理想。最糟糕的是，如果你的机器配置较低，再加上你使用Windows系统，并且尤其喜欢使用图形界面的压缩工具，那7-zip对你来说就是一场恶梦，我曾经有过压缩一个较大的文件时进度条半天都不移动的经历。当然，在Windows命令行或Linux的终端中使用7-zip情况要好很多。此外，随着7-zip自身的完善和电脑配置的更新换代，这些劣势对7-zip普及的限制正逐渐弱化，事实上，我倾向于推荐用7-zip取代WinRAR，因为前者免费且有较大的压缩比率，而后者是收费的。 </p>

<p>上周偶然发现的FreeArc，它的主页上居然宣称比最好的压缩工具都快1.5到3倍，并且同时拥有超高的压缩比率。于是我拿7-zip与之作了几个粗略的对比测试，发现虽然没有宣称的那么夸张，但在压缩同样的文件并使用同样的压缩级别时，FreeArc均比7-zip快一些，而压缩比率却要稍高于后者。甚至对于某些格式的文件，FreeArc的“普通”级别的压缩比率都比7-zip“最高”级别的大。 </p>

<p>鉴于7-zip是资源占用大户，我非常怀疑在效率上FreeArc较WinRAR会有什么优势，更遑论快上1.5到3倍，但它的效率高于7-zip却是一个不争的事实，何况还有更高的压缩比率。此外，这次的测试中使用的操作系统和7-zip都是64位的，而FreeArc却是32位的，因此在效率的比试上会有不公平的地方。 </p>

<p>当然，FreeArc自身的缺点也很大： </p>

<ol>
<li>尚无64位版本</li>
<li>只支持Windows和Linux系统</li>
<li>不支持多卷压缩（分割压缩）</li>
<li>其它一些问题</li>
</ol>

<p>如果能在较短的时间内解决这些问题，我认为FreeArc还是很有前景的。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/36/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="page-number" href="/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/page/38/">38</a><a class="page-number" href="/page/39/">39</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" href="/page/38/">Next &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 晴耕雨讀&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = '0x3f';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
