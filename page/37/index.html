<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>晴耕雨讀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晴耕雨讀">
<meta property="og:url" content="http://0x3f.org/page/37/index.html">
<meta property="og:site_name" content="晴耕雨讀">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晴耕雨讀">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">目录</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://0x3f.org"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-after-upgrading-to-wordpress30" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/after-upgrading-to-wordpress30/"><strong>升级到wordpress3.0</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-19</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/after-upgrading-to-wordpress30/" class="article-date">
  <time datetime="2010-06-18T16:00:00.000Z" itemprop="datePublished">2010-06-19</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>昨天发现wordpress3.0已经发布，就顺手升级了。</p>
<p>略看了一下更新内容，几乎没什么让我感兴趣的，但与MU版本的合并堪称WP历史上的一个里程碑，从此一套WP可以支持创建多个博客了。</p>
<p>但我最近几度都想把博客换到dokuwiki下。</p>
<p>自从<a href="http://0x3f.org/?p=1455">开始用dokuwiki来组织知识和GTD</a>以来，我对wiki产生了越来越深的痴迷，最主要的原因就是它可以用很简单的语法写出格式规整的文章，我几乎可以不用考虑排版布局而只需把注意力放在文章内容上就行了。而将wiki上的文章发到博客上时，还需要重写，比较浪费时间。</p>
<p>但我最终放弃这个想法，最主要的原因是博客文章太多了，截至现在已经有五百多篇且大多是用HTML写的，难以转换。何况WP作为一个博客系统较wiki有着天生的优势，使用较为方便，如果用wiki来做博客，要做不少工作。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-do-paged-printing-using-javascript" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-do-paged-printing-using-javascript/"><strong>用JavaScript实现分页打印</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-19</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-do-paged-printing-using-javascript/" class="article-date">
  <time datetime="2010-06-18T16:00:00.000Z" itemprop="datePublished">2010-06-19</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近客户提的一个需求，要实现分页打印功能。公司产品对打印功能实现得不够好，排版全由程序生成，耦合度高，且不支持分页，需要用笨拙的方法变通。</p>
<p>于是我对如何更好地实现分页打印产生了兴趣，Google了一下，整理了一个Demo：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">media</span>=<span class="string">print</span>&gt;</span><span class="undefined">    </span></span><br><span class="line"><span class="css">        <span class="selector-class">.Noprint</span>&#123;<span class="attribute">display</span>:none;&#125;    </span></span><br><span class="line"><span class="css">        <span class="selector-class">.PageNext</span>&#123;<span class="attribute">page-break-after</span>: always;&#125;    </span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">WebBrowser</span> <span class="attr">classid</span>=<span class="string">CLSID:8856F961-340A-11D0-A96B-00C04FD705A2</span> <span class="attr">height</span>=<span class="string">0</span> <span class="attr">width</span>=<span class="string">0</span> <span class="attr">VIEWASTEXT</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"Noprint"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span>   <span class="attr">onclick</span>=<span class="string">document.all.WebBrowser.ExecWB(6,1)</span>   <span class="attr">type</span>=<span class="string">button</span>   <span class="attr">value</span>=<span class="string">打印</span>   <span class="attr">name</span>=<span class="string">Button</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span>   <span class="attr">onclick</span>=<span class="string">document.all.WebBrowser.ExecWB(7,1)</span>   <span class="attr">type</span>=<span class="string">button</span>   <span class="attr">value</span>=<span class="string">打印预览</span> <span class="attr">name</span>=<span class="string">Button</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span>   <span class="attr">onclick</span>=<span class="string">document.all.WebBrowser.ExecWB(8,1)</span>   <span class="attr">type</span>=<span class="string">button</span>   <span class="attr">value</span>=<span class="string">页面设置</span>   <span class="attr">name</span>=<span class="string">Button4</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"PageNext"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>雅游<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>旧院人称曲中，前门对武定桥，后门在钞库街。妓家鳞次，比屋而居。屋宇精洁，花木萧疏，迥非尘境。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>到门则铜环半启，珠箔低垂;升阶则猧儿吠客，鹦哥唤茶；登堂则假母肃迎，分宾抗礼；<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>进轩则丫鬟毕妆，捧艳而出；坐久则水陆备至，丝肉竞陈；定情则目眺心挑，绸缪宛转。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>纨绔少年，绣肠才子，无不魂迷色阵，气尽雌风矣。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>妓家，仆婢称之曰娘，外人呼之曰小娘，假母称之曰娘儿。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>有客称客曰姐夫，客称假母曰外婆。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"PageNext"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>木兰花令·拟古决绝词<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>清·纳兰容若<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>人生若只如初见，何事秋风悲画扇。等闲变却故人心，却道故人心易变!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>骊山语罢清宵半，泪雨零铃终不怨。何如薄幸锦衣郎，比翼连枝当日愿!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个方法的好处是支持以低耦合的方式分页打印，同时支持只打印页面上指定的部分内容；缺点是由于使用了ActiveX，故只支持IE浏览器。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-display-feedburner-subscription-image" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-display-feedburner-subscription-image/"><strong>中转feedburner订阅数图标</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-14</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-display-feedburner-subscription-image/" class="article-date">
  <time datetime="2010-06-13T16:00:00.000Z" itemprop="datePublished">2010-06-14</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/计算机/">计算机</a>
  </div>

-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>利用国外服务器中转feedburner的图标：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 将$fburl替换为自己的feedburner订阅数图片地址，然后将博客中的图片地址换成此脚本的URL即可</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$fburl = <span class="string">'http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF&amp;amp;fg=444444&amp;amp;anim=0'</span>;</span><br><span class="line">$fbfl = <span class="string">'fb.gif'</span>;</span><br><span class="line">$fp = fopen($fburl, <span class="string">'rb'</span>);</span><br><span class="line"><span class="keyword">if</span> ($fp) &#123;</span><br><span class="line">    $fp_local = fopen($fbfl, <span class="string">'wb'</span>);</span><br><span class="line">    <span class="keyword">if</span> ($fp_local) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!feof($fp)) &#123;</span><br><span class="line">            fwrite($fp_local, fread($fp, <span class="number">1024</span>*<span class="number">8</span>), <span class="number">1024</span>*<span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fclose($fp_local);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line">header(<span class="string">'Location: '</span>.$fbfl);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'Content-Type: image/gif'</span>);</span><br><span class="line">readfile(<span class="string">'http://feeds.feedburner.com/~fc/leninlee?bg=99CCFF&amp;fg=444444&amp;anim=0'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-using-cpufrequtils-to-reduce-cpu-temperature" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/using-cpufrequtils-to-reduce-cpu-temperature/"><strong>低碳生活：使用 cpufrequtils降低CPU温度</strong></a>
      <small class="article-date-index">&nbsp; 2010-06-11</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/using-cpufrequtils-to-reduce-cpu-temperature/" class="article-date">
  <time datetime="2010-06-10T16:00:00.000Z" itemprop="datePublished">2010-06-11</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>cpufrequtils可以根据不同的方案自动调节CPU的频率，从而达到在系统空闲时降低CPU温度、节省电力的目的。</p>
<p>Archlinux官方wiki已经介绍得很明白了：<a href="http://wiki.archlinux.org/index.php/Cpufrequtils_(简体中文)" target="_blank" rel="noopener">http://wiki.archlinux.org/index.php/Cpufrequtils_(简体中文)</a></p>
<p>使用后效果明显，CPU温度有所下降，下面是cpufrequtils在<a href="http://0x3f.org/?tag=arch">Arch</a>上的工作情况： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ cpufreq-info </span><br><span class="line">cpufrequtils 007: cpufreq-info (C) Dominik Brodowski 2004-2009</span><br><span class="line">Report errors and bugs to cpufreq@vger.kernel.org, please.</span><br><span class="line">analyzing CPU 0:</span><br><span class="line">  driver: acpi-cpufreq</span><br><span class="line">  CPUs which run at the same hardware frequency: 0 1</span><br><span class="line">  CPUs which need to have their frequency coordinated by software: 0</span><br><span class="line">  maximum transition latency: 10.0 us.</span><br><span class="line">  hardware limits: 800 MHz - 2.53 GHz</span><br><span class="line">  available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz</span><br><span class="line">  available cpufreq governors: ondemand, performance</span><br><span class="line">  current policy: frequency should be within 800 MHz and 1.60 GHz.</span><br><span class="line">                  The governor &quot;ondemand&quot; may decide which speed to use</span><br><span class="line">                  within this range.</span><br><span class="line">  current CPU frequency is 800 MHz.</span><br><span class="line">analyzing CPU 1:</span><br><span class="line">  driver: acpi-cpufreq</span><br><span class="line">  CPUs which run at the same hardware frequency: 0 1</span><br><span class="line">  CPUs which need to have their frequency coordinated by software: 1</span><br><span class="line">  maximum transition latency: 10.0 us.</span><br><span class="line">  hardware limits: 800 MHz - 2.53 GHz</span><br><span class="line">  available frequency steps: 2.53 GHz, 2.53 GHz, 1.60 GHz, 800 MHz</span><br><span class="line">  available cpufreq governors: ondemand, performance</span><br><span class="line">  current policy: frequency should be within 800 MHz and 1.60 GHz.</span><br><span class="line">                  The governor &quot;performance&quot; may decide which speed to use</span><br><span class="line">                  within this range.</span><br><span class="line">  current CPU frequency is 1.60 GHz.</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-execute-sql-scripts-in-inno-setup" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-execute-sql-scripts-in-inno-setup/"><strong>Inno Setup执行SQL脚本的方法</strong></a>
      <small class="article-date-index">&nbsp; 2010-05-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-execute-sql-scripts-in-inno-setup/" class="article-date">
  <time datetime="2010-05-16T16:00:00.000Z" itemprop="datePublished">2010-05-17</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>作为和<a href="http://zh.wikipedia.org/zh-cn/Nullsoft%E8%85%B3%E6%9C%AC%E5%AE%89%E8%A3%9D%E7%B3%BB%E7%B5%B1" target="_blank" rel="noopener">NSIS</a>并立的、两个最流行的免费Windows应用程序安装包制作工具之一，<a href="http://en.wikipedia.org/wiki/Inno_Setup" target="_blank" rel="noopener">Inno</a>在学习难度上相对要低一些，非常适合对一些简单的桌面程序打包。但对于较复杂的安装过程，或者Web应用程序来说，我个人觉得不是Inno的强项。当然，既然Inno内嵌了<a href="http://zh.wikipedia.org/zh-cn/Pascal" target="_blank" rel="noopener">Pascal</a>语言用以扩展功能，理论上不是不可以应付复杂的安装过程，但实现起来要复杂一些。</p>

<p>比如对于在安装过程中连接数据库并执行SQL脚本这样的需求，使用<a href="http://en.wikipedia.org/wiki/InstallShield" target="_blank" rel="noopener">InstallShield</a>应该会简单地多，而Inno却不支持直接操作数据库，并且相关的资料说明少之又少，还不如NSIS丰富，以至于我踏破铁鞋无觅处，最终却在NSIS的资料中找到了思路。</p>

<p>主要的思路是，在安装过程中，调用数据库客户端连接数据库并执行SQL脚本，然后将执行结果或错误信息输出到文件中，最后通过分析这个文件来判断命令执行的结果。但是，既然是调用特定的客户端，那么对不同数据库的操作自然就有所区别，具体情况如下所述。</p>

<p>首先在打包脚本的<strong>[Files]</strong>段将必需的文件包含进来：</p>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Files]</span></span><br><span class="line">Source: "D:\Development\MyDemoApp\code\*"; DestDir: "&#123;app&#125;"; Flags: ignoreversion recursesubdirs createallsubdirs</span><br><span class="line">Source: "D:\Development\MyDemoApp\sqlcmd.exe"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\sqlcmd.rll"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\mysql.exe"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\script_mssql.sql"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\script_mysql.sql"; Flags: dontcopy</span><br><span class="line">Source: "D:\Development\MyDemoApp\script_oracle.sql"; Flags: dontcopy</span><br></pre></td></tr></table></figure>

<p>在SQL Server中执行脚本的代码片断：</p>

<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExecScriptInMSSQL</span><span class="params">(DBHost, DBLogin, DBPass, DBName: <span class="keyword">String</span>)</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    ConnectExe: <span class="keyword">String</span>;</span><br><span class="line">    ConnectParam: <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">&#123;解压临时文件&#125;</span></span><br><span class="line">    ExtractTemporaryFile(<span class="string">'sqlcmd.exe'</span>);</span><br><span class="line">    ExtractTemporaryFile(<span class="string">'sqlcmd.rll'</span>);</span><br><span class="line">    ExtractTemporaryFile(<span class="string">'script_mssql.sql'</span>);</span><br><span class="line">    <span class="comment">&#123;构造数据库连接字符串&#125;</span></span><br><span class="line">    ConnectExe := ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\sqlcmd.exe'</span>;</span><br><span class="line">    ConnectParam := <span class="string">' -S '</span> + DBHost</span><br><span class="line">        + <span class="string">' -U '</span> + DBLogin</span><br><span class="line">        + <span class="string">' -P '</span> + DBPass</span><br><span class="line">        + <span class="string">' -d '</span> + DBName</span><br><span class="line">        + <span class="string">' -i script_mssql.sql -o '</span></span><br><span class="line">        + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>;</span><br><span class="line">    <span class="comment">&#123;建立数据库连接并执行脚本&#125;</span></span><br><span class="line">    <span class="keyword">if</span> Exec(ConnectExe, ConnectParam, <span class="string">''</span>, SW_HIDE, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        Result := ResultCode = <span class="number">0</span>;</span><br><span class="line">        LoadStringFromFile(ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, StatusString);</span><br><span class="line">        <span class="keyword">if</span> StatusString &lt;&gt; <span class="string">''</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            MsgBox(StatusString, mbError, MB_OK);</span><br><span class="line">            Result := False;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            Result := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">'Database update failed:'</span><span class="string">#10#10</span> + SysErrorMessage(ResultCode), mbError, MB_OK);</span><br><span class="line">        Result := False;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>在MySQL中执行脚本的代码片断：</p>

<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExecScriptInMYSQL</span><span class="params">(DBHost, DBLogin, DBPass, DBName: <span class="keyword">String</span>)</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    ConnectExe: <span class="keyword">String</span>;</span><br><span class="line">    ConnectParam: <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">&#123;解压临时文件&#125;</span></span><br><span class="line">    ExtractTemporaryFile(<span class="string">'mysql.exe'</span>);</span><br><span class="line">    ExtractTemporaryFile(<span class="string">'script_mysql.sql'</span>);</span><br><span class="line">    <span class="comment">&#123;构造数据库连接字符串&#125;</span></span><br><span class="line">    ConnectExe := ExpandConstant(<span class="string">'cmd'</span>);</span><br><span class="line">    ConnectParam := <span class="string">' /c "'</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\mysql.exe'</span></span><br><span class="line">        + <span class="string">' -h'</span> + DBHost</span><br><span class="line">        + <span class="string">' -u'</span> + DBLogin</span><br><span class="line">        + <span class="string">' -p'</span> + DBPass</span><br><span class="line">        + <span class="string">' -D'</span> + DBName</span><br><span class="line">        + <span class="string">' -e "source '</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\script_mysql.sql"" &gt; '</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt 2&gt;&amp;1'</span>;</span><br><span class="line">    <span class="comment">&#123;建立数据库连接并执行脚本&#125;</span></span><br><span class="line">    <span class="keyword">if</span> Exec(ConnectExe, ConnectParam, <span class="string">''</span>, SW_HIDE, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        Result := ResultCode = <span class="number">0</span>;</span><br><span class="line">        LoadStringFromFile(ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, StatusString);</span><br><span class="line">        <span class="keyword">if</span> StatusString &lt;&gt; <span class="string">''</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            MsgBox(StatusString, mbError, MB_OK);</span><br><span class="line">            Result := False;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            Result := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">'Database update failed:'</span><span class="string">#10#10</span> + SysErrorMessage(ResultCode), mbError, MB_OK);</span><br><span class="line">        Result := False;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>由于mysql.exe没有输出结果到文件的参数，故需要使用cmd.exe来运行mysql.exe以便将其输出重定向到文件dbstatus.txt中。此外，在命令的最后加上参数<strong>2&gt;&amp;1</strong>，将标准错误输出设备也重定向到文件上，否则命令执行的错误信息不会输出到文件中。</p>

<p>在Oracle中执行脚本的代码片断：</p>

<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExecScriptInORACLE</span><span class="params">(ClientPath, DBInstance, DBLogin, DBPass: <span class="keyword">String</span>)</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">&#123;解压临时文件&#125;</span></span><br><span class="line">    ExtractTemporaryFile(<span class="string">'script_oracle.sql'</span>);</span><br><span class="line">    <span class="comment">&#123;连接数据库并执行脚本&#125;</span></span><br><span class="line">    <span class="keyword">if</span> Exec(ExpandConstant(<span class="string">'cmd'</span>), <span class="string">' /c "'</span> + ClientPath + <span class="string">' -L -S '</span> + DBLogin</span><br><span class="line">        + <span class="string">'/'</span> + DBPass</span><br><span class="line">        + <span class="string">'@'</span> + DBInstance</span><br><span class="line">        + <span class="string">' @'</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\script_oracle.sql &gt; '</span> + ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt 2&gt;&amp;1'</span>,</span><br><span class="line">        <span class="string">''</span>,</span><br><span class="line">        SW_HIDE, ewWaitUntilTerminated, ResultCode)</span><br><span class="line">    <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        Result := ResultCode = <span class="number">0</span>;</span><br><span class="line">        LoadStringFromFile(ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, StatusString);</span><br><span class="line">        <span class="keyword">if</span> Pos(<span class="string">'holytail'</span>, StatusString) &lt;&gt; <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">&#123;若输出信息中有“holytail”的子串，则表示脚本成功执行&#125;</span></span><br><span class="line">            <span class="comment">&#123;若执行有误，提示用户打开日志文件&#125;</span></span><br><span class="line">            <span class="keyword">if</span> Pos(<span class="string">'ORA-'</span>, StatusString) &lt;&gt; <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                <span class="comment">&#123;提示用户脚本执行出错&#125;</span></span><br><span class="line">                <span class="keyword">if</span> MsgBox(<span class="string">'数据库更新出错，是否打开日志文件？'</span>, mbConfirmation, MB_YESNO) = IDYES <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                    <span class="comment">&#123;打开日志&#125;</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> ShellExec(<span class="string">''</span>, ExpandConstant(<span class="string">'&#123;tmp&#125;'</span>) + <span class="string">'\dbstatus.txt'</span>, <span class="string">''</span>, <span class="string">''</span>, SW_SHOW, ewNoWait, ErrorCode) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                        MsgBox(<span class="string">'日志文件打开错误！'</span>, mbError, MB_OK);</span><br><span class="line">                    <span class="keyword">end</span>;</span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">                Result := False;</span><br><span class="line">            <span class="comment">&#123;若执行无误，返回True&#125;</span></span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                Result := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> StatusString &lt;&gt; <span class="string">''</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            MsgBox(StatusString, mbError, MB_OK);</span><br><span class="line">            Result := False;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            Result := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">'Database update failed:'</span><span class="string">#10#10</span> + SysErrorMessage(ResultCode), mbError, MB_OK);</span><br><span class="line">        Result := False;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>Oracle的客户端太大，不能集成到安装包中，应使用一个<strong>TInputFileWizardPage</strong>由用户选择sqlplus.exe的安装位置。同时，由于sqlplus.exe也没有输出结果到文件的参数，也须使用cmd.exe来运行它并重定向输出到文件。此外，由于sqlplus.exe执行脚本时无论成功还是失败，都会输出信息，故无法像使用sqlcmd.exe和mysql.exe那样简单地判断脚本是否执行成功，需要在脚本的最后通过select语句输出一个特殊的字符串到文件中，然后通过判断dbstatus.txt中是否存在该字符串来判断脚本的执行情况；且由于sqlplus.exe执行完脚本后不会自动退出，还要在脚本最后加上exit语句；故<strong>script_oracle.sql</strong>的最后必须是如下内容：</p>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">'holytail'</span> <span class="keyword">FROM</span> dual;</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-freearc" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/freearc/"><strong>FreeArc：兼顾压缩比率与效率的压缩程序</strong></a>
      <small class="article-date-index">&nbsp; 2010-05-09</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/freearc/" class="article-date">
  <time datetime="2010-05-08T16:00:00.000Z" itemprop="datePublished">2010-05-09</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://freearc.org/" target="_blank" rel="noopener">FreeArc</a>的特点在于它在压缩比率与效率上取得了一个很好的平衡。传统的压缩程序则多偏重一点，要么占用系统资源低、速度快，但压缩比率小，如ZIP、RAR；要么压缩比率高，但占用系统资源大、速度慢，如7z。 </p>

<p>把RAR归于前者只是相对而言，除了WinZip，没有哪个压缩工具能取得像WinRAR那样的成功。之所以能做到这一点，是因为WinRAR不但继承了WinZip易用的优点，还具有对多种压缩算法广泛的兼容度，最重要的是，RAR压缩算法在效率与比率之间取得了一个非常好的平衡。凭借这些优势，WinRAR一举推翻了WinZip的王座，直到现在，它都是这个领域值得学习的榜样。 </p>

<p>早在7-Zip刚刚推出的时候，我就用过它。在压缩比率上，7z较RAR有着明显的优势，但在系统资源占用和压缩速度上，7z的表现非常不理想。最糟糕的是，如果你的机器配置较低，再加上你使用Windows系统，并且尤其喜欢使用图形界面的压缩工具，那7-zip对你来说就是一场恶梦，我曾经有过压缩一个较大的文件时进度条半天都不移动的经历。当然，在Windows命令行或Linux的终端中使用7-zip情况要好很多。此外，随着7-zip自身的完善和电脑配置的更新换代，这些劣势对7-zip普及的限制正逐渐弱化，事实上，我倾向于推荐用7-zip取代WinRAR，因为前者免费且有较大的压缩比率，而后者是收费的。 </p>

<p>上周偶然发现的FreeArc，它的主页上居然宣称比最好的压缩工具都快1.5到3倍，并且同时拥有超高的压缩比率。于是我拿7-zip与之作了几个粗略的对比测试，发现虽然没有宣称的那么夸张，但在压缩同样的文件并使用同样的压缩级别时，FreeArc均比7-zip快一些，而压缩比率却要稍高于后者。甚至对于某些格式的文件，FreeArc的“普通”级别的压缩比率都比7-zip“最高”级别的大。 </p>

<p>鉴于7-zip是资源占用大户，我非常怀疑在效率上FreeArc较WinRAR会有什么优势，更遑论快上1.5到3倍，但它的效率高于7-zip却是一个不争的事实，何况还有更高的压缩比率。此外，这次的测试中使用的操作系统和7-zip都是64位的，而FreeArc却是32位的，因此在效率的比试上会有不公平的地方。 </p>

<p>当然，FreeArc自身的缺点也很大： </p>

<ol>
<li>尚无64位版本</li>
<li>只支持Windows和Linux系统</li>
<li>不支持多卷压缩（分割压缩）</li>
<li>其它一些问题</li>
</ol>

<p>如果能在较短的时间内解决这些问题，我认为FreeArc还是很有前景的。</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-howto-create-ssl-certificates" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/howto-create-ssl-certificates/"><strong>SSL证书生成方法</strong></a>
      <small class="article-date-index">&nbsp; 2010-05-03</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/howto-create-ssl-certificates/" class="article-date">
  <time datetime="2010-05-02T16:00:00.000Z" itemprop="datePublished">2010-05-03</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>一般情况下，如果能找到可用的证书，就可以直接使用，只不过会因证书的某些信息不正确或与部署证书的主机不匹配而导致浏览器提示证书无效，但这并不影响使用。</p>

<p>需要手工生成证书的情况有：</p>

<ol>
<li>找不到可用的证书</li>
<li>需要配置双向SSL，但缺少客户端证书</li>
<li>需要对证书作特别的定制</li>
</ol>

<p>首先，无论是在Linux下还是在Windows下的Cygwin中，进行下面的操作前都须确认已安装OpenSSL软件包。</p>

<p>1. 创建根证书密钥文件<strong>root.key</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -des3 -out root.key</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -des3 -out root.key</span><br><span class="line">Generating RSA private key, 512 bit long modulus</span><br><span class="line">.................++++++++++++</span><br><span class="line">..++++++++++++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for root.key:                ← 输入一个新密码</span><br><span class="line">Verifying - Enter pass phrase for root.key:    ← 重新输入一遍密码</span><br></pre></td></tr></table></figure>

<p>2. 创建根证书的申请文件<strong>root.req</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key root.key -out root.req</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl req -new -key root.key -out root.req</span><br><span class="line">Enter pass phrase for root.key:                                              ← 输入前面创建的密码</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN                                         ← 国家代号，中国输入CN</span><br><span class="line">State or Province Name (full name) [Some-State]:BeiJing                      ← 省的全名，拼音</span><br><span class="line">Locality Name (eg, city) []:BeiJing                                          ← 市的全名，拼音</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp.   ← 公司英文名</span><br><span class="line">Organizational Unit Name (eg, section) []:                                   ← 可以不输入</span><br><span class="line">Common Name (eg, YOUR name) []:                                              ← 此时不输入</span><br><span class="line">Email Address []:admin@mycompany.com                                         ← 电子邮箱，可随意填&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:                                                     ← 可以不输入</span><br><span class="line">An optional company name []:                                                 ← 可以不输入&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>3. 创建一个自当前日期起为期十年的根证书<strong>root.crt</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 3650 -sha1 -extensions v3_ca -signkey root.key -in root.req -out root.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl x509 -req -days 3650 -sha1 -extensions v3_ca -signkey root.key -in root.req -out root.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./emailAddress=admin@mycompany.com</span><br><span class="line">Getting Private key</span><br><span class="line">Enter pass phrase for root.key:    ← 输入前面创建的密码</span><br></pre></td></tr></table></figure>

<p>4. 创建服务器证书密钥<strong>server.key</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -out server.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">....+++</span><br><span class="line">..................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br></pre></td></tr></table></figure>

<p>5.创建服务器证书的申请文件<strong>server.req</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key server.key -out server.req</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl req -new -key server.key -out server.req</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN                                          ← 国家名称，中国输入CN</span><br><span class="line">State or Province Name (full name) [Some-State]:BeiJing                       ← 省名，拼音</span><br><span class="line">Locality Name (eg, city) []:BeiJing                                           ← 市名，拼音</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp.    ← 公司英文名</span><br><span class="line">Organizational Unit Name (eg, section) []:                                    ← 可以不输入</span><br><span class="line">Common Name (eg, YOUR name) []:www.mycompany.com                              ← 服务器主机名，若填写不正确，浏览器会报告证书无效，但并不影响使用</span><br><span class="line">Email Address []:admin@mycompany.com                                          ← 电子邮箱，可随便填</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:                                                      ← 可以不输入</span><br><span class="line">An optional company name []:                                                  ← 可以不输入</span><br></pre></td></tr></table></figure>

<p>6. 创建自当前日期起有效期为期两年的服务器证书<strong>server.crt</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in server.req -out server.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in server.req -out server.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www.mycompany.com/emailAddress=admin@mycompany.com</span><br><span class="line">Getting CA Private Key</span><br><span class="line">Enter pass phrase for root.key:    ← 输入前面创建的密码</span><br></pre></td></tr></table></figure>

<p>7. 创建客户端证书密钥文件<strong>client.key</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -des3 -out client.key 2048</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -des3 -out client.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">.........................................................................................+++</span><br><span class="line">......................................................................................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for client.key:              ← 输入一个新密码</span><br><span class="line">Verifying - Enter pass phrase for client.key:  ← 重新输入一遍密码</span><br></pre></td></tr></table></figure>

<p>8. 创建客户端证书的申请文件<strong>client.req</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key client.key -out client.req</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl genrsa -des3 -out client.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">.........................................................................................+++</span><br><span class="line">......................................................................................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for client.key:</span><br><span class="line">Verifying - Enter pass phrase for client.key:</span><br><span class="line">[lenin@archer ~]$ openssl req -new -key client.key -out client.req</span><br><span class="line">Enter pass phrase for client.key:                                              ← 输入上一步中创建的密码</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN                                           ← 国家名称，中国输入CN</span><br><span class="line">State or Province Name (full name) [Some-State]:BeiJing                        ← 省名称，拼音</span><br><span class="line">Locality Name (eg, city) []:BeiJing                                            ← 市名称，拼音</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp.     ← 公司英文名</span><br><span class="line">Organizational Unit Name (eg, section) []:                                     ← 可以不填</span><br><span class="line">Common Name (eg, YOUR name) []:Lenin                                           ← 自己的英文名，可以随便填</span><br><span class="line">Email Address []:admin@mycompany.com                                           ← 电子邮箱，可以随便填</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:                                                       ← 可以不填</span><br><span class="line">An optional company name []:                                                   ← 可以不填</span><br></pre></td></tr></table></figure>

<p>9. 创建一个自当前日期起有效期为两年的客户端证书<strong>client.crt</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in client.req -out client.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl x509 -req -days 730 -sha1 -extensions v3_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in client.req -out client.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www.mycompany.com/emailAddress=admin@mycompany.com</span><br><span class="line">Getting CA Private Key</span><br><span class="line">Enter pass phrase for root.key:          ← 输入上面创建的密码</span><br></pre></td></tr></table></figure>

<p>10. 将客户端证书文件<strong>client.crt</strong>和客户端证书密钥文件<strong>client.key</strong>合并成客户端证书安装包<strong>client.pfx</strong>：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -export -in client.crt -inkey client.key -out client.pfx</span><br></pre></td></tr></table></figure>

<p>输出内容为：</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[lenin@archer ~]$ openssl pkcs12 -export -in client.crt -inkey client.key -out client.pfx</span><br><span class="line">Enter pass phrase for client.key:        ← 输入上面创建的密码</span><br><span class="line">Enter Export Password:                   ← 输入一个新的密码，用作客户端证书的保护密码，在客户端安装证书时需要输入此密码</span><br><span class="line">Verifying - Enter Export Password:       ← 确认密码</span><br></pre></td></tr></table></figure>

<p>11. 保存生成的文件备用，其中<strong>server.crt</strong>和<strong>server.key</strong>是配置单向SSL时需要使用的证书文件，<strong>client.crt</strong>是配置双向SSL时需要使用的证书文件，<strong>client.pfx</strong>是配置双向SSL时需要客户端安装的证书文件</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-phpjs" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/phpjs/"><strong>强大的工具函数库：php.js</strong></a>
      <small class="article-date-index">&nbsp; 2010-04-24</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/phpjs/" class="article-date">
  <time datetime="2010-04-23T16:00:00.000Z" itemprop="datePublished">2010-04-24</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>PHP最大的特点在于它拥有一个丰富、灵活、强大的函数库，因此得以机动灵活成为软件开发语言中的轻骑兵。</p>

<p><a href="http://phpjs.org/" target="_blank" rel="noopener">php.js</a>是一个用Javascript实现的函数库，它试图用Javascript最大程度地重写PHP的函数库。相对于JQuery、ExtJS这些Javascript库，php.js不并致力于为AJAX、DOM和界面开发提供一揽子解决方案，它只是将PHP函数的强大和简便带到前端开发中来，由于JQuery这样的库并不旨在提供完全的Javascript开发标准和手段，实际上，它弥补了这些高端的工具库与低端的Javascript开发之间的一个空白。</p>

<p>对于熟悉PHP的人尤其是PHP程序员来说，使用php.js是几乎不需要切换思维方式的。</p>

<p>这是使用php实现的日期格式校验函数：</p>

<p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsValidDate</span><span class="params">($strDate, $strFormat=<span class="string">'Y-m-d'</span>)</span> </span>&#123;</span><br><span class="line">    $strDate = trim($strDate);</span><br><span class="line">    $unixTime = strtotime($strDate);</span><br><span class="line">    $strNewDate = date($strFormat, $unixTime);</span><br><span class="line">    <span class="keyword">return</span> $strDate == $strNewDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</p>

<p>这是使用php.js实现的日期格式校验函数：</p>

<p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsValidDate</span>(<span class="params">strDate, strFormat</span>) </span>&#123;</span><br><span class="line">    strDate = trim(strDate);</span><br><span class="line">    <span class="keyword">var</span> unixTime = strtotime(strDate);</span><br><span class="line">    <span class="keyword">var</span> strNewDate = date(strFormat, unixTime);</span><br><span class="line">    <span class="keyword">return</span> strDate == strNewDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-syntax-checking-and-code-executing-in-vim" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/syntax-checking-and-code-executing-in-vim/"><strong>在Vim中检查语法和执行代码</strong></a>
      <small class="article-date-index">&nbsp; 2010-04-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/syntax-checking-and-code-executing-in-vim/" class="article-date">
  <time datetime="2010-04-16T16:00:00.000Z" itemprop="datePublished">2010-04-17</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <div class="illustration_right">
<a href="http://picasaweb.google.com/lh/photo/OXk7sdAO9gNHu0qkTgK1PA?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh3.ggpht.com/_ceUJ_lBTHzc/SaV494hGreI/AAAAAAAAAzY/xExf7CzGyv0/s800/the-mug-of-vi.jpg"></a>
</div>

<p>《<a href="http://www.pragprog.com/the-pragmatic-programmer" target="_blank" rel="noopener">The Pragmatic Programmer</a>》的确是本好书，虽然中文译名极为恶俗。为践行书中提到的<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank" rel="noopener">DRY原则</a>，我开始反思平时编码时总是重复出现的问题，其中之一就是很低级的语法错误，有时忘了语句最后的分号，有时忘了声明变量，凡此种种，不一而足。</p>

<p>相对于IDE，我更喜欢Vim，这也是语法错误没有检查出来的原因。因此就产生了给Vim添加语法检查功能的需求。下面是检查PHP代码的vimrc内容：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Check the syntax of a PHP file</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">CheckPHPSyntax</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'php'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a PHP file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=php\ -<span class="keyword">l</span>\ -n\ -d\ html_errors=off\ %</span><br><span class="line">    <span class="keyword">setlocal</span> errorformat=%<span class="keyword">m</span>\ in\ %<span class="keyword">f</span>\ <span class="keyword">on</span>\ <span class="built_in">line</span>\ %<span class="keyword">l</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Syntax checking output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">silent</span> <span class="keyword">make</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">map</span> <span class="symbol">&lt;F5&gt;</span> :<span class="keyword">call</span> CheckPHPSyntax()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">imap</span> <span class="symbol">&lt;F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> CheckPHPSyntax()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<p>以上脚本为Vim添加了一个检查PHP语法错误的函数和两个快捷键映射，此后可按F5键即时检查当前Buffer中的PHP当面的语法。和网上其它同类的函数相比，这个函数的优点在于改进了检查结果的显示，使用silent命令隐藏了所有不必要的输出。</p>

<p>以下是检查Python代码语法错误的脚本：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Check the syntax of a python file</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">CheckPythonSyntax</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'python'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a Python file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=<span class="keyword">python</span>\ -<span class="keyword">u</span>\ %</span><br><span class="line">    <span class="keyword">set</span> efm=%C\ %.%#,%A\ \ File\ \<span class="string">"%f\"</span>\\,\ <span class="built_in">line</span>\ %<span class="keyword">l</span>%.%#,%Z%[%^\ ]%\\@=%<span class="keyword">m</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Syntax checking output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    exec <span class="string">"silent make -c \"import py_compile;py_compile.compile(r'"</span>.<span class="built_in">bufname</span>(<span class="string">"%"</span>).<span class="string">"')\""</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">map</span> <span class="symbol">&lt;F5&gt;</span> :<span class="keyword">call</span> CheckPythonSyntax()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">imap</span> <span class="symbol">&lt;F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> CheckPythonSyntax()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<p>上面两部分的配置脚本中虽然都指定了使用F5检查代码语法，但由于使用了<strong>au filetype</strong>指定了相应的语言类型，因此没有冲突。</p>

<p>和PHP相比，Python似乎更受垂青，因为除了上面和PHP一样的语法检查方式，它还有令人惊艳的<a href="http://www.vim.org/scripts/script.php?script_id=2441" target="_blank" rel="noopener">PyFlakes</a><a href="#footnote-pyflakes"> <sup><b>1</b></sup></a>。</p>

<p>PyFlakes的意思是<strong>Make on the fly</strong>，与另一神器Emacs的Flymake遥相呼应。只需要举出PyFlakes的两三个特性，就足以说明这是怎样的一个尤物了：其一是实时和高效，PyFlakes会在输入代码的同时检查语法错误，而且用户丝毫感觉不到任何停顿（<em>对于游戏玩家或高清电影狂可能“卡”更好理解</em>）；其二是智能，它居然能检查出哪些导入的模块没有被使用，哪些被使用的模块没有被导入；其三，PyFlakes检查出语法错误后会使用红色波浪线标识出错误位置。它使Vim完成了一个华丽的转身。</p>

<p>此外，由于PyFlakes是通过解析代码来检查语法错误，因此不必担心代码会被实际执行。</p>

<p>需要说明的是，PyFlakes要求Vim在编译时启用了对Python的支持，这一点可以使用<strong>:ver</strong>命令查看，一般各Linux发行版自带的Vim都加入了这个特性，而Windows下的版本没有此特性的可能性较大，好在作者提供了<a href="http://symbolsystem.com/vim/" target="_blank" rel="noopener">加入Python特性的Vim的Windows编译版</a>。</p>

<p>既然事已如此，不妨一不做、二不休，为Vim加上即时执行代码的功能。这个想法由来已久，出于和<a href="http://0x3f.org/?p=1433">寻找phpsh</a>同样的原因，我希望能在Vim中临时输入小块代码，然后即时执行并查看结果；或者即时执行正在编写的Python模块或程序。以下脚本实现了随手打开一个新的分割窗口并创建一个临时的脚本文件的功能：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Open a temporary PHP file in a new window</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">PHPSandBox</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">let</span> tmpfile = <span class="built_in">tempname</span>().<span class="string">'.php'</span></span><br><span class="line">    <span class="keyword">exe</span> <span class="string">'new '</span>.tmpfile</span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'&lt;?php'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'?&gt;'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">k</span></span><br><span class="line">    <span class="keyword">startinsert</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="comment">" Open a temporary Python file in a new window</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">PySandBox</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">let</span> tmpfile = <span class="built_in">tempname</span>().<span class="string">'.py'</span></span><br><span class="line">    <span class="keyword">exe</span> <span class="string">'new '</span>.tmpfile</span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'#!/usr/bin/python'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">setline</span>(<span class="string">'.'</span>, <span class="string">'# -*- coding: utf-8 -*-'</span>)</span><br><span class="line">    <span class="keyword">normal</span> <span class="keyword">o</span></span><br><span class="line">    <span class="keyword">startinsert</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>sbpy :<span class="keyword">call</span> PySandBox()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>sbph :<span class="keyword">call</span> PHPSandBox()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<p>下面的脚本则实现了即时执行当前Buffer中代码的功能：</p>

<p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Run a PHP script</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">ExecutePHPScript</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'php'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a PHP file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=php\ -<span class="keyword">f</span>\ %</span><br><span class="line">    <span class="keyword">setlocal</span> errorformat=%<span class="keyword">m</span>\ in\ %<span class="keyword">f</span>\ <span class="keyword">on</span>\ <span class="built_in">line</span>\ %<span class="keyword">l</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Execution output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">silent</span> <span class="keyword">make</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">map</span> <span class="symbol">&lt;C-F5&gt;</span> :<span class="keyword">call</span> ExecutePHPScript()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> php <span class="keyword">imap</span> <span class="symbol">&lt;C-F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> ExecutePHPScript()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Run a python script</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">ExecutePythonScript</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> != <span class="string">'python'</span></span><br><span class="line">        <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'This is not a Python file !'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">setlocal</span> makeprg=<span class="keyword">python</span>\ -<span class="keyword">u</span>\ %</span><br><span class="line">    <span class="keyword">set</span> efm=%C\ %.%#,%A\ \ File\ \<span class="string">"%f\"</span>\\,\ <span class="built_in">line</span>\ %<span class="keyword">l</span>%.%#,%Z%[%^\ ]%\\@=%<span class="keyword">m</span></span><br><span class="line">    <span class="keyword">echohl</span> WarningMsg | <span class="keyword">echo</span> <span class="string">'Execution output:'</span> | <span class="keyword">echohl</span> None</span><br><span class="line">    <span class="keyword">if</span> &amp;modified == <span class="number">1</span></span><br><span class="line">        <span class="keyword">silent</span> <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">silent</span> <span class="keyword">make</span></span><br><span class="line">    <span class="keyword">clist</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">map</span> <span class="symbol">&lt;C-F5&gt;</span> :<span class="keyword">call</span> ExecutePythonScript()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">au</span> <span class="keyword">filetype</span> <span class="keyword">python</span> <span class="keyword">imap</span> <span class="symbol">&lt;C-F5&gt;</span> <span class="symbol">&lt;ESC&gt;</span>:<span class="keyword">call</span> ExecutePythonScript()<span class="symbol">&lt;CR&gt;</span></span><br></pre></td></tr></table></figure>
</p>

<blockquote id="footnote-pyflakes">
<p><sup><b>Foot Note 1 :</b></sup></p>
<p>
PyFlakes本身是个通用的工具，其作者提供了一个Vim的插件调用PyFlakes的功能，故此处所说的PyFlakes实指Vim的PyFlakes插件。
</p>
</blockquote>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-buuf-deuce-icon-theme" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/post/buuf-deuce-icon-theme/"><strong>Buuf-Deuce：搞怪的图标主题</strong></a>
      <small class="article-date-index">&nbsp; 2010-04-10</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/post/buuf-deuce-icon-theme/" class="article-date">
  <time datetime="2010-04-09T16:00:00.000Z" itemprop="datePublished">2010-04-10</time>
</a>-->
      <!--
-->
      <!--
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>发现这个<a href="http://djany.deviantart.com/art/Gnome-Buuf-Deuce-1-1-R8-73339997" target="_blank" rel="noopener">图标主题</a>有段时间了，但直到今天偶然重新启用它，才突然觉得这套色调灰暗、风格搞怪的图标其实整体效果很好，很有个性，且极为闷骚，实为标榜非主流人士居家旅行必备。</p>
<p><a href="http://picasaweb.google.com/lh/photo/dGjc_mAUv2rQOLRDLlUZKw?feat=embedwebsite" target="_blank" rel="noopener"><img src="http://lh5.ggpht.com/_ceUJ_lBTHzc/S8CQfF_kpbI/AAAAAAAABZ8/UV3W7nTx3vA/s800/Gnome_Buuf_Deuce_1_1_R8_by_djany.jpg"></a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/36/">&laquo; Назад</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="page-number" href="/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/page/38/">38</a><a class="page-number" href="/page/39/">39</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" href="/page/38/">Далее &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 晴耕雨讀&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
